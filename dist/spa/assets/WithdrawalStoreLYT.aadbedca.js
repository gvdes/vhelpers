import{b as n,Q as D}from"./QList.5579ccce.js";import{Q as Y}from"./QHeader.5bd693dd.js";import{aH as j,a as q,u as I,r as v,c as y,o as Q,d as H,w as i,e,f as p,E as h,Q as R,h as G,a0 as z,a4 as K}from"./index.eaa7b09a.js";import{Q as X}from"./QToolbar.d160d895.js";import{Q as m}from"./QInput.19de0918.js";import{Q as c,d as Z}from"./QSelect.3b12697c.js";import{Q as _}from"./QDate.d80a89c0.js";import{Q as ll}from"./QTable.9c824403.js";import{Q as el,a as al}from"./QLayout.388b1106.js";import{j as tl,Q as P,a as T,p as w}from"./axios.881170ec.js";import{Q as ol}from"./QForm.8600d857.js";import{Q as S}from"./QCardActions.4f669cbe.js";import{C as sl}from"./ClosePopup.f9c3a594.js";import"./auto.d6085c6e.js";import{u as ul}from"./use-quasar.3b2890e4.js";import"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.12a117e5.js";import{_ as il}from"./UserToolbar.793f9fd7.js";import"./QResizeObserver.cf0a236b.js";import"./use-render-cache.3aae9b27.js";import"./date.ebab1fda.js";import"./QLinearProgress.969c86f1.js";import"./QCheckbox.b903ab51.js";import"./QScrollObserver.8580958c.js";import"./_commonjsHelpers.88e99c8f.js";import"./QExpansionItem.09a9dac3.js";import"./QDrawer.0e310ec2.js";import"./touch.9135741d.js";import"./auth.53881745.js";var nl={getStoreWithdrawals(k){return tl.get(`/withdrawalStore/${k}`).then(d=>d.data).catch(d=>({fail:d}))}};const dl={class:"col"},rl={class:"q-ml-sm"},Bl={__name:"WithdrawalStoreLYT",setup(k){const d=ul();j(),q(),I();const U=I(),O=v(null),f=v([]),o=v({val:null,state:!1}),r=v({val:null,opts:[]}),u=v({state:!1,val:null,body:null}),V=v([]),C=v(V.value),s=v({state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}),b=v({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:t=>t.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:t=>t.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:t=>t.NOFPRO,align:"left",sortable:!0}]}),A=y(()=>O.value&&!r.value.val?f.value.filter(t=>t.FECHA==O.value):!O.value&&r.value.val?f.value.filter(t=>t.CAJRET==r.value.val.CODTER):O.value&&r.value.val?f.value.filter(t=>t.FECHA==O.value&&t.CAJRET==r.value.val.CODTER):f.value),F=y(()=>{if(o.value){const t=f.value.find(a=>a.CODRET===o.value.val.CODRET);if(!t)return!1;let l={CAJRET:t.CAJRET,CODRET:t.CODRET,CONRET:t.CONRET,DESTER:t.DESTER,FECHA:t.FECHA,HORA:t.HORA,IMPRET:Number(t.IMPRET).toFixed(2),PROVEEDOR:{PRORET:t.PRORET,NOFPRO:t.NOFPRO}};return JSON.stringify(l)===JSON.stringify(o.value.val)}else return!0}),M=y(()=>!s.value.CONRET||!s.value.DESTER||!s.value.IMPRET||!s.value.PROVEEDOR),J=(t,l)=>{o.value.state=!o.value.state,console.log(l);let a={CAJRET:l.CAJRET,CODRET:l.CODRET,CONRET:l.CONRET,DESTER:l.DESTER,FECHA:l.FECHA,HORA:l.HORA,IMPRET:Number(l.IMPRET).toFixed(2),PROVEEDOR:{PRORET:l.PRORET,NOFPRO:l.NOFPRO}};o.value.val={...a}},L=async()=>{d.loading.show({message:"Obteniendo Registros"});let t=U.session.store.id;const l=await nl.getStoreWithdrawals(t);l.fail||(d.loading.hide(),console.log(l))},N=async()=>{console.log(stores.value.val.ip_address);let t={print:u.value.val.ip_address,codret:o.value.val.CODRET};console.log(t),d.loading.show({message:"Imprimiendo Retirada"});let a=`http://${stores.value.val.ip_address}/storetools/public/api/reports/printWitrawal`;const E=await w.post(a,t);E.status!=200?console.log(E):(console.log(E.data),u.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide())},B=async()=>{o.value.val.Print=u.value.val.ip_address,console.log(o.value.val),d.loading.show({message:"Modificando Retirada"});let l=`http://${stores.value.val.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const a=await w.post(l,o.value.val);if(a.status!=200)console.log(a);else{console.log(a.data);let E=f.value.findIndex(g=>g.CODRET==a.data.CODRET);E>=0&&(f.value[E]=a.data),u.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide()}},W=async()=>{s.value.Print=u.value.val.ip_address,console.log(s.value),d.loading.show({message:"Agregando Anticipo"});let l=`http://${stores.value.val.ip_address}/storetools/public/api/reports/addWithdrawal`;const a=await w.post(l,s.value);a.status!=200?console.log(a):(console.log(a.data),f.value.push(a.data),u.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide(),x())},x=()=>{s.value={state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}},$=(t,l,a)=>{if(t===""){l(()=>{C.value=V.value});return}l(()=>{const E=t.toLowerCase();C.value=V.value.filter(g=>g.NOFCLI.toLowerCase().includes(E))})};return L(),(t,l)=>(Q(),H(el,{view:"hHh Lpr fFf"},{default:i(()=>[e(Y,{class:"bg-grey-3 text-dark",bordered:""},{default:i(()=>[e(il),e(n)]),_:1}),e(al,null,{default:i(()=>[e(X,{class:"justify-between row"},{default:i(()=>[p("div",dl,[l[21]||(l[21]=p("span",{class:"text-grey"},"Helpers",-1)),e(h,{name:"navigate_next",color:"primary"}),l[22]||(l[22]=p("span",{class:"text-h6"},"Retiradas de Cajas",-1))]),l[23]||(l[23]=p("div",{class:"col"},[p("div",{class:"row"},[p("div",{class:"col"})])],-1))]),_:1}),e(n,{spaced:"",inset:"",vertical:"",dark:""}),A.value.length>0?(Q(),H(ll,{key:0,rows:A.value,filter:b.value.filter,columns:b.value.columns,onRowClick:J},{"top-right":i(()=>[e(m,{modelValue:b.value.filter,"onUpdate:modelValue":l[0]||(l[0]=a=>b.value.filter=a),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(c,{modelValue:r.value.val,"onUpdate:modelValue":l[1]||(l[1]=a=>r.value.val=a),options:r.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER"},null,8,["modelValue","options"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(R,{color:"primary",icon:"event",flat:"",round:""},{default:i(()=>[e(Z,null,{default:i(()=>[e(_,{modelValue:O.value,"onUpdate:modelValue":l[2]||(l[2]=a=>O.value=a),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(R,{color:"primary",icon:"add",flat:"",onClick:l[3]||(l[3]=a=>s.value.state=!s.value.state)})]),_:1},8,["rows","filter","columns"])):G("",!0)]),_:1}),e(D,{modelValue:u.value.state,"onUpdate:modelValue":l[5]||(l[5]=a=>u.value.state=a)},{default:i(()=>[e(P,{class:"my-card"},{default:i(()=>[e(T,null,{default:i(()=>l[24]||(l[24]=[p("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),e(T,null,{default:i(()=>[e(ol,{onSubmit:N,class:"q-gutter-md"},{default:i(()=>[e(c,{dense:"","option-label":"name",modelValue:u.value.val,"onUpdate:modelValue":l[4]||(l[4]=a=>u.value.val=a),options:u.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),p("div",null,[e(R,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:u.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:o.value.state,"onUpdate:modelValue":l[13]||(l[13]=a=>o.value.state=a),persistent:""},{default:i(()=>[e(P,{style:{width:"300px"}},{default:i(()=>[e(T,{class:"text-bold text-center text-h5"},{default:i(()=>[p("span",rl,"Retirada "+z(o.value.val.CODRET),1)]),_:1}),e(T,null,{default:i(()=>[e(m,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.val.FECHA=a),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{modelValue:o.value.val.HORA,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.val.HORA=a),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.val.DESTER=a),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(c,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.val.PROVEEDOR=a),options:V.value,label:"Proveedor",filled:"","option-label":"NOFPRO"},null,8,["modelValue","options"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":l[10]||(l[10]=a=>o.value.val.CONRET=a),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":l[11]||(l[11]=a=>o.value.val.IMPRET=a),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(c,{dense:"","option-label":"name",modelValue:u.value.val,"onUpdate:modelValue":l[12]||(l[12]=a=>u.value.val=a),options:u.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),e(n,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(S,{align:"center"},{default:i(()=>[K(e(R,{flat:"",color:"negative",icon:"close"},null,512),[[sl]]),e(R,{flat:"",color:"primary",icon:"print",onClick:N,disable:!F.value||!u.value.val},null,8,["disable"]),e(R,{flat:"",color:"yellow",icon:"edit",disable:F.value||!u.value.val,onClick:B},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:s.value.state,"onUpdate:modelValue":l[20]||(l[20]=a=>s.value.state=a),persistent:""},{default:i(()=>[e(P,{style:{width:"300px"}},{default:i(()=>[e(T,{class:"text-bold text-center text-h5"}),e(T,null,{default:i(()=>[e(m,{modelValue:s.value.FECHA,"onUpdate:modelValue":l[14]||(l[14]=a=>s.value.FECHA=a),type:"date",label:"Fecha",dense:"",filled:""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(c,{modelValue:s.value.DESTER,"onUpdate:modelValue":l[15]||(l[15]=a=>s.value.DESTER=a),options:r.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(c,{modelValue:s.value.PROVEEDOR,"onUpdate:modelValue":l[16]||(l[16]=a=>s.value.PROVEEDOR=a),options:C.value,label:"Proveedor",filled:"","option-label":"NOFPRO","use-input":"","input-debounce":"0",onFilter:$,dense:""},null,8,["modelValue","options"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{modelValue:s.value.CONRET,"onUpdate:modelValue":l[17]||(l[17]=a=>s.value.CONRET=a),type:"text",label:"Observacion",dense:"",filled:""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{modelValue:s.value.IMPRET,"onUpdate:modelValue":l[18]||(l[18]=a=>s.value.IMPRET=a),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),e(n,{spaced:"",inset:"",vertical:"",dark:""}),e(c,{dense:"","option-label":"name",modelValue:u.value.val,"onUpdate:modelValue":l[19]||(l[19]=a=>u.value.val=a),options:u.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),e(n,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(S,{align:"center"},{default:i(()=>[e(R,{flat:"",color:"negative",icon:"close",onClick:x}),e(R,{flat:"",color:"positive",icon:"send",disable:M.value||!u.value.val,onClick:W},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Bl as default};
