import{Q as E}from"./QInput.19de0918.js";import{Q as I}from"./QForm.8600d857.js";import{a as k,Q as N,d as T}from"./QSelect.3b12697c.js";import{Q as $,a as A,e as F,d as U}from"./QList.5579ccce.js";import{Q as L}from"./QTable.9c824403.js";import{Q as z}from"./QPage.62608d18.js";import{aH as H,a as M,u as j,r as m,c as G,o as h,g as O,e as a,w as s,a3 as Y,f as u,an as J,a4 as y,d as K,ak as p,a0 as d,al as W,Q as f,am as X}from"./index.eaa7b09a.js";import{Q as V,a as v}from"./axios.881170ec.js";import{Q as S}from"./QCardActions.4f669cbe.js";import{C as Z}from"./ClosePopup.f9c3a594.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.d2ceae62.js";import{u as tt}from"./Restock.beae563c.js";import{u as et}from"./use-quasar.3b2890e4.js";import{$sktRestock as P}from"./socket.3fae67a0.js";import{_ as at}from"./PrinterSelect.a5681e56.js";import"./QLinearProgress.969c86f1.js";import"./QCheckbox.b903ab51.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.82f1011a.js";const ot={class:"flex justify-center"},st={class:"text-center",style:"width: 50%;"},lt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},it={class:"text-bold"},rt={class:"q-mx-sm text-h6"},Ct={__name:"checkout",setup(nt){H();const w=M(),c=tt(),i=et(),C=j(),r=m(null),q=m({rowsPerPage:[0]}),l=m({state:!1,val:null}),n=m({state:!1,val:null,opts:["GEN","EMP"]}),x=G(()=>c.partitions.filter(o=>o._status==4||o._status==5&&o.requisition._workpoint_to==C.session.store.id_viz)),B=async()=>{c.setShowLYT(!0),c.setTitle("Verificacion"),c.setButtonShow(!1)},D=async o=>{i.loading.show({message:"..."}),console.log(o.ip),console.log(l.value);const e=await g.printForPartition({ip:o.ip,port:o._port,_partition:l.value.val.id,_workpoint_to:l.value.val._workpoint_to});console.log(e),e.status==200?(e.data?i.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):i.notify({message:`Sin conexion a <b>${o.name} <small>(${o.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),i.loading.hide()):(console.error(e),alert(`Error ${e.status}: ${e.data}`))},_=async()=>{l.value.val&&(r.value=l.value.val.id),console.log(r.value);let o=x.value.find(e=>e.id==r.value);if(o._status==5)w.push(`/distribute/checkout/${o.id}`);else if(o._status==4){i.loading.show({message:"Terminando, espera..."});let e={id:o.id,state:5,suply:o._suplier_id};console.log(e);let t=await g.nextStatePartition(e);if(console.log(t),t.status==200){if(console.log(o.requisition._status),t.data.partitionsEnd>t.data.partition.requisition._status){let b={id:t.data.partition._requisition,state:t.data.partitionsEnd};const Q=await g.nextState(b);P.emit("order_refresh",{order:Q.data}),console.log(Q.data)}P.emit("orderpartition_refresh",{order:t.data.partition}),w.push(`/distribute/checkout/${t.data.partition.id}`)}else console.log(t);i.loading.hide()}else i.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),r.value=null},R=o=>{let e=o.status==4?"11":"10",t=o.status==4?"text-dark":"text-white";switch(o.requisition.from.id){case 4:return`bg-blue-${e} ${t}`;case 7:return`bg-red-${e} ${t}`;case 5:return`bg-purple-${e} ${t}`;case 9:return`bg-green-${e} ${t}`;case 23:return`bg-yellow-${e} ${t}`;case 13:return`bg-brown-${e} ${t}`;default:return"text-dark"}};return B(),(o,e)=>(h(),O(Y,null,[a(z,{padding:""},{default:s(()=>[u("div",null,[u("div",ot,[u("div",st,[a(I,{onSubmit:_},{default:s(()=>[a(E,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),a(L,{rows:x.value,"row-key":"name",grid:"",pagination:q.value,"hide-bottom":""},{item:s(t=>[u("div",lt,[a(A,{bordered:"",class:J(R(t.row))},{default:s(()=>[y((h(),K(U,{clickable:"",onClick:()=>{l.value.state=!0,l.value.val=t.row}},{default:s(()=>[a(F,null,{default:s(()=>[a(k,{class:"text-center text-bold"},{default:s(()=>[p(d(t.row.id),1)]),_:2},1024),a(k,{class:"text-center text-overline text-caption"},{default:s(()=>[u("span",it,d(t.row.requisition.from.name),1),p(" (P: "+d(t.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[X]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),a($,{modelValue:n.value.state,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.state=t)},{default:s(()=>[a(V,null,{default:s(()=>[a(v,{class:"row items-center"},{default:s(()=>[a(W,{icon:"warning",color:"orange-14","text-color":"white"}),u("span",rt,"Iniciar CheckOut #"+d(r.value.id),1)]),_:1}),a(v,null,{default:s(()=>[a(N,{modelValue:n.value.val,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.val=t),options:n.value.opts,label:"Almacen Destino",filled:""},null,8,["modelValue","options"])]),_:1}),a(S,{vertical:"",align:"center"},{default:s(()=>[a(f,{flat:"",label:"Si",color:"primary",onClick:_,disable:n.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a($,{modelValue:l.value.state,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.state=t),persistent:""},{default:s(()=>[a(V,null,{default:s(()=>[a(v,{class:"text-bold text-h5 items-center"},{default:s(()=>[p(" Particion "+d(l.value.val.id),1)]),_:1}),a(v,{class:"text-center"},{default:s(()=>e[4]||(e[4]=[p(" Que Desesas Hacer ? ")])),_:1}),a(S,{align:"center"},{default:s(()=>[y(a(f,{flat:"",icon:"close",color:"negative"},null,512),[[Z]]),a(f,{flat:"",icon:"print",color:"primary"},{default:s(()=>[a(T,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:s(()=>[a(at,{onSelectedPartition:D,partition:!0})]),_:1})]),_:1}),a(f,{flat:"",icon:"send",color:"positive",onClick:_})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ct as default};
