import{u as fe,r as c,l as be,o as i,d as x,w as s,e as o,g as y,Q as V,a3 as L,a2 as I,f as O,h as D,ak as C,a0 as A,a4 as j,aA as ge}from"./index.d87ba090.js";import{Q as S}from"./QSeparator.8a831898.js";import{Q as ae}from"./QSelect.99543841.js";import{Q as $}from"./QTd.2a59fb8d.js";import{Q as z}from"./QTr.1749715f.js";import{Q as F}from"./QTable.d42c807f.js";import{Q as h}from"./QCardSection.f84172c8.js";import{Q as W}from"./QCard.e3958f52.js";import{Q as q}from"./QInput.f6fa87e6.js";import{Q as te}from"./QRadio.fa4f138a.js";import{Q as oe}from"./QCardActions.fa9275b3.js";import{Q as se}from"./QList.9f6b0a46.js";import{Q as he}from"./QPage.ce47e99b.js";import{C as ne}from"./ClosePopup.b4d916ee.js";import"./QDrawer.acff2a85.js";import"./axios.a1a5c455.js";import{u as we}from"./use-quasar.eba3be69.js";import{u as Ve}from"./warehousStore.a019ecd1.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.ea40903c.js";import{E as ye}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as P}from"./locationsApi.3791fe25.js";import"./use-dark.af54e05c.js";import"./use-key-composition.3243082c.js";import"./QLinearProgress.8823704f.js";import"./QCheckbox.7410cfbb.js";import"./QResizeObserver.76402ea5.js";import"./QScrollObserver.571ece0c.js";import"./_commonjsHelpers.88e99c8f.js";const ke={key:0,class:"row"},xe={class:"row"},Ce={class:"text-right row"},Se={class:"text-bold"},sl={__name:"locations",setup(Qe){const T=fe(),d=we();Ve().setTitle("Ubicaciones Estructura");const M=c([]),R=c([]),u=c(null),H=c(null),a=c({state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]}),m=c({state:!1,val:null}),Q=c([]),v=c([]),J=c(0),G=c({columns:[{name:"id",label:"ID",field:t=>t.id,align:"center"},{name:"name",label:"NOMBRE",field:t=>t.name,align:"left"},{name:"alias",label:"ALIAS",field:t=>t.alias,align:"left"},{name:"path",label:"PATH",field:t=>t.path,align:"left"}]}),ie=async()=>{d.loading.show({message:"Obteniendo Secciones"});const t=await P.index(T.session.store.id_viz);t.fail?console.log(t):R.value=t,d.loading.hide()},K=()=>{const t=u.value.sections||[];J.value=Math.max(...t.map(e=>e.deep)),v.value=[{options:t.filter(e=>e.root===0),selected:null}],Q.value=v.value[0].options},B=t=>{var e;return((e=u.value.sections)==null?void 0:e.filter(l=>l.root===t))||[]},ue=(t,e)=>{v.value.splice(e+1);const l=B(t);l.length>0&&v.value.push({options:l,selected:null})},re=()=>{const t=v.value.filter(e=>e.selected!==null);if(!t.length)console.log("crear una raiz"),a.value.state=!0,a.value.val=u.value,a.value.type=!0;else{console.log("crear hijos");const e=t[t.length-1],l=e.selected,n=e.options.find(r=>r.id===l);a.value.state=!0,a.value.val=n,a.value.type=!1}},ce=async()=>{d.loading.show({message:"Enviando Datos"}),a.value.defaultView.forEach(l=>{l.root=a.value.type?0:a.value.val.id,l.deep=a.value.type?0:Number(a.value.val.deep)+1,l._celler=a.value.type?a.value.val.id:a.value.val._celler,l.details={create:T.session.credentials.nick}}),console.log(a.value);let t={sections:a.value.defaultView};const e=await P.insertSection(t);e.fail?console.log(e):(console.log(e),e.forEach(n=>{console.log(n),a.value.type?Q.value.push(n):u.value.sections.push(n)}),d.notify({message:"Secciones Creadas",type:"positive",position:"bottom"}),d.loading.hide(),a.value={state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]})},X=t=>{const e=B(t.id);return{...t,pivot:e.map(l=>X(l))}},de=t=>{let e=X(t);console.log(e),m.value.state=!0,m.value.val=e},me=async()=>{d.loading.show({message:"eliminando Seccion"}),console.log(m.value.val),console.log(u.value);const t=await P.deleteSection(m.value.val);t.fail?console.log(t):(console.log(t),u.value.sections=u.value.sections.filter(e=>!t.ids.includes(e.id)),K(),m.value={state:!1,val:null},d.loading.hide())},ve=async()=>{d.loading.show({message:"Obeniendo Productos"});let t={workpoint:T.session.store.id_viz,section:H.value.selected};const e=await P.obtProduct(t);e.fail?console.log(e):(console.log(e),M.value=e,await pe(M.value),d.loading.hide())},pe=async()=>{const t=new ye.Workbook,e=t.addWorksheet("Products"),l=[{name:"Codigo",filterButton:!0},{name:"Descripcion",filterButton:!0},{name:"Ubicaciones",filterButton:!0}],n=M.value.map(f=>[f.code,f.description,f.locations.map(b=>b.path).join("|")]);e.addTable({name:"Productos_Ubicados",ref:"A1",headerRow:!0,style:{theme:"TableStyleMedium9",showRowStripes:!0},columns:l,rows:n}),e.columns.forEach(f=>{let b=0;f.eachCell({includeEmpty:!0},N=>{const E=N.value?N.value.toString().length:10;E>b&&(b=E)}),f.width=b<10?10:b});const r=await t.xlsx.writeBuffer(),_=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=document.createElement("a");p.href=URL.createObjectURL(_),p.download="almacenes.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p)};return ie(),be(()=>[v.value.map(t=>t.selected),a.value.create.name,a.value.create.alias,a.value.create.elementos,a.value.secuence],([t,e,l,n,r])=>{var f,b,N,E,Y,Z;const _=v.value.filter(w=>w.selected!==null);if(_.length){const w=_[_.length-1],U=B(w.selected);Q.value=U,H.value=w}else Q.value=((f=v.value[0])==null?void 0:f.options)||[];if(!e||!l){a.value.defaultView=[];return}const p=[];if(r){console.log(a.value.type);let w=null;a.value.type?w=u.value.sections.filter(g=>g.root==0&&g.deep==0)||[]:w=B((b=a.value.val)==null?void 0:b.id);let U=0;w.forEach(g=>{const k=parseInt(g.name.replace(e,"").trim()),ee=parseInt(g.alias.replace(l,"").trim()),le=Math.max(isNaN(k)?0:k,isNaN(ee)?0:ee);le>U&&(U=le)});for(let g=1;g<=(Number(n)||1);g++){const k=U+g;p.push({name:`${e} ${k}`,alias:`${l}${k}`,path:`${((N=a.value.val)==null?void 0:N.path)||""}${(E=a.value.val)!=null&&E.path?"-":""}${l}${k}`})}}else p.push({name:e,alias:l,path:`${((Y=a.value.val)==null?void 0:Y.path)||""}${(Z=a.value.val)!=null&&Z.path?"-":""} ${l}`});a.value.defaultView=p},{deep:!0}),(t,e)=>(i(),x(he,{padding:""},{default:s(()=>[o(W,{class:"my-card"},{default:s(()=>[o(h,null,{default:s(()=>[R.value.length>0?(i(),y("div",ke,[o(V,{color:"primary",icon:"download",onClick:ve,flat:"",disable:!u.value},null,8,["disable"]),o(S,{spaced:"",inset:"",vertical:"",dark:""}),o(ae,{class:"col",modelValue:u.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>u.value=l),K],options:R.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),o(S,{spaced:"",inset:"",vertical:"",dark:""}),(i(!0),y(L,null,I(v.value,(l,n)=>(i(),y("div",{key:n,class:"col"},[O("div",xe,[o(ae,{class:"col",modelValue:l.selected,"onUpdate:modelValue":[r=>l.selected=r,r=>ue(r,n)],options:l.options,label:`Nivel ${n+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",disable:n==J.value},null,8,["modelValue","onUpdate:modelValue","options","label","disable"]),o(S,{spaced:"",inset:"",vertical:"",dark:""})])]))),128)),O("div",Ce,[o(V,{icon:"add",flat:"",onClick:re,disable:!u.value},null,8,["disable"])])])):D("",!0),o(S,{spaced:"",inset:"",vertical:"",dark:""}),o(F,{rows:Q.value,columns:G.value.columns},{body:s(l=>[o(z,{props:l},{default:s(()=>[(i(!0),y(L,null,I(l.cols,n=>(i(),x($,{key:n.name,props:l},{default:s(()=>[C(A(n.value),1)]),_:2},1032,["props"]))),128)),o($,{"auto-width":""},{default:s(()=>[o(V,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:n=>de(l.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),o(se,{modelValue:a.value.state,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.state=l),persistent:""},{default:s(()=>[o(W,null,{default:s(()=>[o(h,{class:"text-center"},{default:s(()=>[e[8]||(e[8]=C(" NUEVA SECCION EN ALMACEN ")),O("span",Se,A(a.value.val.name.toUpperCase()),1)]),_:1}),o(h,{class:"row"},{default:s(()=>[o(q,{class:"col",modelValue:a.value.create.name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.create.name=l),type:"text",label:"Name",filled:"",dense:""},null,8,["modelValue"]),o(S,{spaced:"",inset:"",vertical:"",dark:""}),o(q,{class:"col",modelValue:a.value.create.alias,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.create.alias=l),type:"text",label:"Alias",filled:"",dense:""},null,8,["modelValue"]),o(S,{spaced:"",inset:"",vertical:"",dark:""}),a.value.secuence?(i(),x(q,{key:0,class:"col",modelValue:a.value.create.elementos,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.create.elementos=l),type:"Number",label:"Elementos",filled:"",dense:""},null,8,["modelValue"])):D("",!0)]),_:1}),o(h,null,{default:s(()=>[o(te,{modelValue:a.value.secuence,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.secuence=l),val:!1,label:"No Usar Secuencia"},null,8,["modelValue"]),o(te,{modelValue:a.value.secuence,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.secuence=l),val:!0,label:"Usar Secuencia"},null,8,["modelValue"])]),_:1}),a.value.create.name&&a.value.create.alias?(i(),x(h,{key:0},{default:s(()=>[o(F,{rows:a.value.defaultView},null,8,["rows"])]),_:1})):D("",!0),o(oe,{align:"right"},{default:s(()=>[j(o(V,{flat:"",label:"Cancelar",color:"negative"},null,512),[[ne]]),o(V,{flat:"",label:"Crear",color:"positive",onClick:ce,disable:!a.value.create.name||!a.value.create.alias},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(se,{modelValue:m.value.state,"onUpdate:modelValue":e[7]||(e[7]=l=>m.value.state=l),persistent:""},{default:s(()=>[o(W,null,{default:s(()=>[o(h,{class:"text-center text-bold text-h5"},{default:s(()=>e[9]||(e[9]=[C(" ELIMINAR SECCION ? ")])),_:1}),o(h,{class:"text-center text-bold text-h6"},{default:s(()=>[C(A(m.value.val.name),1)]),_:1}),o(h,{class:"text-left text-bold"},{default:s(()=>e[10]||(e[10]=[C(" Recuerda que se eliminaran tambien todos los hijos de la seccion ")])),_:1}),o(h,null,{default:s(()=>[o(F,{rows:m.value.val.pivot,columns:G.value.columns},{body:s(l=>[o(z,{props:l},{default:s(()=>[(i(!0),y(L,null,I(l.cols,n=>(i(),x($,{key:n.name,props:l},{default:s(()=>[C(A(n.value),1)]),_:2},1032,["props"]))),128)),l.row.pivot.length>0?(i(),x($,{key:0,"auto-width":""},{default:s(()=>[o(V,{size:"sm",color:"accent",round:"",dense:"",onClick:n=>l.expand=!l.expand,icon:l.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024)):D("",!0)]),_:2},1032,["props"]),j(o(z,{props:l},{default:s(()=>[o($,{colspan:"100%"},{default:s(()=>[(i(!0),y(L,null,I(l.row.pivot,(n,r)=>(i(),y("div",{class:"text-left",key:r},A(n.name),1))),128))]),_:2},1024)]),_:2},1032,["props"]),[[ge,l.expand]])]),_:1},8,["rows","columns"])]),_:1}),o(oe,{align:"right"},{default:s(()=>[j(o(V,{flat:"",label:"Cancelar"},null,512),[[ne]]),o(V,{flat:"",label:"Eliminar",color:"negative",onClick:me})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{sl as default};
