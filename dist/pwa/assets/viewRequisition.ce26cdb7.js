import{Q as I}from"./QInput.b3a5670a.js";import{Q as L}from"./QSeparator.799f4ab8.js";import{r as _,c as V,x as j,v as z,o as u,g as b,e,w as t,a1 as h,u as G,aD as H,i as J,f as Q,a as C,h as N,Q as k,a3 as n,a0 as R,a2 as K,a4 as f}from"./index.d494b13b.js";import{Q as x,a as r}from"./QItemSection.bf4a904b.js";import{Q as B}from"./QList.cdd96451.js";import{Q as W}from"./QPage.b99e3c0d.js";import{u as X,Q as Y,a as U}from"./use-quasar.9f1f2a9c.js";import{Q as Z}from"./QCardActions.8f9c87fb.js";import{Q as ee}from"./QDialog.6ace5f50.js";import{C as te}from"./ClosePopup.a64c36aa.js";import{u as ae}from"./VDB.1e014727.js";import{u as oe,r as $}from"./requisitionApi.a298e345.js";import{i as se}from"./resoursesApi.c5ff686c.js";import"./use-key-composition.720c71eb.js";import"./uid.42677368.js";import"./axios.30672b3a.js";import"./axios.f1f32898.js";const le={class:"row"},he={__name:"viewRequisition",setup(ne){const d=ae(),m=X(),S=G(),O=H(),p=_(!1),i=oe(),y=O.params.oid,c=_(null),g=_([]),v=_(""),w=V(()=>v.value.length<=0?g.value:g.value.filter(a=>a.description.toLowerCase().includes(v.value.toLowerCase()))),D=V(()=>w.value.some(a=>a.amount>0)),P=V(()=>w.value.filter(a=>a.amount>0)),T=async()=>{m.loading.show({message:"Obteniendo Datos"});const a=await $.getRequisition(d.session.store.id,y);a.status!==200?console.log(a):(m.loading.hide(),console.log(a),c.value=a.data,A(),i.setTitle(`${a.data.notes||y}`),i.setShowCreateButton(!1),i.setShowOrders(!1))},A=async()=>{const a=await se.getAssortmentInsumos();a.error?console.log(a):(console.log(a),g.value=a,c.value.bodie.length>0&&g.value.forEach(o=>{const s=c.value.bodie.find(l=>l.code===o.code);console.log(s),s?o.amount=s.amount:o.amount=0}))},E=async()=>{m.loading.show({message:"Cerrando Pedido"});let a={id:y,products:P.value};const o=await $.finishRequisition(a);o.status!=200?console.log(o):(S.push("/assortment"),m.loading.hide())};return j(()=>{d.session.rol=="aux"||d.session.rol=="gen"||d.session.rol=="aud"||d.session.rol=="root"?T():(m.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),S.replace("/"))}),z(()=>{i.setTitle("Pedidos Insumos"),i.setShowCreateButton(!0),i.setShowOrders(!0)}),(a,o)=>(u(),b(h,null,[e(W,{padding:""},{default:t(()=>{var s;return[J("div",le,[e(I,{class:"col",modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=l=>v.value=l),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),Q(D)?(u(),C(L,{key:0,spaced:"",inset:"",vertical:"",dark:""})):N("",!0),Q(D)?(u(),C(k,{key:1,color:"primary",flat:"",dense:"",icon:"send",onClick:o[1]||(o[1]=l=>p.value=!p.value),disable:((s=c.value)==null?void 0:s._status)>1},null,8,["disable"])):N("",!0)]),e(L,{spaced:"",inset:"",vertical:"",dark:""}),e(B,null,{default:t(()=>[e(x,null,{default:t(()=>[e(r,null,{default:t(()=>[n("Codigo")]),_:1}),e(r,null,{default:t(()=>[n("Descripcion")]),_:1}),e(r,null,{default:t(()=>[n("Cantidad")]),_:1})]),_:1})]),_:1}),(u(!0),b(h,null,R(Q(w),(l,F)=>(u(),C(B,{bordered:"",key:F},{default:t(()=>[e(x,null,{default:t(()=>[e(r,null,{default:t(()=>[n(f(l.code),1)]),_:2},1024),e(r,null,{default:t(()=>[n(f(l.description),1)]),_:2},1024),e(r,null,{default:t(()=>{var q;return[e(I,{modelValue:l.amount,"onUpdate:modelValue":M=>l.amount=M,type:"number",filled:"",disable:((q=c.value)==null?void 0:q._status)>1},null,8,["modelValue","onUpdate:modelValue","disable"])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1}),e(ee,{modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=s=>p.value=s),persistent:""},{default:t(()=>[e(Y,{style:{width:"500px"}},{default:t(()=>[e(U,{class:"text-bold text-h6 text-center"},{default:t(()=>[n(" Se Creara Pedido ")]),_:1}),e(U,null,{default:t(()=>[(u(!0),b(h,null,R(Q(P),(s,l)=>(u(),C(B,{key:l,bordered:""},{default:t(()=>[e(x,null,{default:t(()=>[e(r,null,{default:t(()=>[n(f(s.code),1)]),_:2},1024),e(r,null,{default:t(()=>[n(f(s.description),1)]),_:2},1024),e(r,null,{default:t(()=>[n(f(s.amount),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(Z,{align:"right"},{default:t(()=>[K(e(k,{flat:"",label:"Cancel",color:"primary"},null,512),[[te]]),e(k,{flat:"",label:"Crear",color:"primary",onClick:E})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{he as default};
