import{o as _}from"./orderApi.33051fec.js";const d=(a,o,p)=>{const m=o.category.familia.seccion.id,i=p.find(e=>e._category==m).rules;let l=0,t=0,c=0;if(!i)return!1;let n=a.filter(e=>e.id===o.id).reduce((e,s)=>e+Number(v(s.pivot,s.pieces)),0),f=a.filter(e=>e.category.familia.id===o.category.familia.id).reduce((e,s)=>e+Number(v(s.pivot,s.pieces)),0),r=a.filter(e=>e.category.familia.seccion.id===o.category.familia.seccion.id&&e.id!==o.id).reduce((e,s)=>e+Number(v(s.pivot,s.pieces)),0);a.findIndex(e=>e.id==o.id)>=0?(l=n,t=f,c=r):(l=n+Number(o.pivot.amountDelivered),t=f+Number(o.pivot.amountDelivered),c=r+Number(o.pivot.amountDelivered));for(const e of i)if(e._type===2&&(e.sameModel==1&&l>=e.min&&(!e.max||l<=e.max)||e.sameModel==0&&t>=e.min&&(!e.max||t<=e.max)||e.sameModel==0&&c>=e.min&&(!e.max||t<=e.max)&&e.family==0))return!0;return!1},u=(a,o,p)=>{const m=o.category.familia.seccion.id,i=p.find(e=>e._category==m).rules;let l=0,t=0,c=0;if(!i)return!1;let n=a.filter(e=>e.id===o.id).reduce((e,s)=>e+Number(v(s.pivot,s.pieces)),0),f=a.filter(e=>e.category.familia.id===o.category.familia.id).reduce((e,s)=>e+Number(v(s.pivot,s.pieces)),0),r=a.filter(e=>e.category.familia.seccion.id===o.category.familia.seccion.id&&e.id!==o.id).reduce((e,s)=>e+Number(v(s.pivot,s.pieces)),0);a.findIndex(e=>e.id==o.id)>=0?(l=n,t=f,c=r):(l=n+Number(o.pivot.amountDelivered),t=f+Number(o.pivot.amountDelivered),c=r+Number(o.pivot.amountDelivered));for(const e of i)if(e._type===3&&(e.sameModel==1&&l>=e.min&&(!e.max||l<=e.max)||e.sameModel==0&&t>=e.min&&(!e.max||t<=e.max)||e.sameModel==0&&c>=e.min&&(!e.max||t<=e.max)&&e.family==0))return!0;return!1},b=async(a,o,p)=>{const m=[];for(const i of a){const l=i.pivot._supply_by==3?i.pivot.amountDelivered*i.pieces:i.pivot._supply_by==2?i.pivot.amountDelivered*12:i.pivot.amountDelivered;let t=0;o.client._price_list<=3?l>=i.pieces&&(i.pivot._supply_by==1||i.pivot._supply_by==2)||i.pivot._supply_by==3?t=4:u(a,i,p)?t=3:d(a,i,p)?t=2:t=1:t=o.client._price_list;const c=i.prices.find(n=>n.id==t);if(c){const n=i.pivot.price,f=i.pivot._price_list,r=c.pivot.price;(n!==r||f!==t)&&(i.pivot._price_list=t,i.pivot.price=r,i.pivot.total=l*r,m.push({_order:i.pivot._order,_product:i.id,_price_list:t,price:r,total:l*r}))}}if(m.length>0){const i=await _.updateProductPrices(m);console.log(i),i.fail?console.error("Error al actualizar precios:",i):console.log("Precios actualizados correctamente")}},g=async(a,o,p)=>{const m=[];for(const i of a){const l=i.pivot._supply_by==3?i.pivot.amountDelivered*i.pieces:i.pivot._supply_by==2?i.pivot.amountDelivered*12:i.pivot.amountDelivered;let t=0;o<=3?l>=i.pieces&&(i.pivot._supply_by==1||i.pivot._supply_by==2)||i.pivot._supply_by==3?t=4:u(a,i,p)?t=3:d(a,i,p)?t=2:t=1:t=o;const c=i.prices.find(n=>n.id==t);if(c){const n=i.pivot.price,f=i.pivot._price_list,r=c.pivot.price;(n!==r||f!==t)&&(i.pivot._price_list=t,i.pivot.price=r,i.pivot.total=l*r,m.push({_product:i.id,_price_list:t,price:r,total:l*r}))}}},v=(a,o)=>a._supply_by==3?a.amountDelivered*o:a._supply_by==2?a.amountDelivered*12:a.amountDelivered;var D={verificarPrecioMayoreo:d,verificarPrecioDocena:u,actualizarPreciosProductos:b,actualizarPreciosProductosSales:g};export{D as R};
