import{Y,d as q,u as L,r as p,e as O,a as j,f as W,g as n,h as a,a3 as d,j as f,ag as _,l as C,m as T,Q as D,k as N,a5 as S,a0 as G,a4 as R,aW as h}from"./index.02fec612.js";import{Q as z}from"./QHeader.58f7d548.js";import{Q as A,d as K}from"./QSelect.4e4b152c.js";import{Q as X}from"./QToolbar.0d9deca6.js";import{Q as Z}from"./QDate.5e388333.js";import{Q as ll}from"./QTable.b77f1771.js";import{Q as el,a as al}from"./QLayout.64a719bd.js";import{Q as tl}from"./QForm.bc0f6903.js";import{C as ol}from"./ClosePopup.b90a3e10.js";import"./auto.c3952605.js";import{u as sl}from"./use-quasar.5cb75810.js";import"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.b5999051.js";import{_ as nl}from"./UserToolbar.cc29d536.js";import{A as il}from"./assistApi.9faed796.js";import{b as I,a as ul}from"./axios.a188c3a3.js";import"./QResizeObserver.a576a0e4.js";import"./QList.ec23182b.js";import"./use-render-cache.3aae9b27.js";import"./date.333feaf0.js";import"./QLinearProgress.33c83220.js";import"./QScrollObserver.7934ab8b.js";import"./_commonjsHelpers.88e99c8f.js";import"./QExpansionItem.267ef44c.js";import"./QDrawer.210381f4.js";import"./auth.622669d6.js";const dl={class:"col"},rl={class:"col"},vl={class:"row"},pl={class:"q-ml-sm"},Jl={__name:"AdvancesLYT",setup(ml){const r=sl();Y(),q(),L(),L();const u=p([]),b=p(null),m=p([]),o=p({val:null,state:!1}),v=p({val:null,opts:[]}),s=p({state:!1,val:null,body:null}),i=p({state:!1,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}),g=p([]),E=p(g.value),V=p({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODANT,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJANT,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"OBSERVACION",field:t=>t.OBSANT,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPANT).toFixed(2),align:"center",sortable:!0},{name:"client",label:"CLEINTE",field:t=>t.NOFCLI,align:"left",sortable:!0}]}),Q=O(()=>b.value&&!v.value.val?m.value.filter(t=>t.FECHA==b.value):!b.value&&v.value.val?m.value.filter(t=>t.CAJANT==v.value.val.CODTER):b.value&&v.value.val?m.value.filter(t=>t.FECHA==b.value&&t.CAJANT==v.value.val.CODTER):m.value),k=O(()=>{if(o.value){const t=m.value.find(e=>e.CODRET===o.value.val.CODRET);if(!t)return!1;let l={CAJANT:t.CAJANT,CODANT:t.CODANT,OBSANT:t.OBSANT,DESTER:t.DESTER,FECHA:t.FECHA,IMPANT:Number(t.IMPANT).toFixed(2),CLIENTE:{CLIANT:t.CLIANT,NOFCLI:t.NOFCLI}};return JSON.stringify(l)===JSON.stringify(o.value.val)}else return!0}),B=O(()=>!i.value.OBSANT||!i.value.DESTER||!i.value.IMPANT||!i.value.CLIENTE),U=async()=>{r.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const t=await il.index();t.error||(console.log(t),u.value.opts=t,r.loading.hide())},M=(t,l)=>{o.value.state=!o.value.state,console.log(l);let e={CAJANT:l.CAJANT,CODANT:l.CODANT,OBSANT:l.OBSANT,DESTER:l.DESTER,FECHA:l.FECHA,IMPANT:Number(l.IMPANT).toFixed(2),CLIENTE:{CLIANT:l.CLIANT,NOFCLI:l.NOFCLI}};o.value.val={...e}},P=async()=>{console.log(u.value.val.id);let t=u.value.val.id;console.log(t);try{let l=await ul.get(`/cashier/getPrinters/${t}`);l.status==200&&(s.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),r.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},H=async()=>{console.log(u.value.val.ip_address),r.loading.show({message:"Obteniendo Registros"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/getAdvances`;const e=await I.get(l);e.status!=200?console.log(e):(console.log(e.data),m.value=e.data.anticipos,v.value.opts=e.data.terminal,g.value=e.data.clientes,P(),r.loading.hide())},x=async()=>{console.log(u.value.val.ip_address);let t={print:s.value.val.ip_address,codant:o.value.val.CODANT};console.log(t),r.loading.show({message:"Imprimiendo Anticipo"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/printAdvance`;const c=await I.post(e,t);c.status!=200?console.log(c):(console.log(c.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide())},J=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),r.loading.show({message:"Modificando Anticipo"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/modifyAdvances`;const e=await I.post(l,o.value.val);if(e.status!=200)console.log(e);else{console.log(e.data);let c=m.value.findIndex(y=>y.CODANT==e.data.CODANT);c>=0&&(m.value[c]=e.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide()}},w=(t,l,e)=>{if(t===""){l(()=>{E.value=g.value});return}l(()=>{const c=t.toLowerCase();E.value=g.value.filter(y=>y.NOFCLI.toLowerCase().includes(c))})},$=async()=>{i.value.Print=s.value.val.ip_address,console.log(i.value),r.loading.show({message:"Agregando Anticipo"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/addAdvances`;const e=await I.post(l,i.value);e.status!=200?console.log(e):(console.log(e.data),m.value.push(e.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide(),F())},F=()=>{i.value={state:!1,CAJANT:null,CODANT:null,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}};return U(),(t,l)=>(j(),W(el,{view:"hHh Lpr fFf"},{default:n(()=>[a(z,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[a(nl),a(d)]),_:1}),a(al,{class:"q-ml-md"},{default:n(()=>[a(X,{class:"justify-between row"},{default:n(()=>[f("div",dl,[l[20]||(l[20]=f("span",{class:"text-grey"},"Helpers",-1)),a(_,{name:"navigate_next",color:"primary"}),l[21]||(l[21]=f("span",{class:"text-h6"},"Anticipos Sucursal",-1))]),f("div",rl,[f("div",vl,[l[22]||(l[22]=f("div",{class:"col"},null,-1)),a(A,{class:"col",modelValue:u.value.val,"onUpdate:modelValue":[l[0]||(l[0]=e=>u.value.val=e),H],options:u.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1}),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(ll,{rows:Q.value,filter:V.value.filter,columns:V.value.columns,onRowClick:M},{"top-right":n(()=>[a(C,{modelValue:V.value.filter,"onUpdate:modelValue":l[1]||(l[1]=e=>V.value.filter=e),type:"text",label:"Buscar",filled:"",dense:"",disable:!u.value.val},null,8,["modelValue","disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:v.value.val,"onUpdate:modelValue":l[2]||(l[2]=e=>v.value.val=e),options:v.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!u.value.val},null,8,["modelValue","options","disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"event",flat:"",round:"",disable:!u.value.val},{default:n(()=>[a(K,null,{default:n(()=>[a(Z,{modelValue:b.value,"onUpdate:modelValue":l[3]||(l[3]=e=>b.value=e),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"add",flat:"",onClick:l[4]||(l[4]=e=>i.value.state=!i.value.state),disable:!u.value.val},null,8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),a(S,{modelValue:s.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.state=e)},{default:n(()=>[a(D,{class:"my-card"},{default:n(()=>[a(N,null,{default:n(()=>l[23]||(l[23]=[f("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),a(N,null,{default:n(()=>[a(tl,{onSubmit:x,class:"q-gutter-md"},{default:n(()=>[a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),f("div",null,[a(T,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(S,{modelValue:o.value.state,"onUpdate:modelValue":l[13]||(l[13]=e=>o.value.state=e),persistent:""},{default:n(()=>[a(D,{style:{width:"300px"}},{default:n(()=>[a(N,{class:"text-bold text-center text-h5"},{default:n(()=>[f("span",pl,"Retirada "+G(o.value.val.CODRET),1)]),_:1}),a(N,null,{default:n(()=>[a(C,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.val.FECHA=e),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":l[8]||(l[8]=e=>o.value.val.DESTER=e),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:o.value.val.CLIENTE,"onUpdate:modelValue":l[9]||(l[9]=e=>o.value.val.CLIENTE=e),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:w},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.OBSANT,"onUpdate:modelValue":l[10]||(l[10]=e=>o.value.val.OBSANT=e),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.IMPANT,"onUpdate:modelValue":l[11]||(l[11]=e=>o.value.val.IMPANT=e),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[12]||(l[12]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(R,{align:"center"},{default:n(()=>[h(a(T,{flat:"",color:"negative",icon:"close"},null,512),[[ol]]),a(T,{flat:"",color:"primary",icon:"print",onClick:x,disable:!k.value||!s.value.val},null,8,["disable"]),a(T,{flat:"",color:"yellow",icon:"edit",disable:k.value||!s.value.val,onClick:J},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(S,{modelValue:i.value.state,"onUpdate:modelValue":l[19]||(l[19]=e=>i.value.state=e),persistent:""},{default:n(()=>[a(D,{style:{width:"300px"}},{default:n(()=>[a(N,{class:"text-bold text-center text-h5"}),a(N,null,{default:n(()=>[a(A,{modelValue:i.value.DESTER,"onUpdate:modelValue":l[14]||(l[14]=e=>i.value.DESTER=e),options:v.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:i.value.CLIENTE,"onUpdate:modelValue":l[15]||(l[15]=e=>i.value.CLIENTE=e),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:w,dense:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:i.value.OBSANT,"onUpdate:modelValue":l[16]||(l[16]=e=>i.value.OBSANT=e),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:i.value.IMPANT,"onUpdate:modelValue":l[17]||(l[17]=e=>i.value.IMPANT=e),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[18]||(l[18]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(R,{align:"center"},{default:n(()=>[a(T,{flat:"",color:"negative",icon:"close",onClick:F}),a(T,{flat:"",color:"positive",icon:"send",disable:B.value||!s.value.val,onClick:$},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Jl as default};
