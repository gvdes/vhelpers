import{Q as h}from"./QSeparator.0da96d64.js";import{r as m,c as T,o as D,a as R,w as i,e as o,i as _,a3 as w,Y as k,f as V,Q as b,a$ as j,a2 as x}from"./index.642169bd.js";import{Q as q}from"./QToolbar.5c8546e5.js";import{Q as F}from"./QHeader.8bbd71fd.js";import{Q as U}from"./QSelect.2a8720f3.js";import{Q as y}from"./QInput.22795150.js";import{Q as H}from"./QTable.a541453e.js";import{u as L,Q as M,a as S}from"./use-quasar.a74b8772.js";import{Q as A}from"./QCardActions.9bfde284.js";import{Q as I}from"./QDialog.7eee9b20.js";import{Q as K}from"./QPage.30688d7f.js";import{Q as O,a as Y}from"./QLayout.7a11c833.js";import{C as N}from"./ClosePopup.f233918e.js";import{u as E}from"./VDB.912a3d45.js";import{_ as X}from"./UserToolbar.0ac6fbac.js";import{v as Q}from"./axios.ae0a941c.js";import"./jspdf.plugin.autotable.1b92bfa6.js";import"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import"./QResizeObserver.8b8b3f3c.js";import"./use-key-composition.126922b2.js";import"./uid.42677368.js";import"./position-engine.4c297445.js";import"./rtl.b51694b1.js";import"./QList.fad28bc4.js";import"./QLinearProgress.96bfa47f.js";import"./QCheckbox.c07578de.js";import"./axios.f1f32898.js";import"./_commonjsHelpers.88e99c8f.js";var C={getSeccion(){return Q.get("/resources/getSeccion").then(n=>n.data).catch(n=>({fail:n}))},getProductsCompare(n,s){return Q.post(`/resources/getProductReport/${n}`,s).then(r=>r.data).catch(r=>({fail:r}))},create(n){return Q.post("/resources/create",n).then(s=>s.data).catch(s=>({fail:s}))}};const G=_("span",{class:"text-h6"},"Resurtido",-1),J=_("div",{class:"text-h6"},"Agrega una nota",-1),Se={__name:"RequisitionLYT",setup(n){const s=E(),r=L(),p=m({status:!1}),c=m({val:null,opts:[]}),g=m([]),u=m(null),f=m({columns:[{name:"short_code",label:"Codigo Corto",align:"left",sortable:!0,field:e=>e.name},{name:"codigo",label:"Codigo",align:"left",sortable:!0,field:e=>e.code},{name:"description",label:"Descripcion",align:"left",sortable:!0,field:e=>e.description},{name:"Seccion",label:"Seccion",align:"left",sortable:!0,field:e=>e.categories.familia.seccion.name},{name:"Familia",label:"Familia",align:"left",sortable:!0,field:e=>e.categories.familia.name},{name:"Categoria",label:"Categoria",align:"left",sortable:!0,field:e=>e.categories.name},{name:"pieces",label:"PXC",align:"center",sortable:!0,field:e=>e.pieces},{name:"cedis",label:"Cedis",align:"center",sortable:!0,field:e=>e.cedis},{name:"texcoco",label:"Texcoco",align:"center",sortable:!0,field:e=>e.texcoco},{name:"Sucursal",label:`${s.session.store.name}`,align:"center",sortable:!0,field:e=>e.sucursal},{name:"Percentge",label:`${s.session.store.name} % `,align:"center",sortable:!0,field:e=>e.percentage,format:(e,a)=>`${e}%`}],filter:""}),v=T(()=>g.value.map(e=>{let a=Math.round(Number(e.stocks.filter(l=>l.id==1).map(l=>l.pivot.stock))/Number(e.pieces)),t=Math.round(Number(e.stocks.filter(l=>l.id==2).map(l=>l.pivot.stock))/Number(e.pieces)),d=Number(e.stocks.filter(l=>l.id==s.session.store.id_viz).map(l=>l.pivot.stock)),z=Math.round(Number(e.stocks.filter(l=>l.id==s.session.store.id_viz).map(l=>l.pivot.stock))*100/Number(e.pieces));return{id:e.id,name:e.name,code:e.code,cost:e.cost,description:e.description,categories:e.categories,pieces:e.pieces,cedis:a,texcoco:t,sucursal:d,percentage:z}}).filter(e=>e.cedis+e.texcoco>0&&e.percentage<=20)),P=async()=>{r.loading.show({message:"Obteniendo secciones"});const e=await C.getSeccion();e.fail?console.log(e):(console.log(e),c.value.opts=e,r.loading.hide()),console.log(e)},$=async()=>{if(c.value.val){r.loading.show({message:"Obteniendo Reporte"}),console.log(c.value.val.map(d=>d.id));let e=s.session.store.id_viz,a=c.value.val.map(d=>d.id);const t=await C.getProductsCompare(e,{data:a});t.fail?console.log(t):(r.loading.hide(),console.log(t),g.value=t)}},B=async()=>{r.loading.show({message:"Creando Pedido"});let e={workpoint_from:s.session.store.id_viz,workpoint_to:1,products:v.value,notes:u.value,id_userviz:s.session.id,type:2};console.log(e);const a=await C.create(e);a.fail?console.log(a):(console.log(a),r.notify({message:`Se creo el pedido ${a.order.id}`,type:"positive",position:"center"}),g.value=[],u.value=[],c.value.val=null,r.loading.hide())};return P(),(e,a)=>(D(),R(O,{view:"hHh Lpr fFf"},{default:i(()=>[o(F,{class:"transparent text-dark",bordered:""},{default:i(()=>[o(X),o(h),o(q,{class:"justify-between"},{default:i(()=>[_("div",null,[w("Helpers "),o(k,{name:"navigate_next",color:"primary"}),w(),G])]),_:1})]),_:1}),o(Y,null,{default:i(()=>[o(K,{padding:""},{default:i(()=>[o(U,{modelValue:c.value.val,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value.val=t),options:c.value.opts,label:"Familia","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:$},null,8,["modelValue","options"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(H,{rows:V(v),columns:f.value.columns,separator:"cell",filter:f.value.filter},{"top-right":i(()=>[o(y,{borderless:"",dense:"",debounce:"300",modelValue:f.value.filter,"onUpdate:modelValue":a[1]||(a[1]=t=>f.value.filter=t),placeholder:"Buscar"},{append:i(()=>[o(k,{name:"search"})]),_:1},8,["modelValue"]),o(b,{color:"primary","icon-right":"send",flat:"",onClick:a[2]||(a[2]=t=>p.value.state=!p.value.state),disable:V(v).length==0},null,8,["disable"])]),_:1},8,["rows","columns","filter"]),o(I,{modelValue:p.value.state,"onUpdate:modelValue":a[6]||(a[6]=t=>p.value.state=t),persistent:""},{default:i(()=>[o(M,{style:{"min-width":"350px"}},{default:i(()=>[o(S,null,{default:i(()=>[J]),_:1}),o(S,{class:"q-pt-none"},{default:i(()=>[o(y,{dense:"",modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=t=>u.value=t),autofocus:"",onKeyup:a[4]||(a[4]=j(t=>e.prompt=!1,["enter"]))},null,8,["modelValue"])]),_:1}),o(A,{align:"right",class:"text-primary"},{default:i(()=>[x(o(b,{flat:"",label:"Cancelar",onClick:a[5]||(a[5]=t=>u.value=null)},null,512),[[N]]),x(o(b,{flat:"",label:"Enviar Pedido",onClick:B},null,512),[[N]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Se as default};
