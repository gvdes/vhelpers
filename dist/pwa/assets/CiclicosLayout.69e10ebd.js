import{b as w,Q as ee}from"./QList.875d447f.js";import{Q as de}from"./QHeader.843c4fd7.js";import{i as ue,c as G,j as fe,k as me,t as pe,r as Q,o as f,g as z,a3 as O,a2 as _,e,f as b,Q as V,aW as oe,a as te,u as le,w as l,al as U,a0 as j,a1 as $,d as C,h as x,a4 as ge,p as ve,l as be,m as ye,aX as Ce,S as ke}from"./index.1c6f5d21.js";import{Q as we}from"./QDate.79cb4ac0.js";import{Q as N}from"./QCardSection.5a84e60b.js";import{Q as ne}from"./QCardActions.01a2b0e6.js";import{Q as D}from"./QCard.4d57a8f5.js";import{Q as q,d as xe}from"./QSelect.095de556.js";import{Q as Qe}from"./QToolbar.cf281078.js";import{Q as Ve}from"./QSpace.92d8e1cf.js";import{Q as A}from"./QTooltip.c3a874e1.js";import{i as he,j as Se}from"./use-key-composition.311bc1ab.js";import{Q as Ue,a as $e}from"./QLayout.03012b8e.js";import{u as se}from"./use-quasar.42bf31c1.js";import{d as ie}from"./dayjs.min.cbcf888d.js";import{_ as De}from"./UserToolbar.c9596ae1.js";import{C as L}from"./cicsdb.fc967026.js";import{Q as X}from"./QInput.8e1299ab.js";import{Q as R,a as J}from"./QTable.9de01b8d.js";import{Q as Pe}from"./QExpansionItem.ffdd1d75.js";import{Q as K}from"./QTr.78cddc1a.js";import{Q as Z}from"./QTd.9284f088.js";import{Q as Be}from"./QFooter.5ffb790d.js";import{C as ze}from"./ClosePopup.982faf76.js";import{P as Ne}from"./ProductsAutocomplete.b5fdeb7e.js";import{c as ae}from"./cyclecountStore.a49d8892.js";import"./axios.85ee1ba6.js";import"./QDrawer.f42fd4ba.js";import"./QPage.e7768b42.js";import"./OrderStore.eae16013.js";import{$sktCounters as v}from"./socket.41f46bf6.js";import"./QResizeObserver.200a1b24.js";import"./use-render-cache.3aae9b27.js";import"./date.af14f82c.js";import"./QScrollObserver.8980f08e.js";import"./_commonjsHelpers.88e99c8f.js";import"./auth.e2f8320e.js";import"./QLinearProgress.cbf9159f.js";import"./QCheckbox.42627ef1.js";import"./use-checkbox.7afb08cb.js";/* empty css                                                                         */var je=ue({name:"QBar",props:{...he,dense:Boolean},setup(i,{slots:P}){const{proxy:{$q:d}}=pe(),h=Se(i,d),g=G(()=>`q-bar row no-wrap items-center q-bar--${i.dense===!0?"dense":"standard"}  q-bar--${h.value===!0?"dark":"light"}`);return()=>fe("div",{class:g.value,role:"toolbar"},me(P.default))}});const qe={class:"text-right"},Le={__name:"Locations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(i,{emit:P}){const d=i,h=P,g=u=>d.sections.filter(p=>p.root===u),r=Q([{options:d.sections.filter(u=>u.root===0),selected:null}]),y=(u,p)=>{const k=u[u.length-1];r.value.splice(p+1);const S=g(k);S.length&&r.value.push({options:S,selected:[]})},a=()=>{const u=r.value.filter(k=>k.selected.length>0),p=u[u.length-1];h("obtProducts",p)};return(u,p)=>(f(),z("div",null,[(f(!0),z(O,null,_(r.value,(k,S)=>(f(),z("div",{key:S},[e(q,{class:"col",modelValue:k.selected,"onUpdate:modelValue":[B=>k.selected=B,B=>y(B,S)],options:k.options,label:`Nivel ${S+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",multiple:"","use-chips":""},null,8,["modelValue","onUpdate:modelValue","options","label"]),e(w,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),b("div",qe,[e(V,{flat:"",icon:"send",disable:!r.value[0].selected,onClick:a},null,8,["disable"])])]))}},Me={class:"col"},Ee={class:"text-bold"},Te={class:"text-bold"},Fe={class:"row"},Ie={class:"col"},Oe={class:"col"},Ye={key:0,class:"row"},Ae={__name:"Create",props:{config:{default:{},type:Object}},emits:["create"],setup(i,{emit:P}){const d=se();oe(),te();const h=le(),g=ae(),r=Q(null),y=P,a=i,u=Q({team:!1,selectSection:!1}),p=Q({columns:[{name:"name",label:"Nombre",field:s=>{var o;return(o=s.staff)==null?void 0:o.complete_name},align:"left"}],filter:null}),k=Q({columns:[{name:"code",label:"Codigo",field:s=>s.code,align:"left"},{name:"description",label:"Descripcion",field:s=>s.description,align:"left"},{name:"locationExh",label:"Exhibicion",field:s=>{var o,t;return(t=(o=s.locations)==null?void 0:o.filter(m=>m.celler._type==2))==null?void 0:t.map(m=>m.path).join("/")},align:"left"},{name:"locationGen",label:"General",field:s=>{var o,t;return(t=(o=s.locations)==null?void 0:o.filter(m=>m.celler._type==1))==null?void 0:t.map(m=>m.path).join("/")},align:"left"}],filter:null}),S=G(()=>a.config.type.val&&a.config.option.val&&a.config.notes&&a.config.resexh.length>0&&a.config.resgen.length>0&&a.config.products.length>0),B=(s,o)=>{const t=o.toUpperCase();return s.filter(m=>{var H,W;const ce=Object.values(m).some(Y=>String(Y!=null?Y:"").toUpperCase().includes(t)),re=(W=(H=m.staff)==null?void 0:H.complete_name.toUpperCase().includes(t))!=null?W:!1;return ce||re})},M=s=>{(s.id==1||s.id==2)&&(u.value.selectSection=!0)},E=s=>{console.log(s),a.config.products.findIndex(t=>t.id==s.id)>=0?d.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):a.config.products.push(s)},T=s=>{console.log(s),a.config.products.findIndex(t=>t.id==s.id)>=0?d.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):a.config.products.push(s)},F=async()=>{if(a.config.option.val.id==2){d.loading.show({message:"Obteniendo Datos"});let s={workpoint:h.session.store.id_viz,seccion:a.config.section.id};console.log(s);const o=await L.obtProductSLocation(s);o.fail?console.log(o):(console.log(o),a.config.products=o,d.loading.hide())}},I=async s=>{d.loading.show({message:"Obteniendo Productos"});let o={ubicacion:s.selected,workpoint:h.session.store.id_viz,seccion:a.config.section.id};console.log(o);const t=await L.obtProductSections(o);t.fail?console.log(t):(console.log(t),a.config.products=t,d.loading.hide())},c=s=>{console.log(s);let o=a.config.products.findIndex(t=>t.id==s.id);o>=0&&a.config.products.splice(o,1)},n=()=>{S.value?y("create"):(a.config.type.val||d.notify({message:"Falta un tipo",type:"warning",position:"left"}),a.config.option.val||d.notify({message:"Falta una opci\xF3n",type:"warning",position:"left"}),a.config.notes||d.notify({message:"Faltan notas",type:"warning",position:"left"}),a.config.resexh.length===0&&d.notify({message:"Falta Responsable exhibici\xF3n",type:"warning",position:"left"}),a.config.resgen.length===0&&d.notify({message:"Falta Responsable general",type:"warning",position:"left"}),a.config.products.length===0&&d.notify({message:"Debe agregar productos",type:"warning",position:"left"}))};return(s,o)=>(f(),z(O,null,[e(D,null,{default:l(()=>[e(N,{class:"row items-center"},{default:l(()=>[b("div",Me,[o[10]||(o[10]=U(" Creacion: ")),b("span",Ee,j($(ie)().format("YYYY-MM-DD")),1),o[11]||(o[11]=U()),o[12]||(o[12]=b("br",null,null,-1)),o[13]||(o[13]=U(" Creador: ")),b("span",Te,j($(h).session.credentials.staff.complete_name),1)]),e(w,{spaced:"",inset:"",vertical:"",dark:""}),e(X,{modelValue:i.config.notes,"onUpdate:modelValue":o[0]||(o[0]=t=>i.config.notes=t),type:"text",label:"Notas"},null,8,["modelValue"]),e(w,{spaced:"",inset:"",vertical:"",dark:""}),e(q,{class:"",modelValue:i.config.type.val,"onUpdate:modelValue":o[1]||(o[1]=t=>i.config.type.val=t),options:i.config.type.opts,label:"Tipo",disable:""},null,8,["modelValue","options"]),e(w,{spaced:"",inset:"",vertical:"",dark:""}),e(q,{class:"col",modelValue:i.config.option.val,"onUpdate:modelValue":[o[2]||(o[2]=t=>i.config.option.val=t),M],options:i.config.option.opts,label:"Seleccion",disable:!!i.config.option.val},null,8,["modelValue","options","disable"])]),_:1})]),_:1}),e(D,{bordered:""},{default:l(()=>[e(N,null,{default:l(()=>[e(Pe,{"expand-separator":"",icon:"fas fa-users",label:"Responsables","header-class":"text-grey-5",modelValue:u.value.team,"onUpdate:modelValue":o[6]||(o[6]=t=>u.value.team=t),caption:`Exh: ${i.config.resexh.length} -- Gen ${i.config.resgen.length}`},{default:l(()=>[e(N,null,{default:l(()=>[e(X,{modelValue:p.value.filter,"onUpdate:modelValue":o[3]||(o[3]=t=>p.value.filter=t),type:"text",label:"Buscar"},null,8,["modelValue"]),e(w,{spaced:"",inset:"",vertical:"",dark:""}),b("div",Fe,[b("div",Ie,[e(R,{selection:"multiple",selected:i.config.resexh,"onUpdate:selected":o[4]||(o[4]=t=>i.config.resexh=t),title:"Ventas",rows:$(g).users.filter(t=>[8,9].includes(t._rol)),columns:p.value.columns,filter:p.value.filter,"filter-method":B},null,8,["selected","rows","columns","filter"])]),e(w,{spaced:"",inset:"",vertical:"",dark:""}),b("div",Oe,[e(R,{selection:"multiple",selected:i.config.resgen,"onUpdate:selected":o[5]||(o[5]=t=>i.config.resgen=t),title:"Almacen",rows:$(g).users.filter(t=>[4,24].includes(t._rol)),columns:p.value.columns,filter:p.value.filter,"filter-method":B},null,8,["selected","rows","columns","filter"])])])]),_:1})]),_:1},8,["modelValue","caption"])]),_:1})]),_:1}),e(w,{spaced:"",inset:"",vertical:"",dark:""}),i.config.option.val?(f(),C(D,{key:0,class:"my-card q-ml-md q-mr-md",bordered:""},{default:l(()=>[i.config.option.val.id==1?(f(),z("div",Ye,[e(q,{class:"col",modelValue:r.value,"onUpdate:modelValue":o[7]||(o[7]=t=>r.value=t),options:$(g).locations,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),e(w,{spaced:"",inset:"",vertical:"",dark:""}),r.value?(f(),C(Le,{key:0,class:"col",sections:r.value.sections,onObtProducts:I},null,8,["sections"])):x("",!0)])):x("",!0)]),_:1})):x("",!0),e(w),i.config.products.length?(f(),C(D,{key:1,class:"my-card",bordered:""},{default:l(()=>[e(N,null,{default:l(()=>[e(R,{rows:i.config.products,columns:k.value.columns},{header:l(t=>[e(K,{props:t},{default:l(()=>[(f(!0),z(O,null,_(t.cols,m=>(f(),C(J,{key:m.name,props:t},{default:l(()=>[U(j(m.label),1)]),_:2},1032,["props"]))),128)),i.config.option.val.id==3?(f(),C(J,{key:0,"auto-width":""})):x("",!0)]),_:2},1032,["props"])]),body:l(t=>[e(K,{props:t},{default:l(()=>[(f(!0),z(O,null,_(t.cols,m=>(f(),C(Z,{key:m.name,props:t},{default:l(()=>[U(j(m.value),1)]),_:2},1032,["props"]))),128)),i.config.option.val.id==3?(f(),C(Z,{key:0,"auto-width":""},{default:l(()=>[e(V,{size:"sm",color:"negative",round:"",dense:"",onClick:m=>c(t.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)):x("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})):x("",!0),i.config.option.val?(f(),C(Be,{key:2},{default:l(()=>[i.config.option.val.id==3?(f(),C(D,{key:0,class:"row"},{default:l(()=>[e(Ne,{class:"col",checkState:!0,onInput:T,onAgregar:E,with_locations_loc:$(h).session.credentials._rol},null,8,["with_locations_loc"]),e(w,{spaced:"",inset:"",vertical:"",dark:""}),e(V,{color:"primary",icon:"send",onClick:n})]),_:1})):x("",!0),i.config.option.val.id!=3?(f(),C(D,{key:1},{default:l(()=>[e(V,{class:"full-width",color:"primary",label:"Crear Ciclico :p",onClick:n})]),_:1})):x("",!0)]),_:1})):x("",!0),e(ee,{modelValue:u.value.selectSection,"onUpdate:modelValue":o[9]||(o[9]=t=>u.value.selectSection=t),persistent:""},{default:l(()=>[e(D,{style:{"min-width":"350px"}},{default:l(()=>[e(N,null,{default:l(()=>o[14]||(o[14]=[b("div",{class:"text-h6"},"Selecciona una Seccion",-1)])),_:1}),e(N,{class:"q-pt-none"},{default:l(()=>[e(q,{modelValue:i.config.section,"onUpdate:modelValue":o[8]||(o[8]=t=>i.config.section=t),options:$(g).sections,label:"Seccion",filled:"","option-label":"name"},null,8,["modelValue","options"])]),_:1}),e(ne,{align:"right",class:"text-primary"},{default:l(()=>[ge(e(V,{flat:"",onClick:F,icon:"send"},null,512),[[ze]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Re={class:"text-h6"},_e={key:0,class:"row items-center"},qo={__name:"CiclicosLayout",setup(i){const P=Q(""),d=se();oe();const h=te(),g=le(),r=ae();Q({state:!1,data:null}),Q(null),Q([]);const y=Q({state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}),a=Q(!0),u=Q({from:null,to:null});G(()=>P.value&&P.value.length);const p=async()=>{d.loading.show({message:"Cargado vista..."});let c=ie(new Date).format("YYYY/MM/DD");u.value={from:c,to:c};let n={store:g.session.store.id_viz,suc:g.session.store.id,date:u.value};const s=await L.index(n);s.fail?console.log(s):(console.log(s),r.setCyclecount(s.inventories),r.setUsers(s.colab),r.setSections(s.secciones),r.setLocations(s.locations),d.loading.hide())},k=()=>{y.value={state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}},S=async()=>{console.log(y.value),d.loading.show({message:"Creando Ciclicos"}),y.value._account=g.session.credentials.staff.id_va,y.value._workpoint=g.session.store.id_viz;const c=await L.addCyclecount(y.value);c.fail?console.log(c):(console.log(c),c.success&&(c.data.forEach(n=>r.addCyclecount(n.counter)),d.loading.hide(),k()))},B=async()=>{d.loading.show({message:"Obteniendo Datos..."});let c={store:g.session.store.id_viz,suc:g.session.store.id,date:u.value};const n=await L.index(c);n.fail?console.log(n):(console.log(n),r.setCyclecount(n.inventories),r.setUsers(n.colab),r.setSections(n.secciones),r.setLocations(n.locations),d.loading.hide())},M=c=>{console.log(c),d.notify({message:`El usuario ${c.me.names} Se Unio :)`,type:"positive",position:"top"})},E=c=>{console.log(c),r.lock(c.product.id,c)},T=c=>{console.log(c),r.unlock(c.product.id)},F=c=>{console.log(c),r.updateLockedProduct(c.product)},I=c=>{r.updateCyclecounts(c.counter),d.notify({message:`Termino el conteo ${c.user.me.names}`}),h.push("/ciclicos/counted")};return ve(()=>{p(),v.on("connect",()=>{r.socket_user&&v.emit("index",r.socket_user.profile)}),v.connect(),be(()=>r.socket_user.profile,c=>{c&&v.connected&&v.emit("index",c)},{immediate:!0}),v.on("joined",M),v.on("counting",E),v.on("cancelcounting",T),v.on("countingconfirmed",F),v.on("endingCounting",I)}),ye(()=>{v.off("joined",M),v.off("counting",E),v.off("cancelcounting",T),v.off("countingconfirmed",F),v.off("endingCounting",I)}),p(),(c,n)=>{const s=Ce("router-view");return f(),C(Ue,{view:"hHh Lpr fFf"},{default:l(()=>[e(de,{class:"bg-grey-3 text-dark",bordered:""},{default:l(()=>[e(De),e(w)]),_:1}),e($e,null,{default:l(()=>[e(Qe,{class:"justify-between"},{default:l(()=>[b("div",null,[n[5]||(n[5]=b("span",{class:"text-grey"},"Helpers",-1)),n[6]||(n[6]=U()),e(ke,{name:"navigate_next",color:"primary"}),n[7]||(n[7]=U()),b("span",Re,j($(r).title),1)]),$(r).showBtns?(f(),z("div",_e,[e(V,{color:"primary",icon:"event",flat:""},{default:l(()=>[e(xe,null,{default:l(()=>[e(D,{class:"my-card"},{default:l(()=>[e(N,null,{default:l(()=>[b("div",null,[n[8]||(n[8]=b("div",{class:"q-pb-sm text-center"},null,-1)),e(we,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=o=>u.value=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(ne,{vertical:"",align:"center"},{default:l(()=>[e(V,{flat:"",label:"Obtener",color:"positive",onClick:B})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{spaced:"",inset:"",vertical:"",dark:""}),e(V,{color:"primary",icon:"add",outline:"",onClick:n[1]||(n[1]=o=>y.value.state=!y.value.state)})])):x("",!0)]),_:1}),e(ee,{modelValue:y.value.state,"onUpdate:modelValue":n[4]||(n[4]=o=>y.value.state=o),persistent:"",maximized:a.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:l(()=>[e(D,null,{default:l(()=>[e(je,null,{default:l(()=>[n[12]||(n[12]=b("div",{class:"text-center text-h6"},"Nuevo Inventario",-1)),e(Ve),e(V,{dense:"",flat:"",icon:"minimize",onClick:n[2]||(n[2]=o=>a.value=!1),disable:!a.value},{default:l(()=>[a.value?(f(),C(A,{key:0},{default:l(()=>n[9]||(n[9]=[U("Minimize")])),_:1})):x("",!0)]),_:1},8,["disable"]),e(V,{dense:"",flat:"",icon:"crop_square",onClick:n[3]||(n[3]=o=>a.value=!0),disable:a.value},{default:l(()=>[a.value?x("",!0):(f(),C(A,{key:0},{default:l(()=>n[10]||(n[10]=[U("Maximize")])),_:1}))]),_:1},8,["disable"]),e(V,{dense:"",flat:"",icon:"close",onClick:k},{default:l(()=>[e(A,null,{default:l(()=>n[11]||(n[11]=[U("Close")])),_:1})]),_:1})]),_:1}),e(Ae,{config:y.value,onCreate:S},null,8,["config"])]),_:1})]),_:1},8,["modelValue","maximized"]),e(s)]),_:1})]),_:1})}}};export{qo as default};
