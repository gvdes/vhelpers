import{u as be,r as c,c as H,J as he,o as m,d as T,w as i,e as t,f,j as g,ab as A,k as I,i as C,_ as ke,Z as we,g as j,Q as z,ad as F,W as ye,$ as W,a0 as J,Y as K}from"./index.02e98f23.js";import{Q as B}from"./QSelect.53941b07.js";import{Q as N}from"./QTable.6c1ae328.js";import{Q as Ce}from"./QPage.2e793c9e.js";import{C as q}from"./ClosePopup.5123f35e.js";import"./QList.87ca2251.js";import"./QExpansionItem.3c424fa7.js";import"./QDrawer.eb1e7cb5.js";import"./axios.87cc1b88.js";import{u as _e}from"./use-quasar.dc53eb3e.js";import{u as Ve}from"./warehousStore.88dc7a83.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.81876de4.js";import{E as X}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as L}from"./locationsApi.d7ef396b.js";import"./QLinearProgress.aa0b5254.js";import"./QResizeObserver.04e1b2fd.js";import"./QScrollObserver.beba53c5.js";import"./_commonjsHelpers.88e99c8f.js";const xe={key:0},Ee={key:1},De={key:0},Se={key:0,class:"row"},Ue={key:1},Ae={key:0},Ie={class:"text-left"},Be={key:2},al={__name:"massive",setup(Le){const k=be(),r=_e();Ve().setTitle("Acciones Masivas");const $=c([]),s=c({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),O=c(null),Y=c(null),Z=c(null),ae=c([]),Q=c([]),te=c(0),P=c(null),D=c({val:[],status:!1}),S=c({val:[],status:!1}),_=c({val:null,types:[{id:1,label:"CREAR"},{id:2,label:"ELIMINAR"}]}),U=c({val:null,opts:[{id:1,label:"CATEGORIAS"},{id:2,label:"UBICACION"},{id:3,label:"EXCEL"}]}),V=c({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),M=c({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),ee=c({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"locations",label:"Ubicacion",field:l=>l.locations.map(e=>e.path).join("/"),align:"left"}]}),oe=H(()=>s.value.all.filter(l=>l.deep==0)),se=H(()=>s.value.seccion.val.length>0?s.value.all.filter(l=>l.deep==1&&s.value.seccion.val.map(e=>e.id).includes(l.root)):s.value.all.filter(l=>l.deep==1)),ie=H(()=>{if(s.value.seccion.val.length>0&&s.value.familias.val.length==0){let l=s.value.all.filter(e=>e.deep==1&&s.value.seccion.val.map(a=>a.id).includes(e.root)).map(e=>e.id);return s.value.all.filter(e=>e.deep==2&&l.includes(e.root))}else return s.value.familias.val.length>0?s.value.all.filter(l=>l.deep==2&&s.value.familias.val.map(e=>e.id).includes(l.root)):s.value.all.filter(l=>l.deep==2)}),ne=async()=>{r.loading.show({message:"Obteniendo Secciones"});const l=await L.getInit(k.session.store.id_viz);l.fail?console.log(l):(console.log(l),$.value=l.celler,s.value.all=l.categories),r.loading.hide()},de=()=>{const l=O.value.sections||[];te.value=Math.max(...l.map(e=>e.deep)),Q.value=[{options:l.filter(e=>e.root===0),selected:null}],ae.value=Q.value[0].options},le=l=>{var e;return((e=O.value.sections)==null?void 0:e.filter(a=>a.root===l))||[]},ue=(l,e)=>{Q.value.splice(e+1);const a=le(l);a.length>0&&Q.value.push({options:a,selected:null})},ce=async()=>{r.loading.show({message:"Obeniendo Productos"});let l={workpoint:k.session.store.id_viz,section:P.value.selected};const e=await L.obtProduct(l);e.fail?console.log(e):(console.log(e),D.value.status=!0,D.value.val=e,r.loading.hide())},re=async()=>{r.loading.show({message:"Eliminando Ubicaciones"});let l={products:D.value.val.map(a=>a.id),section:P.value.selected,id_viz:k.session.credentials.staff.id_va};console.log(l);const e=await L.deleteSectionProducts(l);e.fail?console.log(e):(console.log(e),D.value={val:[],status:!1},r.loading.hide())},ve=async()=>{var a,d,v;r.loading.show({message:"El reporte puede tardar unos minutos"});let l={workpoint:k.session.store.id_viz,sections:(a=s.value.seccion.val)==null?void 0:a.map(n=>n.id),familys:(d=s.value.familias.val)==null?void 0:d.map(n=>n.id),categories:(v=s.value.categories.val)==null?void 0:v.map(n=>n.id)};console.log(l);const e=await L.obtProductCategories(l);e.fail?console.log(e):(r.loading.hide(),console.log(e),S.value.status=!0,S.value.val=e)},pe=async()=>{r.loading.show({message:"Eliminando Ubicaciones"});let l={products:S.value.val.map(a=>({product:a.id,locations:a.locations.map(d=>d.id)})),id_viz:k.session.credentials.staff.id_va};const e=await L.deleteCategoriesLocations(l);e.fail?console.log(e):(console.log(e),console.log(e),S.value={val:[],status:!1},r.loading.hide())},me=()=>{var d;let l=(d=document.getElementById("refCreate"))==null?void 0:d.files[0],e=new X.Workbook,a={};r.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async v=>{let n=e.worksheets[0],b=n.getColumn("A");n.getColumn("B"),b.eachCell({includeEmpty:!0},function(w,x){if(x===1)return;let o=w.value,h=n.getCell(`B${x}`).value;!o||(a[o]||(a[o]=[]),a[o].includes(h)||a[o].push(h||cantidad))});let p=Object.keys(a).map(w=>({_product:w,_location:a[w],_workpoint:k.session.store.id_viz}));console.log(p);let R={products:p,id_viz:k.session.credentials.staff.id_va};const u=await L.addMassiveLocation(R);u.fail?console.log(u):(console.log(u),V.value.state=!0,V.value.val=u,r.loading.hide())})},fe=()=>{var d;let l=(d=document.getElementById("refDelete"))==null?void 0:d.files[0],e=new X.Workbook,a={};r.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async v=>{e.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(u,w){if(w===1)return;let x=u.value;!x||(a[x]=!0)});let p=Object.keys(a).map(u=>({_product:u,_workpoint:k.session.store.id_viz}));console.log(p);let R={products:p,id_viz:k.session.credentials.staff.id_va};if(p.length){const u=await L.deleteMassiveLocation(R);u.fail?console.log(u):(console.log(u),M.value.state=!0,M.value.val=u,r.loading.hide())}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ge=async()=>{const l=new X.Workbook;$.value.forEach((v,n)=>{var x;const b=l.addWorksheet(`${v.name}_${n}`),p=v.sections||[],R=Math.max(...p.map(o=>o.deep||1)),u=[];for(let o=0;o<=R;o++)u.push(`NOMBRE_${o}`,`PATH_${o}`,`ID_${o}`);b.addRow(u);const w=(o,h)=>{const y=Array(R*3).fill("");for(let E=0;E<h.length;E++)y[E]=h[E];y[o.deep*3]=o.name,y[o.deep*3+1]=o.path,y[o.deep*3+2]=o.id,b.addRow(y),p.filter(E=>E.root===o.id).forEach(E=>w(E,y))};p.filter(o=>o.deep===0).forEach(o=>w(o,[o.name,o.path,o.path])),(x=b.columns)==null||x.forEach(o=>{let h=0;o.eachCell({includeEmpty:!0},y=>{const G=y.value?y.value.toString().length:10;G>h&&(h=G)}),o.width=h<10?10:h})});const e=await l.xlsx.writeBuffer(),a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a");d.href=URL.createObjectURL(a),d.download="almacenes.xlsx",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return ne(),he(Q,l=>{const e=l.filter(a=>a.selected!==null);if(e.length){const a=e[e.length-1];le(a.selected),P.value=a}},{deep:!0}),(l,e)=>(m(),T(Ce,{padding:""},{default:i(()=>[t(z,{class:"my-card"},{default:i(()=>[t(f,{class:"row"},{default:i(()=>{var a,d;return[t(g,{icon:"download",flat:"",onClick:ge,title:"descargar Estructura"}),t(A,{spaced:"",inset:"",vertical:"",dark:""}),t(B,{dense:"",class:"col",modelValue:_.value.val,"onUpdate:modelValue":e[0]||(e[0]=v=>_.value.val=v),options:_.value.types,label:"Tipo",filled:""},null,8,["modelValue","options"]),((a=_.value.val)==null?void 0:a.id)==2?(m(),T(A,{key:0,spaced:"",inset:"",vertical:"",dark:""})):I("",!0),((d=_.value.val)==null?void 0:d.id)==2?(m(),T(B,{key:1,dense:"",class:"col",modelValue:U.value.val,"onUpdate:modelValue":e[1]||(e[1]=v=>U.value.val=v),options:U.value.opts,label:"MEDIO",filled:""},null,8,["modelValue","options"])):I("",!0)]}),_:1}),_.value.val?(m(),T(f,{key:0},{default:i(()=>{var a,d,v;return[_.value.val.id==1?(m(),C("div",xe,[t(g,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[2]||(e[2]=()=>Y.value.click())})])):_.value.val.id==2?(m(),C("div",Ee,[U.value.val?(m(),C("div",De,[((a=U.value.val)==null?void 0:a.id)==1?(m(),C("div",Se,[t(B,{class:"col",modelValue:s.value.seccion.val,"onUpdate:modelValue":e[3]||(e[3]=n=>s.value.seccion.val=n),options:oe.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),t(A,{spaced:"",inset:"",vertical:"",dark:""}),t(B,{class:"col",modelValue:s.value.familias.val,"onUpdate:modelValue":e[4]||(e[4]=n=>s.value.familias.val=n),options:se.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:s.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),t(A,{spaced:"",inset:"",vertical:"",dark:""}),t(B,{class:"col",modelValue:s.value.categories.val,"onUpdate:modelValue":e[5]||(e[5]=n=>s.value.categories.val=n),options:ie.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:s.value.seccion.val.length==0||s.value.familias.val.length==0},null,8,["modelValue","options","disable"]),t(A,{spaced:"",inset:"",vertical:"",dark:""}),t(g,{color:"primary",label:s.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:ve},null,8,["label"])])):((d=U.value.val)==null?void 0:d.id)==2?(m(),C("div",Ue,[$.value.length>0?(m(),C("div",Ae,[t(B,{modelValue:O.value,"onUpdate:modelValue":[e[6]||(e[6]=n=>O.value=n),de],options:$.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(A,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),C(ke,null,we(Q.value,(n,b)=>(m(),C("div",{key:b},[j("div",null,[t(B,{modelValue:n.selected,"onUpdate:modelValue":[p=>n.selected=p,p=>ue(p,b)],options:n.options,label:`Nivel ${b+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(A,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):I("",!0),j("div",Ie,[t(g,{icon:"delete",flat:"",onClick:ce,disable:!O.value},null,8,["disable"])])])):((v=U.value.val)==null?void 0:v.id)==3?(m(),C("div",Be,[t(g,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[7]||(e[7]=()=>Z.value.click())})])):I("",!0)])):I("",!0)])):I("",!0)]}),_:1})):I("",!0)]),_:1}),t(K,{modelValue:D.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>D.value.status=a),persistent:""},{default:i(()=>[t(z,null,{default:i(()=>[t(f,{class:"row items-center"},{default:i(()=>[F(" Vaciar Seccion "+ye(P.value.options.find(a=>a.id==P.value.selected).name),1)]),_:1}),t(f,null,{default:i(()=>[t(N,{title:"Productos",rows:D.value.val,columns:ee.value.columns},null,8,["rows","columns"])]),_:1}),t(W,{align:"right"},{default:i(()=>[J(t(g,{flat:"",label:"Cancel",color:"primary"},null,512),[[q]]),t(g,{flat:"",label:"Vaciar Seccion",color:"negative",onClick:re})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:S.value.status,"onUpdate:modelValue":e[9]||(e[9]=a=>S.value.status=a),persistent:""},{default:i(()=>[t(z,null,{default:i(()=>[t(f,{class:"row items-center"},{default:i(()=>e[12]||(e[12]=[F(" Eliminar Ubicaciones de los Articulos ")])),_:1}),t(f,null,{default:i(()=>[t(N,{title:"Productos",rows:S.value.val,columns:ee.value.columns},null,8,["rows","columns"])]),_:1}),t(W,{align:"right"},{default:i(()=>[J(t(g,{flat:"",label:"Cancel",color:"primary"},null,512),[[q]]),t(g,{flat:"",label:"Eliminar Ubicacion",color:"negative",onClick:pe})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:V.value.state,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value.state=a),persistent:""},{default:i(()=>[t(z,null,{default:i(()=>[t(f,{class:"text-bold text-center text-h6"},{default:i(()=>e[13]||(e[13]=[F(" Resultados de Importacion ")])),_:1}),t(f,null,{default:i(()=>[t(N,{rows:V.value.val.goals,columns:V.value.table.columns},null,8,["rows","columns"])]),_:1}),t(f,null,{default:i(()=>[t(N,{rows:V.value.val.fails,columns:V.value.table.columns},null,8,["rows","columns"])]),_:1}),t(W,{align:"right"},{default:i(()=>[J(t(g,{flat:"",label:"OK",color:"primary"},null,512),[[q]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:M.value.state,"onUpdate:modelValue":e[11]||(e[11]=a=>M.value.state=a),persistent:""},{default:i(()=>[t(z,null,{default:i(()=>[t(f,{class:"text-bold text-center text-h6"},{default:i(()=>e[14]||(e[14]=[F(" Resultados de Importacion Eliminado Masivo ")])),_:1}),t(f,null,{default:i(()=>[t(N,{rows:M.value.val},null,8,["rows"])]),_:1}),t(W,{align:"right"},{default:i(()=>[J(t(g,{flat:"",label:"OK",color:"primary"},null,512),[[q]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j("input",{type:"file",ref_key:"refCreate",ref:Y,id:"refCreate",onInput:me,hidden:"",accept:".xlsx,.xls"},null,544),j("input",{type:"file",ref_key:"refDelete",ref:Z,id:"refDelete",onInput:fe,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}))}};export{al as default};
