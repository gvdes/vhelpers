import{Q as B}from"./QToolbarTitle.073e306d.js";import{Q as X}from"./QToolbar.b986c5ac.js";import{b as h}from"./QList.d51622ed.js";import{Q as w}from"./QSelect.0eb8d7b3.js";import{u as F,r as y,c as S,o as I,d as _,w as g,e as o,al as D,Q as E}from"./index.f154296f.js";import{Q as L}from"./QCardSection.32a39c07.js";import{Q as M}from"./QCard.816dcfaf.js";import{Q as Y}from"./QTable.6467011c.js";import{Q as U}from"./QPage.cb0e752e.js";import{r as A}from"./reportApi.af0387b2.js";import{u as W}from"./use-quasar.cd130b71.js";import"./jspdf.plugin.autotable.8cb61bde.js";import{E as j}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as m}from"./dayjs.min.cbcf888d.js";import"./use-key-composition.d18df139.js";import"./QLinearProgress.63ff1b0b.js";import"./QCheckbox.3a8f695c.js";import"./use-checkbox.f22847e0.js";import"./axios.4219d86e.js";import"./_commonjsHelpers.88e99c8f.js";const ge={__name:"Warehouses",setup(q){F();const p=W(),f=y([]),l=y({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),k=y(!1),b=y([]),P=S(()=>({pagination:{rowsPerPage:10}})),Q=[{name:"code",label:"CODIGO",field:e=>e.code,align:"left"},{name:"description",label:"DESCRIPCION",field:e=>e.description,align:"left"},{name:"barcode",label:"CB",field:e=>e.barcode,align:"left"},{name:"section",label:"SECCION",field:e=>e.category.familia.seccion.name,align:"left"},{name:"family",label:"FAMILIA",field:e=>e.category.familia.name,align:"left"},{name:"category",label:"CATEGORIA",field:e=>e.category.name,align:"left"},{name:"mennav",label:"MEDNAV/PERS",field:e=>e.large,align:"left"},{name:"provider",label:"PROVEEDOR",field:e=>e.providers.name,align:"left"},{name:"maker",label:"FABRICANTE",field:e=>{var a;return(a=e.makers)==null?void 0:a.name},align:"left"},{name:"pxc",label:"PXC",field:e=>e.pieces,align:"center"},{name:"purchases",label:"COMPRAS",field:e=>e.PurchaseYear,align:"center"},{name:"purchasesPXC",label:"COMPRAS PXC",field:e=>Number(e.PurchaseYear/e.pieces).toFixed(2),align:"center"},{name:`sales${m().year()-1}`,label:`VENTAS ${m().year()-1}`,field:e=>e.SalesSubYear,align:"center"},{name:`sales${m().year()-1} PXC`,label:`VENTAS ${m().year()-1} PXC`,field:e=>Number(e.SalesSubYear/e.pieces).toFixed(2),align:"center"},{name:`sales${m().year()}`,label:`VENTAS ${m().year()}`,field:e=>e.SalesYear,align:"center"},{name:`sales${m().year()} PXC`,label:`VENTAS ${m().year()} PXC`,field:e=>Number(e.SalesYear/e.pieces).toFixed(2),align:"center"},{name:"stock",label:"STOCK",field:e=>e.SumStock,align:"center"},{name:"stock PXC",label:"STOCK PXC",field:e=>Number(e.SumStock/e.pieces).toFixed(2),align:"center"}],V=e=>{const a=[];e.forEach(n=>{n.stocks&&n.stocks.forEach(r=>{a.find(t=>t.id===r.id)||a.push(r)})});const i=a.map(n=>({name:`s_${n.alias}`,label:`${n.alias}`,field:r=>{var C;const t=(C=r.stocks)==null?void 0:C.find(d=>d.id===n.id);return t?t.pivot.stock:0},align:"center"}));return[...Q,...i]},x=S(()=>l.value.all.filter(e=>e.deep==0)),N=S(()=>l.value.seccion.val.length>0?l.value.all.filter(e=>e.deep==1&&l.value.seccion.val.map(a=>a.id).includes(e.root)):l.value.all.filter(e=>e.deep==1)),T=S(()=>{if(l.value.seccion.val.length>0&&l.value.familias.val.length==0){let e=l.value.all.filter(a=>a.deep==1&&l.value.seccion.val.map(i=>i.id).includes(a.root)).map(a=>a.id);return l.value.all.filter(a=>a.deep==2&&e.includes(a.root))}else return l.value.familias.val.length>0?l.value.all.filter(e=>e.deep==2&&l.value.familias.val.map(a=>a.id).includes(e.root)):l.value.all.filter(e=>e.deep==2)}),O=async()=>{p.loading.show({message:"Obteniendo Familias"});const e=await A.init();e.fail?(console.log(e),p.loading.hide()):(console.log(e),l.value.all=e,p.loading.hide())},R=async()=>{var i,n,r;p.loading.show({message:"El reporte puede tardar unos minutos"}),k.value=!0;let e={sections:(i=l.value.seccion.val)==null?void 0:i.map(t=>t.id),familys:(n=l.value.familias.val)==null?void 0:n.map(t=>t.id),categories:(r=l.value.categories.val)==null?void 0:r.map(t=>t.id)};console.log(e);const a=await A.reportWarehouses(e);a.fail?(console.log(a),p.notify({message:"No se pudo obtener el reporte comuniquese con soporte",type:"negative",position:"center"})):(console.log(a),b.value=a,f.value=V(b.value),k.value=!1,p.loading.hide())},$=async()=>{const e=new j.Workbook,a=e.addWorksheet("Almacenes"),i=f.value.map(s=>({header:s.label,key:s.name,width:15}));a.columns=i;const r=b.value.map(s=>{const c={};return f.value.forEach(u=>{let v;typeof u.field=="function"?v=u.field(s):v=s[u.field],c[u.name]=v}),c}).map(s=>f.value.map(c=>s[c.name]));a.addTable({name:"Almacenes",ref:"A1",headerRow:!0,style:{theme:"TableStyleMedium9",showRowStripes:!0},columns:f.value.map(s=>({name:s.label,filterButton:!0})),rows:r}),a.columns.forEach(s=>{let c=0;s.eachCell({includeEmpty:!0},u=>{const v=u.value?u.value.toString().length:10;v>c&&(c=v)}),s.width=c<10?10:c});const t=await e.xlsx.writeBuffer(),C=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a");d.href=URL.createObjectURL(C),d.download="almacenes.xlsx",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return O(),(e,a)=>(I(),_(U,{padding:""},{default:g(()=>[o(X,null,{default:g(()=>[o(B,null,{default:g(()=>a[3]||(a[3]=[D(" ALMACENES ")])),_:1})]),_:1}),o(h),o(M,{class:"my-card"},{default:g(()=>[o(L,{class:"row"},{default:g(()=>[o(w,{class:"col",modelValue:l.value.seccion.val,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value.seccion.val=i),options:x.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(w,{class:"col",modelValue:l.value.familias.val,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.familias.val=i),options:N.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:l.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(w,{class:"col",modelValue:l.value.categories.val,"onUpdate:modelValue":a[2]||(a[2]=i=>l.value.categories.val=i),options:T.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:l.value.seccion.val.length==0||l.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(E,{color:"primary",label:l.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:R},null,8,["label"])]),_:1})]),_:1}),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(Y,{rows:b.value,pagination:P.value.pagination,loading:k.value,columns:f.value},{"top-right":g(()=>[o(E,{disable:b.value.value,color:"primary",icon:"download",flat:"",onClick:$},null,8,["disable"])]),_:1},8,["rows","pagination","loading","columns"])]),_:1}))}};export{ge as default};
