import{Q as S}from"./QSeparator.f7cfe323.js";import{r as f,c as h,o as v,a as L,w as i,e as r,i as m,a3 as R,Y as F,f as c,a4 as x,Q as I}from"./index.8d8d529e.js";import{Q as T}from"./QToolbar.3dd22bf5.js";import{Q as _}from"./QHeader.e61e155c.js";import{Q as U}from"./QSpace.4a79d65d.js";import{Q as D}from"./QInput.d27f7167.js";import{Q}from"./QTable.aa2b7cb2.js";import{Q as V}from"./QPage.f53ff0e0.js";import{Q as M,a as w}from"./QLayout.23efbfb1.js";import{u as B}from"./VDB.2dc7b5f4.js";import{_ as k}from"./UserToolbar.0af8344f.js";import{a as J}from"./assistApi.5aba79bc.js";import{u as G}from"./use-quasar.161e4403.js";import"./jspdf.plugin.autotable.6edc1f15.js";import{E as H}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import"./QResizeObserver.c7a06aa8.js";import"./use-key-composition.2d2755c0.js";import"./uid.42677368.js";import"./QList.7fdda655.js";import"./QSelect.6891a176.js";import"./position-engine.1aaf11ae.js";import"./QDialog.4e6252b2.js";import"./rtl.b51694b1.js";import"./QLinearProgress.b04f1e19.js";import"./QCheckbox.f1bc2f21.js";import"./QCardActions.f38189ab.js";import"./ClosePopup.f46de0fd.js";import"./axios.ae0a941c.js";import"./axios.f1f32898.js";import"./_commonjsHelpers.88e99c8f.js";const $=m("span",{class:"text-h6"},"Asistencias",-1),j={class:"row items-center"},P={class:"col text-h6"},he={__name:"AsssitLYT",setup(W){const p=B(),b=G(),d=f({filter:"",report:[]}),g=f([]),C=f({columns:[{name:"ANIO",label:"A\xD1O",field:e=>e.ANIO,sortable:!0,align:"center"},{name:"week",label:"SEMANA",field:e=>e.semana,sortable:!0,align:"center"},{name:"id",label:"ID",field:e=>e.ID,sortable:!0,classes:"bg-white",align:"center"},{name:"name",label:"NOMBRE",field:e=>e.NOMBRE,sortable:!0,classes:"bg-white",align:"left"},{name:"store",label:"SUCURSAL",field:e=>e.SUCURSAL,sortable:!0,classes:"bg-white",align:"left"},{name:"turn",label:"TURNO",field:e=>e.TURNO,sortable:!0,classes:"bg-white",align:"center"},{name:"saturday",label:"SABADO",field:e=>e.SABADO,sortable:!0,classes:e=>{var a;return e.SABADO=="FALTA"?"bg-red-2 text-red":(a=e.SABADO)!=null&&a.includes("R")?"text-red bg-yellow":null},align:"center"},{name:"sunday",label:"DOMINGO",field:e=>e.DOMINGO,sortable:!0,classes:e=>{var a;return e.DOMINGO=="DESCANSO"?"bg-lime-11 text-green":(a=e.DOMINGO)!=null&&a.includes("R")?"text-red bg-yellow":null},align:"center"},{name:"monday",label:"LUNES",field:e=>e.LUNES,sortable:!0,classes:e=>{var a;return e.LUNES=="FALTA"?"bg-red-2 text-red":(a=e.LUNES)!=null&&a.includes("R")?"text-red bg-yellow":null},align:"center"},{name:"tuesday",label:"MARTES",field:e=>e.MARTES,sortable:!0,classes:e=>{var a;return e.MARTES=="FALTA"?"bg-red-2 text-red":(a=e.MARTES)!=null&&a.includes("R")?"text-red bg-yellow":null},align:"center"},{name:"wednesday",label:"MIERCOLES",field:e=>e.MIERCOLES,sortable:!0,classes:e=>{var a;return e.MIERCOLES=="FALTA"?"bg-red-2 text-red":(a=e.MIERCOLES)!=null&&a.includes("R")?"text-red bg-yellow":null},align:"center"},{name:"thursday",label:"JUEVES",field:e=>e.JUEVES,sortable:!0,classes:e=>{var a;return e.JUEVES=="FALTA"?"bg-red-2 text-red":(a=e.JUEVES)!=null&&a.includes("R")?"text-red bg-yellow":null},align:"center"},{name:"friday",label:"VIERNES",field:e=>e.VIERNES,sortable:!0,classes:e=>{var a;return e.VIERNES=="FALTA"?"bg-red-2 text-red":(a=e.VIERNES)!=null&&a.includes("R")?"text-red bg-yellow":null},align:"center"},{name:"absence",label:"FALTAS",field:e=>e.FALTAS,sortable:!0,classes:"bg-white",align:"center"},{name:"delays",label:"RETARDOS",field:e=>e.RETARDOS,sortable:!0,classes:"bg-white",align:"center"},{name:"vacations",label:"VACACIONES",field:e=>e.VACACIONES,sortable:!0,classes:"bg-white",align:"center"}]}),u=h(()=>d.value.report.filter(e=>e.SUCURSAL==g.value.name)),O=async()=>{var a;b.loading.show({meesage:"Obteniendo Reporte"});const e=await J.getReport();e.error?console.log(e):(console.log(e),d.value.report=e.reporte,g.value=(a=e.sucursal)==null?void 0:a.find(o=>o._store==p.session.store.id),b.loading.hide())},y=async()=>{const e=new H.Workbook,a=["G","H","I","J","K","L","M"],o=e.addWorksheet("Reporte");o.addRow(Object.keys(u.value[0]).map(l=>l)),u.value.forEach(l=>{o.addRow([l.ANIO,l.semana,l.ID,l.NOMBRE,l.SUCURSAL,l.TURNO,l.SABADO,l.DOMINGO,l.LUNES,l.MARTES,l.MIERCOLES,l.JUEVES,l.VIERNES,Number(l.FALTAS),Number(l.RETARDOS),Number(l.VACACIONES)])}),o.eachRow((l,n)=>{l.eachCell((t,s)=>{const N=o.getColumn(s).letter;if(a.includes(N)){t.value=="FALTA"||t.value=="string"&&t.value.includes("-0%")?(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFCCCC"}},t.font={color:{argb:"FF990000"}}):typeof t.value=="string"&&t.value.includes("-50%")?(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFFCC"}},t.font={color:{argb:"FF999900"}}):typeof t.value=="string"&&t.value.includes(" R")?(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFF00"}},t.font={color:{argb:"FFCC0000"}}):typeof t.value=="string"&&t.value.includes("-100%")?(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCCCFF"}},t.font={color:{argb:"FF000099"}}):t.value=="DESCANSO"&&(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFFCC"}},t.font={color:{argb:"FF999900"}});const A=/\(([^)]+)\)/,E=typeof t.value=="string"?t.value.match(A):null;E&&(t.note=E[1].trim(),t.value=t.value.replace(A,"").trim())}})}),o.columns.forEach(l=>{let n=0;l.eachCell({includeEmpty:!0},t=>{const s=t.value?t.value.toString().length:10;s>n&&(n=s)}),l.width=n<10?10:n}),(async()=>{const l=await e.xlsx.writeBuffer(),n=new Blob([l],{type:"application/octet-stream"}),t=URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download="Reporte.xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s)})()};return O(),(e,a)=>(v(),L(M,{view:"hHh Lpr fFf"},{default:i(()=>[r(_,{class:"transparent text-dark",bordered:""},{default:i(()=>[r(k),r(S),r(T,{class:"justify-between"},{default:i(()=>[m("div",null,[R("Helpers "),r(F,{name:"navigate_next",color:"primary"}),R(),$])]),_:1})]),_:1}),r(w,null,{default:i(()=>[r(V,{padding:""},{default:i(()=>[r(Q,{title:`Asistencias ${c(p).session.store.name}`,rows:c(u),filter:d.value.filter,separator:"cell",columns:C.value.columns},{top:i(()=>[r(S,{spaced:"",inset:"",vertical:"",dark:""}),m("div",j,[m("div",P,x(`Asistencias ${c(p).session.store.name}`),1)]),r(U),r(D,{borderless:"",dense:"",debounce:"300",color:"primary",modelValue:d.value.filter,"onUpdate:modelValue":a[0]||(a[0]=o=>d.value.filter=o),placeholder:"Buscar"},{append:i(()=>[r(F,{name:"search"})]),_:1},8,["modelValue"]),r(I,{onClick:y,color:"primary",icon:"cloud_download",disable:c(u).length==0,flat:""},null,8,["disable"])]),_:1},8,["title","rows","filter","columns"])]),_:1})]),_:1})]),_:1}))}};export{he as default};
