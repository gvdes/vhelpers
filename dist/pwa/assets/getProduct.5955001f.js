import{q as X,bI as F,as as Y,r as w,aV as ee,g as S,bJ as te,w as E,o as ae,s as y,ah as T,t as oe,n as A,A as le,aQ as se,u as J,R as ne,a as b,c as h,d as a,i as s,a3 as W,a2 as G,h as L,k as n,bC as ie,j as I,a1 as m,p as B,m as re,l as q,Q as N,H as ce,f as ue,Z as de,a4 as k,aE as me}from"./index.a1c295c1.js";import{Q as fe}from"./QToolbar.0a659155.js";import{Q as ve}from"./QHeader.93b6f538.js";import{Q as M}from"./QTd.b6d74464.js";import{Q as pe}from"./QTr.5a12ef76.js";import{Q as _e}from"./QTable.6dbea056.js";import{Q as be}from"./QFooter.eb8841dc.js";import{Q as ge}from"./QPage.280a2f20.js";import{Q as he,a as we}from"./QLayout.17abf347.js";import{Q as xe,a as U,b as z}from"./QList.48a27591.js";import{Q as ye}from"./QBtnGroup.7276a654.js";import{e as ke,Q as Qe}from"./QSelect.9d7be3ea.js";import{Q as Ce}from"./QForm.ddbae44f.js";import{p as $}from"./productsApi.ef761c9f.js";import{u as Z}from"./use-quasar.1aaac9b4.js";import{H as Se}from"./html5-qrcode-scanner.64619f17.js";import{_ as Be}from"./UserToolbar.ed132252.js";import"./QResizeObserver.73aad3aa.js";import"./QLinearProgress.8ae38f31.js";import"./QScrollObserver.061a8790.js";import"./axios.9730f76f.js";import"./_commonjsHelpers.88e99c8f.js";import"./QImg.485359ae.js";import"./QSpace.abbec46a.js";import"./QExpansionItem.2f8e3b0c.js";import"./favorites.6b442dd7.js";import"./ClosePopup.e501f1d3.js";import"./auth.620d6bf8.js";const qe=Object.keys(F);function Ae(e){return qe.reduce((f,l)=>{const v=e[l];return v!==void 0&&(f[l]=v),f},{})}var Pe=X({name:"QBtnDropdown",props:{...F,...Y,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:f,emit:l}){const{proxy:v}=le(),g=w(e.modelValue),c=w(null),p=ee(),i=S(()=>{const t={"aria-expanded":g.value===!0?"true":"false","aria-haspopup":"true","aria-controls":p.value,"aria-label":e.toggleAriaLabel||v.$q.lang.label[g.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(t["aria-disabled"]="true"),t}),d=S(()=>"q-btn-dropdown__arrow"+(g.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),o=S(()=>te(e)),x=S(()=>Ae(e));E(()=>e.modelValue,t=>{c.value!==null&&c.value[t?"show":"hide"]()}),E(()=>e.split,r);function D(t){g.value=!0,l("beforeShow",t)}function H(t){l("show",t),l("update:modelValue",!0)}function O(t){g.value=!1,l("beforeHide",t)}function P(t){l("hide",t),l("update:modelValue",!1)}function Q(t){l("click",t)}function C(t){se(t),r(),l("click",t)}function R(t){c.value!==null&&c.value.toggle(t)}function u(t){c.value!==null&&c.value.show(t)}function r(t){c.value!==null&&c.value.hide(t)}return Object.assign(v,{show:u,hide:r,toggle:R}),ae(()=>{e.modelValue===!0&&u()}),()=>{const t=[y(T,{class:d.value,name:e.dropdownIcon||v.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&t.push(y(ke,{ref:c,id:p.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:D,onShow:H,onBeforeHide:O,onHide:P},f.default)),e.split===!1?y(A,{class:"q-btn-dropdown q-btn-dropdown--simple",...x.value,...i.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:Q},{default:()=>oe(f.label,[]).concat(t),loading:f.loading}):y(ye,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...o.value,glossy:e.glossy,stretch:e.stretch},()=>[y(A,{class:"q-btn-dropdown--current",...x.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:C},{default:f.label,loading:f.loading}),y(A,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...i.value,...o.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>t)])}}});const Ve={class:"QuickRegular row items-center text-black"},Ie={class:"col"},$e={key:0},De={class:"row items-center justify-between no-wrap QuickRegular"},He={class:"col"},Oe={class:"text-grey-4 q-pl-md"},Re={class:"text--2 text-grey-5"},Me={key:1},Le={key:2,class:"flex flex-center q-pa-md"},Ne={key:0},Te={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},with_locations:{default:null,type:Boolean},with_image:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},with_prices_Invoice:{default:null,type:Boolean},with_stock:{default:null,type:Boolean}},emits:["input","similarcodes","agregar"],setup(e,{emit:f}){Z();const l=J(),v=e,g=f;let c=null;const p=w(!1),i=w(!1),d=w({val:{id:1,label:"Autocomplete",icon:"keyboard"},opts:[{id:1,label:"Autocomplete",icon:"keyboard"},{id:2,label:"barcode",icon:"fas fa-barcode"},{id:3,label:"qr_code",icon:"qr_code"}]}),o=w({buscar:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),x=S(()=>({search:o.value.buscar,with_locations:v.with_locations,with_stock:v.with_stock,with_prices:v.with_prices,limit:v.limit,_workpoint:l.session.store.id_viz,rol:l.session.credentials.rol})),D=()=>{switch(o.value.iptsearch.type){case"text":o.value.iptsearch.type="number",o.value.iptsearch.icon="fas fa-font";break;case"number":o.value.iptsearch.type="text",o.value.iptsearch.icon="fas fa-hashtag";break}},H=async(u,r,t)=>{let _=u.trim().toUpperCase();if(_.length>=3){o.value.buscar=_,console.log(x.value);const V=await $.autoCompleteProduct(x.value);if(V.fail)console.log(V);else{console.log(V);let K=V;r(()=>{o.value.options=K},j=>{j.setOptionIndex(-1),j.moveOptionSelection(1,!0)})}}},O=async()=>{if(o.value.buscar.trim().toUpperCase(),o.value.buscar.length){const u=await $.exactSearch(x.value);u.fail?console.log(u):(console.log(u),C(u))}},P=async()=>{if(p.value=!0,c){console.log("La c\xE1mara ya est\xE1 activa");return}ce(()=>{c=new Se("reader");const u={fps:10,qrbox:r=>{const _=Math.floor(r*.8);return{width:_,height:_}}};c.start({facingMode:"environment"},u,async r=>{if(!i.value){i.value=!0;try{const t=JSON.parse(r);if(console.log(t),t.modelo){o.value.buscar=t.modelo;const _=await $.scanSearch(x.value);_.fail?console.log(_):(console.log(_),Q(),C(_))}}catch{console.log("QR inv\xE1lido: "+r)}finally{i.value=!1}}}).catch(r=>console.log("Error al iniciar c\xE1mara: "+r.message)),console.log("C\xE1mara iniciada")})},Q=()=>{if(!c){console.log("La c\xE1mara no estaba activa");return}c.stop().then(()=>{c.clear(),c=null,p.value=!1,console.log("C\xE1mara detenida")}).catch(u=>console.log("Error al detener c\xE1mara: "+u.message))},C=u=>{o.value.buscar="",g("input",u)},R=(u,r)=>{o.value.buscar="",o.value.options=void 0,u.id==3?P():Q()};return ne(()=>{Q()}),(u,r)=>(b(),h("div",Ve,[a(Pe,{color:"primary",dense:"",flat:"",icon:d.value.val.icon},{default:s(()=>[a(xe,null,{default:s(()=>[(b(!0),h(W,null,G(d.value.opts,t=>(b(),L(U,{key:t.id,clickable:"",onClick:_=>{d.value.val=t,R(t)}},{default:s(()=>[a(z,{avatar:""},{default:s(()=>[a(T,{name:t.icon},null,8,["name"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["icon"]),n("div",Ie,[d.value.val.id==1?(b(),h("div",$e,[a(Qe,{modelValue:o.value.buscar,"onUpdate:modelValue":r[0]||(r[0]=t=>o.value.buscar=t),"hide-selected":"",behavior:"menu",options:o.value.options,filled:"","hide-dropdown-icon":"","use-input":"",class:"text-uppercase","input-class":"text-h6 text-bold",onFilter:H,"input-debounce":400,autofocus:""},{prepend:s(()=>[a(A,{size:"md",flat:"",padding:"none",onClick:D,icon:o.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:s(t=>[a(U,ie(t.itemProps,{onClick:_=>C(t.opt)}),{default:s(()=>[a(z,null,{default:s(()=>[n("div",De,[n("div",He,[n("div",null,[I(m(t.opt.code)+" ",1),n("span",Oe,m(t.opt.name),1)]),n("div",Re,m(t.opt.description),1)])])]),_:2},1024)]),_:2},1040,["onClick"])]),_:1},8,["modelValue","options"])])):B("",!0),d.value.val.id==2?(b(),h("div",Me,[a(Ce,{onSubmit:O,class:"q-gutter-md"},{default:s(()=>[a(re,{modelValue:o.value.buscar,"onUpdate:modelValue":r[1]||(r[1]=t=>o.value.buscar=t),type:"text",filled:"",class:"text-uppercase","input-class":"text-h6 text-bold",autofocus:""},null,8,["modelValue"])]),_:1})])):B("",!0),d.value.val.id==3?(b(),h("div",Le,[a(N,{class:"camera-card"},{default:s(()=>[a(q,{class:"flex flex-center"},{default:s(()=>[r[2]||(r[2]=n("div",{id:"reader",class:"qr-reader"},null,-1)),p.value?B("",!0):(b(),h("div",Ne,[a(A,{color:"primary",flat:"",icon:"refresh",label:"Buscar",onClick:P})]))]),_:1})]),_:1})])):B("",!0)])]))}};const je={class:"col"},Ee={class:"row justify-center"},Ue={class:"row"},ze={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},Fe={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},Je={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},We={class:"row"},Ge={class:"text-h6 col text-bold text-left"},Ze={class:"col text-bold text-center"},Ke={class:"text-h6 col text-bold text-right"},Xe={class:"text-subtitle2 col"},Ye={class:"text-weight-bold"},et={class:"text-bold text-blue-13"},tt={class:"row q-ml-sm"},Pt={__name:"getProduct",setup(e){J();const f=Z();ue(),de();const l=w(null),v=w({columns:[{name:"anio",label:"A\xD1O",field:"year",align:"center"},{name:"sales",label:"COMPRAS",field:"compras",align:"center"},{name:"purchases",label:"VENTAS",field:"ventas",align:"center"}]}),g=p=>{console.log(p),c(p.id)},c=async p=>{f.loading.show({message:"Obteniendo Datos"}),l.value=null,console.log(p);const i=await $.getProduct(p);i.fail?console.log(i):(f.loading.hide(),console.log(i),i.prices.push({id:8,alias:"COS",pivot:{price:i.cost}}),i.prices.sort((d,o)=>o.id-d.id),l.value=i)};return(p,i)=>(b(),L(he,{view:"hHh Lpr fFf"},{default:s(()=>[a(ve,{class:"",bordered:""},{default:s(()=>[a(Be),a(k),a(fe,{class:"justify-between row"},{default:s(()=>[n("div",je,[i[0]||(i[0]=n("span",{class:""},"Helpers",-1)),a(T,{name:"navigate_next",color:""}),i[1]||(i[1]=n("span",{class:"text-h6"},"Informaci\xF3n Producto",-1))])]),_:1})]),_:1}),a(we,null,{default:s(()=>[a(ge,{padding:""},{default:s(()=>[n("div",Ee,[a(me,{name:"bounce"},{default:s(()=>[l.value?(b(),L(N,{key:0,class:"my-card"},{default:s(()=>[a(q,{class:"item-center"},{default:s(()=>[n("div",Ue,[n("div",ze,m(l.value.category.familia.seccion.name),1),n("div",Fe,m(l.value.category.familia.name),1),n("div",Je,m(l.value.category.name),1)])]),_:1}),a(q,{class:"item-center"},{default:s(()=>[n("div",We,[n("div",Ge,m(l.value.code),1),n("div",Ze,[i[2]||(i[2]=n("div",{class:"text-caption"},"Stock",-1)),n("div",null,m(l.value.total_stock),1)]),n("div",Ke,m(l.value.name),1)]),n("div",Xe,m(l.value.description),1)]),_:1}),a(q,{class:"item-center row"},{default:s(()=>[(b(!0),h(W,null,G(l.value.prices,(d,o)=>(b(),h("div",{class:"col text-subtitle2 text-center",key:o},[n("div",Ye,m(d.alias),1),a(k,{spaced:"",inset:"",vertical:"",dark:""}),n("div",et,m(d.pivot.price),1),a(k,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),a(q,null,{default:s(()=>[a(_e,{rows:l.value.details,hideBottom:"",columns:v.value.columns,pagination:{rowsPerPage:0}},{"bottom-row":s(()=>[a(pe,{class:"text-bold text-dark bg-yellow-12"},{default:s(()=>[a(M,{class:"text-center"},{default:s(()=>i[3]||(i[3]=[I(" Total ")])),_:1}),a(M,{class:"text-center"},{default:s(()=>[I(m(l.value.details.reduce((d,o)=>d+Number(o.compras),0)),1)]),_:1}),a(M,{class:"text-center"},{default:s(()=>[I(m(l.value.details.reduce((d,o)=>d+Number(o.ventas),0)),1)]),_:1})]),_:1})]),_:1},8,["rows","columns"])]),_:1})]),_:1})):B("",!0)]),_:1})]),a(be,{reveal:"",elevated:"",bordered:""},{default:s(()=>[a(k,{spaced:"",inset:"",vertical:"",dark:""}),n("div",tt,[a(N,{class:"col"},{default:s(()=>[a(Te,{checkState:!1,onInput:g,with_prices_Invoice:"",with_stock:"",with_locations:""})]),_:1}),a(k,{spaced:"",inset:"",vertical:"",dark:""})]),a(k,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Pt as default};
