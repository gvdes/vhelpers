import{Q as $}from"./QInput.4cac1239.js";import{Q as B}from"./QForm.0f8e42cc.js";import{a as y,d as I}from"./QSelect.4adb7f5d.js";import{d as R,Q as q,c as D,b as E}from"./QList.bcefd788.js";import{Q as F}from"./QTable.197bee46.js";import{Q as N}from"./QPage.b143b454.js";import{Q as T,a as b}from"./QCard.9a6571ff.js";import{aH as A,a as H,u as L,r as c,c as U,o as k,g as j,e as o,w as a,a3 as z,f as d,a5 as S,d as M,a6 as u,a0 as m,Q as f,a8 as G}from"./index.ba34de0c.js";import{Q as J}from"./QCardActions.67cd5b0d.js";import{C as K}from"./ClosePopup.9ce7d6da.js";import"./dayjs.min.cbcf888d.js";import{R as _}from"./RestockApi.f965fe43.js";import{u as O}from"./Restock.d477d042.js";import{u as W}from"./axios.359db046.js";import{$sktRestock as P}from"./socket.3fae67a0.js";import{_ as X}from"./PrinterSelect.2e107237.js";import"./QLinearProgress.8c011aa0.js";import"./QCheckbox.5ce0ba6d.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.c6789d6f.js";const Y={class:"flex justify-center"},Z={class:"text-center",style:"width: 50%;"},tt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},bt={__name:"supply",setup(et){A(),H();const n=O(),l=W(),v=L(),r=c(null),V=c({rowsPerPage:[0]}),i=c({state:!1,val:null}),g=U(()=>n.partitions.filter(s=>s._status==3&&s.requisition._workpoint_to==v.session.store.id_viz)),h=async()=>{n.setTitle("Surtido"),n.setButtonShow(!1)},C=async s=>{l.loading.show({message:"..."}),console.log(s.ip),console.log(i.value);const t=await _.printForPartition({ip:s.ip,port:s._port,_partition:i.value.val.id,_workpoint_to:i.value.val._workpoint_to});console.log(t),t.status==200?(t.data?l.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):l.notify({message:`Sin conexion a <b>${s.name} <small>(${s.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),l.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},x=async()=>{if(g.value.findIndex(t=>t.id==r.value)>=0){l.loading.show({message:"Cambiando Estado"});let t={partition:r.value,surtidor:v.session.credentials.staff,state:4};console.log(t);let e=await _.saveSupply(t);if(console.log(e),e.status==200){let Q=n.partitions.findIndex(p=>p.id==e.data.partition.id);if(Q>=0){if(n.partitions.splice(Q,1,e.data.partition),e.data.partitionsEnd>e.data.partition.requisition._status){let p={id:e.data.partition._requisition,state:e.data.partitionsEnd};const w=await _.nextState(p);P.emit("order_refresh",{order:w.data}),console.log(w.data)}P.emit("orderpartition_refresh",{order:e.data.partition})}r.value=null,i.value={state:!1,val:null},l.loading.hide()}else alert(`Error ${e.status}: ${e.data} 2`)}else l.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),r.value=null};return h(),(s,t)=>(k(),j(z,null,[o(N,{padding:""},{default:a(()=>[d("div",null,[d("div",Y,[d("div",Z,[o(B,{onSubmit:x},{default:a(()=>[o($,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),o(F,{rows:g.value,"row-key":"name",grid:"",pagination:V.value,"hide-bottom":""},{item:a(e=>[d("div",tt,[o(q,{bordered:""},{default:a(()=>[S((k(),M(E,{clickable:"",onClick:()=>{i.value.state=!0,i.value.val=e.row}},{default:a(()=>[o(D,null,{default:a(()=>[o(y,{class:"text-center text-bold"},{default:a(()=>[u(m(e.row.id),1)]),_:2},1024),o(y,{class:"text-center text-overline text-caption"},{default:a(()=>[u("(P: "+m(e.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[G]])]),_:2},1024)])]),_:1},8,["rows","pagination"])])]),_:1}),o(R,{modelValue:i.value.state,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.state=e),persistent:""},{default:a(()=>[o(T,null,{default:a(()=>[o(b,{class:"text-bold text-h5 items-center"},{default:a(()=>[u(" Particion "+m(i.value.val.id),1)]),_:1}),o(b,{class:"text-center"},{default:a(()=>t[3]||(t[3]=[u(" Que Desesas Hacer ? ")])),_:1}),o(J,{align:"center"},{default:a(()=>[S(o(f,{flat:"",icon:"close",color:"negative"},null,512),[[K]]),o(f,{flat:"",icon:"print",color:"primary"},{default:a(()=>[o(I,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[o(X,{onSelectedPartition:C,partition:!0})]),_:1})]),_:1}),o(f,{flat:"",icon:"send",color:"positive",onClick:t[1]||(t[1]=()=>{r.value=i.value.val.id,x()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{bt as default};
