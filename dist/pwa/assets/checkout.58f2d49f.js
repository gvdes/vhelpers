import{Q as D}from"./QInput.d5f71caa.js";import{Q as R}from"./QForm.6d97e128.js";import{a as k,Q as N,d as A}from"./QSelect.ea5b71d1.js";import{d as h,Q as F,c as T,b as U}from"./QList.89e155b2.js";import{Q as L}from"./QTable.b05ea11a.js";import{Q as z}from"./QPage.80461780.js";import{aH as G,a as H,u as M,r as m,c as j,o as V,g as O,e,w as a,a3 as Y,f as d,a9 as J,a5 as S,d as K,a6 as p,a0 as c,a7 as W,Q as f,a8 as X}from"./index.c896f958.js";import{Q as y,a as v}from"./QCard.e7ecc7e7.js";import{Q as C}from"./QCardActions.b8667083.js";import{C as Z}from"./ClosePopup.6a30e99e.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.d062923a.js";import{u as tt}from"./Restock.0467f5e6.js";import{u as et}from"./axios.48c10d8c.js";import{$sktRestock as P}from"./socket.3fae67a0.js";import{_ as at}from"./PrinterSelect.5ee7a074.js";import"./QLinearProgress.721fc67a.js";import"./QCheckbox.87af9e3a.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.0fcdef25.js";const ot={class:"flex justify-center"},st={class:"text-center",style:"width: 50%;"},it={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},lt={class:"text-bold"},nt={class:"q-mx-sm text-h6"},$t={__name:"checkout",setup(rt){G();const $=H(),u=tt(),r=et(),x=M(),l=m(null),E=m({rowsPerPage:[0]}),i=m({state:!1,val:null}),n=m({state:!1,val:null,opts:["GEN","EMP"]}),w=j(()=>u.partitions.filter(s=>s._status==4&&s.requisition._workpoint_to==x.session.store.id_viz)),q=async()=>{u.setShowLYT(!0),u.setTitle("Verificacion"),u.setButtonShow(!1)},B=async s=>{r.loading.show({message:"..."}),console.log(s.ip),console.log(i.value);const t=await g.printForPartition({ip:s.ip,port:s._port,_partition:i.value.val.id,_workpoint_to:i.value.val._workpoint_to});console.log(t),t.status==200?(t.data?r.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):r.notify({message:`Sin conexion a <b>${s.name} <small>(${s.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),r.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},b=()=>{i.value.val&&(l.value=i.value.val.id),console.log(l.value);let s=w.value.findIndex(t=>t.id==l.value);console.log(s),s>=0?n.value.state=!0:(r.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),l.value=null)},I=async()=>{r.loading.show({message:"Cambiando Estado"});let s={partition:l.value,verified:x.session.credentials.staff.id,warehouse:n.value.val?n.value.val:"GEN",state:5};console.log(s);let t=await g.SaveVerified(s);if(console.log(t),t.status==200){let o=u.partitions.findIndex(_=>_.id==t.data.partition.id);if(o>=0){if(u.partitions.splice(o,1,t.data.partition),t.data.partitionsEnd>t.data.partition.requisition._status){let _={id:t.data.partition._requisition,state:t.data.partitionsEnd};const Q=await g.nextState(_);P.emit("order_refresh",{order:Q.data}),console.log(Q.data)}P.emit("orderpartition_refresh",{order:t.data.partition})}l.value=null,$.push(`/distribute/checkout/${t.data.partition.id}`),r.loading.hide()}else alert(`Error ${t.status}: ${t.data} 2`)};return q(),(s,t)=>(V(),O(Y,null,[e(z,{padding:""},{default:a(()=>[d("div",null,[d("div",ot,[d("div",st,[e(R,{onSubmit:b},{default:a(()=>[e(D,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value=o),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),e(L,{rows:w.value,"row-key":"name",grid:"",pagination:E.value,"hide-bottom":""},{item:a(o=>[d("div",it,[e(F,{bordered:"",class:J(`${o.row._status==4?"bg-green-11":"bg-red-11"} text-bold`)},{default:a(()=>[S((V(),K(U,{clickable:"",onClick:()=>{i.value.state=!0,i.value.val=o.row}},{default:a(()=>[e(T,null,{default:a(()=>[e(k,{class:"text-center text-bold"},{default:a(()=>[p(c(o.row.id),1)]),_:2},1024),e(k,{class:"text-center text-overline text-caption"},{default:a(()=>[d("span",lt,c(o.row.requisition.from.name),1),p(" (P: "+c(o.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[X]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),e(h,{modelValue:n.value.state,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.state=o)},{default:a(()=>[e(y,null,{default:a(()=>[e(v,{class:"row items-center"},{default:a(()=>[e(W,{icon:"warning",color:"orange-14","text-color":"white"}),d("span",nt,"Iniciar CheckOut #"+c(l.value),1)]),_:1}),e(v,null,{default:a(()=>[e(N,{modelValue:n.value.val,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.val=o),options:n.value.opts,label:"Almacen Destino",filled:""},null,8,["modelValue","options"])]),_:1}),e(C,{vertical:"",align:"center"},{default:a(()=>[e(f,{flat:"",label:"Si",color:"primary",onClick:I,disable:n.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(h,{modelValue:i.value.state,"onUpdate:modelValue":t[3]||(t[3]=o=>i.value.state=o),persistent:""},{default:a(()=>[e(y,null,{default:a(()=>[e(v,{class:"text-bold text-h5 items-center"},{default:a(()=>[p(" Particion "+c(i.value.val.id),1)]),_:1}),e(v,{class:"text-center"},{default:a(()=>t[4]||(t[4]=[p(" Que Desesas Hacer ? ")])),_:1}),e(C,{align:"center"},{default:a(()=>[S(e(f,{flat:"",icon:"close",color:"negative"},null,512),[[Z]]),e(f,{flat:"",icon:"print",color:"primary"},{default:a(()=>[e(A,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[e(at,{onSelectedPartition:B,partition:!0})]),_:1})]),_:1}),e(f,{flat:"",icon:"send",color:"positive",onClick:b})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{$t as default};
