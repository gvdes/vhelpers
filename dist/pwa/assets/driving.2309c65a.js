import{Y as q,d as E,u as R,r as _,e as I,a as S,c as D,h as e,g as a,a5 as N,a2 as A,j as m,l as F,b6 as T,aW as k,f as j,i as p,a0 as f,Q as z,k as y,a4 as L,m as b,ai as U}from"./index.01aad732.js";import{Q as H}from"./QForm.fce9930c.js";import{a as x,d as M}from"./QSelect.89493f30.js";import{Q as W,b as Y,a as G}from"./QList.4eff6dc2.js";import{Q as J}from"./QTable.68c4d436.js";import{Q as K}from"./QPage.45fc3825.js";import{C as O}from"./ClosePopup.c1474fd6.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.3b91752d.js";import{u as X}from"./Restock.73d5165d.js";import{u as Z}from"./use-quasar.00e0b448.js";import{$sktRestock as C}from"./socket.168d2ba4.js";import{_ as tt}from"./PrinterSelect.38bbb618.js";import"./QLinearProgress.a853f099.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.60d20557.js";import"./QToolbar.04979db5.js";import"./QTd.1c41788a.js";import"./QPopupEdit.8744a566.js";import"./QTr.5dfa3b08.js";import"./QLayout.a7bbe833.js";import"./QScrollObserver.1be2845e.js";import"./QResizeObserver.955528d4.js";import"./QExpansionItem.9e45ed88.js";import"./QDrawer.c490ca27.js";import"./jspdf.plugin.autotable.873d44e1.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */import"./QBtnGroup.03041a08.js";const et={class:"flex justify-center"},ot={class:"text-center",style:"width: 50%;"},at={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},st={class:"text-bold"},At={__name:"driving",setup(it){q();const P=E(),r=X(),u=Z(),c=R(),l=_(null),B=_({rowsPerPage:[0]}),n=_({state:!1,val:null}),w=I(()=>r.partitions.filter(i=>{const t=["chf","amc","vld","root","jch","gce"].includes(c.session.rol),o=i.requisition.from.id==c.session.store.id_viz,s=i.requisition.to.id==c.session.store.id_viz,d=["gen","aux","alm","root","recp","gce"].includes(c.session.rol);return t&&s?(r.setTitle("Por Enviar"),r.setButtonShow(!1),r.setButtonShowAdd(!1),i._status===6):o&&d?(r.setTitle("En camino"),r.setButtonShow(!0),r.setButtonShowAdd(!1),i._status===7):!1})),V=async i=>{u.loading.show({message:"..."}),console.log(i.ip),console.log(n.value);const t=await g.printForPartition({ip:i.ip,port:i._port,_partition:n.value.val.id,_workpoint_to:n.value.val._workpoint_to});console.log(t),t.status==200?(t.data?u.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):u.notify({message:`Sin conexion a <b>${i.name} <small>(${i.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),u.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},h=async()=>{if(w.value.findIndex(t=>t.id==l.value)>=0){u.loading.show({message:"Cambiando Estado"});let t=Number(r.partitions.find(d=>d.id==l.value)._status)+Number(1),o={partition:l.value,chofi:c.session.credentials.staff.id,state:t};console.log(o);let s=null;if(t==7?s=await g.SaveChofi(o):t==8&&(s=await g.saveReceipt(o)),console.log(s),s.status==200){let d=r.partitions.findIndex(v=>v.id==s.data.partition.id);if(d>=0){if(r.partitions.splice(d,1,s.data.partition),s.data.partitionsEnd>s.data.partition.requisition._status){let v={id:s.data.partition._requisition,state:s.data.partitionsEnd};const Q=await g.nextState(v);C.emit("order_refresh",{order:Q.data}),console.log(Q.data)}C.emit("orderpartition_refresh",{order:s.data.partition})}l.value=null,n.value={state:!1,val:null},t==8&&P.push("/distribute/checkin"),u.loading.hide()}else alert(`Error ${s.status}: ${s.data} 2`)}else u.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),l.value=null},$=i=>{switch(i){case 4:return"bg-blue-11";case 7:return"bg-red-11";case 5:return"bg-purple-11";case 9:return"bg-green-11";case 23:return"bg-yellow-11";case 13:return"bg-bg-brown-12";default:return""}};return(i,t)=>(S(),D(A,null,[e(K,{padding:""},{default:a(()=>[m("div",null,[m("div",et,[m("div",ot,[e(H,{onSubmit:h},{default:a(()=>[e(F,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value=o),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),e(J,{rows:w.value,"row-key":"name",grid:"",pagination:B.value,"hide-bottom":""},{item:a(o=>[m("div",at,[e(W,{bordered:"",class:T($(o.row.requisition.from.id))},{default:a(()=>[k((S(),j(G,{clickable:"",onClick:()=>{n.value.state=!0,n.value.val=o.row}},{default:a(()=>[e(Y,null,{default:a(()=>[e(x,{class:"text-center text-bold"},{default:a(()=>[p(f(o.row.id),1)]),_:2},1024),e(x,{class:"text-center text-overline text-caption"},{default:a(()=>[m("span",st,f(o.row.requisition.from.name),1),p(" (P: "+f(o.row.requisition.id)+")",1)]),_:2},1024),e(x,{class:"text-center text-bold"},{default:a(()=>[p(f(o.row.status.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[U]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),e(N,{modelValue:n.value.state,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.state=o),persistent:""},{default:a(()=>[e(z,null,{default:a(()=>[e(y,{class:"text-bold text-h5 items-center"},{default:a(()=>[p(" Particion "+f(n.value.val.id),1)]),_:1}),e(y,{class:"text-center"},{default:a(()=>t[3]||(t[3]=[p(" Que Desesas Hacer ? ")])),_:1}),e(L,{align:"center"},{default:a(()=>[k(e(b,{flat:"",icon:"close",color:"negative"},null,512),[[O]]),e(b,{flat:"",icon:"print",color:"primary"},{default:a(()=>[e(M,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[e(tt,{onSelectedPartition:V,partition:!0})]),_:1})]),_:1}),e(b,{flat:"",icon:"send",color:"positive",onClick:t[1]||(t[1]=()=>{l.value=n.value.val.id,h()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{At as default};
