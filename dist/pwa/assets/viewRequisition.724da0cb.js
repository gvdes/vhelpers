import{Q as q}from"./QInput.e8458224.js";import{Q as I}from"./QSeparator.f19208f7.js";import{u as M,aE as j,r as Q,c as w,q as z,p as G,o as u,g as V,e,w as o,a1 as b,f as H,a as C,h as L,Q as k,a3 as n,a0 as N,a2 as J,a4 as c}from"./index.9cf7fb9e.js";import{Q as x,a as r}from"./QItemSection.51dbcc51.js";import{Q as B}from"./QList.205ba94c.js";import{Q as K}from"./QPage.caa9a50a.js";import{Q as W,a as R}from"./QCard.1c6a3157.js";import{Q as X}from"./QCardActions.bb335274.js";import{Q as Y}from"./QDialog.cec9fbcd.js";import{C as Z}from"./ClosePopup.95b7067a.js";import{u as ee}from"./VDB.5867faa7.js";import{u as te}from"./use-quasar.5114d4be.js";import{u as oe,r as U}from"./requisitionApi.d8d4ffeb.js";import{i as ae}from"./resoursesApi.696d463e.js";import"./use-key-composition.9614fe34.js";import"./uid.937d8ee7.js";import"./axios.ba7b1b0e.js";import"./axios.9ab26c22.js";const le={class:"row"},ke={__name:"viewRequisition",setup(se){const d=ee(),m=te(),S=M(),$=j(),p=Q(!1),i=oe(),_=$.params.oid,f=Q(null),v=Q([]),g=Q(""),y=w(()=>g.value.length<=0?v.value:v.value.filter(a=>a.description.toLowerCase().includes(g.value.toLowerCase()))),P=w(()=>y.value.some(a=>a.amount>0)),h=w(()=>y.value.filter(a=>a.amount>0)),E=async()=>{m.loading.show({message:"Obteniendo Datos"});const a=await U.getRequisition(d.session.store.id,_);a.status!==200?console.log(a):(m.loading.hide(),console.log(a),f.value=a.data,O(),i.setTitle(`${a.data.notes||_}`),i.setShowCreateButton(!1),i.setShowOrders(!1))},O=async()=>{const a=await ae.getAssortmentInsumos();a.error?console.log(a):(console.log(a),v.value=a,f.value.bodie.length>0&&v.value.forEach(t=>{const l=f.value.bodie.find(s=>s.code===t.code);console.log(l),l?t.amount=l.amount:t.amount=0}))},T=async()=>{m.loading.show({message:"Cerrando Pedido"});let a={id:_,products:h.value};const t=await U.finishRequisition(a);t.status!=200?console.log(t):(S.push("/assortment"),m.loading.hide())};return z(()=>{d.session.rol=="aux"||d.session.rol=="gen"||d.session.rol=="aud"||d.session.rol=="root"?E():(m.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),S.replace("/"))}),G(()=>{i.setTitle("Pedidos Insumos"),i.setShowCreateButton(!0),i.setShowOrders(!0)}),(a,t)=>(u(),V(b,null,[e(K,{padding:""},{default:o(()=>{var l;return[H("div",le,[e(q,{class:"col",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),P.value?(u(),C(I,{key:0,spaced:"",inset:"",vertical:"",dark:""})):L("",!0),P.value?(u(),C(k,{key:1,color:"primary",flat:"",dense:"",icon:"send",onClick:t[1]||(t[1]=s=>p.value=!p.value),disable:((l=f.value)==null?void 0:l._status)>1},null,8,["disable"])):L("",!0)]),e(I,{spaced:"",inset:"",vertical:"",dark:""}),e(B,null,{default:o(()=>[e(x,null,{default:o(()=>[e(r,null,{default:o(()=>t[3]||(t[3]=[n("Codigo")])),_:1}),e(r,null,{default:o(()=>t[4]||(t[4]=[n("Descripcion")])),_:1}),e(r,null,{default:o(()=>t[5]||(t[5]=[n("Cantidad")])),_:1})]),_:1})]),_:1}),(u(!0),V(b,null,N(y.value,(s,A)=>(u(),C(B,{bordered:"",key:A},{default:o(()=>[e(x,null,{default:o(()=>[e(r,null,{default:o(()=>[n(c(s.code),1)]),_:2},1024),e(r,null,{default:o(()=>[n(c(s.description),1)]),_:2},1024),e(r,null,{default:o(()=>{var D;return[e(q,{modelValue:s.amount,"onUpdate:modelValue":F=>s.amount=F,type:"number",filled:"",disable:((D=f.value)==null?void 0:D._status)>1},null,8,["modelValue","onUpdate:modelValue","disable"])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1}),e(Y,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=l=>p.value=l),persistent:""},{default:o(()=>[e(W,{style:{width:"500px"}},{default:o(()=>[e(R,{class:"text-bold text-h6 text-center"},{default:o(()=>t[6]||(t[6]=[n(" Se Creara Pedido ")])),_:1}),e(R,null,{default:o(()=>[(u(!0),V(b,null,N(h.value,(l,s)=>(u(),C(B,{key:s,bordered:""},{default:o(()=>[e(x,null,{default:o(()=>[e(r,null,{default:o(()=>[n(c(l.code),1)]),_:2},1024),e(r,null,{default:o(()=>[n(c(l.description),1)]),_:2},1024),e(r,null,{default:o(()=>[n(c(l.amount),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(X,{align:"right"},{default:o(()=>[J(e(k,{flat:"",label:"Cancel",color:"primary"},null,512),[[Z]]),e(k,{flat:"",label:"Crear",color:"primary",onClick:T})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ke as default};
