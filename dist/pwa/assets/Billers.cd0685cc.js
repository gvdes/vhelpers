import{u as L,r as x,c as O,o as m,d as D,w as n,g as t,_ as d,a4 as U,i as k,e as s,j as _,k as T,Y as E,Q as w,f as $,b5 as z,a1 as p,a0 as B,$ as N,a2 as R,aV as M,h as q,a3 as j}from"./index.fd78ab5f.js";import{Q as H}from"./QToolbarTitle.ca1fbb52.js";import{Q as J}from"./QDate.c8ca7b89.js";import{q as G,d as K}from"./QSelect.9eb26f2a.js";import{Q as W}from"./QToolbar.57467177.js";import{Q as P}from"./QTable.81bd3daf.js";import{Q as X}from"./QExpansionItem.239915b1.js";import{Q as Z}from"./QList.35ad6390.js";import{Q as ee}from"./QPage.2db40ca5.js";import"./QDrawer.39116e5a.js";import{C as te}from"./ClosePopup.08f3336a.js";import{v as le}from"./axios.c4f459dc.js";import{u as Y}from"./use-quasar.b6b34f91.js";import{b as h}from"./billingApi.f69ce836.js";import{u as I}from"./BillingStore.19bba003.js";import"./jspdf.plugin.autotable.cf560ccd.js";import"./exceljs.min.9e24d01d.js";import"./reports.50e9f577.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as V}from"./dayjs.min.cbcf888d.js";import"./use-render-cache.3aae9b27.js";import"./date.5aade59c.js";import"./QLinearProgress.c5704fac.js";import"./QResizeObserver.426100d0.js";import"./QScrollObserver.08c5fd75.js";import"./_commonjsHelpers.88e99c8f.js";const ae={class:"row justify-between items-center q-mb-lg"},se={class:"text-caption text-grey-6"},oe={key:0},ie={class:"row q-col-gutter-md q-mb-lg"},ne={class:"col-12 col-md-4"},de={class:"text-h6 text-weight-medium"},re={class:"col-12 col-md-4"},ce={class:"text-h6 text-weight-medium"},ue={class:"col-12 col-md-4"},me={class:"text-h6 text-weight-medium"},fe={class:"row q-col-gutter-md"},ve={class:"col-12 col-sm-6"},ge={class:"text-body1"},pe={class:"col-12 col-sm-6"},be={class:"text-body1"},xe={class:"col-12 col-sm-6"},_e={class:"text-body1"},ye={class:"col-12 col-sm-6"},we={class:"row q-col-gutter-md"},he={class:"col"},Ce={class:"text-body1"},Se={class:"col"},ke={class:"text-body1"},De={class:"text-caption text-grey-7"},Ae={class:"text-body1"},Qe={class:"text-caption"},Te={class:"col-12"},$e={class:"text-body1"},Ve={class:"col-12"},Fe={class:"text-body1"},qe={__name:"viewBilling",props:{id:{default:null,type:Number}},emits:["nextState"],setup(F,{emit:C}){L(),I();const b=Y(),l=x(null),f=[{name:"ARTLFA",label:"C\xF3digo",field:"ARTLFA",align:"left"},{name:"DESLFA",label:"Descripci\xF3n",field:"DESLFA",align:"left"},{name:"CANLFA",label:"Cantidad",field:"CANLFA",align:"center"},{name:"PRELFA",label:"Precio",field:"PRELFA",align:"right"},{name:"TOTLFA",label:"Total",field:"TOTLFA",align:"right"},{name:"UNIDAD",label:"UNIDAD",field:i=>i.sat.unidad,align:"right"},{name:"CLAVE",label:"CLAVE",field:i=>i.sat.clave,align:"right"}],c=O(()=>{try{const i=JSON.parse(l.value.address);return`${i.calle} ${i.numExt} ${i.numInt?"Int. "+i.numInt:""}, ${i.colonia}, ${i.ciudad}, ${i.municipio}, CP ${i.cp}`}catch{return""}}),r=F,y=C,u=async()=>{b.loading.show({message:"Obteniendo Datos"});let i={id:r.id};const e=await h.getBilling(i);e.fail?console.log(e):(console.log(e),b.loading.hide(),l.value=e)},S=i=>{let e=null;switch(i){case"EFE":e="01";break;case"TDD":e="28";break;case"TDC":e="04";break;case"TRA":e="03";break;case"CHE":e="11";break;default:e="01";break}return e},A=()=>{if(l.value._state==1){if(!l.value.nclient)return b.notify({title:"Cliente sin registro",type:"negative",position:"center",message:"El cliente no cuenta con n\xFAmero de registro"});const i=l.value.ticketSuc.products.filter(e=>{var a,o;return!((a=e.sat)!=null&&a.clave)||!((o=e.sat)!=null&&o.unidad)});if(i.length>0){const e=i.map(a=>`\u2022 ${a.DESLFA} (${a.ARTLFA})`).join("<br>");return b.notify({message:`Los siguientes productos no tienen clave o unidad SAT:<br><br>${e}`,html:!0,type:"negative",position:"center"})}l.value.payments.forEach(e=>{e.sat=S(e.payment)}),y("nextState",l.value)}else l.value._state==2?y("nextState",l.value):l.value._state==3||(l.value._state==4?console.log("este ya se acabo"):l.value._state==5&&y("nextState"))},Q=async()=>{window.open(`${le}/Constances/${l.value.id}/${l.value.constancia}`,"_blank")};return u(),(i,e)=>l.value?(m(),D(w,{key:0,class:"q-pa-lg"},{default:n(()=>[t("div",ae,[t("div",null,[e[0]||(e[0]=t("div",{class:"text-h5 text-weight-bold"},"Factura / Solicitud",-1)),t("div",se," Creado el: "+d(U(V)(l.value.created_at).format("DD MMM YYYY - HH:mm")),1)]),l.value.constancia?(m(),k("div",oe,[s(_,{color:"primary",icon:"download",label:"Descargar Constancia",onClick:Q})])):T("",!0),s(G,{size:"md",color:"primary","text-color":"white"},{default:n(()=>[E(d(l.value.status.name),1)]),_:1})]),t("div",ie,[t("div",ne,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[e[1]||(e[1]=t("div",{class:"text-grey-7 text-caption"},"Ticket",-1)),t("div",de,d(l.value.ticket),1)]),_:1})]),t("div",re,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[e[2]||(e[2]=t("div",{class:"text-grey-7 text-caption"},"Total",-1)),t("div",ce,"$ "+d(l.value.total),1)]),_:1})]),t("div",ue,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[e[3]||(e[3]=t("div",{class:"text-grey-7 text-caption"},"Sucursal",-1)),t("div",me,d(l.value.store.name),1)]),_:1})])]),s($,null,{default:n(()=>[e[12]||(e[12]=t("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos del Cliente",-1)),t("div",fe,[t("div",ve,[e[4]||(e[4]=t("div",{class:"text-caption text-grey-7"},"Nombre",-1)),t("div",ge,d(l.value.name),1)]),t("div",pe,[e[5]||(e[5]=t("div",{class:"text-caption text-grey-7"},"Email",-1)),t("div",be,d(l.value.email),1)]),t("div",xe,[e[6]||(e[6]=t("div",{class:"text-caption text-grey-7"},"Tel\xE9fono",-1)),t("div",_e,d(l.value.celphone),1)]),t("div",ye,[e[7]||(e[7]=t("div",{class:"text-caption text-grey-7"},"Numero Registro",-1)),t("div",{class:z(["text-body1",l.value.nclient?"":"text-red"])},d(l.value.nclient?l.value.nclient:"Sin Registro"),3)])]),s(p),e[13]||(e[13]=t("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos Fiscales",-1)),t("div",we,[t("div",he,[e[8]||(e[8]=t("div",{class:"text-caption text-grey-7"},"RFC",-1)),t("div",Ce,d(l.value.rfc),1)]),t("div",Se,[e[9]||(e[9]=t("div",{class:"text-caption text-grey-7"},"Raz\xF3n Social",-1)),t("div",ke,d(l.value.razon_social),1)]),(m(!0),k(B,null,N(l.value.payments,a=>(m(),k("div",{key:a.id,class:"col"},[t("div",De,d(a.payment),1),t("div",Ae,"$ "+d(a.import),1),t("div",Qe,d(S(a.payment)),1)]))),128)),t("div",Te,[e[10]||(e[10]=t("div",{class:"text-caption text-grey-7"},"Direcci\xF3n",-1)),t("div",$e,d(c.value),1)]),t("div",Ve,[e[11]||(e[11]=t("div",{class:"text-caption text-grey-7"},"Regimen",-1)),t("div",Fe,d(`${JSON.parse(l.value.regimen).clave}`)+" - "+d(`${JSON.parse(l.value.regimen).descripcion}`),1)])])]),_:1}),s($,null,{default:n(()=>[e[14]||(e[14]=t("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Productos",-1)),s(P,{flat:"",bordered:"",dense:"",rows:l.value.ticketSuc.products,columns:f,"row-key":"ARTLFA",class:"q-mb-xl"},null,8,["rows"])]),_:1}),s(R,{align:"right"},{default:n(()=>[l.value._state!=4?(m(),D(_,{key:0,color:"primary",label:l.value._state==1?"Continuar":"Terminar",onClick:A},null,8,["label"])):T("",!0),M(s(_,{color:"negative",flat:"",label:"Cancelar"},null,512),[[te]])]),_:1})]),_:1})):T("",!0)}},Le={class:"row full-width items-center justify-between q-py-sm"},dt={__name:"Billers",setup(F){const C=L(),b=I(),l=Y();b.setShowToolbar(!0);const f=x({from:null,to:null}),c=x({state:!1,data:null}),r=x([]),y=x({opts:[{id:1,label:"Solicitado",class:"bg-red-10 "},{id:2,label:"Proceso",class:"bg-yellow-10 "},{id:4,label:"Creado",class:"bg-green-10"}]}),u=x({columns:[{name:"date",label:"Creado",field:e=>V(e.creeated_at).format("YYYY-MM-DD HH:mm:ss"),align:"left"},{name:"id",label:"Solicitud",field:e=>e.id,align:"left"},{name:"store",label:"Sucursal",field:e=>e.store.name,align:"left"},{name:"ticket",label:"Ticket",field:e=>e.ticket,align:"left"},{name:"contact",label:"Contacto",field:e=>e.name,align:"left"},{name:"email",label:"Correo",field:e=>e.email,align:"left"},{name:"celphone",label:"Telefono",field:e=>e.celphone,align:"left"},{name:"razonSocial",label:"Razon Social",field:e=>e.razon_social,align:"left"},{name:"Status",label:"Estado",field:e=>e.status.name,align:"left"},{name:"Usuario",label:"Usuario",field:e=>e.logs.find(a=>a._state==e._state).user.nick,align:"left"}],filter:null,paginate:{rowsPerPage:15}}),S=async()=>{l.loading.show({message:"Obteniendo Datos"});let e=V(new Date).format("YYYY/MM/DD");f.value={from:e,to:e};const a=await h.getBillings({date:f.value});a.fail?console.log(a):(console.log(a),l.loading.hide(),r.value=a)},A=async()=>{l.loading.show({message:"Obteniendo Datos"});const e=await h.getBillings({date:f.value});e.fail?console.log(e):(console.log(e),l.loading.hide(),r.value=e)},Q=async(e,a,o)=>{c.value.folio=a.id,c.value.state=!0},i=async e=>{if(console.log(e),e._state==1){let a={billing:e,user:C.session.credentials.id};const o=await h.crearFacturaInterna(a);if(o.fail)console.log(o);else{l.loading.hide(),console.log(o);let v=r.value.findIndex(g=>g.id==o.id);v>=0&&(r.value.splice(v,1,o),c.value={state:!1,data:null})}}else if(e._state==2){l.loading.show({message:"Cambiando Status"});let a={billing:e,user:C.session.credentials.id};const o=await h.finishState(a);if(o.fail)console.log(o);else{l.loading.hide(),console.log(o);let v=r.value.findIndex(g=>g.id==o.id);v>=0&&(r.value.splice(v,1,o),c.value={state:!1,data:null})}}};return S(),(e,a)=>(m(),D(ee,{padding:""},{default:n(()=>[s(W,null,{default:n(()=>[s(_,{flat:"",round:"",dense:"",icon:"receipt_long"}),s(H,null,{default:n(()=>a[4]||(a[4]=[E(" Solicitudes De Facturas ")])),_:1}),s(_,{flat:"",round:"",dense:"",icon:"event"},{default:n(()=>[s(K,null,{default:n(()=>[s(w,{class:"my-card"},{default:n(()=>[s($,null,{default:n(()=>[t("div",null,[a[5]||(a[5]=t("div",{class:"q-pb-sm text-center"},null,-1)),s(J,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=o=>f.value=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),s(R,{vertical:"",align:"center"},{default:n(()=>[s(_,{flat:"",label:"Obtener",color:"positive",onClick:A})]),_:1})]),_:1})]),_:1})]),_:1}),s(p,{spaced:"",inset:"",vertical:"",dark:""}),s(q,{modelValue:u.value.filter,"onUpdate:modelValue":a[1]||(a[1]=o=>u.value.filter=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"]),s(p,{spaced:"",inset:"",vertical:"",dark:""}),s(q,{modelValue:u.value.filter,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value.filter=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])]),_:1}),s(p,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),k(B,null,N(y.value.opts,(o,v)=>(m(),D(Z,{bordered:"",key:v},{default:n(()=>[s(p,{spaced:"",inset:"",vertical:"",dark:""}),s(X,{"expand-separator":"","default-opened":"","header-class":o.class},{header:n(()=>[t("div",Le,[t("div",null,d(o.label.toUpperCase())+" - "+d(r.value.filter(g=>g._state==o.id).length),1)])]),default:n(()=>[s(p),s(P,{rows:r.value.filter(g=>g._state==o.id),columns:u.value.columns,pagination:u.value.paginate,filter:u.value.filter,onRowClick:Q},null,8,["rows","columns","pagination","filter"])]),_:2},1032,["header-class"]),s(p,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024))),128)),s(j,{modelValue:c.value.state,"onUpdate:modelValue":a[3]||(a[3]=o=>c.value.state=o),"full-width":""},{default:n(()=>[s(qe,{id:c.value.folio,onNextState:i},null,8,["id"])]),_:1},8,["modelValue"])]),_:1}))}};export{dt as default};
