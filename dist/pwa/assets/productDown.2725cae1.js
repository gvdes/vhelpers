import{Q as R}from"./QToolbarTitle.48fcb888.js";import{Q as B}from"./QToolbar.901abb86.js";import{b as f}from"./QList.bf2ca64e.js";import{Q as C}from"./QSelect.d601643f.js";import{u as I,r as y,c as g,o as P,d as L,w as m,e as o,al as M,Q as N}from"./index.e74f744c.js";import{Q as _}from"./QCardSection.3a5b15bd.js";import{Q as U}from"./QCard.726ff719.js";import{Q as J}from"./QTable.dd6ed05e.js";import{Q as F}from"./QPage.3d276047.js";import{r as V}from"./reportApi.32c4e0be.js";import{u as Y}from"./use-quasar.da86dd6a.js";import"./jspdf.plugin.autotable.f2770f0e.js";import{E as j}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as k}from"./dayjs.min.cbcf888d.js";import"./use-key-composition.8f0344f2.js";import"./QLinearProgress.a4f3b7d6.js";import"./QCheckbox.b7319d3b.js";import"./use-checkbox.04130c60.js";import"./axios.952f42b7.js";import"./_commonjsHelpers.88e99c8f.js";const fe={__name:"productDown",setup(q){const S=I(),c=Y(),a=y({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),h=y(!1),v=y([]),u=g(()=>({pagination:{rowsPerPage:10},columns:[{name:"code",label:"CODIGO",field:e=>e.code,align:"left",sortable:!0},{name:"description",label:"DESCRIPCION",field:e=>e.description,align:"left",sortable:!0},{name:"barcode",label:"CB",field:e=>e.barcode,align:"left",sortable:!0},{name:"section",label:"SECCION",field:e=>e.category.familia.seccion.name,align:"left",sortable:!0},{name:"family",label:"FAMILIA",field:e=>e.category.familia.name,align:"left",sortable:!0},{name:"category",label:"CATEGORIA",field:e=>e.category.name,align:"left",sortable:!0},{name:"mennav",label:"MEDNAV/PERS",field:e=>e.large,align:"left",sortable:!0},{name:"provider",label:"PROVEEDOR",field:e=>e.providers.name,align:"left",sortable:!0},{name:"maker",label:"FABRICANTE",field:e=>{var l;return(l=e.makers)==null?void 0:l.name},align:"left",sortable:!0},{name:"pxc",label:"PXC",field:e=>e.pieces,align:"center",sortable:!0},{name:"lastVent",label:"Ult Venta",field:e=>e.saleLast?k(e.saleLast).format("YYYY-MM-DD"):"",align:"center",sortable:!0},{name:"dayoffsales",label:"Dias S/V",field:e=>(e.saleLast?k(e.saleLast):k("2025-01-01")).diff(k(),"day")*-1,align:"center",sortable:!0},{name:"stockSuc",label:"Sucursal PZS",field:e=>Number(e.stocks.find(l=>l.id==S.session.store.id_viz).pivot.stock),align:"center",sortable:!0},{name:"stocktotal",label:"TOTALCEDIS CJ",field:e=>Math.round(Number(Number(e.stocks.find(l=>l.id==1).pivot.stock)+Number(e.stocks.find(l=>l.id==2).pivot.stock)+Number(e.stocks.find(l=>l.id==16).pivot.stock))/Number(e.pieces)),align:"center",sortable:!0},{name:"stockCed",label:"CEDIS CJ",field:e=>Math.round(Number(e.stocks.find(l=>l.id==1).pivot.stock)/Number(e.pieces)),align:"center",sortable:!0},{name:"stockTex",label:"TEXCOCO CJ",field:e=>Math.round(Number(e.stocks.find(l=>l.id==2).pivot.stock)/Number(e.pieces)),align:"center",sortable:!0},{name:"stockBra",label:"BRASIL CJ",field:e=>Math.round(Number(e.stocks.find(l=>l.id==16).pivot.stock)/Number(e.pieces)),align:"center",sortable:!0}]})),E=g(()=>a.value.all.filter(e=>e.deep==0)),Q=g(()=>a.value.seccion.val.length>0?a.value.all.filter(e=>e.deep==1&&a.value.seccion.val.map(l=>l.id).includes(e.root)):a.value.all.filter(e=>e.deep==1)),T=g(()=>{if(a.value.seccion.val.length>0&&a.value.familias.val.length==0){let e=a.value.all.filter(l=>l.deep==1&&a.value.seccion.val.map(t=>t.id).includes(l.root)).map(l=>l.id);return a.value.all.filter(l=>l.deep==2&&e.includes(l.root))}else return a.value.familias.val.length>0?a.value.all.filter(e=>e.deep==2&&a.value.familias.val.map(l=>l.id).includes(e.root)):a.value.all.filter(e=>e.deep==2)}),D=async()=>{c.loading.show({message:"Obteniendo Familias"});const e=await V.init();e.fail?(console.log(e),c.loading.hide()):(console.log(e),a.value.all=e,c.loading.hide())},O=async()=>{var t,w,b;c.loading.show({message:"El reporte puede tardar unos minutos"}),h.value=!0;let e={filters:{sections:(t=a.value.seccion.val)==null?void 0:t.map(n=>n.id),familys:(w=a.value.familias.val)==null?void 0:w.map(n=>n.id),categories:(b=a.value.categories.val)==null?void 0:b.map(n=>n.id)},store:S.session.store.id_viz};console.log(e);const l=await V.getProductsDown(e);l.fail?(console.log(l),c.notify({message:"No se pudo obtener el reporte comuniquese con soporte",type:"negative",position:"center"})):(console.log(l),v.value=l,h.value=!1,c.loading.hide())},x=async()=>{const e=new j.Workbook,l=e.addWorksheet("PSV"),t=u.value.columns.map(s=>({header:s.label,key:s.name,width:15}));l.columns=t;const b=v.value.map(s=>{const i={};return u.value.columns.forEach(r=>{let d;typeof r.field=="function"?d=r.field(s):d=s[r.field],i[r.name]=d}),i}).map(s=>u.value.columns.map(i=>s[i.name]));l.addTable({name:"Almacenes",ref:"A1",headerRow:!0,style:{theme:"TableStyleMedium9",showRowStripes:!0},columns:u.value.columns.map(s=>({name:s.label,filterButton:!0})),rows:b}),l.columns.forEach(s=>{let i=0;s.eachCell({includeEmpty:!0},r=>{const d=r.value?r.value.toString().length:10;d>i&&(i=d)}),s.width=i<10?10:i});const n=await e.xlsx.writeBuffer(),A=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=document.createElement("a");p.href=URL.createObjectURL(A),p.download="ProductoSinVenta.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p)};return D(),(e,l)=>(P(),L(F,{padding:""},{default:m(()=>[o(B,null,{default:m(()=>[o(R,null,{default:m(()=>l[3]||(l[3]=[M(" PRODUCTO SIN VENTA ")])),_:1})]),_:1}),o(f),o(U,{class:"my-card"},{default:m(()=>[o(_,{class:"row"},{default:m(()=>[o(C,{class:"col",modelValue:a.value.seccion.val,"onUpdate:modelValue":l[0]||(l[0]=t=>a.value.seccion.val=t),options:E.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(C,{class:"col",modelValue:a.value.familias.val,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.familias.val=t),options:Q.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:a.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(C,{class:"col",modelValue:a.value.categories.val,"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.categories.val=t),options:T.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:a.value.seccion.val.length==0||a.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(N,{color:"primary",label:a.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:O},null,8,["label"])]),_:1})]),_:1}),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(J,{rows:v.value,pagination:u.value.pagination,loading:h.value,columns:u.value.columns},{"top-right":m(()=>[o(N,{disable:v.value.length<=0,color:"primary",icon:"download",flat:"",onClick:x},null,8,["disable"])]),_:1},8,["rows","pagination","loading","columns"])]),_:1}))}};export{fe as default};
