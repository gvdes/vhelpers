import{u as se,a as ie,br as ne,r as y,c as E,o as v,d as p,w as i,k as m,g as o,e as s,X as de,j as r,W as d,ab as x,a1 as ue,h as U,Q as S,aa as re,ad as f,f as q,a0 as j,bI as ce,$ as A,Y as M}from"./index.52a3c292.js";import{d as ve,Q as pe}from"./QTable.73570121.js";import{Q as me}from"./QBanner.2b368927.js";import{Q as fe}from"./QBtnGroup.565355f1.js";import{Q as _e}from"./QPageSticky.668c143f.js";import{Q as xe}from"./QSelect.c9c7c333.js";import{Q as ge,a as F,b as w}from"./QList.cf079002.js";import{Q as ke}from"./QSpace.04d419b9.js";import{Q as be}from"./QFooter.8f5f450e.js";import{Q as ye}from"./QPage.a8a9aaec.js";import{C as we}from"./ClosePopup.db2b9d28.js";import"./QExpansionItem.e2dc76cf.js";import"./QDrawer.f2292652.js";import"./axios.172360c8.js";import{u as he}from"./use-quasar.c1be6315.js";import{P as Ce}from"./ProductsAutocomplete.9b309604.js";import{E as qe}from"./exceljs.min.9e24d01d.js";import{u as Pe}from"./Restock.170ea0d4.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.bb7ae945.js";import"./JsBarcode.cb858474.js";import"./dayjs.min.cbcf888d.js";import{$sktRestock as Qe}from"./socket.168d2ba4.js";import"./QForm.1a2130ab.js";import"./QBadge.4062affb.js";import{R as h}from"./RestockApi.980c5f3c.js";import"./QToolbar.a8883ef1.js";import"./QLinearProgress.4a89e476.js";import"./QResizeObserver.81625c6a.js";import"./QScrollObserver.c4256086.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";import"./QTd.afbd7c91.js";import"./QPopupEdit.8cd1a9d8.js";import"./QTr.16c6d951.js";import"./QLayout.1023dce7.js";/* empty css                                                       */const Se={class:"row items-stretch justify-between bg-primary text-white"},Ve={class:"row items-center col divlcient"},Ie={class:"q-pa-sm col text-center"},ze={class:"text-uppercase"},Fe={class:"q-pa-sm col text-center"},Ne={class:"text-bold"},Re={class:"q-pa-sm col text-center"},Be={class:"text-bold"},$e={class:"row items-center justify-between q-mt-sm"},De={class:"row text-center"},Ee={class:"q-px-md"},Ue={class:"text-bold"},je={class:"q-px-md"},Ae={class:"text-bold"},Me={class:"q-px-md"},Te={class:"text-bold"},Oe={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3"},Le={class:"row items-center q-pt-md"},Ke={class:"col q-px-md"},We={class:"text-bold"},Ye={class:"text--2"},Ge={class:"col q-px-md"},Je={class:"text-center"},Xe={class:"text--2"},He={class:"text-weight-bold"},Ze={class:"row q-pt-xs"},et={class:"row"},tt={class:"text-h6 col text-bold text-left"},lt={class:"text-h6 col text-bold text-right"},ot={class:"text-subtitle2 col"},at={class:"row items-end"},st={class:"text-center"},it={class:"col q-pa-xs"},nt={class:"col column q-py-md"},dt=["disabled"],ut={class:"col q-pa-xs"},rt={class:"text-bold text-red"},ct={class:"row q-ml-sm"},Jt={__name:"viewNewRequisition",setup(vt){const T=se(),u=he(),O=Pe(),N=ie(),V=ne(),n=y(null),C=y([]),l=y({state:!1,val:null,edit:!1}),k=y({state:!1,notfound:[],added:[]}),R=y(null),P=y({pagination:{rowsPerPage:16},filter:""}),c=y({_requisition:V.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null}),L=E(()=>{let a=l.value.val.pivot._supply_by==3?l.value.val.pivot.amount*l.value.val.pieces:l.value.val.pivot._supply_by==2?l.value.val.pivot.amount*12:l.value.val.pivot.amount;return l.value.val.pivot.units=a,a}),K=E(()=>{let a=l.value.val.pivot._supply_by==3?l.value.val.pivot.stock/l.value.val.pieces:l.value.val.pivot._supply_by==2?l.value.val.pivot.stock/12:l.value.val.pivot.stock;return l.value.val.pivot.units=a,a}),B=a=>a.pivot._supply_by==3?a.pivot.stock/a.pieces:a.pivot._supply_by==2?a.pivot.stock/12:a.pivot.stock,W=a=>{console.log(a),l.value.val=a,l.value.state=!0,l.value.edit=!0},Y=a=>{console.log(a);let t=n.value.products.findIndex(e=>e.id==a.id);console.log(t),t>=0?(l.value.val=n.value.products[t],l.value.state=!0,l.value.edit=!0):(l.value.edit=!1,l.value.val=a,c.value._product=ops.id,c.value._supply_by=ops._unit,c.value.ipack=ops.pieces,c.value.cost=ops.prices.find(e=>e.id==7).pivot.price,c.value.stock=ops.stocks.find(e=>e.id==n.value.to.id).pivot.stock,l.value.val.pivot=c.value,l.value.state=!0)},G=a=>{console.log(a);let t=n.value.products.findIndex(e=>e.id==a.id);console.log(t),t>=0?(l.value.val=n.value.products[t],console.log(l.value.val),l.value.state=!0,l.value.edit=!0):(l.value.val=a,c.value._product=a.id,c.value._supply_by=a._unit,c.value.ipack=a.pieces,c.value.cost=a.prices.find(e=>e.id==7).pivot.price,c.value.stock=a.stocks.find(e=>e.id==n.value.to.id).pivot.stock,l.value.val.pivot=c.value,l.value.edit=!1,l.value.state=!0)},J=async()=>{O.setShowLYT(!1),u.loading.show({message:"Obteniendo Pedido"});let a={workpoint:T.session.store.id_viz,folio:V.params.rid};const t=await h.getRequired(a);t.fail?console.log(t):(u.loading.hide(),console.log(t),n.value=t.order,C.value=t.units)},X=async()=>{u.loading.show({message:"Insertando Producto"}),l.value.val.pivot.total=l.value.val.pivot.units*l.value.val.pivot.cost;const a=await h.addProductRequired(l.value.val.pivot);a.fail?console.log(a):(console.log(a),u.loading.hide(),n.value.products.push(a),I())},H=async()=>{u.loading.show({message:"Editando Producto"}),l.value.val.pivot.total=l.value.val.pivot.units*l.value.val.pivot.cost;const a=await h.addProductRequired(l.value.val.pivot);if(a.fail)console.log(a);else{console.log(a),u.loading.hide();let t=n.value.products.findIndex(e=>e.id==l.value.val.id);n.value.products.splice(t,1,a),I()}},Z=async()=>{u.loading.show({message:"Eliminando Producto"});const a=await h.deleteProductRequired(l.value.val.pivot);if(a.fail)console.log(a);else{console.log(a),u.loading.hide();let t=n.value.products.findIndex(e=>e.id==l.value.val.id);n.value.products.splice(t,1),I()}},ee=()=>{R.value.click()},te=async()=>{let a=document.getElementById("inputFile").files[0],t=new qe.Workbook,e={};t.xlsx.load(a).then(async _=>{let z=t.worksheets[0],oe=z.getColumn("A");z.getColumn("B"),oe.eachCell({includeEmpty:!0},function(b,g){if(g===1)return;let Q=b.value,ae=z.getCell(`B${g}`),D=parseFloat(ae.value);Q&&(e[Q]?e[Q]+=D:e[Q]=D)});let $=Object.keys(e).map(b=>({codigo:b,cantidad:e[b]}));if($.length){let b={codes:$,_requisition:n.value.id};u.loading.show({message:"Procesando archivo, espera.."}),console.log(b);const g=await h.addMassiveProducts(b);g.fail?console.log(g):(console.log(g),n.value.products=g.products,k.value.state=!0,k.value.added=g.products,k.value.notfound=g.notFound,u.loading.hide())}else u.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},le=async()=>{u.loading.show({message:"Enviando Pedido"});const a=await h.nextStep({id:n.value.id});console.log(a),a.status==200?(console.log(a),u.notify({message:"Pedido Enviado :)",type:"positive",position:"center"}),N.push("/distribute/dashboardStore"),Qe.emit("order_refresh",{order:a.data.requisition}),u.loading.hide()):alert("Problema con el envio de el pedido ")},I=()=>{c.value={_requisition:V.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null},l.value={state:!1,val:null,edit:!1}};return J(),(a,t)=>n.value?(v(),p(ye,{key:0,padding:""},{default:i(()=>[o("div",Se,[s(r,{onClick:t[0]||(t[0]=()=>de(N).push("/distribute/dashboardStore")),flat:"",icon:"close",color:"white"}),o("div",Ve,[o("div",Ie,[t[9]||(t[9]=o("div",{class:"text--2"},"Destino:",-1)),o("div",ze,d(n.value.to.alias),1)]),o("div",Fe,[t[10]||(t[10]=o("div",{class:"text--2"},"Folio:",-1)),o("div",Ne,d(n.value.id),1)]),o("div",Re,[t[11]||(t[11]=o("div",{class:"text--2"},"Almacen:",-1)),o("div",Be,d(n.value._warehouse),1)])])]),o("div",$e,[o("div",De,[o("div",Ee,[t[12]||(t[12]=o("div",{class:"text--2"},"Modelos",-1)),o("span",Ue,d(n.value.products.length),1)]),o("div",je,[t[13]||(t[13]=o("div",{class:"text--2"},"Unidades",-1)),o("span",Ae,d(n.value.products.reduce((e,_)=>e+Number(_.pivot.units),0)),1)]),o("div",Me,[t[14]||(t[14]=o("div",{class:"text--2"},"Cajas",-1)),o("span",Te,d(n.value.products.reduce((e,_)=>e+Number(Number(_.pivot.units)/Number(_.pieces)),0)),1)])]),s(x,{spaced:"",inset:"",vertical:"",dark:""}),s(U,{dense:"",debounce:"300",modelValue:P.value.filter,"onUpdate:modelValue":t[1]||(t[1]=e=>P.value.filter=e),placeholder:"Buscar",class:"col-auto",outlined:""},{append:i(()=>[s(ue,{name:"search"})]),_:1},8,["modelValue"])]),s(x,{spaced:"",inset:"",vertical:"",dark:""}),s(pe,{grid:"",flat:"",dark:"","row-key":"id",rows:n.value.products,filter:P.value.filter,pagination:P.value.pagination},{item:i(e=>[o("div",Oe,[s(S,{class:"q-mb-sm q-mr-sm",onClick:_=>W(e.row)},{default:i(()=>[o("div",Le,[o("div",Ke,[o("div",We,d(e.row.code),1),o("div",null,d(e.row.name),1),o("div",Ye,d(e.row.description),1)])]),o("div",Ge,[s(ve,{flat:"",class:""},{default:i(()=>[o("thead",null,[o("tr",null,[o("th",null,"Sol. ("+d(C.value.find(_=>_.id==e.row.pivot._supply_by).name)+")",1),t[15]||(t[15]=o("th",null,"pzs / caj",-1)),o("th",null,"Disp. ("+d(C.value.find(_=>_.id==e.row.pivot._supply_by).name)+")",1)])]),o("tbody",null,[o("tr",Je,[o("td",null,d(e.row.pivot.amount),1),o("td",null,d(e.row.pieces),1),o("td",null,[o("span",{class:re(B(e.row)>=1?"text-green-10":"text-pink-10")},d(Math.round(B(e.row))),3)])])])]),_:2},1024)]),e.row.pivot.comments||e.row.pivot._supply_by?(v(),p(me,{key:0,rounded:"",class:""},{default:i(()=>[o("span",Xe,[t[16]||(t[16]=f(" Se surtira la cantidad de ")),o("span",He,d(e.row.pivot.units)+"pz",1),f(" correspondiente a la unidad de "+d(C.value.find(_=>_.id==e.row.pivot._supply_by).name)+" ",1),s(x,{dark:""}),f(" Notas: "+d(e.row.pivot.comments),1)])]),_:2},1024)):m("",!0)]),_:2},1032,["onClick"])])]),bottom:i(e=>[s(_e,{position:"bottom",class:"full-width",offset:[0,18]},{default:i(()=>[o("div",Ze,[s(fe,{rounded:"",class:""},{default:i(()=>[e.pagesNumber>2?(v(),p(r,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):m("",!0),s(r,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),s(r,{flat:"",disable:"","no-caps":""},{default:i(()=>[f(d(e.pagination.page)+" / "+d(e.pagesNumber),1)]),_:2},1024),s(r,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(v(),p(r,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):m("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","filter","pagination"]),s(M,{modelValue:l.value.state,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.state=e),position:"bottom"},{default:i(()=>[l.value.val?(v(),p(S,{key:0},{default:i(()=>[s(q,{class:"item-center"},{default:i(()=>[o("div",et,[o("div",tt,d(l.value.val.code),1),t[17]||(t[17]=o("div",{class:"text-subtitle2 col text-bold text-center"},null,-1)),o("div",lt,d(l.value.val.name),1)]),o("div",ot,d(l.value.val.description),1)]),_:1}),s(q,null,{default:i(()=>[o("div",at,[o("div",st,[o("div",it,[t[18]||(t[18]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),n.value.status.id==1?(v(),p(r,{key:0,flat:"",color:"positive",icon:"add",class:"text-h5",onClick:t[2]||(t[2]=e=>l.value.val.pivot.amount++)})):m("",!0),s(x,{spaced:"",inset:"",vertical:"",dark:""}),o("div",nt,[j(o("input",{type:"number",min:"1","onUpdate:modelValue":t[3]||(t[3]=e=>l.value.val.pivot.amount=e),class:"text-center exo clean-input",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"},disabled:n.value.status.id!=1},null,8,dt),[[ce,l.value.val.pivot.amount]])]),s(x,{spaced:"",inset:"",vertical:"",dark:""}),n.value.status.id==1?(v(),p(r,{key:1,flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:t[4]||(t[4]=e=>l.value.val.pivot.amount>1?l.value.val.pivot.amount--:"")})):m("",!0)])]),s(x,{spaced:"",inset:"",vertical:"",dark:""}),o("div",ut,[s(xe,{dense:"",filled:"",modelValue:l.value.val.units,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.val.units=e),options:C.value,label:"Surtir por","option-label":"name",disable:""},null,8,["modelValue","options"]),s(x,{spaced:"",inset:"",vertical:"",dark:""}),s(U,{dense:"",filled:"",modelValue:l.value.val.pivot.comments,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.val.pivot.comments=e),type:"text",label:"Notas"},null,8,["modelValue"]),s(x,{spaced:"",inset:"",vertical:"",dark:""}),s(ge,null,{default:i(()=>[s(F,{class:""},{default:i(()=>[s(w,{class:"text-left text-caption text-bold"},{default:i(()=>[f("STOCK "+d(l.value.val.stocks.find(e=>e.id==n.value.to.id).alias),1)]),_:1}),s(w,{class:"text-bold text-center"},{default:i(()=>[f(d(K.value)+" "+d(l.value.val.units.id==3?"Cjs":l.value.val.units.id==2?"Dcns":"Pzs"),1)]),_:1})]),_:1}),s(F,{class:""},{default:i(()=>[s(w,{class:"text-left text-caption"},{default:i(()=>t[19]||(t[19]=[f("P x C")])),_:1}),s(w,{class:"text-bold text-center"},{default:i(()=>[f(d(l.value.val.pieces)+" pzs",1)]),_:1})]),_:1}),s(F,null,{default:i(()=>[s(w,{class:"text-left text-caption"},{default:i(()=>t[20]||(t[20]=[f("Unidades")])),_:1}),s(w,{class:"text-bold text-center"},{default:i(()=>[f(d(L.value)+" pzs",1)]),_:1})]),_:1})]),_:1})])])]),_:1}),n.value.status.id==1?(v(),p(A,{key:0},{default:i(()=>[s(ke),l.value.edit?m("",!0):(v(),p(r,{key:0,flat:"",icon:"add",color:"positive",onClick:X})),l.value.edit?(v(),p(r,{key:1,flat:"",icon:"delete",color:"negative",onClick:Z})):m("",!0),l.value.edit?(v(),p(r,{key:2,flat:"",icon:"edit",color:"warning",onClick:H})):m("",!0)]),_:1})):m("",!0)]),_:1})):m("",!0)]),_:1},8,["modelValue"]),s(M,{modelValue:k.value.state,"onUpdate:modelValue":t[8]||(t[8]=e=>k.value.state=e),persistent:""},{default:i(()=>[s(S,null,{default:i(()=>[s(q,{class:"text-center text-h5 text-bold"},{default:i(()=>t[21]||(t[21]=[f(" Resultados de Importacion ")])),_:1}),s(q,{class:"text-centet text-h6 text-bold"},{default:i(()=>[f(" Correctos: "+d(k.value.added.length),1)]),_:1}),s(q,null,{default:i(()=>[t[22]||(t[22]=f(" Modelos sin Coincidencia: ")),o("span",rt,d(k.value.notfound),1)]),_:1}),s(A,{align:"right"},{default:i(()=>[j(s(r,{flat:"",label:"OK",color:"primary"},null,512),[[we]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n.value._status==1?(v(),p(be,{key:0,reveal:"",elevated:"",bordered:""},{default:i(()=>[s(x,{spaced:"",inset:"",vertical:"",dark:""}),o("div",ct,[o("div",null,[s(r,{icon:"upload",flat:"",onClick:ee})]),s(x,{spaced:"",inset:"",vertical:"",dark:""}),s(S,{class:"col"},{default:i(()=>[s(Ce,{checkState:!1,onInput:Y,with_prices_Invoice:"",with_stock_cedis:n.value.to.id,onAgregar:G,with_locations:""},null,8,["with_stock_cedis"])]),_:1}),s(x,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[n.value.products.length>0?(v(),p(r,{key:0,flat:"",icon:"send",onClick:le})):m("",!0)])]),s(x,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})):m("",!0),o("input",{type:"file",ref_key:"inputFile",ref:R,id:"inputFile",onInput:te,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1})):m("",!0)}};export{Jt as default};
