import{Q as B}from"./QInput.b8856860.js";import{Q as R}from"./QForm.5fd700d5.js";import{a as g,d as E}from"./QSelect.a465bb99.js";import{c as I,b as D,a as N}from"./QSeparator.cc594f43.js";import{Q as F}from"./QList.425ee15a.js";import{Q as A}from"./QTable.241b3670.js";import{Q as T}from"./QPage.6de0c99c.js";import{Q as z,a as k}from"./QCard.9a36efc8.js";import{aH as H,a as L,u as U,r as x,c as j,o as y,g as M,e,w as a,a3 as G,f as m,a5 as S,d as J,a6 as p,a0 as f,Q,a8 as K}from"./index.a996e2bc.js";import{Q as O}from"./QCardActions.25ca6b75.js";import{C as W}from"./ClosePopup.4a561a41.js";import"./dayjs.min.cbcf888d.js";import{R as v}from"./RestockApi.622b75bb.js";import{u as X}from"./Restock.69a5bf6b.js";import{u as Y}from"./axios.13708793.js";import{$sktRestock as C}from"./socket.3fae67a0.js";import{_ as Z}from"./PrinterSelect.5fd50aaf.js";import"./QLinearProgress.80ba80eb.js";import"./QCheckbox.27d249eb.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.3120f8e2.js";const tt={class:"flex justify-center"},et={class:"text-center",style:"width: 50%;"},ot={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},at={class:"text-bold"},Ct={__name:"driving",setup(it){H();const P=L(),d=X(),l=Y(),c=U(),r=x(null),V=x({rowsPerPage:[0]}),n=x({state:!1,val:null}),b=j(()=>d.partitions.filter(s=>{const t=["chf","amc","vld","root"].includes(c.session.rol),o=s.requisition.from.id==c.session.store.id_viz,i=s.requisition.to.id==c.session.store.id_viz,u=["gen","aux","alm","root"].includes(c.session.rol);return t&&i?s._status===6:o&&u?s._status===7:!1})),$=async()=>{d.setTitle("En Camino"),d.setButtonShow(!1)},q=async s=>{l.loading.show({message:"..."}),console.log(s.ip),console.log(n.value);const t=await v.printForPartition({ip:s.ip,port:s._port,_partition:n.value.val.id,_workpoint_to:n.value.val._workpoint_to});console.log(t),t.status==200?(t.data?l.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):l.notify({message:`Sin conexion a <b>${s.name} <small>(${s.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),l.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},w=async()=>{if(b.value.findIndex(t=>t.id==r.value)>=0){l.loading.show({message:"Cambiando Estado"});let t=Number(d.partitions.find(u=>u.id==r.value)._status)+Number(1),o={partition:r.value,chofi:c.session.credentials.staff.id,state:t};console.log(o);let i=null;if(t==7?i=await v.SaveChofi(o):t==8&&(i=await v.saveReceipt(o)),console.log(i),i.status==200){let u=d.partitions.findIndex(_=>_.id==i.data.partition.id);if(u>=0){if(d.partitions.splice(u,1,i.data.partition),i.data.partitionsEnd>i.data.partition.requisition._status){let _={id:i.data.partition._requisition,state:i.data.partitionsEnd};const h=await v.nextState(_);C.emit("order_refresh",{order:h.data}),console.log(h.data)}C.emit("orderpartition_refresh",{order:i.data.partition})}r.value=null,n.value={state:!1,val:null},t==8&&P.push("/distribute/checkin"),l.loading.hide()}else alert(`Error ${i.status}: ${i.data} 2`)}else l.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),r.value=null};return $(),(s,t)=>(y(),M(G,null,[e(T,{padding:""},{default:a(()=>[m("div",null,[m("div",tt,[m("div",et,[e(R,{onSubmit:w},{default:a(()=>[e(B,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),e(A,{rows:b.value,"row-key":"name",grid:"",pagination:V.value,"hide-bottom":""},{item:a(o=>[m("div",ot,[e(F,{bordered:""},{default:a(()=>[S((y(),J(N,{clickable:"",onClick:()=>{n.value.state=!0,n.value.val=o.row}},{default:a(()=>[e(D,null,{default:a(()=>[e(g,{class:"text-center text-bold"},{default:a(()=>[p(f(o.row.id),1)]),_:2},1024),e(g,{class:"text-center text-overline text-caption"},{default:a(()=>[m("span",at,f(o.row.requisition.from.name),1),p(" (P: "+f(o.row.requisition.id)+")",1)]),_:2},1024),e(g,{class:"text-center text-bold"},{default:a(()=>[p(f(o.row.status.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[K]])]),_:2},1024)])]),_:1},8,["rows","pagination"])])]),_:1}),e(I,{modelValue:n.value.state,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.state=o),persistent:""},{default:a(()=>[e(z,null,{default:a(()=>[e(k,{class:"text-bold text-h5 items-center"},{default:a(()=>[p(" Particion "+f(n.value.val.id),1)]),_:1}),e(k,{class:"text-center"},{default:a(()=>t[3]||(t[3]=[p(" Que Desesas Hacer ? ")])),_:1}),e(O,{align:"center"},{default:a(()=>[S(e(Q,{flat:"",icon:"close",color:"negative"},null,512),[[W]]),e(Q,{flat:"",icon:"print",color:"primary"},{default:a(()=>[e(E,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[e(Z,{onSelectedPartition:q,partition:!0})]),_:1})]),_:1}),e(Q,{flat:"",icon:"send",color:"positive",onClick:t[1]||(t[1]=()=>{r.value=n.value.val.id,w()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ct as default};
