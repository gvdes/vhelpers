import{c as v,i as z,D as J,j as g,Q as m,X as Y,bc as H,S as w,L as W,t as K,r as p,x as Z,k as ee,aH as le,a as ae,u as te,o as oe,d as ne,w as o,e as a,f as k,a0 as U,a4 as q,ak as D,a1 as $}from"./index.5bb28a0a.js";import{Q as F}from"./QInput.6125c91e.js";import{Q as ie}from"./QTable.cb0bc219.js";import{Q as h}from"./QCardSection.90e8692b.js";import{Q as N}from"./QForm.76688217.js";import{Q as P}from"./QCardActions.d4f6ccbe.js";import{Q as B}from"./QCard.6be7857a.js";import{f as se,i as re,l as de,Q as A}from"./QList.154f30c0.js";import{Q as ue}from"./QSelect.772f451f.js";import{l as ce}from"./use-key-composition.99e19843.js";import{Q as fe}from"./QPageSticky.28471259.js";import{Q as me}from"./QPage.fa97e3db.js";import{C as O}from"./ClosePopup.72c3434b.js";import"./dayjs.min.cbcf888d.js";import"./axios.23799c3f.js";import{o as j}from"./orderApi.c472f8e2.js";import{u as ve}from"./OrderStore.7007d462.js";import{u as be}from"./use-quasar.fd5e994b.js";import"./QExpansionItem.8f079acc.js";import"./QDrawer.98d4a3c3.js";/* empty css                                                                         */import{$sktOrders as R}from"./socket.05630e21.js";import"./QLinearProgress.4a8eccf3.js";import"./QCheckbox.b81d84eb.js";import"./use-checkbox.fe30a043.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.8816664c.js";import"./QScrollObserver.cd630382.js";const pe=["top","right","bottom","left"],E={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:l=>pe.includes(l)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function X(l,r){return{formClass:v(()=>`q-fab--form-${l.square===!0?"square":"rounded"}`),stacked:v(()=>l.externalLabel===!1&&["top","bottom"].includes(l.labelPosition)),labelProps:v(()=>{if(l.externalLabel===!0){const s=l.hideLabel===null?r.value===!1:l.hideLabel;return{action:"push",data:{class:[l.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${l.labelPosition}`+(s===!0?" q-fab__label--external-hidden":"")],style:l.labelStyle}}}return{action:["left","top"].includes(l.labelPosition)?"unshift":"push",data:{class:[l.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${l.labelPosition}`+(l.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:l.labelStyle}}})}}const G={start:"self-end",center:"self-center",end:"self-start"},ge=Object.keys(G);var M=z({name:"QFabAction",props:{...E,icon:{type:String,default:""},anchor:{type:String,validator:l=>ge.includes(l)},to:[String,Object],replace:Boolean},emits:["click"],setup(l,{slots:r,emit:s}){const i=J(H,()=>({showing:{value:!0},onChildClick:Y})),{formClass:y,labelProps:x}=X(l,i.showing),b=v(()=>{const u=G[l.anchor];return y.value+(u!==void 0?` ${u}`:"")}),c=v(()=>l.disable===!0||i.showing.value!==!0);function d(u){i.onChildClick(u),s("click",u)}function _(){const u=[];return r.icon!==void 0?u.push(r.icon()):l.icon!==""&&u.push(g(w,{name:l.icon})),(l.label!==""||r.label!==void 0)&&u[x.value.action](g("div",x.value.data,r.label!==void 0?r.label():[l.label])),W(r.default,u)}const C=K();return Object.assign(C.proxy,{click:d}),()=>g(m,{class:b.value,...l,noWrap:!0,stack:l.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:c.value,onClick:d},_)}});const _e=["up","right","down","left"],ye=["left","center","right"];var Ce=z({name:"QFab",props:{...E,...se,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{...E.hideLabel,default:null},direction:{type:String,default:"right",validator:l=>_e.includes(l)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:l=>ye.includes(l)}},emits:re,setup(l,{slots:r}){const s=p(null),i=p(l.modelValue===!0),y=ce(),{proxy:{$q:x}}=K(),{formClass:b,labelProps:c}=X(l,i),d=v(()=>l.persistent!==!0),{hide:_,toggle:C}=de({showing:i,hideOnRouteChange:d}),u=v(()=>({opened:i.value})),I=v(()=>`q-fab z-fab row inline justify-center q-fab--align-${l.verticalActionsAlign} ${b.value}`+(i.value===!0?" q-fab--opened":" q-fab--closed")),L=v(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${l.direction} q-fab__actions--${i.value===!0?"opened":"closed"}`),V=v(()=>{const f={id:y.value,role:"menu"};return i.value!==!0&&(f["aria-hidden"]="true"),f}),S=v(()=>`q-fab__icon-holder  q-fab__icon-holder--${i.value===!0?"opened":"closed"}`);function Q(f,t){const e=r[f],n=`q-fab__${f} absolute-full`;return e===void 0?g(w,{class:n,name:l[t]||x.iconSet.fab[t]}):g("div",{class:n},e(u.value))}function T(){const f=[];return l.hideIcon!==!0&&f.push(g("div",{class:S.value},[Q("icon","icon"),Q("active-icon","activeIcon")])),(l.label!==""||r.label!==void 0)&&f[c.value.action](g("div",c.value.data,r.label!==void 0?r.label(u.value):[l.label])),W(r.tooltip,f)}return Z(H,{showing:i,onChildClick(f){_(f),s.value!==null&&s.value.$el.focus()}}),()=>g("div",{class:I.value},[g(m,{ref:s,class:b.value,...l,noWrap:!0,stack:l.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":i.value===!0?"true":"false","aria-haspopup":"true","aria-controls":y.value,onClick:C},T),g("div",{class:L.value,...V.value},ee(r.default))])}});const he={class:"text-caption text-grey"},xe={class:"text-bold"},Se={class:"text-bold"},Ye={__name:"Preorders",setup(l){le();const r=ae(),s=ve();s.setTitle("PEDIDOS"),s.setshowLyt(!0);const i=be(),y=te(),x=p({rowsPerPage:20}),b=p({state:!1,val:null,opts:[]}),c=p({state:!1,val:null}),d=p({state:!1,order:{_created_by:y.session.credentials.staff.id_va,_workpoint:y.session.store.id_viz,name:null,_anex:null}}),_=p({state:!0,val:null,opts:[],filter:[]}),C=p({state:!1,val:null}),u=p({columns:[{name:"id",label:"FOLIO",field:t=>t.id,align:"left",sortable:!0},{name:"client",label:"CLIENTE",field:t=>t.name,align:"center",sortable:!0},{name:"status",label:"ESTADO",field:t=>{var e;return(e=t.status)==null?void 0:e.name},align:"center",classes:t=>`text-${I.value[t.status.id-1]}`,sortable:!0}],filter:null}),I=p(["grey-6","red-5","deep-orange-10","blue-4","blue-10","teal-4","teal-10","green-5","green-10","light-green-10"]),L=v(()=>s.orders.filter(t=>t.created_by.id==y.session.credentials.staff.id_va)),V=async()=>{i.loading.show({message:"Creando Pedido"}),console.log(d.value.order);const t=await j.create(d.value.order);t.fail?console.log(t):(R.emit("order_add",{order:t,user:s.socket_user.profile}),s.addOrUpdate({order:t}),i.notify({message:`El Pedido ${t.id} se creo`,type:"positive",position:"center"}),i.loading.hide(),r.push(`/preorders/pedidos/${t.id}`))},S=async()=>{i.loading.show({message:"Creando Pedido"}),console.log(d.value);const t=await j.create(d.value.order);console.log(t),t.fail?console.log(t):(R.emit("order_add",{order:t,user:s.socket_user.profile}),s.addOrUpdate({order:t}),i.notify({message:`El Pedido ${t.id} se creo`,type:"positive",position:"center"}),i.loading.hide(),r.push(`/preorders/pedidos/${t.id}`))},Q=(t,e)=>{e._status==1?r.push(`/preorders/pedidos/${e.id}`):(c.value.state=!0,c.value.val=e)},T=async()=>{i.loading.show({message:"Reimprimiendo"});let t={_order:c.value.val.id,_printer:s.printers.val.id};const e=await j.reimpresionClientTicket(t);e.fail?console.log(e):(b.value.state=!1,c.value.state=!1,c.value.val=null,i.loading.hide())},f=()=>{d.value.order._anex=c.value.val.id,c.value.state=!1,c.value.val=null,S()};return(t,e)=>(oe(),ne(me,{padding:""},{default:o(()=>[a(ie,{rows:L.value,columns:u.value.columns,filter:u.value.filter,onRowClick:Q,pagination:x.value},{"top-right":o(()=>[a(F,{borderless:"",dense:"",debounce:"300",modelValue:u.value.filter,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value.filter=n),placeholder:"Buscar"},{append:o(()=>[a(w,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter","pagination"]),a(A,{modelValue:d.value.state,"onUpdate:modelValue":e[3]||(e[3]=n=>d.value.state=n),persistent:""},{default:o(()=>[a(B,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white"},{default:o(()=>[a(w,{name:"list"}),e[12]||(e[12]=k("span",{class:"q-ml-sm"},"Nevo Pedido",-1))]),_:1}),a(h,null,{default:o(()=>[k("div",he,U(_.value.state?"Escribe Cliente":""),1),a(N,{onSubmit:V},{default:o(()=>[a(F,{modelValue:d.value.order.name,"onUpdate:modelValue":e[2]||(e[2]=n=>d.value.order.name=n),type:_.value.state?"text":"number",label:"Cliente"},{prepend:o(()=>[a(m,{color:"primary",icon:_.value.state?"person_add_disabled":"person_add",title:"client",flat:"",onClick:e[1]||(e[1]=n=>_.value.state=!_.value.state),disable:""},null,8,["icon"])]),_:1},8,["modelValue","type"])]),_:1})]),_:1}),a(P,{align:"right"},{default:o(()=>[q(a(m,{flat:"",title:"Cancelar",color:"negative",icon:"close"},null,512),[[O]]),a(m,{flat:"",color:"positive",icon:"check",onClick:V})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:C.value.state,"onUpdate:modelValue":e[5]||(e[5]=n=>C.value.state=n),persistent:""},{default:o(()=>[a(B,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white"},{default:o(()=>[a(w,{name:"post_add"}),e[13]||(e[13]=k("span",{class:"q-ml-sm"},"Nuevo Anexo",-1))]),_:1}),a(h,null,{default:o(()=>[a(N,{onSubmit:S},{default:o(()=>[a(F,{modelValue:d.value.order._anex,"onUpdate:modelValue":e[4]||(e[4]=n=>d.value.order._anex=n),type:"number",label:"Pedido"},null,8,["modelValue"])]),_:1})]),_:1}),a(P,{align:"right"},{default:o(()=>[q(a(m,{flat:"",title:"Cancelar",color:"negative",icon:"close"},null,512),[[O]]),a(m,{flat:"",color:"positive",icon:"check",onClick:S})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:c.value.state,"onUpdate:modelValue":e[7]||(e[7]=n=>c.value.state=n),persistent:""},{default:o(()=>[a(B,null,{default:o(()=>[a(h,{class:"text-h5"},{default:o(()=>[e[14]||(e[14]=D(" Cliente : ")),k("span",xe,U(c.value.val.name),1)]),_:1}),a(h,{class:"text-h6"},{default:o(()=>[e[15]||(e[15]=D(" Pedido : ")),k("span",Se,U(c.value.val.id),1)]),_:1}),a(P,{align:"right"},{default:o(()=>[q(a(m,{flat:"",icon:"close",color:"negative"},null,512),[[O]]),a(m,{flat:"",icon:"print",color:"positive",onClick:e[6]||(e[6]=n=>b.value.state=!b.value.state)}),a(m,{flat:"",label:"Anexo",color:"primary",onClick:f})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:b.value.state,"onUpdate:modelValue":e[9]||(e[9]=n=>b.value.state=n),persistent:""},{default:o(()=>[a(B,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white text-h6"},{default:o(()=>e[16]||(e[16]=[D(" Selecciona Impresora ")])),_:1}),a(h,{class:""},{default:o(()=>[a(ue,{modelValue:$(s).printers.val,"onUpdate:modelValue":e[8]||(e[8]=n=>$(s).printers.val=n),options:$(s).printers.opts.filter(n=>n._type==1),label:"Impresoras","option-label":"name",filled:""},null,8,["modelValue","options"])]),_:1}),a(P,{align:"right"},{default:o(()=>[q(a(m,{flat:"",label:"Cancelar",color:"primary"},null,512),[[O]]),a(m,{flat:"",label:"Imprimir",color:"primary",disabled:!$(s).printers.val,onClick:T},null,8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(fe,{position:"bottom-right",offset:[20,20]},{default:o(()=>[a(Ce,{color:"primary",icon:"add",direction:"up"},{default:o(()=>[a(M,{color:"primary",onClick:e[10]||(e[10]=n=>d.value.state=!d.value.state),icon:"add",label:"Pedido"}),a(M,{color:"primary",onClick:e[11]||(e[11]=n=>C.value.state=!C.value.state),icon:"post_add",label:"Anexo"})]),_:1})]),_:1})]),_:1}))}};export{Ye as default};
