import{Q as oe}from"./QHeader.93fdbd44.js";import{an as v,R as te,W as ae,a as le,u as se,r as Q,c as z,q as ie,z as re,O as ne,X as de,o as V,d as k,w as u,e as a,a4 as x,g as h,_ as A,j as w,k as E,a1 as M,Q as j,f as _,a2 as I,a3 as H,Y as ue,b5 as q,h as J}from"./index.221caa3e.js";import{Q as ce}from"./QToolbar.36905a19.js";import{Q as pe,a as fe}from"./QLayout.1b0d0afc.js";import{Q as me}from"./QDate.929773bd.js";import{Q as O}from"./QSelect.a5e41645.js";import{_ as ve}from"./UserToolbar.e72e9ac7.js";import{u as K}from"./Restock.13d2ea5f.js";import{d as ge}from"./dayjs.min.cbcf888d.js";import{R as C}from"./RestockApi.20b1bea4.js";import{u as ye}from"./use-quasar.ba838ac0.js";import{$sktRestock as i}from"./socket.cfd84d65.js";import"./QResizeObserver.5ced3230.js";import"./QScrollObserver.1d0c900e.js";import"./use-render-cache.3aae9b27.js";import"./date.2e409679.js";import"./QList.3f60b836.js";import"./QExpansionItem.80d01a08.js";import"./QDrawer.b431f3e9.js";import"./ClosePopup.00caced2.js";import"./auth.7cfa76c1.js";import"./axios.7cf70621.js";import"./QForm.c1bd9b44.js";import"./QTd.91c3f3ae.js";import"./QPopupEdit.559b3e15.js";import"./QTr.c9b41cb8.js";import"./QTable.958e2803.js";import"./QLinearProgress.f0c22688.js";import"./QPage.74a09cbe.js";import"./jspdf.plugin.autotable.2c427a54.js";import"./_commonjsHelpers.88e99c8f.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.125a354e.js";/* empty css                                                       */function be(p,r=document.body){if(typeof p!="string")throw new TypeError("Expected a string as propName");if(!(r instanceof Element))throw new TypeError("Expected a DOM element");return getComputedStyle(r).getPropertyValue(`--q-${p}`).trim()||null}let S;function we(){return v.is.winphone?"msapplication-navbutton-color":v.is.safari?"apple-mobile-web-app-status-bar-style":"theme-color"}function _e(p){const r=document.getElementsByTagName("META");for(const g in r)if(r[g].name===p)return r[g]}function he(p){S===void 0&&(S=we());let r=_e(S);const g=r===void 0;g&&(r=document.createElement("meta"),r.setAttribute("name",S)),r.setAttribute("content",p),g&&document.head.appendChild(r)}v.is.mobile===!0&&(v.is.nativeMobile===!0||v.is.winphone===!0||v.is.safari===!0||v.is.webkit===!0||v.is.vivaldi===!0)||te;const Ce={class:"text-bold"},Ve={class:"row"},ke={class:"col row"},Pe={class:"q-pa-md"},ro={__name:"distributeLYT",setup(p){const r=K();ae();const g=le(),s=K(),y=ye(),n=se(),b=Q(!1),t=Q({state:!1,folio:null,notes:null,types:{val:{id:1,label:"Manual"},opts:[{id:1,label:"Manual"},{id:3,label:"Venta"},{id:4,label:"Preventa"}]},suply_by:{val:null,opts:[]},warehouse:{val:{id:"GEN",label:"General"},opts:[{id:"GEN",label:"General"},{id:"EMP",label:"Empaques"}]}}),m=Q({val:{from:null,to:null}}),W={profile:{me:{id:n.session.credentials.staff.id_va,nick:n.session.credentials.nick,picture:"",names:n.session.credentials.staff.complete_name,surname_pat:"",surname_mat:"",change_password:!1,_rol:1},workpoint:n.session.store},workpoint:n.session.store},P=z(()=>y.platform.is.mobile),T=z(()=>{var e;return t.value.types.val.id==3&&((e=t.value.folio)==null?void 0:e.length)!=8?!0:t.value.types.val.id==4&&!t.value.folio}),X=z(()=>{var e;return t.value.types.val.id==3&&((e=t.value.folio)==null?void 0:e.length)!=8?"reduerda ingresar 0":t.value.types.val.id==4&&!t.value.folio?"debe de tener minimo un caracter":""}),U=async()=>{s.setShowLoad(!0),y.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let e=ge(new Date).format("YYYY/MM/DD");m.value.val={from:e,to:e};const o=await C.index({date:m.value.val,storeTo:n.session.store.id_viz});o.fail?console.log(o):(console.log(o),s.fillOrders(o.orders),s.fillResume(o.resume),s.fillPrinters(o.printers),s.fillPartitions(o.partitions),s.setShowLoad(!1),s.setCedis(o.cedis),t.value.suply_by.opts=o.cedis,t.value.suply_by.val=o.cedis[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),y.loading.hide())},Z=async()=>{b.value=!1,y.loading.show({message:"Obteniendo Datos"});const e=await C.index({date:m.value.val,storeTo:n.session.store.id_viz});console.log(e),s.fillOrders(e.orders),s.fillPartitions(e.partitions),console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),y.loading.hide()},ee=async()=>{y.loading.show({message:"Creando Pedido"}),t.value.workpointFrom=n.session.store.id_viz,t.value.created_by=n.session.credentials.staff.id_va,console.log(t.value);const e=await C.newRequisition(t.value);e.fail?console.log(e):(console.log(e),y.loading.hide(),i.emit("creating",{order:e.requisition}),t.value={state:!1,folio:null,notes:null,types:{val:{id:1,label:"Manual"},opts:[{id:1,label:"Manual"},{id:3,label:"Venta"},{id:4,label:"Preventa"}]},suply_by:{val:s.cedis[0],opts:s.cedis},warehouse:{val:{id:"GEN",label:"General"},opts:[{id:"GEN",label:"General"},{id:"EMP",label:"Empaques"}]}},g.push(`/distribute/dashboardStore/${e.requisition.id}`))},D=async e=>{if(console.log(e),e.order.requisition.to.id===n.session.store.id_viz||e.order.requisition.from.id===n.session.store.id_viz){e.order,console.log("Partition refresh!!",e);let o=e.order,c=e.order.id;s.addOrUpdatePartition(c,o),console.log(o),console.log(c);let l=s.ordersdb.find(d=>d.id==o._requisition).partition;console.log(l);let f=l.findIndex(d=>d.id==o.id);f>=0&&l.splice(f,1,o)}},R=e=>{console.log(`%c${e.user.me.nick} de ${e.from.alias} se ha unido a Restock (UID: ${e.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},B=async e=>{if(console.log(e),e.order.to.id===n.session.store.id_viz||e.order.from.id===n.session.store.id_viz){let o=e.order;console.log(e.order.to.id);let c=await C.orderFresh(o.id),l=c.data.order,f=c.data.oid;s.addOrUpdate(f,l)}},$=async e=>{if(console.log(e),e.requisition.to.id===n.session.store.id_viz||e.requisition.from.id===n.session.store.id_viz){console.log(e.requisition.to.id);let o=e,c=e.id;s.addOrUpdatePartition(c,o)}},N=async e=>{console.log(e);let o=e.id,c=e._requisition;s.deleteParition(o),s.deleteParitionOrder(o,c)},F=e=>{console.log(e),s.orderUpdate(e)},G=async e=>{if(e.order.to.id===n.session.store.id_viz){let o=e.order,c=e.state,l=await C.orderFresh(o.id),f=l.data.order,d=l.data.oid;s.addOrUpdate(d,f),c.id==2}},L=e=>{s.setStatusPartition(e)},Y=async e=>{var o;if(console.log(e),((o=e.order)==null?void 0:o.to.id)===n.session.store.id_viz||e.order.from.id===n.session.store.id_viz){console.log("REFRESHING BY SKT!!",e);let c=e.order,l=await C.orderFresh(c.id);console.log(l);let f=l.data.order;console.log(f.partition);let d=l.data.oid;s.addOrUpdate(d,f)}};return ie(async()=>{i.connect(),i.emit("joinat",W),i.on("joineddashreq",R),i.on("creating",B),i.on("order_update",F),i.on("order_changestate",G),i.on("order_refresh",Y),i.on("orderpartition_refresh",D),i.on("sktPartitionCreate",$),i.on("sktPartitionDelete",N),i.on("ChangeStatus",L),await re(),window.layoutReady=!0,await U(),window.dispatchEvent(new Event("layout-ready"))}),ne(()=>{i.off("joineddashreq",R),i.off("creating",B),i.off("order_update",F),i.off("order_changestate",G),i.off("order_refresh",Y),i.off("orderpartition_refresh",D),i.off("sktPartitionCreate",$),i.off("sktPartitionDelete",N),i.off("ChangeStatus",L)}),(e,o)=>{const c=de("router-view");return V(),k(pe,{view:"hHh Lpr fFf"},{default:u(()=>[a(oe,{class:"transparent",bordered:""},{default:u(()=>[a(ve)]),_:1}),a(fe,null,{default:u(()=>[x(s).showLYT?(V(),k(ce,{key:0,class:"row justify-between items-center"},{default:u(()=>[h("div",Ce,A(x(r).title),1),h("div",null,A(m.value.val&&m.value.val.from?`Del ${m.value.val.from} a ${m.value.val.to}`:m.value.val),1),h("div",Ve,[a(w,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:U}),h("div",ke,[x(r).showButton?(V(),k(w,{key:0,class:"col",color:"primary",icon:"event",onClick:o[0]||(o[0]=l=>b.value=!b.value),flat:"",round:""})):E("",!0),a(M,{spaced:"",inset:"",vertical:"",dark:""}),x(r).showButtonAdd?(V(),k(w,{key:1,class:"col",color:"primary",icon:"add",onClick:o[1]||(o[1]=l=>t.value.state=!t.value.state)})):E("",!0)])])]),_:1})):E("",!0),a(c)]),_:1}),a(H,{modelValue:b.value,"onUpdate:modelValue":o[4]||(o[4]=l=>b.value=l)},{default:u(()=>[a(j,{class:"my-card"},{default:u(()=>[a(_,null,{default:u(()=>[h("div",Pe,[o[12]||(o[12]=h("div",{class:"q-pb-sm text-center"},null,-1)),a(me,{modelValue:m.value.val,"onUpdate:modelValue":o[2]||(o[2]=l=>m.value.val=l),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),a(_,null,{default:u(()=>[a(I,{align:"right"},{default:u(()=>[a(w,{flat:"",icon:"close",color:"negative",onClick:o[3]||(o[3]=l=>b.value=!b.value)}),a(w,{flat:"",icon:"check",color:"positive",onClick:Z})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(H,{modelValue:t.value.state,"onUpdate:modelValue":o[11]||(o[11]=l=>t.value.state=l)},{default:u(()=>[a(j,{class:"my-card",style:{width:"400px","max-width":"50vw"}},{default:u(()=>{var l,f;return[a(_,{class:"text-center text-bold text-h6"},{default:u(()=>o[13]||(o[13]=[ue(" Nuevo Pedido ")])),_:1}),a(_,{class:q(P.value?"":"row")},{default:u(()=>[a(O,{class:q(P.value?"":"col"),modelValue:t.value.suply_by.val,"onUpdate:modelValue":o[5]||(o[5]=d=>t.value.suply_by.val=d),options:t.value.suply_by.opts,label:"Cedis",filled:"","option-label":"alias",dense:""},null,8,["class","modelValue","options"]),a(M,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{class:q(P.value?"":"col"),modelValue:t.value.warehouse.val,"onUpdate:modelValue":o[6]||(o[6]=d=>t.value.warehouse.val=d),options:t.value.warehouse.opts,label:"Almacen",filled:"",dense:""},null,8,["class","modelValue","options"]),a(M,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{class:q(P.value?"":"col"),modelValue:t.value.types.val,"onUpdate:modelValue":o[7]||(o[7]=d=>t.value.types.val=d),options:t.value.types.opts,label:"Tipo",filled:"",dense:""},null,8,["class","modelValue","options"])]),_:1},8,["class"]),((f=(l=t.value.types)==null?void 0:l.val)==null?void 0:f.id)!=1?(V(),k(_,{key:0},{default:u(()=>[a(J,{modelValue:t.value.folio,"onUpdate:modelValue":o[8]||(o[8]=d=>t.value.folio=d),type:t.value.types.val.id==3?"text":"number",label:t.value.types.val.id==3?"Ticket":"Folio",mask:t.value.types.val.id==3?"#-######":"",filled:"",dense:"",error:T.value,"error-message":X.value},null,8,["modelValue","type","label","mask","error","error-message"])]),_:1})):E("",!0),a(_,null,{default:u(()=>[a(J,{modelValue:t.value.notes,"onUpdate:modelValue":o[9]||(o[9]=d=>t.value.notes=d),type:"text",label:"Notas",filled:"",dense:""},null,8,["modelValue"])]),_:1}),a(_,null,{default:u(()=>[a(I,{align:"right"},{default:u(()=>[a(w,{flat:"",icon:"close",color:"negative",onClick:o[10]||(o[10]=d=>t.value.state=!t.value.state)}),a(w,{flat:"",icon:"check",color:"positive",onClick:ee,disable:T.value},null,8,["disable"])]),_:1})]),_:1})]}),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{ro as default};
