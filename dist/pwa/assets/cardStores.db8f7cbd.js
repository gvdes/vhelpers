import{Q as c}from"./position-engine.477eecf7.js";import{r as u,c as T,o as z,a as G,w as n,u as W,e as o,i as l,F as X,a4 as Q,f as m,Q as j}from"./index.84ff6bd8.js";import{Q as V}from"./QSelect.29b0699e.js";import{Q as B}from"./QInput.1bd81ffd.js";import{Q as Z}from"./QToolbar.65381e10.js";import{Q as ee}from"./QCardActions.01dd29ef.js";import{Q as R,a as g}from"./QCard.094e4bd8.js";import{Q as ae}from"./QForm.969acca9.js";import{Q as S}from"./QTable.53ed23a9.js";import{Q as te}from"./QPage.31af9ada.js";import{Q as oe,a as se}from"./QLayout.934e79ed.js";import{u as le}from"./VDB.cf078cd7.js";import{_ as ne}from"./UserToolbar.7be435cb.js";import{a as D}from"./axios.f1f32898.js";import{A as ie}from"./assistApi.1e6ecf0d.js";import{e as I}from"./export-file.dc78ba05.js";import{u as re}from"./use-quasar.381f8f97.js";import{d as ce}from"./date.6061c0be.js";import"./jspdf.plugin.autotable.4a076040.js";import"./QDialog.cfac2344.js";import"./QItem.f8eb2ffc.js";import"./QResizeObserver.1932a130.js";import"./QList.05e1aaf0.js";import"./QLinearProgress.ee056efd.js";import"./QCheckbox.8827020c.js";import"./axios.ae0a941c.js";import"./_commonjsHelpers.88e99c8f.js";const de=l("span",{class:"text-grey"},"Helpers",-1),ue=l("span",{class:"text-h6"},"Tarjetas",-1),me={class:"row"},pe={class:"q-mb-lg row"},fe=l("div",{class:"text-h6"},"Bauchers",-1),ve={class:"text-center text-h6"},he=l("div",{class:"text-h6"},"Cobros",-1),be={class:"text-center text-h6"},ge=l("div",{class:"text-h6"},"Diferencia",-1),_e={class:"text-center text-h6"},Ce={class:"row"},xe={class:"col"},Ae={class:"row"},Ee={class:"row"},Te={class:"col"},Se={class:"row"},ye={class:"col"},we={class:"row"},Ne={class:"col"},oa={__name:"cardStores",setup(ke){const y=le(),i=re(),$=W(),_=u(null),r=u([]),w=u([]),N=u(null),d=u({val:"SELECCIONA CAJA",opts:[]}),p=u({val:"SELECCIONA SUCURSAL",opts:[]}),x=u([{name:"bauchers",label:"Baucher",field:a=>a}]),v=u([{name:"terminal",label:"Caja",align:"left",field:a=>a.TERMINAL},{name:"ticket",label:"Ticket",field:a=>a.TICKET},{name:"total",label:"Total",field:a=>a.TARJETAS},{name:"fecha",label:"Fecha",field:a=>a.FECHA},{name:"hora",label:"Hora",field:a=>a.HORA},{name:"cliente",label:"Cliente",align:"left",field:a=>a.CLIENTE}]),h=T(()=>d.value.val?w.value.filter(a=>a.TERMINAL==d.value.val.DESTER):[]),k=T(()=>{if(r.value.length>0){let a=[...r.value];return h.value.filter(s=>{const e=a.indexOf(s.TARJETAS);return e!==-1?(a.splice(e,1),!0):!1})}else return[]}),A=T(()=>{if(r.value.length>0){let a=[...r.value];return h.value.filter(s=>{const e=a.indexOf(s.TARJETAS);return e!==-1?(a.splice(e,1),!1):!0})}else return h.value}),E=T(()=>{let a=[...h.value];return r.value.filter(s=>{const e=a.findIndex(t=>t.TARJETAS===s);return e!==-1?(a.splice(e,1),!1):!0})}),F=()=>{if(_.value){r.value.unshift(_.value),_.value=null;const a=P(E.value,A.value);a.length>0?(i.notify({message:`Se encontr\xF3 una coincidencia: Combinaci\xF3n: ${a[0].combinacion.map(s=>s).join(" + ")} = ${a[0].monto}, Ticket: ${a[0].ticket}`,type:"positive",position:"center"}),r.value.unshift(a[0].monto),a[0].combinacion.forEach(s=>{const e=r.value.findIndex(t=>t==s);e!==-1&&r.value.splice(e,1)})):console.log("No se encontraron coincidencias.")}},L=async()=>{const a=ce.formatDate(new Date,"YYYY-MM-DD");console.log("Recibiendo Datos :)"),i.loading.show({message:"Obteniendo datos"}),y.session.store.ip;const s=ie.index();console.log(s),s.then(e=>{console.log(e),N.value=a,p.value.opts=e,i.loading.hide()})},O=async a=>{console.log(a.ip_address),i.loading.show({message:"Obteniendo datos"});let s=`http://${a.ip_address}/access/public/reports/getCashCard`;D.get(s).then(e=>{console.log(e),d.value.val="SELECCIONA CAJA",w.value=e.data.formaspagos,d.value.opts=e.data.terminales,i.loading.hide()}).catch(e=>console.log(e))},J=async a=>{console.log(a),i.loading.show({message:"Obteniendo datos"});let s=`http://${p.value.val.ip_address}/access/public/reports/getCashCard/${a}`;D.get(s).then(e=>{console.log(e),d.value.val="SELECCIONA CAJA",w.value=e.data.formaspagos,d.value.opts=e.data.terminales,i.loading.hide()}).catch(e=>console.log(e))},U=()=>{const a=[x.value.map(e=>b(e.label))].concat(E.value.map(e=>x.value.map(t=>b(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);I("SobrantesBauchers.csv",a,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},H=()=>{const a=[v.value.map(e=>b(e.label))].concat(A.value.map(e=>v.value.map(t=>b(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);I("BucherFaltantes.csv",a,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},M=()=>{const a=[v.value.map(e=>b(e.label))].concat(k.value.map(e=>v.value.map(t=>b(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);I("BauchersEncontrados.csv",a,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},b=(a,s,e)=>{let t=s!==void 0?s(a,e):a;return t=t==null?"":String(t),t=t.split('"').join('""'),/^\d{1,2}-\d{4}$/.test(t)&&(t=`'${t}`),`"${t}"`},P=(a,s)=>{const e=q(a),t=[];return e.forEach(f=>{const Y=f.reduce((C,K)=>Number(C)+Number(K),0);s.forEach(C=>{C.TARJETAS==Y&&t.push({combinacion:f,ticket:C.TICKET,monto:C.TARJETAS})})}),t},q=a=>{const s=[];for(let e=0;e<1<<a.length;e++){const t=[];for(let f=0;f<a.length;f++)e&1<<f&&t.push(a[f]);t.length>0&&s.push(t)}return s};return y.session.rol=="root"||y.session.rol=="adm"?L():(i.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),$.replace("/")),(a,s)=>(z(),G(oe,{view:"hHh Lpr fFf"},{default:n(()=>[o(se,null,{default:n(()=>[o(te,{padding:""},{default:n(()=>[o(ee,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[o(ne),o(c),o(Z,{class:"justify-between"},{default:n(()=>[l("div",null,[de,o(X,{name:"navigate_next",color:"primary"}),ue]),l("div",me,[o(V,{modelValue:p.value.val,"onUpdate:modelValue":[s[0]||(s[0]=e=>p.value.val=e),O],options:p.value.opts,"option-label":"name",label:"Sucursal",outlined:"",dense:""},null,8,["modelValue","options"]),o(c,{spaced:"",inset:"",vertical:"",dark:""}),o(V,{modelValue:d.value.val,"onUpdate:modelValue":s[1]||(s[1]=e=>d.value.val=e),options:d.value.opts,"option-label":"DESTER",label:"Caja",outlined:"",dense:""},null,8,["modelValue","options"]),o(c,{spaced:"",inset:"",vertical:"",dark:""}),o(B,{modelValue:N.value,"onUpdate:modelValue":[s[2]||(s[2]=e=>N.value=e),J],type:"date",outlined:"",dense:"",disable:p.value.val==null||p.value.val=="SELECCIONA SUCURSAL"},null,8,["modelValue","disable"])])]),_:1})]),_:1}),l("div",pe,[o(R,{class:"my-card col",bordered:""},{default:n(()=>[o(g,null,{default:n(()=>[fe]),_:1}),o(g,null,{default:n(()=>[l("div",ve,"$ "+Q(r.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0)),1)]),_:1})]),_:1}),o(c,{spaced:"",inset:"",vertical:"",dark:""}),o(R,{class:"my-card col"},{default:n(()=>[o(g,null,{default:n(()=>[he]),_:1}),o(g,null,{default:n(()=>[l("div",be,"$ "+Q(m(h).reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0)),1)]),_:1})]),_:1}),o(c,{spaced:"",inset:"",vertical:"",dark:""}),o(R,{class:"my-card col"},{default:n(()=>[o(g,null,{default:n(()=>[ge]),_:1}),o(g,null,{default:n(()=>[l("div",_e,"$ "+Q(Number(Number(r.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0))-Number(m(h).reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0))).toFixed(2)),1)]),_:1})]),_:1})]),o(ae,{onSubmit:F,class:"q-gutter-md"},{default:n(()=>[o(B,{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=e=>_.value=e),type:"number",label:"IMPORTE",outlined:"",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md",disable:d.value.val=="SELECCIONA CAJA"},null,8,["modelValue","min","disable"])]),_:1}),o(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",Ce,[l("div",null,[o(S,{title:"LISTA",rows:r.value,"row-key":"name",columns:x.value,pagination:{rowsPerPage:9},"hide-bottom":""},null,8,["rows","columns"])]),o(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",xe,[l("div",Ae,[o(S,{title:"Bauchers Faltantes",rows:m(E),"row-key":"name",class:"col",columns:x.value},{"top-right":n(()=>[l("div",Ee,[o(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",Te,[o(j,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:U,disable:!(m(E).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"]),o(c,{spaced:"",inset:"",vertical:"",dark:""}),o(S,{title:"Cobros Faltantes",rows:m(A),"row-key":"name",class:"col",columns:v.value},{"top-right":n(()=>[l("div",Se,[o(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",ye,[o(j,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:H,disable:!(m(A).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])]),o(c,{spaced:"",inset:"",vertical:"",dark:""}),o(S,{title:"Cobros Encontrados",rows:m(k),"row-key":"name",columns:v.value},{"top-right":n(()=>[l("div",we,[o(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",Ne,[o(j,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:M,disable:!(m(k).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])])])]),_:1})]),_:1})]),_:1}))}};export{oa as default};
