import{Q as w}from"./QSeparator.5f295d7c.js";import{r as d,c as Q,o as A,a as k,w as l,aD as I,u as O,aV as P,e as o,i as r,Y as b,Q as v,f as E,h as M}from"./index.d5f50973.js";import{Q as R}from"./QSelect.3064671c.js";import{Q as D}from"./QToolbar.824680f5.js";import{Q as H}from"./QHeader.a42c1fd3.js";import{Q as S}from"./QInput.b34b987f.js";import{Q as L}from"./QTable.4cfac71c.js";import{Q as N}from"./QDate.ec0da845.js";import{Q as $,a as V}from"./QCard.70a1173a.js";import{Q as U}from"./QCardActions.b5daf9f8.js";import{Q as j}from"./QDialog.5b3742ec.js";import{Q as Y,a as G}from"./QLayout.db01bcad.js";import"./AppFullscreen.6bf56dd9.js";import{u as q}from"./use-quasar.9cca4b66.js";import"./auto.c5e70433.js";import{d as K}from"./dayjs.min.25545ff6.js";import{E as J}from"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.3aa5fe5f.js";import{_ as W}from"./UserToolbar.158fa8c3.js";import{A as z}from"./assistApi.38e3af0e.js";import{u as X}from"./VDB.68ede9ab.js";import{a as Z}from"./axios.f1f32898.js";import"./use-key-composition.f9415d84.js";import"./uid.42677368.js";import"./QItemSection.516a5973.js";import"./position-engine.f258a937.js";import"./rtl.b51694b1.js";import"./QResizeObserver.1715da82.js";import"./QList.8104b91d.js";import"./QLinearProgress.44cafaa7.js";import"./QCheckbox.c5a15059.js";import"./use-cache.b0833c75.js";import"./date.32f4595c.js";import"./_commonjsHelpers.88e99c8f.js";import"./ClosePopup.e83bfb80.js";import"./axios.76bdd693.js";const ee={class:"col"},oe=r("span",{class:"text-grey"},"Helpers",-1),ae=r("span",{class:"text-h6"},"Cajas Abiertas",-1),te={class:"col"},le={class:"row"},se=r("div",{class:"col"},null,-1),re={class:"row"},ne={class:"col"},ie={class:"q-pa-md"},ue=r("div",{class:"q-pb-sm"},null,-1),qe={__name:"BoxesReport",setup(me){const n=q();I();const T=O(),_=X(),u=d(!1),c=d(null),m=d({opts:[],val:null}),p=d({columns:[{name:"cash",label:"CAJA",field:e=>e.TERMINAL,align:"left",sortable:!0},{name:"ticket",label:"TICKET",field:e=>e.TICKET,align:"left",sortable:!0},{name:"cliet",label:"CLIENTE",field:e=>e.CLIENTE,align:"left",sortable:!0},{name:"date",label:"FECHA",field:e=>e.FECHA,align:"left",sortable:!0},{name:"hour",label:"HORA",field:e=>e.HORA,align:"left",sortable:!0},{name:"fop",label:"FORMA DE PAGO",field:e=>e.FORMA_PAGO,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:e=>parseFloat(e.IMPORTE),align:"left",sortable:!0}],pagination:{rowsPerPage:20},filter:""}),C=d([]),i=d({val:null,opts:[]});Q(()=>n.platform.is.mobile);const g=Q(()=>C.value.filter(e=>i.value.val?e.FORMA_PAGO==i.value.val.DESFPA:e)),y=async()=>{n.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const e=await z.index();if(!e.error){console.log(e),m.value.opts=e;let t=new Date,s=K(t).format("YYYY/MM/DD");c.value=s,console.log(s),n.loading.hide()}},h=async()=>{console.log(m.value.val.ip_address),n.loading.show({message:"Obteniendo Registros"}),console.log(c.value);let t=`http://${m.value.val.ip_address}/access/public/reports/getCashCob`;const s=await Z.post(t,{filt:c.value});s.status!=200?console.log(s):(console.log(s.data),C.value=s.data.formaspagos,i.value.opts=s.data.formas,u.value=!1,n.loading.hide())};_.session.rol==="adm"||_.session.rol==="root"?y():(n.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),T.replace("/"));const x=()=>{n.loading.show({message:"Importando Ticket"});const e=new J.Workbook;e.addWorksheet("Venta").addTable({name:"Venta",ref:"A1",headerRow:!0,totalsRow:!0,style:{showRowStripes:!0},columns:[{name:"Terminal",filterButton:!0},{name:"Tickets",filterButton:!0},{name:"Cliente",filterButton:!0},{name:"Fecha",filterButton:!0},{name:"Hora",filterButton:!0},{name:"Forma de Pago",filterButton:!0},{name:"Importe",filterButton:!0,totalsRowFunction:"sum"}],rows:g.value.map(a=>[a.TERMINAL,a.TICKET,a.CLIENTE,a.FECHA,a.HORA,a.FORMA_PAGO,parseFloat(a.IMPORTE)])}),(async()=>{const a=await e.xlsx.writeBuffer(),F=new Blob([a],{type:"application/octet-stream"}),B=URL.createObjectURL(F),f=document.createElement("a");f.href=B,f.download="ReporteCajas.xlsx",document.body.appendChild(f),f.click(),document.body.removeChild(f)})(),n.loading.hide()};return(e,t)=>{const s=P("router-view");return A(),k(Y,{view:"hHh Lpr fFf"},{default:l(()=>[o(G,null,{default:l(()=>[o(H,{class:"bg-grey-3 text-dark",bordered:""},{default:l(()=>[o(W),o(w),o(D,{class:"justify-between row"},{default:l(()=>[r("div",ee,[oe,o(b,{name:"navigate_next",color:"primary"}),ae]),r("div",te,[r("div",le,[se,o(v,{color:"primary",icon:"event",onClick:t[0]||(t[0]=a=>u.value=!u.value),flat:"",round:"",disable:!m.value.val},null,8,["disable"]),o(v,{color:"primary",icon:"download",onClick:x,flat:"",round:"",disable:E(g).length<=0},null,8,["disable"]),o(R,{class:"col",modelValue:m.value.val,"onUpdate:modelValue":[t[1]||(t[1]=a=>m.value.val=a),h],options:m.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),o(L,{title:"Tickets",rows:E(g),pagination:p.value.pagination,filter:p.value.filter,columns:p.value.columns},{"top-right":l(()=>[r("div",re,[r("div",ne,[o(S,{borderless:"",dense:"",debounce:"300",modelValue:p.value.filter,"onUpdate:modelValue":t[2]||(t[2]=a=>p.value.filter=a),placeholder:"Buscar"},{append:l(()=>[o(b,{name:"search"})]),_:1},8,["modelValue"])]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(R,{class:"col",modelValue:i.value.val,"onUpdate:modelValue":t[4]||(t[4]=a=>i.value.val=a),options:i.value.opts,label:"Formas de pago",filled:"","option-label":"DESFPA",dense:""},{append:l(()=>[i.value.val?(A(),k(b,{key:0,name:"close",onClick:t[3]||(t[3]=a=>i.value.val=null)})):M("",!0)]),_:1},8,["modelValue","options"])])]),_:1},8,["rows","pagination","filter","columns"]),o(j,{modelValue:u.value,"onUpdate:modelValue":t[7]||(t[7]=a=>u.value=a)},{default:l(()=>[o($,{class:"my-card"},{default:l(()=>[o(V,null,{default:l(()=>[r("div",ie,[ue,o(N,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=a=>c.value=a),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(V,null,{default:l(()=>[o(U,{align:"right"},{default:l(()=>[o(v,{flat:"",icon:"close",color:"negative",onClick:t[6]||(t[6]=a=>u.value=!u.value)}),o(v,{flat:"",icon:"check",color:"positive",onClick:h})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(s)]),_:1})]),_:1})}}};export{qe as default};
