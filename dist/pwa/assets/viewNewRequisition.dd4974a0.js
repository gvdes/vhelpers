import{u as se,a as ae,aH as ie,r as y,c as E,o as _,d as x,w as i,h as g,f as o,e as a,a1 as ne,Q as r,a0 as n,an as de,ak as v,a4 as A,b9 as ue}from"./index.44dd17ce.js";import{b as m,a as re,d as F,e as w,Q as U}from"./QList.07d01330.js";import{b as ce,Q as ve}from"./QTable.8ba9b0ac.js";import{Q as pe}from"./QBanner.913bab84.js";import{Q as P}from"./QCard.9a73268d.js";import{Q as me}from"./QBtnGroup.35358657.js";import{Q as fe}from"./QPageSticky.609687bb.js";import{Q}from"./QCardSection.1b402229.js";import{Q as _e}from"./QSelect.32f0280a.js";import{Q as xe}from"./QInput.fdac79bb.js";import{Q as ge}from"./QSpace.1bc90227.js";import{Q as j}from"./QCardActions.bb5ccb52.js";import{Q as ke}from"./QFooter.18702ec3.js";import{Q as be}from"./QPage.7cdb3ef3.js";import{C as ye}from"./ClosePopup.007cabb9.js";import"./QExpansionItem.9acb6126.js";import"./QDrawer.b92b82c8.js";import"./axios.7541ab4d.js";import{u as we}from"./use-quasar.c133d20e.js";import{P as he}from"./ProductsAutocomplete.3c66cc2f.js";import{E as Ce}from"./exceljs.min.9e24d01d.js";import{u as Qe}from"./Restock.f77090ce.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.2603270f.js";import"./JsBarcode.cb858474.js";import"./dayjs.min.cbcf888d.js";import{$sktRestock as qe}from"./socket.05630e21.js";import"./QForm.b2131ec3.js";import"./QBadge.05877638.js";import{R as h}from"./RestockApi.d954ef01.js";import"./QToolbar.73e8df4c.js";import"./use-key-composition.60d4783d.js";import"./QLinearProgress.0f8be444.js";import"./QCheckbox.5815e5d8.js";import"./use-checkbox.aa93c2d3.js";import"./QResizeObserver.cbb5bb61.js";import"./QScrollObserver.7851f44e.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";import"./QRadio.e48434a8.js";import"./QTd.4205474d.js";import"./QPopupEdit.e9e94dc1.js";import"./QTr.3ae45880.js";import"./QLayout.b19ee5dd.js";/* empty css                                                       */const Pe={class:"row items-stretch justify-between bg-primary text-white"},Se={class:"row items-center col divlcient"},Ve={class:"q-pa-sm col text-center"},Ie={class:"text-uppercase"},ze={class:"q-pa-sm col text-center"},Fe={class:"text-bold"},Ne={class:"q-pa-sm col text-center"},Re={class:"text-bold"},Be={class:"row items-center justify-between q-mt-sm"},De={class:"row text-center"},$e={class:"q-px-md"},Ee={class:"text-bold"},Ae={class:"q-px-md"},Ue={class:"text-bold"},je={class:"q-px-md"},Me={class:"text-bold"},Te={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3"},Oe={class:"row items-center q-pt-md"},Le={class:"col q-px-md"},Ke={class:"text-bold"},Ge={class:"text--2"},He={class:"col q-px-md"},Je={class:"text-center"},We={class:"text--2"},Ye={class:"text-weight-bold"},Xe={class:"row q-pt-xs"},Ze={class:"row"},et={class:"text-h6 col text-bold text-left"},tt={class:"text-h6 col text-bold text-right"},lt={class:"text-subtitle2 col"},ot={class:"row items-end"},st={class:"text-center"},at={class:"col q-pa-xs"},it={class:"col column q-py-md"},nt={class:"col q-pa-xs"},dt={class:"text-bold text-red"},ut={class:"row q-ml-sm"},ll={__name:"viewNewRequisition",setup(rt){const M=se(),u=we(),T=Qe(),S=ae(),V=ie(),d=y(null),C=y([]),t=y({state:!1,val:null,edit:!1}),k=y({state:!1,notfound:[],added:[]}),N=y(null),R=y({pagination:{rowsPerPage:16},filter:""}),c=y({_requisition:V.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null}),O=E(()=>{let s=t.value.val.pivot._supply_by==3?t.value.val.pivot.amount*t.value.val.pieces:t.value.val.pivot._supply_by==2?t.value.val.pivot.amount*12:t.value.val.pivot.amount;return t.value.val.pivot.units=s,s}),L=E(()=>{let s=t.value.val.pivot._supply_by==3?t.value.val.pivot.stock/t.value.val.pieces:t.value.val.pivot._supply_by==2?t.value.val.pivot.stock/12:t.value.val.pivot.stock;return t.value.val.pivot.units=s,s}),B=s=>s.pivot._supply_by==3?s.pivot.stock/s.pieces:s.pivot._supply_by==2?s.pivot.stock/12:s.pivot.stock,K=s=>{console.log(s),t.value.val=s,t.value.state=!0,t.value.edit=!0},G=s=>{console.log(s);let l=d.value.products.findIndex(e=>e.id==s.id);console.log(l),l>=0?(t.value.val=d.value.products[l],t.value.state=!0,t.value.edit=!0):(t.value.edit=!1,t.value.val=s,c.value._product=ops.id,c.value._supply_by=ops._unit,c.value.ipack=ops.pieces,c.value.cost=ops.prices.find(e=>e.id==7).pivot.price,c.value.stock=ops.stocks.find(e=>e.id==d.value.to.id).pivot.stock,t.value.val.pivot=c.value,t.value.state=!0)},H=s=>{console.log(s);let l=d.value.products.findIndex(e=>e.id==s.id);console.log(l),l>=0?(t.value.val=d.value.products[l],console.log(t.value.val),t.value.state=!0,t.value.edit=!0):(t.value.val=s,c.value._product=s.id,c.value._supply_by=s._unit,c.value.ipack=s.pieces,c.value.cost=s.prices.find(e=>e.id==7).pivot.price,c.value.stock=s.stocks.find(e=>e.id==d.value.to.id).pivot.stock,t.value.val.pivot=c.value,t.value.edit=!1,t.value.state=!0)},J=async()=>{T.setShowLYT(!1),u.loading.show({message:"Obteniendo Pedido"});let s={workpoint:M.session.store.id_viz,folio:V.params.rid};const l=await h.getRequired(s);l.fail?console.log(l):(u.loading.hide(),console.log(l),d.value=l.order,C.value=l.units,d.value._status!=1&&S.push("/distribute/dashboardStore"))},W=async()=>{u.loading.show({message:"Insertando Producto"}),t.value.val.pivot.total=t.value.val.pivot.units*t.value.val.pivot.cost;const s=await h.addProductRequired(t.value.val.pivot);s.fail?console.log(s):(console.log(s),u.loading.hide(),d.value.products.push(s),I())},Y=async()=>{u.loading.show({message:"Editando Producto"}),t.value.val.pivot.total=t.value.val.pivot.units*t.value.val.pivot.cost;const s=await h.addProductRequired(t.value.val.pivot);if(s.fail)console.log(s);else{console.log(s),u.loading.hide();let l=d.value.products.findIndex(e=>e.id==t.value.val.id);d.value.products.splice(l,1,s),I()}},X=async()=>{u.loading.show({message:"Eliminando Producto"});const s=await h.deleteProductRequired(t.value.val.pivot);if(s.fail)console.log(s);else{console.log(s),u.loading.hide();let l=d.value.products.findIndex(e=>e.id==t.value.val.id);d.value.products.splice(l,1),I()}},Z=()=>{N.value.click()},ee=async()=>{let s=document.getElementById("inputFile").files[0],l=new Ce.Workbook,e={};l.xlsx.load(s).then(async p=>{let z=l.worksheets[0],le=z.getColumn("A");z.getColumn("B"),le.eachCell({includeEmpty:!0},function(b,f){if(f===1)return;let q=b.value,oe=z.getCell(`B${f}`),$=parseFloat(oe.value);q&&(e[q]?e[q]+=$:e[q]=$)});let D=Object.keys(e).map(b=>({codigo:b,cantidad:e[b]}));if(D.length){let b={codes:D,_requisition:d.value.id};u.loading.show({message:"Procesando archivo, espera.."}),console.log(b);const f=await h.addMassiveProducts(b);f.fail?console.log(f):(console.log(f),d.value.products=f.products,k.value.state=!0,k.value.added=f.products,k.value.notfound=f.notFound,u.loading.hide())}else u.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},te=async()=>{u.loading.show({message:"Enviando Pedido"});const s=await h.nextStep({id:d.value.id});console.log(s),s.status==200?(console.log(s),u.notify({message:"Pedido Enviado :)",type:"positive",position:"center"}),S.push("/distribute/dashboardStore"),qe.emit("order_refresh",{order:s.data.requisition}),u.loading.hide()):alert("Problema con el envio de el pedido ")},I=()=>{c.value={_requisition:V.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null},t.value={state:!1,val:null,edit:!1}};return J(),(s,l)=>d.value?(_(),x(be,{key:0,padding:""},{default:i(()=>[o("div",Pe,[a(r,{onClick:l[0]||(l[0]=()=>ne(S).push("/distribute/dashboardStore")),flat:"",icon:"close",color:"white"}),o("div",Se,[o("div",Ve,[l[8]||(l[8]=o("div",{class:"text--2"},"Destino:",-1)),o("div",Ie,n(d.value.to.alias),1)]),o("div",ze,[l[9]||(l[9]=o("div",{class:"text--2"},"Folio:",-1)),o("div",Fe,n(d.value.id),1)]),o("div",Ne,[l[10]||(l[10]=o("div",{class:"text--2"},"Almacen:",-1)),o("div",Re,n(d.value._warehouse),1)])])]),o("div",Be,[o("div",De,[o("div",$e,[l[11]||(l[11]=o("div",{class:"text--2"},"Modelos",-1)),o("span",Ee,n(d.value.products.length),1)]),o("div",Ae,[l[12]||(l[12]=o("div",{class:"text--2"},"Unidades",-1)),o("span",Ue,n(d.value.products.reduce((e,p)=>e+Number(p.pivot.units),0)),1)]),o("div",je,[l[13]||(l[13]=o("div",{class:"text--2"},"Cajas",-1)),o("span",Me,n(d.value.products.reduce((e,p)=>e+Number(Number(p.pivot.units)/Number(p.pieces)),0)),1)])])]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(ve,{grid:"",flat:"",dark:"","row-key":"id",rows:d.value.products,filter:R.value.filter,pagination:R.value.pagination},{item:i(e=>[o("div",Te,[a(P,{class:"q-mb-sm q-mr-sm",onClick:p=>K(e.row)},{default:i(()=>[o("div",Oe,[o("div",Le,[o("div",Ke,n(e.row.code),1),o("div",null,n(e.row.name),1),o("div",Ge,n(e.row.description),1)])]),o("div",He,[a(ce,{flat:"",class:""},{default:i(()=>[o("thead",null,[o("tr",null,[o("th",null,"Sol. ("+n(C.value.find(p=>p.id==e.row.pivot._supply_by).name)+")",1),l[14]||(l[14]=o("th",null,"pzs / caj",-1)),o("th",null,"Disp. ("+n(C.value.find(p=>p.id==e.row.pivot._supply_by).name)+")",1)])]),o("tbody",null,[o("tr",Je,[o("td",null,n(e.row.pivot.amount),1),o("td",null,n(e.row.pieces),1),o("td",null,[o("span",{class:de(B(e.row)>=1?"text-green-10":"text-pink-10")},n(Math.round(B(e.row))),3)])])])]),_:2},1024)]),e.row.pivot.comments||e.row.pivot._supply_by?(_(),x(pe,{key:0,rounded:"",class:""},{default:i(()=>[o("span",We,[l[15]||(l[15]=v(" Se surtira la cantidad de ")),o("span",Ye,n(e.row.pivot.units)+"pz",1),v(" correspondiente a la unidad de "+n(C.value.find(p=>p.id==e.row.pivot._supply_by).name)+" ",1),a(m,{dark:""}),v(" Notas: "+n(e.row.pivot.comments),1)])]),_:2},1024)):g("",!0)]),_:2},1032,["onClick"])])]),bottom:i(e=>[a(fe,{position:"bottom",class:"full-width",offset:[0,18]},{default:i(()=>[o("div",Xe,[a(me,{rounded:"",class:""},{default:i(()=>[e.pagesNumber>2?(_(),x(r,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):g("",!0),a(r,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),a(r,{flat:"",disable:"","no-caps":""},{default:i(()=>[v(n(e.pagination.page)+" / "+n(e.pagesNumber),1)]),_:2},1024),a(r,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(_(),x(r,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):g("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","filter","pagination"]),a(U,{modelValue:t.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>t.value.state=e),position:"bottom"},{default:i(()=>[t.value.val?(_(),x(P,{key:0},{default:i(()=>[a(Q,{class:"item-center"},{default:i(()=>[o("div",Ze,[o("div",et,n(t.value.val.code),1),l[16]||(l[16]=o("div",{class:"text-subtitle2 col text-bold text-center"},null,-1)),o("div",tt,n(t.value.val.name),1)]),o("div",lt,n(t.value.val.description),1)]),_:1}),a(Q,null,{default:i(()=>[o("div",ot,[o("div",st,[o("div",at,[l[17]||(l[17]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),a(r,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:l[1]||(l[1]=e=>t.value.val.pivot.amount++)}),a(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",it,[A(o("input",{type:"number",min:"1","onUpdate:modelValue":l[2]||(l[2]=e=>t.value.val.pivot.amount=e),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[ue,t.value.val.pivot.amount]])]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(r,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:l[3]||(l[3]=e=>t.value.val.pivot.amount>1?t.value.val.pivot.amount--:"")})])]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",nt,[a(_e,{dense:"",filled:"",modelValue:t.value.val.units,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.val.units=e),options:C.value,label:"Surtir por","option-label":"name",disable:""},null,8,["modelValue","options"]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(xe,{dense:"",filled:"",modelValue:t.value.val.pivot.comments,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.val.pivot.comments=e),type:"text",label:"Notas"},null,8,["modelValue"]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(re,null,{default:i(()=>[a(F,{class:"bg-grey-11"},{default:i(()=>[a(w,{class:"text-left text-caption text-bold"},{default:i(()=>[v("STOCK "+n(t.value.val.stocks.find(e=>e.id==d.value.to.id).alias),1)]),_:1}),a(w,{class:"text-bold text-center"},{default:i(()=>[v(n(L.value)+" "+n(t.value.val.units.id==3?"Cjs":t.value.val.units.id==2?"Dcns":"Pzs"),1)]),_:1})]),_:1}),a(F,{class:"bg-grey-11"},{default:i(()=>[a(w,{class:"text-left text-caption"},{default:i(()=>l[18]||(l[18]=[v("P x C")])),_:1}),a(w,{class:"text-bold text-center"},{default:i(()=>[v(n(t.value.val.pieces)+" pzs",1)]),_:1})]),_:1}),a(F,null,{default:i(()=>[a(w,{class:"text-left text-caption"},{default:i(()=>l[19]||(l[19]=[v("Unidades")])),_:1}),a(w,{class:"text-bold text-center"},{default:i(()=>[v(n(O.value)+" pzs",1)]),_:1})]),_:1})]),_:1})])])]),_:1}),a(j,null,{default:i(()=>[a(ge),t.value.edit?g("",!0):(_(),x(r,{key:0,flat:"",icon:"add",color:"positive",onClick:W})),t.value.edit?(_(),x(r,{key:1,flat:"",icon:"delete",color:"negative",onClick:X})):g("",!0),t.value.edit?(_(),x(r,{key:2,flat:"",icon:"edit",color:"warning",onClick:Y})):g("",!0)]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),a(U,{modelValue:k.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>k.value.state=e),persistent:""},{default:i(()=>[a(P,null,{default:i(()=>[a(Q,{class:"text-center text-h5 text-bold"},{default:i(()=>l[20]||(l[20]=[v(" Resultados de Importacion ")])),_:1}),a(Q,{class:"text-centet text-h6 text-bold"},{default:i(()=>[v(" Correctos: "+n(k.value.added.length),1)]),_:1}),a(Q,null,{default:i(()=>[l[21]||(l[21]=v(" Modelos sin Coincidencia: ")),o("span",dt,n(k.value.notfound),1)]),_:1}),a(j,{align:"right"},{default:i(()=>[A(a(r,{flat:"",label:"OK",color:"primary"},null,512),[[ye]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ke,{reveal:"",elevated:"",bordered:""},{default:i(()=>[a(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",ut,[o("div",null,[a(r,{icon:"upload",flat:"",onClick:Z})]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(P,{class:"col"},{default:i(()=>[a(he,{checkState:!1,onInput:G,with_prices_Invoice:"",with_stock_cedis:d.value.to.id,onAgregar:H,with_locations:""},null,8,["with_stock_cedis"])]),_:1}),a(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[d.value.products.length>0?(_(),x(r,{key:0,flat:"",icon:"send",onClick:te})):g("",!0)])]),a(m,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),o("input",{type:"file",ref_key:"inputFile",ref:N,id:"inputFile",onInput:ee,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1})):g("",!0)}};export{ll as default};
