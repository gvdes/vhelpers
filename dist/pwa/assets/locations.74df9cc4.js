import{Q as ee}from"./QSelect.de9b0e9c.js";import{b as x,Q as le}from"./QList.2172113d.js";import{u as de,r as p,l as ve,o as u,d as w,w as s,e as t,g as V,a3 as _,a2 as U,f as D,Q as h,h as E,ak as y,a0 as Q,a4 as L,aA as me}from"./index.79532f50.js";import{Q as N}from"./QTd.9d61fc44.js";import{Q as M}from"./QTr.e26388d2.js";import{Q as T}from"./QTable.d9fa63e5.js";import{Q as m}from"./QCardSection.c1600f9f.js";import{Q as O}from"./QCard.15c77405.js";import{Q as z}from"./QInput.65f38d14.js";import{Q as ae}from"./QRadio.2d7c364d.js";import{Q as te}from"./QCardActions.42848105.js";import{Q as pe}from"./QPage.b7a4f930.js";import{C as oe}from"./ClosePopup.cb3afb10.js";import"./QDrawer.3ed0b678.js";import"./axios.f1636173.js";import{u as fe}from"./use-quasar.c5f5d80c.js";import{u as ge}from"./warehousStore.f3183dcc.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.5f1142bd.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as R}from"./locationsApi.a4b4cfbb.js";import"./QLinearProgress.6e300efc.js";import"./QCheckbox.cfd661e2.js";import"./QResizeObserver.18d4182c.js";import"./QScrollObserver.980449b1.js";import"./_commonjsHelpers.88e99c8f.js";const be={key:0,class:"row"},Ve={class:"row"},he={class:"text-right row"},we={class:"text-bold"},Xe={__name:"locations",setup(ye){const j=de(),f=fe();ge().setTitle("Ubicaciones Estructura");const $=p([]),i=p(null),a=p({state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]}),r=p({state:!1,val:null}),C=p([]),c=p([]),F=p(0),P=p({columns:[{name:"id",label:"ID",field:o=>o.id,align:"center"},{name:"name",label:"NOMBRE",field:o=>o.name,align:"left"},{name:"alias",label:"ALIAS",field:o=>o.alias,align:"left"},{name:"path",label:"PATH",field:o=>o.path,align:"left"}]}),se=async()=>{f.loading.show({message:"Obteniendo Secciones"});const o=await R.index(j.session.store.id_viz);o.fail?console.log(o):$.value=o,f.loading.hide()},q=()=>{const o=i.value.sections||[];F.value=Math.max(...o.map(l=>l.deep)),c.value=[{options:o.filter(l=>l.root===0),selected:null}],C.value=c.value[0].options},S=o=>{var l;return((l=i.value.sections)==null?void 0:l.filter(e=>e.root===o))||[]},ne=(o,l)=>{c.value.splice(l+1);const e=S(o);e.length>0&&c.value.push({options:e,selected:null})},ue=()=>{const o=c.value.filter(l=>l.selected!==null);if(!o.length)console.log("crear una raiz"),a.value.state=!0,a.value.val=i.value,a.value.type=!0;else{console.log("crear hijos");const l=o[o.length-1],e=l.selected,n=l.options.find(d=>d.id===e);a.value.state=!0,a.value.val=n,a.value.type=!1}},ie=async()=>{f.loading.show({message:"Enviando Datos"}),a.value.defaultView.forEach(e=>{e.root=a.value.type?0:a.value.val.id,e.deep=a.value.type?0:Number(a.value.val.deep)+1,e._celler=a.value.type?a.value.val.id:a.value.val._celler,e.details={create:j.session.credentials.nick}}),console.log(a.value);let o={sections:a.value.defaultView};const l=await R.insertSection(o);l.fail?console.log(l):(console.log(l),l.forEach(n=>{console.log(n),a.value.type?C.value.push(n):i.value.sections.push(n)}),f.notify({message:"Secciones Creadas",type:"positive",position:"bottom"}),f.loading.hide(),a.value={state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]})},H=o=>{const l=S(o.id);return{...o,pivot:l.map(e=>H(e))}},re=o=>{let l=H(o);console.log(l),r.value.state=!0,r.value.val=l},ce=async()=>{f.loading.show({message:"eliminando Seccion"}),console.log(r.value.val),console.log(i.value);const o=await R.deleteSection(r.value.val);o.fail?console.log(o):(console.log(o),i.value.sections=i.value.sections.filter(l=>!o.ids.includes(l.id)),q(),r.value={state:!1,val:null},f.loading.hide())};return se(),ve(()=>[c.value.map(o=>o.selected),a.value.create.name,a.value.create.alias,a.value.create.elementos,a.value.secuence],([o,l,e,n,d])=>{var W,G,J,K,X,Y;const A=c.value.filter(g=>g.selected!==null);if(A.length){const g=A[A.length-1],k=S(g.selected);C.value=k}else C.value=((W=c.value[0])==null?void 0:W.options)||[];if(!l||!e){a.value.defaultView=[];return}const I=[];if(d){console.log(a.value.type);let g=null;a.value.type?g=i.value.sections.filter(v=>v.root==0&&v.deep==0)||[]:g=S((G=a.value.val)==null?void 0:G.id);let k=0;g.forEach(v=>{const b=parseInt(v.name.replace(l,"").trim());console.log(b);const B=parseInt(v.alias.replace(e,"").trim());console.log(B);const Z=Math.max(isNaN(b)?0:b,isNaN(B)?0:B);Z>k&&(k=Z)});for(let v=1;v<=(Number(n)||1);v++){const b=k+v;I.push({name:`${l} ${b}`,alias:`${e}${b}`,path:`${((J=a.value.val)==null?void 0:J.path)||""}${(K=a.value.val)!=null&&K.path?"-":""}${e}${b}`})}}else I.push({name:l,alias:e,path:`${((X=a.value.val)==null?void 0:X.path)||""}${(Y=a.value.val)!=null&&Y.path?"-":""} ${e}`});a.value.defaultView=I},{deep:!0}),(o,l)=>(u(),w(pe,{padding:""},{default:s(()=>[t(O,{class:"my-card"},{default:s(()=>[t(m,null,{default:s(()=>[$.value.length>0?(u(),V("div",be,[t(ee,{class:"col",modelValue:i.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>i.value=e),q],options:$.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(x,{spaced:"",inset:"",vertical:"",dark:""}),(u(!0),V(_,null,U(c.value,(e,n)=>(u(),V("div",{key:n,class:"col"},[D("div",Ve,[t(ee,{class:"col",modelValue:e.selected,"onUpdate:modelValue":[d=>e.selected=d,d=>ne(d,n)],options:e.options,label:`Nivel ${n+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",disable:n==F.value},null,8,["modelValue","onUpdate:modelValue","options","label","disable"]),t(x,{spaced:"",inset:"",vertical:"",dark:""})])]))),128)),D("div",he,[t(h,{icon:"add",flat:"",onClick:ue,disable:!i.value},null,8,["disable"])])])):E("",!0),t(x,{spaced:"",inset:"",vertical:"",dark:""}),t(T,{rows:C.value,columns:P.value.columns},{body:s(e=>[t(M,{props:e},{default:s(()=>[(u(!0),V(_,null,U(e.cols,n=>(u(),w(N,{key:n.name,props:e},{default:s(()=>[y(Q(n.value),1)]),_:2},1032,["props"]))),128)),t(N,{"auto-width":""},{default:s(()=>[t(h,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:n=>re(e.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),t(le,{modelValue:a.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.state=e),persistent:""},{default:s(()=>[t(O,null,{default:s(()=>[t(m,{class:"text-center"},{default:s(()=>[l[8]||(l[8]=y(" NUEVA SECCION EN ALMACEN ")),D("span",we,Q(a.value.val.name.toUpperCase()),1)]),_:1}),t(m,{class:"row"},{default:s(()=>[t(z,{class:"col",modelValue:a.value.create.name,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.create.name=e),type:"text",label:"Name",filled:"",dense:""},null,8,["modelValue"]),t(x,{spaced:"",inset:"",vertical:"",dark:""}),t(z,{class:"col",modelValue:a.value.create.alias,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.create.alias=e),type:"text",label:"Alias",filled:"",dense:""},null,8,["modelValue"]),t(x,{spaced:"",inset:"",vertical:"",dark:""}),a.value.secuence?(u(),w(z,{key:0,class:"col",modelValue:a.value.create.elementos,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.create.elementos=e),type:"Number",label:"Elementos",filled:"",dense:""},null,8,["modelValue"])):E("",!0)]),_:1}),t(m,null,{default:s(()=>[t(ae,{modelValue:a.value.secuence,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.secuence=e),val:!1,label:"No Usar Secuencia"},null,8,["modelValue"]),t(ae,{modelValue:a.value.secuence,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.secuence=e),val:!0,label:"Usar Secuencia"},null,8,["modelValue"])]),_:1}),a.value.create.name&&a.value.create.alias?(u(),w(m,{key:0},{default:s(()=>[t(T,{rows:a.value.defaultView},null,8,["rows"])]),_:1})):E("",!0),t(te,{align:"right"},{default:s(()=>[L(t(h,{flat:"",label:"Cancelar",color:"negative"},null,512),[[oe]]),t(h,{flat:"",label:"Crear",color:"positive",onClick:ie,disable:!a.value.create.name||!a.value.create.alias},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:r.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>r.value.state=e),persistent:""},{default:s(()=>[t(O,null,{default:s(()=>[t(m,{class:"text-center text-bold text-h5"},{default:s(()=>l[9]||(l[9]=[y(" ELIMINAR SECCION ? ")])),_:1}),t(m,{class:"text-center text-bold text-h6"},{default:s(()=>[y(Q(r.value.val.name),1)]),_:1}),t(m,{class:"text-left text-bold"},{default:s(()=>l[10]||(l[10]=[y(" Recuerda que se eliminaran tambien todos los hijos de la seccion ")])),_:1}),t(m,null,{default:s(()=>[t(T,{rows:r.value.val.pivot,columns:P.value.columns},{body:s(e=>[t(M,{props:e},{default:s(()=>[(u(!0),V(_,null,U(e.cols,n=>(u(),w(N,{key:n.name,props:e},{default:s(()=>[y(Q(n.value),1)]),_:2},1032,["props"]))),128)),e.row.pivot.length>0?(u(),w(N,{key:0,"auto-width":""},{default:s(()=>[t(h,{size:"sm",color:"accent",round:"",dense:"",onClick:n=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024)):E("",!0)]),_:2},1032,["props"]),L(t(M,{props:e},{default:s(()=>[t(N,{colspan:"100%"},{default:s(()=>[(u(!0),V(_,null,U(e.row.pivot,(n,d)=>(u(),V("div",{class:"text-left",key:d},Q(n.name),1))),128))]),_:2},1024)]),_:2},1032,["props"]),[[me,e.expand]])]),_:1},8,["rows","columns"])]),_:1}),t(te,{align:"right"},{default:s(()=>[L(t(h,{flat:"",label:"Cancelar"},null,512),[[oe]]),t(h,{flat:"",label:"Eliminar",color:"negative",onClick:ce})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Xe as default};
