import{Q as W,a as v}from"./QTr.5b7c6f46.js";import{aH as F,r,c as x,o as H,d as J,w as s,f as b,e as o,ak as k,a0 as m,Q as f,E as G}from"./index.f1eaf89e.js";import{Q as S}from"./QTable.c37ac9f4.js";import{Q as P}from"./QSelect.9cadc2d2.js";import{Q as h,a as w}from"./axios.002d3f65.js";import{Q as E}from"./QInput.49e74a71.js";import{Q as K}from"./QCardActions.a301eb69.js";import{Q as U,b as C}from"./QList.44ec1f40.js";import{Q as M}from"./QSpace.d5f4b00e.js";import{Q as X}from"./QPage.5b9bdac9.js";import{R as Q}from"./RestockApi.793fa6e6.js";import{u as Y}from"./use-quasar.5d5acb92.js";import{E as Z}from"./exceljs.min.9e24d01d.js";import{$sktRestock as D}from"./socket.3fae67a0.js";import"./QLinearProgress.fae98d3e.js";import"./QCheckbox.62544d04.js";import"./_commonjsHelpers.88e99c8f.js";const ee={class:"col-2 q-table__title q-mr-xl"},ae={class:"text-overline"},ke={__name:"automate",setup(oe){const d=Y();F();const i=r({state:!1,val:null}),u=r({columns:[{name:"code",label:"Codigo",align:"left",field:e=>e.code},{name:"shortcode",label:"Codigo Corto",align:"left",field:e=>e.name},{name:"section",label:"Seccion",align:"left",field:e=>e.categories.familia.seccion.name},{name:"family",label:"Familia",align:"left",field:e=>e.categories.familia.name},{name:"category",label:"Categoria",align:"left",field:e=>e.categories.name},{name:"description",label:"Descripcion",align:"left",field:e=>e.description},{name:"supplyby",label:"Surtir por ",align:"left",field:e=>e.pivot._supply_by==1?"Pieza":e.pivot._supply_by==3?"Caja":"Docena"},{name:"amount",label:"Cantidad",align:"left",field:e=>e.pivot.amount},{name:"piezas",label:"Cantidad en Piezas",field:e=>e.pivot.units}],filter:""}),_=r([]),V=r({opts:[]}),g=r(!1),c=r(!1);r("");const y=r(null),R=r({cols:[{name:"id",label:"ID",align:"center"},{name:"alias",label:"ALIAS",align:"center"},{name:"name",label:"SUCURSAL",align:"left"},{name:"actions",label:"",align:"left"}]}),n=r({cats:[],_workpoint_from:null,_workpoint_to:null,_type:2,notes:null}),A=x(()=>n.value.cats.length>0&&n.value._workpoint_to),B=x(()=>_.value.filter(e=>e._type==1)),N=async()=>{d.loading.show({message:"Obteniendo Sucursales"});const e=await Q.getStoresAutomate();e.status==200?(console.log(e.data),_.value=e.data.stores,V.value.opts=e.data.sections,d.loading.hide()):alert("Problemas con la obtencion de datos")},T=e=>{c.value=!0,y.value=e},q=async e=>{g.value=!0,d.loading.show({message:"Creando Pedido"});let l={cats:n.value.cats.map(t=>"'"+t.name+"'").join(),_workpoint_from:y.value,_workpoint_to:n.value._workpoint_to.id,_type:2,notes:n.value.notes};console.log(l);const a=await Q.createAutomate(l);a.status==200?(console.log(a.data),g.value=!1,d.loading.hide(),d.notify({type:"positive",message:`Pedido ${a.data.order.id} creado`,position:"center"}),i.value.state=!0,i.value.val=a.data.order,console.log(a),D.emit("creating",{order:a.data.order}),n.value={cats:[],_workpoint_from:null,_workpoint_to:null,_type:2,notes:null},c.value=!1):alert("Nosegeneroelpedido")},$=e=>e.id==y.value,j=()=>{n.value={cats:[],_workpoint_from:null,_workpoint_to:null,_type:2,notes:null},c.value=!1},z=async()=>{const e=new Z.Workbook,l=e.addWorksheet("Comparativo");l.addRow(u.value.columns.map(t=>t.label)),i.value.val.products.forEach(t=>{l.addRow([t.code,t.name,t.categories.familia.seccion.name,t.categories.familia.name,t.categories.name,t.description,t.pivot._supply_by==1?"Pieza":t.pivot._supply_by==3?"Caja":"Docena",t.pivot.amount,t.pivot.units])}),(async()=>{const t=await e.xlsx.writeBuffer(),L=new Blob([t],{type:"application/octet-stream"}),O=URL.createObjectURL(L),p=document.createElement("a");p.href=O,p.download=`Pedido${i.value.val.id}.xlsx`,document.body.appendChild(p),p.click(),document.body.removeChild(p)})()},I=async()=>{d.loading.show({message:"Enviando Pedido"});const e=await Q.nextStep({id:i.value.val.id});console.log(e),e.status==200?(console.log(e),d.notify({message:"Pedido Enviado :)",type:"positive",position:"center"}),i.value={state:!1,val:null},D.emit("order_refresh",{order:e.data.requisition}),d.loading.hide()):alert("Problema con el envio de el pedido ")};return N(),(e,l)=>(H(),J(X,{padding:""},{default:s(()=>[b("div",null,[o(S,{title:"Sucursales",rows:_.value,"row-key":"id",columns:R.value.cols,pagination:{rowsPerPage:20}},{body:s(a=>[o(W,{props:a},{default:s(()=>[o(v,{key:"id",props:a},{default:s(()=>[k(m(a.row.id),1)]),_:2},1032,["props"]),o(v,{key:"alias",props:a},{default:s(()=>[k(m(a.row.alias),1)]),_:2},1032,["props"]),o(v,{key:"name",props:a},{default:s(()=>[k(m(a.row.name),1)]),_:2},1032,["props"]),o(v,{key:"actions",props:a},{default:s(()=>[o(f,{flat:"",rounded:"","icon-right":"arrow_circle_right",label:"Crear Pedido",color:"primary",onClick:t=>T(a.row.id),disable:g.value},null,8,["onClick","disable"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),o(U,{modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=a=>c.value=a),persistent:""},{default:s(()=>[o(h,{style:{"min-width":"350px"}},{default:s(()=>[o(w,null,{default:s(()=>[o(P,{modelValue:n.value.cats,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value.cats=a),options:V.value.opts,label:"Seccion","option-label":"name",filled:"",multiple:"","use-chips":""},null,8,["modelValue","options"])]),_:1}),o(w,null,{default:s(()=>[o(P,{modelValue:n.value._workpoint_to,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value._workpoint_to=a),options:B.value,label:"Destino","option-label":"name",filled:"","option-disable":a=>$(a)},null,8,["modelValue","options","option-disable"])]),_:1}),o(w,{class:"q-pt-none"},{default:s(()=>[l[6]||(l[6]=b("div",{class:"text-bold"},"Notas",-1)),o(E,{dense:"",modelValue:n.value.notes,"onUpdate:modelValue":l[2]||(l[2]=a=>n.value.notes=a),autofocus:""},null,8,["modelValue"])]),_:1}),o(K,{align:"right",class:"text-primary"},{default:s(()=>[o(f,{flat:"",label:"Cancel",onClick:j}),o(f,{flat:"",label:"Continuar",onClick:q,disable:!A.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(U,{modelValue:i.value.state,"onUpdate:modelValue":l[5]||(l[5]=a=>i.value.state=a),"full-width":""},{default:s(()=>[o(h,null,{default:s(()=>[o(S,{rows:i.value.val.products,columns:u.value.columns,filter:u.value.filter},{top:s(a=>[b("div",ee,"Pedido : "+m(i.value.val.id),1),b("div",ae,"Notas : "+m(i.value.val.notes),1),o(M),o(C,{spaced:"",inset:"",vertical:""}),o(f,{color:"primary",icon:"send",onClick:I,flat:"",round:"",title:"Enviar Pedido"}),o(C,{spaced:"",inset:"",vertical:""}),o(f,{color:"primary",icon:"download",onClick:z,flat:"",round:"",title:"Descargar"}),o(C,{spaced:"",inset:"",vertical:""}),o(E,{borderless:"",dense:"",debounce:"300",modelValue:u.value.filter,"onUpdate:modelValue":l[4]||(l[4]=t=>u.value.filter=t),placeholder:"Search"},{append:s(()=>[o(G,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};export{ke as default};
