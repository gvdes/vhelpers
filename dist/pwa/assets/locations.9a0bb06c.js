import{u as fe,r,w as ge,a as u,h as x,i as s,d as t,l as h,c as y,n as V,a4 as C,a3 as D,a2 as P,k as j,p as T,Q as z,j as _,a1 as B,m as F,bH as ae,a5 as te,aX as W,a6 as oe,aY as be}from"./index.8c0f41e3.js";import{Q as se}from"./QSelect.ca1146ab.js";import{Q as L}from"./QTd.7c3dd87c.js";import{Q as q}from"./QTr.8707df2d.js";import{Q as H}from"./QTable.70b43c91.js";import{Q as he}from"./QPage.89b7850a.js";import{C as ne}from"./ClosePopup.b46b6957.js";import"./QImg.912bbcad.js";import"./QList.b4c12bd4.js";import"./QSpace.70ea1c72.js";import"./QExpansionItem.22b5f00b.js";import"./favorites.9ebca4c8.js";import"./axios.c9f3d0b6.js";import{u as we}from"./use-quasar.2bb2ef5c.js";import{u as Ve}from"./warehousStore.c7c97be8.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.68970819.js";import{E as ye}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as M}from"./locationsApi.ff764df7.js";import"./QLinearProgress.044f3768.js";import"./QResizeObserver.f7d7dc26.js";import"./QScrollObserver.1f4160ab.js";import"./_commonjsHelpers.88e99c8f.js";const ke={key:0,class:"row"},xe={class:"row"},Ce={class:"text-right row"},_e={class:"text-bold"},Ze={__name:"locations",setup(Se){const S=fe(),d=we();Ve().setTitle("Ubicaciones Estructura");const R=r([]),O=r([]),i=r(null),N=r(null),a=r({state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]}),v=r({state:!1,val:null}),E=r([]),m=r([]),J=r(0),X=r({columns:[{name:"id",label:"ID",field:o=>o.id,align:"center"},{name:"name",label:"NOMBRE",field:o=>o.name,align:"left"},{name:"alias",label:"ALIAS",field:o=>o.alias,align:"left"},{name:"path",label:"PATH",field:o=>o.path,align:"left"}]}),ie=async()=>{d.loading.show({message:"Obteniendo Secciones"});let o={_rol:S.session.credentials._rol,_workpoint:S.session.store.id_viz};const e=await M.index(o);e.fail?console.log(e):(console.log(e),O.value=e),d.loading.hide()},Y=()=>{const o=i.value.sections||[];J.value=Math.max(...o.map(e=>e.deep)),m.value=[{options:o.filter(e=>e.root===0),selected:null}],E.value=m.value[0].options},I=o=>{var e;return((e=i.value.sections)==null?void 0:e.filter(l=>l.root===o))||[]},ue=(o,e)=>{m.value.splice(e+1);const l=I(o);l.length>0&&m.value.push({options:l,selected:null})},ce=()=>{const o=m.value.filter(e=>e.selected!==null);if(!o.length)console.log("crear una raiz"),a.value.state=!0,a.value.val=i.value,a.value.type=!0;else{console.log("crear hijos");const e=o[o.length-1],l=e.selected,n=e.options.find(c=>c.id===l);a.value.state=!0,a.value.val=n,a.value.type=!1}},re=async()=>{d.loading.show({message:"Enviando Datos"}),a.value.defaultView.forEach(l=>{l.root=a.value.type?0:a.value.val.id,l.deep=a.value.type?0:Number(a.value.val.deep)+1,l._celler=a.value.type?a.value.val.id:a.value.val._celler,l.details={create:S.session.credentials.nick}}),console.log(a.value);let o={sections:a.value.defaultView};const e=await M.insertSection(o);e.fail?console.log(e):(console.log(e),e.forEach(n=>{console.log(n),a.value.type?E.value.push(n):i.value.sections.push(n)}),d.notify({message:"Secciones Creadas",type:"positive",position:"bottom"}),d.loading.hide(),a.value={state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]})},G=o=>{const e=I(o.id);return{...o,pivot:e.map(l=>G(l))}},de=o=>{let e=G(o);console.log(e),v.value.state=!0,v.value.val=e},ve=async()=>{d.loading.show({message:"eliminando Seccion"}),console.log(v.value.val),console.log(i.value);let o={id:v.value.val.id,id_viz:S.session.credentials.staff.id_va};console.log(o);const e=await M.deleteSection(o);e.fail?console.log(e):(console.log(e),i.value.sections=i.value.sections.filter(l=>!e.ids.includes(l.id)),Y(),v.value={state:!1,val:null},d.loading.hide())},me=async()=>{d.loading.show({message:"Obeniendo Productos"}),console.log(N.value);let o={workpoint:S.session.store.id_viz,section:N.value?N.value.selected:null,celler:N.value?null:i.value.sections.map(l=>l.id)};console.log(o);const e=await M.obtProduct(o);e.fail?console.log(e):(console.log(e),R.value=e,await pe(R.value),d.loading.hide())},pe=async()=>{const o=new ye.Workbook,e=o.addWorksheet("Products"),l=[{name:"Codigo",filterButton:!0},{name:"Descripcion",filterButton:!0},{name:"Ubicaciones",filterButton:!0}],n=R.value.map(f=>[f.code,f.description,f.locations.map(g=>g.path).join("|")]);e.addTable({name:"Productos_Ubicados",ref:"A1",headerRow:!0,style:{theme:"TableStyleMedium9",showRowStripes:!0},columns:l,rows:n}),e.columns.forEach(f=>{let g=0;f.eachCell({includeEmpty:!0},U=>{const $=U.value?U.value.toString().length:10;$>g&&(g=$)}),f.width=g<10?10:g});const c=await o.xlsx.writeBuffer(),Q=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=document.createElement("a");p.href=URL.createObjectURL(Q),p.download="almacenes.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p)};return ie(),ge(()=>[m.value.map(o=>o.selected),a.value.create.name,a.value.create.alias,a.value.create.elementos,a.value.secuence],([o,e,l,n,c])=>{var f,g,U,$,K,Z;const Q=m.value.filter(w=>w.selected!==null);if(Q.length){const w=Q[Q.length-1],A=I(w.selected);E.value=A,N.value=w}else E.value=((f=m.value[0])==null?void 0:f.options)||[];if(!e||!l){a.value.defaultView=[];return}const p=[];if(c){console.log(a.value.type);let w=null;a.value.type?w=i.value.sections.filter(b=>b.root==0&&b.deep==0)||[]:w=I((g=a.value.val)==null?void 0:g.id);let A=0;w.forEach(b=>{const k=parseInt(b.name.replace(e,"").trim()),ee=parseInt(b.alias.replace(l,"").trim()),le=Math.max(isNaN(k)?0:k,isNaN(ee)?0:ee);le>A&&(A=le)});for(let b=1;b<=(Number(n)||1);b++){const k=A+b;p.push({name:`${e} ${k}`,alias:`${l}${k}`,path:`${((U=a.value.val)==null?void 0:U.path)||""}${($=a.value.val)!=null&&$.path?"-":""}${l}${k}`})}}else p.push({name:e,alias:l,path:`${((K=a.value.val)==null?void 0:K.path)||""}${(Z=a.value.val)!=null&&Z.path?"-":""} ${l}`});a.value.defaultView=p},{deep:!0}),(o,e)=>(u(),x(he,{padding:""},{default:s(()=>[t(z,{class:"my-card"},{default:s(()=>[t(h,null,{default:s(()=>[O.value.length>0?(u(),y("div",ke,[t(V,{color:"primary",icon:"download",onClick:me,flat:"",disable:!i.value},null,8,["disable"]),t(C,{spaced:"",inset:"",vertical:"",dark:""}),t(se,{class:"col",modelValue:i.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>i.value=l),Y],options:O.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(C,{spaced:"",inset:"",vertical:"",dark:""}),(u(!0),y(D,null,P(m.value,(l,n)=>(u(),y("div",{key:n,class:"col"},[j("div",xe,[t(se,{class:"col",modelValue:l.selected,"onUpdate:modelValue":[c=>l.selected=c,c=>ue(c,n)],options:l.options,label:`Nivel ${n+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",disable:n==J.value},null,8,["modelValue","onUpdate:modelValue","options","label","disable"]),t(C,{spaced:"",inset:"",vertical:"",dark:""})])]))),128)),j("div",Ce,[t(V,{icon:"add",flat:"",onClick:ce,disable:!i.value},null,8,["disable"])])])):T("",!0),t(C,{spaced:"",inset:"",vertical:"",dark:""}),t(H,{rows:E.value,columns:X.value.columns},{body:s(l=>[t(q,{props:l},{default:s(()=>[(u(!0),y(D,null,P(l.cols,n=>(u(),x(L,{key:n.name,props:l},{default:s(()=>[_(B(n.value),1)]),_:2},1032,["props"]))),128)),t(L,{"auto-width":""},{default:s(()=>[t(V,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:n=>de(l.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),t(oe,{modelValue:a.value.state,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.state=l),persistent:""},{default:s(()=>[t(z,null,{default:s(()=>[t(h,{class:"text-center"},{default:s(()=>[e[8]||(e[8]=_(" NUEVA SECCION EN ALMACEN ")),j("span",_e,B(a.value.val.name.toUpperCase()),1)]),_:1}),t(h,{class:"row"},{default:s(()=>[t(F,{class:"col",modelValue:a.value.create.name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.create.name=l),type:"text",label:"Name",filled:"",dense:""},null,8,["modelValue"]),t(C,{spaced:"",inset:"",vertical:"",dark:""}),t(F,{class:"col",modelValue:a.value.create.alias,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.create.alias=l),type:"text",label:"Alias",filled:"",dense:""},null,8,["modelValue"]),t(C,{spaced:"",inset:"",vertical:"",dark:""}),a.value.secuence?(u(),x(F,{key:0,class:"col",modelValue:a.value.create.elementos,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.create.elementos=l),type:"Number",label:"Elementos",filled:"",dense:""},null,8,["modelValue"])):T("",!0)]),_:1}),t(h,null,{default:s(()=>[t(ae,{modelValue:a.value.secuence,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.secuence=l),val:!1,label:"No Usar Secuencia"},null,8,["modelValue"]),t(ae,{modelValue:a.value.secuence,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.secuence=l),val:!0,label:"Usar Secuencia"},null,8,["modelValue"])]),_:1}),a.value.create.name&&a.value.create.alias?(u(),x(h,{key:0},{default:s(()=>[t(H,{rows:a.value.defaultView},null,8,["rows"])]),_:1})):T("",!0),t(te,{align:"right"},{default:s(()=>[W(t(V,{flat:"",label:"Cancelar",color:"negative"},null,512),[[ne]]),t(V,{flat:"",label:"Crear",color:"positive",onClick:re,disable:!a.value.create.name||!a.value.create.alias},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:v.value.state,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value.state=l),persistent:""},{default:s(()=>[t(z,null,{default:s(()=>[t(h,{class:"text-center text-bold text-h5"},{default:s(()=>e[9]||(e[9]=[_(" ELIMINAR SECCION ? ")])),_:1}),t(h,{class:"text-center text-bold text-h6"},{default:s(()=>[_(B(v.value.val.name),1)]),_:1}),t(h,{class:"text-left text-bold"},{default:s(()=>e[10]||(e[10]=[_(" Recuerda que se eliminaran tambien todos los hijos de la seccion ")])),_:1}),t(h,null,{default:s(()=>[t(H,{rows:v.value.val.pivot,columns:X.value.columns},{body:s(l=>[t(q,{props:l},{default:s(()=>[(u(!0),y(D,null,P(l.cols,n=>(u(),x(L,{key:n.name,props:l},{default:s(()=>[_(B(n.value),1)]),_:2},1032,["props"]))),128)),l.row.pivot.length>0?(u(),x(L,{key:0,"auto-width":""},{default:s(()=>[t(V,{size:"sm",color:"accent",round:"",dense:"",onClick:n=>l.expand=!l.expand,icon:l.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024)):T("",!0)]),_:2},1032,["props"]),W(t(q,{props:l},{default:s(()=>[t(L,{colspan:"100%"},{default:s(()=>[(u(!0),y(D,null,P(l.row.pivot,(n,c)=>(u(),y("div",{class:"text-left",key:c},B(n.name),1))),128))]),_:2},1024)]),_:2},1032,["props"]),[[be,l.expand]])]),_:1},8,["rows","columns"])]),_:1}),t(te,{align:"right"},{default:s(()=>[W(t(V,{flat:"",label:"Cancelar"},null,512),[[ne]]),t(V,{flat:"",label:"Eliminar",color:"negative",onClick:ve})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ze as default};
