import{a as z,u as G,r as p,c as A,o as D,g as B,e,w as i,f as s,a0 as m,S as M,b6 as Z,b5 as h,Q as w,a1 as O,ak as ee,al as I,a4 as U,a3 as J,d as P,h as N,aE as F}from"./index.5f24ec48.js";import{Q as c}from"./QCardSection.086c59e7.js";import{Q as V}from"./QCard.4690f446.js";import{b as d,Q as K}from"./QList.a7a0d85f.js";import{a as q}from"./QExpansionItem.a08af3b5.js";import{Q as te}from"./QPage.b3a7f163.js";import{Q as L}from"./QInput.257fa6dc.js";import{Q as T,d as se}from"./QSelect.ccc76a91.js";import{Q as W}from"./QCardActions.e92f705b.js";import{u as X}from"./use-quasar.b8a72789.js";import"./jspdf.plugin.autotable.959821ef.js";import{r as H}from"./refundsApi.57506385.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as C}from"./dayjs.min.cbcf888d.js";import{Q as le}from"./QDate.a0062694.js";import{Q as oe}from"./QTable.b6688713.js";import{C as ae}from"./ClosePopup.17afd2e8.js";import{p as ie}from"./Refund.d76ef749.js";import"./QDrawer.f8e64efa.js";import"./axios.9632cb4a.js";import"./use-key-composition.274cae14.js";import"./_commonjsHelpers.88e99c8f.js";import"./use-render-cache.3aae9b27.js";import"./date.883c3039.js";import"./QLinearProgress.ad4ca8ef.js";import"./QCheckbox.4e61aace.js";import"./use-checkbox.8e60d998.js";import"./QResizeObserver.35d711cd.js";import"./QScrollObserver.7b74b198.js";const ne={class:"text-bold text-centerz"},re={class:"row"},de=["onClick"],ue={class:"col"},ce={class:"text-bold"},ve={class:"col"},fe={class:"text-bold"},me={class:"col"},pe={class:"text-bold"},_e={class:"col"},ye={class:"text-bold"},xe={class:"col"},be={class:"text-bold"},we={class:"col"},ge={class:"text-bold"},Ve={class:"text-bold"},ke={class:"text-bold"},De={class:"col"},Ce={class:"text-bold"},Qe={class:"col"},$e={class:"text-caption"},Re={class:"text-bold"},j={__name:"ViewRefunds",props:{refunds:{type:Array,default:[]},status:{type:Array,default:[]}},setup(Q){const k=z(),u=G(),y=X(),v=p(null),f=p(null),_=p({state:!1,val:null}),x=Q,b=p({columns:[{name:"id",label:"ID",field:t=>t.id},{name:"reference",label:"REFERENCIA",field:t=>t.reference},{name:"destiny",label:"DESTINO",field:t=>t.storefrom.name},{name:"origin",label:"ORIGEN",field:t=>t.storeto.name},{name:"createby",label:"CREADO POR",field:t=>t.createdby.complete_name},{name:"date",label:"FECHA",field:t=>C(t.created_at).format("DD-MM-YYYY HH:mm:ss")},{name:"status",label:"Estado",field:t=>t.status}],filter:""}),g=A(()=>v.value&&!f.value?x.refunds.filter(t=>t.status.id==v.value.id):!v.value&&f.value?x.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==f.value):v.value&&f.value?x.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==f.value&&t.status.id==v.value.id):x.refunds),n=t=>{switch(t){case 1:return"red";case 2:return"yellow";case 3:return"blue";case 4:return"green"}},$=t=>{t.status.id==1&&t.storefrom.id==u.session.store.id?(console.log("terminar el que se esta creando"),k.push(`/refunds/${t.id}`)):t.status.id==1&&t.storeto.id==u.session.store.id?y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storefrom.id==u.session.store.id?y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storeto.id==u.session.store.id?(console.log("se va a recibir"),_.value.state=!0,_.value.val=t):t.status.id==3&&t.storeto.id==u.session.store.id?k.push(`/refunds/verified/${t.id}`):t.status.id==4&&y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"})},R=async t=>{y.loading.show({message:"Cambiando Estado"});let a={id:t.id,uid:u.session.id};const l=await H.nexState(a);l.fail?console.log(l):(k.push(`/refunds/verified/${t.id}`),y.loading.hide())},Y=t=>{console.log(t),ie.refund(t)};return(t,a)=>(D(),B(J,null,[e(oe,{rows:g.value,grid:"",columns:b.value.columns,filter:b.value.filter},{"top-left":i(()=>[s("div",ne,m(f.value),1)]),"top-right":i(()=>[s("div",re,[e(L,{class:"col",filled:"",dense:"",modelValue:b.value.filter,"onUpdate:modelValue":a[0]||(a[0]=l=>b.value.filter=l),placeholder:"Buscar"},{append:i(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(T,{class:"col",modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=l=>v.value=l),options:Q.status,label:"Estado",dense:"",filled:"","option-label":"name"},Z({_:2},[v.value?{name:"append",fn:i(()=>[e(M,{name:"cancel",onClick:a[1]||(a[1]=h(l=>v.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(w,{color:"primary",flat:"",icon:"event"},{default:i(()=>[e(se,null,{default:i(()=>[e(le,{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=l=>f.value=l),landscape:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})])]),item:i(l=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:o=>$(l.row)},[e(V,{bordered:"",class:"text-center my-card"},{default:i(()=>[e(c,{class:"row",dense:""},{default:i(()=>[s("div",ue,[a[6]||(a[6]=s("div",{class:"text-caption"},"ID",-1)),s("div",ce,m(l.row.id),1)]),e(d,{vertical:""}),s("div",ve,[a[7]||(a[7]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",fe,m(l.row.reference),1)]),e(d,{vertical:""}),s("div",me,[a[8]||(a[8]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",pe,m(O(C)(l.row.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:2},1024),e(d),e(c,{class:"row"},{default:i(()=>[s("div",_e,[a[9]||(a[9]=s("div",{class:"text-caption"},"Origen",-1)),s("div",ye,m(l.row.storefrom.name),1)]),e(d,{vertical:""}),s("div",xe,[a[10]||(a[10]=s("div",{class:"text-caption"},"Destino",-1)),s("div",be,m(l.row.storeto.name),1)])]),_:2},1024),e(d),e(c,{class:"row"},{default:i(()=>[s("div",we,[a[11]||(a[11]=s("div",{class:"text-caption"},"Tipo",-1)),s("div",ge,m(l.row.type.name),1)]),e(d,{vertical:""}),s("div",{class:ee(`col bg-${n(l.row.status.id)}`)},[a[12]||(a[12]=s("div",{class:"text-caption"},"Estado",-1)),s("div",Ve,m(l.row.status.name),1)],2)]),_:2},1024),e(d),e(c,null,{default:i(()=>[a[13]||(a[13]=s("div",{class:"text-caption"},"Creado Por",-1)),s("div",ke,m(l.row.createdby.complete_name),1)]),_:2},1024),e(c,{class:"row",onClick:o=>Y(l.row)},{default:i(()=>[s("div",De,[a[14]||(a[14]=s("div",{class:"text-caption"},"Devolucion",-1)),s("div",Ce,m(l.row.fs_id),1)]),e(d,{vertical:""}),s("div",Qe,[s("div",$e,m(l.row._type==1?"ABONO":"ENTRADA"),1),s("div",Re,m(l.row._type==1?l.row.season_ticket:l.row.entry),1)])]),_:2},1032,["onClick"])]),_:2},1024)],8,de)]),_:1},8,["rows","columns","filter"]),e(K,{modelValue:_.value.state,"onUpdate:modelValue":a[5]||(a[5]=l=>_.value.state=l),persistent:""},{default:i(()=>[e(V,null,{default:i(()=>[e(c,{class:"text-center text-bold text-h5"},{default:i(()=>a[15]||(a[15]=[I(" Quires recepcionar la devolucion ? ")])),_:1}),e(W,{align:"right"},{default:i(()=>[U(e(w,{flat:"",label:"Cancelar",color:"negative"},null,512),[[ae]]),e(w,{flat:"",label:"Recibir",color:"positive",onClick:a[4]||(a[4]=l=>R(_.value.val))})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ye={class:"row justify-between"},Ee={class:"row"},Se={key:0},Ne={class:"row"},Ae={class:"row"},ct={__name:"Index",setup(Q){const k=z(),u=G(),y=X(),v=p([]),f=p([]),_=p([]),x=p(null),b=p(!1),g=p(!1),n=p({state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:u.session.store.id,store_to:null,_created_by:u.session.id}),$=A(()=>n.value.type?n.value.type.id==1?_.value.filter(l=>l._type==1):_.value.filter(l=>l._type==2):_.value),R=A(()=>!(n.value.reference&&n.value.type&&n.value.provider)),Y=async()=>{y.loading.show({message:"Obteniendo Datos",type:"positive",position:"center"});let l=u.session.store.id;const o=await H.index(l);o.error?console.log(o):(console.log(o),v.value=o.types,_.value=o.provider,x.value=o.refunds,f.value=o.status,y.loading.hide())},t=async()=>{n.value={state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:u.session.store.id,store_to:null,_created_by:u.session.id}},a=async()=>{n.value.store_to=n.value.provider._store,console.log(n.value);const l=await H.addRefund(n.value);l.error?console.log(l):(console.log(l),y.notify({message:"Se creo correctamente la devolucion",type:"positive",position:"center"}),k.push(`/refunds/${l.id}`))};return Y(),(l,o)=>(D(),B(J,null,[e(te,{padding:""},{default:i(()=>[e(V,null,{default:i(()=>[e(c,null,{default:i(()=>[s("div",Ye,[s("div",null,[o[8]||(o[8]=I("Helpers ")),e(M,{name:"navigate_next",color:"primary"}),o[9]||(o[9]=I()),o[10]||(o[10]=s("span",{class:"text-h6"},"Devoluciones ",-1))]),s("div",Ee,[O(u).session.store.id!=1?(D(),P(w,{key:0,color:"primary",icon:"add",flat:"",onClick:o[0]||(o[0]=r=>n.value.state=!n.value.state)})):N("",!0)])])]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),x.value?(D(),B("div",Se,[e(V,{class:"my-card"},{default:i(()=>[e(c,{class:"text-center text-bold text-h6"},{default:i(()=>[s("div",Ne,[o[11]||(o[11]=s("div",{class:"col"},"Destino",-1)),e(w,{color:"grey",round:"",flat:"",dense:"",icon:b.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[1]||(o[1]=r=>b.value=!b.value)},null,8,["icon"])])]),_:1}),e(c,null,{default:i(()=>[e(q,null,{default:i(()=>{var r;return[U(s("div",null,[e(j,{refunds:(r=x.value.to)==null?void 0:r.sort((E,S)=>S.id-E.id),status:f.value},null,8,["refunds","status"])],512),[[F,b.value]])]}),_:1})]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),O(u).session.store.id!=1?(D(),P(V,{key:0,class:"my-card"},{default:i(()=>[e(c,{class:"text-center text-bold text-h6"},{default:i(()=>[s("div",Ae,[o[12]||(o[12]=s("div",{class:"col"},"Origen",-1)),e(w,{color:"grey",round:"",flat:"",dense:"",icon:g.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[2]||(o[2]=r=>g.value=!g.value)},null,8,["icon"])])]),_:1}),e(c,null,{default:i(()=>[e(q,null,{default:i(()=>{var r;return[U(s("div",null,[e(j,{refunds:(r=x.value.from)==null?void 0:r.sort((E,S)=>S.id-E.id),status:f.value},null,8,["refunds","status"])],512),[[F,g.value]])]}),_:1})]),_:1})]),_:1})):N("",!0)])):N("",!0)]),_:1}),e(K,{modelValue:n.value.state,"onUpdate:modelValue":o[7]||(o[7]=r=>n.value.state=r),persistent:""},{default:i(()=>[e(V,null,{default:i(()=>[e(c,null,{default:i(()=>o[13]||(o[13]=[s("span",{class:"text-center text-h6 text-bold"},"Nueva Devolucion",-1)])),_:1}),e(c,null,{default:i(()=>[e(L,{modelValue:n.value.reference,"onUpdate:modelValue":o[3]||(o[3]=r=>n.value.reference=r),type:"text",label:"Referencia",filled:"",dense:""},null,8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(T,{modelValue:n.value.type,"onUpdate:modelValue":[o[4]||(o[4]=r=>n.value.type=r),o[5]||(o[5]=()=>n.value.provider=null)],options:v.value,label:"Tipo",filled:"",dense:"","option-label":"name"},null,8,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(T,{modelValue:n.value.provider,"onUpdate:modelValue":o[6]||(o[6]=r=>n.value.provider=r),options:$.value,label:"Destino",filled:"",dense:"",disable:n.value.type==null,"option-label":"name"},null,8,["modelValue","options","disable"]),e(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(W,{align:"right"},{default:i(()=>[e(w,{flat:"",label:"Cancel",color:"primary",onClick:t}),e(w,{flat:"",label:"Enviar",color:"primary",onClick:a,disable:R.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ct as default};
