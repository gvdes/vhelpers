import{aH as O,a as T,u as U,r as w,c as E,p as H,o as d,d as g,w as l,e as s,f as i,S as C,aI as $,h as _,ak as c,a0 as n,an as R,a1 as k,g as p,a2 as G,a3 as K,Q as v}from"./index.d87ba090.js";import{Q as q,a as N}from"./QSelect.99543841.js";import{Q as X}from"./QInput.f6fa87e6.js";import{Q as b}from"./QSeparator.8a831898.js";import{Q}from"./QCardSection.f84172c8.js";import{Q as z}from"./QImg.586968fb.js";import{a as J,b as W,d as Y}from"./QList.9f6b0a46.js";import{Q as B}from"./QBtnGroup.49b14e90.js";import{Q as Z}from"./QCard.e3958f52.js";import{Q as tt}from"./QPageSticky.c8f79a78.js";import{Q as et}from"./QTable.d42c807f.js";import{Q as ot}from"./QPage.ce47e99b.js";import"./dayjs.min.cbcf888d.js";import{c as st,a as at}from"./catalogStore.3b9c2898.js";import{u as it}from"./use-quasar.eba3be69.js";import"./QDrawer.acff2a85.js";import"./QCardActions.fa9275b3.js";import"./ClosePopup.b4d916ee.js";import{v as A}from"./axios.a1a5c455.js";import"./socket.05630e21.js";import"./Restock.9fd53675.js";import"./use-key-composition.3243082c.js";import"./use-dark.af54e05c.js";import"./QLinearProgress.8823704f.js";import"./QCheckbox.7410cfbb.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.76402ea5.js";import"./QScrollObserver.571ece0c.js";import"./QToolbar.df69cb8a.js";import"./QForm.27924444.js";import"./QRadio.fa4f138a.js";import"./QTd.2a59fb8d.js";import"./QPopupEdit.3a434289.js";import"./QTr.1749715f.js";import"./QLayout.3e9c4247.js";import"./jspdf.plugin.autotable.ea40903c.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const lt={class:"row justify-end q-gutter-sm full-width"},rt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},nt={class:"col"},dt={class:"text-bold"},ct={class:"col"},ut={class:"text-bold"},mt={class:"col"},pt={class:"row"},vt={class:"text-caption"},ft={class:"text-caption"},_t={class:"text-caption"},kt={class:"text-caption"},gt={key:0,class:"col-6 flex flex-center"},bt={key:1,class:"col-6 flex flex-center"},xt={class:"col-6 q-pa-sm flex flex--column justify-between"},yt={class:"text-center text-bold text-red-10"},wt={class:"q-mt-md"},ht={class:"col"},Ct={class:"text-bold"},Qt={key:0,class:"col"},Pt={class:"text-bold"},St={key:1,class:"col"},Vt={key:0,class:"col"},$t={key:1,class:"col"},qt={class:"q-ml-md q-mr-md text-white bg-primary"},Nt={class:"row q-pt-xs"},be={__name:"viewCatalogFamily",setup(zt){const P=O();T();const u=st(),S=it(),x=U(),V=w([]),y=w({pagination:{rowsPerPage:12},filter:""}),f=w({val:null,opts:[{id:1,label:"Agotados"},{id:2,label:"Mayor a 1"},{id:3,label:"Mayor a 25"},{id:4,label:"Mayor a 50"},{id:5,label:"Mayor a 100"}]}),m=w({val:null,opts:[]}),I=E(()=>V.value.filter(a=>{var e;const o=m.value.val?a._category===m.value.val.id:!0;let t=!0;if(f.value.val){const r=(e=a.stocks.reduce((h,L)=>h+Number(L.pivot.stock),0))!=null?e:0;switch(f.value.val.id){case 1:t=r===0;break;case 2:t=r>1;break;case 3:t=r>25;break;case 4:t=r>50;break;case 5:t=r>100;break}}return o&&t})),M=async()=>{S.loading.show({message:"Obteniendo Hijos"}),console.log(P.params.fid);const a={family:P.params.fid,workpoint:x.session.store.id_viz},o=await at.getFamilysProducts(a);if(o.fail)console.log(o);else{u.setTitle(`Cat\xE1logo ${o.family.name}`),m.value.opts=o.categories;const t=o.family.products.map(e=>({...e,order:0}));if(u.orderState)for(const e of t){const r=u.order.products.find(h=>h.id===e.id);r&&(e.pivot=r.pivot)}V.value=t,S.loading.hide()}},j=a=>{const o={order:u.order.id,_product:a.id,units:1,price:a.prices.find(t=>t.id==1).pivot.price,total:a.prices.find(t=>t.id==1).pivot.price,amount:1,amountDelivered:0,toDelivered:0,_price_list:1,_supply_by:1};a.pivot={...o},u.pushProduct(a)},D=a=>{a.pivot.amount++,a.pivot.units++,a.pivot.total=a.pivot.amount*a.pivot.price,u.updateProduct(a)},F=a=>{a.pivot.amount--,a.pivot.units--,a.pivot.amount<=0?(delete a.pivot,u.removeProduct(a.id)):(a.pivot.total=a.pivot.amount*a.pivot.price,u.updateProduct(a))};return H(()=>{M()}),(a,o)=>(d(),g(ot,{padding:""},{default:l(()=>[s(et,{rows:I.value,"row-key":"id",grid:"",pagination:y.value.pagination,filter:y.value.filter},{top:l(()=>[i("div",lt,[s(q,{modelValue:f.value.val,"onUpdate:modelValue":o[1]||(o[1]=t=>f.value.val=t),options:f.value.opts,label:"Stocks",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:l(()=>[f.value.val!==null?(d(),g(C,{key:0,name:"close",onClick:o[0]||(o[0]=$(t=>f.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):_("",!0)]),_:1},8,["modelValue","options"]),s(q,{modelValue:m.value.val,"onUpdate:modelValue":o[3]||(o[3]=t=>m.value.val=t),options:m.value.opts,"option-label":"name",label:"Categor\xEDas",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:l(()=>[m.value.val!==null?(d(),g(C,{key:0,name:"close",onClick:o[2]||(o[2]=$(t=>m.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):_("",!0)]),_:1},8,["modelValue","options"]),s(X,{dense:"",debounce:"300",modelValue:y.value.filter,"onUpdate:modelValue":o[4]||(o[4]=t=>y.value.filter=t),placeholder:"Buscar",class:"col-auto",outlined:""},{append:l(()=>[s(C,{name:"search"})]),_:1},8,["modelValue"])])]),item:l(t=>[i("div",rt,[s(Z,{flat:"",bordered:""},{default:l(()=>[s(Q,{class:"text-center row"},{default:l(()=>[i("div",nt,[o[5]||(o[5]=c(" Codigo: ")),i("span",dt,n(t.row.code),1)]),i("div",ct,[o[6]||(o[6]=c(" CCO: ")),i("span",ut,n(t.row.name),1)]),i("div",mt,[i("div",null,[o[7]||(o[7]=c(" STOCK: ")),i("span",{class:R(["text-bold",t.row.stocks.find(e=>e.id==k(x).session.store.id_viz).pivot.stock<=0?"text-red":""])},n(t.row.stocks.find(e=>e.id==k(x).session.store.id_viz).pivot.stock<=0?"Agotado":t.row.stocks.find(e=>e.id==k(x).session.store.id_viz).pivot.stock),3)]),i("div",pt,[i("div",vt,[c(n(t.row.stocks.find(e=>e.id==1).alias)+" ",1),i("div",ft,n(t.row.stocks.find(e=>e.id==1).pivot.stock),1)]),s(b,{spaced:"",inset:"",vertical:"",dark:""}),i("div",_t,[c(n(t.row.stocks.find(e=>e.id==2).alias)+" ",1),i("div",kt,n(t.row.stocks.find(e=>e.id==2).pivot.stock),1)])])])]),_:2},1024),s(b),s(Q,{class:"row items-stretch"},{default:l(()=>[t.row.imgcover?(d(),p("div",gt,[s(z,{src:`${k(A)}/Products/${t.row.id}/${t.row.imgcover}`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1},null,8,["src"])])):(d(),p("div",bt,[s(z,{src:`${k(A)}/Products/sinpicture.png`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1},null,8,["src"])])),i("div",xt,[i("div",yt,n(t.row.description),1),s(b,{spaced:"",inset:"",vertical:"",dark:""}),i("div",wt,[(d(!0),p(K,null,G(t.row.prices,(e,r)=>(d(),p("div",{key:r},[s(J,{bordered:"",dense:""},{default:l(()=>[s(W,null,{default:l(()=>[s(Y,null,{default:l(()=>[s(N,{class:"text-center text-bold"},{default:l(()=>[c(n(e.name),1)]),_:2},1024),s(N,{class:"text-center"},{default:l(()=>[c("$ "+n(e.pivot.price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),s(b,{spaced:"",inset:"",vertical:"",dark:""})])]),_:2},1024),s(b),s(Q,{class:"text-center row"},{default:l(()=>[i("div",ht,[o[8]||(o[8]=c(" Piezas X Caja: ")),i("span",Ct,n(t.row.pieces),1)]),t.row.large?(d(),p("div",Qt,[o[9]||(o[9]=c(" MED: ")),i("span",Pt,n(t.row.large),1)])):_("",!0),k(u).orderState?(d(),p("div",St,[t.row.pivot?(d(),p("div",$t,[s(B,{rounded:"",class:"bg-primary"},{default:l(()=>[s(v,{size:"sm",color:"primary",icon:"remove",onClick:e=>F(t.row)},null,8,["onClick"]),i("div",qt,n(t.row.pivot.amount),1),s(v,{size:"sm",color:"primary",icon:"add",onClick:e=>D(t.row)},null,8,["onClick"])]),_:2},1024)])):(d(),p("div",Vt,[s(v,{color:t.row.stocks.reduce((e,r)=>e+Number(r.pivot.stock),0)<=0?"negative":"primary",rounded:"",label:t.row.stocks.reduce((e,r)=>e+Number(r.pivot.stock),0)<=0?"Agotado":"Agregar",onClick:e=>j(t.row),size:"sm",disable:t.row.stocks.reduce((e,r)=>e+Number(r.pivot.stock),0)<=0},null,8,["color","label","onClick","disable"])]))])):_("",!0)]),_:2},1024)]),_:2},1024)])]),bottom:l(t=>[s(tt,{position:"bottom",class:"full-width",offset:[0,18]},{default:l(()=>[i("div",Nt,[s(B,{rounded:"",class:""},{default:l(()=>[t.pagesNumber>2?(d(),g(v,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):_("",!0),s(v,{icon:"chevron_left",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),s(v,{flat:"",disable:"","no-caps":""},{default:l(()=>[c(n(t.pagination.page)+" / "+n(t.pagesNumber),1)]),_:2},1024),s(v,{icon:"chevron_right",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),t.pagesNumber>2?(d(),g(v,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:t.lastPage,class:"q-px-sm"},null,8,["onClick"])):_("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","pagination","filter"])]),_:1}))}};export{be as default};
