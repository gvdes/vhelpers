import{o as g}from"./orderApi.fcafff68.js";const v=(a,o,c)=>{const f=o.category.familia.seccion.id,i=c.find(e=>e._category==f).rules;let l=0,t=0,n=0;if(!i)return!1;let m=a.filter(e=>e.id===o.id).reduce((e,s)=>e+Number(d(s.pivot,s.pieces)),0),p=a.filter(e=>e.category.familia.id===o.category.familia.id).reduce((e,s)=>e+Number(d(s.pivot,s.pieces)),0),r=a.filter(e=>e.category.familia.seccion.id===o.category.familia.seccion.id&&e.id!==o.id).reduce((e,s)=>e+Number(d(s.pivot,s.pieces)),0);a.findIndex(e=>e.id==o.id)>=0?(l=m,t=p,n=r):(l=m+Number(o.pivot.amountDelivered),t=p+Number(o.pivot.amountDelivered),n=r+Number(o.pivot.amountDelivered));for(const e of i)if(e._type===2&&(e.sameModel==1&&l>=e.min&&(!e.max||l<=e.max)||e.sameModel==0&&t>=e.min&&(!e.max||t<=e.max)||e.sameModel==0&&n>=e.min&&(!e.max||t<=e.max)&&e.family==0))return!0;return!1},u=(a,o,c)=>{const f=o.category.familia.seccion.id,i=c.find(e=>e._category==f).rules;let l=0,t=0,n=0;if(!i)return!1;let m=a.filter(e=>e.id===o.id).reduce((e,s)=>e+Number(d(s.pivot,s.pieces)),0),p=a.filter(e=>e.category.familia.id===o.category.familia.id).reduce((e,s)=>e+Number(d(s.pivot,s.pieces)),0),r=a.filter(e=>e.category.familia.seccion.id===o.category.familia.seccion.id&&e.id!==o.id).reduce((e,s)=>e+Number(d(s.pivot,s.pieces)),0);a.findIndex(e=>e.id==o.id)>=0?(l=m,t=p,n=r):(l=m+Number(o.pivot.amountDelivered),t=p+Number(o.pivot.amountDelivered),n=r+Number(o.pivot.amountDelivered));for(const e of i)if(e._type===3&&(e.sameModel==1&&l>=e.min&&(!e.max||l<=e.max)||e.sameModel==0&&t>=e.min&&(!e.max||t<=e.max)||e.sameModel==0&&n>=e.min&&(!e.max||t<=e.max)&&e.family==0))return!0;return!1},y=(a,o)=>{let c=0;return c=a.filter(i=>i.id===o.id).reduce((i,l)=>i+Number(d(l.pivot,l.pieces)),0)+Number(o.pivot.amountDelivered),console.log(c),c>=o.pieces},b=async(a,o,c)=>{const f=[];for(const i of a){const l=i.pivot._supply_by==3?i.pivot.amountDelivered*i.pieces:i.pivot._supply_by==2?i.pivot.amountDelivered*12:i.pivot.amountDelivered;let t=0;o.client._price_list<=3?y(a,i)?t=4:u(a,i,c)?t=3:v(a,i,c)?t=2:t=1:t=o.client._price_list;const n=i.prices.find(m=>m.id==t);if(n){const m=i.pivot.price,p=i.pivot._price_list,r=n.pivot.price;(m!==r||p!==t)&&(i.pivot._price_list=t,i.pivot.price=r,i.pivot.total=l*r,f.push({_order:i.pivot._order,_product:i.id,_price_list:t,price:r,total:l*r}))}}if(f.length>0){const i=await g.updateProductPrices(f);console.log(i),i.fail?console.error("Error al actualizar precios:",i):console.log("Precios actualizados correctamente")}},x=async(a,o,c)=>{const f=[];for(const i of a){const l=i.pivot._supply_by==3?i.pivot.amountDelivered*i.pieces:i.pivot._supply_by==2?i.pivot.amountDelivered*12:i.pivot.amountDelivered;let t=0;o<=3?y(a,i)?t=4:u(a,i,c)?t=3:v(a,i,c)?t=2:t=1:t=o;const n=i.prices.find(m=>m.id==t);if(n){const m=i.pivot.price,p=i.pivot._price_list,r=n.pivot.price;(m!==r||p!==t)&&(i.pivot._price_list=t,i.pivot.price=r,i.pivot.total=l*r,f.push({_product:i.id,_price_list:t,price:r,total:l*r}))}}},d=(a,o)=>a.amountDelivered;var P={verificarPrecioMayoreo:v,verificarPrecioDocena:u,actualizarPreciosProductos:b,actualizarPreciosProductosSales:x,verificarPrecioCaja:y};export{P as R};
