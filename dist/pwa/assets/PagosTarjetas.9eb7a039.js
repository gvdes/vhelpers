import{Q as r}from"./position-engine.55969d85.js";import{r as p,c as C,o as F,a as J,w as l,e as s,i as n,U as L,f as v,Q as w}from"./index.e871c06b.js";import{Q as O}from"./QSelect.d37feafa.js";import{a as H,Q as P}from"./axios.c4c6b87a.js";import{Q as q,_ as M}from"./UserToolbar.06aba17b.js";import{Q as U}from"./QInput.4af100b5.js";import{Q as K}from"./QForm.aea8fcb5.js";import{Q as x}from"./QTable.a905ffc0.js";import{Q as z}from"./QPage.a0eca060.js";import{Q as G,c as W}from"./QLayout.6b51210b.js";import{u as X}from"./VDB.8b0e412c.js";import{e as Q}from"./jspdf.plugin.autotable.85f413b4.js";import{u as Y}from"./use-quasar.60027603.js";import"./QDialog.ea18b190.js";import"./QItem.85c31878.js";import"./QList.31464e4b.js";import"./QLinearProgress.e7e51e8b.js";import"./QCheckbox.bd437502.js";import"./_commonjsHelpers.88e99c8f.js";const Z=n("span",{class:"text-grey"},"Helpers",-1),ee=n("span",{class:"text-h6"},"Tarjetas",-1),te={class:"row"},ae={class:"row"},oe={class:"row"},se={class:"col"},ne={class:"row"},le={class:"col"},ie={class:"row"},re={class:"col"},Se={__name:"PagosTarjetas",setup(ce){const y=X(),i=Y(),g=p(null),d=p([]),A=p([]),c=p({val:"SELECCIONA CAJA",opts:[]}),E=p([{name:"bauchers",label:"Baucher",field:t=>t}]),m=p([{name:"terminal",label:"Caja",align:"left",field:t=>t.TERMINAL},{name:"ticket",label:"Ticket",field:t=>t.TICKET},{name:"total",label:"Total",field:t=>t.TARJETAS},{name:"fecha",label:"Fecha",field:t=>t.FECHA},{name:"hora",label:"Hora",field:t=>t.HORA},{name:"cliente",label:"Cliente",align:"left",field:t=>t.CLIENTE}]),b=C(()=>c.value.val?A.value.filter(t=>t.TERMINAL==c.value.val.DESTER):[]),k=C(()=>{if(d.value.length>0){let t=[...d.value];return b.value.filter(o=>{const e=t.indexOf(o.TARJETAS);return e!==-1?(t.splice(e,1),!0):!1})}else return[]}),_=C(()=>{if(d.value.length>0){let t=[...d.value];return b.value.filter(o=>{const e=t.indexOf(o.TARJETAS);return e!==-1?(t.splice(e,1),!1):!0})}else return b.value}),T=C(()=>{let t=[...b.value];return d.value.filter(o=>{const e=t.findIndex(a=>a.TARJETAS===o);return e!==-1?(t.splice(e,1),!1):!0})}),S=()=>{if(g.value){d.value.push(g.value),g.value=null;const t=V(T.value,_.value);t.length>0?(console.log("Se encontraron coincidencias con las siguientes combinaciones:"),t.forEach(o=>{console.log(`Combinaci\xF3n: ${o.combinacion.join(" + ")} = ${o.monto}, Ticket: ${o.ticket}`)})):console.log("No se encontraron coincidencias.")}},j=async()=>{console.log("Recibiendo Datos :)"),i.loading.show({message:"Obteniendo datos"});let o=`http://${y.session.store.ip}/access/public/reports/getCashCard`;H.get(o).then(e=>{console.log(e),A.value=e.data.formaspagos,c.value.opts=e.data.terminales,i.loading.hide()}).catch(e=>console.log(e))},B=()=>{const t=[E.value.map(e=>f(e.label))].concat(T.value.map(e=>E.value.map(a=>f(typeof a.field=="function"?a.field(e):e[a.field===void 0?a.name:a.field],a.format,e)).join(","))).join(`\r
`);Q("SobrantesBauchers.csv",t,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},R=()=>{const t=[m.value.map(e=>f(e.label))].concat(_.value.map(e=>m.value.map(a=>f(typeof a.field=="function"?a.field(e):e[a.field===void 0?a.name:a.field],a.format,e)).join(","))).join(`\r
`);Q("BucherFaltantes.csv",t,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},I=()=>{const t=[m.value.map(e=>f(e.label))].concat(k.value.map(e=>m.value.map(a=>f(typeof a.field=="function"?a.field(e):e[a.field===void 0?a.name:a.field],a.format,e)).join(","))).join(`\r
`);Q("BauchersEncontrados.csv",t,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},f=(t,o,e)=>{let a=o!==void 0?o(t,e):t;return a=a==null?"":String(a),a=a.split('"').join('""'),/^\d{1,2}-\d{4}$/.test(a)&&(a=`'${a}`),`"${a}"`},V=(t,o)=>{const e=N(t);console.log(e);const a=[];return e.forEach(u=>{const $=u.reduce((h,D)=>Number(h)+Number(D),0);o.forEach(h=>{h.TARJETAS==$&&a.push({combinacion:u,ticket:h.TICKET,monto:h.TARJETAS})})}),a},N=t=>{const o=[];for(let e=0;e<1<<t.length;e++){const a=[];for(let u=0;u<t.length;u++)e&1<<u&&a.push(t[u]);a.length>0&&o.push(a)}return o};return j(),(t,o)=>(F(),J(G,{view:"hHh Lpr fFf"},{default:l(()=>[s(W,null,{default:l(()=>[s(z,{padding:""},{default:l(()=>[s(q,{class:"bg-grey-3 text-dark",bordered:""},{default:l(()=>[s(M),s(r),s(P,{class:"justify-between"},{default:l(()=>[n("div",null,[Z,s(L,{name:"navigate_next",color:"primary"}),ee]),n("div",te,[s(O,{modelValue:c.value.val,"onUpdate:modelValue":o[0]||(o[0]=e=>c.value.val=e),options:c.value.opts,"option-label":"DESTER",label:"Caja",outlined:"",dense:""},null,8,["modelValue","options"])])]),_:1})]),_:1}),s(r,{spaced:"",inset:"",vertical:"",dark:""}),s(K,{onSubmit:S,class:"q-gutter-md"},{default:l(()=>[s(U,{modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=e=>g.value=e),type:"number",label:"IMPORTE",outlined:"",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md",disable:c.value.val=="SELECCIONA CAJA"},null,8,["modelValue","min","disable"])]),_:1}),s(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",ae,[s(x,{title:"Bauchers Faltantes",rows:v(T),"row-key":"name",class:"col",columns:E.value},{"top-right":l(()=>[n("div",oe,[s(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",se,[s(w,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:B,disable:!(v(T).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"]),s(r,{spaced:"",inset:"",vertical:"",dark:""}),s(x,{title:"Cobros Faltantes",rows:v(_),"row-key":"name",class:"col",columns:m.value},{"top-right":l(()=>[n("div",ne,[s(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",le,[s(w,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:R,disable:!(v(_).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])]),s(r,{spaced:"",inset:"",vertical:"",dark:""}),s(x,{title:"Cobros Encontrados",rows:v(k),"row-key":"name",columns:m.value},{"top-right":l(()=>[n("div",ie,[s(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",re,[s(w,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:I,disable:!(v(k).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])]),_:1})]),_:1})]),_:1}))}};export{Se as default};
