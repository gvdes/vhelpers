import{Q as R}from"./QToolbarTitle.3b04647f.js";import{Q as N}from"./QToolbar.7d78f485.js";import{b as f}from"./QList.b92196c9.js";import{Q as k}from"./QSelect.cc38f2d2.js";import{u as B,r as S,c as b,o as P,d as I,w as u,e as o,ak as D,Q as C}from"./index.82968bb4.js";import{Q as L}from"./QCardSection.59f4f76d.js";import{Q as _}from"./QCard.bccf0506.js";import{Q as M}from"./QTable.a41af217.js";import{Q as U}from"./QPage.d45f06c9.js";import{r as E}from"./reportApi.138a45c7.js";import{u as $}from"./use-quasar.d9515e0f.js";import"./jspdf.plugin.autotable.42a6e652.js";import{E as F}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as h}from"./dayjs.min.cbcf888d.js";import"./QLinearProgress.b2700739.js";import"./QCheckbox.b59e2eb7.js";import"./axios.212ff131.js";import"./_commonjsHelpers.88e99c8f.js";const de={__name:"Warehouses",setup(W){B();const m=$(),a=S({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),w=S(!1),v=S([]),c=b(()=>({pagination:{rowsPerPage:10},columns:[{name:"code",label:"CODIGO",field:e=>e.code,align:"left"},{name:"description",label:"DESCRIPCION",field:e=>e.description,align:"left"},{name:"barcode",label:"CB",field:e=>e.barcode,align:"left"},{name:"section",label:"SECCION",field:e=>e.category.familia.seccion.name,align:"left"},{name:"family",label:"FAMILIA",field:e=>e.category.familia.name,align:"left"},{name:"category",label:"CATEGORIA",field:e=>e.category.name,align:"left"},{name:"mennav",label:"MEDNAV/PERS",field:e=>e.large,align:"left"},{name:"provider",label:"PROVEEDOR",field:e=>e.providers.name,align:"left"},{name:"maker",label:"FABRICANTE",field:e=>{var l;return(l=e.makers)==null?void 0:l.name},align:"left"},{name:"pxc",label:"PXC",field:e=>e.pieces,align:"center"},{name:"purchases",label:"COMPRAS",field:e=>e.PurchaseYear,align:"center"},{name:`sales${Number(h().format("YYYY"))-1}`,label:`VENTAS ${h().format("YYYY")-1}`,field:e=>e.SalesSubYear,align:"center"},{name:`sales${h().year}`,label:`VENTAS ${h().format("YYYY")}`,field:e=>e.SalesYear,align:"center"},{name:"stock",label:"STOCK",field:e=>e.SumStock,align:"center"}]})),Q=b(()=>a.value.all.filter(e=>e.deep==0)),A=b(()=>a.value.seccion.val.length>0?a.value.all.filter(e=>e.deep==1&&a.value.seccion.val.map(l=>l.id).includes(e.root)):a.value.all.filter(e=>e.deep==1)),V=b(()=>{if(a.value.seccion.val.length>0&&a.value.familias.val.length==0){let e=a.value.all.filter(l=>l.deep==1&&a.value.seccion.val.map(i=>i.id).includes(l.root)).map(l=>l.id);return a.value.all.filter(l=>l.deep==2&&e.includes(l.root))}else return a.value.familias.val.length>0?a.value.all.filter(e=>e.deep==2&&a.value.familias.val.map(l=>l.id).includes(e.root)):a.value.all.filter(e=>e.deep==2)}),Y=async()=>{m.loading.show({message:"Obteniendo Familias"});const e=await E.init();e.fail?(console.log(e),m.loading.hide()):(console.log(e),a.value.all=e,m.loading.hide())},T=async()=>{var i,y,g;m.loading.show({message:"El reporte puede tardar unos minutos"}),w.value=!0;let e={sections:(i=a.value.seccion.val)==null?void 0:i.map(s=>s.id),familys:(y=a.value.familias.val)==null?void 0:y.map(s=>s.id),categories:(g=a.value.categories.val)==null?void 0:g.map(s=>s.id)};console.log(e);const l=await E.reportWarehouses(e);l.fail?(console.log(l),m.notify({message:"No se pudo obtener el reporte comuniquese con soporte",type:"negative",position:"center"})):(console.log(l),v.value=l,w.value=!1,m.loading.hide())},x=async()=>{const e=new F.Workbook,l=e.addWorksheet("Almacenes"),i=c.value.columns.map(t=>({header:t.label,key:t.name,width:15}));l.columns=i;const g=v.value.map(t=>{const n={};return c.value.columns.forEach(r=>{let d;typeof r.field=="function"?d=r.field(t):d=t[r.field],n[r.name]=d}),n}).map(t=>c.value.columns.map(n=>t[n.name]));l.addTable({name:"AlmacenesTable",ref:"A1",headerRow:!0,style:{theme:"TableStyleMedium9",showRowStripes:!0},columns:c.value.columns.map(t=>({name:t.label,filterButton:!0})),rows:g}),l.columns.forEach(t=>{let n=0;t.eachCell({includeEmpty:!0},r=>{const d=r.value?r.value.toString().length:10;d>n&&(n=d)}),t.width=n<10?10:n});const s=await e.xlsx.writeBuffer(),O=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=document.createElement("a");p.href=URL.createObjectURL(O),p.download="almacenes.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p)};return Y(),(e,l)=>(P(),I(U,{padding:""},{default:u(()=>[o(N,null,{default:u(()=>[o(R,null,{default:u(()=>l[3]||(l[3]=[D(" ALMACENES ")])),_:1})]),_:1}),o(f),o(_,{class:"my-card"},{default:u(()=>[o(L,{class:"row"},{default:u(()=>[o(k,{class:"col",modelValue:a.value.seccion.val,"onUpdate:modelValue":l[0]||(l[0]=i=>a.value.seccion.val=i),options:Q.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(k,{class:"col",modelValue:a.value.familias.val,"onUpdate:modelValue":l[1]||(l[1]=i=>a.value.familias.val=i),options:A.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:a.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(k,{class:"col",modelValue:a.value.categories.val,"onUpdate:modelValue":l[2]||(l[2]=i=>a.value.categories.val=i),options:V.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:a.value.seccion.val.length==0||a.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(C,{color:"primary",label:a.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:T},null,8,["label"])]),_:1})]),_:1}),o(f,{spaced:"",inset:"",vertical:"",dark:""}),o(M,{rows:v.value,pagination:c.value.pagination,loading:w.value,columns:c.value.columns},{"top-right":u(()=>[o(C,{disable:v.value.value,color:"primary",icon:"download",flat:"",onClick:x},null,8,["disable"])]),_:1},8,["rows","pagination","loading","columns"])]),_:1}))}};export{de as default};
