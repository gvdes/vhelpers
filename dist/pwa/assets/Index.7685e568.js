import{a as q,u as j,r as m,c as N,o as k,g as S,e,w as n,f as l,a0 as f,E as A,b6 as W,aI as X,Q as w,a1 as B,an as Z,ak as M,a4 as I,a3 as z,d as T,h as E,aA as H}from"./index.bb89eb54.js";import{Q as V,a as u}from"./axios.0fa20eb5.js";import{b as r,Q as G}from"./QList.2f1159aa.js";import{a as P}from"./QExpansionItem.a00bd443.js";import{Q as h}from"./QPage.3cbcf194.js";import{Q as J}from"./QInput.b6fe1787.js";import{Q as O,d as ee}from"./QSelect.a467d720.js";import{Q as K}from"./QCardActions.da196be0.js";import{u as L}from"./use-quasar.22652f06.js";import"./jspdf.plugin.autotable.1223e566.js";import{r as U}from"./refundsApi.7dc7d36a.js";import"./exceljs.min.9e24d01d.js";import"./browser.eff7c919.js";import{d as C}from"./dayjs.min.cbcf888d.js";import{Q as te}from"./QDate.229e46af.js";import{Q as le}from"./QTable.1128b8c8.js";import{C as se}from"./ClosePopup.aaba2c3e.js";import{p as oe}from"./Refund.7b755770.js";import"./QDrawer.50214bb7.js";import"./_commonjsHelpers.88e99c8f.js";import"./use-render-cache.3aae9b27.js";import"./date.366c8c3d.js";import"./QLinearProgress.927d60ec.js";import"./QCheckbox.e67205cf.js";import"./QResizeObserver.e006b84e.js";import"./QScrollObserver.d069607d.js";import"./touch.9135741d.js";const ae={class:"text-bold text-centerz"},ne={class:"row"},ie=["onClick"],re={class:"col"},de={class:"text-bold"},ue={class:"col"},ce={class:"text-bold"},ve={class:"col"},fe={class:"text-bold"},me={class:"col"},pe={class:"text-bold"},_e={class:"col"},ye={class:"text-bold"},be={class:"col"},xe={class:"text-bold"},we={class:"text-bold"},ge={class:"text-bold"},Ve={class:"col"},ke={class:"text-bold"},De={class:"col"},Ce={class:"text-caption"},Qe={class:"text-bold"},F={__name:"ViewRefunds",props:{refunds:{type:Array,default:[]},status:{type:Array,default:[]}},setup(Q){const D=q(),d=j(),y=L(),c=m(null),v=m(null),p=m({state:!1,val:null}),b=Q,x=m({columns:[{name:"id",label:"ID",field:t=>t.id},{name:"reference",label:"REFERENCIA",field:t=>t.reference},{name:"destiny",label:"DESTINO",field:t=>t.storefrom.name},{name:"origin",label:"ORIGEN",field:t=>t.storeto.name},{name:"createby",label:"CREADO POR",field:t=>t.createdby.complete_name},{name:"date",label:"FECHA",field:t=>C(t.created_at).format("DD-MM-YYYY HH:mm:ss")},{name:"status",label:"Estado",field:t=>t.status}],filter:""}),g=N(()=>c.value&&!v.value?b.refunds.filter(t=>t.status.id==c.value.id):!c.value&&v.value?b.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==v.value):c.value&&v.value?b.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==v.value&&t.status.id==c.value.id):b.refunds),i=t=>{switch(t){case 1:return"red";case 2:return"yellow";case 3:return"blue";case 4:return"green"}},$=t=>{t.status.id==1&&t.storefrom.id==d.session.store.id?(console.log("terminar el que se esta creando"),D.push(`/refunds/${t.id}`)):t.status.id==1&&t.storeto.id==d.session.store.id?y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storefrom.id==d.session.store.id?y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storeto.id==d.session.store.id?(console.log("se va a recibir"),p.value.state=!0,p.value.val=t):t.status.id==4&&y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"})},R=async t=>{y.loading.show({message:"Cambiando Estado"});let a={id:t.id,uid:d.session.id};const s=await U.nexState(a);s.fail?console.log(s):(D.push(`/refunds/verified/${t.id}`),y.loading.hide())},Y=t=>{console.log(t),oe.refund(t)};return(t,a)=>(k(),S(z,null,[e(le,{rows:g.value,grid:"",columns:x.value.columns,filter:x.value.filter},{"top-left":n(()=>[l("div",ae,f(v.value),1)]),"top-right":n(()=>[l("div",ne,[e(J,{class:"col",filled:"",dense:"",modelValue:x.value.filter,"onUpdate:modelValue":a[0]||(a[0]=s=>x.value.filter=s),placeholder:"Buscar"},{append:n(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{class:"col",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=s=>c.value=s),options:Q.status,label:"Estado",dense:"",filled:"","option-label":"name"},W({_:2},[c.value?{name:"append",fn:n(()=>[e(A,{name:"cancel",onClick:a[1]||(a[1]=X(s=>c.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(w,{color:"primary",flat:"",icon:"event"},{default:n(()=>[e(ee,null,{default:n(()=>[e(te,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=s=>v.value=s),landscape:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})])]),item:n(s=>[l("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:o=>$(s.row)},[e(V,{bordered:"",class:"text-center my-card"},{default:n(()=>[e(u,{class:"row",dense:""},{default:n(()=>[l("div",re,[a[6]||(a[6]=l("div",{class:"text-caption"},"ID",-1)),l("div",de,f(s.row.id),1)]),e(r,{vertical:""}),l("div",ue,[a[7]||(a[7]=l("div",{class:"text-caption"},"Referencia",-1)),l("div",ce,f(s.row.reference),1)]),e(r,{vertical:""}),l("div",ve,[a[8]||(a[8]=l("div",{class:"text-caption"},"Referencia",-1)),l("div",fe,f(B(C)(s.row.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:2},1024),e(r),e(u,{class:"row"},{default:n(()=>[l("div",me,[a[9]||(a[9]=l("div",{class:"text-caption"},"Origen",-1)),l("div",pe,f(s.row.storefrom.name),1)]),e(r,{vertical:""}),l("div",_e,[a[10]||(a[10]=l("div",{class:"text-caption"},"Destino",-1)),l("div",ye,f(s.row.storeto.name),1)])]),_:2},1024),e(r),e(u,{class:"row"},{default:n(()=>[l("div",be,[a[11]||(a[11]=l("div",{class:"text-caption"},"Tipo",-1)),l("div",xe,f(s.row.type.name),1)]),e(r,{vertical:""}),l("div",{class:Z(`col bg-${i(s.row.status.id)}`)},[a[12]||(a[12]=l("div",{class:"text-caption"},"Estado",-1)),l("div",we,f(s.row.status.name),1)],2)]),_:2},1024),e(r),e(u,null,{default:n(()=>[a[13]||(a[13]=l("div",{class:"text-caption"},"Creado Por",-1)),l("div",ge,f(s.row.createdby.complete_name),1)]),_:2},1024),e(u,{class:"row",onClick:o=>Y(s.row)},{default:n(()=>[l("div",Ve,[a[14]||(a[14]=l("div",{class:"text-caption"},"Devolucion",-1)),l("div",ke,f(s.row.fs_id),1)]),e(r,{vertical:""}),l("div",De,[l("div",Ce,f(s.row._type==1?"ABONO":"ENTRADA"),1),l("div",Qe,f(s.row._type==1?s.row.season_ticket:s.row.entry),1)])]),_:2},1032,["onClick"])]),_:2},1024)],8,ie)]),_:1},8,["rows","columns","filter"]),e(G,{modelValue:p.value.state,"onUpdate:modelValue":a[5]||(a[5]=s=>p.value.state=s),persistent:""},{default:n(()=>[e(V,null,{default:n(()=>[e(u,{class:"text-center text-bold text-h5"},{default:n(()=>a[15]||(a[15]=[M(" Quires recepcionar la devolucion ? ")])),_:1}),e(K,{align:"right"},{default:n(()=>[I(e(w,{flat:"",label:"Cancelar",color:"negative"},null,512),[[se]]),e(w,{flat:"",label:"Recibir",color:"positive",onClick:a[4]||(a[4]=s=>R(p.value.val))})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},$e={class:"row justify-between"},Re={class:"row"},Ye={key:0},Ee={class:"row"},Ne={class:"row"},at={__name:"Index",setup(Q){const D=q(),d=j(),y=L(),c=m([]),v=m([]),p=m([]),b=m(null),x=m(!1),g=m(!1),i=m({state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:d.session.store.id,store_to:null,_created_by:d.session.id}),$=N(()=>i.value.type?i.value.type.id==1?p.value.filter(s=>s._type==1):p.value.filter(s=>s._type==2):p.value),R=N(()=>!(i.value.reference&&i.value.type&&i.value.provider)),Y=async()=>{y.loading.show({message:"Obteniendo Datos",type:"positive",position:"center"});let s=d.session.store.id;const o=await U.index(s);o.error?console.log(o):(console.log(o),c.value=o.types,p.value=o.provider,b.value=o.refunds,v.value=o.status,y.loading.hide())},t=async()=>{i.value={state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:d.session.store.id,store_to:null,_created_by:d.session.id}},a=async()=>{i.value.store_to=i.value.provider._store,console.log(i.value);const s=await U.addRefund(i.value);s.error?console.log(s):(console.log(s),y.notify({message:"Se creo correctamente la devolucion",type:"positive",position:"center"}),D.push(`/refunds/${s.id}`))};return Y(),(s,o)=>(k(),S(z,null,[e(h,{padding:""},{default:n(()=>[e(V,null,{default:n(()=>[e(u,null,{default:n(()=>[l("div",$e,[l("div",null,[o[8]||(o[8]=M("Helpers ")),e(A,{name:"navigate_next",color:"primary"}),o[9]||(o[9]=M()),o[10]||(o[10]=l("span",{class:"text-h6"},"Devoluciones ",-1))]),l("div",Re,[B(d).session.store.id!=1?(k(),T(w,{key:0,color:"primary",icon:"add",flat:"",onClick:o[0]||(o[0]=_=>i.value.state=!i.value.state)})):E("",!0)])])]),_:1})]),_:1}),e(r,{spaced:"",inset:"",vertical:"",dark:""}),b.value?(k(),S("div",Ye,[e(V,{class:"my-card"},{default:n(()=>[e(u,{class:"text-center text-bold text-h6"},{default:n(()=>[l("div",Ee,[o[11]||(o[11]=l("div",{class:"col"},"Destino",-1)),e(w,{color:"grey",round:"",flat:"",dense:"",icon:x.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[1]||(o[1]=_=>x.value=!x.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:n(()=>[e(P,null,{default:n(()=>[I(l("div",null,[e(F,{refunds:b.value.to,status:v.value},null,8,["refunds","status"])],512),[[H,x.value]])]),_:1})]),_:1})]),_:1}),e(r,{spaced:"",inset:"",vertical:"",dark:""}),B(d).session.store.id!=1?(k(),T(V,{key:0,class:"my-card"},{default:n(()=>[e(u,{class:"text-center text-bold text-h6"},{default:n(()=>[l("div",Ne,[o[12]||(o[12]=l("div",{class:"col"},"Origen",-1)),e(w,{color:"grey",round:"",flat:"",dense:"",icon:g.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[2]||(o[2]=_=>g.value=!g.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:n(()=>[e(P,null,{default:n(()=>[I(l("div",null,[e(F,{refunds:b.value.from,status:v.value},null,8,["refunds","status"])],512),[[H,g.value]])]),_:1})]),_:1})]),_:1})):E("",!0)])):E("",!0)]),_:1}),e(G,{modelValue:i.value.state,"onUpdate:modelValue":o[7]||(o[7]=_=>i.value.state=_),persistent:""},{default:n(()=>[e(V,null,{default:n(()=>[e(u,null,{default:n(()=>o[13]||(o[13]=[l("span",{class:"text-center text-h6 text-bold"},"Nueva Devolucion",-1)])),_:1}),e(u,null,{default:n(()=>[e(J,{modelValue:i.value.reference,"onUpdate:modelValue":o[3]||(o[3]=_=>i.value.reference=_),type:"text",label:"Referencia",filled:"",dense:""},null,8,["modelValue"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:i.value.type,"onUpdate:modelValue":[o[4]||(o[4]=_=>i.value.type=_),o[5]||(o[5]=()=>i.value.provider=null)],options:c.value,label:"Tipo",filled:"",dense:"","option-label":"name"},null,8,["modelValue","options"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:i.value.provider,"onUpdate:modelValue":o[6]||(o[6]=_=>i.value.provider=_),options:$.value,label:"Destino",filled:"",dense:"",disable:i.value.type==null,"option-label":"name"},null,8,["modelValue","options","disable"]),e(r,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(K,{align:"right"},{default:n(()=>[e(w,{flat:"",label:"Cancel",color:"primary",onClick:t}),e(w,{flat:"",label:"Enviar",color:"primary",onClick:a,disable:R.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{at as default};
