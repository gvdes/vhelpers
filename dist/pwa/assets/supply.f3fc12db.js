import{Z as q,f as B,u as I,r as c,g as R,a as y,c as D,d as o,i as a,a6 as E,a3 as F,k as u,m as N,b9 as j,aX as Q,h as T,j as d,a1 as p,Q as z,l as k,a5 as A,n as f,aj as L}from"./index.6772a291.js";import{Q as U}from"./QForm.5265d4cf.js";import{a as h,e as H}from"./QSelect.4738e4d7.js";import{Q as M,b as X,a as Y}from"./QList.832348b5.js";import{Q as Z}from"./QTable.b4dcb871.js";import{Q as G}from"./QPage.a5cb312a.js";import{C as J}from"./ClosePopup.fff889ca.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.3fb35bfd.js";import{u as K}from"./Restock.d6a1227d.js";import{u as O}from"./use-quasar.e757a0da.js";import{$sktRestock as S}from"./socket.168d2ba4.js";import{_ as W}from"./PrinterSelect.ff1ce14f.js";import"./QLinearProgress.427c6ef3.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.b16d05b9.js";import"./QToolbar.e9468a06.js";import"./QTd.90f0f49e.js";import"./QPopupEdit.b10b5e71.js";import"./QTr.edb39c38.js";import"./QLayout.77c7e97a.js";import"./QScrollObserver.6bb52127.js";import"./QResizeObserver.212d10b7.js";import"./QImg.087d1b59.js";import"./QSpace.62a5af0f.js";import"./QExpansionItem.5fb7069d.js";import"./favorites.f52709b7.js";import"./jspdf.plugin.autotable.9beeab41.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */import"./QBtnGroup.a0a12208.js";const tt={class:"flex justify-center"},et={class:"text-center",style:"width: 50%;"},ot={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},at={class:"text-bold"},jt={__name:"supply",setup(it){q(),B();const n=K(),r=O(),_=I(),l=c(null),C=c({rowsPerPage:[0]}),s=c({state:!1,val:null}),v=R(()=>n.partitions.filter(i=>i._status==3&&i.requisition._workpoint_to==_.session.store.id_viz)),P=async()=>{n.setTitle("Surtido"),n.setButtonShow(!1)},V=async i=>{r.loading.show({message:"..."}),console.log(i.ip),console.log(s.value);const e=await g.printForPartition({ip:i.ip,port:i._port,_partition:s.value.val.id,_workpoint_to:s.value.val._workpoint_to});console.log(e),e.status==200?(e.data?r.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):r.notify({message:`Sin conexion a <b>${i.name} <small>(${i.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),r.loading.hide()):(console.error(e),alert(`Error ${e.status}: ${e.data}`))},b=async()=>{if(v.value.findIndex(e=>e.id==l.value)>=0){r.loading.show({message:"Cambiando Estado"});let e={partition:l.value,surtidor:_.session.credentials.staff,state:4};console.log(e);let t=await g.saveSupply(e);if(console.log(t),t.status==200){let x=n.partitions.findIndex(m=>m.id==t.data.partition.id);if(x>=0){if(n.partitions.splice(x,1,t.data.partition),t.data.partitionsEnd>t.data.partition.requisition._status){let m={id:t.data.partition._requisition,state:t.data.partitionsEnd};const w=await g.nextState(m);S.emit("order_refresh",{order:w.data}),console.log(w.data)}S.emit("orderpartition_refresh",{order:t.data.partition})}l.value=null,s.value={state:!1,val:null},r.loading.hide()}else t.status==401?(r.notify({message:"Ya esta surtido",type:"negative",position:"bottom"}),r.loading.hide(),l.value=null):alert(`Error ${t.status}: ${t.data.message} 2`)}else r.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),l.value=null},$=i=>{switch(i){case 4:return"bg-blue-11";case 7:return"bg-red-11";case 5:return"bg-purple-11";case 9:return"bg-green-11";case 23:return"bg-yellow-11";case 13:return"bg-brown-12";default:return""}};return P(),(i,e)=>(y(),D(F,null,[o(G,{padding:""},{default:a(()=>[u("div",null,[u("div",tt,[u("div",et,[o(U,{onSubmit:b},{default:a(()=>[o(N,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value=t),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),o(Z,{rows:v.value,"row-key":"name",grid:"",pagination:C.value,"hide-bottom":""},{item:a(t=>[u("div",ot,[o(M,{bordered:"",class:j($(t.row.requisition.from.id))},{default:a(()=>[Q((y(),T(Y,{clickable:"",onClick:()=>{s.value.state=!0,s.value.val=t.row}},{default:a(()=>[o(X,null,{default:a(()=>[o(h,{class:"text-center text-bold"},{default:a(()=>[d(p(t.row.id),1)]),_:2},1024),o(h,{class:"text-center text-overline text-caption"},{default:a(()=>[u("span",at,p(t.row.requisition.from.name),1),d(" (P: "+p(t.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[L]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),o(E,{modelValue:s.value.state,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.state=t),persistent:""},{default:a(()=>[o(z,null,{default:a(()=>[o(k,{class:"text-bold text-h5 items-center"},{default:a(()=>[d(" Particion "+p(s.value.val.id),1)]),_:1}),o(k,{class:"text-center"},{default:a(()=>e[3]||(e[3]=[d(" Que Desesas Hacer ? ")])),_:1}),o(A,{align:"center"},{default:a(()=>[Q(o(f,{flat:"",icon:"close",color:"negative"},null,512),[[J]]),o(f,{flat:"",icon:"print",color:"primary"},{default:a(()=>[o(H,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[o(W,{onSelectedPartition:V,partition:!0})]),_:1})]),_:1}),o(f,{flat:"",icon:"send",color:"positive",onClick:e[1]||(e[1]=()=>{l.value=s.value.val.id,b()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{jt as default};
