import{Q as d}from"./QSeparator.799f4ab8.js";import{r as p,c as D,o as q,a as j,w as i,aD as G,u as W,e as a,i as c,Y as z,f as I,Q as T,a4 as K,a2 as X}from"./index.d494b13b.js";import{Q as A,b as Z}from"./QSelect.266c796b.js";import{Q as ee}from"./QToolbar.7c3b2744.js";import{Q as le}from"./QHeader.a922db4b.js";import{Q as C}from"./QInput.b3a5670a.js";import{Q as ae}from"./QDate.43365246.js";import{Q as te}from"./QTable.00f79105.js";import{Q as oe,a as se}from"./QLayout.63c45faa.js";import{u as ie,Q as S,a as N}from"./use-quasar.9f1f2a9c.js";import{Q as ne}from"./QForm.c1331520.js";import{Q as k}from"./QDialog.6ace5f50.js";import{Q as R}from"./QCardActions.8f9c87fb.js";import{C as ue}from"./ClosePopup.a64c36aa.js";import"./AppFullscreen.e62868d5.js";import"./auto.c5e70433.js";import"./dayjs.min.25545ff6.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.50eded01.js";import{_ as de}from"./UserToolbar.ea676dfe.js";import{A as re}from"./assistApi.3df7fe01.js";import{u as B}from"./VDB.1e014727.js";import{a as y}from"./axios.f1f32898.js";import{a as ve}from"./axios.30672b3a.js";import"./use-key-composition.720c71eb.js";import"./uid.42677368.js";import"./QItemSection.bf4a904b.js";import"./position-engine.a17c0855.js";import"./rtl.b51694b1.js";import"./QResizeObserver.2a2e8bad.js";import"./use-cache.b0833c75.js";import"./date.a2d43eff.js";import"./QList.cdd96451.js";import"./QLinearProgress.96596ede.js";import"./QCheckbox.a35c6446.js";import"./_commonjsHelpers.88e99c8f.js";const pe={class:"col"},me=c("span",{class:"text-grey"},"Helpers",-1),ce=c("span",{class:"text-h6"},"Anticipos Sucursal",-1),fe={class:"col"},Te={class:"row"},Ae=c("div",{class:"col"},null,-1),be=c("div",{class:"text-h6 text-center"},"Impresora",-1),Ce={class:"q-ml-sm"},tl={__name:"AdvancesLYT",setup(Ne){const r=ie();G();const U=W(),x=B();B();const u=p([]),b=p(null),m=p([]),o=p({val:null,state:!1}),v=p({val:null,opts:[]}),s=p({state:!1,val:null,body:null}),n=p({state:!1,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}),g=p([]),E=p(g.value),V=p({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODANT,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJANT,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"OBSERVACION",field:t=>t.OBSANT,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPANT).toFixed(2),align:"center",sortable:!0},{name:"client",label:"CLEINTE",field:t=>t.NOFCLI,align:"left",sortable:!0}]}),M=D(()=>b.value&&!v.value.val?m.value.filter(t=>t.FECHA==b.value):!b.value&&v.value.val?m.value.filter(t=>t.CAJANT==v.value.val.CODTER):b.value&&v.value.val?m.value.filter(t=>t.FECHA==b.value&&t.CAJANT==v.value.val.CODTER):m.value),Q=D(()=>{if(o.value){const t=m.value.find(l=>l.CODRET===o.value.val.CODRET);if(!t)return!1;let e={CAJANT:t.CAJANT,CODANT:t.CODANT,OBSANT:t.OBSANT,DESTER:t.DESTER,FECHA:t.FECHA,IMPANT:Number(t.IMPANT).toFixed(2),CLIENTE:{CLIANT:t.CLIANT,NOFCLI:t.NOFCLI}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),P=D(()=>!n.value.OBSANT||!n.value.DESTER||!n.value.IMPANT||!n.value.CLIENTE),_=async()=>{r.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const t=await re.index();t.error||(console.log(t),u.value.opts=t,r.loading.hide())},H=(t,e)=>{o.value.state=!o.value.state,console.log(e);let l={CAJANT:e.CAJANT,CODANT:e.CODANT,OBSANT:e.OBSANT,DESTER:e.DESTER,FECHA:e.FECHA,IMPANT:Number(e.IMPANT).toFixed(2),CLIENTE:{CLIANT:e.CLIANT,NOFCLI:e.NOFCLI}};o.value.val={...l}},h=async()=>{console.log(u.value.val.id);let t=u.value.val.id;console.log(t);try{let e=await ve.get(`/cashier/getPrinters/${t}`);e.status==200&&(s.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),r.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},J=async()=>{console.log(u.value.val.ip_address),r.loading.show({message:"Obteniendo Registros"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/getAdvances`;const l=await y.get(e);l.status!=200?console.log(l):(console.log(l.data),m.value=l.data.anticipos,v.value.opts=l.data.terminal,g.value=l.data.clientes,h(),r.loading.hide())},w=async()=>{console.log(u.value.val.ip_address);let t={print:s.value.val.ip_address,codant:o.value.val.CODANT};console.log(t),r.loading.show({message:"Imprimiendo Anticipo"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/printAdvance`;const f=await y.post(l,t);f.status!=200?console.log(f):(console.log(f.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide())},$=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),r.loading.show({message:"Modificando Anticipo"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/modifyAdvances`;const l=await y.post(e,o.value.val);if(l.status!=200)console.log(l);else{console.log(l.data);let f=m.value.findIndex(O=>O.CODANT==l.data.CODANT);f>=0&&(m.value[f]=l.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide()}},F=(t,e,l)=>{if(t===""){e(()=>{E.value=g.value});return}e(()=>{const f=t.toLowerCase();E.value=g.value.filter(O=>O.NOFCLI.toLowerCase().includes(f))})},Y=async()=>{n.value.Print=s.value.val.ip_address,console.log(n.value),r.loading.show({message:"Agregando Anticipo"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/addAdvances`;const l=await y.post(e,n.value);l.status!=200?console.log(l):(console.log(l.data),m.value.push(l.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide(),L())},L=()=>{n.value={state:!1,CAJANT:null,CODANT:null,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}};return x.session.rol==="adm"||x.session.rol==="root"?_():(r.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),U.replace("/")),(t,e)=>(q(),j(oe,{view:"hHh Lpr fFf"},{default:i(()=>[a(le,{class:"bg-grey-3 text-dark",bordered:""},{default:i(()=>[a(de),a(d),a(ee,{class:"justify-between row"},{default:i(()=>[c("div",pe,[me,a(z,{name:"navigate_next",color:"primary"}),ce]),c("div",fe,[c("div",Te,[Ae,a(A,{class:"col",modelValue:u.value.val,"onUpdate:modelValue":[e[0]||(e[0]=l=>u.value.val=l),J],options:u.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(se,null,{default:i(()=>[a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(te,{rows:I(M),filter:V.value.filter,columns:V.value.columns,onRowClick:H},{"top-right":i(()=>[a(C,{modelValue:V.value.filter,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value.filter=l),type:"text",label:"Buscar",filled:"",dense:"",disable:!u.value.val},null,8,["modelValue","disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:v.value.val,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.val=l),options:v.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!u.value.val},null,8,["modelValue","options","disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"event",flat:"",round:"",disable:!u.value.val},{default:i(()=>[a(Z,null,{default:i(()=>[a(ae,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"add",flat:"",onClick:e[4]||(e[4]=l=>n.value.state=!n.value.state),disable:!u.value.val},null,8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),a(k,{modelValue:s.value.state,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.state=l)},{default:i(()=>[a(S,{class:"my-card"},{default:i(()=>[a(N,null,{default:i(()=>[be]),_:1}),a(N,null,{default:i(()=>[a(ne,{onSubmit:w,class:"q-gutter-md"},{default:i(()=>[a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),c("div",null,[a(T,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(k,{modelValue:o.value.state,"onUpdate:modelValue":e[13]||(e[13]=l=>o.value.state=l),persistent:""},{default:i(()=>[a(S,{style:{width:"300px"}},{default:i(()=>[a(N,{class:"text-bold text-center text-h5"},{default:i(()=>[c("span",Ce,"Retirada "+K(o.value.val.CODRET),1)]),_:1}),a(N,null,{default:i(()=>[a(C,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.val.FECHA=l),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.val.DESTER=l),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:o.value.val.CLIENTE,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.val.CLIENTE=l),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:F},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.OBSANT,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.val.OBSANT=l),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.IMPANT,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.val.IMPANT=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(R,{align:"center"},{default:i(()=>[X(a(T,{flat:"",color:"negative",icon:"close"},null,512),[[ue]]),a(T,{flat:"",color:"primary",icon:"print",onClick:w,disable:!I(Q)||!s.value.val},null,8,["disable"]),a(T,{flat:"",color:"yellow",icon:"edit",disable:I(Q)||!s.value.val,onClick:$},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(k,{modelValue:n.value.state,"onUpdate:modelValue":e[19]||(e[19]=l=>n.value.state=l),persistent:""},{default:i(()=>[a(S,{style:{width:"300px"}},{default:i(()=>[a(N,{class:"text-bold text-center text-h5"}),a(N,null,{default:i(()=>[a(A,{modelValue:n.value.DESTER,"onUpdate:modelValue":e[14]||(e[14]=l=>n.value.DESTER=l),options:v.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:n.value.CLIENTE,"onUpdate:modelValue":e[15]||(e[15]=l=>n.value.CLIENTE=l),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:F,dense:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:n.value.OBSANT,"onUpdate:modelValue":e[16]||(e[16]=l=>n.value.OBSANT=l),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:n.value.IMPANT,"onUpdate:modelValue":e[17]||(e[17]=l=>n.value.IMPANT=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[18]||(e[18]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(R,{align:"center"},{default:i(()=>[a(T,{flat:"",color:"negative",icon:"close",onClick:L}),a(T,{flat:"",color:"positive",icon:"send",disable:I(P)||!s.value.val,onClick:Y},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{tl as default};
