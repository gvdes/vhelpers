import{u as te,br as oe,a as se,r as c,J as de,o as b,d as T,w as o,e as t,f as x,ad as n,g as s,h as r,bE as ie,j as U,W as m,i as F,Z as P,_ as Y,k as _,ab as D,$ as h,Q as I,Y as L,X as j}from"./index.02e98f23.js";import{Q as B,a as V}from"./QSelect.53941b07.js";import{Q as M,a as N,b as S}from"./QList.87ca2251.js";import{Q as ne}from"./QForm.e9331a52.js";import{Q as $}from"./QExpansionItem.3c424fa7.js";import{Q as ue}from"./QUploader.f96a6ee6.js";import{Q as re}from"./QPage.2e793c9e.js";import{b as E}from"./billingApi.0768009b.js";import{u as me}from"./BillingStore.e762d1a4.js";import{u as pe}from"./use-quasar.dc53eb3e.js";import{d as H}from"./dayjs.min.cbcf888d.js";import"./QCircularProgress.fb72fc21.js";import"./axios.87cc1b88.js";import"./_commonjsHelpers.88e99c8f.js";const ve={class:"q-gutter-md q-mt-sm"},fe={class:"text-h6 text-bold q-mb-sm"},ce={class:"text-h6 text-bold q-mb-md"},be={key:0},xe={key:1},ge={class:"q-gutter-md q-mt-md"},Ve={class:"row"},ye={class:"col"},Ce={class:"col"},Te={class:"col"},ke={class:"row"},Se={class:"col"},we={class:"col"},De={class:"text-bold"},Ue={class:"text-bold"},Fe={class:"text-bold"},_e=["href"],Ee={class:"text-bold"},Qe={class:"text-bold"},Ae={class:"text-bold"},qe=["href"],Ge={__name:"Index",setup(Re){te(),me();const u=pe(),W=oe(),Z=se(),Q=c(!1),w=c(null),G=c([{id:1,label:"Credito",value:"CRE"},{id:2,label:"Debito",value:"DBT"}]),p=c({client:!1,ticket:!1,data:!0}),y=c({load:!1,show:!0}),k=c({ticket:!1,client:!1}),g=c({state:!1,val:null}),f=c({state:!1,val:null}),A=c([]),q=c([]),l=c({store:null,folio:null,fecha:null,total:"",payments:[],cfdi:"",nombre:"",rfc:"",razonSocial:"",email:"",telefono:"",address:{calle:"",colonia:"",ciudad:"",cp:"",municipio:"",numInt:"",numExt:""}}),J=async d=>{u.loading.show({message:"Obteniendo Datos"});const e=d[0],a=new FormData;a.append("file",e);const i=await E.readCostancy(a);i.fail?u.notify({type:"negative",message:"No se pudieron extraer los datos"}):(console.log(i),l.value.rfc=i.rfc,l.value.razonSocial=i.razonSocial,l.value.address.cp=i.cp,l.value.address.calle=i.calle,l.value.address.colonia=i.colonia,l.value.address.numInt=i.numInt,l.value.address.numExt=i.numExt,l.value.address.municipio=i.municipio,l.value.address.ciudad=i.entFederativa,u.loading.hide(),u.notify({type:"positive",message:"Datos extra\xEDdos correctamente"}))},K=d=>/^([A-ZÃ‘&]{3,4})(\d{6})([A-Z0-9]{3})$/.test(d==null?void 0:d.toUpperCase())||"RFC inv\xE1lido",X=d=>/\S+@\S+\.\S+/.test(d)||"Correo inv\xE1lido",ee=async()=>{if(!l.value.total||!l.value.fecha||!l.value.payments.length)return u.notify({type:"negative",message:"Primero valida el ticket"});if(!l.value.cfdi)return u.notify({type:"negative",message:"Selecciona un uso CFDI"});if(!l.value.nombre||!l.value.email||!l.value.rfc||!l.value.razonSocial||!l.value.address.cp||!l.value.address.calle||!l.value.address.colonia||!l.value.address.ciudad||!l.value.address.municipio)return u.notify({type:"negative",message:"Todos los datos del cliente son obligatorios"});for(let d of l.value.payments)if(["TAR","TBA","TCD","TSA","TSC"].includes(d.payment)&&!d.type_card)return u.notify({type:"negative",message:"Selecciona el tipo de tarjeta para todos los pagos con tarjeta"});le(l.value)},z=()=>{Q.value=!0,l.value={store:l.value.store,folio:null,fecha:null,total:"",payments:[],cfdi:l.value.cfdi,nombre:"",rfc:"",razonSocial:"",email:"",telefono:"",address:{calle:"",colonia:"",ciudad:"",cp:"",municipio:"",numInt:"",numExt:""}},p.value={data:!0,ticket:!1,client:!1},k.value={ticket:!1,client:!1},y.value={load:!1,show:!0},w.value&&w.value.resetValidation(),setTimeout(()=>{Q.value=!1},300),u.notify({type:"info",message:"Formulario limpiado"})},le=async d=>{u.loading.show({message:"Enviando Formulario"}),console.log(d);const e=d.payments.map(v=>{var O;const R=((O=v.type_card)==null?void 0:O.value)||null;let C=null;switch(v.payment){case"CHE":case"EFE":C=v.payment;break;case"TDB":case"TDS":case"TDA":case"TRA":C="TRA";break;case"TSA":case"TSC":case"TAR":case"TBA":case"TCD":R==="CRE"?C="TDC":R==="DBT"?C="TDD":C="TAR";break;default:C="EFE";break}return{...v,payment:C,type_card:R}}),a={...d,payments:e};console.log(a);const i=await E.sendBilling(a);i.fail?console.log(fail):(console.log(i),g.value.state=!0,g.value.val=i,u.loading.hide(),u.notify({message:"Solicitud Creada",type:"positive",position:"top"}),setTimeout(()=>{g.value.state=!1,z()},1e4))},ae=async()=>{var a,i;y.value.load=!0;let d={workpoint:(a=l.value.store)==null?void 0:a.id,folio:l.value.folio};console.log(d);const e=await E.validTicket(d);e.fail?e.fail.status==403?(console.log(e.fail.response.data),f.value.state=!0,f.value.val=e.fail.response.data):console.log(e):(console.log(e),l.value.total=Number(e.Total),l.value.fecha=H(e.fecha).format("YYYY-MM-DD"),l.value.payments=(i=e.fpas)==null?void 0:i.map(v=>({payment:v.FPALCO,concept:v.CPTLCO,import:v.IMPLCO,type_card:null})),y.value.load=!1,y.value.show=!1,p.value.ticket=!0,k.value.ticket=!0,p.value.client=!0,k.value.client=!0)};return(async()=>{u.loading.show({message:"Cargando...."});const d=await E.index();d.fail?console.log(d.fail):(console.log(d),u.loading.hide(),A.value=d.stores,l.value.store=A.value.find(e=>e.id==W.params.sid),q.value=d.cfdi,l.value.cfdi=q.value.find(e=>e.id==2))})(),de(()=>l.value.payments,async()=>{if(Q.value||!w.value)return;await w.value.validate()&&(p.value.data=!1,p.value.ticket=!1,p.value.client=!0,k.value.client=!0)},{deep:!0}),(d,e)=>(b(),T(re,{padding:""},{default:o(()=>[t(I,{class:"q-pa-xl q-mx-auto shadow-4",style:{"max-width":"700px","border-radius":"22px"}},{default:o(()=>[t(x,{class:"text-h5 text-primary text-weight-bold text-center q-mb-md"},{default:o(()=>e[22]||(e[22]=[n(" Solicitud de Factura \xB7 Grupo Vizcarra ")])),_:1}),t(x,null,{default:o(()=>[t($,{modelValue:p.value.data,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value.data=a),label:"Datos de la Compra",icon:"shopping_cart","header-class":"text-h6 text-primary text-weight-bold","expand-separator":""},{default:o(()=>[s("div",ve,[t(B,{modelValue:l.value.store,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.store=a),options:A.value,label:"Sucursal",filled:"",dense:"","option-label":"name",disable:""},null,8,["modelValue","options"]),t(r,{modelValue:l.value.folio,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.folio=a),type:"text",label:"Folio del Ticket",filled:"",dense:"",mask:"#-######",disable:!y.value.show},ie({_:2},[y.value.show?{name:"after",fn:o(()=>[t(U,{dense:"",color:"primary",label:"Validar",onClick:ae,loading:y.value.load,disable:!l.value.folio||!l.value.store||l.value.folio.length<8},null,8,["loading","disable"])]),key:"0"}:void 0]),1032,["modelValue","disable"])]),k.value.ticket?(b(),T($,{key:0,modelValue:p.value.ticket,"onUpdate:modelValue":e[4]||(e[4]=a=>p.value.ticket=a),icon:"receipt_long",label:"Detalle del Ticket","header-class":"text-h6 text-primary text-weight-bold",class:"q-mt-md"},{default:o(()=>[t(ne,{ref_key:"formTicket",ref:w,class:"q-mt-md"},{default:o(()=>[e[26]||(e[26]=s("div",{class:"text-subtitle1 q-mb-xs"},"Fecha:",-1)),s("div",fe,m(l.value.fecha),1),e[27]||(e[27]=s("div",{class:"text-subtitle1 q-mb-xs"},"Total:",-1)),s("div",ce,"$ "+m(l.value.total),1),t(M,{bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[(b(!0),F(Y,null,P(l.value.payments,(a,i)=>(b(),T(N,{key:i},{default:o(()=>[t(S,null,{default:o(()=>[t(V,{caption:""},{default:o(()=>e[23]||(e[23]=[n("Forma de Pago")])),_:1}),t(V,{class:"text-bold"},{default:o(()=>[["TAR","TBA","TCD","TSA","TSC"].includes(a.payment)?(b(),F("span",be,"Tarjeta")):(b(),F("span",xe,m(a.concept),1))]),_:2},1024)]),_:2},1024),t(S,{class:"text-center"},{default:o(()=>[t(V,{caption:""},{default:o(()=>e[24]||(e[24]=[n("Importe")])),_:1}),t(V,{class:"text-bold"},{default:o(()=>[n("$ "+m(Number(a.import)),1)]),_:2},1024)]),_:2},1024),["TAR","TBA","TCD","TSA","TSC"].includes(a.payment)?(b(),T(S,{key:0},{default:o(()=>[t(V,{caption:"",class:"text-center"},{default:o(()=>e[25]||(e[25]=[n("Tipo Tarjeta")])),_:1}),t(B,{modelValue:a.type_card,"onUpdate:modelValue":v=>a.type_card=v,options:G.value,filled:"",dense:"",label:"Selecciona...",class:"q-mt-xs",rules:[v=>!!v||"Selecciona un tipo"]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),_:2},1024)):_("",!0)]),_:2},1024))),128))]),_:1}),t(B,{filled:"",dense:"",class:"q-mt-md",label:"Uso de CFDI",modelValue:l.value.cfdi,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.cfdi=a),options:q.value,"option-label":"name","emit-value":"","map-options":"",rules:[a=>!!a||"Obligatorio"]},null,8,["modelValue","options","rules"]),t(r,{modelValue:l.value.notes,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.notes=a),type:"textarea",autogrow:"",filled:"",dense:"",label:"Comentarios opcionales",class:"q-mt-md"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue"])):_("",!0)]),_:1},8,["modelValue"])]),_:1}),t(x,null,{default:o(()=>[k.value.client?(b(),T($,{key:0,modelValue:p.value.client,"onUpdate:modelValue":e[18]||(e[18]=a=>p.value.client=a),"header-class":"text-h6 text-primary text-weight-bold",label:"Datos del Cliente",icon:"person","expand-separator":""},{default:o(()=>[s("div",ge,[t(ue,{label:"Subir Constancia Fiscal (PDF)",accept:".pdf",onAdded:J,class:"full-width",dense:"","hide-upload-btn":""}),t(r,{filled:"",dense:"",label:"Nombre de Contacto",modelValue:l.value.nombre,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.nombre=a),rules:[a=>!!a||"Obligatorio"]},null,8,["modelValue","rules"]),t(r,{filled:"",dense:"",label:"Correo Electr\xF3nico",modelValue:l.value.email,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.email=a),rules:[X],type:"email"},null,8,["modelValue","rules"]),t(r,{filled:"",dense:"",label:"Tel\xE9fono",modelValue:l.value.telefono,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.telefono=a),mask:"##########"},null,8,["modelValue"]),t(r,{filled:"",dense:"",label:"RFC",modelValue:l.value.rfc,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.rfc=a),rules:[K]},null,8,["modelValue","rules"]),t(r,{filled:"",dense:"",label:"Raz\xF3n Social",modelValue:l.value.razonSocial,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.razonSocial=a),rules:[a=>!!a||"Obligatorio"]},null,8,["modelValue","rules"]),t(r,{filled:"",dense:"",label:"Calle",modelValue:l.value.address.calle,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.address.calle=a)},null,8,["modelValue"]),t(r,{filled:"",dense:"",label:"Colonia",modelValue:l.value.address.colonia,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.address.colonia=a)},null,8,["modelValue"]),s("div",Ve,[s("div",ye,[t(r,{filled:"",dense:"",label:"Num Ext",modelValue:l.value.address.numExt,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.address.numExt=a)},null,8,["modelValue"])]),t(D,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Ce,[t(r,{filled:"",dense:"",label:"Num Int",modelValue:l.value.address.numInt,"onUpdate:modelValue":e[14]||(e[14]=a=>l.value.address.numInt=a)},null,8,["modelValue"])]),t(D,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Te,[t(r,{filled:"",dense:"",label:"Municipio",modelValue:l.value.address.municipio,"onUpdate:modelValue":e[15]||(e[15]=a=>l.value.address.municipio=a)},null,8,["modelValue"])])]),s("div",ke,[s("div",Se,[t(r,{filled:"",dense:"",label:"Ciudad",modelValue:l.value.address.ciudad,"onUpdate:modelValue":e[16]||(e[16]=a=>l.value.address.ciudad=a)},null,8,["modelValue"])]),t(D,{spaced:"",inset:"",vertical:"",dark:""}),s("div",we,[t(r,{filled:"",dense:"",label:"C.P.",modelValue:l.value.address.cp,"onUpdate:modelValue":e[17]||(e[17]=a=>l.value.address.cp=a),mask:"#####"},null,8,["modelValue"])])])])]),_:1},8,["modelValue"])):_("",!0)]),_:1}),t(h,{align:"right",class:"q-mt-md"},{default:o(()=>[t(U,{label:"Limpiar",flat:"",color:"primary",onClick:z}),t(U,{label:"Enviar Solicitud",color:"primary",unelevated:"",onClick:ee})]),_:1})]),_:1}),t(L,{modelValue:g.value.state,"onUpdate:modelValue":e[19]||(e[19]=a=>g.value.state=a),persistent:""},{default:o(()=>[t(I,{class:"q-pa-lg",style:{"min-width":"350px"}},{default:o(()=>[t(x,{class:"text-center text-h5 text-primary"},{default:o(()=>e[28]||(e[28]=[n("Solicitud Generada")])),_:1}),t(x,{class:"text-subtitle1"},{default:o(()=>[e[29]||(e[29]=n(" Folio: ")),s("span",De,m(g.value.val.id),1),e[30]||(e[30]=s("br",null,null,-1)),e[31]||(e[31]=n(" Contacto: ")),s("span",Ue,m(g.value.val.name),1),e[32]||(e[32]=s("br",null,null,-1)),e[33]||(e[33]=n(" Tel\xE9fono: ")),s("span",Fe,m(g.value.val.celphone),1)]),_:1}),t(x,{class:"text-center"},{default:o(()=>[s("a",{class:"text-positive",href:`https://wa.me/5573461022?text=Cual%20es%20el%20estado%20de%20mi%20solicitud?%20Folio:%20${g.value.val.id}`}," Consultar por WhatsApp ",8,_e)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:f.value.state,"onUpdate:modelValue":e[21]||(e[21]=a=>f.value.state=a),persistent:""},{default:o(()=>[t(I,{class:"q-pa-lg",style:{"min-width":"420px","max-width":"760px","border-radius":"12px"}},{default:o(()=>[t(x,{class:"text-h6 text-primary text-weight-bold"},{default:o(()=>[e[34]||(e[34]=n(" Folio Solicitud: ")),s("span",Ee,m(f.value.val.id),1)]),_:1}),t(x,{class:"text-subtitle2"},{default:o(()=>[s("div",null,[e[35]||(e[35]=n("Contacto: ")),s("span",Qe,m(f.value.val.name),1)]),s("div",null,[e[36]||(e[36]=n("Tel\xE9fono: ")),s("span",Ae,m(f.value.val.celphone),1)])]),_:1}),t(D),t(x,null,{default:o(()=>[e[39]||(e[39]=s("div",{class:"text-h6 q-mb-sm text-bold"},"Historial de Proceso",-1)),t(M,{bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[!f.value.val.log||!f.value.val.log.length?(b(),T(N,{key:0},{default:o(()=>[t(S,{class:"text-center"},{default:o(()=>e[37]||(e[37]=[n("No hay movimientos registrados")])),_:1})]),_:1})):_("",!0),(b(!0),F(Y,null,P(f.value.val.log,(a,i)=>(b(),T(N,{key:i,class:"row items-center"},{default:o(()=>[t(S,{class:"col"},{default:o(()=>[t(V,{class:"text-bold"},{default:o(()=>[n(m(a.name),1)]),_:2},1024),t(V,{caption:""},{default:o(()=>[n(m(j(H)(a.pivot.created_at).format("YYYY-MM-DD HH:mm")),1)]),_:2},1024)]),_:2},1024),t(S,{class:"col-auto"},{default:o(()=>[t(V,{class:"text-caption"},{default:o(()=>e[38]||(e[38]=[n("Usuario")])),_:1}),t(V,{class:"text-bold"},{default:o(()=>[n(m(a.pivot._user),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(D),t(x,{class:"text-center"},{default:o(()=>[e[40]||(e[40]=s("div",{class:"text-h6 text-primary q-mb-sm"},"\xBFDudas o seguimiento?",-1)),s("a",{class:"text-positive",href:`https://wa.me/5573461022?text=Cual%20es%20el%20estado%20de%20mi%20solicitud?%20Folio:%20${f.value.val.id}`,target:"_blank",rel:"noopener"}," Enviar Whatsapp al soporte ",8,qe)]),_:1}),t(h,{align:"right"},{default:o(()=>[t(U,{flat:"",label:"OK",color:"primary",onClick:e[20]||(e[20]=a=>j(Z).go(0))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ge as default};
