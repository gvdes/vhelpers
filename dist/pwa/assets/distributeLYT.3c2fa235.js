import{Q as L}from"./QHeader.229a19ab.js";import{aH as F,a as T,u as Y,r as $,p as M,n as j,m as E,a$ as H,o as g,d as w,w as c,e as n,a1 as h,f as u,a0 as b,Q as _,h as k}from"./index.7ddec3e2.js";import{Q as I}from"./QToolbar.9250c28e.js";import{Q as N,a as A}from"./QLayout.3cf72733.js";import{Q as G}from"./QDate.e91755b7.js";import{Q as U}from"./QCardSection.b987ffb3.js";import{Q as J}from"./QCardActions.4ebb4bad.js";import{Q as K}from"./QCard.57ab7529.js";import{Q as W}from"./QList.82ebe701.js";import{_ as X}from"./UserToolbar.0952645f.js";import{u as V}from"./Restock.69268ec7.js";import{d as Z}from"./dayjs.min.cbcf888d.js";import{R as p}from"./RestockApi.38c09b2a.js";import{u as oo}from"./use-quasar.de8cf9ed.js";import{$sktRestock as i}from"./socket.3fae67a0.js";import"./QResizeObserver.b1deec6b.js";import"./QScrollObserver.f8ca16f6.js";import"./use-render-cache.3aae9b27.js";import"./date.f6013701.js";import"./QSelect.64a00cbf.js";import"./QDrawer.fbce68d2.js";import"./ClosePopup.4d3a13d2.js";import"./auth.6f123c97.js";import"./axios.e86ca967.js";import"./QForm.cced227d.js";import"./QRadio.a7664efd.js";import"./QCheckbox.05cad769.js";import"./QInput.4c2b76c2.js";import"./QTd.c2ba3f36.js";import"./QPopupEdit.40c42a2b.js";import"./QTr.61e3864d.js";import"./QTable.790242db.js";import"./QLinearProgress.ec8888f0.js";import"./QPage.7fee177a.js";import"./jspdf.plugin.autotable.77ea9125.js";import"./_commonjsHelpers.88e99c8f.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const eo={class:"text-bold"},to={class:"row"},ro={class:"col row"},io={class:"q-pa-md"},Ao={__name:"distributeLYT",setup(ao){const y=V();F(),T();const t=V(),v=oo(),a=Y(),m=$(!1),d=$({val:{from:null,to:null}}),S={profile:{me:{id:a.session.credentials.staff.id_va,nick:a.session.credentials.nick,picture:"",names:a.session.credentials.staff.complete_name,surname_pat:"",surname_mat:"",change_password:!1,_rol:1},workpoint:a.session.store},workpoint:a.session.store},Q=async()=>{t.setShowLoad(!0),v.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let o=Z(new Date).format("YYYY/MM/DD");d.value.val={from:o,to:o};const e=await p.index({date:d.value.val,storeTo:a.session.store.id_viz});e.fail?console.log(e):(console.log(e),t.fillOrders(e.orders),t.fillResume(e.resume),t.fillPrinters(e.printers),t.fillPartitions(e.partitions),t.setShowLoad(!1),console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),v.loading.hide())},B=async()=>{m.value=!1,v.loading.show({message:"Obteniendo Datos"});const o=await p.index({date:d.value.val,storeTo:a.session.store.id_viz});console.log(o),t.fillOrders(o.orders),t.fillPartitions(o.partitions),console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),v.loading.hide()},C=async o=>{if(console.log(o),o.order.requisition.to.id===a.session.store.id_viz||o.order.requisition.from.id===a.session.store.id_viz){o.order,console.log("Partition refresh!!",o);let e=o.order,s=o.order.id;t.addOrUpdatePartition(s,e),console.log(e),console.log(s);let r=t.ordersdb.find(f=>f.id==e._requisition).partition;console.log(r);let l=r.findIndex(f=>f.id==e.id);l>=0&&r.splice(l,1,e)}},P=o=>{console.log(`%c${o.user.me.nick} de ${o.from.alias} se ha unido a Restock (UID: ${o.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},q=async o=>{if(console.log(o),o.order.to.id===a.session.store.id_viz||o.order.from.id===a.session.store.id_viz){let e=o.order;console.log(o.order.to.id);let s=await p.orderFresh(e.id),r=s.data.order,l=s.data.oid;t.addOrUpdate(l,r)}},z=async o=>{if(console.log(o),o.requisition.to.id===a.session.store.id_viz||o.requisition.from.id===a.session.store.id_viz){console.log(o.requisition.to.id);let e=o,s=o.id;t.addOrUpdatePartition(s,e)}},D=async o=>{console.log(o);let e=o.id,s=o._requisition;t.deleteParition(e),t.deleteParitionOrder(e,s)},O=o=>{t.orderUpdate(o)},x=async o=>{if(o.order.to.id===a.session.store.id_viz){let e=o.order,s=o.state,r=await p.orderFresh(e.id),l=r.data.order,f=r.data.oid;t.addOrUpdate(f,l),s.id==2}},R=async o=>{var e;if(console.log(o),((e=o.order)==null?void 0:e.to.id)===a.session.store.id_viz||o.order.from.id===a.session.store.id_viz){console.log("REFRESHING BY SKT!!",o);let s=o.order,r=await p.orderFresh(s.id);console.log(r);let l=r.data.order;console.log(l.partition);let f=r.data.oid;t.addOrUpdate(f,l)}};return M(async()=>{i.connect(),i.emit("joinat",S),i.on("joineddashreq",P),i.on("creating",q),i.on("order_update",O),i.on("order_changestate",x),i.on("order_refresh",R),i.on("orderpartition_refresh",C),i.on("sktPartitionCreate",z),i.on("sktPartitionDelete",D),await j(),window.layoutReady=!0,await Q(),window.dispatchEvent(new Event("layout-ready"))}),E(()=>{i.off("joineddashreq",P),i.off("creating",q),i.off("order_update",O),i.off("order_changestate",x),i.off("order_refresh",R),i.off("orderpartition_refresh",C),i.on("sktPartitionCreate",z),i.on("sktPartitionDelete",D)}),(o,e)=>{const s=H("router-view");return g(),w(N,{view:"hHh Lpr fFf"},{default:c(()=>[n(L,{class:"transparent text-dark",bordered:""},{default:c(()=>[n(X)]),_:1}),n(A,null,{default:c(()=>[h(t).showLYT?(g(),w(I,{key:0,class:"row justify-between items-center"},{default:c(()=>[u("div",eo,b(h(y).title),1),u("div",null,b(d.value.val&&d.value.val.from?`Del ${d.value.val.from} a ${d.value.val.to}`:d.value.val),1),u("div",to,[n(_,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:Q}),u("div",ro,[h(y).showButton?(g(),w(_,{key:0,color:"primary",icon:"event",onClick:e[0]||(e[0]=r=>m.value=!m.value),flat:"",round:""})):k("",!0)])])]),_:1})):k("",!0),n(s)]),_:1}),n(W,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=r=>m.value=r)},{default:c(()=>[n(K,{class:"my-card"},{default:c(()=>[n(U,null,{default:c(()=>[u("div",io,[e[4]||(e[4]=u("div",{class:"q-pb-sm text-center"},null,-1)),n(G,{modelValue:d.value.val,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value.val=r),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),n(U,null,{default:c(()=>[n(J,{align:"right"},{default:c(()=>[n(_,{flat:"",icon:"close",color:"negative",onClick:e[2]||(e[2]=r=>m.value=!m.value)}),n(_,{flat:"",icon:"check",color:"positive",onClick:B})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Ao as default};
