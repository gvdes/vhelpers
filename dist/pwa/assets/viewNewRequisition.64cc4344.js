import{u as ae,f as ie,Z as ne,r as y,g as E,a as v,h as p,i,p as m,k as o,d as a,a7 as de,n as r,a1 as d,a4 as _,ah as ue,m as U,Q as V,b9 as re,j as x,l as C,aX as j,bK as ce,a5 as A,a6 as M}from"./index.0d286209.js";import{d as ve,Q as pe}from"./QTable.6a34fccc.js";import{Q as me}from"./QBanner.3868c34b.js";import{Q as fe}from"./QBtnGroup.ed6ac24c.js";import{Q as _e}from"./QPageSticky.069e8077.js";import{Q as xe}from"./QSelect.75fb6875.js";import{Q as ge,a as F,b as q}from"./QList.c6b82b90.js";import{Q as ke}from"./QSpace.f0ea4fd4.js";import{Q as be}from"./QFooter.b00707b5.js";import{Q as ye}from"./QPage.c6de2f38.js";import{C as we}from"./ClosePopup.b1db4109.js";import"./QImg.f121d2fb.js";import"./QExpansionItem.9fa686a6.js";import"./favorites.28144d1a.js";import"./axios.641704b8.js";import{u as he}from"./use-quasar.99736a50.js";import{P as Ce}from"./ProductsAutocomplete.c0f43f3c.js";import{E as qe}from"./exceljs.min.9e24d01d.js";import{u as Pe}from"./Restock.5b6cf2ef.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.1bc3e9d3.js";import"./JsBarcode.cb858474.js";import"./dayjs.min.cbcf888d.js";import{$sktRestock as Qe}from"./socket.168d2ba4.js";import"./QForm.bf2df794.js";import"./QBadge.8151b391.js";import{R as w}from"./RestockApi.e13ca8a6.js";import"./QToolbar.15a381c5.js";import"./QLinearProgress.325ed038.js";import"./QResizeObserver.b173e2da.js";import"./QScrollObserver.24fbe5fa.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";import"./QTd.0c1c96ae.js";import"./QPopupEdit.f9e3de21.js";import"./QTr.32a97f86.js";import"./QLayout.5d95cffe.js";/* empty css                                                       */const Ve={class:"row items-stretch justify-between bg-primary text-white"},Se={class:"row items-center col divlcient"},Ie={class:"q-pa-sm col text-center"},ze={class:"text-uppercase"},Fe={class:"q-pa-sm col text-center"},Ne={class:"text-bold"},Re={class:"q-pa-sm col text-center"},Be={class:"text-bold"},De={class:"row items-center justify-between q-mt-sm"},$e={class:"row text-center"},Ee={class:"q-px-md"},Ue={class:"text-bold"},je={class:"q-px-md"},Ae={class:"text-bold"},Me={class:"q-px-md"},Te={class:"text-bold"},Le={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3"},Oe={class:"row items-center q-pt-md"},Ke={class:"col q-px-md"},Ge={class:"text-bold"},Je={class:"text--2"},We={class:"col q-px-md"},Xe={class:"text-center"},Ye={class:"text--2"},Ze={class:"text-weight-bold"},He={class:"row q-pt-xs"},et={class:"row"},tt={class:"text-h6 col text-bold text-left"},lt={class:"text-h6 col text-bold text-right"},ot={class:"text-subtitle2 col"},st={class:"row items-end"},at={class:"text-center"},it={class:"col q-pa-xs"},nt={class:"col column q-py-md"},dt=["disabled"],ut={class:"col q-pa-xs"},rt={class:"text-bold text-red"},ct={class:"row q-ml-sm"},Yt={__name:"viewNewRequisition",setup(vt){const T=ae(),u=he(),L=Pe(),N=ie(),S=ne(),n=y(null),h=y([]),l=y({state:!1,val:null,edit:!1}),k=y({state:!1,notfound:[],added:[]}),R=y(null),P=y({pagination:{rowsPerPage:16},filter:""}),c=y({_requisition:S.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null}),O=E(()=>{let s=l.value.val.pivot._supply_by==3?l.value.val.pivot.amount*l.value.val.pieces:l.value.val.pivot._supply_by==2?l.value.val.pivot.amount*12:l.value.val.pivot.amount;return l.value.val.pivot.units=s,s}),K=E(()=>{let s=l.value.val.pivot._supply_by==3?l.value.val.pivot.stock/l.value.val.pieces:l.value.val.pivot._supply_by==2?l.value.val.pivot.stock/12:l.value.val.pivot.stock;return l.value.val.pivot.units=s,s}),B=s=>s.pivot._supply_by==3?s.pivot.stock/s.pieces:s.pivot._supply_by==2?s.pivot.stock/12:s.pivot.stock,G=s=>{console.log(s),l.value.val=s,l.value.state=!0,l.value.edit=!0},J=s=>{console.log(s);let e=n.value.products.findIndex(t=>t.id==s.id);console.log(e),e>=0?(l.value.val=n.value.products[e],l.value.state=!0,l.value.edit=!0):(l.value.edit=!1,l.value.val=s,c.value._product=ops.id,c.value._supply_by=ops._unit,c.value.ipack=ops.pieces,c.value.cost=ops.prices.find(t=>t.id==6).pivot.price,c.value.stock=ops.stocks.find(t=>t.id==n.value.to.id).pivot.stock,l.value.val.pivot=c.value,l.value.state=!0)},W=s=>{console.log(s);let e=n.value.products.findIndex(t=>t.id==s.id);console.log(e),e>=0?(l.value.val=n.value.products[e],console.log(l.value.val),l.value.state=!0,l.value.edit=!0):(l.value.val=s,c.value._product=s.id,c.value._supply_by=s._unit,c.value.ipack=s.pieces,c.value.cost=s.prices.find(t=>t.id==6).pivot.price,c.value.stock=s.stocks.find(t=>t.id==n.value.to.id).pivot.stock,l.value.val.pivot=c.value,l.value.edit=!1,l.value.state=!0)},X=async()=>{L.setShowLYT(!1),u.loading.show({message:"Obteniendo Pedido"});let s={workpoint:T.session.store.id_viz,folio:S.params.rid};const e=await w.getRequired(s);e.fail?console.log(e):(u.loading.hide(),console.log(e),n.value=e.order,h.value=e.units)},Y=async()=>{u.loading.show({message:"Insertando Producto"}),l.value.val.pivot.total=l.value.val.pivot.units*l.value.val.pivot.cost;const s=await w.addProductRequired(l.value.val.pivot);s.fail?console.log(s):(console.log(s),u.loading.hide(),n.value.products.push(s),I())},Z=async()=>{u.loading.show({message:"Editando Producto"}),l.value.val.pivot.total=l.value.val.pivot.units*l.value.val.pivot.cost;const s=await w.addProductRequired(l.value.val.pivot);if(s.fail)console.log(s);else{console.log(s),u.loading.hide();let e=n.value.products.findIndex(t=>t.id==l.value.val.id);n.value.products.splice(e,1,s),I()}},H=async()=>{u.loading.show({message:"Eliminando Producto"});const s=await w.deleteProductRequired(l.value.val.pivot);if(s.fail)console.log(s);else{console.log(s),u.loading.hide();let e=n.value.products.findIndex(t=>t.id==l.value.val.id);n.value.products.splice(e,1),I()}},ee=()=>{R.value.click()},te=async()=>{let s=document.getElementById("inputFile").files[0],e=new qe.Workbook,t={};e.xlsx.load(s).then(async f=>{let z=e.worksheets[0],oe=z.getColumn("A");z.getColumn("B"),oe.eachCell({includeEmpty:!0},function(b,g){if(g===1)return;let Q=b.value,se=z.getCell(`B${g}`),$=parseFloat(se.value);Q&&(t[Q]?t[Q]+=$:t[Q]=$)});let D=Object.keys(t).map(b=>({codigo:b,cantidad:t[b]}));if(D.length){let b={codes:D,_requisition:n.value.id};u.loading.show({message:"Procesando archivo, espera.."}),console.log(b);const g=await w.addMassiveProducts(b);g.fail?console.log(g):(console.log(g),n.value.products=g.products,k.value.state=!0,k.value.added=g.products,k.value.notfound=g.notFound,u.loading.hide())}else u.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},le=async()=>{u.loading.show({message:"Enviando Pedido"});const s=await w.nextStep({id:n.value.id});console.log(s),s.status==200?(console.log(s),u.notify({message:"Pedido Enviado :)",type:"positive",position:"center"}),N.push("/distribute/dashboardStore"),Qe.emit("order_refresh",{order:s.data.requisition}),u.loading.hide()):alert("Problema con el envio de el pedido ")},I=()=>{c.value={_requisition:S.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null},l.value={state:!1,val:null,edit:!1}};return X(),(s,e)=>n.value?(v(),p(ye,{key:0,padding:""},{default:i(()=>[o("div",Ve,[a(r,{onClick:e[0]||(e[0]=()=>de(N).push("/distribute/dashboardStore")),flat:"",icon:"close",color:"white"}),o("div",Se,[o("div",Ie,[e[9]||(e[9]=o("div",{class:"text--2"},"Destino:",-1)),o("div",ze,d(n.value.to.alias),1)]),o("div",Fe,[e[10]||(e[10]=o("div",{class:"text--2"},"Folio:",-1)),o("div",Ne,d(n.value.id),1)]),o("div",Re,[e[11]||(e[11]=o("div",{class:"text--2"},"Almacen:",-1)),o("div",Be,d(n.value._warehouse),1)])])]),o("div",De,[o("div",$e,[o("div",Ee,[e[12]||(e[12]=o("div",{class:"text--2"},"Modelos",-1)),o("span",Ue,d(n.value.products.length),1)]),o("div",je,[e[13]||(e[13]=o("div",{class:"text--2"},"Unidades",-1)),o("span",Ae,d(n.value.products.reduce((t,f)=>t+Number(f.pivot.units),0)),1)]),o("div",Me,[e[14]||(e[14]=o("div",{class:"text--2"},"Cajas",-1)),o("span",Te,d(n.value.products.reduce((t,f)=>t+Number(Number(f.pivot.units)/Number(f.pieces)),0)),1)])]),a(_,{spaced:"",inset:"",vertical:"",dark:""}),a(U,{dense:"",debounce:"300",modelValue:P.value.filter,"onUpdate:modelValue":e[1]||(e[1]=t=>P.value.filter=t),placeholder:"Buscar",class:"col-auto",outlined:""},{append:i(()=>[a(ue,{name:"search"})]),_:1},8,["modelValue"])]),a(_,{spaced:"",inset:"",vertical:"",dark:""}),a(pe,{grid:"",flat:"",dark:"","row-key":"id",rows:n.value.products,filter:P.value.filter,pagination:P.value.pagination},{item:i(t=>[o("div",Le,[a(V,{class:"q-mb-sm q-mr-sm",onClick:f=>G(t.row)},{default:i(()=>[o("div",Oe,[o("div",Ke,[o("div",Ge,d(t.row.code),1),o("div",null,d(t.row.name),1),o("div",Je,d(t.row.description),1)])]),o("div",We,[a(ve,{flat:"",class:""},{default:i(()=>[o("thead",null,[o("tr",null,[o("th",null,"Sol. ("+d(h.value.find(f=>f.id==t.row.pivot._supply_by).name)+")",1),e[15]||(e[15]=o("th",null,"pzs / caj",-1)),o("th",null,"Disp. ("+d(h.value.find(f=>f.id==t.row.pivot._supply_by).name)+")",1)])]),o("tbody",null,[o("tr",Xe,[o("td",null,d(t.row.pivot.amount),1),o("td",null,d(t.row.pieces),1),o("td",null,[o("span",{class:re(B(t.row)>=1?"text-green-10":"text-pink-10")},d(Math.round(B(t.row))),3)])])])]),_:2},1024)]),t.row.pivot.comments||t.row.pivot._supply_by?(v(),p(me,{key:0,rounded:"",class:""},{default:i(()=>[o("span",Ye,[e[16]||(e[16]=x(" Se surtira la cantidad de ")),o("span",Ze,d(t.row.pivot.units)+"pz",1),x(" correspondiente a la unidad de "+d(h.value.find(f=>f.id==t.row.pivot._supply_by).name)+" ",1),a(_,{dark:""}),x(" Notas: "+d(t.row.pivot.comments),1)])]),_:2},1024)):m("",!0)]),_:2},1032,["onClick"])])]),bottom:i(t=>[a(_e,{position:"bottom",class:"full-width",offset:[0,18]},{default:i(()=>[o("div",He,[a(fe,{rounded:"",class:""},{default:i(()=>[t.pagesNumber>2?(v(),p(r,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):m("",!0),a(r,{icon:"chevron_left",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),a(r,{flat:"",disable:"","no-caps":""},{default:i(()=>[x(d(t.pagination.page)+" / "+d(t.pagesNumber),1)]),_:2},1024),a(r,{icon:"chevron_right",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),t.pagesNumber>2?(v(),p(r,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:t.lastPage,class:"q-px-sm"},null,8,["onClick"])):m("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","filter","pagination"]),a(M,{modelValue:l.value.state,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.state=t),position:"bottom"},{default:i(()=>[l.value.val?(v(),p(V,{key:0},{default:i(()=>[a(C,{class:"item-center"},{default:i(()=>[o("div",et,[o("div",tt,d(l.value.val.code),1),e[17]||(e[17]=o("div",{class:"text-subtitle2 col text-bold text-center"},null,-1)),o("div",lt,d(l.value.val.name),1)]),o("div",ot,d(l.value.val.description),1)]),_:1}),a(C,null,{default:i(()=>[o("div",st,[o("div",at,[o("div",it,[e[18]||(e[18]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),n.value.status.id==1?(v(),p(r,{key:0,flat:"",color:"positive",icon:"add",class:"text-h5",onClick:e[2]||(e[2]=t=>l.value.val.pivot.amount++)})):m("",!0),a(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",nt,[j(o("input",{type:"number",min:"1","onUpdate:modelValue":e[3]||(e[3]=t=>l.value.val.pivot.amount=t),class:"text-center exo clean-input",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"},disabled:n.value.status.id!=1},null,8,dt),[[ce,l.value.val.pivot.amount]])]),a(_,{spaced:"",inset:"",vertical:"",dark:""}),n.value.status.id==1?(v(),p(r,{key:1,flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:e[4]||(e[4]=t=>l.value.val.pivot.amount>1?l.value.val.pivot.amount--:"")})):m("",!0)])]),a(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",ut,[a(xe,{dense:"",filled:"",modelValue:l.value.val.units,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.val.units=t),options:h.value,label:"Surtir por","option-label":"name",disable:""},null,8,["modelValue","options"]),a(_,{spaced:"",inset:"",vertical:"",dark:""}),a(U,{dense:"",filled:"",modelValue:l.value.val.pivot.comments,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.val.pivot.comments=t),type:"text",label:"Notas"},null,8,["modelValue"]),a(_,{spaced:"",inset:"",vertical:"",dark:""}),a(ge,null,{default:i(()=>[a(F,{class:""},{default:i(()=>[a(q,{class:"text-bold text-center"},{default:i(()=>[x(d(K.value)+" "+d(l.value.val.units.id==3?"Cjs":l.value.val.units.id==2?"Dcns":"Pzs"),1)]),_:1})]),_:1}),a(F,{class:""},{default:i(()=>[a(q,{class:"text-left text-caption"},{default:i(()=>e[19]||(e[19]=[x("P x C")])),_:1}),a(q,{class:"text-bold text-center"},{default:i(()=>[x(d(l.value.val.pieces)+" pzs",1)]),_:1})]),_:1}),a(F,null,{default:i(()=>[a(q,{class:"text-left text-caption"},{default:i(()=>e[20]||(e[20]=[x("Unidades")])),_:1}),a(q,{class:"text-bold text-center"},{default:i(()=>[x(d(O.value)+" pzs",1)]),_:1})]),_:1})]),_:1})])])]),_:1}),n.value.status.id==1?(v(),p(A,{key:0},{default:i(()=>[a(ke),l.value.edit?m("",!0):(v(),p(r,{key:0,flat:"",icon:"add",color:"positive",onClick:Y})),l.value.edit?(v(),p(r,{key:1,flat:"",icon:"delete",color:"negative",onClick:H})):m("",!0),l.value.edit?(v(),p(r,{key:2,flat:"",icon:"edit",color:"warning",onClick:Z})):m("",!0)]),_:1})):m("",!0)]),_:1})):m("",!0)]),_:1},8,["modelValue"]),a(M,{modelValue:k.value.state,"onUpdate:modelValue":e[8]||(e[8]=t=>k.value.state=t),persistent:""},{default:i(()=>[a(V,null,{default:i(()=>[a(C,{class:"text-center text-h5 text-bold"},{default:i(()=>e[21]||(e[21]=[x(" Resultados de Importacion ")])),_:1}),a(C,{class:"text-centet text-h6 text-bold"},{default:i(()=>[x(" Correctos: "+d(k.value.added.length),1)]),_:1}),a(C,null,{default:i(()=>[e[22]||(e[22]=x(" Modelos sin Coincidencia: ")),o("span",rt,d(k.value.notfound),1)]),_:1}),a(A,{align:"right"},{default:i(()=>[j(a(r,{flat:"",label:"OK",color:"primary"},null,512),[[we]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n.value._status==1?(v(),p(be,{key:0,reveal:"",elevated:"",bordered:""},{default:i(()=>[a(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",ct,[o("div",null,[a(r,{icon:"upload",flat:"",onClick:ee})]),a(_,{spaced:"",inset:"",vertical:"",dark:""}),a(V,{class:"col"},{default:i(()=>[a(Ce,{checkState:!1,onInput:J,with_prices_Invoice:"",with_stock_cedis:n.value.to.id,onAgregar:W,with_locations:""},null,8,["with_stock_cedis"])]),_:1}),a(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[n.value.products.length>0?(v(),p(r,{key:0,flat:"",icon:"send",onClick:le})):m("",!0)])]),a(_,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})):m("",!0),o("input",{type:"file",ref_key:"inputFile",ref:R,id:"inputFile",onInput:te,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1})):m("",!0)}};export{Yt as default};
