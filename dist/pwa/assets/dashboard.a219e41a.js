import{Q as Ye}from"./QDate.5553a15a.js";import{l as He,m as Ge,a as A,Q as G}from"./axios.1d2a3cc9.js";import{i as ve,aR as je,aS as Ae,j as X,c as q,T as Xe,q as Ee,F as Je,r as b,m as Ke,t as We,aY as Ze,X as de,ac as et,b8 as tt,aL as at,aH as $e,aw as lt,o as p,g as S,e,w as t,f as r,a0 as g,a1 as te,h as N,d as P,Q,a3 as B,a2 as K,ak as k,E as se,a4 as Z,am as ot,al as Ce,a as Me,u as Ie,an as st,aA as it,n as nt}from"./index.feef3106.js";import{Q as ee}from"./QCardActions.045c537b.js";import{h as rt,k as dt,b as T,a as ce,d as ae,e as V,Q as J}from"./QList.5ed1187d.js";import{d as le}from"./dayjs.min.cbcf888d.js";import{u as ge}from"./Restock.ef4a5103.js";import{u as be}from"./use-quasar.4f341261.js";import{$sktRestock as Se}from"./socket.76679f69.js";import{Q as pe}from"./QInput.b2401844.js";import{Q as ie,a as De}from"./QTable.7fd4f0eb.js";import{Q as _e,a as ke}from"./QTr.73be14c8.js";import{b as ut,d as xe,a as L}from"./QSelect.a67fe8ff.js";import{Q as ct}from"./QPage.f23e64d5.js";import{R as O}from"./RestockApi.a0223213.js";import{Q as mt,a as he,b as pt,c as we}from"./QTabPanels.1d846669.js";import{Q as ft}from"./QToggle.e68213df.js";import{Q as vt}from"./QBadge.e9842776.js";import{C as me}from"./ClosePopup.fa33c540.js";import{I as Qe}from"./invoices.23b75a88.js";import"./browser.eff7c919.js";import{_ as Pe}from"./PrinterSelect.315ba7ae.js";import"./use-render-cache.3aae9b27.js";import"./date.45c7c63b.js";import"./_commonjsHelpers.88e99c8f.js";import"./QToolbar.dedf0a07.js";import"./QForm.fab47533.js";import"./QRadio.612adf49.js";import"./QCheckbox.fe9c7f0a.js";import"./QPopupEdit.ddf6cff6.js";import"./QLayout.20a3da63.js";import"./QScrollObserver.bfbd95ad.js";import"./QResizeObserver.2071d044.js";import"./QDrawer.15a02bcb.js";import"./jspdf.plugin.autotable.ea593f83.js";import"./exceljs.min.9e24d01d.js";/* empty css                                                       */import"./QLinearProgress.f4190393.js";import"./QBtnGroup.221ba6a7.js";const gt='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var bt=ve({name:"QSpinnerGrid",props:je,setup(s){const{cSize:y,classes:u}=Ae(s);return()=>X("svg",{class:u.value,fill:"currentColor",width:y.value,height:y.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:gt})}}),yt=ve({name:"QInnerLoading",props:{...He,...rt,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(s,{slots:y}){const u=Ee(),f=Ge(s,u.proxy.$q),{transitionProps:_,transitionStyle:w}=dt(s),v=q(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(f.value===!0?" q-inner-loading--dark":"")),i=q(()=>"q-inner-loading__label"+(s.labelClass!==void 0?` ${s.labelClass}`:""));function C(){const c=[X(Je,{size:s.size,color:s.color})];return s.label!==void 0&&c.push(X("div",{class:i.value,style:s.labelStyle},[s.label])),c}function x(){return s.showing===!0?X("div",{class:v.value,style:w.value},y.default!==void 0?y.default():C()):null}return()=>X(Xe,_.value,x)}});const _t='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var kt=ve({name:"QSpinnerDots",props:je,setup(s){const{cSize:y,classes:u}=Ae(s);return()=>X("svg",{class:u.value,fill:"currentColor",width:y.value,height:y.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:_t})}});const Ve=XMLHttpRequest,Ne=Ve.prototype.open,xt=["top","right","bottom","left"];let fe=[],oe=0;function ht({p:s,pos:y,active:u,horiz:f,reverse:_,dir:w}){let v=1,i=1;return f===!0?(_===!0&&(v=-1),y==="bottom"&&(i=-1),{transform:`translate3d(${v*(s-100)}%,${u?0:i*-200}%,0)`}):(_===!0&&(i=-1),y==="right"&&(v=-1),{transform:`translate3d(${u?0:w*v*-200}%,${i*(s-100)}%,0)`})}function wt(s,y){return typeof y!="number"&&(s<25?y=Math.random()*3+3:s<65?y=Math.random()*3:s<85?y=Math.random()*2:s<99?y=.6:y=0),ut(s+y,0,100)}function Ct(s){oe++,fe.push(s),!(oe>1)&&(Ve.prototype.open=function(y,u){const f=[],_=()=>{fe.forEach(v=>{(v.hijackFilter.value===null||v.hijackFilter.value(u)===!0)&&(v.start(),f.push(v.stop))})},w=()=>{f.forEach(v=>{v()})};this.addEventListener("loadstart",_,{once:!0}),this.addEventListener("loadend",w,{once:!0}),Ne.apply(this,arguments)})}function St(s){fe=fe.filter(y=>y.start!==s),oe=Math.max(0,oe-1),oe===0&&(Ve.prototype.open=Ne)}var $t=ve({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:s=>xt.includes(s)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(s,{emit:y}){const{proxy:u}=Ee(),f=b(0),_=b(!1),w=b(!0);let v=0,i=null,C;const x=q(()=>`q-loading-bar q-loading-bar--${s.position}`+(s.color!==void 0?` bg-${s.color}`:"")+(w.value===!0?"":" no-transition")),c=q(()=>s.position==="top"||s.position==="bottom"),U=q(()=>c.value===!0?"height":"width"),F=q(()=>{const D=_.value,I=ht({p:f.value,pos:s.position,active:D,horiz:c.value,reverse:u.$q.lang.rtl===!0&&["top","bottom"].includes(s.position)?s.reverse===!1:s.reverse,dir:u.$q.lang.rtl===!0?-1:1});return I[U.value]=s.size,I.opacity=D?1:0,I}),Y=q(()=>_.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":f.value}:{"aria-hidden":"true"});function M(D=300){const I=C;return C=Math.max(0,D)||0,v++,v>1?(I===0&&D>0?E():i!==null&&I>0&&D<=0&&(clearTimeout(i),i=null),v):(i!==null&&clearTimeout(i),y("start"),f.value=0,i=setTimeout(()=>{i=null,w.value=!0,D>0&&E()},_._value===!0?500:1),_._value!==!0&&(_.value=!0,w.value=!1),v)}function h(D){return v>0&&(f.value=wt(f.value,D)),v}function j(){if(v=Math.max(0,v-1),v>0)return v;i!==null&&(clearTimeout(i),i=null),y("stop");const D=()=>{w.value=!0,f.value=100,i=setTimeout(()=>{i=null,_.value=!1},1e3)};return f.value===0?i=setTimeout(D,1):D(),v}function E(){f.value<100&&(i=setTimeout(()=>{i=null,h(),E()},C))}let z;return Ke(()=>{s.skipHijack!==!0&&(z=!0,Ct({start:M,stop:j,hijackFilter:q(()=>s.hijackFilter||null)}))}),We(()=>{i!==null&&clearTimeout(i),z===!0&&St(M)}),Object.assign(u,{start:M,stop:j,increment:h}),()=>X("div",{class:x.value,style:F.value,...Y.value})}});const ue=b(null),qe=Ze({isActive:!1},{start:de,stop:de,increment:de,setDefaults:de,install({$q:s,parentApp:y}){if(s.loadingBar=this,this.__installed===!0){s.config.loadingBar!==void 0&&this.setDefaults(s.config.loadingBar);return}const u=b(s.config.loadingBar!==void 0?{...s.config.loadingBar}:{});function f(){qe.isActive=!0}function _(){qe.isActive=!1}const w=et("q-loading-bar");tt({name:"LoadingBar",devtools:{hide:!0},setup:()=>()=>X($t,{...u.value,onStart:f,onStop:_,ref:ue})},y).mount(w),Object.assign(this,{start(v){ue.value.start(v)},stop(){ue.value.stop()},increment(){ue.value.increment.apply(null,arguments)},setDefaults(v){at(v)===!0&&Object.assign(u.value,v)}})}}),Vt={class:"text-h6"},Dt={class:"q-px-lg text-center"},Qt={class:"text-h6"},Pt={class:"text-right"},qt={class:"text-h6"},jt={class:"text-center col"},At={class:"text-h6"},Et={key:0,class:"text-center col"},Mt={class:"text-h6"},It={class:"col row"},Nt={key:1,class:"col"},Tt={class:"full-width row items-center"},Bt={class:"col text-dark"},Ut={class:"text-h6"},zt={class:"text-bold"},Rt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Lt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ot={class:"text-bold"},Ft={class:"text-overline text-grey-7"},Yt={key:0},Ht={key:1},Gt={key:0},Xt={key:1},Jt={class:"row"},Kt={key:0,class:"col"},Wt={class:"q-ml-sm text-bold"},Zt={class:"q-ml-sm"},ea={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(s,{emit:y}){const u=be(),f=ge();$e();const _=b([]),w=s,v=b({opts:[],val:[],filter:[]});b({opts:null,val:null,filter:null});const i=b({val:null,state:!1}),C=b(null),x=y,c=b(w.head),U=b(null),F=b(!0),Y=b([]),M=b("supliers"),h=b(null),j=b([]),E=b(!1);b({state:!1}),b({state:!1,key:null});const z=b(null),D=b(!1),I=b({state:!1}),m=b(null),d=b([]),n=b({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,o)=>a+o.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,o)=>a+o.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:l=>l.category.familia.seccion.name,align:"left"},{name:"family",label:"Familia",field:l=>l.category.familia.name,align:"left"},{name:"category",label:"Categoria",field:l=>l.category.name,align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),$=q(()=>j.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));q(()=>h.value&&(h.value.id==2||h.value.id==6)),q(()=>Y.value.find(l=>l.id==h.value.id).pivot),q(()=>z.value.map(l=>l._status).includes(6));const W=async()=>{x("loading"),console.log(c.value.id),F.value=!0;let l=await O.order(c.value.id);console.log(l),j.value=l.data.order.products,Y.value=l.data.order.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),z.value=l.data.order.partition,h.value=l.data.order.status,U.value=l.data.order,m.value=l.data.order.invoice,_.value=Object.values(l.data.ubicaciones).map(a=>({...a,partition:1})),v.value.opts=f.users,F.value=!1,x("loaded")},ne=()=>{I.value.state=!0},re=()=>{D.value=!0},ye=async()=>{u.loading.show({message:"Cambiando Estado"}),console.log("Iniciando surtido"),x("loading"),E.value=!0;let l=3,a={id:c.value.id,state:l};const o=await O.nextState(a);if(o.status==200){E.value=!1,u.notify({message:`Surtido iniciado para el pedido  ${c.value.id}`,icon:"done",position:"center",color:"teal"});let H={ubicaciones:_.value,pedido:c.value.id,status:l,_workpoint_to:c.value.to.id,_workpoint_from:c.value.from.id};console.log(H);let R=await O.createParitions(H);console.log(R),R.fail?(console.log(R),alert(`Error ${R.status}: ${R.data} 2`)):(R.forEach(Fe=>{Se.emit("partitionCreate",Fe)}),u.loading.hide(),W(),x("fresh",U.value),I.value.state=!1)}else console.log(o),alert(`Error ${o.status}: ${o.data} 1`);x("loaded")},Te=async l=>{u.loading.show({message:"..."}),console.log(l);const a=await O.printForSupply({ip:l.ip,port:l._port,order:c.value.id});console.log(a),a.status==200?(a.data?u.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):u.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),u.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Be=async l=>{u.loading.show({message:"..."}),console.log(l.ip),console.log(C.value);const a=await O.printForPartition({ip:l.ip,port:l._port,_partition:C.value,_workpoint_to:c.value._workpoint_to});console.log(a),a.status==200?(a.data?u.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):u.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),u.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ue=async()=>{console.log("Eliminando Pedido"),x("loading");let l=100,a={id:c.value.id,state:l};const o=await O.nextState(a);o.status==200?(D.value=!1,u.notify({message:`Surtido Cancelado para el pedido  ${c.value.id}`,icon:"close",position:"center",color:"negative"}),x("fresh",U.value,!0)):alert(`Error ${o.status}: ${o.data} 1`),x("loaded")},ze=l=>{console.log(l.id),C.value=l.id},Re=async l=>{console.log(l);const a=await O.partitionFresh(l.id);console.log(a),a.status==200&&(a.data.order.requisition.from._type!=1?Qe.invoiceFormat(a.data.order):Qe.transferFormat(a.data.order))},Le=l=>{console.log(l),i.value.state=!0,i.value.val=l},Oe=async()=>{u.loading.show({message:"Eliminando Particion"}),console.log(i.value.val);const l=await O.deletePartition(i.value.val);if(l.fail)console.log(l);else{console.log(l),Se.emit("partitionDelete",i.value.val);let a=z.value.findIndex(o=>o.id==i.value.val.id);z.value.splice(a,1),i.value.state=!1,i.value.val=null,u.notify({message:l.data.message,type:"negative",position:"center"}),u.loading.hide()}};return lt(()=>d.value=n.value.columns.map(l=>l.name)),W(),(l,a)=>(p(),S(B,null,[e(G,{class:"full-width"},{default:t(()=>[e(A,{class:"row justify-between"},{default:t(()=>[r("div",null,[a[7]||(a[7]=r("div",{class:"text-overline text-grey-7"},"Sucursal",-1)),r("div",Vt,g(c.value.from.alias),1)]),r("div",Dt,[a[8]||(a[8]=r("div",{class:"text-overline text-grey-7"},"Folio",-1)),r("div",Qt,g(c.value.id),1)]),r("div",Pt,[a[9]||(a[9]=r("div",{class:"text-overline text-grey-7"},"Agente",-1)),r("div",qt,g(c.value.created_by.nick),1)])]),_:1}),e(T),e(A,{class:"row justify-between"},{default:t(()=>[r("div",jt,[a[10]||(a[10]=r("div",{class:"text-overline text-grey-7"},"Fecha",-1)),r("div",At,g(te(le)(c.value.updated_at).format("YYYY-MM-DD")),1)]),c.value.notes?(p(),S("div",Et,[a[11]||(a[11]=r("div",{class:"text-overline text-grey-7 col"},"Notas",-1)),r("div",Mt,g(c.value.notes),1)])):N("",!0),r("div",It,[h.value&&h.value.id>=2?(p(),P(Q,{key:0,size:"md",class:"col",color:"primary",icon:"print",flat:"",dense:""},{default:t(()=>[e(xe,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Pe,{onSelected:Te,partition:!1})]),_:1})]),_:1})):N("",!0),e(T,{spaced:"",inset:"",vertical:"",dark:""}),h.value&&h.value.id==2?(p(),S("div",Nt,[e(Q,{size:"12px",class:"full-width",color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:ne,flat:""}),e(T,{spaced:"",inset:"",vertical:"",dark:""}),e(Q,{size:"12px",class:"full-width",color:"negative",icon:"close",dense:"",label:"Cancelar",onClick:re,flat:""})])):N("",!0)])]),_:1}),e(T),F.value?(p(),P(A,{key:0,class:"text-center"},{default:t(()=>[e(kt,{size:"50px",color:"purple"})]),_:1})):(p(),S(B,{key:1},[e(T),e(mt,{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=o=>M.value=o),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(he,{name:"log",label:"Log"}),e(he,{name:"basket",label:"Productos"}),e(he,{name:"supliers",label:"Particiones"})]),_:1},8,["modelValue"]),e(pt,{modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=o=>M.value=o),animated:""},{default:t(()=>[e(we,{name:"log"},{default:t(()=>[e(ce,null,{default:t(()=>[(p(!0),S(B,null,K(Y.value,o=>(p(),P(ae,{key:o.id},{default:t(()=>[e(V,{avatar:""},{default:t(()=>[k(g(o.id),1)]),_:2},1024),e(V,null,{default:t(()=>[k(g(o.name),1)]),_:2},1024),e(V,null,{default:t(()=>[k(g(o.pivot.details.responsable),1)]),_:2},1024),e(V,null,{default:t(()=>[k("de "+g(te(le)(o.pivot.created_at).format("h:mm a"))+" a "+g(te(le)(o.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(we,{name:"basket"},{default:t(()=>[j.value.length?(p(),P(ie,{key:0,"row-key":"id",flat:"",rows:j.value,columns:n.value.columns,pagination:n.value.pagination,filter:n.value.filter,"visible-columns":d.value},{top:t(()=>[r("div",Tt,[r("div",Bt,[r("span",Ut,[e(Q,{color:"pink-5",icon:"sync",onClick:W,round:"",dense:"",flat:""}),k(" Productos: "+g(j.value.length),1)]),a[12]||(a[12]=k(", ")),r("span",zt,"Piezas: "+g($.value),1)]),e(pe,{dense:"",modelValue:n.value.filter,"onUpdate:modelValue":a[1]||(a[1]=o=>n.value.filter=o),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"]),e(T,{spaced:"",inset:"",vertical:"",dark:""}),e(Q,{color:"secondary",icon:"fas fa-eye","no-caps":"",flat:""},{default:t(()=>[e(xe,{style:{"min-width":"200px"}},{default:t(()=>[e(ce,null,{default:t(()=>[(p(!0),S(B,null,K(n.value.columns,(o,H)=>Z((p(),P(ae,{tag:"label",key:H},{default:t(()=>[e(V,null,{default:t(()=>[e(L,null,{default:t(()=>[k(g(o.label),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[k(g(o.coldesc),1)]),_:2},1024)]),_:2},1024),e(V,{side:"",top:""},{default:t(()=>[e(ft,{color:"pink-5",modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=R=>d.value=R),val:o.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ot]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(p(),S("div",Rt,"Nada por aqui"))]),_:1}),e(we,{name:"supliers"},{default:t(()=>[e(ie,{rows:z.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(o=>[r("div",Lt,[e(G,{flat:"",bordered:""},{default:t(()=>[e(A,{class:"text-center"},{default:t(()=>[a[13]||(a[13]=k(" Particion: ")),r("span",Ot,g(o.row.id),1),a[14]||(a[14]=r("br",null,null,-1)),e(T,{spaced:"",inset:"",vertical:"",dark:""}),e(se,{name:"print",color:"pink",size:"sm",onClick:H=>ze(o.row)},{default:t(()=>[e(xe,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Pe,{onSelectedPartition:Be,partition:!0})]),_:1})]),_:2},1032,["onClick"]),a[15]||(a[15]=r("br",null,null,-1)),r("div",Ft,[e(vt,{color:"primary","text-color":"white",label:o.row.status.name},null,8,["label"])])]),_:2},1024),e(ee,{align:"right"},{default:t(()=>[e(Q,{color:"red",flat:"",icon:"delete",onClick:H=>Le(o.row),disable:o.row._status!=3},null,8,["onClick","disable"])]),_:2},1024),e(T),e(A,{class:"flex justify-between"},{default:t(()=>[c.value.from._type!=1?(p(),S("div",Yt,a[16]||(a[16]=[r("div",null,"Salida",-1),r("div",null,"Entrada",-1)]))):(p(),S("div",Ht,a[17]||(a[17]=[r("div",null,"Traspaso",-1)]))),a[18]||(a[18]=r("div",null,"Herramientas",-1))]),_:1}),e(T),e(A,{class:"flex justify-between"},{default:t(()=>[c.value.from._type!=1?(p(),S("div",Gt,[r("div",null,g(o.row.invoice),1),r("div",null,g(o.row.invoice_received),1)])):(p(),S("div",Xt,[r("div",null,g(o.row.invoice),1)])),r("div",Jt,[o.row._status>=6?(p(),S("div",Kt,[e(Q,{color:"pink",icon:"list",onClick:H=>Re(o.row),flat:""},null,8,["onClick"])])):N("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(J,{modelValue:I.value.state,"onUpdate:modelValue":a[4]||(a[4]=o=>I.value.state=o),persistent:""},{default:t(()=>[e(G,{style:{width:"400px"}},{default:t(()=>[e(A,{class:"row items-center"},{default:t(()=>[e(ce,null,{default:t(()=>[(p(!0),S(B,null,K(_.value,(o,H)=>(p(),P(ae,{key:H},{default:t(()=>[e(V,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md",caption:""},{default:t(()=>a[19]||(a[19]=[k("Ubicaciones")])),_:1}),e(L,null,{default:t(()=>[k(g(o.name),1)]),_:2},1024)]),_:2},1024),e(V,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md text-center",caption:""},{default:t(()=>a[20]||(a[20]=[k("Productos")])),_:1}),e(L,{class:"text-center"},{default:t(()=>[k(g(o.cantidad),1)]),_:2},1024)]),_:2},1024),e(V,{class:"q-mt-md"},{default:t(()=>[e(L,{class:"text-center",caption:""},{default:t(()=>a[21]||(a[21]=[k("Particiones")])),_:1}),e(L,{class:"q-mb-sm text-center"},{default:t(()=>[e(pe,{modelValue:o.partition,"onUpdate:modelValue":R=>o.partition=R,type:"number",dense:"",filled:"","input-class":"text-center",min:1,error:o.partition==0||o.partition>o.cantidad,"error-message":o.partition>o.cantidad?"No se pueden generar mas particiones que articulos":"la particiones tienen que ser minimo "},null,8,["modelValue","onUpdate:modelValue","error","error-message"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(ee,{align:"right"},{default:t(()=>[Z(e(Q,{flat:"",label:"Cancel",color:"primary"},null,512),[[me]]),e(Q,{flat:"",label:"Continuar",color:"primary",onClick:ye})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=o=>D.value=o),persistent:""},{default:t(()=>[e(G,null,{default:t(()=>[e(A,{class:"row items-center"},{default:t(()=>[e(Ce,{icon:"warning",color:"negative","text-color":"white"}),a[22]||(a[22]=r("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1)),r("div",Wt,g(c.value.id),1)]),_:1}),e(ee,{align:"center"},{default:t(()=>[Z(e(Q,{flat:"",label:"Cancel",color:"positive"},null,512),[[me]]),e(Q,{flat:"",label:"Confirmar",color:"negative",onClick:Ue})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{modelValue:i.value.state,"onUpdate:modelValue":a[6]||(a[6]=o=>i.value.state=o),persistent:""},{default:t(()=>[e(G,null,{default:t(()=>[e(A,{class:"row items-center"},{default:t(()=>[e(Ce,{icon:"warning",color:"warning","text-color":"red"}),r("span",Zt,"Estas a punto de eliminar la particion "+g(i.value.val.id),1)]),_:1}),e(A,null,{default:t(()=>a[23]||(a[23]=[k(" Estas Segur@ ?? ")])),_:1}),e(ee,{align:"right"},{default:t(()=>[Z(e(Q,{flat:"",icon:"close",color:"positive"},null,512),[[me]]),e(Q,{flat:"",icon:"delete",color:"negative",onClick:Oe})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ta={class:"text-h6"},aa={class:"row q-mt-md"},la={class:"q-ml-sm text-h6"},oa={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(s,{emit:y}){ge();const u=be(),f=b({state:!1,action:null}),_=b({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),w={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},v=y,i=s,C=b(i.rows),x=b(i.name),c=b(i.type),U=q(()=>c.value?w[c.value]:{l:"",c:""}),F=()=>{const h=w[c.value];f.value.action=h,f.value.state=!0},Y=async()=>{u.loading.show({message:"Espera..."});const h=await O.massiveAction({action:c.value});console.log(h),h.status==200?(h.data,f.value.state=!1,f.value.action=null,u.loading.hide(),u.notify({position:"center",color:"positive",icon:"done"}),v("cardResumeActived")):(console.error(h.data),alert(`Error ${h.status}: ${h.data.msg}`))},M=(h,j,E)=>{console.log(h),console.log(j),console.log(E),console.log(c.value)};return(h,j)=>(p(),S(B,null,[e(ie,{"row-key":"ID",rows:C.value,columns:_.value.columns,filter:_.value.filter,onRowClick:M},{top:t(()=>[r("div",ta,g(x.value),1),r("div",aa,[e(Q,{color:U.value.c,icon:"warning",label:U.value.l,onClick:F},null,8,["color","label"]),e(pe,{modelValue:_.value.filter,"onUpdate:modelValue":j[0]||(j[0]=E=>_.value.filter=E),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(J,{modelValue:f.value.state,"onUpdate:modelValue":j[1]||(j[1]=E=>f.value.state=E),persistent:""},{default:t(()=>[e(G,null,{default:t(()=>[e(A,{class:"row items-center"},{default:t(()=>[e(Ce,{icon:"warning",color:f.value.action.c,"text-color":"white"},null,8,["color"]),r("span",la,g(f.value.action.l),1)]),_:1}),e(A,null,{default:t(()=>[k(g(f.value.action.desc),1)]),_:1}),e(ee,{align:"right"},{default:t(()=>[Z(e(Q,{flat:"",label:"cancelar",color:"primary"},null,512),[[me]]),e(Q,{flat:"",label:"continuar",color:"primary",onClick:Y})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},sa={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},ia={class:"text-h6"},na={class:"row q-mb-md items-start justify-around"},ra={class:"text-left"},da={class:"text-h5"},ua={class:"text--2"},ca={class:"full-width row items-center"},ma={class:"col text-h6 text-dark"},pa={__name:"AdminDashboard",props:{dash:{type:Object,default:{}}},emits:["reloadDashboard","freshOrder"],setup(s,{emit:y}){$e(),Me();const u=Ie(),f=ge(),_=be(),w=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],v=y,i=b({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:m=>m.log.length==1?m.log[0].name:m.log[m.log.length-1].name,align:"left",sortable:!0,sort:(m,d,n,$)=>parseInt(n._status)-parseInt($._status),classes:m=>w[m._status?parseInt(m._status)-1:parseInt(m.status.id)-1]},{name:"suplier",label:"Surtidores",field:m=>{var d;return(d=m.partition)==null?void 0:d.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:m=>le(m.log.find(d=>d.id==m.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:m=>m.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:m=>m.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:m=>m.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:m=>m.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),C=b(!1),x=b({state:!1,title:"",data:null,name:null,type:null}),c=b({state:!1,head:null,block:!0}),U=q(()=>f.ordersSize),F=q(()=>f.ordersok.filter(m=>m._status!=100&&m._workpoint_to==u.session.store.id_viz)),Y=q(()=>f.ordersok.filter(m=>m._status==100)),M=q(()=>f.orderserrors),h=q(()=>f.resume),j=async m=>{console.log(m.row),c.value.head=m.row,c.value.state=!0},E=async m=>{_.loading.show({message:"cargando..."+m});const d=await O.report(m);console.log(d.data),x.value.data=d.data.rows,x.value.name=d.data.name,x.value.type=m,x.value.state=!0,_.loading.hide()},z=()=>{x.value.state=!1,x.state=!1,v("reloadDashboard")},D=(m,d=!1)=>{console.log(m),d&&(c.value.state=!1),v("freshOrder",m)},I=()=>{C.value=!0};return(m,d)=>(p(),P(ct,{padding:"",class:"bg-grey-2"},{default:t(()=>[M.value.length?(p(),S("div",sa,[d[6]||(d[6]=r("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1)),r("div",ia,g(M.value.map(n=>n.id).join("id")),1),d[7]||(d[7]=r("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1))])):N("",!0),r("div",na,[(p(!0),S(B,null,K(h.value,n=>(p(),P(Q,{stack:"","no-caps":"",class:"q-py-md",key:n.key,onClick:$=>E(n.key),color:n.total==0?"teal-10":"pink-13",disabled:n.total==0},{default:t(()=>[r("div",ra,[r("div",da,g(n.total),1),r("div",ua,g(n.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ie,{flat:"",bordered:"","row-key":"id",rows:F.value,columns:i.value.columns,filter:i.value.filter,pagination:i.value.pagination},{top:t(()=>[r("div",ca,[r("div",ma,"Pedidos: "+g(U.value),1),e(pe,{dense:"",modelValue:i.value.filter,"onUpdate:modelValue":d[0]||(d[0]=n=>i.value.filter=n),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"]),e(T,{spaced:"",inset:"",vertical:"",dark:""}),r("div",null,[e(se,{name:"archive",size:"md",color:"negative",onClick:I})])])]),header:t(n=>[e(_e,{props:n},{default:t(()=>[e(De,{"auto-width":""}),(p(!0),S(B,null,K(n.cols,$=>(p(),P(De,{key:$.name,props:n},{default:t(()=>[k(g($.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(n=>[e(_e,{props:n},{default:t(()=>[e(ke,{"auto-width":""},{default:t(()=>[n.row?(p(),P(Q,{key:0,size:"sm",dense:"",round:"",flat:"",onClick:$=>n.expand=!n.expand,icon:n.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])):N("",!0)]),_:2},1024),(p(!0),S(B,null,K(n.cols,$=>(p(),P(ke,{key:$.name,props:n,onClick:W=>j(n)},{default:t(()=>[k(g($.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(_e,{props:n},{default:t(()=>[e(ke,{colspan:"100%"},{default:t(()=>[e(ce,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ae,null,{default:t(()=>[e(V,null,{default:t(()=>d[8]||(d[8]=[k("ID")])),_:1}),e(V,null,{default:t(()=>d[9]||(d[9]=[k("ESTADO")])),_:1}),e(V,null,{default:t(()=>d[10]||(d[10]=[k("Utima Actividad")])),_:1}),n.row.from._type==2?(p(),P(V,{key:0},{default:t(()=>d[11]||(d[11]=[k("SALIDA")])),_:1})):N("",!0),n.row.from._type==2?(p(),P(V,{key:1},{default:t(()=>d[12]||(d[12]=[k("ENTRADA")])),_:1})):N("",!0),n.row.from._type==1?(p(),P(V,{key:2},{default:t(()=>d[13]||(d[13]=[k("TRASPASO")])),_:1})):N("",!0)]),_:2},1024),(p(!0),S(B,null,K(n.row.partition,($,W)=>(p(),S("div",{key:W},[e(ae,null,{default:t(()=>[e(V,null,{default:t(()=>[e(L,{overline:""},{default:t(()=>[k(g($._suplier),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[k(g($.id),1)]),_:2},1024)]),_:2},1024),e(V,{class:st(`${w[$.status.id-1]}`)},{default:t(()=>[k(g($.status.name),1)]),_:2},1032,["class"]),e(V,null,{default:t(()=>{var ne,re;return[k(g(te(le)((re=(ne=$.log)==null?void 0:ne.find(ye=>ye.id==$._status))==null?void 0:re.pivot.updated_at).format("YYYY-MM-DD HH:mm:ss")),1)]}),_:2},1024),n.row.from._type==2?(p(),P(V,{key:0},{default:t(()=>[k(g($.invoice),1)]),_:2},1024)):N("",!0),n.row.from._type==2?(p(),P(V,{key:1},{default:t(()=>[k(g($.invoice_received),1)]),_:2},1024)):N("",!0),n.row.from._type==1?(p(),P(V,{key:2},{default:t(()=>[k(g($.invoice),1)]),_:2},1024)):N("",!0)]),_:2},1024),e(T,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[it,n.expand]])]),_:1},8,["rows","columns","filter","pagination"]),e(J,{"full-width":"",modelValue:c.value.state,"onUpdate:modelValue":d[3]||(d[3]=n=>c.value.state=n),persistent:c.value.block,"no-esc-dismiss":c.value.block,"no-backdrop-dismiss":c.value.block},{default:t(()=>[e(ea,{head:c.value.head,onLoaded:d[1]||(d[1]=n=>c.value.block=!1),onLoading:d[2]||(d[2]=n=>c.value.block=!0),onFresh:D,onChofiAssigned:D},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(J,{modelValue:x.value.state,"onUpdate:modelValue":d[4]||(d[4]=n=>x.value.state=n)},{default:t(()=>[e(oa,{rows:x.value.data,name:x.value.name,type:x.value.type,onCardResumeActived:z},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(J,{modelValue:C.value,"onUpdate:modelValue":d[5]||(d[5]=n=>C.value=n),"full-width":""},{default:t(()=>[e(G,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(A,{class:"q-pt-none"},{default:t(()=>[e(ie,{flat:"",bordered:"","row-key":"id",rows:Y.value,columns:i.value.columns,pagination:i.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const fa={class:"q-pa-md"},va={class:"q-pb-sm"},ga={key:0},al={__name:"dashboard",setup(s){const y=$e();Me();const u=ge();be(),Ie();const f=b({val:null}),_=b(!1),w=async()=>{u.setTitle("Dashboard"),u.setButtonShow(!0)},v=i=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",i.id),Se.emit("order_refresh",{order:i})};return nt(()=>y.query,()=>{w()}),w(),(i,C)=>(p(),S(B,null,[e(J,{modelValue:_.value,"onUpdate:modelValue":C[2]||(C[2]=x=>_.value=x)},{default:t(()=>[e(G,{class:"my-card"},{default:t(()=>[e(A,null,{default:t(()=>[r("div",fa,[r("div",va,g(f.value.val),1),e(Ye,{modelValue:f.value.val,"onUpdate:modelValue":C[0]||(C[0]=x=>f.value.val=x),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(A,null,{default:t(()=>[e(ee,{align:"right"},{default:t(()=>[e(Q,{flat:"",icon:"close",color:"negative",onClick:C[1]||(C[1]=x=>_.value=!_.value)}),e(Q,{flat:"",icon:"check",color:"positive",onClick:i.buscas},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),te(u).showLoad?(p(),S("div",ga,[e(yt,{showing:te(u).showLoad},{default:t(()=>[e(bt,{size:"5.5em",color:"primary"}),C[3]||(C[3]=k(" Obteniendo Datos... "))]),_:1},8,["showing"])])):(p(),P(pa,{key:1,onReload:w,onFreshOrder:v}))],64))}};export{al as default};
