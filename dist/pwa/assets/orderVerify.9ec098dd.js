import{u as ae,f as le,Z as oe,r as f,g as se,o as ie,y as ne,a as k,h as P,i as s,p as h,d as a,l as m,k as i,a1 as x,n as v,a7 as de,a4 as g,Q as w,a6 as V,m as T,a5 as Q,aX as B,j as U}from"./index.0d286209.js";import{Q as q}from"./QTable.6a34fccc.js";import{Q as E}from"./QForm.bf2df794.js";import{Q as re}from"./QFooter.b00707b5.js";import{Q as ue}from"./QPage.c6de2f38.js";import{C as N}from"./ClosePopup.b1db4109.js";import"./axios.641704b8.js";import{u as ce}from"./use-quasar.99736a50.js";import{P as ve}from"./ProductsAutocomplete.c0f43f3c.js";import{_ as pe}from"./productView.1c871639.js";import{d as fe}from"./dayjs.min.cbcf888d.js";import{R as j}from"./resoursesOrder.2bbf7fa9.js";import{o as y}from"./orderApi.d5aed5cf.js";import"./QList.c6b82b90.js";import"./QSelect.75fb6875.js";import"./QLinearProgress.325ed038.js";import"./QResizeObserver.b173e2da.js";/* empty css                                                                         */import"./QSpace.f0ea4fd4.js";import"./_commonjsHelpers.88e99c8f.js";const me={class:"col"},ge={class:"text-center text-h6"},ye={class:"col"},be={class:"col"},xe={class:"text-center text-h6"},we={class:"col"},Ce={class:"text-center text-h6"},_e={class:"col"},Ve={class:"text-center text-h6"},De={class:"col"},ke={class:"text-center text-h6"},ze={__name:"orderVerify",setup(Pe){const $=ae(),u=ce(),S=le(),F=oe(),l=f(null),c=f({state:!1,val:null}),C=f(!1),r=f({state:!1,val:null,opts:[]}),n=f({state:!1,val:null,edit:!1}),A=f({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),_=f([]),I=f({columns:[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},{name:"amount",label:"Pedido",field:t=>t.pivot.units,align:"center"},{name:"verify",label:"Verificado",field:t=>t.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:t=>t.pivot.price,align:"center"},{name:"total",label:"Total",field:t=>t.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),O=f({columns:[{name:"id",label:"Codigo",field:t=>t.id,align:"left"},{name:"Nombre",label:"Descripcion",field:t=>t.name,align:"left"},{name:"Telefono",label:"Pedido",field:t=>t.celphone,align:"center"}],pagination:{rowsPerPage:0}}),L=se(()=>l.value.products.every(t=>t.pivot.amountDelivered||t.pivot.amountDelivered>0)),Y=async()=>{let t=F.params.ord;const e=await y.getOrderVerify(t);e.fail?e.fail.status==401?(u.notify({message:e.fail.response.data,position:"center",type:"negative"}),S.push("/verifyOrder")):console.log(e):(console.log(e),l.value=e.order,_.value=e.rules)},K=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0?(n.value.val=l.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=A.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},M=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0?(n.value.val=l.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=A.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},z=(t,e)=>{console.log(e),n.value.val=e,n.value.edit=!0,n.value.state=!0},D=()=>{n.value={state:!1,val:null,edit:!1}},X=t=>{l.value.products.push(t),D()},Z=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0&&(l.value.products.splice(e,1),D())},G=async()=>{if(r.value.val){const t=await y.getClient(r.value);t.fail?console.log(t):t.length>0?(console.log(t),r.value.opts=t):u.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else u.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},H=async(t,e)=>{u.loading.show({message:"Recalculando Ticket"});let o={order:l.value.id,client:e.id};const d=await y.changeClientOrder(o);d.fail?console.log(d):(l.value.client=e,j.actualizarPreciosProductos(l.value.products,l.value,_.value),r.value={state:!1,val:null,opts:[]},u.loading.hide())},J=()=>{console.log("cambio de cliente"),r.value.state=!0},R=t=>{t.ctrlKey&&t.key.toLowerCase()==="b"?(t.preventDefault(),r.value.state||(r.value.state=!0)):t.ctrlKey&&t.key.toLowerCase()==="p"&&(t.preventDefault(),c.value.state||(c.value.state=!0))},W=async()=>{u.loading.show({message:"Terminando Verificacion"});let t={uid:$.session.credentials.staff.id_va,oid:l.value.id};const e=await y.nextState(t);e.fail?console.log(e):(console.log(e),u.notify({message:"El pedido ya esta en Caja",position:"center",type:"positive",icon:"check"}),u.loading.hide(),S.push("/verifyOrder"))},ee=async()=>{if(c.value.val){let t={uid:$.session.credentials.staff.id_va,oid:l.value.id};const e=await y.getOrderAdd(c.value.val,t);console.log(e),e.fail?e.fail.status==401?u.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):e.fail.status==404?u.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):console.log(e):e?(console.log(e),te(l.value.products,e.products).then(o=>l.value.products=o),j.actualizarPreciosProductos(l.value.products,l.value,_.value),c.value={state:!1,val:null}):u.notify({message:"No hay ningun pedido con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"})}else u.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},te=async(t,e)=>{const o=[...t];for(const d of e){const b=o.find(p=>p.id===d.id);if(b){b.pivot.units+=d.pivot.units,b.pivot.toDelivered=0,b.pivot.amountDelivered=0;const p=await y.editProduct(b.pivot);console.log(b),p.fail?console.log("Edit failed:",p):console.log("Edited:",p)}else{d.pivot._order=l.value.id,d.pivot.toDelivered=0,d.pivot.amountDelivered=0;const p=await y.addProduct(d.pivot);p.fail?console.log("Add failed:",p):(console.log("Added:",p),o.push(d))}}return o};return ie(()=>{Y(),window.addEventListener("keydown",R)}),ne(()=>{window.removeEventListener("keydown",R)}),(t,e)=>l.value?(k(),P(ue,{key:0,padding:""},{default:s(()=>[a(w,{class:"my-card"},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[i("div",me,[e[8]||(e[8]=i("div",{class:"text-caption text-center"},"Dependiente",-1)),i("div",ge,x(`${l.value.created_by.names} ${l.value.created_by.surname_pat}
            ${l.value.created_by.surname_mat}`),1)]),i("div",ye,[e[9]||(e[9]=i("div",{class:"text-caption text-center"},"Cliente",-1)),a(v,{class:"full-width",flat:"",label:l.value.client.name,onClick:J},null,8,["label"])]),i("div",be,[e[10]||(e[10]=i("div",{class:"text-caption text-center"},"Fecha",-1)),i("div",xe,x(de(fe)(l.value.created_at).format("YYYY-MM-DD")),1)]),a(v,{color:"primary",flat:""}),a(g,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(w,{class:"my-card"},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[i("div",we,[e[11]||(e[11]=i("div",{class:"text-caption text-center"},"Orden",-1)),i("div",Ce,x(l.value.id),1)]),i("div",_e,[e[12]||(e[12]=i("div",{class:"text-caption text-center"},"Total",-1)),i("div",Ve,"$ "+x(Number(l.value.products.reduce((o,d)=>o+d.pivot.total,0)).toFixed(2)),1)]),i("div",De,[e[13]||(e[13]=i("div",{class:"text-caption text-center"},"Cantidad",-1)),i("div",ke,x(l.value.products.reduce((o,d)=>o+Number(d.pivot.toDelivered),0)),1)]),a(v,{color:"primary",flat:"",icon:"add",onClick:e[0]||(e[0]=o=>c.value.state=!c.value.state)}),a(g,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(q,{rows:l.value.products,columns:I.value.columns,"hide-bottom":"",pagination:I.value.pagination,onRowClick:z},null,8,["rows","columns","pagination"]),a(V,{modelValue:n.value.state,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.state=o),persistent:"",position:"bottom"},{default:s(()=>[a(pe,{product:n.value.val,order:l.value,edit:n.value.edit,onReset:D,products:l.value.products,rules:_.value,onAddProduct:X,onDeleteProduct:Z},null,8,["product","order","edit","products","rules"])]),_:1},8,["modelValue"]),a(V,{modelValue:r.value.state,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.state=o),persistent:""},{default:s(()=>[a(w,{style:{width:"700px"}},{default:s(()=>[a(E,{onSubmit:G},{default:s(()=>[e[14]||(e[14]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),e[15]||(e[15]=i("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),a(m,null,{default:s(()=>[a(g,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[a(T,{autofocus:"",modelValue:r.value.val,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.val=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),r.value.opts.length>0?(k(),P(m,{key:0},{default:s(()=>[a(q,{rows:r.value.opts,columns:O.value.columns,pagination:O.value.pagination,onRowClick:H},null,8,["rows","columns","pagination"])]),_:1})):h("",!0),a(Q,{align:"right"},{default:s(()=>[B(a(v,{flat:"",label:"Cancelar",color:"primary"},null,512),[[N]]),a(v,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=o=>C.value=o),persistent:""},{default:s(()=>[a(w,null,{default:s(()=>[a(m,{class:"text-center text-bold text-h6"},{default:s(()=>[U(" Orden "+x(l.value.id),1)]),_:1}),a(m,null,{default:s(()=>e[16]||(e[16]=[U(" El pedido se ira directo a caja, "),i("span",{class:"text-bold"}," Deseas Continuar?",-1)])),_:1}),a(Q,{align:"right"},{default:s(()=>[B(a(v,{flat:"",icon:"close",color:"negative"},null,512),[[N]]),a(v,{flat:"",icon:"send",color:"positive",onClick:W})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:c.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>c.value.state=o),persistent:""},{default:s(()=>[a(w,{style:{width:"300px"}},{default:s(()=>[a(E,{onSubmit:ee},{default:s(()=>[e[17]||(e[17]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Comanda",-1)),e[18]||(e[18]=i("div",{class:"text-center text-bold text-caption"},"Busca ID de commanda",-1)),a(m,null,{default:s(()=>[a(g,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[a(T,{autofocus:"",modelValue:c.value.val,"onUpdate:modelValue":e[5]||(e[5]=o=>c.value.val=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),a(Q,{align:"right"},{default:s(()=>[B(a(v,{flat:"",label:"Cancel",color:"primary"},null,512),[[N]]),a(v,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(re,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:s(()=>[a(w,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[a(ve,{class:"col",checkState:!1,onInput:M,onAgregar:K}),L.value?(k(),P(v,{key:0,color:"primary",flat:"",icon:"east",onClick:e[7]||(e[7]=o=>C.value=!C.value),round:""})):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0)}};export{ze as default};
