import{Q as re}from"./QToolbarTitle.29d170db.js";import{Q as de}from"./QToolbar.b4409ba4.js";import{Q as N,c as A,a as ue,b as L}from"./QSeparator.cc594f43.js";import{u as ce,aH as pe,a as ve,r as f,c as b,o as c,d as k,w as s,f as o,e as l,a6 as v,a0 as n,a1 as me,g as w,h as x,S as M,Q,a4 as K,a3 as H,aI as fe,a7 as be,a5 as G,b1 as ge,a8 as ye,n as _e}from"./index.a996e2bc.js";import{Q as I}from"./QInput.b8856860.js";import{d as xe,a as O}from"./QSelect.a465bb99.js";import{Q as he}from"./QToggle.107bf8dd.js";import{Q as ke}from"./QList.425ee15a.js";import{Q as we}from"./QTable.241b3670.js";import{Q as Y,a as V}from"./QCard.9a36efc8.js";import{Q as Qe}from"./QForm.5fd700d5.js";import{Q as Ce}from"./QCardActions.25ca6b75.js";import{Q as J}from"./QFooter.1c9b6500.js";import{Q as Se}from"./QPage.6de0c99c.js";import{C as $e}from"./ClosePopup.4a561a41.js";import{u as Ve}from"./axios.13708793.js";import{R as g}from"./RestockApi.622b75bb.js";import{i as W}from"./invoicesApi.530e2f9e.js";import{$sktRestock as C}from"./socket.3fae67a0.js";import{u as qe}from"./Restock.69a5bf6b.js";import"./QCheckbox.27d249eb.js";import"./QLinearProgress.80ba80eb.js";import"./QResizeObserver.08146584.js";const De={class:"bg-cyan-10 text-white"},Ee={key:0,class:"text--3"},Re={class:"text-bold text-h6"},Pe={key:0,class:"text-white"},je={class:"text-bold"},Ie={class:"q-px-md q-py-sm"},Te={class:"col text-white row justify-between"},ze={key:0,class:"row items-center justify-between q-pt-sm"},Ue={class:"full-width row items-center justify-between"},Fe={class:"row justify-between"},Be={class:"text-left"},Ne={class:"text--3"},Ae={class:"text-h6"},Le={class:"text-right"},Me={class:"text-bold"},Ke={class:"text--2"},He={class:"text-h6"},Ge={class:"text--2"},Oe={class:"row items-start justify-between"},Ye={class:"text-center col text-primary"},Je={class:"text-bold"},We={class:"text-center col text-orange-10"},Xe={class:"text-bold"},Ze={class:"text-center col"},et={class:"text-bold"},tt={class:"text-center col"},at={class:"text-center col"},ot={class:"text-bold"},it={class:"q-ml-md"},lt={class:"text-bold text-center text-h6"},st={class:"q-pa-md text-bold text-uppercase text-center"},Et={__name:"viewCheckin",setup(nt){const X=ce(),d=Ve(),E=qe(),S=pe(),T=ve(),r=f(null),q=f({state:!1}),y=f(""),z=f(null),R=f(null),P=f(["code","request","ipack","uspply","delivery","checkout","received","reqinpzs"]),h=f({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:t=>t.variants.length?t.variants.map(e=>e.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"ipack",label:"PxC",field:t=>typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:t=>t.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:t=>t.pivot._supply_by==3?"Cajas":t.pivot._supply_by==2?"Docenas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida",field:t=>t.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:t=>t.pivot._supply_by==3?(typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces)*(typeof t.pivot.ipack=="number"?t.pivot.toDelivered:t.pivot.amount):typeof t.pivot.ipack=="number"?t.pivot.toDelivered:t.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:t=>t.pivot.checkout?"OK":null,classes:t=>t.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador",sortable:!0},{name:"received",label:"Conteo",field:t=>t.pivot.toReceived,align:"center",coldesc:"Embalaje recepcion"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),i=f({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),m=b(()=>r.value?r.value.products.filter(t=>t.pivot.checkout==1):[]),_=b(()=>r.value?r.value.status:null),U=b(()=>_.value?_.value.id==9:!1),Z=b(()=>m.value.filter(t=>typeof t.pivot.toReceived!="number")),F=b(()=>m.value.filter(t=>typeof t.pivot.toReceived=="number")),$=b(()=>{let t=y.value.toUpperCase().trim();return t.length?m.value.filter(e=>e.code.match(t)||e.barcode&&e.barcode.match(t)):m.value}),ee=b(()=>$.value.reduce((t,e)=>t+(e.pivot._supply_by==3?e.pivot.amount*e.pieces:e.pivot.amount),0)),j=b(()=>m.value.reduce((t,e)=>t+Number(e.pivot.toReceived!==e.pivot.toDelivered),0)),te=async()=>{E.setShowLYT(!1);const t=await g.partitionFresh(S.params.chk);if(console.log(t.data.order),t.status==200)if(t.data.order._status==9)r.value=t.data.order;else if(t.data.order._status>9)r.value=t.data.order;else{let e={partition:S.params.chk,verified:X.session.credentials.staff.id,state:9,key:S.query.key},a=await g.saveCheck(e);if(a.status==200){let u=E.partitions.findIndex(p=>p.id==a.data.partition.id);if(u>=0){if(E.partitions.splice(u,1,a.data.partition),a.data.partitionsEnd>a.data.partition.requisition._status){let p={id:a.data.partition._requisition,state:a.data.partitionsEnd};const D=await g.nextState(p);C.emit("order_refresh",{order:D.data}),console.log(D.data)}C.emit("orderpartition_refresh",{order:a.data.partition})}r.value=a.partition,d.loading.hide()}else a.status==401?(alert(a.response.data.message),console.log(a.response.data.message),d.loading.hide()):alert(`Error ${a.status}: ${a.response.data} `)}else alert(`Error ${t.status}: ${t.response.data} `)},B=t=>{console.log(t),i.value.item=t,i.value.form.count=typeof t.pivot.toReceived=="number"?t.pivot.toReceived:0,i.value.form.ipack=typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces,i.value.state=!0,_e(()=>{R.value.focus(),R.value.select()})},ae=()=>{let t=y.value.toUpperCase().trim();if(t.length){let e=$.value.length==1?$.value[0]:$.value.find(a=>a.code==t||a.barcode==t);e?B(e):d.notify({message:`Sin coincidencias para <b>${t}</b>`,color:"pink-5",position:"center",html:!0})}},oe=async()=>{const t=parseInt(i.value.form.count),e=parseInt(i.value.form.ipack),a={order:i.value.item.pivot._partition,product:i.value.item.id,received:t,ipack:e,checkout:!1};console.log(a);const u=await g.setReceiveProduct(a);if(console.log(u),u.status==200){let p=m.value.findIndex(D=>D.id==i.value.item.id);m.value[p].pivot.toReceived=t,m.value[p].pivot.ipack=e,i.value.state=!1,y.value="",d.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${u.status}: ${u.data}`)},ie=async()=>{d.loading.show({message:"Terminando, espera..."}),console.log(r.value.requisition._workpoint_from),q.value.state=!1;let t={id:S.params.chk,state:10,suply:r.value._suplier_id};console.log(t),console.log("... por acasito");let e=await g.nextStatePartition(t);if(console.log(e),e.status==200){if(e.data.partitionsEnd>r.value.requisition._status){let u={id:e.data.partition._requisition,state:e.data.partitionsEnd};const p=await g.nextState(u);C.emit("order_refresh",{order:p.data}),console.log(p.data)}r.value._status=e.data.partition._status,r.value.status.name=e.data.partition.status.name;const a=await g.partitionFresh(e.data.partition.id);if(a.status==200){console.log(a.data),C.emit("orderpartition_refresh",{order:a.data.order});let u=await j.value>0?g.sendMessageDiff(a.data.order):"";console.log(u),r.value.requisition.from._type!=1?le(a.data.order):se(a.data.order)}else alert(`Error ${a.status}: ${a.data}`)}else console.log(e);d.loading.hide()},le=async t=>{d.loading.show({message:"Realizando Salida"});const e=await W.addEntryFS(t);console.log(e),e.fail?e.fail.status==503?(d.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),T.push("/distribute/checkin"),d.loading.hide()):console.log(e):(d.notify({message:`Entrada Creada ${e.invoice_received}`,type:"positive",position:"bottom"}),C.emit("orderpartition_refresh",{order:e}),T.push("/distribute/checkin"),d.loading.hide())},se=async t=>{d.loading.show({message:"Realizando Salida"});const e=await W.endTransferFS(t);e.fail?e.fail.status==503?(d.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),d.loading.hide()):console.log(e):(d.notify({message:`Traspaso Creado ${e.invoice_received}`,type:"positive",position:"bottom"}),C.emit("orderpartition_refresh",{order:e}),d.loading.hide())},ne=(t,e,a)=>U.value?B(e):null;return te(),(t,e)=>(c(),k(Se,null,{default:s(()=>[o("div",De,[l(de,null,{default:s(()=>{var a;return[l(re,null,{default:s(()=>[v(" Pedido "+n(me(S).params.chk)+" ",1),r.value?(c(),w("span",Ee,"- "+n(r.value.requisition.from.alias),1)):x("",!0)]),_:1}),o("div",Re,"Diferencias : "+n(j.value),1),(a=r.value)!=null&&a.invoice_received?(c(),w("div",Pe,[o("div",null,n(r.value.requisition.from._type==1?"Traspaso":"Entrada"),1),o("div",je,n(r.value.invoice_received),1)])):x("",!0)]}),_:1}),l(N),o("div",Ie,[o("div",Te,[o("div",null,[e[9]||(e[9]=v("Productos: ")),o("b",null,n(m.value.length),1)]),o("div",null,[e[10]||(e[10]=v("Piezas: ")),o("b",null,n(ee.value),1)])]),_.value&&_.value.id>=5?(c(),w("div",ze,[o("div",null,[e[11]||(e[11]=o("span",{class:"text--2"},"Contados:",-1)),e[12]||(e[12]=v()),o("b",null,n(F.value.length),1)]),o("div",null,[e[13]||(e[13]=o("span",{class:"text--2"},"Por contar:",-1)),e[14]||(e[14]=v()),o("b",null,n(Z.value.length),1)])])):x("",!0)])]),l(we,{"row-key":"id",rows:$.value,columns:h.value.columns,pagination:h.value.pagination,filter:h.value.filter,"visible-columns":P.value,onRowClick:ne},{top:s(()=>[o("div",Ue,[l(I,{dense:"",modelValue:h.value.filter,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value.filter=a),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:s(()=>[l(M,{name:"search"})]),_:1},8,["modelValue"]),l(Q,{color:"secondary",icon:"fas fa-eye",flat:"","no-caps":""},{default:s(()=>[l(xe,{style:{"min-width":"200px"}},{default:s(()=>[l(ke,null,{default:s(()=>[(c(!0),w(H,null,K(h.value.columns,(a,u)=>G((c(),k(ue,{tag:"label",key:u},{default:s(()=>[l(L,null,{default:s(()=>[l(O,null,{default:s(()=>[v(n(a.label),1)]),_:2},1024),l(O,{caption:""},{default:s(()=>[v(n(a.coldesc),1)]),_:2},1024)]),_:2},1024),l(L,{side:"",top:""},{default:s(()=>[l(he,{color:"pink-5",modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=p=>P.value=p),val:a.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ye]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),l(A,{modelValue:i.value.state,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.state=a),position:"bottom",onHide:e[4]||(e[4]=a=>z.value.focus())},{default:s(()=>[i.value.item?(c(),k(Y,{key:0},{default:s(()=>[l(V,{class:"bg-grey-3"},{default:s(()=>[o("div",Fe,[o("div",Be,[o("div",Ne,"ID: "+n(i.value.item.id),1),o("div",Ae,n(i.value.item.code),1)]),o("div",Le,[o("div",Me,n(i.value.item.name),1),o("div",Ke,n(i.value.item.barcode),1)])])]),_:1}),l(N),l(V,null,{default:s(()=>[v(n(i.value.item.description),1)]),_:1}),l(V,{class:"row justify-around items-center bg-grey-2"},{default:s(()=>[(c(!0),w(H,null,K(i.value.item.stocks,a=>(c(),w("div",{key:a.id,class:"text-center"},[o("div",He,n(a.pivot.gen),1),o("div",Ge,n(a.alias),1)]))),128))]),_:1}),l(Qe,{onSubmit:fe(oe,["prevent"])},{default:s(()=>[l(V,null,{default:s(()=>[o("div",Oe,[o("div",Ye,[e[15]||(e[15]=o("div",null,"Solicitud",-1)),o("div",Je,n(i.value.item.pivot.amount)+" "+n(i.value.item.pivot._supply_by==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:i.value.item.pivot._supply_by==2?`Docena${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`),1)]),o("div",We,[e[16]||(e[16]=o("div",null,"Salida",-1)),v(" "+n(i.value.item.pivot.toDelivered)+" ",1),o("div",Xe,[v(n(i.value.item.pivot.toDelivered)+" "+n(i.value.item.pivot._supply_by==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:i.value.item.pivot._supply_by==2?`Docena${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`)+" ",1),o("small",null,"("+n(i.value.item.pivot._supply_by==3?i.value.item.pivot.toDelivered*i.value.item.pivot.ipack:i.value.item.pivot.toDelivered)+" pzs)",1)])]),o("div",Ze,[e[17]||(e[17]=o("div",null,"PxC",-1)),o("div",et,n(i.value.item.pivot.ipack),1)]),o("div",tt,[e[18]||(e[18]=o("div",null,"Conteo",-1)),l(I,{dense:"",borderless:"",modelValue:i.value.form.count,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.form.count=a),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:R},null,8,["modelValue"])]),o("div",at,[e[19]||(e[19]=o("div",null,"Piezas",-1)),o("div",ot,n(i.value.item.pivot._supply_by==3?i.value.form.count*i.value.form.ipack:i.value.item.pivot._supply_by==2?i.value.form.count*12:i.value.form.count),1)])])]),_:1}),l(Q,{color:"indigo",type:"submit",square:"",icon:"done","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1})]),_:1})):x("",!0)]),_:1},8,["modelValue"]),l(A,{modelValue:q.value.state,"onUpdate:modelValue":e[5]||(e[5]=a=>q.value.state=a)},{default:s(()=>[l(Y,null,{default:s(()=>[l(V,{class:"row items-start"},{default:s(()=>[l(be,{icon:"warning",color:"orange-14","text-color":"white"}),o("div",it,[e[20]||(e[20]=o("div",{class:"text-h6"},"Quieres finalizar la revision?",-1)),e[21]||(e[21]=o("div",null,"EL pedido ya no podra editarse y se emitira una entrada...",-1)),o("div",lt,"Diferencias: "+n(j.value),1)])]),_:1}),l(Ce,{align:"right"},{default:s(()=>[G(l(Q,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[$e]]),l(Q,{flat:"",label:"Si",color:"primary",onClick:ie})]),_:1})]),_:1})]),_:1},8,["modelValue"]),U.value?(c(),k(J,{key:0,bordered:"",class:"bg-indigo-10 text-dark q-pa-sm row",elevated:""},{default:s(()=>[l(I,{color:"white",modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=a=>y.value=a),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:ge(ae,["enter"]),ref_key:"iptfinder",ref:z},{prepend:s(()=>[l(M,{name:"fas fa-barcode",color:"white"})]),append:s(()=>[l(Q,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:e[6]||(e[6]=a=>y.value=""),disabled:!y.value.length},null,8,["disabled"])]),_:1},8,["modelValue"]),F.value.length>0?(c(),k(Q,{key:0,color:"white","text-color":"indigo-10",label:"Finalizar",icon:"done",onClick:e[8]||(e[8]=a=>q.value.state=!0),"no-caps":""})):x("",!0)]),_:1})):x("",!0),_.value&&_.value.id!=9?(c(),k(J,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:s(()=>[o("div",st,n(_.value.name),1)]),_:1})):x("",!0)]),_:1}))}};export{Et as default};
