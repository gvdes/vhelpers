import{Q}from"./QInput.5fe32615.js";import{Q as k}from"./QForm.f0228ea0.js";import{a as h,d as L}from"./QSelect.dc2237f6.js";import{d as V,Q as N,c as F,b as T}from"./QList.f5a23b7c.js";import{Q as U}from"./QTable.f78cdffd.js";import{Q as A}from"./QPage.3686cdc9.js";import{aH as H,a as M,u as j,r as p,c as z,o as S,g as G,e as t,w as a,a3 as O,f as d,a5 as P,d as Y,a6 as m,a0 as c,a1 as J,a7 as K,Q as f,a8 as W}from"./index.86652e3e.js";import{Q as $,a as v}from"./QCard.eaa2d4e8.js";import{Q as C}from"./QCardActions.1ecab933.js";import{C as X}from"./ClosePopup.ad776fb5.js";import"./dayjs.min.cbcf888d.js";import{R as _}from"./RestockApi.64b19cf6.js";import{u as Z}from"./Restock.acd87365.js";import{u as ee}from"./axios.2194c779.js";import{$sktRestock as q}from"./socket.3fae67a0.js";import{_ as te}from"./PrinterSelect.03b4c793.js";import"./QLinearProgress.c503a488.js";import"./QCheckbox.66f29577.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.ebc1f921.js";const ae={class:"flex justify-center"},oe={class:"text-center",style:"width: 50%;"},se={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},ie={class:"text-bold"},le={class:"q-mx-sm text-h6"},$e={__name:"checkin",setup(ne){H();const B=M(),u=Z(),l=ee(),x=j(),n=p(null),E=p({rowsPerPage:[0]}),i=p({state:!1,val:null}),r=p({state:!1,val:null,opts:["GEN","EMP"]}),w=z(()=>u.partitions.filter(s=>s._status==8&&s.requisition._workpoint_from==x.session.store.id_viz)),I=async()=>{u.setShowLYT(!0),u.setTitle("Validacion"),u.setButtonShow(!1)},R=async s=>{l.loading.show({message:"..."}),console.log(s.ip),console.log(i.value);const e=await _.printForPartition({ip:s.ip,port:s._port,_partition:i.value.val.id,_workpoint_to:i.value.val._workpoint_to});console.log(e),e.status==200?(e.data?l.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):l.notify({message:`Sin conexion a <b>${s.name} <small>(${s.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),l.loading.hide()):(console.error(e),alert(`Error ${e.status}: ${e.data}`))},b=()=>{i.value.val&&(n.value=i.value.val.id),console.log(n.value);let s=w.value.findIndex(e=>e.id==n.value);console.log(s),s>=0?r.value.state=!0:(l.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),n.value=null)},D=async()=>{l.loading.show({message:"Cambiando Estado"});let s={partition:n.value,verified:x.session.credentials.staff.id,state:9,key:r.value.val};console.log(s);let e=await _.saveCheck(s);if(console.log(e),e.status==200){let o=u.partitions.findIndex(g=>g.id==e.data.partition.id);if(o>=0){if(u.partitions.splice(o,1,e.data.partition),e.data.partitionsEnd>e.data.partition.requisition._status){let g={id:e.data.partition._requisition,state:e.data.partitionsEnd};const y=await _.nextState(g);q.emit("order_refresh",{order:y.data}),console.log(y.data)}q.emit("orderpartition_refresh",{order:e.data.partition})}n.value=null,B.push(`/distribute/checkin/${e.data.partition.id}/?key=${e.data.partition.entry_key}`),l.loading.hide()}else e.status==401?(alert(e.response.data.message),console.log(e.response.data.message),l.loading.hide()):alert(`Error ${e.status}: ${e.response.data} `)};return I(),(s,e)=>(S(),G(O,null,[t(A,{padding:""},{default:a(()=>[d("div",null,[d("div",ae,[d("div",oe,[t(k,{onSubmit:b},{default:a(()=>[t(Q,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),t(U,{rows:w.value,"row-key":"name",grid:"",pagination:E.value,"hide-bottom":""},{item:a(o=>[d("div",se,[t(N,{bordered:""},{default:a(()=>[P((S(),Y(T,{clickable:"",onClick:()=>{i.value.state=!0,i.value.val=o.row}},{default:a(()=>[t(F,null,{default:a(()=>[t(h,{class:"text-center text-bold"},{default:a(()=>[m(c(o.row.id),1)]),_:2},1024),t(h,{class:"text-center text-overline text-caption"},{default:a(()=>[d("span",ie,c(o.row.requisition.from.name),1),m(" (P: "+c(o.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[W]])]),_:2},1024)])]),_:1},8,["rows","pagination"])])]),_:1}),t(V,{modelValue:r.value.state,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.state=o)},{default:a(()=>[t($,null,{default:a(()=>[t(k,{onSubmit:e[2]||(e[2]=()=>{r.value.val?D():J(l).notify({message:"necesito la llave :x",type:"negative",position:"center"})})},{default:a(()=>[t(v,{class:"row items-center"},{default:a(()=>[t(K,{icon:"warning",color:"orange-14","text-color":"white"}),d("span",le,"Iniciar CheckOut #"+c(n.value),1)]),_:1}),t(v,null,{default:a(()=>[t(Q,{modelValue:r.value.val,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.val=o),filled:"",type:"text",label:"LLave","auto-focus":""},null,8,["modelValue"])]),_:1}),t(C,{vertical:"",align:"center"},{default:a(()=>[t(f,{flat:"",label:"Si",color:"primary",type:"submit",disable:r.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(V,{modelValue:i.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.state=o),persistent:""},{default:a(()=>[t($,null,{default:a(()=>[t(v,{class:"text-bold text-h5 items-center"},{default:a(()=>[m(" Particion "+c(i.value.val.id),1)]),_:1}),t(v,{class:"text-center"},{default:a(()=>e[5]||(e[5]=[m(" Que Desesas Hacer ? ")])),_:1}),t(C,{align:"center"},{default:a(()=>[P(t(f,{flat:"",icon:"close",color:"negative"},null,512),[[X]]),t(f,{flat:"",icon:"print",color:"primary"},{default:a(()=>[t(L,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[t(te,{onSelectedPartition:R,partition:!0})]),_:1})]),_:1}),t(f,{flat:"",icon:"send",color:"positive",onClick:b})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{$e as default};
