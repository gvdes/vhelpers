import{Q as u}from"./QSeparator.69dbda3b.js";import{aE as j,u as G,r as p,c as P,o as h,a as z,w as n,e as a,f,Y as K,Q as c,a5 as X,a3 as Z}from"./index.d07968d6.js";import{Q as b,b as _}from"./QSelect.d4e4cdaa.js";import{Q as ee}from"./QToolbar.60d77e94.js";import{Q as le}from"./QHeader.badb8ed7.js";import{Q as E}from"./QInput.57d0b04f.js";import{Q as ae}from"./QDate.cbaabb90.js";import{Q as te}from"./QTable.215749c4.js";import{Q as oe,a as se}from"./QLayout.1cfeda76.js";import{u as ie,Q as w,a as V}from"./use-quasar.e6be033d.js";import{Q as ne}from"./QForm.e0149f84.js";import{Q as A}from"./QDialog.28fb4c67.js";import{Q as x}from"./QCardActions.df2840be.js";import{C as ue}from"./ClosePopup.ac771d57.js";import"./AppFullscreen.908fa537.js";import"./auto.ba62c17c.js";import"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.7cdff091.js";import{_ as re}from"./UserToolbar.0c2a2198.js";import{A as de}from"./assistApi.2e43d6ae.js";import{u as Q}from"./VDB.399ccf2c.js";import{a as C}from"./axios.9ab26c22.js";import{a as ve}from"./axios.ba7b1b0e.js";import"./use-key-composition.d81a621f.js";import"./uid.937d8ee7.js";import"./QItemSection.cd54f6f8.js";import"./position-engine.6e1f5a48.js";import"./rtl.276c3f1b.js";import"./QResizeObserver.c4f5d3c2.js";import"./use-render-cache.3aae9b27.js";import"./date.5a9f3ce0.js";import"./QList.cd1bde55.js";import"./QLinearProgress.d03d53d1.js";import"./QCheckbox.cc5b2176.js";import"./_commonjsHelpers.88e99c8f.js";const pe={class:"col"},me={class:"col"},fe={class:"row"},Ee={class:"q-ml-sm"},_e={__name:"withdrawals",setup(Re){const d=ie();j();const H=G(),k=Q(),S=Q(),r=p([]),O=p(null),m=p([]),o=p({val:null,state:!1}),v=p({val:null,opts:[]}),s=p({state:!1,val:null,body:null}),T=p([]),y=p(T.value),i=p({state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}),g=p({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:t=>t.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:t=>t.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:t=>t.NOFPRO,align:"left",sortable:!0}]}),U=P(()=>O.value&&!v.value.val?m.value.filter(t=>t.FECHA==O.value):!O.value&&v.value.val?m.value.filter(t=>t.CAJRET==v.value.val.CODTER):O.value&&v.value.val?m.value.filter(t=>t.FECHA==O.value&&t.CAJRET==v.value.val.CODTER):m.value),F=P(()=>{if(o.value){const t=m.value.find(l=>l.CODRET===o.value.val.CODRET);if(!t)return!1;let e={CAJRET:t.CAJRET,CODRET:t.CODRET,CONRET:t.CONRET,DESTER:t.DESTER,FECHA:t.FECHA,HORA:t.HORA,IMPRET:Number(t.IMPRET).toFixed(2),PROVEEDOR:{PRORET:t.PRORET,NOFPRO:t.NOFPRO}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),M=P(()=>!i.value.CONRET||!i.value.DESTER||!i.value.IMPRET||!i.value.PROVEEDOR),$=async()=>{d.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const t=await de.index();t.error||(console.log(t),r.value.opts=t,d.loading.hide(),L())},J=(t,e)=>{o.value.state=!o.value.state,console.log(e);let l={CAJRET:e.CAJRET,CODRET:e.CODRET,CONRET:e.CONRET,DESTER:e.DESTER,FECHA:e.FECHA,HORA:e.HORA,IMPRET:Number(e.IMPRET).toFixed(2),PROVEEDOR:{PRORET:e.PRORET,NOFPRO:e.NOFPRO}};o.value.val={...l}},L=async()=>{let t=S.session.store.id;console.log(t);try{let e=await ve.get(`/cashier/getPrinters/${t}`);e.status==200&&(s.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),d.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},B=async()=>{console.log(r.value.val.ip_address),d.loading.show({message:"Obteniendo Registros"});let e=`http://${r.value.val.ip_address}/storetools/public/api/reports/getWithdrawals`;const l=await C.get(e);l.status!=200?console.log(l):(console.log(l.data),m.value=l.data.cuts,v.value.opts=l.data.terminal,T.value=l.data.proveedores,d.loading.hide())},N=async()=>{console.log(r.value.val.ip_address);let t={print:s.value.val.ip_address,codret:o.value.val.CODRET};console.log(t),d.loading.show({message:"Imprimiendo Retirada"});let l=`http://${r.value.val.ip_address}/storetools/public/api/reports/printWitrawal`;const R=await C.post(l,t);R.status!=200?console.log(R):(console.log(R.data),s.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide())},W=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),d.loading.show({message:"Modificando Retirada"});let e=`http://${r.value.val.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const l=await C.post(e,o.value.val);if(l.status!=200)console.log(l);else{console.log(l.data);let R=m.value.findIndex(D=>D.CODRET==l.data.CODRET);R>=0&&(m.value[R]=l.data),s.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide()}},Y=async()=>{i.value.Print=s.value.val.ip_address,console.log(i.value),d.loading.show({message:"Agregando Anticipo"});let e=`http://${r.value.val.ip_address}/storetools/public/api/reports/addWithdrawal`;const l=await C.post(e,i.value);l.status!=200?console.log(l):(console.log(l.data),m.value.push(l.data),s.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide(),I())},I=()=>{i.value={state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}},q=(t,e,l)=>{if(t===""){e(()=>{y.value=T.value});return}e(()=>{const R=t.toLowerCase();y.value=T.value.filter(D=>D.NOFCLI.toLowerCase().includes(R))})};return k.session.rol==="adm"||k.session.rol==="root"?$():(d.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),H.replace("/")),(t,e)=>(h(),z(oe,{view:"hHh Lpr fFf"},{default:n(()=>[a(le,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[a(re),a(u),a(ee,{class:"justify-between row"},{default:n(()=>[f("div",pe,[e[22]||(e[22]=f("span",{class:"text-grey"},"Helpers",-1)),a(K,{name:"navigate_next",color:"primary"}),e[23]||(e[23]=f("span",{class:"text-h6"},"Retiradas de Cajas",-1))]),f("div",me,[f("div",fe,[e[24]||(e[24]=f("div",{class:"col"},null,-1)),a(b,{class:"col",modelValue:r.value.val,"onUpdate:modelValue":[e[0]||(e[0]=l=>r.value.val=l),B],options:r.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(se,null,{default:n(()=>[a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(te,{rows:U.value,filter:g.value.filter,columns:g.value.columns,onRowClick:J},{"top-right":n(()=>[a(E,{modelValue:g.value.filter,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value.filter=l),type:"text",label:"Buscar",filled:"",dense:"",disable:!r.value.val},null,8,["modelValue","disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:v.value.val,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.val=l),options:v.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!r.value.val},null,8,["modelValue","options","disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(c,{color:"primary",icon:"event",flat:"",round:"",disable:!r.value.val},{default:n(()=>[a(_,null,{default:n(()=>[a(ae,{modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=l=>O.value=l),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(c,{color:"primary",icon:"add",flat:"",onClick:e[4]||(e[4]=l=>i.value.state=!i.value.state),disable:!r.value.val},null,8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),a(A,{modelValue:s.value.state,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.state=l)},{default:n(()=>[a(w,{class:"my-card"},{default:n(()=>[a(V,null,{default:n(()=>e[25]||(e[25]=[f("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),a(V,null,{default:n(()=>[a(ne,{onSubmit:N,class:"q-gutter-md"},{default:n(()=>[a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),f("div",null,[a(c,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:o.value.state,"onUpdate:modelValue":e[14]||(e[14]=l=>o.value.state=l),persistent:""},{default:n(()=>[a(w,{style:{width:"300px"}},{default:n(()=>[a(V,{class:"text-bold text-center text-h5"},{default:n(()=>[f("span",Ee,"Retirada "+X(o.value.val.CODRET),1)]),_:1}),a(V,null,{default:n(()=>[a(E,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.val.FECHA=l),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.HORA,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.val.HORA=l),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.val.DESTER=l),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.val.PROVEEDOR=l),options:T.value,label:"Proveedor",filled:"","option-label":"NOFPRO"},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.val.CONRET=l),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.val.IMPRET=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(x,{align:"center"},{default:n(()=>[Z(a(c,{flat:"",color:"negative",icon:"close"},null,512),[[ue]]),a(c,{flat:"",color:"primary",icon:"print",onClick:N,disable:!F.value||!s.value.val},null,8,["disable"]),a(c,{flat:"",color:"yellow",icon:"edit",disable:F.value||!s.value.val,onClick:W},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:i.value.state,"onUpdate:modelValue":e[21]||(e[21]=l=>i.value.state=l),persistent:""},{default:n(()=>[a(w,{style:{width:"300px"}},{default:n(()=>[a(V,{class:"text-bold text-center text-h5"}),a(V,null,{default:n(()=>[a(E,{modelValue:i.value.FECHA,"onUpdate:modelValue":e[15]||(e[15]=l=>i.value.FECHA=l),type:"date",label:"Fecha",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:i.value.DESTER,"onUpdate:modelValue":e[16]||(e[16]=l=>i.value.DESTER=l),options:v.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:i.value.PROVEEDOR,"onUpdate:modelValue":e[17]||(e[17]=l=>i.value.PROVEEDOR=l),options:y.value,label:"Proveedor",filled:"","option-label":"NOFPRO","use-input":"","input-debounce":"0",onFilter:q,dense:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:i.value.CONRET,"onUpdate:modelValue":e[18]||(e[18]=l=>i.value.CONRET=l),type:"text",label:"Observacion",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:i.value.IMPRET,"onUpdate:modelValue":e[19]||(e[19]=l=>i.value.IMPRET=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[20]||(e[20]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(x,{align:"center"},{default:n(()=>[a(c,{flat:"",color:"negative",icon:"close",onClick:I}),a(c,{flat:"",color:"positive",icon:"send",disable:M.value||!s.value.val,onClick:Y},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{_e as default};
