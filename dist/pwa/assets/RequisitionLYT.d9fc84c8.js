import{Q as R}from"./QSeparator.f3ffbdc9.js";import{r as y,c as E,o as L,a as U,w as r,e as t,i as C,a3 as v,Y as T,Q as k,f as Q,h as Y,a4 as h,a$ as G,a2 as D}from"./index.5185070c.js";import{Q as Z}from"./QToolbar.82945b50.js";import{Q as ee}from"./QHeader.2912241f.js";import{u as oe,Q as F,a as $}from"./use-quasar.2636f21b.js";import{Q as z}from"./QSelect.1e62914f.js";import{Q as ae}from"./QForm.166ea454.js";import{Q as j}from"./QDialog.4d554718.js";import{Q as q}from"./QInput.3c519274.js";import{Q as te,a as g}from"./QTr.45849390.js";import{Q as le}from"./QTable.3bff63ed.js";import{Q as se}from"./QCardActions.7530a133.js";import{Q as ie}from"./QPage.41911b4a.js";import{Q as re,a as ne}from"./QLayout.a20bee7c.js";import{C as I}from"./ClosePopup.1c082b17.js";import{u as ue}from"./VDB.147cfb24.js";import{_ as ce}from"./UserToolbar.17b87b18.js";import{v as V,a as de}from"./axios.ae0a941c.js";import"./jspdf.plugin.autotable.21fbee80.js";import{E as me}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import"./QResizeObserver.40317ae2.js";import"./use-key-composition.3bd2873f.js";import"./uid.42677368.js";import"./position-engine.6482c5ee.js";import"./rtl.b51694b1.js";import"./QList.d65bcaf8.js";import"./QLinearProgress.958392ae.js";import"./QCheckbox.0718068c.js";import"./axios.f1f32898.js";import"./_commonjsHelpers.88e99c8f.js";var B={getSeccion(d){return V.get(`/resources/getSeccion/${d}`).then(s=>s.data).catch(s=>({fail:s}))},getProductsCompare(d,s){return V.post(`/resources/getProductReport/${d}`,s).then(u=>u.data).catch(u=>({fail:u}))},getProductsCompareLocation(d,s){return V.post(`/resources/getProductReportLocations/${d}`,s).then(u=>u.data).catch(u=>({fail:u}))},create(d){return V.post("/resources/create",d).then(s=>s.data).catch(s=>({fail:s}))},preview(d){return V.post("/resources/preview",d).then(s=>s.data).catch(s=>({fail:s}))}};const pe=C("span",{class:"text-h6"},"Resurtido",-1),fe=C("div",{class:"text-h6 text-center"},"Impresora",-1),ve={class:"row"},ge=C("div",{class:"text-h6"},"Agrega una nota",-1),Ke={__name:"RequisitionLYT",setup(d){const s=ue(),u=oe(),S=y({status:!1}),m=y({val:null,opts:[]}),p=y({val:[],opts:[]}),b=y([]),_=y(null),c=y({state:!1,val:null,body:[]}),f=y({val:null,opts:[]}),P=y({columns:[{name:"codigo",label:"Codigo",align:"left",sortable:!0,field:e=>e.code},{name:"description",label:"Descripcion",align:"left",sortable:!0,field:e=>e.description},{name:"Familia",label:"Familia",align:"left",sortable:!0,field:e=>e.categories.familia.name},{name:"Categoria",label:"Categoria",align:"left",sortable:!0,field:e=>e.categories.name},{name:"pieces",label:"PXC",align:"center",sortable:!0,field:e=>e.pieces},{name:"cedis",label:"Ced CJ",align:"center",sortable:!0,field:e=>e.cedis},{name:"texcoco",label:"Tex CJ",align:"center",sortable:!0,field:e=>e.texcoco},{name:"Sucursal",label:`${s.session.store.name}`,align:"center",sortable:!0,field:e=>e.sucursal},{name:"action",align:"center"}],filter:""}),x=E(()=>b.value.map(e=>{let o=Math.round(Number(e.stocks.filter(i=>i.id==1).map(i=>i.pivot.stock))/Number(e.pieces)),n=Math.round(Number(e.stocks.filter(i=>i.id==2).map(i=>i.pivot.stock))/Number(e.pieces)),l=Number(e.stocks.filter(i=>i.id==s.session.store.id_viz).map(i=>i.pivot.stock)),a=Math.round(Number(e.stocks.filter(i=>i.id==s.session.store.id_viz).map(i=>i.pivot.stock))*100/Number(e.pieces));return{id:e.id,name:e.name,code:e.code,cost:e.cost,description:e.description,categories:e.categories,pieces:e.pieces,min:Number(e.stocks.filter(i=>i.id==s.session.store.id_viz).map(i=>i.pivot.min)),max:Number(e.stocks.filter(i=>i.id==s.session.store.id_viz).map(i=>i.pivot.max)),cedis:o,texcoco:n,sucursal:l,percentage:a}}).filter(e=>s.session.store.id_viz==4?e.cedis+e.texcoco>0&&e.percentage<=20:e.cedis+e.texcoco>0&&e.percentage<=20&&e.min>0)),N=E(()=>p.value.val.length>0?x.value.filter(e=>p.value.val.includes(e.categories.name)):x.value),O=async()=>{let e=s.session.store.id_viz;u.loading.show({message:"Obteniendo secciones"});const o=await B.getSeccion(e);o.fail?console.log(o):(console.log(o),m.value.opts=o.families,f.value.opts=o.locations?o.locations[0].sections:null,u.loading.hide()),console.log(o)},A=async()=>{if(m.value.val){u.loading.show({message:"Obteniendo Reporte"}),console.log(m.value.val.map(l=>l.id));let e=s.session.store.id_viz,o=m.value.val.map(l=>l.id);const n=await B.getProductsCompare(e,{data:o});n.fail?console.log(n):(u.loading.hide(),console.log(n),b.value=n,b.value.forEach(l=>{const a=l.categories.name;a&&!p.value.opts.includes(a)&&p.value.opts.push(a)}))}},H=async()=>{if(f.value.val){console.log(f.value.val),u.loading.show({message:"Obteniendo Reporte"}),console.log(f.value.val.map(l=>l.id));let e=s.session.store.id_viz,o=f.value.val.map(l=>l.id);const n=await B.getProductsCompareLocation(e,{data:o});console.log(n),n.fail?console.log(n):(u.loading.hide(),console.log(n),b.value=n,b.value.forEach(l=>{const a=l.categories.name;a&&!p.value.opts.includes(a)&&p.value.opts.push(a)}))}},J=async()=>{u.loading.show({message:"Creando Pedido"});let e={workpoint_from:s.session.store.id_viz,workpoint_to:1,products:N.value,notes:_.value,id_userviz:s.session.id,type:2};console.log(e);const o=await B.create(e);o.fail?console.log(o):(console.log(o),u.notify({message:`Se creo el pedido ${o.order.id}`,type:"positive",position:"center"}),b.value=[],_.value=[],m.value.val=null,f.value.val=null,p.value.val=[],u.loading.hide())},M=e=>{console.log(e);let o=b.value.findIndex(n=>n.id===e.id);console.log(o),o>=0&&b.value.splice(o,1)},K=async()=>{console.log("aqui imprimo");let e={products:N.value,from:s.session.store,ip_address:c.value.val.ip_address};const o=await B.preview(e);o.fail?console.log(o):(console.log(o),u.notify({message:"Impresion Correcta",type:"positive",position:"center"}),c.value.val=null,c.value.state=!1)},W=async()=>{const e=new me.Workbook,o=e.addWorksheet("Resurtido");console.log(),o.addTable({name:"Resurtido",ref:"A1",headerRow:!0,totalsRow:!1,style:{showRowStripes:!0},columns:[{name:"Codigo",filterButton:!0},{name:"Descripcion",filterButton:!0},{name:"Seccion",filterButton:!0},{name:"Familia",filterButton:!0},{name:"Categoria",filterButton:!0},{name:"PXC",filterButton:!0},{name:"Cedis",filterButton:!0},{name:"Texcoco",filterButton:!0},{name:"Sucursal",filterButton:!0},{name:"Porcentaje",filterButton:!0}],rows:N.value.map(l=>[l.code,l.description,l.categories.familia.seccion.name,l.categories.familia.name,l.categories.name,l.pieces,l.cedis,l.texcoco,l.sucursal,l.percentage])}),o.columns.forEach(l=>{let a=0;l.eachCell({includeEmpty:!0},i=>{const w=i.value?i.value.toString().length:10;w>a&&(a=w)}),l.width=a<10?10:a}),(async()=>{const l=await e.xlsx.writeBuffer(),a=new Blob([l],{type:"application/octet-stream"}),i=URL.createObjectURL(a),w=document.createElement("a");w.href=i,w.download="Resurtido.xlsx",document.body.appendChild(w),w.click(),document.body.removeChild(w)})()},X=async()=>{let e=s.session.store.id;console.log(e);try{let o=await de.get(`/cashier/getPrinters/${e}`);o.status==200&&(c.value.body=o.data,console.log(o),c.value.state=!0)}catch(o){console.log(o),u.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}};return O(),(e,o)=>(L(),U(re,{view:"hHh Lpr fFf"},{default:r(()=>[t(ee,{class:"transparent text-dark",bordered:""},{default:r(()=>[t(ce),t(R),t(Z,{class:"justify-between"},{default:r(()=>[C("div",null,[v("Helpers "),t(T,{name:"navigate_next",color:"primary"}),v(),pe])]),_:1})]),_:1}),t(j,{modelValue:c.value.state,"onUpdate:modelValue":o[1]||(o[1]=n=>c.value.state=n)},{default:r(()=>[t(F,{class:"my-card"},{default:r(()=>[t($,null,{default:r(()=>[fe]),_:1}),t($,null,{default:r(()=>[t(ae,{onSubmit:K,class:"q-gutter-md"},{default:r(()=>[t(z,{dense:"","option-label":"name",modelValue:c.value.val,"onUpdate:modelValue":o[0]||(o[0]=n=>c.value.val=n),options:c.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),C("div",null,[t(k,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:c.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ne,null,{default:r(()=>[t(ie,{padding:""},{default:r(()=>{var n,l;return[C("div",ve,[Q(s).session.store.id_viz==4?(L(),U(z,{key:0,class:"col",modelValue:f.value.val,"onUpdate:modelValue":o[2]||(o[2]=a=>f.value.val=a),options:f.value.opts,label:"Ubicacion","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:H,disable:((n=m.value.val)==null?void 0:n.length)>0},null,8,["modelValue","options","disable"])):Y("",!0),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(z,{class:"col",modelValue:m.value.val,"onUpdate:modelValue":o[3]||(o[3]=a=>m.value.val=a),options:m.value.opts,label:"Familia","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:A,disable:((l=f.value.val)==null?void 0:l.length)>0},null,8,["modelValue","options","disable"]),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(z,{class:"col",modelValue:p.value.val,"onUpdate:modelValue":o[4]||(o[4]=a=>p.value.val=a),options:p.value.opts,label:"Categoria",filled:"",disable:!m.value.val,multiple:"","use-chips":""},null,8,["modelValue","options","disable"])]),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(le,{rows:Q(N),columns:P.value.columns,separator:"cell",filter:P.value.filter},{"top-right":r(()=>[t(q,{borderless:"",dense:"",debounce:"300",modelValue:P.value.filter,"onUpdate:modelValue":o[5]||(o[5]=a=>P.value.filter=a),placeholder:"Buscar"},{append:r(()=>[t(T,{name:"search"})]),_:1},8,["modelValue"]),t(k,{color:"primary","icon-right":"send",flat:"",onClick:o[6]||(o[6]=a=>S.value.state=!S.value.state),disable:Q(x).length==0},null,8,["disable"]),t(k,{color:"primary",icon:"print",flat:"",onClick:X,disable:Q(x).length==0},null,8,["disable"]),t(k,{color:"primary",icon:"download",flat:"",onClick:W,disable:Q(x).length==0},null,8,["disable"])]),body:r(a=>[t(te,{props:a},{default:r(()=>[t(g,{key:"codigo",props:a},{default:r(()=>[v(h(a.row.code),1)]),_:2},1032,["props"]),t(g,{key:"description",props:a},{default:r(()=>[v(h(a.row.description),1)]),_:2},1032,["props"]),t(g,{key:"Familia",props:a},{default:r(()=>[v(h(a.row.categories.familia.name),1)]),_:2},1032,["props"]),t(g,{key:"Categoria",props:a},{default:r(()=>[v(h(a.row.categories.name),1)]),_:2},1032,["props"]),t(g,{key:"pieces",props:a},{default:r(()=>[v(h(a.row.pieces),1)]),_:2},1032,["props"]),t(g,{key:"cedis",props:a},{default:r(()=>[v(h(a.row.cedis),1)]),_:2},1032,["props"]),t(g,{key:"texcoco",props:a},{default:r(()=>[v(h(a.row.texcoco),1)]),_:2},1032,["props"]),t(g,{key:"Sucursal",props:a},{default:r(()=>[v(h(a.row.sucursal),1)]),_:2},1032,["props"]),t(g,{key:"action",props:a},{default:r(()=>[t(k,{color:"negative",icon:"delete",onClick:i=>M(a.row),flat:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),t(j,{modelValue:S.value.state,"onUpdate:modelValue":o[10]||(o[10]=a=>S.value.state=a),persistent:""},{default:r(()=>[t(F,{style:{"min-width":"350px"}},{default:r(()=>[t($,null,{default:r(()=>[ge]),_:1}),t($,{class:"q-pt-none"},{default:r(()=>[t(q,{dense:"",modelValue:_.value,"onUpdate:modelValue":o[7]||(o[7]=a=>_.value=a),autofocus:"",onKeyup:o[8]||(o[8]=G(a=>e.prompt=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(se,{align:"right",class:"text-primary"},{default:r(()=>[D(t(k,{flat:"",label:"Cancelar",onClick:o[9]||(o[9]=a=>_.value=null)},null,512),[[I]]),D(t(k,{flat:"",label:"Enviar Pedido",onClick:J},null,512),[[I]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1})]),_:1})]),_:1}))}};export{Ke as default};
