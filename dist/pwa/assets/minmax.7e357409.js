import{Q as O,a as v}from"./QSelect.3caae765.js";import{b as E,a as F,d as y,e as m,Q as re}from"./QList.78073681.js";import{u as me,r as b,c as pe,l as ve,p as ce,o as M,g as D,e,w as t,f as fe,a3 as h,Q as q,U as ge,ak as G,al as u,a0 as c,a1 as _,a2 as H,h as xe,a4 as be,d as W}from"./index.15258eea.js";import{Q as w}from"./QCardSection.cb404fcd.js";import{Q as P}from"./QCard.45379e61.js";import{Q as A}from"./QInput.420ec09a.js";import{Q as X}from"./QTable.ab1e9866.js";import{Q as Y,a as _e,b as Z}from"./QTabPanels.dcb9fda4.js";import{Q as we}from"./QTabs.db4b49ad.js";import{Q as ke}from"./QCardActions.355243a7.js";import{Q as ye}from"./QFooter.b5d4bc55.js";import{Q as Ve}from"./QPage.1bdc2fdd.js";import{C as Qe}from"./ClosePopup.27b476e6.js";import"./QDrawer.3c2b0d14.js";import"./QExpansionItem.b3a1fab8.js";import"./axios.7c1eeb6c.js";import{u as Me}from"./use-quasar.377ab6bd.js";import{u as ze}from"./warehousStore.f262da93.js";import{P as Ee,d as Te}from"./ProductsAutocomplete.1b3cef1d.js";import"./jspdf.plugin.autotable.639d11f3.js";import{E as Ne}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{p as B}from"./productsApi.c8640965.js";import"./use-key-composition.a5729965.js";import"./QLinearProgress.a2aac955.js";import"./QCheckbox.762a1a90.js";import"./use-checkbox.a8f46836.js";import"./TouchSwipe.57e9e0a7.js";import"./use-render-cache.3aae9b27.js";import"./QResizeObserver.6b28efca.js";import"./QScrollObserver.a45d46ae.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const ma={__name:"minmax",setup(Ce){const d=me(),r=Me(),I=ze();I.setTitle("Minimos Y Maximos"),I.setshowReportLocations(!1),I.setshowReportMinMax(!0);const L=b(null),T=b("products"),i=b({state:!1,val:null}),K=b({opts:[{id:1,name:"Disponible"},{id:3,name:"Agotado"},{id:6,name:"Bloqueado"}]}),p=b({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),n=b({min:null,max:null}),z=b(null),f=b({val:null,opts:[{id:1,label:"Pieza"},{id:2,label:"Docena"},{id:3,label:"Caja"},{id:4,label:"Media Caja"}]}),$=b({columns:[{name:"store",label:"Sucursal",field:o=>o.name,align:"left"},{name:"Stock",label:"Stock PZ",field:o=>o.pivot.stock,align:"center"}],pagination:{rowsPerPage:10}}),R=pe(()=>r.platform.is.mobile),ee=o=>{console.log(o)},ae=o=>{var l;i.value.state=!0,i.value.val=o,console.log(o);const a=o.stocks.find(s=>s.id==d.session.store.id_viz);if(a){let s=1;switch((l=f.value.val)==null?void 0:l.id){case 1:s=1;break;case 2:s=12;break;case 3:s=o.pieces||1;break;case 4:s=(o.pieces||1)/2;break}z.value={min:a.pivot.min/s,max:a.pivot.max/s},n.value.min=a.pivot.min/s,n.value.max=a.pivot.max/s}},le=()=>{var l;if(!i.value.val)return;const o=i.value.val.stocks.find(s=>s.id==d.session.store.id_viz);if(!o)return;let a=1;switch((l=f.value.val)==null?void 0:l.id){case 1:a=1;break;case 2:a=12;break;case 3:a=i.value.val.pieces||1;break;case 4:a=(i.value.val.pieces||1)/2;break}o.pivot.min=n.value.min*a,o.pivot.max=n.value.max*a},te=async()=>{const o=i.value.val.stocks.find(a=>a.id==d.session.store.id_viz);if(o.pivot.min!==z.value.min){let a={product:i.value.val.id,min:o.pivot.min,_workpoint:d.session.store.id_viz};console.log(a),r.loading.show({message:"Modificando"});const l=await B.setMin(a);l.fail?console.log(l):(r.loading.hide(),z.value.min=a.min,r.notify({message:l.message,type:l.success?"positive":"negative",position:"top"}))}},oe=async()=>{const o=i.value.val.stocks.find(a=>a.id==d.session.store.id_viz);if(o.pivot.max!==z.value.max){let a={product:i.value.val.id,max:o.pivot.max,_workpoint:d.session.store.id_viz};console.log(a),r.loading.show({message:"Modificando"});const l=await B.setMax(a);l.fail?console.log(l):(r.loading.hide(),z.value.max=a.max,r.notify({message:l.message,type:l.success?"positive":"negative",position:"top"}))}},se=()=>{let o=document.getElementById("inputFile").files[0],a=new Ne.Workbook,l=[],s={};a.xlsx.load(o).then(()=>{let N=a.worksheets[0];N.getColumn("A").eachCell({includeEmpty:!0},function(k,V){let x=k.value;if(!x)return;let C=parseFloat(N.getCell(`B${V}`).value)||0,U=parseFloat(N.getCell(`C${V}`).value)||0;s[x]||(s[x]={minimo:0,maximo:0}),s[x].minimo=C,s[x].maximo=U});let j=Object.keys(s).map(k=>({codigo:k,minmax:s[k]}));if(j.forEach(k=>l.push(k.codigo)),l.length){let k={codes:l,_workpoint:d.session.store.id_viz};r.loading.show({message:"Procesando archivo, espera.."}),Te.getMassive(k).then(V=>{let x=V.data;x.fails.notFound.map(g=>p.value.wndNotExist.push(g)),x.fails.repeat.map(g=>p.value.repeat.push(g));let C=x.products;p.value.wndGetRows=C.length,p.value.state=!p.value.state;let U=C.map(g=>{var J;let Q=1;switch((J=f.value.val)==null?void 0:J.id){case 1:Q=1;break;case 2:Q=12;break;case 3:Q=g.pieces||1;break;case 4:Q=(g.pieces||1)/2;break}let S=j.find(de=>de.codigo===g.code);return{id:g.id,producto:g.code,descripcion:g.description,min:S?S.minmax.minimo*Q:0,max:S?S.minmax.maximo*Q:0}});p.value.wndTotal=U,r.loading.hide()}).catch(V=>{console.log(V),r.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ie=async()=>{r.loading.show({message:"actualizando Min y Max"});let o={workpoint:d.session.store.id_viz,products:p.value.wndTotal};console.log(o);const a=await B.setMassisveMinMax(o);a.fail?console.log(a):(r.loading.hide(),r.notify({message:"Datos Actualizados",type:"positive",position:"center"}),console.log(a),p.value={state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]})},ne=async o=>{r.loading.show({message:"Cambiando Estado"});let a={_product:i.value.val.id,_status:o,wid:d.session.store.id_viz};console.log(a);const l=await B.updateStatusProduct(a);l.fail?console.log(l):(console.log(l),r.loading.hide(),r.notify({message:"Estado Actualizado",type:"positive",position:"right"}))};return ve([()=>f.value.val,()=>n.value.min,()=>n.value.max],([o,a,l],[s,N,ue])=>{localStorage.setItem("minmaxType",JSON.stringify(o)),le()},{deep:!0}),ce(()=>{const o=localStorage.getItem("minmaxType");o&&(f.value.val=JSON.parse(o))}),(o,a)=>(M(),D(h,null,[e(Ve,{padding:""},{default:t(()=>[e(P,{class:"my-card"},{default:t(()=>[e(w,{class:"row"},{default:t(()=>[e(O,{class:"col",modelValue:f.value.val,"onUpdate:modelValue":a[0]||(a[0]=l=>f.value.val=l),options:f.value.opts,label:"UNIDAD",filled:"",dense:"",hint:f.value.val?`Los min y max que generes se pondran en ${f.value.val.label}`:""},null,8,["modelValue","options","hint"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(q,{disable:!f.value.val,color:"primary",title:"subirArchivo",icon:"upload",onClick:a[1]||(a[1]=()=>L.value.click()),flat:"",rounded:""},null,8,["disable"])]),_:1})]),_:1}),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(ge,{name:"bounce"},{default:t(()=>[i.value.state?(M(),D("div",{key:0,class:G(R.value?"":"row")},[e(P,{class:G(R.value?"":"col")},{default:t(()=>[e(w,null,{default:t(()=>[e(F,null,{default:t(()=>[e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[10]||(a[10]=[u("Codigo")])),_:1}),e(m,null,{default:t(()=>[u(c(i.value.val.code),1)]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[11]||(a[11]=[u("Descripcion")])),_:1}),e(m,null,{default:t(()=>[u(c(i.value.val.description),1)]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[12]||(a[12]=[u("PXC")])),_:1}),e(m,null,{default:t(()=>[u(c(i.value.val.pieces),1)]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[13]||(a[13]=[u("Estado")])),_:1}),e(m,null,{default:t(()=>[e(O,{modelValue:i.value.val.stateToVal.state,"onUpdate:modelValue":[a[2]||(a[2]=l=>i.value.val.stateToVal.state=l),ne],"option-value":"id",options:K.value.opts,filled:"",dense:"","option-label":"name","emit-value":"","map-options":""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>[e(v,{caption:""},{default:t(()=>a[14]||(a[14]=[u("GEN")])),_:1}),e(v,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==_(d).session.store.id_viz).pivot.gen),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(v,{caption:""},{default:t(()=>a[15]||(a[15]=[u("EXH")])),_:1}),e(v,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==_(d).session.store.id_viz).pivot.exh),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(v,{caption:""},{default:t(()=>a[16]||(a[16]=[u("FDT")])),_:1}),e(v,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==_(d).session.store.id_viz).pivot.fdt),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(v,{caption:""},{default:t(()=>a[17]||(a[17]=[u("EnTransito")])),_:1}),e(v,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==_(d).session.store.id_viz).pivot.in_transit),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{class:"row"},{default:t(()=>[e(A,{modelValue:n.value.min,"onUpdate:modelValue":a[3]||(a[3]=l=>n.value.min=l),type:"number",label:"Minimo",class:"col",filled:"","input-class":"text-center",error:Number(n.value.max)<=Number(n.value.min)||Number(n.value.min)>=Number(n.value.max),"error-message":n.value.max<=n.value.min||n.value.min>=n.value.max?"El maximo es menor que el minimo":"El minimo es mayor que el maximo",onBlur:te},null,8,["modelValue","error","error-message"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(A,{modelValue:n.value.max,"onUpdate:modelValue":a[4]||(a[4]=l=>n.value.max=l),type:"number",label:"Maximo",class:"col",filled:"","input-class":"text-center",error:Number(n.value.max)<=Number(n.value.min)||Number(n.value.min)>=Number(n.value.max),"error-message":n.value.max<=n.value.min||n.value.min>=n.value.max?"El maximo es menor que el minimo":"El minimo es mayor que el maximo",onBlur:oe},null,8,["modelValue","error","error-message"])]),_:1}),e(w,{class:"row"},{default:t(()=>[e(A,{disable:"",modelValue:i.value.val.stocks.find(l=>l.id==_(d).session.store.id_viz).pivot.min,"onUpdate:modelValue":a[5]||(a[5]=l=>i.value.val.stocks.find(s=>s.id==_(d).session.store.id_viz).pivot.min=l),type:"number",label:"Minimo",class:"col",filled:"","input-class":"text-center"},null,8,["modelValue"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(A,{disable:"",modelValue:i.value.val.stocks.find(l=>l.id==_(d).session.store.id_viz).pivot.max,"onUpdate:modelValue":a[6]||(a[6]=l=>i.value.val.stocks.find(s=>s.id==_(d).session.store.id_viz).pivot.max=l),type:"number",label:"Maximo",class:"col",filled:"","input-class":"text-center"},null,8,["modelValue"])]),_:1}),e(w,null,{default:t(()=>[e(F,{bordered:""},{default:t(()=>[(M(!0),D(h,null,H(i.value.val.stocks.filter(l=>l._type==1),(l,s)=>(M(),W(y,{key:s},{default:t(()=>[e(m,{class:"text-bold"},{default:t(()=>[u(c(l.name),1)]),_:2},1024),e(m,{class:"text-center"},{default:t(()=>[u(c(l.pivot.stock),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["class"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(X,{class:G(R.value?"":"col"),rows:i.value.val.stocks.filter(l=>l._type==2),columns:$.value.columns,pagination:$.value.pagination},null,8,["class","rows","columns","pagination"])],2)):xe("",!0)]),_:1}),e(re,{modelValue:p.value.state,"onUpdate:modelValue":a[9]||(a[9]=l=>p.value.state=l),persistent:""},{default:t(()=>[e(P,{style:{width:"800px","max-width":"90vw"}},{default:t(()=>[e(w,{class:"text-center text-h6 text-bold"},{default:t(()=>a[18]||(a[18]=[u(" Resultado de Importacion ")])),_:1}),e(w,null,{default:t(()=>[e(F,{bordered:""},{default:t(()=>[e(y,null,{default:t(()=>[e(m,null,{default:t(()=>[e(v,{class:"text-center"},{default:t(()=>a[19]||(a[19]=[u("Productos Encontrados")])),_:1}),e(v,{class:"text-center"},{default:t(()=>[u(c(p.value.wndGetRows),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(v,{class:"text-center"},{default:t(()=>a[20]||(a[20]=[u("Productos Repetidos")])),_:1}),e(v,{class:"text-center"},{default:t(()=>[u(c(p.value.repeat.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(we,{modelValue:T.value,"onUpdate:modelValue":a[7]||(a[7]=l=>T.value=l),class:"text-teal"},{default:t(()=>[e(Y,{name:"products",icon:"local_mall",label:"Encontrados"}),e(Y,{name:"notFund",icon:"wrong_location",label:"No Encontrados"})]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:t(()=>[e(_e,{modelValue:T.value,"onUpdate:modelValue":a[8]||(a[8]=l=>T.value=l),animated:""},{default:t(()=>[e(Z,{name:"products"},{default:t(()=>[e(X,{rows:p.value.wndTotal,"virtual-scroll":"",flat:"",bordered:"",style:{height:"400px"},"row-key":"producto"},null,8,["rows"])]),_:1}),e(Z,{name:"notFund"},{default:t(()=>[e(F,{bordered:""},{default:t(()=>[(M(!0),D(h,null,H(p.value.wndNotExist,(l,s)=>(M(),W(y,{key:s},{default:t(()=>[e(m,null,{default:t(()=>[u(c(l),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ke,{align:"center"},{default:t(()=>[e(q,{flat:"",label:"Modificar",color:"positive",onClick:ie}),be(e(q,{flat:"",label:"Cancelar",color:"negative"},null,512),[[Qe]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ye,{reveal:"",elevated:"",bordered:""},{default:t(()=>[e(P,{class:"my-card"},{default:t(()=>[e(Ee,{onInput:ee,onAgregar:ae,"workpoint-status":"all",checkState:!0,wkpToVal:_(d).session.store.id_viz},null,8,["wkpToVal"])]),_:1})]),_:1})]),_:1}),fe("input",{type:"file",ref_key:"inputFile",ref:L,id:"inputFile",onInput:se,hidden:"",accept:".xlsx,.xls"},null,544)],64))}};export{ma as default};
