import{u as he,Q as ee,c as we}from"./QSeparator.7d993a8e.js";import{Q as ke}from"./QHeader.cd4646a0.js";import{i as K,aw as xe,G as I,X as Ce,ax as _e,aq as Y,ay as O,as as te,z as H,ar as z,r as E,c as C,n as de,q as ce,j as L,T as Se,aF as Te,k as J,aG as Pe,an as Ee,o as V,g as N,a as X,w as x,e as m,f as _,a0 as M,a1 as pe,Q as F,a6 as B,a3 as ae,a4 as Ae,h as W,aH as De,u as Qe,E as Ve,aI as Me}from"./index.5a98b8ac.js";import{c as Le,Q as qe,d as Ie}from"./QSelect.b7699ea8.js";import{Q as $e}from"./QInput.19b54fce.js";import{Q as Ue}from"./QForm.8852c237.js";import{Q as Be}from"./QToolbar.88d2ba44.js";import{Q as ve}from"./QTable.eb715612.js";import{k as Re,l as je,a as oe,Q as G,u as Ye}from"./use-quasar.b322a08d.js";import{Q as Ne}from"./QPage.a5a8df48.js";import{Q as Fe,a as Oe}from"./QLayout.9fa41690.js";import{d as $}from"./dayjs.min.cbcf888d.js";import{_ as He}from"./UserToolbar.d1293a2d.js";import{v as ne}from"./axios.0d2bd0f9.js";import{u as ze}from"./VDB.27c8cfe6.js";import{u as Xe,a as We,b as Ge,Q as Ke}from"./QTabs.0bfca3ab.js";import{g as se,s as le}from"./QDrawer.c5e2515e.js";import{u as Je}from"./use-render-cache.3aae9b27.js";import{E as Ze}from"./exceljs.min.9e24d01d.js";import{c as U}from"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.400c9bfa.js";import"./QList.7eb286b7.js";import"./QLinearProgress.b0ca17ef.js";import"./QCheckbox.303554ee.js";import"./QScrollObserver.89a36813.js";import"./QCardActions.f867ca51.js";import"./ClosePopup.4ad9adb4.js";import"./auth.47587533.js";var me={index({dateranges:t,view:l,store:p}){let v=l.id;return t.to,t.from,ne.get(`/ciclicos?v=${v}&store=${p}`).then(w=>w.data).catch(w=>({fail:w}))},find(t,l){return ne.get(`/ciclicos/${t}?store=${l}`).then(p=>p.data).catch(p=>({fail:p}))}},re=K({name:"QTab",props:Xe,emits:We,setup(t,{slots:l,emit:p}){const{renderTab:v}=Ge(t,l,p);return()=>v("div")}});function et(t){const l=[.06,6,50];return typeof t=="string"&&t.length&&t.split(":").forEach((p,v)=>{const w=parseFloat(p);w&&(l[v]=w)}),l}var tt=xe({name:"touch-swipe",beforeMount(t,{value:l,arg:p,modifiers:v}){if(v.mouse!==!0&&I.has.touch!==!0)return;const w=v.mouseCapture===!0?"Capture":"",e={handler:l,sensitivity:et(p),direction:se(v),noop:Ce,mouseStart(o){le(o,e)&&_e(o)&&(Y(e,"temp",[[document,"mousemove","move",`notPassive${w}`],[document,"mouseup","end","notPassiveCapture"]]),e.start(o,!0))},touchStart(o){if(le(o,e)){const d=o.target;Y(e,"temp",[[d,"touchmove","move","notPassiveCapture"],[d,"touchcancel","end","notPassiveCapture"],[d,"touchend","end","notPassiveCapture"]]),e.start(o)}},start(o,d){I.is.firefox===!0&&O(t,!0);const g=te(o);e.event={x:g.left,y:g.top,time:Date.now(),mouse:d===!0,dir:!1}},move(o){if(e.event===void 0)return;if(e.event.dir!==!1){H(o);return}const d=Date.now()-e.event.time;if(d===0)return;const g=te(o),r=g.left-e.event.x,a=Math.abs(r),y=g.top-e.event.y,n=Math.abs(y);if(e.event.mouse!==!0){if(a<e.sensitivity[1]&&n<e.sensitivity[1]){e.end(o);return}}else if(window.getSelection().toString()!==""){e.end(o);return}else if(a<e.sensitivity[2]&&n<e.sensitivity[2])return;const b=a/d,S=n/d;e.direction.vertical===!0&&a<n&&a<100&&S>e.sensitivity[0]&&(e.event.dir=y<0?"up":"down"),e.direction.horizontal===!0&&a>n&&n<100&&b>e.sensitivity[0]&&(e.event.dir=r<0?"left":"right"),e.direction.up===!0&&a<n&&y<0&&a<100&&S>e.sensitivity[0]&&(e.event.dir="up"),e.direction.down===!0&&a<n&&y>0&&a<100&&S>e.sensitivity[0]&&(e.event.dir="down"),e.direction.left===!0&&a>n&&r<0&&n<100&&b>e.sensitivity[0]&&(e.event.dir="left"),e.direction.right===!0&&a>n&&r>0&&n<100&&b>e.sensitivity[0]&&(e.event.dir="right"),e.event.dir!==!1?(H(o),e.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),Le(),e.styleCleanup=A=>{e.styleCleanup=void 0,document.body.classList.remove("non-selectable");const P=()=>{document.body.classList.remove("no-pointer-events--children")};A===!0?setTimeout(P,50):P()}),e.handler({evt:o,touch:e.event.mouse!==!0,mouse:e.event.mouse,direction:e.event.dir,duration:d,distance:{x:a,y:n}})):e.end(o)},end(o){e.event!==void 0&&(z(e,"temp"),I.is.firefox===!0&&O(t,!1),e.styleCleanup!==void 0&&e.styleCleanup(!0),o!==void 0&&e.event.dir!==!1&&H(o),e.event=void 0)}};if(t.__qtouchswipe=e,v.mouse===!0){const o=v.mouseCapture===!0||v.mousecapture===!0?"Capture":"";Y(e,"main",[[t,"mousedown","mouseStart",`passive${o}`]])}I.has.touch===!0&&Y(e,"main",[[t,"touchstart","touchStart",`passive${v.capture===!0?"Capture":""}`],[t,"touchmove","noop","notPassiveCapture"]])},updated(t,l){const p=t.__qtouchswipe;p!==void 0&&(l.oldValue!==l.value&&(typeof l.value!="function"&&p.end(),p.handler=l.value),p.direction=se(l.modifiers))},beforeUnmount(t){const l=t.__qtouchswipe;l!==void 0&&(z(l,"main"),z(l,"temp"),I.is.firefox===!0&&O(t,!1),l.styleCleanup!==void 0&&l.styleCleanup(),delete t.__qtouchswipe)}});const at={name:{required:!0},disable:Boolean},ie={setup(t,{slots:l}){return()=>L("div",{class:"q-panel scroll",role:"tabpanel"},J(l.default))}},ot={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},nt=["update:modelValue","beforeTransition","transition"];function st(){const{props:t,emit:l,proxy:p}=ce(),{getCache:v}=Je(),{registerTimeout:w}=he();let e,o;const d=E(null),g={value:null};function r(u){const h=t.vertical===!0?"up":"left";Q((p.$q.lang.rtl===!0?-1:1)*(u.direction===h?1:-1))}const a=C(()=>[[tt,r,void 0,{horizontal:t.vertical!==!0,vertical:t.vertical,mouse:!0}]]),y=C(()=>t.transitionPrev||`slide-${t.vertical===!0?"down":"right"}`),n=C(()=>t.transitionNext||`slide-${t.vertical===!0?"up":"left"}`),b=C(()=>`--q-transition-duration: ${t.transitionDuration}ms`),S=C(()=>typeof t.modelValue=="string"||typeof t.modelValue=="number"?t.modelValue:String(t.modelValue)),A=C(()=>({include:t.keepAliveInclude,exclude:t.keepAliveExclude,max:t.keepAliveMax})),P=C(()=>t.keepAliveInclude!==void 0||t.keepAliveExclude!==void 0);de(()=>t.modelValue,(u,h)=>{const D=s(u)===!0?i(u):-1;o!==!0&&q(D===-1?0:D<i(h)?-1:1),g.value!==D&&(g.value=D,l("beforeTransition",u,h),w(()=>{l("transition",u,h)},t.transitionDuration))});function f(){Q(1)}function c(){Q(-1)}function k(u){l("update:modelValue",u)}function s(u){return u!=null&&u!==""}function i(u){return e.findIndex(h=>h.props.name===u&&h.props.disable!==""&&h.props.disable!==!0)}function T(){return e.filter(u=>u.props.disable!==""&&u.props.disable!==!0)}function q(u){const h=u!==0&&t.animated===!0&&g.value!==-1?"q-transition--"+(u===-1?y.value:n.value):null;d.value!==h&&(d.value=h)}function Q(u,h=g.value){let D=h+u;for(;D!==-1&&D<e.length;){const j=e[D];if(j!==void 0&&j.props.disable!==""&&j.props.disable!==!0){q(u),o=!0,l("update:modelValue",j.props.name),setTimeout(()=>{o=!1});return}D+=u}t.infinite===!0&&e.length!==0&&h!==-1&&h!==e.length&&Q(u,u===-1?e.length:-1)}function R(){const u=i(t.modelValue);return g.value!==u&&(g.value=u),!0}function Z(){const u=s(t.modelValue)===!0&&R()&&e[g.value];return t.keepAlive===!0?[L(Pe,A.value,[L(P.value===!0?v(S.value,()=>({...ie,name:S.value})):ie,{key:S.value,style:b.value},()=>u)])]:[L("div",{class:"q-panel scroll",style:b.value,key:S.value,role:"tabpanel"},[u])]}function ge(){if(e.length!==0)return t.animated===!0?[L(Se,{name:d.value},Z)]:Z()}function be(u){return e=Te(J(u.default,[])).filter(h=>h.props!==null&&h.props.slot===void 0&&s(h.props.name)===!0),e.length}function ye(){return e}return Object.assign(p,{next:f,previous:c,goTo:k}),{panelIndex:g,panelDirectives:a,updatePanelsList:be,updatePanelIndex:R,getPanelContent:ge,getEnabledPanels:T,getPanels:ye,isValidPanelName:s,keepAliveProps:A,needsUniqueKeepAliveWrapper:P,goToPanelByOffset:Q,goToPanel:k,nextPanel:f,previousPanel:c}}var ue=K({name:"QTabPanel",props:at,setup(t,{slots:l}){return()=>L("div",{class:"q-tab-panel",role:"tabpanel"},J(l.default))}}),lt=K({name:"QTabPanels",props:{...ot,...Re},emits:nt,setup(t,{slots:l}){const p=ce(),v=je(t,p.proxy.$q),{updatePanelsList:w,getPanelContent:e,panelDirectives:o}=st(),d=C(()=>"q-tab-panels q-panel-parent"+(v.value===!0?" q-tab-panels--dark q-dark":""));return()=>(w(l),Ee("div",{class:d.value},e(),"pan",t.swipeable,()=>o.value))}}),fe={exports:{}};(function(t,l){(function(p,v){v()})(U,function(){function p(r,a){return typeof a=="undefined"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r}function v(r,a,y){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){g(n.response,a,y)},n.onerror=function(){console.error("could not download file")},n.send()}function w(r){var a=new XMLHttpRequest;a.open("HEAD",r,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function e(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(a)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof U=="object"&&U.global===U?U:void 0,d=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!d?function(r,a,y){var n=o.URL||o.webkitURL,b=document.createElement("a");a=a||r.name||"download",b.download=a,b.rel="noopener",typeof r=="string"?(b.href=r,b.origin===location.origin?e(b):w(b.href)?v(r,a,y):e(b,b.target="_blank")):(b.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(b.href)},4e4),setTimeout(function(){e(b)},0))}:"msSaveOrOpenBlob"in navigator?function(r,a,y){if(a=a||r.name||"download",typeof r!="string")navigator.msSaveOrOpenBlob(p(r,y),a);else if(w(r))v(r,a,y);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){e(n)})}}:function(r,a,y,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return v(r,a,y);var b=r.type==="application/octet-stream",S=/constructor/i.test(o.HTMLElement)||o.safari,A=/CriOS\/[\d]+/.test(navigator.userAgent);if((A||b&&S||d)&&typeof FileReader!="undefined"){var P=new FileReader;P.onloadend=function(){var k=P.result;k=A?k:k.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=k:location=k,n=null},P.readAsDataURL(r)}else{var f=o.URL||o.webkitURL,c=f.createObjectURL(r);n?n.location=c:location.href=c,n=null,setTimeout(function(){f.revokeObjectURL(c)},4e4)}});o.saveAs=g.saveAs=g,t.exports=g})})(fe);var rt=fe.exports;const it={class:"row justify-between"},ut={class:"text-h6"},dt={class:"text-subtitle2"},ct={class:"text-subtitle2"},pt={class:"text-subtitle2"},vt={class:"text-white"},mt={__name:"Viewer",props:{folio:[String,Number],store:[String,Number]},emits:["errorsearch"],setup(t,{emit:l}){const p=t,v=p.folio,w=p.store,e=E(null),o=E(null),d=E("body"),g=E(null),r=E({cols:[{name:"id",field:"id",label:"ID",align:"left"},{name:"lcode",field:"code",label:"Codigo"},{name:"scode",field:"name",label:"Codigo C."},{name:"descr",field:"description",label:"Articulo",align:"left",classes:"fs-dec4"},{name:"sai",field:f=>f.ordered.stocks,label:"SAI",align:"center"},{name:"counteds",field:f=>f.ordered.stocks_acc,label:"UC",align:"center"},{name:"sat",field:f=>{var c;return(c=f.ordered.stocks_end)!=null?c:"--"},label:"SAT",align:"center"},{name:"ufus",field:f=>f.ordered.stocks_acc-f.ordered.stocks,label:"UF/US",align:"center"},{name:"locs",field:f=>f.locations.map(c=>c.path).join(", "),label:"Ubicacion (es)",align:"left"}]}),a=C(()=>e.value?e.value.created_by:null),y=C(()=>e.value?e.value.log:[]),n=C(()=>e.value&&e.value.responsables&&e.value.responsables.length?e.value.responsables.map(f=>f.nick).join(","):""),b=C(()=>e.value&&e.value.products&&e.value.products.length?e.value.products:[]),S=C(()=>e.value?e.value.status.name:"");C(()=>""),C(()=>""),(async()=>{const f=await me.find(v,w);console.log(f),f.fail?o.value=f.fail:e.value=f.inventory})();const P=f=>{let c=`INV_${e.value.id}_${e.value.workpoint.alias}.xlsx`;console.log(c);let k=new Ze.Workbook,s=k.addWorksheet("Sheet1");s.columns=[{header:"ID",key:"id"},{header:"Codigo",key:"lcode"},{header:"Codigo C.",key:"scode"},{header:"Articulo",key:"description"},{header:"SAI",key:"sai"},{header:"UC",key:"uc"},{header:"SAT",key:"sat"},{header:"UF/US",key:"ufus"},{header:"Ubicacion(es)",key:"locs"}],b.value.forEach(i=>{s.addRow({id:i.id,lcode:i.code,scode:i.name,description:i.description,sai:parseInt(i.ordered.stocks),uc:parseInt(i.ordered.stocks_acc),sat:parseInt(i.ordered.stocks_end),ufus:parseInt(i.ordered.stocks_acc)-parseInt(i.ordered.stocks),locs:i.locations.map(T=>T.path).join(", ")})}),s.getCell("L2").value="Folio:",s.getCell("M2").value=e.value.id,s.getCell("L3").value="Sucursal:",s.getCell("M3").value=e.value.workpoint.name,s.getCell("L4").value="Estado:",s.getCell("M4").value=S.value,s.getCell("L5").value="Creado por:",s.getCell("M5").value=a.value?a.value.names:"",s.getCell("L6").value="Realizado por:",s.getCell("M6").value=n.value,s.getCell("L7").value="Inicio:",s.getCell("M7").value="",s.getCell("L8").value="Termino:",s.getCell("M8").value="",k.xlsx.writeBuffer().then(i=>rt(new Blob([i],{type:"application/octet-stream"}),c))};return(f,c)=>(V(),N(ae,null,[e.value?(V(),X(G,{key:0,class:"my-card"},{default:x(()=>[m(oe,null,{default:x(()=>[_("div",it,[_("div",ut,"Inventario "+M(pe(v)),1),_("div",null,[m(F,{color:"primary",label:"descargar",onClick:P})])]),_("div",dt,[c[2]||(c[2]=B("Creado por: ")),_("b",null,M(a.value?a.value.names:"Nobody"),1)]),_("div",ct,[c[3]||(c[3]=B("Realizado por: ")),_("b",null,M(n.value),1)]),_("div",pt,[c[4]||(c[4]=B("Estado: ")),_("b",null,M(S.value),1)])]),_:1}),m(Ke,{modelValue:d.value,"onUpdate:modelValue":c[0]||(c[0]=k=>d.value=k)},{default:x(()=>[m(re,{name:"log",label:"Log"}),m(re,{name:"body",label:"Resumen"})]),_:1},8,["modelValue"]),m(lt,{modelValue:d.value,"onUpdate:modelValue":c[1]||(c[1]=k=>d.value=k),animated:""},{default:x(()=>[m(ue,{name:"log"},{default:x(()=>[c[5]||(c[5]=_("div",{class:"text-h6"},"Log",-1)),(V(!0),N(ae,null,Ae(y.value,(k,s)=>(V(),N("div",{key:s},[_("pre",null,M(k),1)]))),128))]),_:1}),m(ue,{name:"body"},{default:x(()=>[m(ve,{flat:"",rows:b.value,columns:r.value.cols,"row-key":"name",ref_key:"rowsproducts",ref:g},null,8,["rows","columns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):W("",!0),o.value?(V(),X(G,{key:1,class:"bg-negative"},{default:x(()=>[m(oe,null,{default:x(()=>[_("pre",vt,M(o.value),1)]),_:1})]),_:1})):W("",!0)],64))}},ft={class:"row items-center"},gt={key:0,class:"text-right"},Ot={__name:"CiclicosLayout",setup(t){const l=E(""),p=Ye(),v=De(),w=Qe(),e=ze(),o=E({state:!1,data:null}),d=E(null),g=E([]),r=E({cols:[{name:"id",field:"id",label:"Folio"},{name:"started",field:s=>$(s.created_at).format("YYYY/MM/DD HH:mm:ss"),label:"Creacion",align:"center"},{name:"status",field:s=>s.status.name,label:"Estado",align:"center"},{name:"ended",field:s=>{let i=s.log.find(T=>T.id==3);return i?$(i.pivot.created_at).format("YYYY/MM/DD HH:mm:ss"):"--"},align:"center",label:"Termino"},{name:"models",field:"products_count",label:"Modelos"},{name:"type",field:s=>s.type.name,label:"Tipo"},{name:"warehouse",field:s=>s.settings?s.settings.warehouse.name:"---",label:"Almacen"}]}),a=E([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"c",label:"otra ...",disable:!0}]),y=E({from:$(Date.now()).startOf("day"),to:$(Date.now()).endOf("day")}),n=C(()=>g.value.map(s=>(s.settings=JSON.parse(s.settings),s))),b=C(()=>l.value&&l.value.length),S=C(()=>y.value.from.format("YYYY/MM/DD")),A=C(()=>y.value.to.format("YYYY/MM/DD")),P=()=>{console.log("searching folio"),o.value.folio=l.value,o.value.state=!0},f=async(s,i,T)=>{o.value.folio=i.id,o.value.state=!0},c=async()=>{var Q;console.log(e.session),p.loading.show({message:"Cargado vista..."});let s=(Q=v.query.v)!=null?Q:"day",i=a.value.findIndex(R=>R.id==s),T=i>=0?i:0;console.log(T),d.value=a.value[T],y.value.from=$(Date.now()).startOf(d.value.id);const q=await me.index({dateranges:y,view:d.value,store:e.session.store.id_viz});console.log(q),g.value=q.inventories,p.loading.hide()},k=()=>{w.push(`/ciclicos?v=${d.value.id}`)};return c(),de(()=>v.query,()=>{c()}),(s,i)=>(V(),X(Fe,{view:"hHh Lpr fFf"},{default:x(()=>[m(ke,{class:"bg-grey-3 text-dark",bordered:""},{default:x(()=>[m(He),m(ee)]),_:1}),m(Oe,null,{default:x(()=>[m(Be,{class:"justify-between"},{default:x(()=>[_("div",null,[i[3]||(i[3]=_("span",{class:"text-grey"},"Helpers",-1)),i[4]||(i[4]=B()),m(Ve,{name:"navigate_next",color:"primary"}),i[5]||(i[5]=B()),i[6]||(i[6]=_("span",{class:"text-h6"},"Ciclicos",-1))]),_("div",ft,[m(qe,{modelValue:d.value,"onUpdate:modelValue":[i[0]||(i[0]=T=>d.value=T),k],options:a.value,label:"Vista",autofocus:"",borderless:""},{prepend:x(()=>[m(F,{dense:"",flat:"",color:"primary",icon:"autorenew",onClick:Me(c,["stop"])})]),_:1},8,["modelValue","options"]),m(F,{color:"primary",icon:"search",dense:"",flat:""},{default:x(()=>[m(Ie,null,{default:x(()=>[i[7]||(i[7]=_("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Inventario",-1)),m(ee),m(Ue,{dense:"",onSubmit:P,class:"q-gutter-md q-pa-md"},{default:x(()=>[m($e,{modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=T=>l.value=T),type:"number",label:"Folio",autofocus:""},null,8,["modelValue"]),b.value?(V(),N("div",gt,[m(F,{type:"submit",color:"primary",icon:"search"})])):W("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),m(Ne,{padding:""},{default:x(()=>[m(G,{class:"my-card",flat:""},{default:x(()=>[m(ve,{title:`Inventarios del ${S.value} al ${A.value} [ ${g.value.length} ]`,rows:n.value,columns:r.value.cols,"row-key":"id",onRowClick:f},null,8,["title","rows","columns"])]),_:1}),m(we,{modelValue:o.value.state,"onUpdate:modelValue":i[2]||(i[2]=T=>o.value.state=T),"full-width":""},{default:x(()=>[m(mt,{folio:o.value.folio,store:pe(e).session.store.id_viz},null,8,["folio","store"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Ot as default};
