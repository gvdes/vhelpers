import{u as q,r as m,c as N,o as D,g as S,e,w as n,f as s,a0 as f,E as A,b2 as W,aI as X,Q as g,a1 as B,a9 as Z,a6 as M,a5 as I,a3 as j,a as T,h as E,a_ as H}from"./index.976e3998.js";import{u as z,Q as V,a as u}from"./use-quasar.c265db13.js";import{Q as d,c as G}from"./QSeparator.7ec8c57d.js";import{Q as P}from"./QSlideTransition.5cd91a45.js";import{Q as h}from"./QPage.e2f3091e.js";import{Q as J}from"./QInput.c17e5c3f.js";import{Q as O,d as ee}from"./QSelect.21e80e71.js";import{Q as K}from"./QCardActions.1738e728.js";import{u as L}from"./VDB.37e8ee37.js";import"./jspdf.plugin.autotable.db0e0b5d.js";import{r as U}from"./refundsApi.a2008051.js";import"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{d as C}from"./dayjs.min.cbcf888d.js";import{Q as te}from"./QDate.4b736578.js";import{Q as se}from"./QTable.0638ceef.js";import{C as le}from"./ClosePopup.03538f37.js";import{p as oe}from"./Refund.d741c5f6.js";import"./QList.16c3b3bc.js";import"./QDrawer.36009e26.js";import"./axios.0d2bd0f9.js";import"./_commonjsHelpers.88e99c8f.js";import"./use-render-cache.3aae9b27.js";import"./date.9f4ab6fe.js";import"./QLinearProgress.6a05ebaa.js";import"./QCheckbox.9f37be86.js";import"./QResizeObserver.4208a21a.js";import"./QScrollObserver.0dd615d0.js";const ae={class:"text-bold text-centerz"},ne={class:"row"},ie=["onClick"],re={class:"col"},de={class:"text-bold"},ue={class:"col"},ce={class:"text-bold"},ve={class:"col"},fe={class:"text-bold"},me={class:"col"},pe={class:"text-bold"},_e={class:"col"},ye={class:"text-bold"},xe={class:"col"},be={class:"text-bold"},ge={class:"text-bold"},we={class:"text-bold"},Ve={class:"col"},ke={class:"text-bold"},De={class:"col"},Ce={class:"text-caption"},Qe={class:"text-bold"},F={__name:"ViewRefunds",props:{refunds:{type:Array,default:[]},status:{type:Array,default:[]}},setup(Q){const k=q(),r=L(),p=z(),c=m(null),v=m(null),_=m({state:!1,val:null}),x=Q,b=m({columns:[{name:"id",label:"ID",field:t=>t.id},{name:"reference",label:"REFERENCIA",field:t=>t.reference},{name:"destiny",label:"DESTINO",field:t=>t.storefrom.name},{name:"origin",label:"ORIGEN",field:t=>t.storeto.name},{name:"createby",label:"CREADO POR",field:t=>t.createdby.complete_name},{name:"date",label:"FECHA",field:t=>C(t.created_at).format("DD-MM-YYYY HH:mm:ss")},{name:"status",label:"Estado",field:t=>t.status}],filter:""}),w=N(()=>c.value&&!v.value?x.refunds.filter(t=>t.status.id==c.value.id):!c.value&&v.value?x.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==v.value):c.value&&v.value?x.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==v.value&&t.status.id==c.value.id):x.refunds),i=t=>{switch(t){case 1:return"red";case 2:return"yellow";case 3:return"blue";case 4:return"green"}},$=t=>{t.status.id==1&&t.storefrom.id==r.session.store.id?(console.log("terminar el que se esta creando"),k.push(`/refunds/${t.id}`)):t.status.id==1&&t.storeto.id==r.session.store.id?p.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storefrom.id==r.session.store.id?p.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storeto.id==r.session.store.id?(console.log("se va a recibir"),_.value.state=!0,_.value.val=t):t.status.id==4&&p.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"})},R=async t=>{p.loading.show({message:"Cambiando Estado"});let a={id:t.id,uid:r.session.id};const l=await U.nexState(a);l.fail?console.log(l):(k.push(`/refunds/verified/${t.id}`),p.loading.hide())},Y=t=>{console.log(t),oe.refund(t)};return(t,a)=>(D(),S(j,null,[e(se,{rows:w.value,grid:"",columns:b.value.columns,filter:b.value.filter},{"top-left":n(()=>[s("div",ae,f(v.value),1)]),"top-right":n(()=>[s("div",ne,[e(J,{class:"col",filled:"",dense:"",modelValue:b.value.filter,"onUpdate:modelValue":a[0]||(a[0]=l=>b.value.filter=l),placeholder:"Buscar"},{append:n(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{class:"col",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),options:Q.status,label:"Estado",dense:"",filled:"","option-label":"name"},W({_:2},[c.value?{name:"append",fn:n(()=>[e(A,{name:"cancel",onClick:a[1]||(a[1]=X(l=>c.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{color:"primary",flat:"",icon:"event"},{default:n(()=>[e(ee,null,{default:n(()=>[e(te,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=l=>v.value=l),landscape:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})])]),item:n(l=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:o=>$(l.row)},[e(V,{bordered:"",class:"text-center my-card"},{default:n(()=>[e(u,{class:"row",dense:""},{default:n(()=>[s("div",re,[a[6]||(a[6]=s("div",{class:"text-caption"},"ID",-1)),s("div",de,f(l.row.id),1)]),e(d,{vertical:""}),s("div",ue,[a[7]||(a[7]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",ce,f(l.row.reference),1)]),e(d,{vertical:""}),s("div",ve,[a[8]||(a[8]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",fe,f(B(C)(l.row.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:2},1024),e(d),e(u,{class:"row"},{default:n(()=>[s("div",me,[a[9]||(a[9]=s("div",{class:"text-caption"},"Origen",-1)),s("div",pe,f(l.row.storefrom.name),1)]),e(d,{vertical:""}),s("div",_e,[a[10]||(a[10]=s("div",{class:"text-caption"},"Destino",-1)),s("div",ye,f(l.row.storeto.name),1)])]),_:2},1024),e(d),e(u,{class:"row"},{default:n(()=>[s("div",xe,[a[11]||(a[11]=s("div",{class:"text-caption"},"Tipo",-1)),s("div",be,f(l.row.type.name),1)]),e(d,{vertical:""}),s("div",{class:Z(`col bg-${i(l.row.status.id)}`)},[a[12]||(a[12]=s("div",{class:"text-caption"},"Estado",-1)),s("div",ge,f(l.row.status.name),1)],2)]),_:2},1024),e(d),e(u,null,{default:n(()=>[a[13]||(a[13]=s("div",{class:"text-caption"},"Creado Por",-1)),s("div",we,f(l.row.createdby.complete_name),1)]),_:2},1024),e(u,{class:"row",onClick:o=>Y(l.row)},{default:n(()=>[s("div",Ve,[a[14]||(a[14]=s("div",{class:"text-caption"},"Devolucion",-1)),s("div",ke,f(l.row.fs_id),1)]),e(d,{vertical:""}),s("div",De,[s("div",Ce,f(l.row._type==1?"ABONO":"ENTRADA"),1),s("div",Qe,f(l.row._type==1?l.row.season_ticket:l.row.entry),1)])]),_:2},1032,["onClick"])]),_:2},1024)],8,ie)]),_:1},8,["rows","columns","filter"]),e(G,{modelValue:_.value.state,"onUpdate:modelValue":a[5]||(a[5]=l=>_.value.state=l),persistent:""},{default:n(()=>[e(V,null,{default:n(()=>[e(u,{class:"text-center text-bold text-h5"},{default:n(()=>a[15]||(a[15]=[M(" Quires recepcionar la devolucion ? ")])),_:1}),e(K,{align:"right"},{default:n(()=>[I(e(g,{flat:"",label:"Cancelar",color:"negative"},null,512),[[le]]),e(g,{flat:"",label:"Recibir",color:"positive",onClick:a[4]||(a[4]=l=>R(_.value.val))})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},$e={class:"row justify-between"},Re={class:"row"},Ye={key:0},Ee={class:"row"},Ne={class:"row"},nt={__name:"Index",setup(Q){const k=q(),r=L(),p=z(),c=m([]),v=m([]),_=m([]),x=m(null),b=m(!1),w=m(!1),i=m({state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:r.session.store.id,store_to:null,_created_by:r.session.id}),$=N(()=>i.value.type?i.value.type.id==1?_.value.filter(l=>l._type==1):_.value.filter(l=>l._type==2):_.value),R=N(()=>!(i.value.reference&&i.value.type&&i.value.provider)),Y=async()=>{p.loading.show({message:"Obteniendo Datos",type:"positive",position:"center"});let l=r.session.store.id;const o=await U.index(l);o.error?console.log(o):(console.log(o),c.value=o.types,_.value=o.provider,x.value=o.refunds,v.value=o.status,p.loading.hide())},t=async()=>{i.value={state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:r.session.store.id,store_to:null,_created_by:r.session.id}},a=async()=>{i.value.store_to=i.value.provider._store,console.log(i.value);const l=await U.addRefund(i.value);l.error?console.log(l):(console.log(l),p.notify({message:"Se creo correctamente la devolucion",type:"positive",position:"center"}),k.push(`/refunds/${l.id}`))};return r.session.rol=="aux"||r.session.rol=="gen"||r.session.rol=="aud"||r.session.rol=="root"||r.session.rol=="ref"?Y():(p.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),k.replace("/")),(l,o)=>(D(),S(j,null,[e(h,{padding:""},{default:n(()=>[e(V,null,{default:n(()=>[e(u,null,{default:n(()=>[s("div",$e,[s("div",null,[o[8]||(o[8]=M("Helpers ")),e(A,{name:"navigate_next",color:"primary"}),o[9]||(o[9]=M()),o[10]||(o[10]=s("span",{class:"text-h6"},"Devoluciones ",-1))]),s("div",Re,[B(r).session.store.id!=1?(D(),T(g,{key:0,color:"primary",icon:"add",flat:"",onClick:o[0]||(o[0]=y=>i.value.state=!i.value.state)})):E("",!0)])])]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),x.value?(D(),S("div",Ye,[e(V,{class:"my-card"},{default:n(()=>[e(u,{class:"text-center text-bold text-h6"},{default:n(()=>[s("div",Ee,[o[11]||(o[11]=s("div",{class:"col"},"Destino",-1)),e(g,{color:"grey",round:"",flat:"",dense:"",icon:b.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[1]||(o[1]=y=>b.value=!b.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:n(()=>[e(P,null,{default:n(()=>[I(s("div",null,[e(F,{refunds:x.value.to,status:v.value},null,8,["refunds","status"])],512),[[H,b.value]])]),_:1})]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),B(r).session.store.id!=1?(D(),T(V,{key:0,class:"my-card"},{default:n(()=>[e(u,{class:"text-center text-bold text-h6"},{default:n(()=>[s("div",Ne,[o[12]||(o[12]=s("div",{class:"col"},"Origen",-1)),e(g,{color:"grey",round:"",flat:"",dense:"",icon:w.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[2]||(o[2]=y=>w.value=!w.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:n(()=>[e(P,null,{default:n(()=>[I(s("div",null,[e(F,{refunds:x.value.from,status:v.value},null,8,["refunds","status"])],512),[[H,w.value]])]),_:1})]),_:1})]),_:1})):E("",!0)])):E("",!0)]),_:1}),e(G,{modelValue:i.value.state,"onUpdate:modelValue":o[7]||(o[7]=y=>i.value.state=y),persistent:""},{default:n(()=>[e(V,null,{default:n(()=>[e(u,null,{default:n(()=>o[13]||(o[13]=[s("span",{class:"text-center text-h6 text-bold"},"Nueva Devolucion",-1)])),_:1}),e(u,null,{default:n(()=>[e(J,{modelValue:i.value.reference,"onUpdate:modelValue":o[3]||(o[3]=y=>i.value.reference=y),type:"text",label:"Referencia",filled:"",dense:""},null,8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:i.value.type,"onUpdate:modelValue":[o[4]||(o[4]=y=>i.value.type=y),o[5]||(o[5]=()=>i.value.provider=null)],options:c.value,label:"Tipo",filled:"",dense:"","option-label":"name"},null,8,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:i.value.provider,"onUpdate:modelValue":o[6]||(o[6]=y=>i.value.provider=y),options:$.value,label:"Destino",filled:"",dense:"",disable:i.value.type==null,"option-label":"name"},null,8,["modelValue","options","disable"]),e(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(K,{align:"right"},{default:n(()=>[e(g,{flat:"",label:"Cancel",color:"primary",onClick:t}),e(g,{flat:"",label:"Enviar",color:"primary",onClick:a,disable:R.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{nt as default};
