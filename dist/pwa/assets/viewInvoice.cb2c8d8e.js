import{u as R,a as U,W as L,r as _,c as M,o as c,i as C,d as m,w as r,k as f,e as i,a3 as G,a0 as I,j as p,a4 as W,g as l,_ as v,a1 as y,Q as V,f as w,Y,$ as H,h as S,a2 as J}from"./index.4f1e6b8e.js";import{Q as K}from"./QToolbarTitle.a78b8cf9.js";import{Q as X}from"./QToolbar.42091542.js";import{Q as Z}from"./QTable.518e2186.js";import{Q as ee}from"./QFooter.5e6811b2.js";import{Q as te}from"./QPage.8631fb96.js";import{Q as ae}from"./QSelect.892f55ae.js";import{Q as oe}from"./QSpace.2504781a.js";import"./QList.a6fb43f5.js";import"./QExpansionItem.2b7b0a36.js";import"./QDrawer.4fdf7e95.js";import"./ClosePopup.6c60b3b0.js";import"./axios.5ba2e0bd.js";import{u as le}from"./use-quasar.cb4b6b35.js";import{P as ie}from"./ProductsAutocomplete.ac2ccb71.js";import{I as se}from"./invoices.b5da71f0.js";import"./dayjs.min.cbcf888d.js";import"./jspdf.plugin.autotable.0c37ef03.js";import{$sktRestock as N}from"./socket.168d2ba4.js";import{i as g}from"./invoicesApi.c6921971.js";import"./QForm.a86eaa06.js";import"./QBadge.5f188fcb.js";import"./Restock.24075bd4.js";import"./QBtnGroup.ab89a603.js";import"./QLinearProgress.f72e9ab7.js";import"./QResizeObserver.8e6a85ba.js";import"./QScrollObserver.47f50e70.js";/* empty css                                                                         */import"./browser.c61f550a.js";import"./JsBarcode.cb858474.js";import"./_commonjsHelpers.88e99c8f.js";import"./QTd.488807ac.js";import"./QPopupEdit.89287566.js";import"./QTr.03e6e578.js";import"./QLayout.794374f0.js";import"./exceljs.min.9e24d01d.js";/* empty css                                                       */const ne={class:"col"},de={class:"col"},ue={class:"col text-right"},re={class:"row q-ml-sm"},ve={class:"row justify-between"},ce={class:"text-left"},pe={class:"text--3"},me={class:"text-h6"},fe={class:"text-right"},_e={class:"text-bold"},ge={class:"text--2"},he={class:"text-center"},ke={class:"text-h6"},ye={class:"text-h6"},be={class:"text--2"},xe={class:"row items-start justify-between"},we={class:"text-center col text-primary"},Qe={class:"text-center col"},Ce={class:"text-center col"},De={class:"text-center col"},Pe={class:"text-bold"},ct={__name:"viewInvoice",setup(Ie){const q=R(),s=le(),h=U(),b=L(),d=_(null),u=_([]),n=_({val:{id:1,label:"Pieza"},opts:[{id:1,label:"Pieza"},{id:2,label:"Docena"},{id:3,label:"Caja"}]}),e=_({state:!1,val:null,edit:!1}),D=_({toDelivered:1,_supply_by:1,units:1,cost:0,total:0,comments:"",stock:0,ipack:0}),P=_({pagination:{rowsPerPage:0},columns:[{name:"code",label:"CODIGO",field:a=>a.code,align:"left"},{name:"description",label:"DESCRIPCION",field:a=>a.description,align:"left"},{name:"amount_delivered",label:"CANTIDAD",field:a=>a.pivot.units,align:"center"}]}),k=M(()=>{var a,t;return((a=n.value.val)==null?void 0:a.id)==3?e.value.val.pivot.toDelivered*e.value.val.pivot.ipack:((t=n.value.val)==null?void 0:t.id)==2?e.value.val.pivot.toDelivered*12:e.value.val.pivot.toDelivered}),B=async()=>{s.loading.show({message:"Obeteniendo Datos"});const a=await g.getInvoice(b.params.inv);a.fail?a.fail.status==401?(h.push("/distribute/invoice"),s.notify({message:"La factura ya se realizo",type:"negative",position:"center"}),s.loading.hide()):(a.fail.status=404)?(h.push("/distribute/invoice"),s.notify({message:"No existe la Factura",type:"negative",position:"center"}),s.loading.hide()):console.log(a):(console.log(a),d.value=a,u.value=a.products,s.loading.hide())},F=a=>{console.log(a);let t=u.value.findIndex(o=>o.id==a.id);console.log(t),t>=0?(e.value.val=u.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(o=>o.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=a,e.value.val.pivot=D.value,e.value.val.pivot.ipack=a.pieces,e.value.state=!0)},$=a=>{console.log(a);let t=u.value.findIndex(o=>o.id==a.id);console.log(t),t>=0?(e.value.val=u.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(o=>o.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=a,e.value.val.pivot=D.value,e.value.val.pivot.ipack=a.pieces,e.value.state=!0)},A=async()=>{s.loading.show({message:"Creando Factura"}),console.log(d.value);const a=await g.changestate(d.value);a.fail?console.log(a):(console.log(a),N.emit("order_refresh",{order:a.requisitiion}),N.emit("orderpartition_refresh",{order:a.partition}),se.invoiceFormat(a.partition),T(a.partition))},T=async a=>{const t=await g.addInvoiceFS(a);t.fail?t.fail.status==503?(s.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide()):console.log(t):(s.notify({message:`Salida Creada ${t}`,type:"positive",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide())},x=()=>{e.value={state:!1,val:null,edit:!1}},j=async()=>{s.loading.show({message:"Insertando Producto"});let a={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(o=>o.id==q.session.store.id_viz).pivot.gen,amount:1,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};const t=await g.addProduct(a);t.fail?console.log(t):(s.loading.hide(),u.value.push(t)),x()},z=async()=>{s.loading.show({message:"Eliminando Producto"}),console.log(e.value);let a={_requisition:b.params.inv,_product:e.value.val.id};console.log(a);const t=await g.deleteProduct(a);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let o=u.value.findIndex(Q=>Q.id==a._product);u.value.splice(o,1)}x()},E=async()=>{s.loading.show({message:"Editando Producto"}),console.log(e.value);let a={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(o=>o.id==1).pivot.gen,amount:0,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};console.log(a);const t=await g.editProduct(a);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let o=u.value.findIndex(Q=>Q.id==a.id);console.log(e.value.val),u.value.splice(o,1,t)}x()},O=(a,t)=>{console.log(t),e.value.val=t,n.value.val=n.value.opts.find(o=>o.id==t.pivot._supply_by),e.value.state=!0,e.value.edit=!0};return B(),(a,t)=>(c(),C(I,null,[d.value?(c(),m(te,{key:0,padding:""},{default:r(()=>[i(X,{class:"bg-primary text-white"},{default:r(()=>[i(p,{flat:"",round:"",dense:"",icon:"arrow_back ",onClick:t[0]||(t[0]=o=>W(h).push("/distribute/invoice"))}),i(K,{class:"row"},{default:r(()=>[l("div",ne,"Origen : "+v(d.value.to.name),1),l("div",de,"Destino : "+v(d.value.from.name),1),l("div",ue,v(d.value.created_by.nick),1)]),_:1}),i(p,{flat:"",round:"",dense:"",icon:"download",class:"q-mr-xs"}),i(p,{flat:"",round:"",dense:"",icon:"upload"})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),u.value.length>0?(c(),m(Z,{key:0,rows:u.value,"hide-bottom":"",columns:P.value.columns,pagination:P.value.pagination,onRowClick:O},null,8,["rows","columns","pagination"])):f("",!0),i(ee,{reveal:"",elevated:"",bordered:""},{default:r(()=>[i(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",re,[i(V,{class:"col"},{default:r(()=>[i(ie,{checkState:!1,onInput:F,with_prices_Invoice:"",with_stock:"",onAgregar:$,with_locations:""})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",null,[u.value.length>0?(c(),m(p,{key:0,flat:"",icon:"send",onClick:A})):f("",!0)])]),i(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})):f("",!0),i(G,{modelValue:e.value.state,"onUpdate:modelValue":t[4]||(t[4]=o=>e.value.state=o),position:"bottom"},{default:r(()=>[e.value.val?(c(),m(V,{key:0},{default:r(()=>[i(w,{class:""},{default:r(()=>[l("div",ve,[l("div",ce,[l("div",pe,"ID: "+v(e.value.val.id),1),l("div",me,v(e.value.val.code),1)]),l("div",fe,[l("div",_e,v(e.value.val.name),1),l("div",ge,v(e.value.val.barcode),1)])])]),_:1}),i(y),i(w,null,{default:r(()=>[Y(v(e.value.val.description),1)]),_:1}),i(w,{class:"row justify-around items-center"},{default:r(()=>[l("div",he,[l("div",ke,v(e.value.val.pieces),1),t[5]||(t[5]=l("div",{class:"text--2"},"PxC",-1))]),(c(!0),C(I,null,H(e.value.val.stocks,o=>(c(),C("div",{key:o.id,class:"text-center"},[l("div",ye,v(o.pivot.gen),1),l("div",be,v(o.alias),1)]))),128))]),_:1}),i(w,null,{default:r(()=>[l("div",xe,[l("div",we,[i(ae,{modelValue:n.value.val,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.val=o),options:n.value.opts,label:"Unidad Medida",filled:"",dense:""},null,8,["modelValue","options"])]),l("div",Qe,[t[6]||(t[6]=l("div",null,"Conteo",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.toDelivered,"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.val.pivot.toDelivered=o),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter"},null,8,["modelValue"])]),l("div",Ce,[t[7]||(t[7]=l("div",null,"PxC",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.ipack,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.val.pivot.ipack=o),type:"number","input-class":"text-h6 text-center",disable:n.value.val.id!=3},null,8,["modelValue","disable"])]),l("div",De,[t[8]||(t[8]=l("div",null,"Piezas",-1)),l("div",Pe,v(k.value),1)])])]),_:1}),i(J,null,{default:r(()=>[i(p,{flat:"",icon:"close",onClick:x}),i(oe),e.value.edit?f("",!0):(c(),m(p,{key:0,flat:"",icon:"add",color:"positive",onClick:j})),e.value.edit?(c(),m(p,{key:1,flat:"",icon:"delete",color:"negative",onClick:z})):f("",!0),e.value.edit?(c(),m(p,{key:2,flat:"",icon:"edit",color:"warning",onClick:E})):f("",!0)]),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"])],64))}};export{ct as default};
