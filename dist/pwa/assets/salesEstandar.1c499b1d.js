import{Q as $e}from"./QToolbarTitle.a31de346.js";import{Q as j,a as ae,d as ue}from"./QSelect.4c45b4c7.js";import{Q as Ee}from"./QToggle.cfc9a99a.js";import{d as K,e as W,b as T,a as de,Q as J}from"./QList.39020a9d.js";import{a as D,Q as q,p as Qe}from"./axios.b21a6f11.js";import{b3 as Le,u as Y,r as V,c as Q,m as oe,o as x,g as I,d as S,w as i,e as t,Q as k,b4 as se,ak as G,b5 as Te,f as s,a0 as w,a as be,aH as ye,a3 as Be,a2 as Ie,an as re,h as C,t as xe,aF as Ue,aG as qe,n as Oe,a1 as ce,a4 as pe,A as Z}from"./index.f266ad19.js";import{Q as O}from"./QInput.460a9556.js";import{Q as Re}from"./QToolbar.01317418.js";import{Q as le}from"./QTable.db201f63.js";import{Q as X}from"./QCardActions.21981229.js";import{Q as ve}from"./QForm.5bc9b4d3.js";import{Q as je}from"./QFooter.179cb714.js";import{Q as ze}from"./QPage.716be7e0.js";import{C as me}from"./ClosePopup.9a2e3d96.js";import{u as Me,c as fe}from"./cashApi.55c18726.js";import"./QDrawer.f5e8dcdb.js";import{u as H}from"./use-quasar.233baf72.js";import{p as ge}from"./productsApi.817452ae.js";import{Q as Ke}from"./QSpace.76ee0000.js";import{R}from"./resoursesOrder.c789112d.js";import{Q as Ge}from"./QCheckbox.07881102.js";import{o as Je}from"./orderApi.6493efde.js";import{s as Ze}from"./saleLocalApi.0afad7ca.js";import"./QLinearProgress.f1844fce.js";import"./QResizeObserver.64997b12.js";import"./QScrollObserver.5c7b8f4a.js";const We={class:"QuickRegular row items-center"},Xe={class:"row items-center justify-between no-wrap QuickRegular"},Ye={class:"col"},He={class:"text-grey-4 q-pl-md"},et={class:"text--2 text-grey-5"},tt={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]}},emits:["input","similarcodes","agregar"],setup(g,{expose:B,emit:v}){const n=H(),A=Y(),h=g,F=v,e=V({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),m=V(null),_=Q(()=>({autocomplete:e.value.target,limit:h.limit,_workpoint:A.session.store.id_viz,strict:e.value.read_barcode}));Q(()=>o=>h.checkState?h.blockStates.some(d=>d==o.state.id):!1),oe(()=>{e.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let o=JSON.parse(localStorage.getItem("typeiptsearch"));o&&(e.value.iptsearch.type=o.type,e.value.iptsearch.icon=o.icon)});const f=()=>{e.value.read_barcode=!e.value.read_barcode,e.value.target="",localStorage.setItem("barcodereader",e.value.read_barcode)},r=(o,d,c)=>{console.log(_.value),o.trim().length>1&&(e.value.target=o.toUpperCase().trim(),console.log(e.value.target),ge.autocomplete(_.value).then(P=>{console.log(P);let z=P.data.map(E=>{if(h.checkState)if(h.wkpToVal){let M=E.stocks.find(ee=>ee._workpoint==h.wkpToVal);E.stateToVal=M?{own:M,state:M.status}:{own:null,state:E.status}}else E.stateToVal={own:!0,state:E.status};else E.stateToVal={own:!0,state:E.status};return E});d(()=>{e.value.options=z},E=>{E.setOptionIndex(-1),E.moveOptionSelection(1,!0)})}).catch(P=>{console.log(P)}))},$=()=>{switch(e.value.iptsearch.type){case"text":e.value.iptsearch.type="number",e.value.iptsearch.icon="fas fa-font";break;case"number":e.value.iptsearch.type="text",e.value.iptsearch.icon="fas fa-hashtag";break}localStorage.setItem("typeiptsearch",JSON.stringify(e.value.iptsearch))},L=o=>{e.value.target="",F("input",o)},y=()=>{e.value.target.trim().toUpperCase(),e.value.target.length&&(e.value.iptsearch.processing=!0,console.log(_.value),ge.autocomplete(_.value).then(o=>{let d=o.data;switch(Object.keys(d).length){case 0:let c=e.value.target;n.notify({message:`Sin resultados para <b>${c}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),p();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(d),L(d);break}e.value.target="",e.value.iptsearch.processing=!1}).catch(o=>{console.log(o)}))},p=()=>{console.log("putFocus ejecutada!!"),m.value.focus()};B({focus:()=>{var o,d;return(d=(o=m.value)==null?void 0:o.focus)==null?void 0:d.call(o)}});const b=o=>{F("agregar",o)};return(o,d)=>(x(),I("div",We,[e.value.read_barcode?(x(),S(O,{key:0,ref_key:"iptatc",ref:m,loading:e.value.iptsearch.processing,disable:e.value.iptsearch.processing,modelValue:e.value.target,"onUpdate:modelValue":d[1]||(d[1]=c=>e.value.target=c),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:se(y,["enter"]),autocomplete:"off",autofocus:""},{prepend:i(()=>[t(k,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:d[0]||(d[0]=c=>f())},null,8,["color","icon"])]),_:1},8,["loading","disable","modelValue"])):(x(),S(j,{key:1,dense:"",filled:"",color:"blue-13",class:"text-uppercase col",ref_key:"iptatc",ref:m,"use-input":"","hide-dropdown-icon":"","option-value":"id","option-label":"id","hide-selected":"",behavior:"menu",modelValue:e.value.target,"onUpdate:modelValue":d[3]||(d[3]=c=>e.value.target=c),"input-debounce":400,autofocus:"",options:e.value.options,type:e.value.iptsearch.type,onFilter:r,"popup-content-class":"bg-darkl1"},{"no-option":i(()=>[t(K,null,{default:i(()=>[t(W,{class:"text-grey QuickRegular"},{default:i(()=>d[4]||(d[4]=[G("Nada por aqui...")])),_:1})]),_:1})]),prepend:i(()=>[t(k,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:d[2]||(d[2]=c=>f())},null,8,["color","icon"]),t(k,{type:"button",dense:"",size:"sm",flat:"",onClick:$,icon:e.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:i(c=>[t(K,Te(c.itemProps,{onClick:P=>b(c.opt)}),{default:i(()=>[t(W,null,{default:i(()=>[s("div",Xe,[s("div",Ye,[s("div",null,[G(w(c.opt.code)+" ",1),s("span",He,w(c.opt.name),1)]),s("div",et,w(c.opt.description),1)])])]),_:2},1024)]),_:2},1040,["onClick"])]),_:1},8,["modelValue","options","type"]))]))}};var lt=Le(tt,[["__scopeId","data-v-35342126"]]);const at={class:"row"},ot={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},st={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},it={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},nt={class:"row"},ut={class:"text-h6 col text-bold text-left"},dt={class:"text-h6 col text-bold text-right"},rt={class:"text-subtitle2 col"},ct={class:"text-center"},pt={class:"q-pa-xs"},vt={class:"row items-center justify-center q-gutter-md"},mt={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(g,{emit:B}){Y();const v=H();be(),ye();const n=g,A=B,h=Q(()=>!n.product.pivot.amountDelivered||n.product.pivot.amountDelivered<=0),F=Q(()=>n.product.pivot.amountDelivered),e=Q(()=>n._price_list<=3?[1,2,3,4]:[n._price_list]),m=Q(()=>n._price_list<=3?R.verificarPrecioCaja(n.products,n.product,n.rules)?4:R.verificarPrecioDocena(n.products,n.product,n.rules)?3:R.verificarPrecioMayoreo(n.products,n.product,n.rules)?2:1:n._price_list),_=()=>{A("reset")},f=async()=>{v.loading.show({message:"Editando Producto"});let L=n.product.prices.find(p=>p.id==m.value).pivot.price,y=F.value*L;n.product.pivot.toDelivered=F.value,n.product.pivot._price_list=m.value,n.product.pivot.price=L,n.product.pivot.total=y,v.loading.hide(),_(),R.actualizarPreciosProductosSales(n.products,n._price_list,n.rules),A("editProduct")},r=async()=>{(!n.product.pivot.amountDelivered||n.product.pivot.amountDelivered<1)&&(n.product.pivot.amountDelivered=1),v.loading.show({message:"Agregando producto"});let L=n.product.prices.find(p=>p.id==m.value).pivot.price,y=F.value*L;n.product.pivot.toDelivered=F.value,n.product.pivot._price_list=m.value,n.product.pivot.price=L,n.product.pivot.total=y,n.product.pivot._product=n.product.id,console.log(n.product),A("addProduct",n.product),v.loading.hide(),R.actualizarPreciosProductosSales(n.products,n._price_list,n.rules)},$=async()=>{v.loading.show({message:"Eliminando Producto"}),A("deleteProduct",n.product),v.loading.hide(),R.actualizarPreciosProductosSales(n.products,n._price_list,n.rules)};return(L,y)=>(x(),S(q,null,{default:i(()=>[t(D,{class:"item-center"},{default:i(()=>[s("div",at,[s("div",ot,w(g.product.category.familia.seccion.name),1),s("div",st,w(g.product.category.familia.name),1),s("div",it,w(g.product.category.name),1)])]),_:1}),t(D,{class:"item-center"},{default:i(()=>[s("div",nt,[s("div",ut,w(g.product.code),1),s("div",dt,w(g.product.name),1)]),s("div",rt,w(g.product.description),1)]),_:1}),t(D,{class:"item-center row"},{default:i(()=>[(x(!0),I(Be,null,Ie(g.product.prices.filter(p=>e.value.includes(p.id)),(p,b)=>(x(),I("div",{class:"col text-subtitle2 text-center",key:b},[s("div",{class:re(p.id==m.value?"text-weight-bold":"text-caption text-strike")},w(p.alias),3),t(T,{spaced:"",inset:"",vertical:"",dark:""}),s("div",{class:re(p.id==m.value?"text-bold  text-blue-13":"text-caption")},w(p.pivot.price),3),t(T,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),t(D,null,{default:i(()=>[s("div",ct,[s("div",pt,[y[6]||(y[6]=s("div",{class:"text-bold text-h6"},"Cantidad:",-1)),s("div",vt,[t(k,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:y[0]||(y[0]=p=>g.product.pivot.amountDelivered>1?g.product.pivot.amountDelivered--:"")}),t(O,{modelValue:g.product.pivot.amountDelivered,"onUpdate:modelValue":[y[1]||(y[1]=p=>g.product.pivot.amountDelivered=p),y[4]||(y[4]=p=>{p?p<1?g.product.pivot.amountDelivered=1:Number.isInteger(p)||(g.product.pivot.amountDelivered=Math.floor(p)):g.product.pivot.amountDelivered=1})],modelModifiers:{number:!0},type:"number",outlined:"",min:"1",step:"1","input-class":"text-center text-h3",style:{width:"100px"},autofocus:"",onKeydown:y[2]||(y[2]=se(p=>g.edit?f():r(),["enter"])),onKeypress:y[3]||(y[3]=p=>(p.key==="."||p.key==="-")&&p.preventDefault())},null,8,["modelValue"]),t(k,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:y[5]||(y[5]=p=>g.product.pivot.amountDelivered++)})])])])]),_:1}),t(X,null,{default:i(()=>[t(k,{flat:"",icon:"close",onClick:_}),t(Ke),g.edit?C("",!0):(x(),S(k,{key:0,flat:"",icon:"add",color:"positive",onClick:r,disable:h.value},null,8,["disable"])),g.edit?(x(),S(k,{key:1,flat:"",icon:"delete",color:"negative",onClick:$})):C("",!0),g.edit?(x(),S(k,{key:2,flat:"",icon:"edit",color:"warning",onClick:f,disable:h.value},null,8,["disable"])):C("",!0)]),_:1})]),_:1}))}},ft={class:"bg-primary row items-center justify-between q-pa-md text-white"},gt={class:"text-right"},bt={class:"fw-bold text-h4"},yt={class:"row text-center items-center"},xt={class:"col"},_t={class:"row text-center items-center"},ht={class:"col"},kt={class:"col"},wt={class:"row flex justify-center"},Pt={class:"col flex justify-center"},Vt={key:0,class:"col"},At={key:0,class:"row flex justify-center text-center"},Ct={class:"col"},Dt={class:"col"},St={class:"row flex justify-center"},Ft={class:"col flex justify-center"},Nt={key:0,class:"col"},$t={class:"row"},Et={class:"text-h5"},Qt={key:0,class:"text-center"},Lt={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(g,{emit:B}){Y();const v=H(),n=V({dafpa:!1,vales:!1}),A=g,h=B,F=V({opts:[]}),e=V({PFPA:{id:A.paymeths[1],val:Math.round(A.total)},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),m=Q(()=>(Number(Number.parseFloat(e.value.SFPA.val)+Number.parseFloat(e.value.PFPA.val))+Number.parseFloat(e.value.VALE.val)-Number.parseFloat(A.total)).toFixed(2)),_=Q(()=>{var b,o,d;return m.value>=0&&(((b=e.value.PFPA.id)==null?void 0:b.id)&&e.value.PFPA.val>0||((o=e.value.SFPA.id)==null?void 0:o.id)&&e.value.SFPA.val>0||((d=e.value.VALE.id)==null?void 0:d.id)&&e.value.VALE.val>0)}),f=Q(()=>{const b=Object.values(e.value);if(b.some(P=>P.id&&P.id.alias==="EFE"&&P.val>0))return!1;const d=b.some(P=>P.id&&P.id.alias!=="EFE"),c=b.reduce((P,z)=>P+Number(z.val||0),0);return d&&c>A.total}),r=b=>{var o;return b.id==((o=e.value.SFPA.id)==null?void 0:o.id)},$=b=>{var o;return b.id==((o=e.value.PFPA.id)==null?void 0:o.id)},L=async()=>{v.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let o=`http://192.168.10.160:1619/access/public/modify/vales?price=${A.client}`;Qe.get(o).then(d=>{console.log(d.data),v.loading.hide();let c=d.data.map(P=>({id:{id:5,alias:"[V]",name:"VALE",code:P.CODANT},val:Number(P.IMPANT)}));F.value.opts=c,n.value.vales=!0}).catch(d=>{console.log(d.response.data),v.notify({html:!0,message:d.response.data,color:"negative",position:"bottom"}),v.loading.hide()})},y=b=>{b.key==="Enter"&&_.value&&(b.preventDefault(),p())},p=()=>{e.value.conditions.super=f.value,e.value.change=m.value,h("sendTicket",e.value),F.value=V({opts:[]}),e.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return oe(()=>{window.addEventListener("keydown",y)}),xe(()=>{window.removeEventListener("keydown",y)}),(b,o)=>(x(),S(q,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:i(()=>[s("div",ft,[o[11]||(o[11]=s("div",null,[s("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),s("div",gt,[o[10]||(o[10]=s("div",{class:"fs-dec3"},"Total Actual",-1)),s("div",bt,"$ "+w(Number(g.total).toFixed(2)),1)])]),t(D,null,{default:i(()=>{var d;return[s("div",yt,[o[12]||(o[12]=s("div",{class:"col"}," Forma de pago: ",-1)),s("div",xt,[t(j,{class:"col-3",modelValue:e.value.PFPA.id,"onUpdate:modelValue":o[0]||(o[0]=c=>e.value.PFPA.id=c),options:g.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":c=>r(c)},null,8,["modelValue","options","option-disable"])])]),t(T,{spaced:"",inset:"",vertical:"",dark:""}),s("div",_t,[s("div",ht,w(((d=e.value.PFPA.id)==null?void 0:d.id)==2?"Efectivo":"Importe Cobrado"),1),s("div",kt,[t(O,{class:"col",modelValue:e.value.PFPA.val,"onUpdate:modelValue":o[2]||(o[2]=c=>e.value.PFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(e.value.PFPA.val)?(x(),S(k,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:o[1]||(o[1]=c=>e.value.PFPA.val=0)})):C("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),t(D,null,{default:i(()=>{var d;return[s("div",wt,[s("div",Pt,[t(k,{color:"primary",label:"2\xAA Forma de pago",onClick:o[3]||(o[3]=()=>{n.value.dafpa=!n.value.dafpa,e.value.SFPA.val=0,e.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),n.value.dafpa?(x(),I("div",Vt,[t(j,{class:"col-3",modelValue:e.value.SFPA.id,"onUpdate:modelValue":o[4]||(o[4]=c=>e.value.SFPA.id=c),options:g.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":c=>$(c)},null,8,["modelValue","options","option-disable"])])):C("",!0)]),t(T,{spaced:"",inset:"",vertical:"",dark:""}),n.value.dafpa?(x(),I("div",At,[s("div",Ct,w(((d=e.value.SFPA.id)==null?void 0:d.id)==2?"Efectivo":"Importe Cobrado"),1),s("div",Dt,[t(O,{class:"col",modelValue:e.value.SFPA.val,"onUpdate:modelValue":o[6]||(o[6]=c=>e.value.SFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(e.value.SFPA.val)?(x(),S(k,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:o[5]||(o[5]=c=>e.value.SFPA.val=0)})):C("",!0)]),_:1},8,["modelValue"])])])):C("",!0)]}),_:1}),t(D,null,{default:i(()=>[s("div",St,[s("div",Ft,[t(k,{color:"primary",label:"Cobrar Vale",onClick:L,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),n.value.vales?(x(),I("div",Nt,[s("div",$t,[t(j,{class:"col",modelValue:e.value.VALE,"onUpdate:modelValue":o[7]||(o[7]=d=>e.value.VALE=d),options:F.value.opts,label:"Vale","option-label":d=>`Vale : ${d.id?d.id.code:""}`,dense:"",filled:""},{option:i(d=>[t(K,Ue(qe(d.itemProps)),{default:i(()=>[t(W,null,{default:i(()=>[t(ae,null,{default:i(()=>[G(w(d.opt.id.code),1)]),_:2},1024),t(ae,{caption:""},{default:i(()=>[G("$ "+w(Number(d.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),t(T,{spaced:"",inset:"",vertical:"",dark:""}),e.value.VALE.id?(x(),S(O,{key:0,modelValue:e.value.VALE.val,"onUpdate:modelValue":o[8]||(o[8]=d=>e.value.VALE.val=d),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):C("",!0)])])):C("",!0)])]),_:1}),f.value?(x(),S(D,{key:0,class:"flex justify-end"},{default:i(()=>[t(Ge,{modelValue:e.value.conditions.createWithdrawal,"onUpdate:modelValue":o[9]||(o[9]=d=>e.value.conditions.createWithdrawal=d),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):C("",!0),t(X,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:i(()=>[s("div",null,[o[13]||(o[13]=s("div",{class:"fs-dec3"},"Cambio",-1)),s("div",Et," $ "+w(m.value),1)]),_.value?(x(),I("div",Qt,[t(k,{color:"primary",icon:"payment",label:"Pagar",onClick:p})])):C("",!0)]),_:1})]),_:1}))}},Tt={class:"row items-center justify-between"},Bt={class:"col"},It={class:"col"},Ut={class:"col"},qt={class:"text-caption text-center"},Ot={class:"text-center text-h6"},Rt={key:0,class:"col"},jt={class:"text-center text-h6 text-caption"},zt={key:1,class:"col"},Mt={class:"text-center text-h6"},Kt={class:"col"},Gt={class:"text-center text-h6"},_l={__name:"salesEstandar",setup(g){const B=Y(),v=H();be(),ye();const n=Me();V(null);const A=V(null),h=V({val:{id:1,label:"Preventa",type:"number"},opts:[{id:1,label:"Preventa",type:"number"}],valueVal:null}),F=V({amount:0,amountDelivered:1,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),e=V({name:"IVA",option:!1,optval:[16,8,6],value:0,amount:0}),m=V({val:null,opts:[]}),_=V({val:null,opts:[]}),f=V({state:!1,val:null,edit:!1}),r=V({client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:B.session.credentials.staff,products:[]}),$=V(!1),L=V({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"verify",label:"Cantidad",field:l=>l.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:l=>l.pivot.price,align:"center"},{name:"bruto",label:e.option?"Bruto":"Total",field:l=>l.pivot.total,align:"center"},{name:"iva",label:"Total",field:l=>l.pivot.total,align:"center"},{name:"neto",label:"Total",field:l=>l.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),y=V({columns:[{name:"id",label:"Codigo",field:l=>l.id,align:"left"},{name:"Nombre",label:"Descripcion",field:l=>l.name,align:"left"},{name:"Telefono",label:"Pedido",field:l=>l.celphone,align:"center"}],pagination:{rowsPerPage:0}}),p=V({columns:[{name:"id",label:"Codigo",field:l=>l.id,align:"left"},{name:"Nombre",label:"Descripcion",field:l=>l.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),b=Q(()=>Number(r.value.products.reduce((l,a)=>l+a.pivot.total,0)).toFixed(2)),o=Q(()=>r.value.products.reduce((l,a)=>l+Number(a.pivot.toDelivered),0)),d=Q(()=>r.value.products.length>0&&r.value.dependiente&&r.value.client),c=Q(()=>[{name:"code",label:"Codigo",field:a=>a.code,align:"left"},{name:"description",label:"Descripcion",field:a=>a.description,align:"left"},,{name:"verify",label:"Verificado",field:a=>a.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:a=>a.pivot.price,align:"center"},{name:"bruto",label:e.value.option?"Subtotal":"Total",field:a=>a.pivot.total,format:a=>`$ ${a.toFixed(2)}`,align:"center"}]),P=l=>{if(console.log(l),l.prices.map(u=>u.pivot.price).includes(0))v.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let u=r.value.products.findIndex(N=>N.id==l.id);u>=0?(f.value.val=r.value.products[u],f.value.state=!0,f.value.edit=!0):(l.pivot=F.value,f.value.val=l,f.value.state=!0,f.value.edit=!1)}},z=l=>{if(console.log(l),l.prices.map(u=>u.pivot.price).includes(0))v.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let u=r.value.products.findIndex(N=>N.id==l.id);u>=0?(f.value.val=r.value.products[u],f.value.state=!0,f.value.edit=!0):(l.pivot=F.value,f.value.val=l,f.value.state=!0,f.value.edit=!1)}},E=(l,a)=>{console.log(a),f.value.val=a,f.value.edit=!0,f.value.state=!0},M=()=>{console.log("cambio de cliente"),m.value.state=!0},ee=async()=>{if(m.value.val){const l=await Je.getClient(m.value);l.fail?console.log(l):l.length>0?(console.log(l),m.value.opts=l):v.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(l)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},_e=async(l,a)=>{v.loading.show({message:"Recalculando Ticket"}),r.value.client=a,R.actualizarPreciosProductosSales(r.value.products,a._price_list,n.rules),m.value={state:!1,val:null,opts:[]},v.loading.hide()},he=()=>{console.log("cambio de cliente"),_.value.state=!0},ke=async()=>{if(_.value.val){let l={val:_.value.val,sto:B.session.store.id};const a=await fe.getDependiente(l);a.fail?console.log(a):a.length>0?(console.log(a),_.value.opts=a):v.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(a)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},we=(l,a)=>{r.value.dependiente=a,_.value={state:!1,val:null,opts:[]},v.loading.hide()},Pe=l=>{r.value.products.push(l),te(),Z(()=>{var a;(a=A.value)==null||a.focus()})},Ve=()=>{Z(()=>{var l;(l=A.value)==null||l.focus()})},Ae=l=>{let a=r.value.products.findIndex(u=>u.id==l.id);a>=0&&(r.value.products.splice(a,1),te()),Z(()=>{var u;(u=A.value)==null||u.focus()})},Ce=async l=>{v.loading.show({message:"Realizando Ticket"}),r.value.payments=l,r.value.change=l.conditions.super?0:l.change,e.value.option?(r.value.subtotal=r.value.products.reduce((N,U)=>N+U.pivot.total,0),r.value.iva=e.value.value,r.value.total=Number(b.value*Number(1+e.value.value/100).toFixed(2)),r.value.impuesto=Number(b.value*Number(e.value.value/100)).toFixed(2)):r.value.total=r.value.products.reduce((N,U)=>N+U.pivot.total,0);let a={order:r.value,cashier:n.cash,config:e.value};console.log(a);const u=await Ze.addSale(a);if(console.log(u),u.fail)console.log(u);else{console.log(u),$.value=!1;let N={client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:r.value.dependiente,products:[]};r.value=N,e.value.value=0,e.value.option=!1,v.loading.hide()}},te=()=>{f.value={state:!1,val:null,edit:!1},F.value={amount:0,amountDelivered:null,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},Z(()=>{var l;(l=A.value)==null||l.focus()})},De=async()=>{switch(console.log(h.value),h.value.val.id){case 1:Se(h.value);break}},Se=async l=>{if(console.log(l),l){v.loading.show({message:"Obteniendo Orden"});let a={uid:B.session.credentials.staff.id_va,oid:l.valueVal};const u=await fe.getOrderCash(a);u.fail?u.fail.status==401?(console.log(u),v.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),l.value=null,v.loading.hide()):u.fail.status==404?(console.log(u),v.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),l.value=null,v.loading.hide()):console.log(u):(r.value.order=l.valueVal,r.value.dependiente=u.staff,r.value.client=u.client,u.products.forEach(N=>{var ne;console.log(N);const U=r.value.products.find(Ne=>Ne.id===N.id),Fe=((ne=N.pivot)==null?void 0:ne.units)||0;U?(U.pivot||(U.pivot={units:0}),U.pivot.units+=Fe):r.value.products.push({...N})}),h.value.valueVal=null,console.log(u),v.loading.hide())}},ie=l=>{l.ctrlKey&&l.key.toLowerCase()==="b"?(l.preventDefault(),m.value.state||(m.value.state=!0)):l.ctrlKey&&l.key.toLowerCase()==="d"?(l.preventDefault(),_.value.state||(_.value.state=!0)):l.altKey&&l.key==="Enter"&&d.value&&(l.preventDefault(),$.value||($.value=!0))};return Oe(()=>r.value,l=>{localStorage.setItem("current_sale",JSON.stringify(l))},{deep:!0}),oe(()=>{const l=localStorage.getItem("current_sale");l&&(r.value=JSON.parse(l)),window.addEventListener("keydown",ie)}),xe(()=>{window.removeEventListener("keydown",ie)}),(l,a)=>(x(),S(ze,null,{default:i(()=>[t(Re,{class:""},{default:i(()=>[t($e),t(k,{flat:"",round:"",dense:"",icon:"settings",class:"q-mr-xs"},{default:i(()=>[t(ue,{style:{width:"200px"}},{default:i(()=>[t(q,{class:"my-card"},{default:i(()=>[t(D,null,{default:i(()=>[t(de,{dense:""},{default:i(()=>[t(K,{class:"q-px-sm q-py-xs column"},{default:i(()=>[s("div",Tt,[t(ae,null,{default:i(()=>[G(w(e.value.name),1)]),_:1}),t(Ee,{color:"blue",modelValue:e.value.option,"onUpdate:modelValue":[a[0]||(a[0]=u=>e.value.option=u),a[1]||(a[1]=u=>{u?e.value.value=16:e.value.value=0})]},null,8,["modelValue"])]),e.value.option?(x(),S(j,{key:0,modelValue:e.value.value,"onUpdate:modelValue":a[2]||(a[2]=u=>e.value.value=u),options:e.value.optval,label:"Porcentaje",filled:"",dense:"","emit-value":"","map-options":"",class:"q-mt-sm"},null,8,["modelValue","options"])):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(k,{flat:"",round:"",dense:"",icon:"receipt_long"},{default:i(()=>[t(ue,null,{default:i(()=>[t(de,{style:{"min-width":"100px"}},{default:i(()=>[t(K,null,{default:i(()=>[t(W,null,{default:i(()=>[t(j,{modelValue:h.value.val,"onUpdate:modelValue":a[3]||(a[3]=u=>h.value.val=u),options:h.value.opts,label:"Tipo",filled:"",dense:""},null,8,["modelValue","options"]),t(T,{spaced:"",inset:"",vertical:"",dark:""}),t(O,{modelValue:h.value.valueVal,"onUpdate:modelValue":a[4]||(a[4]=u=>h.value.valueVal=u),type:h.value.val.type,dense:"",filled:"",label:h.value.val.label,onKeyup:se(De,["enter"])},null,8,["modelValue","type","label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(q,{class:"my-card"},{default:i(()=>[t(D,{class:"row"},{default:i(()=>[s("div",Bt,[a[12]||(a[12]=s("div",{class:"text-caption text-center"},"Dependiente",-1)),t(k,{class:"full-width",flat:"",label:r.value.dependiente?r.value.dependiente.complete_name:"CTRL+d",onClick:he},null,8,["label"])]),t(T,{spaced:"",inset:"",vertical:"",dark:""}),s("div",It,[a[13]||(a[13]=s("div",{class:"text-caption text-center"},"Cliente",-1)),t(k,{class:"full-width",flat:"",label:r.value.client?r.value.client.name:"CTRL+b",onClick:M},null,8,["label"])])]),_:1})]),_:1}),t(T,{spaced:"",inset:"",vertical:"",dark:""}),t(q,{class:"my-card"},{default:i(()=>[t(D,{class:"row"},{default:i(()=>[s("div",Ut,[s("div",qt,w(e.value.option?"SUBTOTAL":"TOTAL"),1),s("div",Ot,"$ "+w(b.value),1)]),e.value.option?(x(),I("div",Rt,[a[14]||(a[14]=s("div",{class:"text-caption text-center"}," IVA ",-1)),s("div",jt,"$ "+w(Number(b.value*Number(e.value.value/100)).toFixed(2)),1)])):C("",!0),e.value.option?(x(),I("div",zt,[a[15]||(a[15]=s("div",{class:"text-caption text-center"}," TOTAL ",-1)),s("div",Mt,"$ "+w(Number(b.value*Number(1+e.value.value/100)).toFixed(2)),1)])):C("",!0),s("div",Kt,[a[16]||(a[16]=s("div",{class:"text-caption text-center"},"Cantidad",-1)),s("div",Gt,w(o.value),1)])]),_:1})]),_:1}),t(T,{spaced:"",inset:"",vertical:"",dark:""}),t(le,{rows:r.value.products,columns:c.value,"hide-bottom":"",pagination:L.value.pagination,onRowClick:E},null,8,["rows","columns","pagination"]),t(J,{modelValue:f.value.state,"onUpdate:modelValue":a[5]||(a[5]=u=>f.value.state=u),persistent:"",position:"bottom"},{default:i(()=>[t(mt,{product:f.value.val,_price_list:m.value.val?m.value.val._price_list:1,edit:f.value.edit,onReset:te,products:r.value.products,rules:ce(n).rules,onAddProduct:Pe,onDeleteProduct:Ae,onEditProduct:Ve},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),t(J,{modelValue:m.value.state,"onUpdate:modelValue":a[7]||(a[7]=u=>m.value.state=u)},{default:i(()=>[t(q,{style:{width:"700px"}},{default:i(()=>[t(ve,{onSubmit:ee},{default:i(()=>[a[17]||(a[17]=s("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),a[18]||(a[18]=s("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),t(D,null,{default:i(()=>[t(T,{spaced:"",inset:"",vertical:"",dark:""}),s("div",null,[t(O,{autofocus:"",modelValue:m.value.val,"onUpdate:modelValue":a[6]||(a[6]=u=>m.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),m.value.opts.length>0?(x(),S(D,{key:0},{default:i(()=>[t(le,{rows:m.value.opts,columns:y.value.columns,pagination:y.value.pagination,onRowClick:_e},null,8,["rows","columns","pagination"])]),_:1})):C("",!0),t(X,{align:"right"},{default:i(()=>[pe(t(k,{flat:"",label:"Cancelar",color:"primary"},null,512),[[me]]),t(k,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(J,{modelValue:_.value.state,"onUpdate:modelValue":a[9]||(a[9]=u=>_.value.state=u)},{default:i(()=>[t(q,{style:{width:"700px"}},{default:i(()=>[t(ve,{onSubmit:ke},{default:i(()=>[a[19]||(a[19]=s("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),a[20]||(a[20]=s("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),t(D,null,{default:i(()=>[t(T,{spaced:"",inset:"",vertical:"",dark:""}),s("div",null,[t(O,{autofocus:"",modelValue:_.value.val,"onUpdate:modelValue":a[8]||(a[8]=u=>_.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),_.value.opts.length>0?(x(),S(D,{key:0},{default:i(()=>[t(le,{rows:_.value.opts,columns:p.value.columns,pagination:p.value.pagination,onRowClick:we},null,8,["rows","columns","pagination"])]),_:1})):C("",!0),t(X,{align:"right"},{default:i(()=>[pe(t(k,{flat:"",label:"Cancelar",color:"primary"},null,512),[[me]]),t(k,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s("div",null,[t(J,{modelValue:$.value,"onUpdate:modelValue":a[10]||(a[10]=u=>$.value=u)},{default:i(()=>[t(Lt,{total:e.value.option?Number(b.value*Number.parseFloat(1+e.value.value/100)):Number(b.value),paymeths:ce(n).methods,client:r.value.client.id,onSendTicket:Ce},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),t(je,{bordered:"",class:"bg-white"},{default:i(()=>[t(q,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:i(()=>[t(D,{class:"row"},{default:i(()=>[t(lt,{ref_key:"productRef",ref:A,class:"col",checkState:!1,onInput:z,onAgregar:P},null,512),d.value?(x(),S(k,{key:0,color:"primary",flat:"",icon:"east",onClick:a[11]||(a[11]=u=>$.value=!$.value),round:""})):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{_l as default};
