import{h as Y,a as Z,d as U,e as E,b as y}from"./QList.c5925261.js";import{i as ee,b7 as F,r as w,c as C,l as z,p as te,j as k,S as T,k as ae,Q as P,t as oe,b8 as le,v as ne,u as W,K as se,o as b,g as h,e as a,w as n,a3 as G,a2 as J,d as L,f as s,b5 as ie,ak as $,a0 as m,h as B,n as re,a as ce,aH as ue,U as de}from"./index.1caea72c.js";import{Q as me}from"./QToolbar.934f2598.js";import{Q as fe}from"./QHeader.a75cd3a9.js";import{Q as q}from"./QCardSection.e7ec6c6e.js";import{Q as M}from"./QTd.ec2d11eb.js";import{Q as ve}from"./QTr.8b167a68.js";import{Q as pe}from"./QTable.12d1f84c.js";import{Q as N}from"./QCard.c7bbc0b0.js";import{Q as _e}from"./QFooter.965ec8fb.js";import{Q as be}from"./QPage.b53b15b6.js";import{Q as ge,a as he}from"./QLayout.5d2bfff3.js";import{Q as we}from"./QBtnGroup.0d2eba0f.js";import{d as xe,Q as ye}from"./QSelect.f9196b14.js";import{l as ke}from"./use-key-composition.2156c461.js";import{Q as Qe}from"./QInput.1e2dc3e6.js";import{Q as Se}from"./QForm.3c7e1f82.js";import{p as I}from"./productsApi.f68af11f.js";import{u as K}from"./use-quasar.2a5547a4.js";import{H as Ce}from"./html5-qrcode-scanner.64619f17.js";import{_ as Be}from"./UserToolbar.db44fbf8.js";import"./QResizeObserver.cbcc886d.js";import"./QLinearProgress.478806cb.js";import"./QCheckbox.5473f73d.js";import"./QScrollObserver.83cb7307.js";import"./axios.d0e85866.js";import"./_commonjsHelpers.88e99c8f.js";import"./QDrawer.25422a8a.js";import"./QCardActions.70d330c5.js";import"./ClosePopup.f2176256.js";import"./auth.973a5dad.js";const qe=Object.keys(F);function Pe(e){return qe.reduce((f,l)=>{const v=e[l];return v!==void 0&&(f[l]=v),f},{})}var Ae=ee({name:"QBtnDropdown",props:{...F,...Y,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:f,emit:l}){const{proxy:v}=oe(),g=w(e.modelValue),c=w(null),p=ke(),i=C(()=>{const t={"aria-expanded":g.value===!0?"true":"false","aria-haspopup":"true","aria-controls":p.value,"aria-label":e.toggleAriaLabel||v.$q.lang.label[g.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(t["aria-disabled"]="true"),t}),d=C(()=>"q-btn-dropdown__arrow"+(g.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),o=C(()=>le(e)),x=C(()=>Pe(e));z(()=>e.modelValue,t=>{c.value!==null&&c.value[t?"show":"hide"]()}),z(()=>e.split,r);function D(t){g.value=!0,l("beforeShow",t)}function H(t){l("show",t),l("update:modelValue",!0)}function O(t){g.value=!1,l("beforeHide",t)}function A(t){l("hide",t),l("update:modelValue",!1)}function Q(t){l("click",t)}function S(t){ne(t),r(),l("click",t)}function R(t){c.value!==null&&c.value.toggle(t)}function u(t){c.value!==null&&c.value.show(t)}function r(t){c.value!==null&&c.value.hide(t)}return Object.assign(v,{show:u,hide:r,toggle:R}),te(()=>{e.modelValue===!0&&u()}),()=>{const t=[k(T,{class:d.value,name:e.dropdownIcon||v.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&t.push(k(xe,{ref:c,id:p.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:D,onShow:H,onBeforeHide:O,onHide:A},f.default)),e.split===!1?k(P,{class:"q-btn-dropdown q-btn-dropdown--simple",...x.value,...i.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:Q},{default:()=>ae(f.label,[]).concat(t),loading:f.loading}):k(we,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...o.value,glossy:e.glossy,stretch:e.stretch},()=>[k(P,{class:"q-btn-dropdown--current",...x.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:S},{default:f.label,loading:f.loading}),k(P,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...i.value,...o.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>t)])}}});const Ve={class:"QuickRegular row items-center text-black"},$e={class:"col"},Ie={key:0},De={class:"row items-center justify-between no-wrap QuickRegular"},He={class:"col"},Oe={class:"text-grey-4 q-pl-md"},Re={class:"text--2 text-grey-5"},Me={key:1},Le={key:2,class:"flex flex-center q-pa-md"},Ne={key:0},Te={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},with_locations:{default:null,type:Boolean},with_image:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},with_prices_Invoice:{default:null,type:Boolean},with_stock:{default:null,type:Boolean}},emits:["input","similarcodes","agregar"],setup(e,{emit:f}){K();const l=W(),v=e,g=f;let c=null;const p=w(!1),i=w(!1),d=w({val:{id:1,label:"Autocomplete",icon:"keyboard"},opts:[{id:1,label:"Autocomplete",icon:"keyboard"},{id:2,label:"barcode",icon:"fas fa-barcode"},{id:3,label:"qr_code",icon:"qr_code"}]}),o=w({buscar:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),x=C(()=>({search:o.value.buscar,with_locations:v.with_locations,with_stock:v.with_stock,with_prices:v.with_prices,limit:v.limit,_workpoint:l.session.store.id_viz,rol:l.session.credentials.rol})),D=()=>{switch(o.value.iptsearch.type){case"text":o.value.iptsearch.type="number",o.value.iptsearch.icon="fas fa-font";break;case"number":o.value.iptsearch.type="text",o.value.iptsearch.icon="fas fa-hashtag";break}},H=async(u,r,t)=>{let _=u.trim().toUpperCase();if(_.length>=3){o.value.buscar=_,console.log(x.value);const V=await I.autoCompleteProduct(x.value);if(V.fail)console.log(V);else{console.log(V);let X=V;r(()=>{o.value.options=X},j=>{j.setOptionIndex(-1),j.moveOptionSelection(1,!0)})}}},O=async()=>{if(o.value.buscar.trim().toUpperCase(),o.value.buscar.length){const u=await I.exactSearch(x.value);u.fail?console.log(u):(console.log(u),S(u))}},A=async()=>{if(p.value=!0,c){console.log("La c\xE1mara ya est\xE1 activa");return}re(()=>{c=new Ce("reader");const u={fps:10,qrbox:r=>{const _=Math.floor(r*.8);return{width:_,height:_}}};c.start({facingMode:"environment"},u,async r=>{if(!i.value){i.value=!0;try{const t=JSON.parse(r);if(console.log(t),t.modelo){o.value.buscar=t.modelo;const _=await I.scanSearch(x.value);_.fail?console.log(_):(console.log(_),Q(),S(_))}}catch{console.log("QR inv\xE1lido: "+r)}finally{i.value=!1}}}).catch(r=>console.log("Error al iniciar c\xE1mara: "+r.message)),console.log("C\xE1mara iniciada")})},Q=()=>{if(!c){console.log("La c\xE1mara no estaba activa");return}c.stop().then(()=>{c.clear(),c=null,p.value=!1,console.log("C\xE1mara detenida")}).catch(u=>console.log("Error al detener c\xE1mara: "+u.message))},S=u=>{o.value.buscar="",g("input",u)},R=(u,r)=>{o.value.buscar="",o.value.options=void 0,u.id==3?A():Q()};return se(()=>{Q()}),(u,r)=>(b(),h("div",Ve,[a(Ae,{color:"primary",dense:"",flat:"",icon:d.value.val.icon},{default:n(()=>[a(Z,null,{default:n(()=>[(b(!0),h(G,null,J(d.value.opts,t=>(b(),L(U,{key:t.id,clickable:"",onClick:_=>{d.value.val=t,R(t)}},{default:n(()=>[a(E,{avatar:""},{default:n(()=>[a(T,{name:t.icon},null,8,["name"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["icon"]),s("div",$e,[d.value.val.id==1?(b(),h("div",Ie,[a(ye,{modelValue:o.value.buscar,"onUpdate:modelValue":r[0]||(r[0]=t=>o.value.buscar=t),"hide-selected":"",behavior:"menu",options:o.value.options,filled:"","hide-dropdown-icon":"","use-input":"",class:"text-uppercase","input-class":"text-h6 text-bold",onFilter:H,"input-debounce":400,autofocus:""},{prepend:n(()=>[a(P,{size:"md",flat:"",padding:"none",onClick:D,icon:o.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:n(t=>[a(U,ie(t.itemProps,{onClick:_=>S(t.opt)}),{default:n(()=>[a(E,null,{default:n(()=>[s("div",De,[s("div",He,[s("div",null,[$(m(t.opt.code)+" ",1),s("span",Oe,m(t.opt.name),1)]),s("div",Re,m(t.opt.description),1)])])]),_:2},1024)]),_:2},1040,["onClick"])]),_:1},8,["modelValue","options"])])):B("",!0),d.value.val.id==2?(b(),h("div",Me,[a(Se,{onSubmit:O,class:"q-gutter-md"},{default:n(()=>[a(Qe,{modelValue:o.value.buscar,"onUpdate:modelValue":r[1]||(r[1]=t=>o.value.buscar=t),type:"text",filled:"",class:"text-uppercase","input-class":"text-h6 text-bold",autofocus:""},null,8,["modelValue"])]),_:1})])):B("",!0),d.value.val.id==3?(b(),h("div",Le,[a(N,{class:"camera-card"},{default:n(()=>[a(q,{class:"flex flex-center"},{default:n(()=>[r[2]||(r[2]=s("div",{id:"reader",class:"qr-reader"},null,-1)),p.value?B("",!0):(b(),h("div",Ne,[a(P,{color:"primary",flat:"",icon:"refresh",label:"Buscar",onClick:A})]))]),_:1})]),_:1})])):B("",!0)])]))}};const je={class:"col"},Ue={class:"row justify-center"},Ee={class:"row"},ze={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},Fe={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},We={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},Ge={class:"row"},Je={class:"text-h6 col text-bold text-left"},Ke={class:"col text-bold text-center"},Xe={class:"text-h6 col text-bold text-right"},Ye={class:"text-subtitle2 col"},Ze={class:"text-weight-bold"},et={class:"text-bold text-blue-13"},tt={class:"row q-ml-sm"},It={__name:"getProduct",setup(e){W();const f=K();ce(),ue();const l=w(null),v=w({columns:[{name:"anio",label:"A\xD1O",field:"year",align:"center"},{name:"sales",label:"COMPRAS",field:"compras",align:"center"},{name:"purchases",label:"VENTAS",field:"ventas",align:"center"}]}),g=p=>{console.log(p),c(p.id)},c=async p=>{f.loading.show({message:"Obteniendo Datos"}),l.value=null,console.log(p);const i=await I.getProduct(p);i.fail?console.log(i):(f.loading.hide(),console.log(i),i.prices.push({id:8,alias:"COS",pivot:{price:i.cost}}),i.prices.sort((d,o)=>o.id-d.id),l.value=i)};return(p,i)=>(b(),L(ge,{view:"hHh Lpr fFf"},{default:n(()=>[a(fe,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[a(Be),a(y),a(me,{class:"justify-between row"},{default:n(()=>[s("div",je,[i[0]||(i[0]=s("span",{class:"text-grey"},"Helpers",-1)),a(T,{name:"navigate_next",color:"primary"}),i[1]||(i[1]=s("span",{class:"text-h6"},"Informaci\xF3n Producto",-1))])]),_:1})]),_:1}),a(he,null,{default:n(()=>[a(be,{padding:""},{default:n(()=>[s("div",Ue,[a(de,{name:"bounce"},{default:n(()=>[l.value?(b(),L(N,{key:0,class:"my-card"},{default:n(()=>[a(q,{class:"item-center"},{default:n(()=>[s("div",Ee,[s("div",ze,m(l.value.category.familia.seccion.name),1),s("div",Fe,m(l.value.category.familia.name),1),s("div",We,m(l.value.category.name),1)])]),_:1}),a(q,{class:"item-center"},{default:n(()=>[s("div",Ge,[s("div",Je,m(l.value.code),1),s("div",Ke,[i[2]||(i[2]=s("div",{class:"text-caption"},"Stock",-1)),s("div",null,m(l.value.total_stock),1)]),s("div",Xe,m(l.value.name),1)]),s("div",Ye,m(l.value.description),1)]),_:1}),a(q,{class:"item-center row"},{default:n(()=>[(b(!0),h(G,null,J(l.value.prices,(d,o)=>(b(),h("div",{class:"col text-subtitle2 text-center",key:o},[s("div",Ze,m(d.alias),1),a(y,{spaced:"",inset:"",vertical:"",dark:""}),s("div",et,m(d.pivot.price),1),a(y,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),a(q,null,{default:n(()=>[a(pe,{rows:l.value.details,hideBottom:"",columns:v.value.columns,pagination:{rowsPerPage:0}},{"bottom-row":n(()=>[a(ve,{class:"text-bold bg-yellow-12"},{default:n(()=>[a(M,{class:"text-center"},{default:n(()=>i[3]||(i[3]=[$(" Total ")])),_:1}),a(M,{class:"text-center"},{default:n(()=>[$(m(l.value.details.reduce((d,o)=>d+Number(o.compras),0)),1)]),_:1}),a(M,{class:"text-center"},{default:n(()=>[$(m(l.value.details.reduce((d,o)=>d+Number(o.ventas),0)),1)]),_:1})]),_:1})]),_:1},8,["rows","columns"])]),_:1})]),_:1})):B("",!0)]),_:1})]),a(_e,{reveal:"",elevated:"",bordered:""},{default:n(()=>[a(y,{spaced:"",inset:"",vertical:"",dark:""}),s("div",tt,[a(N,{class:"col"},{default:n(()=>[a(Te,{checkState:!1,onInput:g,with_prices_Invoice:"",with_stock:"",with_locations:""})]),_:1}),a(y,{spaced:"",inset:"",vertical:"",dark:""})]),a(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{It as default};
