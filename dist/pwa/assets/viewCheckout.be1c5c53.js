import{Q as Qe}from"./QToolbarTitle.6a22d416.js";import{Q as T}from"./QSpace.a04903ed.js";import{aH as Ve,a as Se,u as qe,r as p,c as g,o as f,g as V,e as l,w as a,d as S,h as D,a3 as F,f as o,ak as d,a0 as r,a1 as De,Q as x,I as O,a2 as Y,aI as Pe,al as ae,a4 as J,b4 as Ue,n as Ee,am as se}from"./index.d8738e7e.js";import{Q as Ie}from"./QToolbar.6453ea61.js";import{b as N,a as ie,Q as W,d as ne,e as z}from"./QList.163028b2.js";import{Q as P}from"./QInput.376ee5eb.js";import{d as re,Q as je,a as A}from"./QSelect.a8294c94.js";import{Q as de}from"./QToggle.1fd82f94.js";import{Q as ue}from"./QTable.64caf586.js";import{Q as y}from"./QCardSection.36fdbee8.js";import{Q as $e}from"./QForm.0fe87949.js";import{Q as X}from"./QCard.09026410.js";import{Q as Re}from"./QCardActions.98f14609.js";import{Q as Be}from"./QPage.68dbbe12.js";import{Q as ce}from"./QFooter.9f4c0928.js";import{C as Te}from"./ClosePopup.268a7d9d.js";import{I as pe}from"./invoices.435668d6.js";import"./dayjs.min.cbcf888d.js";import{R as U}from"./RestockApi.7c71f10c.js";import{i as ve}from"./invoicesApi.8f78ddad.js";import{$sktRestock as _}from"./socket.3fae67a0.js";import{u as Fe}from"./Restock.054bcf3e.js";import{u as Ne}from"./use-quasar.3982aa41.js";import"./QCheckbox.2efc1484.js";import"./QLinearProgress.b3f074c7.js";import"./QResizeObserver.474ff4eb.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.1225e021.js";import"./_commonjsHelpers.88e99c8f.js";import"./JsBarcode.cb858474.js";import"./axios.b29075d4.js";import"./QRadio.d73a5240.js";import"./QTd.6f17c6d2.js";import"./QPopupEdit.686b4f87.js";import"./QTr.6c018029.js";import"./QLayout.67e57603.js";import"./QScrollObserver.442ee01c.js";import"./QDrawer.8185b1ee.js";import"./exceljs.min.9e24d01d.js";/* empty css                                                       */const ze={bordered:"",class:"bg-cyan-10 text-white"},Ae={class:"q-px-md q-py-sm"},Le={class:"col row justify-between"},Me={class:"col row justify-between"},Ge={key:0,class:"row items-center justify-between q-pt-sm"},Ke={class:"row"},He={class:"col"},Oe={class:"full-width row items-center justify-between"},Ye={class:"col"},Je={class:"full-width row items-center justify-between"},We={class:"row justify-between"},Xe={class:"text-left"},Ze={class:"text--3"},et={class:"text-h6"},tt={class:"text-right"},ot={class:"text-bold"},lt={class:"text--2"},at={class:"text-center"},st={class:"text-h6"},it={class:"text-h6"},nt={class:"text--2"},rt={class:"row items-start justify-between"},dt={class:"text-center col text-primary"},ut={class:"text-bold"},ct={class:"text-center col"},pt={class:"text-center col"},vt={class:"text-center col"},mt={class:"text-bold"},ft={class:"q-ml-sm"},bt={class:"q-ml-sm"},gt={class:"q-pa-md text-bold text-uppercase text-center"},so={__name:"viewCheckout",setup(yt){const E=Ve(),I=Se(),u=Ne(),me=Fe(),fe=qe(),j=p({val:"GEN",opts:["GEN","EMP"]});_.on("blockButton",()=>{u.notify({message:"Se esta generando otra salida",type:"positive",position:"top"}),q.value.state=!1,$.value=!0}),_.on("unblockButton",()=>{u.notify({message:"Se termino de generar la otra salida",type:"negative",position:"top"}),$.value=!1});const $=p(!1);p(null);const C=p(["code","assocs","ipack","request","uspply","delivery","reqinpzs","checkout","stocks"]),w=p([]),k=p(""),L=p(null),Z=p(null),M=p(null),v=p({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:t=>t.variants.length?t.variants.map(e=>e.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:t=>t.locations.length?t.locations.map(e=>e.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"ipack",label:"PxC",field:t=>typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:t=>t.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:t=>t.pivot._supply_by==3?"Cajas":t.pivot._supply_by==2?"Docenas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Conteo",field:t=>t.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:t=>t.pivot._supply_by==3?(typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces)*(typeof t.pivot.ipack=="number"?t.pivot.toDelivered:t.pivot.amount):typeof t.pivot.ipack=="number"?t.pivot.toDelivered:t.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:t=>t.pivot.checkout?"OK":null,classes:t=>t.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"},{name:"stocks",label:"Stock (pzs)",field:t=>t.stocks.reduce((e,n)=>e+n.pivot.stock,0),sortable:!0,classes:t=>t.stocks.reduce((e,n)=>e+n.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:10}}),s=p({state:!1,item:null,form:{count:0,ipack:null,setting:!1}});p({val:null,opts:null});const c=p([]),R=p({state:!1,code:null,text:null}),q=p({state:!1}),G=g(()=>w.value),ee=g(()=>c.value?c.value._status==5:!1),be=g(()=>G.value.reduce((t,e)=>t+(e.pivot._supply_by==3?e.pivot.amount*e.pieces:e.pivot.amount),0)),K=g(()=>G.value.filter(t=>!t.pivot.checkout)),h=g(()=>G.value.filter(t=>t.pivot.checkout)),ge=g(()=>h.value.filter(t=>t.pivot.toDelivered==0)),ye=g(()=>h.value.filter(t=>t.pivot.toDelivered>0)),B=g(()=>{let t=k.value.toUpperCase().trim();return t.length?K.value.filter(e=>e.code.match(t)||e.barcode&&e.barcode.match(t)||e.variants.some(n=>n.barcode.toUpperCase().includes(t))):K.value}),ke=g(()=>{let t=k.value.toUpperCase().trim();return t.length?h.value.filter(e=>e.code.match(t)||e.barcode&&e.barcode.match(t)||e.variants.some(n=>n.barcode.toUpperCase().includes(t))):h.value}),te=async()=>{me.setShowLYT(!1),u.loading.show({message:"Cargando..."}),console.log("Iniciando...");const t=await U.partition(E.params.chk);console.log(t),t.status==200?(w.value=t.data.order.products,M.value=t.data.order.status,c.value=t.data.order,u.loading.hide()):displayErrRequest(t)},oe=(t,e,n)=>ee.value?le(e):null,le=t=>{console.log(t),s.value.item=t,s.value.form.count=typeof t.pivot.toDelivered=="number"?t.pivot.toDelivered:0,s.value.form.ipack=typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces,s.value.state=!0,Ee(()=>{L.value.focus(),L.value.select()})},xe=()=>{let t=k.value.toUpperCase().trim();if(t.length){let e=B.value.length==1?B.value[0]:B.value.find(n=>n.code==t||n.barcode==t||n.variants.some(m=>m.barcode.toUpperCase().includes(t)));e?le(e):u.notify({message:`Sin coincidencias para <b>${t}</b>`,color:"pink-5",position:"center",html:!0})}},_e=async()=>{const t=parseInt(s.value.form.count),e=parseInt(s.value.form.ipack),n={order:E.params.chk,product:s.value.item.id,delivery:t,ipack:e,checkout:!0};console.log(n);const m=await U.setDeliveryProduct(n);if(console.log(m),m.status==200){console.log(m.data);let b=w.value.findIndex(i=>i.id==s.value.item.id);w.value[b].pivot.toDelivered=t,w.value[b].pivot.ipack=e,w.value[b].pivot.checkout=1,s.value.state=!1,k.value="",u.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${m.status}: ${m.data}`)},we=async()=>{_.emit("blockButton",c.value),u.loading.show({message:"Terminando, espera..."}),console.log(c.value.requisition._workpoint_from),q.value.state=!1;let t={partition:E.params.chk,verified:fe.session.credentials.staff.id,warehouse:j.value.val,state:6};console.log(t),console.log("... por acasito");let e=await U.SaveVerified(t);if(console.log(e),e.status==200){if(e.data.partitionsEnd>e.data.partition.requisition._status){let m={id:e.data.partition._requisition,state:e.data.partitionsEnd};const b=await U.nextState(m);_.emit("order_refresh",{order:b.data}),console.log(b.data)}c.value._status=e.data.partition._status,c.value.status.name=e.data.partition.status.name;const n=await U.partitionFresh(e.data.partition.id);n.status==200?(_.emit("orderpartition_refresh",{order:n.data.order}),c.value.requisition.from._type!=1?(await he(n.data.order),pe.invoiceFormat(n.data.order)):(await Ce(n.data.order),pe.transferFormat(n.data.order))):alert(`Error ${n.status}: ${n.data}`)}else console.log(e);_.emit("unblockButton",c.value.requisition)},he=async t=>{u.loading.show({message:"Realizando Salida"});const e=await ve.addInvoiceFS(t);console.log(e),e.fail?(console.log(e),e.fail.status==503?(u.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),I.push("/distribute/checkout"),u.loading.hide()):(console.log(e),alert(e))):(u.notify({message:`Salida Creada ${e.invoice}`,type:"positive",position:"bottom"}),_.emit("orderpartition_refresh",{order:e}),I.push("/distribute/checkout"),u.loading.hide())},Ce=async t=>{u.loading.show({message:"Realizando Salida"});const e=await ve.addTransferFS(t);e.fail?e.fail.status==503?(u.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),I.push("/distribute/checkout"),u.loading.hide()):(console.log(e),alert(e)):(u.notify({message:`Traspaso Creado ${e.invoice}`,type:"positive",position:"bottom"}),_.emit("orderpartition_refresh",{order:e}),I.push("/distribute/checkout"),u.loading.hide())};return te(),(t,e)=>(f(),V(F,null,[l(Be,null,{default:a(()=>{var n,m,b;return[o("div",ze,[l(Ie,null,{default:a(()=>{var i;return[l(Qe,null,{default:a(()=>[d(" Pedido "+r(De(E).params.chk),1)]),_:1}),e[14]||(e[14]=o("div",{class:"text-bold"},"Origen : ",-1)),d(r((i=c.value.requisition)==null?void 0:i.to.name)+" ",1),l(T),l(x,{color:"white",icon:"sync",onClick:te,round:"",dense:"",flat:""})]}),_:1}),l(N),o("div",Ae,[o("div",Le,[e[15]||(e[15]=o("div",{class:"text-bold"},"Surtidor :",-1)),d(" "+r((n=c.value)==null?void 0:n._suplier)+" ",1),l(T),e[16]||(e[16]=o("div",{class:"text-bold"},"Notas :",-1)),d(" "+r((m=c.value.requisition)==null?void 0:m.notes)+" ",1),l(T),e[17]||(e[17]=o("div",{class:"text-bold"},"Destino :",-1)),d(" "+r((b=c.value.requisition)==null?void 0:b.from.name)+" ",1),l(T),e[18]||(e[18]=o("div",{class:"text-bold"},"Pedido :",-1)),d(" "+r(c.value._requisition),1)]),l(N,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Me,[o("div",null,[e[19]||(e[19]=d("Productos: ")),o("b",null,r(w.value.length),1)]),o("div",null,[e[20]||(e[20]=d("Piezas: ")),o("b",null,r(be.value),1)])]),M.value&&M.value.id>=3?(f(),V("div",Ge,[o("div",null,[e[21]||(e[21]=o("span",{class:"text--2"},"Agotados:",-1)),e[22]||(e[22]=d()),o("b",null,r(ge.value.length),1)]),o("div",null,[e[23]||(e[23]=o("span",{class:"text--2"},"Con stock:",-1)),e[24]||(e[24]=d()),o("b",null,r(ye.value.length),1)]),o("div",null,[e[25]||(e[25]=o("span",{class:"text--2"},"Por revisar:",-1)),e[26]||(e[26]=d()),o("b",null,r(K.value.length),1)]),o("div",null,[e[27]||(e[27]=o("span",{class:"text--2"},"Revisados:",-1)),e[28]||(e[28]=d()),o("b",null,r(h.value.length),1)]),o("div",null,[e[29]||(e[29]=o("span",{class:"text--2"},"Cajas Contadas:",-1)),e[30]||(e[30]=d()),o("b",null,r(h.value.reduce((i,Q)=>i+(Q.pivot._supply_by==3?Q.pivot.toDelivered:1),0)),1)])])):D("",!0)])]),o("div",Ke,[o("div",He,[e[31]||(e[31]=o("div",{class:"text-h6"},"Productos sin revisar",-1)),l(ue,{"row-key":"id",flat:"",rows:B.value,columns:v.value.columns,pagination:v.value.pagination,filter:v.value.filter,"visible-columns":C.value,onRowClick:oe},{top:a(()=>[o("div",Oe,[l(P,{dense:"",modelValue:v.value.filter,"onUpdate:modelValue":e[0]||(e[0]=i=>v.value.filter=i),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:a(()=>[l(O,{name:"search"})]),_:1},8,["modelValue"]),l(x,{color:"secondary",icon:"fas fa-eye",flat:"","no-caps":""},{default:a(()=>[l(re,{style:{"min-width":"200px"}},{default:a(()=>[l(ie,null,{default:a(()=>[(f(!0),V(F,null,Y(v.value.columns,(i,Q)=>J((f(),S(ne,{tag:"label",key:Q},{default:a(()=>[l(z,null,{default:a(()=>[l(A,null,{default:a(()=>[d(r(i.label),1)]),_:2},1024),l(A,{caption:""},{default:a(()=>[d(r(i.coldesc),1)]),_:2},1024)]),_:2},1024),l(z,{side:"",top:""},{default:a(()=>[l(de,{color:"pink-5",modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=H=>C.value=H),val:i.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[se]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])]),l(N,{vertical:""}),o("div",Ye,[e[32]||(e[32]=o("div",{class:"text-h6"},"Productos revisados",-1)),l(ue,{"row-key":"id",flat:"",rows:ke.value,columns:v.value.columns,pagination:v.value.pagination,filter:v.value.filter,"visible-columns":C.value,onRowClick:oe},{top:a(()=>[o("div",Je,[l(P,{dense:"",modelValue:v.value.filter,"onUpdate:modelValue":e[2]||(e[2]=i=>v.value.filter=i),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:a(()=>[l(O,{name:"search"})]),_:1},8,["modelValue"]),l(x,{color:"secondary",flat:"",icon:"fas fa-eye","no-caps":""},{default:a(()=>[l(re,{style:{"min-width":"200px"}},{default:a(()=>[l(ie,null,{default:a(()=>[(f(!0),V(F,null,Y(v.value.columns,(i,Q)=>J((f(),S(ne,{tag:"label",key:Q},{default:a(()=>[l(z,null,{default:a(()=>[l(A,null,{default:a(()=>[d(r(i.label),1)]),_:2},1024),l(A,{caption:""},{default:a(()=>[d(r(i.coldesc),1)]),_:2},1024)]),_:2},1024),l(z,{side:"",top:""},{default:a(()=>[l(de,{color:"pink-5",modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=H=>C.value=H),val:i.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[se]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])])]),l(W,{modelValue:s.value.state,"onUpdate:modelValue":e[6]||(e[6]=i=>s.value.state=i),position:"bottom",onHide:e[7]||(e[7]=i=>Z.value.focus())},{default:a(()=>[s.value.item?(f(),S(X,{key:0},{default:a(()=>[l(y,{class:"bg-grey-3"},{default:a(()=>[o("div",We,[o("div",Xe,[o("div",Ze,"ID: "+r(s.value.item.id),1),o("div",et,r(s.value.item.code),1)]),o("div",tt,[o("div",ot,r(s.value.item.name),1),o("div",lt,r(s.value.item.barcode),1)])])]),_:1}),l(N),l(y,null,{default:a(()=>[d(r(s.value.item.description),1)]),_:1}),l(y,{class:"row justify-around items-center"},{default:a(()=>[o("div",at,[o("div",st,r(s.value.item.pieces),1),e[33]||(e[33]=o("div",{class:"text--2"},"PxC",-1))]),(f(!0),V(F,null,Y(s.value.item.stocks,i=>(f(),V("div",{key:i.id,class:"text-center"},[o("div",it,r(i.pivot.gen),1),o("div",nt,r(i.alias),1)]))),128))]),_:1}),l($e,{onSubmit:Pe(_e,["prevent"])},{default:a(()=>[l(y,null,{default:a(()=>[o("div",rt,[o("div",dt,[e[34]||(e[34]=o("div",null,"Solicitud",-1)),o("div",ut,r(s.value.item.pivot.amount)+" "+r(s.value.item.pivot._supply_by==3?`Caja${s.value.item.pivot.amount!=1?"s":""}`:s.value.item.pivot._supply_by==2?`Docena${s.value.item.pivot.amount!=1?"s":""}`:`Pieza${s.value.item.pivot.amount!=1?"s":""}`),1)]),o("div",ct,[e[35]||(e[35]=o("div",null,"Conteo",-1)),l(P,{dense:"",borderless:"",modelValue:s.value.form.count,"onUpdate:modelValue":e[4]||(e[4]=i=>s.value.form.count=i),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:L},null,8,["modelValue"])]),o("div",pt,[e[36]||(e[36]=o("div",null,"PxC",-1)),l(P,{dense:"",borderless:"",modelValue:s.value.form.ipack,"onUpdate:modelValue":e[5]||(e[5]=i=>s.value.form.ipack=i),type:"number","input-class":"text-h6 text-center"},null,8,["modelValue"])]),o("div",vt,[e[37]||(e[37]=o("div",null,"Piezas",-1)),o("div",mt,r(s.value.item.pivot._supply_by==3?s.value.form.count*s.value.form.ipack:s.value.item.pivot._supply_by==2?s.value.form.count*12:s.value.form.count),1)])])]),_:1}),l(x,{color:"green-5",type:"submit",square:"",icon:"done_all","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1})]),_:1})):D("",!0)]),_:1},8,["modelValue"]),l(W,{modelValue:q.value.state,"onUpdate:modelValue":e[9]||(e[9]=i=>q.value.state=i)},{default:a(()=>[l(X,null,{default:a(()=>[l(y,{class:"row items-start"},{default:a(()=>[l(ae,{icon:"warning",color:"orange-14","text-color":"white"}),e[38]||(e[38]=o("div",{class:"q-ml-md"},[o("div",{class:"text-h6 text-bold"},"Deseas terminar la revision?")],-1))]),_:1}),l(y,{class:"text-subtitle1 text-bold"},{default:a(()=>e[39]||(e[39]=[o("div",null,"EL pedido ya no podra editarse y se emitira la salida correspondiente",-1),o("div",null,"en factusol",-1)])),_:1}),l(y,null,{default:a(()=>[l(je,{modelValue:j.value.val,"onUpdate:modelValue":e[8]||(e[8]=i=>j.value.val=i),options:j.value.opts,label:"Almacen Destino",filled:""},null,8,["modelValue","options"])]),_:1}),l(Re,{align:"right"},{default:a(()=>[J(l(x,{flat:"",label:"Canclear",color:"negative",rounded:"","no-caps":""},null,512),[[Te]]),l(x,{flat:"",label:"Emitir Factura",color:"positive",rounded:"",onClick:we,disable:$.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(W,{modelValue:R.value.state,"onUpdate:modelValue":e[10]||(e[10]=i=>R.value.state=i),persistent:""},{default:a(()=>[l(X,{class:"bg-red text-white"},{default:a(()=>[l(y,{class:"row items-center"},{default:a(()=>[l(ae,{icon:"signal_wifi_off",color:"primary","text-color":"white"}),o("span",ft,r(R.value.code),1)]),_:1}),l(y,null,{default:a(()=>[o("span",bt,r(R.value.text),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}),ee.value?(f(),S(ce,{key:0,bordered:"",class:"bg-cyan-10 text-dark q-pa-sm row",elevated:""},{default:a(()=>[l(P,{color:"white",modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=n=>k.value=n),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:Ue(xe,["enter"]),ref_key:"iptfinder",ref:Z},{prepend:a(()=>[l(O,{name:"fas fa-barcode",color:"white"})]),append:a(()=>[l(x,{flat:"",icon:"fas fa-delete-left",color:"white",onClick:e[11]||(e[11]=n=>k.value=""),disabled:!k.value.length},null,8,["disabled"])]),_:1},8,["modelValue"]),h.value.length>0?(f(),S(x,{key:0,color:"white","text-color":"cyan-9",label:"Terminar",icon:"done",onClick:e[13]||(e[13]=n=>q.value.state=!0),"no-caps":"",disable:$.value},null,8,["disable"])):D("",!0)]),_:1})):D("",!0),c.value&&c.value._status!=5?(f(),S(ce,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:a(()=>{var n;return[o("div",gt,r((n=c.value.status)==null?void 0:n.name),1)]}),_:1})):D("",!0)],64))}};export{so as default};
