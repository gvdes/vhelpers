import{Q as $e}from"./QToolbarTitle.32fb5f8d.js";import{Q as z,a as Y,d as ce}from"./QSelect.368cc7e9.js";import{Q as Se}from"./QToggle.74be13ec.js";import{b as K,c as G,a as E,Q as pe,d as J}from"./QList.afd4d6b9.js";import{a as S,Q as U}from"./QCard.22e46b63.js";import{b0 as Fe,u as X,r as A,c as Q,q as de,o as _,g as B,d as F,w as s,e as t,Q as P,b1 as be,a6 as M,b2 as De,f as o,a0 as h,h as $,S as Ne,a9 as ne,a as ge,aH as ye,a3 as Qe,a4 as Te,a5 as ue,b4 as Ee,p as _e,aF as Be,aG as Ie,m as Le,a1 as ve,n as W}from"./index.71b74531.js";import{Q as R}from"./QInput.efb421e5.js";import{Q as oe}from"./QForm.e6bd1007.js";import{Q as qe}from"./QToolbar.0922fcc7.js";import{Q as se}from"./QTable.297f96cc.js";import{Q as H}from"./QCardActions.ecdb2615.js";import{Q as Ue}from"./QFooter.e92723e5.js";import{Q as Re}from"./QPage.c8d6d40a.js";import{C as me}from"./ClosePopup.ad010d3e.js";import{u as Oe,c as ie}from"./cashApi.a7f7c09f.js";import"./QExpansionItem.20af0b8e.js";import"./QDrawer.12cdaae6.js";import{u as Z,p as je}from"./axios.927f9c8f.js";import{d as fe}from"./productsApi.ecfd62c2.js";import{Q as ze}from"./QSpace.646048c0.js";import{R as O}from"./resoursesOrder.28370fe0.js";import{Q as Ke}from"./QCheckbox.7c58759c.js";import{o as Me}from"./orderApi.b60065a5.js";import"./QLinearProgress.ddb1c777.js";import"./QResizeObserver.1c2b02b3.js";import"./QScrollObserver.bed0e1e3.js";import"./touch.9135741d.js";const Je={class:"QuickRegular row items-center"},We={class:"row items-center justify-between no-wrap QuickRegular"},Ye={class:"col"},Ge={class:"text-grey-4 q-pl-md"},He={class:"text--2 text-grey-5"},Xe={class:"text--3"},Ze={key:0,class:"text--3 text-amber-13"},et={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},_location:{default:null,type:Boolean},_celler:{default:null,type:Boolean},check_stock:{default:null,type:Boolean},with_locations:{default:null,type:Boolean},with_image:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},with_prices_Invoice:{default:null,type:Boolean},with_stock:{default:null,type:Boolean},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]},wkpToVal:{default:null,type:Number},blockStates:{type:Array,default:()=>[4,5,6]}},emits:["input","similarcodes","agregar"],setup(x,{expose:q,emit:b}){const i=Z(),r=X(),f=x,C=b,a=A({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),m=A(null),w=Q(()=>({autocomplete:a.value.target,_category:f._category,_status:f._status,_location:f._location,with_locations:f.with_locations,with_stock:f.with_stock,check_stock:f.check_stock,with_prices:f.with_prices,_celler:f._celler,limit:f.limit,_workpoint_status:f.workpointStatus,_workpoint:r.session.store.id_viz})),g=Q(()=>n=>f.checkState?f.blockStates.some(c=>c==n.state.id):!1);de(()=>{a.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let n=JSON.parse(localStorage.getItem("typeiptsearch"));n&&(a.value.iptsearch.type=n.type,a.value.iptsearch.icon=n.icon)});const u=()=>{a.value.read_barcode=!a.value.read_barcode,a.value.target="",localStorage.setItem("barcodereader",a.value.read_barcode)},D=(n,c,v)=>{console.log(w.value),n.trim().length>1&&(a.value.target=n.toUpperCase().trim(),console.log(a.value.target),fe.autocomplete(w.value).then(I=>{console.log(I);let ee=I.data.map(N=>{if(f.checkState)if(f.wkpToVal){let j=N.stocks.find(te=>te._workpoint==f.wkpToVal);N.stateToVal=j?{own:j,state:j.status}:{own:null,state:N.status}}else N.stateToVal={own:!0,state:N.status};else N.stateToVal={own:!0,state:N.status};return N});c(()=>{a.value.options=ee},N=>{N.setOptionIndex(-1),N.moveOptionSelection(1,!0)})}).catch(I=>{console.log(I)}))},T=()=>{switch(a.value.iptsearch.type){case"text":a.value.iptsearch.type="number",a.value.iptsearch.icon="fas fa-font";break;case"number":a.value.iptsearch.type="text",a.value.iptsearch.icon="fas fa-hashtag";break}localStorage.setItem("typeiptsearch",JSON.stringify(a.value.iptsearch))},V=n=>{a.value.target="",C("input",n)},k=()=>{a.value.target.trim().toUpperCase(),a.value.target.length&&(a.value.iptsearch.processing=!0,fe.autocomplete(w.value).then(n=>{let c=n.data;switch(c.length){case 0:let v=a.value.target;i.notify({message:`Sin resultados para <b>${v}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),y();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(c[0]),V(c[0]);break}a.value.target="",a.value.iptsearch.processing=!1}).catch(n=>{console.log(n)}))},y=()=>{console.log("putFocus ejecutada!!"),m.value.focus()};q({focus:()=>{var n,c;return(c=(n=m.value)==null?void 0:n.focus)==null?void 0:c.call(n)}});const d=n=>{C("agregar",n)};return(n,c)=>(_(),B("div",Je,[a.value.read_barcode?(_(),F(R,{key:0,ref_key:"iptatc",ref:m,loading:a.value.iptsearch.processing,disable:a.value.iptsearch.processing,modelValue:a.value.target,"onUpdate:modelValue":c[1]||(c[1]=v=>a.value.target=v),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:be(k,["enter"]),autocomplete:"off",autofocus:""},{prepend:s(()=>[t(P,{dense:"",flat:"",color:a.value.read_barcode?"light-blue-13":"blue-13",icon:a.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:c[0]||(c[0]=v=>u())},null,8,["color","icon"])]),_:1},8,["loading","disable","modelValue"])):(_(),F(z,{key:1,dense:"",filled:"",color:"blue-13",class:"text-uppercase col",ref_key:"iptatc",ref:m,"use-input":"","hide-dropdown-icon":"","option-value":"id","option-label":"id","hide-selected":"",behavior:"menu",modelValue:a.value.target,"onUpdate:modelValue":c[3]||(c[3]=v=>a.value.target=v),"input-debounce":400,autofocus:"",options:a.value.options,type:a.value.iptsearch.type,onFilter:D,"popup-content-class":"bg-darkl1"},{"no-option":s(()=>[t(K,null,{default:s(()=>[t(G,{class:"text-grey QuickRegular"},{default:s(()=>c[4]||(c[4]=[M("Nada por aqui...")])),_:1})]),_:1})]),prepend:s(()=>[t(P,{dense:"",flat:"",color:a.value.read_barcode?"light-blue-13":"blue-13",icon:a.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:c[2]||(c[2]=v=>u())},null,8,["color","icon"]),t(P,{type:"button",dense:"",size:"sm",flat:"",onClick:T,icon:a.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:s(v=>[t(K,De(v.itemProps,{onClick:I=>d(v.opt),disable:g.value(v.opt.stateToVal)}),{default:s(()=>[t(G,null,{default:s(()=>[o("div",We,[o("div",Ye,[o("div",null,[M(h(v.opt.code)+" ",1),o("span",Ge,h(v.opt.name),1)]),o("div",He,h(v.opt.description),1),o("div",Xe,h(v.opt.stateToVal.state.name),1),v.opt.stateToVal.own?$("",!0):(_(),B("div",Ze,"Producto en conflicto con status "))]),t(Ne,{name:"fas fa-circle",class:ne(["q-pl-md",`bullet-${v.opt.stateToVal.state.id}`]),size:"10px"},null,8,["class"])])]),_:2},1024)]),_:2},1040,["onClick","disable"])]),_:1},8,["modelValue","options","type"]))]))}};var tt=Fe(et,[["__scopeId","data-v-a482d274"]]);const lt={class:"row"},at={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},ot={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},st={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},it={class:"row"},nt={class:"text-h6 col text-bold text-left"},ut={class:"text-h6 col text-bold text-right"},dt={class:"text-subtitle2 col"},rt={class:"text-center"},ct={class:"q-pa-xs"},pt={class:"row items-center justify-center q-gutter-md"},vt={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(x,{emit:q}){X();const b=Z();ge(),ye();const i=x,r=q,f=Q(()=>!i.product.pivot.amountDelivered||i.product.pivot.amountDelivered<=0),C=Q(()=>i.product.pivot._supply_by==3?i.product.pivot.amountDelivered*i.product.pieces:i.product.pivot._supply_by==2?i.product.pivot.amountDelivered*12:i.product.pivot.amountDelivered),a=Q(()=>i._price_list<=3?[1,2,3,4]:[i._price_list]),m=Q(()=>i._price_list<=3?C.value>=i.product.pieces&&(i.product.pivot._supply_by==1||i.product.pivot._supply_by==2)||i.product.pivot._supply_by==3?4:O.verificarPrecioDocena(i.products,i.product,i.rules)?3:O.verificarPrecioMayoreo(i.products,i.product,i.rules)?2:1:i._price_list),w=()=>{r("reset")},g=async()=>{b.loading.show({message:"Editando Producto"});let T=i.product.prices.find(k=>k.id==m.value).pivot.price,V=C.value*T;i.product.pivot.toDelivered=C.value,i.product.pivot._price_list=m.value,i.product.pivot.price=T,i.product.pivot.total=V,b.loading.hide(),w(),O.actualizarPreciosProductosSales(i.products,i._price_list,i.rules),r("editProduct")},u=async()=>{b.loading.show({message:"Agregando producto"});let T=i.product.prices.find(k=>k.id==m.value).pivot.price,V=C.value*T;i.product.pivot.toDelivered=C.value,i.product.pivot._price_list=m.value,i.product.pivot.price=T,i.product.pivot.total=V,i.product.pivot._product=i.product.id,console.log(i.product),r("addProduct",i.product),b.loading.hide(),O.actualizarPreciosProductosSales(i.products,i._price_list,i.rules)},D=async()=>{b.loading.show({message:"Eliminando Producto"}),r("deleteProduct",i.product),b.loading.hide(),O.actualizarPreciosProductosSales(i.products,i._price_list,i.rules)};return(T,V)=>(_(),F(U,null,{default:s(()=>[t(S,{class:"item-center"},{default:s(()=>[o("div",lt,[o("div",at,h(x.product.category.familia.seccion.name),1),o("div",ot,h(x.product.category.familia.name),1),o("div",st,h(x.product.category.name),1)])]),_:1}),t(S,{class:"item-center"},{default:s(()=>[o("div",it,[o("div",nt,h(x.product.code),1),o("div",ut,h(x.product.name),1)]),o("div",dt,h(x.product.description),1)]),_:1}),t(S,{class:"item-center row"},{default:s(()=>[(_(!0),B(Qe,null,Te(x.product.prices.filter(k=>a.value.includes(k.id)),(k,y)=>(_(),B("div",{class:"col text-subtitle2 text-center",key:y},[o("div",{class:ne(k.id==m.value?"text-weight-bold":"text-caption text-strike")},h(k.alias),3),t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",{class:ne(k.id==m.value?"text-bold  text-blue-13":"text-caption")},h(k.pivot.price),3),t(E,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),t(S,null,{default:s(()=>[o("div",rt,[o("div",ct,[V[4]||(V[4]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),o("div",pt,[t(P,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:V[0]||(V[0]=k=>x.product.pivot.amountDelivered>1?x.product.pivot.amountDelivered--:"")}),ue(o("input",{type:"number",min:"1","onUpdate:modelValue":V[1]||(V[1]=k=>x.product.pivot.amountDelivered=k),class:"text-center exo",style:{width:"100px","font-size":"3em",border:"none"},autofocus:"",onKeydown:V[2]||(V[2]=be(k=>x.edit?g():u(),["enter"]))},null,544),[[Ee,x.product.pivot.amountDelivered]]),t(P,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:V[3]||(V[3]=k=>x.product.pivot.amountDelivered++)})])])])]),_:1}),t(H,null,{default:s(()=>[t(P,{flat:"",icon:"close",onClick:w}),t(ze),x.edit?$("",!0):(_(),F(P,{key:0,flat:"",icon:"add",color:"positive",onClick:u,disable:f.value},null,8,["disable"])),x.edit?(_(),F(P,{key:1,flat:"",icon:"delete",color:"negative",onClick:D})):$("",!0),x.edit?(_(),F(P,{key:2,flat:"",icon:"edit",color:"warning",onClick:g,disable:f.value},null,8,["disable"])):$("",!0)]),_:1})]),_:1}))}},mt={class:"bg-primary row items-center justify-between q-pa-md text-white"},ft={class:"text-right"},bt={class:"fw-bold text-h4"},gt={class:"row text-center items-center"},yt={class:"col"},_t={class:"row text-center items-center"},xt={class:"col"},ht={class:"col"},wt={class:"row flex justify-center"},kt={class:"col flex justify-center"},Pt={key:0,class:"col"},Vt={key:0,class:"row flex justify-center text-center"},Ct={class:"col"},At={class:"col"},$t={class:"row flex justify-center"},St={class:"col flex justify-center"},Ft={key:0,class:"col"},Dt={class:"row"},Nt={class:"text-h5"},Qt={key:0,class:"text-center"},Tt={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(x,{emit:q}){X();const b=Z(),i=A({dafpa:!1,vales:!1}),r=x,f=q,C=A({opts:[]}),a=A({PFPA:{id:r.paymeths[1],val:r.total},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),m=Q(()=>(Number(Number.parseFloat(a.value.SFPA.val)+Number.parseFloat(a.value.PFPA.val))+Number.parseFloat(a.value.VALE.val)-Number.parseFloat(r.total)).toFixed(2)),w=Q(()=>{var y,d,n;return m.value>=0&&(((y=a.value.PFPA.id)==null?void 0:y.id)&&a.value.PFPA.val>0||((d=a.value.SFPA.id)==null?void 0:d.id)&&a.value.SFPA.val>0||((n=a.value.VALE.id)==null?void 0:n.id)&&a.value.VALE.val>0)}),g=Q(()=>{const y=Object.values(a.value);if(y.some(v=>v.id&&v.id.alias==="EFE"&&v.val>0))return!1;const n=y.some(v=>v.id&&v.id.alias!=="EFE"),c=y.reduce((v,I)=>v+Number(I.val||0),0);return n&&c>r.total}),u=y=>{var d;return y.id==((d=a.value.SFPA.id)==null?void 0:d.id)},D=y=>{var d;return y.id==((d=a.value.PFPA.id)==null?void 0:d.id)},T=async()=>{b.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let d=`http://192.168.10.160:1619/access/public/modify/vales?price=${r.client}`;je.get(d).then(n=>{console.log(n.data),b.loading.hide();let c=n.data.map(v=>({id:{id:5,alias:"[V]",name:"VALE",code:v.CODANT},val:Number(v.IMPANT)}));C.value.opts=c,i.value.vales=!0}).catch(n=>{console.log(n.response.data),b.notify({html:!0,message:n.response.data,color:"negative",position:"bottom"}),b.loading.hide()})},V=y=>{y.key==="Enter"&&w.value&&(y.preventDefault(),k())},k=()=>{a.value.conditions.super=g.value,a.value.change=m.value,f("sendTicket",a.value),C.value=A({opts:[]}),a.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return de(()=>{window.addEventListener("keydown",V)}),_e(()=>{window.removeEventListener("keydown",V)}),(y,d)=>(_(),F(U,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:s(()=>[o("div",mt,[d[11]||(d[11]=o("div",null,[o("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),o("div",ft,[d[10]||(d[10]=o("div",{class:"fs-dec3"},"Total Actual",-1)),o("div",bt,"$ "+h(x.total),1)])]),t(S,null,{default:s(()=>{var n;return[o("div",gt,[d[12]||(d[12]=o("div",{class:"col"}," Forma de pago: ",-1)),o("div",yt,[t(z,{class:"col-3",modelValue:a.value.PFPA.id,"onUpdate:modelValue":d[0]||(d[0]=c=>a.value.PFPA.id=c),options:x.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":c=>u(c)},null,8,["modelValue","options","option-disable"])])]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",_t,[o("div",xt,h(((n=a.value.PFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",ht,[t(R,{class:"col",modelValue:a.value.PFPA.val,"onUpdate:modelValue":d[2]||(d[2]=c=>a.value.PFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:s(()=>[parseFloat(a.value.PFPA.val)?(_(),F(P,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:d[1]||(d[1]=c=>a.value.PFPA.val=0)})):$("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),t(S,null,{default:s(()=>{var n;return[o("div",wt,[o("div",kt,[t(P,{color:"primary",label:"2\xAA Forma de pago",onClick:d[3]||(d[3]=()=>{i.value.dafpa=!i.value.dafpa,a.value.SFPA.val=0,a.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),i.value.dafpa?(_(),B("div",Pt,[t(z,{class:"col-3",modelValue:a.value.SFPA.id,"onUpdate:modelValue":d[4]||(d[4]=c=>a.value.SFPA.id=c),options:x.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":c=>D(c)},null,8,["modelValue","options","option-disable"])])):$("",!0)]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),i.value.dafpa?(_(),B("div",Vt,[o("div",Ct,h(((n=a.value.SFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",At,[t(R,{class:"col",modelValue:a.value.SFPA.val,"onUpdate:modelValue":d[6]||(d[6]=c=>a.value.SFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:s(()=>[parseFloat(a.value.SFPA.val)?(_(),F(P,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:d[5]||(d[5]=c=>a.value.SFPA.val=0)})):$("",!0)]),_:1},8,["modelValue"])])])):$("",!0)]}),_:1}),t(S,null,{default:s(()=>[o("div",$t,[o("div",St,[t(P,{color:"primary",label:"Cobrar Vale",onClick:T,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),i.value.vales?(_(),B("div",Ft,[o("div",Dt,[t(z,{class:"col",modelValue:a.value.VALE,"onUpdate:modelValue":d[7]||(d[7]=n=>a.value.VALE=n),options:C.value.opts,label:"Vale","option-label":n=>`Vale : ${n.id?n.id.code:""}`,dense:"",filled:""},{option:s(n=>[t(K,Be(Ie(n.itemProps)),{default:s(()=>[t(G,null,{default:s(()=>[t(Y,null,{default:s(()=>[M(h(n.opt.id.code),1)]),_:2},1024),t(Y,{caption:""},{default:s(()=>[M("$ "+h(Number(n.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),a.value.VALE.id?(_(),F(R,{key:0,modelValue:a.value.VALE.val,"onUpdate:modelValue":d[8]||(d[8]=n=>a.value.VALE.val=n),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):$("",!0)])])):$("",!0)])]),_:1}),g.value?(_(),F(S,{key:0,class:"flex justify-end"},{default:s(()=>[t(Ke,{modelValue:a.value.conditions.createWithdrawal,"onUpdate:modelValue":d[9]||(d[9]=n=>a.value.conditions.createWithdrawal=n),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):$("",!0),t(H,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:s(()=>[o("div",null,[d[13]||(d[13]=o("div",{class:"fs-dec3"},"Cambio",-1)),o("div",Nt," $ "+h(m.value),1)]),w.value?(_(),B("div",Qt,[t(P,{color:"primary",icon:"payment",label:"Pagar",onClick:k})])):$("",!0)]),_:1})]),_:1}))}},Et={class:"row items-center justify-between"},Bt={class:"col"},It={class:"col"},Lt={class:"col"},qt={class:"text-caption text-center"},Ut={class:"text-center text-h6"},Rt={key:0,class:"col"},Ot={class:"text-center text-h6 text-caption"},jt={key:1,class:"col"},zt={class:"text-center text-h6"},Kt={class:"col"},Mt={class:"text-center text-h6"},xl={__name:"salesEstandar",setup(x){const q=X(),b=Z();ge(),ye();const i=Oe(),r=A({name:"IVA",option:!1,optval:[16,8,6],value:0}),f=A(null),C=A(null),a=A({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),m=A({val:null,opts:[]}),w=A({val:null,opts:[]}),g=A({state:!1,val:null,edit:!1}),u=A({client:null,dependiente:null,products:[]}),D=A(!1),T=A({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"verify",label:"Cantidad",field:l=>l.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:l=>l.pivot.price,align:"center"},{name:"bruto",label:r.option?"Bruto":"Total",field:l=>l.pivot.total,align:"center"},{name:"iva",label:"Total",field:l=>l.pivot.total,align:"center"},{name:"neto",label:"Total",field:l=>l.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),V=A({columns:[{name:"id",label:"Codigo",field:l=>l.id,align:"left"},{name:"Nombre",label:"Descripcion",field:l=>l.name,align:"left"},{name:"Telefono",label:"Pedido",field:l=>l.celphone,align:"center"}],pagination:{rowsPerPage:0}}),k=A({columns:[{name:"id",label:"Codigo",field:l=>l.id,align:"left"},{name:"Nombre",label:"Descripcion",field:l=>l.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),y=Q(()=>Number(u.value.products.reduce((l,e)=>l+e.pivot.total,0)).toFixed(2)),d=Q(()=>u.value.products.reduce((l,e)=>l+Number(e.pivot.toDelivered),0)),n=Q(()=>u.value.products.length>0&&u.value.dependiente&&u.value.client),c=Q(()=>{const l=[{name:"code",label:"Codigo",field:e=>e.code,align:"left"},{name:"description",label:"Descripcion",field:e=>e.description,align:"left"},,{name:"verify",label:"Verificado",field:e=>e.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:e=>e.pivot.price,align:"center"},{name:"bruto",label:r.value.option?"Subtotal":"Total",field:e=>e.pivot.total,format:e=>`$ ${e.toFixed(2)}`,align:"center"}];return r.value.option&&(l.splice(6,0,{name:"iva",label:"IVA",field:e=>e.pivot.total*(r.value.value/100),format:e=>`$ ${e.toFixed(2)}`,align:"center"}),l.push({name:"total",label:"Total c/IVA",field:e=>e.pivot.total*(1+r.value.value/100),format:e=>`$ ${e.toFixed(2)}`,align:"center"})),l}),v=l=>{console.log(l);let e=u.value.products.findIndex(p=>p.id==l.id);e>=0?(g.value.val=u.value.products[e],g.value.state=!0,g.value.edit=!0):(l.pivot=a.value,g.value.val=l,g.value.state=!0,g.value.edit=!1)},I=l=>{console.log(l);let e=u.value.products.findIndex(p=>p.id==l.id);e>=0?(g.value.val=u.value.products[e],g.value.state=!0,g.value.edit=!0):(l.pivot=a.value,g.value.val=l,g.value.state=!0,g.value.edit=!1)},ee=(l,e)=>{console.log(e),g.value.val=e,g.value.edit=!0,g.value.state=!0},N=()=>{console.log("cambio de cliente"),m.value.state=!0},j=async()=>{if(m.value.val){const l=await Me.getClient(m.value);l.fail?console.log(l):l.length>0?(console.log(l),m.value.opts=l):b.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(l)}else b.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},te=async(l,e)=>{b.loading.show({message:"Recalculando Ticket"}),u.value.client=e,O.actualizarPreciosProductosSales(u.value.products,e._price_list,i.rules),m.value={state:!1,val:null,opts:[]},b.loading.hide()},xe=()=>{console.log("cambio de cliente"),w.value.state=!0},he=async()=>{if(w.value.val){let l={val:w.value.val,sto:q.session.store.id};const e=await ie.getDependiente(l);e.fail?console.log(e):e.length>0?(console.log(e),w.value.opts=e):b.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(e)}else b.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},we=(l,e)=>{u.value.dependiente=e,w.value={state:!1,val:null,opts:[]},b.loading.hide()},ke=l=>{u.value.products.push(l),le(),W(()=>{var e;(e=C.value)==null||e.focus()})},Pe=()=>{W(()=>{var l;(l=C.value)==null||l.focus()})},Ve=l=>{let e=u.value.products.findIndex(p=>p.id==l.id);e>=0&&(u.value.products.splice(e,1),le()),W(()=>{var p;(p=C.value)==null||p.focus()})},Ce=async l=>{u.value.payments=l,u.value.change=l.conditions.super?0:l.change,r.value.option?(u.value.subtotal=u.value.products.reduce((L,ae)=>L+ae.pivot.total,0),u.value.iva=r.value.value,u.value.total=Number(y.value*Number(1+r.value.value/100).toFixed(2)),u.value.products.forEach(L=>{L.pivot.iva=r.value.value,L.pivot.subtotal=L.pivot.total,L.pivot.total=L.pivot.total*(1+r.value.value/100)})):u.value.total=u.value.products.reduce((L,ae)=>L+ae.pivot.total,0);let e={order:u.value,cashier:i.cash};console.log(e);const p=await ie.addSaleStandar(e);p.fail?console.log(p):(console.log(p),D.value=!1,u.value={client:null,dependiente:null,products:[]},r.value.value=0,r.value.option=!1,localStorage.removeItem("current_sale"),b.loading.hide())},le=()=>{g.value={state:!1,val:null,edit:!1},a.value={amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},W(()=>{var l;(l=C.value)==null||l.focus()})},Ae=async()=>{if(console.log(f.value),f.value){b.loading.show({message:"Obteniendo Orden"});let l={uid:q.session.credentials.staff.id_va,oid:f.value};const e=await ie.getOrderCash(l);e.fail?e.fail.status==401?(console.log(e),b.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),f.value=null,b.loading.hide()):e.fail.status==404?(console.log(e),b.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),f.value=null,b.loading.hide()):console.log(e):(u.value.dependiente=e.staff,u.value.client=e.client,u.value.products=e.products,f.value=null,console.log(e),b.loading.hide())}},re=l=>{l.ctrlKey&&l.key.toLowerCase()==="b"?(l.preventDefault(),m.value.state||(m.value.state=!0)):l.ctrlKey&&l.key.toLowerCase()==="d"?(l.preventDefault(),w.value.state||(w.value.state=!0)):l.altKey&&l.key==="Enter"&&n.value&&(l.preventDefault(),D.value||(D.value=!0))};return Le(()=>u.value,l=>{localStorage.setItem("current_sale",JSON.stringify(l))},{deep:!0}),de(()=>{const l=localStorage.getItem("current_sale");l&&(u.value=JSON.parse(l)),window.addEventListener("keydown",re)}),_e(()=>{window.removeEventListener("keydown",re)}),(l,e)=>(_(),F(Re,null,{default:s(()=>[t(qe,{class:""},{default:s(()=>[t($e),t(P,{flat:"",round:"",dense:"",icon:"settings",class:"q-mr-xs"},{default:s(()=>[t(ce,{style:{width:"200px"}},{default:s(()=>[t(U,{class:"my-card"},{default:s(()=>[t(S,null,{default:s(()=>[t(pe,{dense:""},{default:s(()=>[t(K,{class:"q-px-sm q-py-xs column"},{default:s(()=>[o("div",Et,[t(Y,null,{default:s(()=>[M(h(r.value.name),1)]),_:1}),t(Se,{color:"blue",modelValue:r.value.option,"onUpdate:modelValue":[e[0]||(e[0]=p=>r.value.option=p),e[1]||(e[1]=p=>{p?r.value.value=16:r.value.value=0})]},null,8,["modelValue"])]),r.value.option?(_(),F(z,{key:0,modelValue:r.value.value,"onUpdate:modelValue":e[2]||(e[2]=p=>r.value.value=p),options:r.value.optval,label:"Porcentaje",filled:"",dense:"","emit-value":"","map-options":"",class:"q-mt-sm"},null,8,["modelValue","options"])):$("",!0),t(E,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(P,{flat:"",round:"",dense:"",icon:"receipt_long"},{default:s(()=>[t(ce,null,{default:s(()=>[t(pe,{style:{"min-width":"100px"}},{default:s(()=>[t(K,null,{default:s(()=>[t(G,null,{default:s(()=>[t(oe,{onSubmit:Ae},{default:s(()=>[t(Y,null,{default:s(()=>[t(R,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=p=>f.value=p),type:"Number",dense:"",filled:"",label:"Comanda"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(U,{class:"my-card"},{default:s(()=>[t(S,{class:"row"},{default:s(()=>[o("div",Bt,[e[11]||(e[11]=o("div",{class:"text-caption text-center"},"Dependiente",-1)),t(P,{class:"full-width",flat:"",label:u.value.dependiente?u.value.dependiente.complete_name:"CTRL+d",onClick:xe},null,8,["label"])]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",It,[e[12]||(e[12]=o("div",{class:"text-caption text-center"},"Cliente",-1)),t(P,{class:"full-width",flat:"",label:u.value.client?u.value.client.name:"CTRL+b",onClick:N},null,8,["label"])])]),_:1})]),_:1}),t(E,{spaced:"",inset:"",vertical:"",dark:""}),t(U,{class:"my-card"},{default:s(()=>[t(S,{class:"row"},{default:s(()=>[o("div",Lt,[o("div",qt,h(r.value.option?"SUBTOTAL":"TOTAL"),1),o("div",Ut,"$ "+h(y.value),1)]),r.value.option?(_(),B("div",Rt,[e[13]||(e[13]=o("div",{class:"text-caption text-center"}," IVA ",-1)),o("div",Ot,"$ "+h(Number(y.value*Number(r.value.value/100)).toFixed(2)),1)])):$("",!0),r.value.option?(_(),B("div",jt,[e[14]||(e[14]=o("div",{class:"text-caption text-center"}," TOTAL ",-1)),o("div",zt,"$ "+h(Number(y.value*Number(1+r.value.value/100)).toFixed(2)),1)])):$("",!0),o("div",Kt,[e[15]||(e[15]=o("div",{class:"text-caption text-center"},"Cantidad",-1)),o("div",Mt,h(d.value),1)])]),_:1})]),_:1}),t(E,{spaced:"",inset:"",vertical:"",dark:""}),t(se,{rows:u.value.products,columns:c.value,"hide-bottom":"",pagination:T.value.pagination,onRowClick:ee},null,8,["rows","columns","pagination"]),t(J,{modelValue:g.value.state,"onUpdate:modelValue":e[4]||(e[4]=p=>g.value.state=p),persistent:"",position:"bottom"},{default:s(()=>[t(vt,{product:g.value.val,_price_list:m.value.val?m.value.val._price_list:1,edit:g.value.edit,onReset:le,products:u.value.products,rules:ve(i).rules,onAddProduct:ke,onDeleteProduct:Ve,onEditProduct:Pe},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),t(J,{modelValue:m.value.state,"onUpdate:modelValue":e[6]||(e[6]=p=>m.value.state=p)},{default:s(()=>[t(U,{style:{width:"700px"}},{default:s(()=>[t(oe,{onSubmit:j},{default:s(()=>[e[16]||(e[16]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),e[17]||(e[17]=o("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),t(S,null,{default:s(()=>[t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[t(R,{autofocus:"",modelValue:m.value.val,"onUpdate:modelValue":e[5]||(e[5]=p=>m.value.val=p),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),m.value.opts.length>0?(_(),F(S,{key:0},{default:s(()=>[t(se,{rows:m.value.opts,columns:V.value.columns,pagination:V.value.pagination,onRowClick:te},null,8,["rows","columns","pagination"])]),_:1})):$("",!0),t(H,{align:"right"},{default:s(()=>[ue(t(P,{flat:"",label:"Cancelar",color:"primary"},null,512),[[me]]),t(P,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(J,{modelValue:w.value.state,"onUpdate:modelValue":e[8]||(e[8]=p=>w.value.state=p)},{default:s(()=>[t(U,{style:{width:"700px"}},{default:s(()=>[t(oe,{onSubmit:he},{default:s(()=>[e[18]||(e[18]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),e[19]||(e[19]=o("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),t(S,null,{default:s(()=>[t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[t(R,{autofocus:"",modelValue:w.value.val,"onUpdate:modelValue":e[7]||(e[7]=p=>w.value.val=p),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),w.value.opts.length>0?(_(),F(S,{key:0},{default:s(()=>[t(se,{rows:w.value.opts,columns:k.value.columns,pagination:k.value.pagination,onRowClick:we},null,8,["rows","columns","pagination"])]),_:1})):$("",!0),t(H,{align:"right"},{default:s(()=>[ue(t(P,{flat:"",label:"Cancelar",color:"primary"},null,512),[[me]]),t(P,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",null,[t(J,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=p=>D.value=p)},{default:s(()=>[t(Tt,{total:r.value.option?Number(y.value*Number.parseFloat(1+r.value.value/100)):Number(y.value),paymeths:ve(i).methods,client:u.value.client.id,onSendTicket:Ce},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),t(Ue,{bordered:"",class:"bg-white"},{default:s(()=>[t(U,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[t(S,{class:"row"},{default:s(()=>[t(tt,{ref_key:"productRef",ref:C,class:"col",checkState:!1,onInput:I,onAgregar:v},null,512),n.value?(_(),F(P,{key:0,color:"primary",flat:"",icon:"east",onClick:e[10]||(e[10]=p=>D.value=!D.value),round:""})):$("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{xl as default};
