import{Q as _e}from"./QRadio.1b3b3f6b.js";import{Q as de}from"./QCheckbox.0c9c8e95.js";import{a as ye}from"./QDrawer.fc0d05de.js";import{i as ke,aM as xe,c as D,j as Y,t as we,r as x,o as m,g as h,a3 as J,a2 as K,e as l,f as i,Q as _,u as he,l as Ve,p as Ce,m as Qe,d as A,w as a,h as I,al as B,S as Pe,a0 as b,am as Se,a4 as se}from"./index.e6a9205c.js";import{i as Fe,j as qe}from"./use-key-composition.879881fd.js";import{b as O,a as X,d as Z,e as G,Q as ee}from"./QList.3b79dd01.js";import{Q as F}from"./QCardSection.89aaf3a1.js";import{Q as oe,a as z,q as Ne}from"./QSelect.8e7dd0b4.js";import{Q as H}from"./QCard.d6d1ca67.js";import{Q as De}from"./QInput.b6f8346a.js";import{Q as te}from"./QCardActions.b189b550.js";import{Q as Ie}from"./QBtnGroup.02b01ec5.js";import{Q as Oe}from"./QPageSticky.e5995feb.js";import{Q as Le}from"./QTable.ffa38637.js";import{Q as Ae}from"./QPage.e0a45f83.js";import{C as ne}from"./ClosePopup.38dc60cf.js";import"./QExpansionItem.7b7ddab1.js";import"./axios.6fa5544b.js";import{u as Be}from"./use-quasar.4a442d8c.js";import{P as Ee,d as Ue}from"./ProductsAutocomplete.de75d62f.js";import{_ as $e}from"./OptionsLabels.ff643d11.js";import{l as ie}from"./locationsApi.846f6397.js";import{E as Te}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.d56fe579.js";import"./dayjs.min.cbcf888d.js";import"./use-checkbox.2d7e2161.js";import"./QResizeObserver.d08643f2.js";import"./QScrollObserver.06cd418b.js";import"./QLinearProgress.992ea4f9.js";/* empty css                                                                         */import"./QImg.95a06523.js";import"./labels.7879c850.js";import"./_commonjsHelpers.88e99c8f.js";const re={radio:_e,checkbox:de,toggle:ye},ze=Object.keys(re);function le(s,V){if(typeof s=="function")return s;const u=s!==void 0?s:V;return d=>d[u]}var Me=ke({name:"QOptionGroup",props:{...Fe,modelValue:{required:!0},options:{type:Array,validator:s=>s.every(xe),default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],name:String,type:{type:String,default:"radio",validator:s=>ze.includes(s)},color:String,keepColor:Boolean,dense:Boolean,size:String,leftLabel:Boolean,inline:Boolean,disable:Boolean},emits:["update:modelValue"],setup(s,{emit:V,slots:u}){const{proxy:{$q:d}}=we(),P=Array.isArray(s.modelValue);s.type==="radio"?P===!0&&console.error("q-option-group: model should not be array"):P===!1&&console.error("q-option-group: model should be array in your case");const k=qe(s,d),q=D(()=>re[s.type]),C=D(()=>le(s.optionValue,"value")),f=D(()=>le(s.optionLabel,"label")),y=D(()=>le(s.optionDisable,"disable")),g=D(()=>s.options.map(n=>({val:C.value(n),name:n.name===void 0?s.name:n.name,disable:s.disable||y.value(n),leftLabel:n.leftLabel===void 0?s.leftLabel:n.leftLabel,color:n.color===void 0?s.color:n.color,checkedIcon:n.checkedIcon,uncheckedIcon:n.uncheckedIcon,dark:n.dark===void 0?k.value:n.dark,size:n.size===void 0?s.size:n.size,dense:s.dense,keepColor:n.keepColor===void 0?s.keepColor:n.keepColor}))),w=D(()=>"q-option-group q-gutter-x-sm"+(s.inline===!0?" q-option-group--inline":"")),S=D(()=>{const n={role:"group"};return s.type==="radio"&&(n.role="radiogroup",s.disable===!0&&(n["aria-disabled"]="true")),n});function c(n){V("update:modelValue",n)}return()=>Y("div",{class:w.value,...S.value},s.options.map((n,E)=>{const M=u["label-"+E]!==void 0?()=>u["label-"+E](n):u.label!==void 0?()=>u.label(n):void 0;return Y("div",[Y(q.value,{label:M===void 0?f.value(n):null,modelValue:s.modelValue,"onUpdate:modelValue":c,...g.value[E]},M)])}))}});const Re={class:"text-right"},je={__name:"selectsLocations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(s,{emit:V}){const u=s,d=V,P=f=>u.sections.filter(y=>y.root===f),k=x([{options:u.sections.filter(f=>f.root===0),selected:null}]),q=(f,y)=>{k.value.splice(y+1);const g=P(f);g.length&&k.value.push({options:g,selected:null})},C=()=>{const f=k.value.filter(g=>g.selected!==null),y=f[f.length-1];d("obtProducts",y)};return(f,y)=>(m(),h("div",null,[(m(!0),h(J,null,K(k.value,(g,w)=>(m(),h("div",{key:w},[l(oe,{modelValue:g.selected,"onUpdate:modelValue":[S=>g.selected=S,S=>q(S,w)],options:g.options,label:`Nivel ${w+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),l(O,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),i("div",Re,[l(_,{flat:"",icon:"send",disable:!k.value[0].selected,onClick:C},null,8,["disable"])])]))}},Ge={class:"text-center"},He={class:"row text-center"},Je={key:0,class:"col"},Ke={class:"row"},We={class:"row"},Ye={key:0,class:"col"},Xe={key:1,class:"col"},Ze={key:0,class:"row"},et={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},tt={class:"text-h5 text-bold text-center"},lt={class:"text-subtitle2 text-bold text-center"},ot={class:"text-subtitle2 text-bold text-center"},at={class:"text-subtitle2 text-bold text-center"},st={class:"text-subtitle2 text-bold text-center"},nt={class:"row"},it={class:"text-center"},dt={class:"text-center"},rt={class:"text-bold q-pb-sm text-center"},ut={class:"row q-pt-xs"},ct={class:"text-negative"},Ht={__name:"products",setup(s){const V=he(),u=Be(),d=x([]),P=x([]),k=x(null),q=x(!1),C=x({val:{id:1,label:"Productos"},opts:[{id:1,label:"Productos"},{id:2,label:"Ubicacion"}]}),f=x({filter:"",pagination:{rowsPerPage:9}}),y=x({state:!1}),g=x({state:!1}),w=x({val:[0,1,2,4],opts:[{label:"Menudeo",value:1},{label:"Mayoreo",value:2},{label:"Docena",value:3},{label:"Caja",value:4}]}),S=x(null),c=x({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[]}),n=o=>{let t=[],e=[],r=new Object;return o.products.map(p=>E(p.prices)?t.push(p):e.push(p)),console.log(o),r.notFound=t,r.add=e,r},E=o=>{let t=!0;return o.map((e,r)=>{t=e.pivot.price==0}),t},M=o=>{console.log(o);let t=d.value.findIndex(e=>e.id==o.id);if(console.log(t),t>=0)d.value[t]._copies++;else{let e=R(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,d.value.push(o),console.log(o)}},ue=o=>{console.log(o);let t=d.value.findIndex(e=>e.id==o.id);if(console.log(t),t>=0)d.value[t]._copies++;else{let e=R(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,d.value.push(o),console.log(o)}},ce=o=>{let t=d.value.findIndex(e=>e.id==o.id);d.value.splice(t,1)},pe=()=>{d.value=[],y.value.state=!1},ve=()=>{S.value.click()},me=async()=>{let o=document.getElementById("inputFile").files[0],t=new Te.Workbook,e=[],r=[],p=0;t.xlsx.load(o).then(v=>{if(t.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(N,L){N.value&&e.push(N.value)}),r=e.filter((N,L,T)=>T.indexOf(N)==L),e.length){let N={codes:e,_workpoint:V.session.store.id_viz};console.log(N),u.loading.show({message:"Procesando archivo, espera.."}),Ue.getMassive(N).then(L=>{let T=L.data,W=0,j=n(T);if(T.fails.notFound.map(Q=>c.value.wndNotExist.push(Q)),c.value.wndGetRows=j.add.length,c.value.state=!c.value.state,c.value.wndGetAdded=j.add,c.value.wndNoDataFound=j.notFound,c.value.wndNoDataFound.length>0){let Q=c.value.wndNoDataFound.length;c.value.message=Q<=1?"El producto no contiene precios.":"Los productos no contienen precios."}j.add.map(Q=>{let ae=R(Q.prices,Q.pieces);Q._copies=1,Q.type=ae.type,Q.usedPrices=ae.prices,d.value.push(Q),W++}),W&&!T.fails.notFound.length&&r.length==e.length?u.notify({message:`Etiquetas generadas: ${W}`,color:"positive",icon:"done",timeout:1e3}):(p=e.length-r.length,c.value.messageRepeat=p<=1?`${p} producto se repitio. Favor de validar su documento antes de subirlo.`:`${p} productos se repitieron. Favor de validar su documento antes de subirlo.`),console.log(c.value),u.loading.hide()}).catch(L=>{console.log(L),u.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else u.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},R=(o,t)=>{let e=[...o];e.sort((v,U)=>v.pivot._type-U.pivot._type),console.log(e);const r=e.find(v=>v.pivot._type==4),p=e.find(v=>v.pivot._type==1);if(r.pivot.price==p.pivot.price){let v={id:0,alias:"OFERTA",name:"Oferta",pivot:{price:e[0].pivot.price},used:!0};return console.log("oferta"),{type:"off",prices:[v]}}else return console.log("estandar"),{type:"std",prices:e}},fe=o=>{switch(o){case"off":return"orange-9";case"std":return"green-9"}},ge=async()=>{if(C.value.val.id==2){u.loading.show({message:"Obteniendo Secciones"});let o={_rol:V.session.credentials._rol,_workpoint:V.session.store.id_viz};console.log(o);const t=await ie.index(o);t.fail?console.log(t):(console.log(t),P.value=t),u.loading.hide()}},be=async o=>{u.loading.show({message:"Obteniendo Productos"});let t={section:o.selected,workpoint:V.session.store.id_viz,update:q.value};const e=await ie.obtProductSections(t);if(e.fail)console.log(e);else{console.log(e);let r={products:e};r.products.length>0?(n(r).add.map(v=>{let U=d.value.findIndex($=>$.id==v.id);if(U>=0)d.value[U]._copies++;else{let $=R(v.prices,v.pieces);v._copies=1,v.type=$.type,v.usedPrices=$.prices,d.value.push(v)}}),u.loading.hide()):(u.loading.hide(),u.notify({message:"No Hay Articulos Ubicados x(",type:"negative",position:"center",icon:"mood_bad"}))}};return Ve(()=>d.value,o=>{localStorage.setItem("applabels",JSON.stringify(o))},{deep:!0}),Ce(()=>{const o=localStorage.getItem("applabels");o&&(d.value=JSON.parse(o))}),Qe(()=>{}),(o,t)=>(m(),A(Ae,{padding:""},{default:a(()=>[l(H,{class:"my-card"},{default:a(()=>[l(F,null,{default:a(()=>[i("div",Ge,[t[10]||(t[10]=i("div",{class:"text-bold"},"Selecciona los Precios",-1)),l(Me,{options:w.value.opts,type:"toggle",modelValue:w.value.val,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value.val=e),inline:""},null,8,["options","modelValue"])]),i("div",He,[l(_,{class:"col",outline:"",color:"primary",icon:"upload_file",title:"Subir Etiquetas",onClick:ve}),l(O,{spaced:"",inset:"",vertical:"",dark:""}),d.value.length>0?(m(),h("div",Je,[i("div",Ke,[l(_,{class:"col",outline:"",color:"primary",icon:"delete",title:"Eliminar Etiquetas",onClick:t[1]||(t[1]=e=>y.value.state=!y.value.state)}),l(O,{spaced:"",inset:"",vertical:"",dark:""}),l(_,{class:"col",outline:"",color:"primary",icon:"download",title:"Descargar Etquetas",onClick:t[2]||(t[2]=e=>g.value.state=!g.value.state)})])])):I("",!0)]),i("input",{type:"file",ref_key:"inputFile",ref:S,id:"inputFile",onInput:me,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}),l(F,null,{default:a(()=>[i("div",We,[l(oe,{style:{width:"80px"},modelValue:C.value.val,"onUpdate:modelValue":[t[3]||(t[3]=e=>C.value.val=e),ge],options:C.value.opts,filled:"",dense:"","hide-dropdown-icon":""},null,8,["modelValue","options"]),l(O,{spaced:"",inset:"",vertical:"",dark:""}),C.value.val.id==1?(m(),h("div",Ye,[l(Ee,{onInput:M,onAgregar:ue,with_prices:""})])):I("",!0),C.value.val.id==2?(m(),h("div",Xe,[P.value.length>0?(m(),h("div",Ze,[l(X,{dense:""},{default:a(()=>[l(Z,null,{default:a(()=>[l(G,null,{default:a(()=>[l(z,{caption:""},{default:a(()=>t[11]||(t[11]=[B("ACT HOY")])),_:1}),l(z,{class:"flex flex-center"},{default:a(()=>[l(de,{dense:"",modelValue:q.value,"onUpdate:modelValue":t[4]||(t[4]=e=>q.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(oe,{class:"col",modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=e=>k.value=e),options:P.value,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),l(O,{spaced:"",inset:"",vertical:"",dark:""}),k.value?(m(),A(je,{key:0,class:"col",sections:k.value.sections,onObtProducts:be},null,8,["sections"])):I("",!0)])):I("",!0)])):I("",!0)])]),_:1})]),_:1}),l(O,{spaced:"",inset:"",vertical:"",dark:""}),l(Le,{rows:d.value,"row-key":"name",grid:"",filter:f.value.filter,pagination:f.value.pagination,"no-data-label":"''"},{"top-right":a(()=>[l(De,{borderless:"",dense:"",debounce:"300",modelValue:f.value.filter,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value.filter=e),placeholder:"Buscar"},{append:a(()=>[l(Pe,{name:"search"})]),_:1},8,["modelValue"])]),item:a(e=>[i("div",et,[l(H,{class:"my-card"},{default:a(()=>[l(F,null,{default:a(()=>{var r;return[l(Ne,{size:"sm",class:"fixed-right absolute-right text-bold text-white text-uppercase",color:fe(e.row.type)},{default:a(()=>[B(b(e.row.type),1)]),_:2},1032,["color"]),i("div",tt,b(e.row.code),1),i("div",lt,b(e.row.name),1),i("div",ot,b(e.row.label),1),i("div",at,"Longitud: "+b(e.row.large),1),i("div",st,"Ubicacion: "+b((r=e.row.locations)==null?void 0:r.map(p=>p.path).join("/")),1),l(O,{spaced:"",inset:"",vertical:"",dark:""}),i("div",nt,[(m(!0),h(J,null,K(e.row.usedPrices.filter(p=>w.value.val.includes(p.id)),(p,v)=>(m(),h("div",{class:"col items-start",key:v},[i("div",it,b(p.alias),1),i("div",dt,b(p.pivot.price),1)]))),128))])]}),_:2},1024),l(te,{align:"center"},{default:a(()=>[l(_,{flat:"",icon:"delete",color:"negative",onClick:r=>ce(e.row)},null,8,["onClick"]),l(_,{flat:"",icon:"add",onClick:r=>e.row._copies++},null,8,["onClick"]),i("div",null,[t[12]||(t[12]=i("div",{class:"text-caption text--2"},"copias",-1)),i("div",rt,b(e.row._copies),1)]),l(_,{flat:"",icon:"remove",onClick:r=>e.row._copies<=1?"":e.row._copies--},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),bottom:a(e=>[l(Oe,{position:"bottom",class:"full-width",offset:[0,18]},{default:a(()=>[i("div",ut,[l(Ie,{rounded:"",flat:"",color:"primary"},{default:a(()=>[e.pagesNumber>2?(m(),A(_,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):I("",!0),l(_,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),l(_,{flat:"",disable:"","no-caps":""},{default:a(()=>[B(b(e.pagination.page)+" / "+b(e.pagesNumber),1)]),_:2},1024),l(_,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(m(),A(_,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):I("",!0)]),_:2},1024)])]),_:2},1024)]),"no-data":a(()=>t[13]||(t[13]=[])),_:1},8,["rows","filter","pagination"]),l(ee,{modelValue:y.value.state,"onUpdate:modelValue":t[7]||(t[7]=e=>y.value.state=e),persistent:""},{default:a(()=>[l(H,null,{default:a(()=>[l(F,{class:"row items-center"},{default:a(()=>[l(Se,{icon:"warning",color:"white","text-color":"negative"}),t[14]||(t[14]=i("div",{class:"q-ml-sm"},"Se eliminaran todos los articulos de la lista ",-1))]),_:1}),l(F,null,{default:a(()=>t[15]||(t[15]=[i("div",{class:"q-ml-sm"},"Deseas Continuar?",-1)])),_:1}),l(te,{align:"right"},{default:a(()=>[se(l(_,{flat:"",label:"No",color:"positive"},null,512),[[ne]]),l(_,{flat:"",label:"Si",color:"negative",onClick:pe})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ee,{modelValue:g.value.state,"onUpdate:modelValue":t[8]||(t[8]=e=>g.value.state=e),persistent:""},{default:a(()=>[l($e,{products:d.value,prices:w.value},null,8,["products","prices"])]),_:1},8,["modelValue"]),l(ee,{modelValue:c.value.state,"onUpdate:modelValue":t[9]||(t[9]=e=>c.value.state=e)},{default:a(()=>[l(H,{class:"my-card",style:{width:"70%"}},{default:a(()=>[l(F,{class:"items-center"},{default:a(()=>[t[16]||(t[16]=i("div",{class:"text-center text-bold"},"Repetidos",-1)),i("div",ct,b(c.value.messageRepeat),1)]),_:1}),l(F,null,{default:a(()=>[t[17]||(t[17]=i("div",{class:"text-center"},"Productos Sin Precio",-1)),l(X,null,{default:a(()=>[(m(!0),h(J,null,K(c.value.wndNoDataFound,(e,r)=>(m(),A(Z,{key:r},{default:a(()=>[l(G,null,{default:a(()=>[l(z,{overline:""},{default:a(()=>[B(b(e.code),1)]),_:2},1024)]),_:2},1024),l(G,null,{default:a(()=>[l(z,{caption:""},{default:a(()=>[B(b(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(F,null,{default:a(()=>[t[18]||(t[18]=i("div",{class:"text-center"},"Productos Sin Existencia",-1)),l(X,null,{default:a(()=>[(m(!0),h(J,null,K(c.value.wndNotExist,(e,r)=>(m(),A(Z,{key:r},{default:a(()=>[l(G,null,{default:a(()=>[l(z,{overline:""},{default:a(()=>[B(b(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(te,{align:"right"},{default:a(()=>[se(l(_,{flat:"",label:"OK",color:"primary"},null,512),[[ne]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ht as default};
