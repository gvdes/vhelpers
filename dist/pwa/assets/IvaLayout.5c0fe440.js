import{a as R,d as x,e as d,b as B,Q as J}from"./QList.b00bb26a.js";import{Q as W}from"./QHeader.aba21099.js";import{u as O,r as p,c as q,K as X,o as v,d as k,w as l,e,al as r,a0 as f,h as F,Q as w,f as n,aG as Y,aH as Z,g as P,a3 as N,a as ee,ak as le,a1 as L,S as ae,U as te}from"./index.1026e154.js";import{Q as U,a as h,d as oe}from"./QSelect.176610e8.js";import{Q as A}from"./QInput.8fc10693.js";import{Q as z}from"./QForm.881edb78.js";import{Q as se}from"./QToolbar.fa08f914.js";import{Q as ne}from"./QPage.79b8b315.js";import{Q as ue,a as ie}from"./QLayout.4a68eaaf.js";import{_ as re}from"./UserToolbar.ebb42abf.js";import{a as de,b as H}from"./axios.31eaf86d.js";import{u as pe}from"./use-quasar.c0ab2370.js";import{Q as me}from"./QCardActions.81d7d66c.js";import{Q as K}from"./QCard.f4a98112.js";import{Q as M}from"./QCardSection.def53aa8.js";import"./use-key-composition.50452a46.js";import"./QResizeObserver.a799a20c.js";import"./QScrollObserver.5fe9a1d6.js";import"./QDrawer.d48f979f.js";import"./use-checkbox.ac7306fa.js";import"./QExpansionItem.0fb7d334.js";import"./ClosePopup.7ba64d8e.js";import"./auth.2561c065.js";const ve={__name:"Ticket",props:{data:{type:Object,default:null}},emits:["openCashDesk"],setup(S,{emit:V}){const m=S,I=O(),$=V,s=p(m.data),u=p(null),y=["6%","8%","16%"],_={"6%":.06,"8%":.08,"16%":.16},b=p({body:null,val:null}),c=p(m.data.total),t=q(()=>{if(u.value&&s.value){let D=_[u.value],a=parseFloat(c.value).toFixed(2);return parseFloat((a*D).toFixed(2))}return 0}),i=q(()=>c.value>m.data.total),G=()=>{$("openCashDesk",{_inc:t.value,_iva:_[u.value],impresora:b.value.val.ip_address,_monto:c.value}),console.log(c.value)};return X(()=>{console.log("El componente ha muerto!!")}),(async()=>{let D=I.session.store.id;console.log(D);try{let a=await de.get(`/cashier/getPrinters/${D}`);a.status==200&&(b.value.body=a.data,console.log("Impresoras listas :)"))}catch(a){console.log(a),$q.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}})(),(D,a)=>(v(),k(K,{style:{"min-width":"400px"},flat:"",bordered:""},{default:l(()=>[e(R,{bordered:""},{default:l(()=>[e(x,null,{default:l(()=>[e(d,null,{default:l(()=>a[3]||(a[3]=[r("Ticket")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.ticket),1)]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(d,null,{default:l(()=>a[4]||(a[4]=[r("Cliente")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.cliente),1)]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(d,null,{default:l(()=>a[5]||(a[5]=[r("Fecha")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.fecha),1)]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(d,null,{default:l(()=>a[6]||(a[6]=[r("Total")])),_:1}),e(d,null,{default:l(()=>[r("$ "+f(s.value.total),1)]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(d,null,{default:l(()=>a[7]||(a[7]=[r("Impresora")])),_:1}),e(d,null,{default:l(()=>[e(U,{dense:"",modelValue:b.value.val,"onUpdate:modelValue":a[0]||(a[0]=o=>b.value.val=o),options:b.value.body,label:"Impresora","option-label":"name",filled:"",autofocus:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(B),e(x,null,{default:l(()=>[e(d,null,{default:l(()=>a[8]||(a[8]=[r("Monto")])),_:1}),e(d,null,{default:l(()=>[e(A,{dense:"",modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value=o),type:"number",label:"Monto",filled:"",autofocus:"","error-message":"El Monto a facturar es mayor que el total de el ticket :x",error:i.value},null,8,["modelValue","error"])]),_:1})]),_:1}),e(B),b.value.val&&!i.value?(v(),k(x,{key:0,class:"bg-deep-purple-1"},{default:l(()=>[e(d,null,{default:l(()=>a[9]||(a[9]=[r("IVA")])),_:1}),e(d,null,{default:l(()=>[e(U,{dense:"",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value=o),options:y,label:"Seleccione",filled:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})):F("",!0),t.value&&!i.value?(v(),k(x,{key:1,class:"bg-deep-purple-1"},{default:l(()=>[e(d,null,{default:l(()=>a[10]||(a[10]=[r("Total")])),_:1}),e(d,null,{default:l(()=>[e(h,{class:"fc-bluegrey text-h4 fw-sbold"},{default:l(()=>[r("$ "+f(t.value),1)]),_:1}),e(h,{caption:""},{default:l(()=>[r("$ "+f((parseFloat(s.value.total)+parseFloat(t.value)).toFixed(2)),1)]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),u.value&&!i.value?(v(),k(me,{key:0,align:"between"},{default:l(()=>[e(w,{color:"primary",label:"Cancelar",flat:"","no-caps":""}),e(w,{color:"primary",label:"Cobrar",onClick:G})]),_:1})):F("",!0)]),_:1}))}},ce={class:"bg-primary row items-center justify-between q-pa-md text-white"},fe={class:"text-h4"},ye={class:"text-right"},be={class:"fw-bold text-h4"},ge={class:"row items-center"},_e={class:"row"},ke={class:"bg-grey-2 row items-stretch justify-between q-pa-sm"},Ve={class:"text-h5 fw-sbold fc-primary"},Qe={class:"text-h6 fs-inc3 fw-bold fc-negative"},xe={__name:"CashDesk",props:{data:{type:Object,default:null},inc:{type:Number,default:0}},emits:["pay"],setup(S,{emit:V}){const m=[{id:"TBA",desc:"Tarjeta Credito/Debito BBVA (Bancomer)"},{id:"TDB",desc:"Transferencia/Deposito BBVA (Bancomer)"},{id:"TSA",desc:"Tarjeta Credito/Debito Santander"},{id:"TDA",desc:"Transferencia/Deposito Santander"}],I=S,$=V,s=p({EFE:0,DIG:{id:null,val:0}}),u=p(I.data),y=p(I.inc),_=q(()=>(parseFloat(s.value.EFE)+parseFloat(s.value.DIG.val)).toFixed(2)),b=()=>{$("pay",s.value)};return(c,t)=>u.value?(v(),k(K,{key:0},{default:l(()=>[n("div",ce,[n("div",null,[t[5]||(t[5]=n("div",{class:"fs-dec3"},"TICKET",-1)),n("div",fe,f(u.value.ticket),1)]),n("div",ye,[t[6]||(t[6]=n("div",{class:"fs-dec3"},"IVA",-1)),n("div",be,"$ "+f(y.value),1)])]),e(z,{class:"q-pa-none",onSubmit:b},{default:l(()=>[e(M,null,{default:l(()=>[n("div",ge,[t[7]||(t[7]=n("div",{class:"col-3"},"Efectivo",-1)),e(A,{class:"col",modelValue:s.value.EFE,"onUpdate:modelValue":t[0]||(t[0]=i=>s.value.EFE=i),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue"]),parseFloat(s.value.EFE)?(v(),k(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:t[1]||(t[1]=i=>s.value.EFE=0)})):F("",!0)])]),_:1}),e(M,null,{default:l(()=>[n("div",_e,[e(U,{class:"col-3",modelValue:s.value.DIG.id,"onUpdate:modelValue":t[2]||(t[2]=i=>s.value.DIG.id=i),options:m,label:"Terminal","option-value":"id","emit-value":"","option-label":"id",dense:""},{option:l(i=>[e(x,Y(Z(i.itemProps)),{default:l(()=>[e(d,null,{default:l(()=>[e(h,{class:"text-bold"},{default:l(()=>[r(f(i.opt.id),1)]),_:2},1024),e(h,{caption:""},{default:l(()=>[r(f(i.opt.desc),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),e(A,{class:"col",modelValue:s.value.DIG.val,"onUpdate:modelValue":t[3]||(t[3]=i=>s.value.DIG.val=i),type:"number",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue"]),parseFloat(s.value.DIG.val)?(v(),k(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:t[4]||(t[4]=i=>{s.value.DIG.val=0,s.value.DIG.id=null})})):F("",!0)])]),_:1}),e(B),n("div",ke,[n("div",null,[_.value>=y.value?(v(),P(N,{key:0},[t[8]||(t[8]=n("div",{class:"fs-dec1"},"Cambio:",-1)),n("div",Ve,"$ "+f((_.value-y.value).toFixed(2)),1)],64)):(v(),P(N,{key:1},[t[9]||(t[9]=n("div",{class:"fs-dec1"},"Falta:",-1)),n("div",Qe,"$ "+f((y.value-_.value).toFixed(2)),1)],64))]),n("div",null,[_.value>=y.value?(v(),k(w,{key:0,color:"positive",icon:"fas fa-dollar-sign",label:"Pagar",type:"submit",class:"full-height"})):F("",!0)])])]),_:1})]),_:1})):F("",!0)}};const Fe={key:0,class:"text-right"},$e={class:"row justify-center"},Je={__name:"IvaLayout",setup(S){ee();const V=O(),m=pe(),I=V.series,$=p(null),s=p(""),u=p(null),y=p(0),_=p(0),b=p(0),c=p({state:!1}),t=p(null),i=q(()=>$.value&&s.value.length),G=async()=>{u.value=null,y.value=0;let a=$.value,o=s.value,C=`http://${V.session.store.ip_address}/access/public/iva/ticket?serie=${a}&folio=${o}`;H.get(C).then(Q=>{u.value=Q.data}).catch(Q=>{console.log(Q);let E=Q.response.status,T=Q.response.data;console.log(E),console.log(T),m.notify({html:!0,message:T.message,color:"negative",position:"center"})})},j=({_inc:a,_iva:o,impresora:g,_monto:C})=>{console.log(a,o,g,C),t.value=g,y.value=parseFloat(a),_.value=parseFloat(o),b.value=parseFloat(C),c.value.state=!0},D=a=>{console.log("pagando..."),console.log(a);let o=V.session.store.ip_address,g=`${V.session.name} - ${V.session.store.alias}`,C=`http://${o}/access/public/iva/create`,Q={modes:a,by:g,ticket:u.value.ticket,iva:_.value,monto:b.value,impresora:t.value};console.log(Q),m.loading.show({message:"Imprimiendo..."}),console.log(Q),H.post(C,Q).then(E=>{console.log(E.data);let T=E.data;m.loading.hide(),c.value.state=!1,u.iva=null,u.value=null,m.notify({html:!0,color:"positive",position:"center",message:`<span class="fs-inc2"> El ticket <b>${T.ticket}</b> fue generado! </span>`}),T.printed||m.notify({html:!0,color:"negative",position:"top",icon:"fas fa-bugs",message:'<span class="fs-inc2"> No se pudo emitir el ticket, la conexion a la impresora no esta disponible! </span>'})}).catch(E=>{console.log(E),m.loading.hide()})};return(a,o)=>(v(),k(ue,{view:"hHh Lpr fFf"},{default:l(()=>[e(W,{class:le(L(m).dark.isActive?"text-white bg-dark":"text-dark bg-white"),bordered:""},{default:l(()=>[e(re),e(B)]),_:1},8,["class"]),e(ie,null,{default:l(()=>[e(se,{class:"justify-between"},{default:l(()=>[n("div",null,[o[3]||(o[3]=r("Helpers ")),e(ae,{name:"navigate_next",color:"primary"}),o[4]||(o[4]=r()),o[5]||(o[5]=n("span",{class:"text-h6"},"IVA",-1))]),e(w,{color:"primary",icon:"add"},{default:l(()=>[e(oe,null,{default:l(()=>[o[6]||(o[6]=n("div",{class:"q-pa-md text-primary"},"Buscar Folio",-1)),e(B),e(z,{dense:"",onSubmit:G,class:"q-gutter-md q-pa-md"},{default:l(()=>[e(U,{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=g=>$.value=g),options:L(I),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(A,{modelValue:s.value,"onUpdate:modelValue":o[1]||(o[1]=g=>s.value=g),type:"number",label:"Folio"},null,8,["modelValue"]),i.value?(v(),P("div",Fe,[e(w,{type:"submit",color:"primary",icon:"search"})])):F("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(ne,{class:"",padding:""},{default:l(()=>[n("div",$e,[e(te,{name:"bounce"},{default:l(()=>[u.value?(v(),k(ve,{key:0,data:u.value,onOpenCashDesk:j},null,8,["data"])):F("",!0)]),_:1})]),e(J,{modelValue:c.value.state,"onUpdate:modelValue":o[2]||(o[2]=g=>c.value.state=g)},{default:l(()=>[e(xe,{data:u.value,inc:y.value,onPay:D},null,8,["data","inc"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Je as default};
