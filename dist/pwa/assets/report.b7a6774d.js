import{b as I,Q as h}from"./QList.c824076e.js";import{aH as k,r as m,o as F,d as P,w as c,f as E,a0 as Q,e as l,Q as R,E as _}from"./index.4500d7fe.js";import{Q as v}from"./QSelect.d826b84c.js";import{Q as x}from"./QInput.4cb8bbc9.js";import{Q as G}from"./QTable.973050a0.js";import{Q as y}from"./QDate.06e50da5.js";import{Q as V,a as f}from"./axios.f7e65809.js";import{Q as H}from"./QCardActions.6e154abe.js";import{Q as $}from"./QPage.5ba56883.js";import{R as T}from"./RestockApi.a8ad93d7.js";import{u as B}from"./use-quasar.996ba2dd.js";import{u as Y}from"./Restock.5dbaf1dd.js";import{d as j}from"./dayjs.min.cbcf888d.js";import{E as M}from"./exceljs.min.9e24d01d.js";import"./QLinearProgress.8669263a.js";import"./QCheckbox.2cb4fb11.js";import"./use-render-cache.3aae9b27.js";import"./date.dea28b1a.js";import"./QToolbar.cfc799e1.js";import"./QForm.7ad70b98.js";import"./QRadio.ad57af2e.js";import"./QTr.d06fc529.js";import"./QPopupEdit.c81dc8a2.js";import"./QLayout.186e1141.js";import"./QScrollObserver.59bb5f24.js";import"./QResizeObserver.ce99b3ba.js";import"./ClosePopup.f4a99dfb.js";import"./QDrawer.b1a5d99d.js";import"./jspdf.plugin.autotable.16a0fed3.js";import"./_commonjsHelpers.88e99c8f.js";import"./browser.eff7c919.js";/* empty css                                                       */const q={class:"text-center text-h6 text-bold"},W={class:"row"},J={class:"q-pa-md"},Ue={__name:"report",setup(z){const p=B();k();const N=Y(),s=m({workpoints:[],cedis:null,val:null}),C=m(!1),t=m({from:null,to:null}),d=m({salidas:null,entradas:null}),r=m({rows:[],filter:""}),O=async()=>{N.setShowLYT(!1);let i=new Date,e=j(i).format("YYYY/MM/DD");t.value={from:e,to:e},console.log(e);const o=await T.getStores();o.status==200?(console.log(o.data),s.value.workpoints=o.data,s.value.cedis=o.data.filter(a=>a.id==1)[0]):console.log(o)},L=async()=>{r.value.rows=[],p.loading.show({message:"Obteniendo datos"});let i={cedis:s.value.cedis,sucursal:s.value.val,fechas:t.value};console.log(i);const e=await T.getData(i);console.log(e),e.status==200?(console.log(e.data),d.value.salidas=e.data.salidas,d.value.entradas=e.data.entradas,p.loading.hide(),S()):alert(e)},S=()=>{p.loading.show({message:"Haciendo Match"}),d.value.entradas.sort((e,o)=>o.ARTICULOS!==e.ARTICULOS?o.ARTICULOS.localeCompare(e.ARTICULOS):o.REFERENCIA.localeCompare(e.REFERENCIA)),d.value.salidas.sort((e,o)=>o.ARTICULOS!==e.ARTICULOS?o.ARTICULOS.localeCompare(e.ARTICULOS):o.PARTICION.localeCompare(e.PARTICION));const i=new Set;d.value.entradas.forEach(e=>{const o=d.value.salidas.find((a,n)=>{console.log(`P-${a.PARTICION}`),console.log(e.REFERENCIA);const A=a.ARTICULOS===e.ARTICULOS&&`P-${a.PARTICION}`===e.REFERENCIA;return console.log(A),A&&i.add(n),A});if(o){const a=e.CANTIDAD*e.PRECIO,n=o.CANTIDAD*o.PRECIO,A=o.ARTICULOS===e.ARTICULOS,u=o.CANTIDAD===e.CANTIDAD,U=o.PRECIO===e.PRECIO,b=n===a;r.value.rows.push({SALIDA:o.FACTURA,FECHA:o.FECHAYHORA,REFERENCIA:o.REFERENCIA,CLIENTE:o.NOMBRECLIENTE,CODIGO:o.ARTICULOS,DESCRIPCION:o.DESCRIPCION,CANTIDAD:Number(o.CANTIDAD).toFixed(2),codigoIGUAL:A?"verdadero":"falso",CANTIDADIGUAL:u?"verdadero":"falso",PRECIOIGUAL:U?"verdadero":"falso",TOTALIGUAL:b?"verdadero":"falso",ENTRADA:e.FACTURA,ENTRADA_SALIDA:e.SALIDA,ENTRADA_FECHA:e.FECHA,ENTRADA_CODIGO:e.ARTICULOS,ENTRADA_DESCRIPCION:e.DESCRIPCION,ENTRADA_CANTIDAD:Number(e.CANTIDAD).toFixed(2)});const D=d.value.salidas.indexOf(o);D>-1&&d.value.salidas.splice(D,1)}else e.CANTIDAD*e.PRECIO,r.value.rows.push({SALIDA:"",FECHA:"",REFERENCIA:"",CLIENTE:"",CODIGO:"",DESCRIPCION:"",CANTIDAD:"",codigoIGUAL:!1,CANTIDADIGUAL:!1,PRECIOIGUAL:!1,TOTALIGUAL:!1,ENTRADA:e.FACTURA,ENTRADA_SALIDA:e.SALIDA,ENTRADA_FECHA:e.FECHA,ENTRADA_CODIGO:e.ARTICULOS,ENTRADA_DESCRIPCION:e.DESCRIPCION,ENTRADA_CANTIDAD:Number(e.CANTIDAD).toFixed(2)})}),d.value.salidas.forEach((e,o)=>{i.has(o)||(e.CANTIDAD*e.PRECIO,r.value.rows.push({SALIDA:e.FACTURA,FECHA:e.FECHAYHORA,REFERENCIA:e.REFERENCIA,CLIENTE:e.NOMBRECLIENTE,CODIGO:e.ARTICULOS,DESCRIPCION:e.DESCRIPCION,CANTIDAD:Number(e.CANTIDAD).toFixed(2),codigoIGUAL:!1,CANTIDADIGUAL:!1,PRECIOIGUAL:!1,TOTALIGUAL:!1,ENTRADA:"",ENTRADA_SALIDA:"",ENTRADA_FECHA:"",ENTRADA_CODIGO:"",ENTRADA_DESCRIPCION:"",ENTRADA_CANTIDAD:""}))}),p.loading.hide()},g=async()=>{console.log(t.value),C.value=!1,s.value.val=null,r.value.rows=[]},w=async()=>{const i=new M.Workbook,e=i.addWorksheet(`Comparativo ${s.value.val.name}`);console.log(),e.addTable({name:"Comparativo",ref:"A1",headerRow:!0,totalsRow:!1,style:{showRowStripes:!0},columns:Object.keys(r.value.rows[0]).map(a=>({name:a,filterButton:!0})),rows:r.value.rows.map(a=>Object.values(a))}),e.columns.forEach(a=>{let n=0;a.eachCell({includeEmpty:!0},A=>{const u=A.value?A.value.toString().length:10;u>n&&(n=u)}),a.width=n<10?10:n}),(async()=>{const a=await i.xlsx.writeBuffer(),n=new Blob([a],{type:"application/octet-stream"}),A=URL.createObjectURL(n),u=document.createElement("a");u.href=A,u.download=`Comparativo ${s.value.val.name} ${typeof t.value=="object"?`Del ${t.value.from} a ${t.value.to}`:t.value}.xlsx`,document.body.appendChild(u),u.click(),document.body.removeChild(u)})()};return O(),(i,e)=>(F(),P($,{padding:""},{default:c(()=>[E("div",q,"Reporte "+Q(t.value&&t.value.from?`Del ${t.value.from} a ${t.value.to}`:t.value),1),l(I,{spaced:"",inset:"",vertical:"",dark:""}),E("div",W,[l(R,{color:"primary",icon:"event",onClick:e[0]||(e[0]=o=>C.value=!C.value),flat:"",rounded:"",dense:""}),l(I,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{dense:"",modelValue:s.value.cedis,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.cedis=o),options:s.value.workpoints,label:"Cedis",class:"col","option-label":"name",disable:!0,outlined:""},null,8,["modelValue","options"]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{dense:"",modelValue:s.value.val,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.value.val=o),L],options:s.value.workpoints,label:"Sucursal",class:"col","option-label":"name",outlined:"","option-disable":o=>o.id==1},null,8,["modelValue","options","option-disable"])]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),l(G,{title:"Comparativo",rows:r.value.rows,filter:r.value.filter},{"top-right":c(()=>[l(x,{borderless:"",dense:"",debounce:"300",modelValue:r.value.filter,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.filter=o),placeholder:"Buscar"},{append:c(()=>[l(_,{name:"search"})]),_:1},8,["modelValue"]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),l(R,{color:"primary",icon:"ios_share",onClick:w,flat:"",disable:r.value.rows.length<=0},null,8,["disable"])]),_:1},8,["rows","filter"]),l(h,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=o=>C.value=o)},{default:c(()=>[l(V,{class:"my-card"},{default:c(()=>[l(f,null,{default:c(()=>[E("div",J,[e[7]||(e[7]=E("div",{class:"q-pb-sm"},null,-1)),l(y,{modelValue:t.value,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),l(f,null,{default:c(()=>[l(H,{align:"right"},{default:c(()=>[l(R,{flat:"",icon:"close",color:"negative",onClick:e[5]||(e[5]=o=>C.value=!C.value)}),l(R,{flat:"",icon:"check",color:"positive",onClick:g})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ue as default};
