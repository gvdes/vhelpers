import{Q as B}from"./QInput.05b060b5.js";import{Q as E}from"./QForm.58a9e4f8.js";import{a as _,d as R}from"./QSelect.9a88dcc4.js";import{Q as I,a as D,e as N,d as F}from"./QList.d00c8370.js";import{Q as T}from"./QTable.d9f133cd.js";import{Q as z}from"./QPage.795082c6.js";import{Q as k}from"./QCardSection.8133d3e1.js";import{aH as A,a as j,u as H,r as b,c as L,o as S,g as U,e,w as i,a3 as M,f as m,an as G,a4 as y,d as J,ak as p,a0 as f,Q as x,am as K}from"./index.5cd8bf7f.js";import{Q as O}from"./QCardActions.7f616b43.js";import{Q as W}from"./QCard.cc9a043d.js";import{C as X}from"./ClosePopup.f274f120.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.aafb218b.js";import{u as Y}from"./Restock.70ed9d97.js";import{u as Z}from"./use-quasar.3c11604f.js";import{$sktRestock as C}from"./socket.3fae67a0.js";import{_ as tt}from"./PrinterSelect.32d98bb6.js";import"./use-key-composition.28d192d9.js";import"./QLinearProgress.6e950e52.js";import"./QCheckbox.4d9ed756.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.f821ef00.js";import"./QToolbar.d85315dd.js";import"./QRadio.1c5f09dd.js";import"./QTd.e8469fc1.js";import"./QPopupEdit.9dd87643.js";import"./QTr.bd0921d9.js";import"./QLayout.1663eac9.js";import"./QScrollObserver.ae5844cd.js";import"./QResizeObserver.4adcbba6.js";import"./QDrawer.a1d39b14.js";import"./jspdf.plugin.autotable.d3cdd287.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */import"./QBtnGroup.f738d57b.js";const et={class:"flex justify-center"},ot={class:"text-center",style:"width: 50%;"},it={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},at={class:"text-bold"},Lt={__name:"driving",setup(st){A();const P=j(),n=Y(),u=Z(),c=H(),l=b(null),V=b({rowsPerPage:[0]}),r=b({state:!1,val:null}),w=L(()=>n.partitions.filter(s=>{const t=["chf","amc","vld","root","jch","gce"].includes(c.session.rol),o=s.requisition.from.id==c.session.store.id_viz,a=s.requisition.to.id==c.session.store.id_viz,d=["gen","aux","alm","root","recp","gce"].includes(c.session.rol);return t&&a?(n.setTitle("Por Enviar"),n.setButtonShow(!1),s._status===6):o&&d?(n.setTitle("En camino"),n.setButtonShow(!0),s._status===7):!1})),$=async s=>{u.loading.show({message:"..."}),console.log(s.ip),console.log(r.value);const t=await g.printForPartition({ip:s.ip,port:s._port,_partition:r.value.val.id,_workpoint_to:r.value.val._workpoint_to});console.log(t),t.status==200?(t.data?u.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):u.notify({message:`Sin conexion a <b>${s.name} <small>(${s.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),u.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},Q=async()=>{if(w.value.findIndex(t=>t.id==l.value)>=0){u.loading.show({message:"Cambiando Estado"});let t=Number(n.partitions.find(d=>d.id==l.value)._status)+Number(1),o={partition:l.value,chofi:c.session.credentials.staff.id,state:t};console.log(o);let a=null;if(t==7?a=await g.SaveChofi(o):t==8&&(a=await g.saveReceipt(o)),console.log(a),a.status==200){let d=n.partitions.findIndex(v=>v.id==a.data.partition.id);if(d>=0){if(n.partitions.splice(d,1,a.data.partition),a.data.partitionsEnd>a.data.partition.requisition._status){let v={id:a.data.partition._requisition,state:a.data.partitionsEnd};const h=await g.nextState(v);C.emit("order_refresh",{order:h.data}),console.log(h.data)}C.emit("orderpartition_refresh",{order:a.data.partition})}l.value=null,r.value={state:!1,val:null},t==8&&P.push("/distribute/checkin"),u.loading.hide()}else alert(`Error ${a.status}: ${a.data} 2`)}else u.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),l.value=null};init();const q=s=>{switch(s){case 4:return"bg-blue-11";case 7:return"bg-red-11";case 5:return"bg-purple-11";case 9:return"bg-green-11";case 23:return"bg-yellow-11";case 13:return"bg-bg-brown-12";default:return""}};return(s,t)=>(S(),U(M,null,[e(z,{padding:""},{default:i(()=>[m("div",null,[m("div",et,[m("div",ot,[e(E,{onSubmit:Q},{default:i(()=>[e(B,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value=o),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),e(T,{rows:w.value,"row-key":"name",grid:"",pagination:V.value,"hide-bottom":""},{item:i(o=>[m("div",it,[e(D,{bordered:"",class:G(q(o.row.requisition.from.id))},{default:i(()=>[y((S(),J(F,{clickable:"",onClick:()=>{r.value.state=!0,r.value.val=o.row}},{default:i(()=>[e(N,null,{default:i(()=>[e(_,{class:"text-center text-bold"},{default:i(()=>[p(f(o.row.id),1)]),_:2},1024),e(_,{class:"text-center text-overline text-caption"},{default:i(()=>[m("span",at,f(o.row.requisition.from.name),1),p(" (P: "+f(o.row.requisition.id)+")",1)]),_:2},1024),e(_,{class:"text-center text-bold"},{default:i(()=>[p(f(o.row.status.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[K]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),e(I,{modelValue:r.value.state,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value.state=o),persistent:""},{default:i(()=>[e(W,null,{default:i(()=>[e(k,{class:"text-bold text-h5 items-center"},{default:i(()=>[p(" Particion "+f(r.value.val.id),1)]),_:1}),e(k,{class:"text-center"},{default:i(()=>t[3]||(t[3]=[p(" Que Desesas Hacer ? ")])),_:1}),e(O,{align:"center"},{default:i(()=>[y(e(x,{flat:"",icon:"close",color:"negative"},null,512),[[X]]),e(x,{flat:"",icon:"print",color:"primary"},{default:i(()=>[e(R,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:i(()=>[e(tt,{onSelectedPartition:$,partition:!0})]),_:1})]),_:1}),e(x,{flat:"",icon:"send",color:"positive",onClick:t[1]||(t[1]=()=>{l.value=r.value.val.id,Q()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Lt as default};
