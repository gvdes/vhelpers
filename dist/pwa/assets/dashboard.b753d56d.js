import{Q as Le}from"./QDate.05a71f95.js";import{a as I,Q as X}from"./QCard.e7ecc7e7.js";import{i as ce,aR as Ve,aS as Qe,j as G,c as q,U as Oe,l as De,T as Fe,r as b,q as He,p as Ge,aY as Ye,X as se,ag as Xe,b6 as Je,aL as Ke,aH as xe,at as We,o as p,g as S,e,w as t,f as i,a0 as g,a1 as W,h as N,d as j,Q as P,a3 as T,a4 as J,a6 as x,S as ae,a5 as Z,a8 as Ze,a7 as je,a as qe,u as Pe,a9 as et,ax as tt,m as at}from"./index.c896f958.js";import{Q as re}from"./QCardActions.b8667083.js";import{f as lt,i as ot,a as M,Q as ne,b as ee,c as Q,d as K}from"./QList.89e155b2.js";import{a as st,b as it,u as me}from"./axios.48c10d8c.js";import{d as fe}from"./dayjs.min.cbcf888d.js";import{u as pe}from"./Restock.0467f5e6.js";import{$sktRestock as Ae}from"./socket.3fae67a0.js";import{Q as de}from"./QInput.d5f71caa.js";import{Q as le,a as we}from"./QTable.b05ea11a.js";import{Q as ve,a as ge}from"./QTr.4663fa7d.js";import{b as nt,d as be,a as L}from"./QSelect.ea5b71d1.js";import{Q as rt}from"./QPage.80461780.js";import{R as H}from"./RestockApi.d062923a.js";import{Q as dt,a as ye,b as ut,c as _e}from"./QTabPanels.16d3f351.js";import{Q as ct}from"./QToggle.328708c0.js";import{Q as mt}from"./QBadge.576ba8d3.js";import{C as ke}from"./ClosePopup.6a30e99e.js";import{I as Ce}from"./invoices.6117a7ba.js";import"./browser.eff7c919.js";import{_ as Se}from"./PrinterSelect.5ee7a074.js";import"./use-render-cache.3aae9b27.js";import"./date.e83c839c.js";import"./_commonjsHelpers.88e99c8f.js";import"./QLinearProgress.721fc67a.js";import"./QCheckbox.87af9e3a.js";import"./QResizeObserver.d1dc126f.js";import"./touch.9135741d.js";import"./jspdf.plugin.autotable.ca2ca256.js";import"./QBtnGroup.0fcdef25.js";const pt='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var ft=ce({name:"QSpinnerGrid",props:Ve,setup(o){const{cSize:y,classes:c}=Qe(o);return()=>G("svg",{class:c.value,fill:"currentColor",width:y.value,height:y.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:pt})}}),vt=ce({name:"QInnerLoading",props:{...st,...lt,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(o,{slots:y}){const c=De(),f=it(o,c.proxy.$q),{transitionProps:_,transitionStyle:w}=ot(o),v=q(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(f.value===!0?" q-inner-loading--dark":"")),n=q(()=>"q-inner-loading__label"+(o.labelClass!==void 0?` ${o.labelClass}`:""));function k(){const h=[G(Fe,{size:o.size,color:o.color})];return o.label!==void 0&&h.push(G("div",{class:n.value,style:o.labelStyle},[o.label])),h}function u(){return o.showing===!0?G("div",{class:v.value,style:w.value},y.default!==void 0?y.default():k()):null}return()=>G(Oe,_.value,u)}});const gt='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var bt=ce({name:"QSpinnerDots",props:Ve,setup(o){const{cSize:y,classes:c}=Qe(o);return()=>G("svg",{class:c.value,fill:"currentColor",width:y.value,height:y.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:gt})}});const he=XMLHttpRequest,Ee=he.prototype.open,yt=["top","right","bottom","left"];let ue=[],te=0;function _t({p:o,pos:y,active:c,horiz:f,reverse:_,dir:w}){let v=1,n=1;return f===!0?(_===!0&&(v=-1),y==="bottom"&&(n=-1),{transform:`translate3d(${v*(o-100)}%,${c?0:n*-200}%,0)`}):(_===!0&&(n=-1),y==="right"&&(v=-1),{transform:`translate3d(${c?0:w*v*-200}%,${n*(o-100)}%,0)`})}function kt(o,y){return typeof y!="number"&&(o<25?y=Math.random()*3+3:o<65?y=Math.random()*3:o<85?y=Math.random()*2:o<99?y=.6:y=0),nt(o+y,0,100)}function xt(o){te++,ue.push(o),!(te>1)&&(he.prototype.open=function(y,c){const f=[],_=()=>{ue.forEach(v=>{(v.hijackFilter.value===null||v.hijackFilter.value(c)===!0)&&(v.start(),f.push(v.stop))})},w=()=>{f.forEach(v=>{v()})};this.addEventListener("loadstart",_,{once:!0}),this.addEventListener("loadend",w,{once:!0}),Ee.apply(this,arguments)})}function ht(o){ue=ue.filter(y=>y.start!==o),te=Math.max(0,te-1),te===0&&(he.prototype.open=Ee)}var wt=ce({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:o=>yt.includes(o)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(o,{emit:y}){const{proxy:c}=De(),f=b(0),_=b(!1),w=b(!0);let v=0,n=null,k;const u=q(()=>`q-loading-bar q-loading-bar--${o.position}`+(o.color!==void 0?` bg-${o.color}`:"")+(w.value===!0?"":" no-transition")),h=q(()=>o.position==="top"||o.position==="bottom"),B=q(()=>h.value===!0?"height":"width"),O=q(()=>{const V=_.value,U=_t({p:f.value,pos:o.position,active:V,horiz:h.value,reverse:c.$q.lang.rtl===!0&&["top","bottom"].includes(o.position)?o.reverse===!1:o.reverse,dir:c.$q.lang.rtl===!0?-1:1});return U[B.value]=o.size,U.opacity=V?1:0,U}),z=q(()=>_.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":f.value}:{"aria-hidden":"true"});function D(V=300){const U=k;return k=Math.max(0,V)||0,v++,v>1?(U===0&&V>0?A():n!==null&&U>0&&V<=0&&(clearTimeout(n),n=null),v):(n!==null&&clearTimeout(n),y("start"),f.value=0,n=setTimeout(()=>{n=null,w.value=!0,V>0&&A()},_._value===!0?500:1),_._value!==!0&&(_.value=!0,w.value=!1),v)}function C(V){return v>0&&(f.value=kt(f.value,V)),v}function E(){if(v=Math.max(0,v-1),v>0)return v;n!==null&&(clearTimeout(n),n=null),y("stop");const V=()=>{w.value=!0,f.value=100,n=setTimeout(()=>{n=null,_.value=!1},1e3)};return f.value===0?n=setTimeout(V,1):V(),v}function A(){f.value<100&&(n=setTimeout(()=>{n=null,C(),A()},k))}let F;return He(()=>{o.skipHijack!==!0&&(F=!0,xt({start:D,stop:E,hijackFilter:q(()=>o.hijackFilter||null)}))}),Ge(()=>{n!==null&&clearTimeout(n),F===!0&&ht(D)}),Object.assign(c,{start:D,stop:E,increment:C}),()=>G("div",{class:u.value,style:O.value,...z.value})}});const ie=b(null),$e=Ye({isActive:!1},{start:se,stop:se,increment:se,setDefaults:se,install({$q:o,parentApp:y}){if(o.loadingBar=this,this.__installed===!0){o.config.loadingBar!==void 0&&this.setDefaults(o.config.loadingBar);return}const c=b(o.config.loadingBar!==void 0?{...o.config.loadingBar}:{});function f(){$e.isActive=!0}function _(){$e.isActive=!1}const w=Xe("q-loading-bar");Je({name:"LoadingBar",devtools:{hide:!0},setup:()=>()=>G(wt,{...c.value,onStart:f,onStop:_,ref:ie})},y).mount(w),Object.assign(this,{start(v){ie.value.start(v)},stop(){ie.value.stop()},increment(){ie.value.increment.apply(null,arguments)},setDefaults(v){Ke(v)===!0&&Object.assign(c.value,v)}})}}),Ct={class:"text-h6"},St={class:"q-px-lg text-center"},$t={class:"text-h6"},Vt={class:"text-right"},Qt={class:"text-h6"},Dt={class:"text-center col"},jt={class:"text-h6"},qt={key:0,class:"text-center col"},Pt={class:"text-h6"},At={class:"col row"},Et={key:1,class:"col"},It={class:"full-width row items-center"},Nt={class:"col text-dark"},Mt={class:"text-h6"},Tt={class:"text-bold"},Bt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},zt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ut={class:"text-overline text-grey-7"},Rt={key:0},Lt={key:1},Ot={key:0},Ft={key:1},Ht={class:"row"},Gt={key:0,class:"col"},Yt={class:"q-ml-sm text-bold"},Xt={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(o,{emit:y}){const c=me(),f=pe();xe();const _=b([]),w=o,v=b({opts:[],val:[],filter:[]});b({opts:null,val:null,filter:null});const n=b(null),k=y,u=b(w.head),h=b(null),B=b(!0),O=b([]),z=b("supliers"),D=b(null),C=b([]),E=b(!1);b({state:!1}),b({state:!1,key:null});const A=b(null),F=b(!1),V=b({state:!1}),U=b(null),m=b([]),r=b({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,s)=>a+s.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,s)=>a+s.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:l=>l.category.familia.seccion.name,align:"left"},{name:"family",label:"Familia",field:l=>l.category.familia.name,align:"left"},{name:"category",label:"Categoria",field:l=>l.category.name,align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),d=q(()=>C.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));q(()=>D.value&&(D.value.id==2||D.value.id==6)),q(()=>O.value.find(l=>l.id==D.value.id).pivot),q(()=>A.value.map(l=>l._status).includes(6));const $=async()=>{k("loading"),console.log(u.value.id),B.value=!0;let l=await H.order(u.value.id);console.log(l),C.value=l.data.order.products,O.value=l.data.order.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),A.value=l.data.order.partition,D.value=l.data.order.status,h.value=l.data.order,U.value=l.data.order.invoice,_.value=Object.values(l.data.ubicaciones).map(a=>({...a,partition:1})),v.value.opts=f.users,B.value=!1,k("loaded")},oe=()=>{V.value.state=!0},Ie=()=>{F.value=!0},Ne=async()=>{c.loading.show({message:"Cambiando Estado"}),console.log("Iniciando surtido"),k("loading"),E.value=!0;let l=3,a={id:u.value.id,state:l};const s=await H.nextState(a);if(s.status==200){E.value=!1,c.notify({message:`Surtido iniciado para el pedido  ${u.value.id}`,icon:"done",position:"center",color:"teal"});let Y={ubicaciones:_.value,pedido:u.value.id,status:l,_workpoint_to:u.value.to.id,_workpoint_from:u.value.from.id},R=await H.createParitions(Y);console.log(R),R.fail?(console.log(R),alert(`Error ${R.status}: ${R.data} 2`)):(R.forEach(Re=>{Ae.emit("partitionCreate",Re)}),c.loading.hide(),$(),k("fresh",h.value),V.value.state=!1)}else console.log(s),alert(`Error ${s.status}: ${s.data} 1`);k("loaded")},Me=async l=>{c.loading.show({message:"..."}),console.log(l);const a=await H.printForSupply({ip:l.ip,port:l._port,order:u.value.id});console.log(a),a.status==200?(a.data?c.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):c.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),c.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Te=async l=>{c.loading.show({message:"..."}),console.log(l.ip),console.log(n.value);const a=await H.printForPartition({ip:l.ip,port:l._port,_partition:n.value,_workpoint_to:u.value._workpoint_to});console.log(a),a.status==200?(a.data?c.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):c.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),c.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Be=async()=>{console.log("Eliminando Pedido"),k("loading");let l=100,a={id:u.value.id,state:l};const s=await H.nextState(a);s.status==200?(F.value=!1,c.notify({message:`Surtido Cancelado para el pedido  ${u.value.id}`,icon:"close",position:"center",color:"negative"}),k("fresh",h.value,!0)):alert(`Error ${s.status}: ${s.data} 1`),k("loaded")},ze=l=>{console.log(l.id),n.value=l.id},Ue=async l=>{console.log(l);const a=await H.partitionFresh(l.id);console.log(a),a.status==200&&(a.data.order.requisition.from._type!=1?Ce.invoiceFormat(a.data.order):Ce.transferFormat(a.data.order))};return We(()=>m.value=r.value.columns.map(l=>l.name)),$(),(l,a)=>(p(),S(T,null,[e(X,{class:"full-width"},{default:t(()=>[e(I,{class:"row justify-between"},{default:t(()=>[i("div",null,[a[6]||(a[6]=i("div",{class:"text-overline text-grey-7"},"Sucursal",-1)),i("div",Ct,g(u.value.from.alias),1)]),i("div",St,[a[7]||(a[7]=i("div",{class:"text-overline text-grey-7"},"Folio",-1)),i("div",$t,g(u.value.id),1)]),i("div",Vt,[a[8]||(a[8]=i("div",{class:"text-overline text-grey-7"},"Agente",-1)),i("div",Qt,g(u.value.created_by.nick),1)])]),_:1}),e(M),e(I,{class:"row justify-between"},{default:t(()=>[i("div",Dt,[a[9]||(a[9]=i("div",{class:"text-overline text-grey-7"},"Fecha",-1)),i("div",jt,g(W(fe)(u.value.updated_at).format("YYYY-MM-DD")),1)]),u.value.notes?(p(),S("div",qt,[a[10]||(a[10]=i("div",{class:"text-overline text-grey-7 col"},"Notas",-1)),i("div",Pt,g(u.value.notes),1)])):N("",!0),i("div",At,[D.value&&D.value.id>=2?(p(),j(P,{key:0,size:"md",class:"col",color:"primary",icon:"print",flat:"",dense:""},{default:t(()=>[e(be,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Se,{onSelected:Me,partition:!1})]),_:1})]),_:1})):N("",!0),e(M,{spaced:"",inset:"",vertical:"",dark:""}),D.value&&D.value.id==2?(p(),S("div",Et,[e(P,{size:"12px",class:"full-width",color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:oe,flat:""}),e(M,{spaced:"",inset:"",vertical:"",dark:""}),e(P,{size:"12px",class:"full-width",color:"negative",icon:"close",dense:"",label:"Cancelar",onClick:Ie,flat:""})])):N("",!0)])]),_:1}),e(M),B.value?(p(),j(I,{key:0,class:"text-center"},{default:t(()=>[e(bt,{size:"50px",color:"purple"})]),_:1})):(p(),S(T,{key:1},[e(M),e(dt,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=s=>z.value=s),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(ye,{name:"log",label:"Log"}),e(ye,{name:"basket",label:"Productos"}),e(ye,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(ut,{modelValue:z.value,"onUpdate:modelValue":a[3]||(a[3]=s=>z.value=s),animated:""},{default:t(()=>[e(_e,{name:"log"},{default:t(()=>[e(ne,null,{default:t(()=>[(p(!0),S(T,null,J(O.value,s=>(p(),j(ee,{key:s.id},{default:t(()=>[e(Q,{avatar:""},{default:t(()=>[x(g(s.id),1)]),_:2},1024),e(Q,null,{default:t(()=>[x(g(s.name),1)]),_:2},1024),e(Q,null,{default:t(()=>[x(g(s.pivot.details.responsable),1)]),_:2},1024),e(Q,null,{default:t(()=>[x("de "+g(W(fe)(s.pivot.created_at).format("h:mm a"))+" a "+g(W(fe)(s.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(_e,{name:"basket"},{default:t(()=>[C.value.length?(p(),j(le,{key:0,"row-key":"id",flat:"",rows:C.value,columns:r.value.columns,pagination:r.value.pagination,filter:r.value.filter,"visible-columns":m.value},{top:t(()=>[i("div",It,[i("div",Nt,[i("span",Mt,[e(P,{color:"pink-5",icon:"sync",onClick:$,round:"",dense:"",flat:""}),x(" Productos: "+g(C.value.length),1)]),a[11]||(a[11]=x(", ")),i("span",Tt,"Piezas: "+g(d.value),1)]),e(de,{dense:"",modelValue:r.value.filter,"onUpdate:modelValue":a[1]||(a[1]=s=>r.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(ae,{name:"search"})]),_:1},8,["modelValue"]),e(M,{spaced:"",inset:"",vertical:"",dark:""}),e(P,{color:"secondary",icon:"fas fa-eye","no-caps":"",flat:""},{default:t(()=>[e(be,{style:{"min-width":"200px"}},{default:t(()=>[e(ne,null,{default:t(()=>[(p(!0),S(T,null,J(r.value.columns,(s,Y)=>Z((p(),j(ee,{tag:"label",key:Y},{default:t(()=>[e(Q,null,{default:t(()=>[e(L,null,{default:t(()=>[x(g(s.label),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[x(g(s.coldesc),1)]),_:2},1024)]),_:2},1024),e(Q,{side:"",top:""},{default:t(()=>[e(ct,{color:"pink-5",modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=R=>m.value=R),val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Ze]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(p(),S("div",Bt,"Nada por aqui"))]),_:1}),e(_e,{name:"supliers"},{default:t(()=>[e(le,{rows:A.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(s=>[i("div",zt,[e(X,{flat:"",bordered:""},{default:t(()=>[e(I,{class:"text-center"},{default:t(()=>[a[12]||(a[12]=x(" Surtidor ")),a[13]||(a[13]=i("br",null,null,-1)),i("strong",null,g(s.row._suplier),1),e(M,{spaced:"",inset:"",vertical:"",dark:""}),e(ae,{name:"print",color:"pink",size:"sm",onClick:Y=>ze(s.row)},{default:t(()=>[e(be,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(Se,{onSelectedPartition:Te,partition:!0})]),_:1})]),_:2},1032,["onClick"]),a[14]||(a[14]=i("br",null,null,-1)),i("div",Ut,[e(mt,{color:"primary","text-color":"white",label:s.row.status.name},null,8,["label"])])]),_:2},1024),e(M),e(I,{class:"flex justify-between"},{default:t(()=>[u.value.from._type!=1?(p(),S("div",Rt,a[15]||(a[15]=[i("div",null,"Salida",-1),i("div",null,"Entrada",-1)]))):(p(),S("div",Lt,a[16]||(a[16]=[i("div",null,"Traspaso",-1)]))),a[17]||(a[17]=i("div",null,"Herramientas",-1))]),_:1}),e(M),e(I,{class:"flex justify-between"},{default:t(()=>[u.value.from._type!=1?(p(),S("div",Ot,[i("div",null,g(s.row.invoice),1),i("div",null,g(s.row.invoice_received),1)])):(p(),S("div",Ft,[i("div",null,g(s.row.invoice),1)])),i("div",Ht,[s.row._status>=6?(p(),S("div",Gt,[e(P,{color:"pink",icon:"list",onClick:Y=>Ue(s.row),flat:""},null,8,["onClick"])])):N("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(K,{modelValue:V.value.state,"onUpdate:modelValue":a[4]||(a[4]=s=>V.value.state=s),persistent:""},{default:t(()=>[e(X,{style:{width:"400px"}},{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(ne,null,{default:t(()=>[(p(!0),S(T,null,J(_.value,(s,Y)=>(p(),j(ee,{key:Y},{default:t(()=>[e(Q,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md",caption:""},{default:t(()=>a[18]||(a[18]=[x("Ubicaciones")])),_:1}),e(L,null,{default:t(()=>[x(g(s.name),1)]),_:2},1024)]),_:2},1024),e(Q,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md text-center",caption:""},{default:t(()=>a[19]||(a[19]=[x("Productos")])),_:1}),e(L,{class:"text-center"},{default:t(()=>[x(g(s.cantidad),1)]),_:2},1024)]),_:2},1024),e(Q,{class:"q-mt-md"},{default:t(()=>[e(L,{class:"text-center",caption:""},{default:t(()=>a[20]||(a[20]=[x("Particiones")])),_:1}),e(L,{class:"q-mb-sm text-center"},{default:t(()=>[e(de,{modelValue:s.partition,"onUpdate:modelValue":R=>s.partition=R,type:"number",dense:"",filled:"","input-class":"text-center",min:1,error:s.partition==0||s.partition>s.cantidad,"error-message":s.partition>s.cantidad?"No se pueden generar mas particiones que articulos":"la particiones tienen que ser minimo "},null,8,["modelValue","onUpdate:modelValue","error","error-message"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(re,{align:"right"},{default:t(()=>[Z(e(P,{flat:"",label:"Cancel",color:"primary"},null,512),[[ke]]),e(P,{flat:"",label:"Continuar",color:"primary",onClick:Ne})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:F.value,"onUpdate:modelValue":a[5]||(a[5]=s=>F.value=s),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(je,{icon:"warning",color:"negative","text-color":"white"}),a[21]||(a[21]=i("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1)),i("div",Yt,g(u.value.id),1)]),_:1}),e(re,{align:"center"},{default:t(()=>[Z(e(P,{flat:"",label:"Cancel",color:"positive"},null,512),[[ke]]),e(P,{flat:"",label:"Confirmar",color:"negative",onClick:Be})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Jt={class:"text-h6"},Kt={class:"row q-mt-md"},Wt={class:"q-ml-sm text-h6"},Zt={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(o,{emit:y}){pe();const c=me(),f=b({state:!1,action:null}),_=b({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),w={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},v=y,n=o,k=b(n.rows),u=b(n.name),h=b(n.type),B=q(()=>h.value?w[h.value]:{l:"",c:""}),O=()=>{const C=w[h.value];f.value.action=C,f.value.state=!0},z=async()=>{c.loading.show({message:"Espera..."});const C=await H.massiveAction({action:h.value});console.log(C),C.status==200?(C.data,f.value.state=!1,f.value.action=null,c.loading.hide(),c.notify({position:"center",color:"positive",icon:"done"}),v("cardResumeActived")):(console.error(C.data),alert(`Error ${C.status}: ${C.data.msg}`))},D=(C,E,A)=>{console.log(C),console.log(E),console.log(A),console.log(h.value)};return(C,E)=>(p(),S(T,null,[e(le,{"row-key":"ID",rows:k.value,columns:_.value.columns,filter:_.value.filter,onRowClick:D},{top:t(()=>[i("div",Jt,g(u.value),1),i("div",Kt,[e(P,{color:B.value.c,icon:"warning",label:B.value.l,onClick:O},null,8,["color","label"]),e(de,{modelValue:_.value.filter,"onUpdate:modelValue":E[0]||(E[0]=A=>_.value.filter=A),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(ae,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(K,{modelValue:f.value.state,"onUpdate:modelValue":E[1]||(E[1]=A=>f.value.state=A),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(je,{icon:"warning",color:f.value.action.c,"text-color":"white"},null,8,["color"]),i("span",Wt,g(f.value.action.l),1)]),_:1}),e(I,null,{default:t(()=>[x(g(f.value.action.desc),1)]),_:1}),e(re,{align:"right"},{default:t(()=>[Z(e(P,{flat:"",label:"cancelar",color:"primary"},null,512),[[ke]]),e(P,{flat:"",label:"continuar",color:"primary",onClick:z})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ea={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},ta={class:"text-h6"},aa={class:"row q-mb-md items-start justify-around"},la={class:"text-left"},oa={class:"text-h5"},sa={class:"text--2"},ia={class:"full-width row items-center"},na={class:"col text-h6 text-dark"},ra={__name:"AdminDashboard",props:{dash:{type:Object,default:{}}},emits:["reloadDashboard","freshOrder"],setup(o,{emit:y}){xe(),qe();const c=Pe(),f=pe(),_=me(),w=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],v=y,n=b({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:m=>m.log.length==1?m.log[0].name:m.log[m.log.length-1].name,align:"left",sortable:!0,sort:(m,r,d,$)=>parseInt(d._status)-parseInt($._status),classes:m=>w[m._status?parseInt(m._status)-1:parseInt(m.status.id)-1]},{name:"suplier",label:"Surtidores",field:m=>{var r;return(r=m.partition)==null?void 0:r.length},align:"center",classes:"text-bold"},{name:"from",label:"Sucursal",field:m=>m.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:m=>m.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:m=>m.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:m=>m.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),k=b(!1),u=b({state:!1,title:"",data:null,name:null,type:null}),h=b({state:!1,head:null,block:!0}),B=q(()=>f.ordersSize),O=q(()=>f.ordersok.filter(m=>m._status!=100&&m._workpoint_to==c.session.store.id_viz)),z=q(()=>f.ordersok.filter(m=>m._status==100)),D=q(()=>f.orderserrors),C=q(()=>f.resume),E=async m=>{console.log(m.row),h.value.head=m.row,h.value.state=!0},A=async m=>{_.loading.show({message:"cargando..."+m});const r=await H.report(m);console.log(r.data),u.value.data=r.data.rows,u.value.name=r.data.name,u.value.type=m,u.value.state=!0,_.loading.hide()},F=()=>{u.value.state=!1,u.state=!1,v("reloadDashboard")},V=(m,r=!1)=>{console.log(m),r&&(h.value.state=!1),v("freshOrder",m)},U=()=>{k.value=!0};return(m,r)=>(p(),j(rt,{padding:"",class:"bg-grey-2"},{default:t(()=>[D.value.length?(p(),S("div",ea,[r[6]||(r[6]=i("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1)),i("div",ta,g(D.value.map(d=>d.id).join("id")),1),r[7]||(r[7]=i("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1))])):N("",!0),i("div",aa,[(p(!0),S(T,null,J(C.value,d=>(p(),j(P,{stack:"","no-caps":"",class:"q-py-md",key:d.key,onClick:$=>A(d.key),color:d.total==0?"teal-10":"pink-13",disabled:d.total==0},{default:t(()=>[i("div",la,[i("div",oa,g(d.total),1),i("div",sa,g(d.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(le,{flat:"",bordered:"","row-key":"id",rows:O.value,columns:n.value.columns,filter:n.value.filter,pagination:n.value.pagination},{top:t(()=>[i("div",ia,[i("div",na,"Pedidos: "+g(B.value),1),e(de,{dense:"",modelValue:n.value.filter,"onUpdate:modelValue":r[0]||(r[0]=d=>n.value.filter=d),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(ae,{name:"search"})]),_:1},8,["modelValue"]),e(M,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[e(ae,{name:"archive",size:"md",color:"negative",onClick:U})])])]),header:t(d=>[e(ve,{props:d},{default:t(()=>[e(we,{"auto-width":""}),(p(!0),S(T,null,J(d.cols,$=>(p(),j(we,{key:$.name,props:d},{default:t(()=>[x(g($.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(d=>[e(ve,{props:d},{default:t(()=>[e(ge,{"auto-width":""},{default:t(()=>[d.row?(p(),j(P,{key:0,size:"sm",dense:"",round:"",flat:"",onClick:$=>d.expand=!d.expand,icon:d.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])):N("",!0)]),_:2},1024),(p(!0),S(T,null,J(d.cols,$=>(p(),j(ge,{key:$.name,props:d,onClick:oe=>E(d)},{default:t(()=>[x(g($.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(ve,{props:d},{default:t(()=>[e(ge,{colspan:"100%"},{default:t(()=>[e(ne,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ee,null,{default:t(()=>[e(Q,null,{default:t(()=>r[8]||(r[8]=[x("ID")])),_:1}),e(Q,null,{default:t(()=>r[9]||(r[9]=[x("ESTADO")])),_:1}),d.row.from._type==2?(p(),j(Q,{key:0},{default:t(()=>r[10]||(r[10]=[x("SALIDA")])),_:1})):N("",!0),d.row.from._type==2?(p(),j(Q,{key:1},{default:t(()=>r[11]||(r[11]=[x("ENTRADA")])),_:1})):N("",!0),d.row.from._type==1?(p(),j(Q,{key:2},{default:t(()=>r[12]||(r[12]=[x("TRASPASO")])),_:1})):N("",!0)]),_:2},1024),(p(!0),S(T,null,J(d.row.partition,($,oe)=>(p(),S("div",{key:oe},[e(ee,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(L,{overline:""},{default:t(()=>[x(g($._suplier),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[x(g($.id),1)]),_:2},1024)]),_:2},1024),e(Q,{class:et(`${w[$.status.id-1]}`)},{default:t(()=>[x(g($.status.name),1)]),_:2},1032,["class"]),d.row.from._type==2?(p(),j(Q,{key:0},{default:t(()=>[x(g($.invoice),1)]),_:2},1024)):N("",!0),d.row.from._type==2?(p(),j(Q,{key:1},{default:t(()=>[x(g($.invoice_received),1)]),_:2},1024)):N("",!0),d.row.from._type==1?(p(),j(Q,{key:2},{default:t(()=>[x(g($.invoice),1)]),_:2},1024)):N("",!0)]),_:2},1024),e(M,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[tt,d.expand]])]),_:1},8,["rows","columns","filter","pagination"]),e(K,{"full-width":"",modelValue:h.value.state,"onUpdate:modelValue":r[3]||(r[3]=d=>h.value.state=d),persistent:h.value.block,"no-esc-dismiss":h.value.block,"no-backdrop-dismiss":h.value.block},{default:t(()=>[e(Xt,{head:h.value.head,onLoaded:r[1]||(r[1]=d=>h.value.block=!1),onLoading:r[2]||(r[2]=d=>h.value.block=!0),onFresh:V,onChofiAssigned:V},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(K,{modelValue:u.value.state,"onUpdate:modelValue":r[4]||(r[4]=d=>u.value.state=d)},{default:t(()=>[e(Zt,{rows:u.value.data,name:u.value.name,type:u.value.type,onCardResumeActived:F},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(K,{modelValue:k.value,"onUpdate:modelValue":r[5]||(r[5]=d=>k.value=d),"full-width":""},{default:t(()=>[e(X,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(I,{class:"q-pt-none"},{default:t(()=>[e(le,{flat:"",bordered:"","row-key":"id",rows:z.value,columns:n.value.columns,pagination:n.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const da={class:"q-pa-md"},ua={class:"q-pb-sm"},ca={key:0},La={__name:"dashboard",setup(o){const y=xe();qe();const c=pe();me(),Pe();const f=b({val:null}),_=b(!1),w=async()=>{c.setTitle("Dashboard"),c.setButtonShow(!0)},v=n=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",n.id),Ae.emit("order_refresh",{order:n})};return at(()=>y.query,()=>{w()}),w(),(n,k)=>(p(),S(T,null,[e(K,{modelValue:_.value,"onUpdate:modelValue":k[2]||(k[2]=u=>_.value=u)},{default:t(()=>[e(X,{class:"my-card"},{default:t(()=>[e(I,null,{default:t(()=>[i("div",da,[i("div",ua,g(f.value.val),1),e(Le,{modelValue:f.value.val,"onUpdate:modelValue":k[0]||(k[0]=u=>f.value.val=u),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(I,null,{default:t(()=>[e(re,{align:"right"},{default:t(()=>[e(P,{flat:"",icon:"close",color:"negative",onClick:k[1]||(k[1]=u=>_.value=!_.value)}),e(P,{flat:"",icon:"check",color:"positive",onClick:n.buscas},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),W(c).showLoad?(p(),S("div",ca,[e(vt,{showing:W(c).showLoad},{default:t(()=>[e(ft,{size:"5.5em",color:"primary"}),k[3]||(k[3]=x(" Obteniendo Datos... "))]),_:1},8,["showing"])])):(p(),j(ra,{key:1,onReload:w,onFreshOrder:v}))],64))}};export{La as default};
