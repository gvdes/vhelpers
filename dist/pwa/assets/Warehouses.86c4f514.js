import{Q as T}from"./QToolbarTitle.3bc91b30.js";import{Q as O}from"./QToolbar.8c423291.js";import{b as v}from"./QList.d72f5b4a.js";import{Q as C}from"./QSelect.67045144.js";import{u as R,r as w,c as h,o as B,d as $,w as p,e as o,ak as F,Q as y}from"./index.384925f7.js";import{Q as I}from"./QCardSection.38f8c080.js";import{Q as X}from"./QCard.95a4d469.js";import{Q as D}from"./QTable.2b8f0a04.js";import{Q as L}from"./QPage.cf9194a7.js";import{r as N}from"./reportApi.99152f81.js";import{u as M}from"./use-quasar.6f820b66.js";import"./jspdf.plugin.autotable.15133b50.js";import{E as _}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as s}from"./dayjs.min.cbcf888d.js";import"./QLinearProgress.18b37313.js";import"./QCheckbox.7b1d3fab.js";import"./axios.17e30a83.js";import"./_commonjsHelpers.88e99c8f.js";const ue={__name:"Warehouses",setup(U){R();const c=M(),l=w({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),S=w(!1),b=w([]),u=h(()=>({pagination:{rowsPerPage:10},columns:[{name:"code",label:"CODIGO",field:e=>e.code,align:"left"},{name:"description",label:"DESCRIPCION",field:e=>e.description,align:"left"},{name:"barcode",label:"CB",field:e=>e.barcode,align:"left"},{name:"section",label:"SECCION",field:e=>e.category.familia.seccion.name,align:"left"},{name:"family",label:"FAMILIA",field:e=>e.category.familia.name,align:"left"},{name:"category",label:"CATEGORIA",field:e=>e.category.name,align:"left"},{name:"mennav",label:"MEDNAV/PERS",field:e=>e.large,align:"left"},{name:"provider",label:"PROVEEDOR",field:e=>e.providers.name,align:"left"},{name:"maker",label:"FABRICANTE",field:e=>{var a;return(a=e.makers)==null?void 0:a.name},align:"left"},{name:"pxc",label:"PXC",field:e=>e.pieces,align:"center"},{name:"purchases",label:"COMPRAS",field:e=>e.PurchaseYear,align:"center"},{name:"purchasesPXC",label:"COMPRAS PXC ",field:e=>Number(Number(e.PurchaseYear)/Number(e.pieces)).toFixed(2),align:"center"},{name:`sales${Number(s().format("YYYY"))-1}`,label:`VENTAS ${s().format("YYYY")-1}`,field:e=>e.SalesSubYear,align:"center"},{name:`sales${Number(s().format("YYYY"))-1} PXC`,label:`VENTAS ${s().format("YYYY")-1} PXC`,field:e=>Number(Number(e.SalesSubYear)/Number(e.pieces)).toFixed(2),align:"center"},{name:`sales${s().year}`,label:`VENTAS ${s().format("YYYY")}`,field:e=>e.SalesYear,align:"center"},{name:`sales${s().year}`,label:`VENTAS ${s().format("YYYY")}`,field:e=>Number(Number(e.SalesYear)/Number(e.pieces)).toFixed(2),align:"center"},{name:"stock",label:"STOCK",field:e=>e.SumStock,align:"center"},{name:"stock PXC",label:"STOCK PXC",field:e=>Number(Number(e.SumStock)/Number(e.pieces)).toFixed(2),align:"center"}]})),k=h(()=>l.value.all.filter(e=>e.deep==0)),E=h(()=>l.value.seccion.val.length>0?l.value.all.filter(e=>e.deep==1&&l.value.seccion.val.map(a=>a.id).includes(e.root)):l.value.all.filter(e=>e.deep==1)),A=h(()=>{if(l.value.seccion.val.length>0&&l.value.familias.val.length==0){let e=l.value.all.filter(a=>a.deep==1&&l.value.seccion.val.map(i=>i.id).includes(a.root)).map(a=>a.id);return l.value.all.filter(a=>a.deep==2&&e.includes(a.root))}else return l.value.familias.val.length>0?l.value.all.filter(e=>e.deep==2&&l.value.familias.val.map(a=>a.id).includes(e.root)):l.value.all.filter(e=>e.deep==2)}),Q=async()=>{c.loading.show({message:"Obteniendo Familias"});const e=await N.init();e.fail?(console.log(e),c.loading.hide()):(console.log(e),l.value.all=e,c.loading.hide())},V=async()=>{var i,Y,g;c.loading.show({message:"El reporte puede tardar unos minutos"}),S.value=!0;let e={sections:(i=l.value.seccion.val)==null?void 0:i.map(r=>r.id),familys:(Y=l.value.familias.val)==null?void 0:Y.map(r=>r.id),categories:(g=l.value.categories.val)==null?void 0:g.map(r=>r.id)};console.log(e);const a=await N.reportWarehouses(e);a.fail?(console.log(a),c.notify({message:"No se pudo obtener el reporte comuniquese con soporte",type:"negative",position:"center"})):(console.log(a),b.value=a,S.value=!1,c.loading.hide())},x=async()=>{const e=new _.Workbook,a=e.addWorksheet("Almacenes"),i=u.value.columns.map(t=>({header:t.label,key:t.name,width:15}));a.columns=i;const g=b.value.map(t=>{const n={};return u.value.columns.forEach(m=>{let d;typeof m.field=="function"?d=m.field(t):d=t[m.field],n[m.name]=d}),n}).map(t=>u.value.columns.map(n=>t[n.name]));a.addTable({name:"Almacenes",ref:"A1",headerRow:!0,style:{theme:"TableStyleMedium9",showRowStripes:!0},columns:u.value.columns.map(t=>({name:t.label,filterButton:!0})),rows:g}),a.columns.forEach(t=>{let n=0;t.eachCell({includeEmpty:!0},m=>{const d=m.value?m.value.toString().length:10;d>n&&(n=d)}),t.width=n<10?10:n});const r=await e.xlsx.writeBuffer(),P=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=document.createElement("a");f.href=URL.createObjectURL(P),f.download="almacenes.xlsx",document.body.appendChild(f),f.click(),document.body.removeChild(f)};return Q(),(e,a)=>(B(),$(L,{padding:""},{default:p(()=>[o(O,null,{default:p(()=>[o(T,null,{default:p(()=>a[3]||(a[3]=[F(" ALMACENES ")])),_:1})]),_:1}),o(v),o(X,{class:"my-card"},{default:p(()=>[o(I,{class:"row"},{default:p(()=>[o(C,{class:"col",modelValue:l.value.seccion.val,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value.seccion.val=i),options:k.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(v,{spaced:"",inset:"",vertical:"",dark:""}),o(C,{class:"col",modelValue:l.value.familias.val,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.familias.val=i),options:E.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:l.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(v,{spaced:"",inset:"",vertical:"",dark:""}),o(C,{class:"col",modelValue:l.value.categories.val,"onUpdate:modelValue":a[2]||(a[2]=i=>l.value.categories.val=i),options:A.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:l.value.seccion.val.length==0||l.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(v,{spaced:"",inset:"",vertical:"",dark:""}),o(y,{color:"primary",label:l.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:V},null,8,["label"])]),_:1})]),_:1}),o(v,{spaced:"",inset:"",vertical:"",dark:""}),o(D,{rows:b.value,pagination:u.value.pagination,loading:S.value,columns:u.value.columns},{"top-right":p(()=>[o(y,{disable:b.value.value,color:"primary",icon:"download",flat:"",onClick:x},null,8,["disable"])]),_:1},8,["rows","pagination","loading","columns"])]),_:1}))}};export{ue as default};
