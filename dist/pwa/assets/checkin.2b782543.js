import{Z as L,f as N,u as A,r as m,g as F,a as k,c as T,d as e,i as a,a6 as Q,a3 as U,k as d,m as h,aX as S,h as j,j as c,a1 as p,Q as V,a7 as M,l as f,ba as z,a5 as P,n as v,aj as G}from"./index.1626ded8.js";import{Q as $}from"./QForm.3f02a3ba.js";import{a as C,e as H}from"./QSelect.d317d068.js";import{Q as O,b as X,a as Y}from"./QList.41b0f068.js";import{Q as Z}from"./QTable.7e9d42d7.js";import{Q as J}from"./QPage.25b97575.js";import{C as K}from"./ClosePopup.251f8d72.js";import"./dayjs.min.cbcf888d.js";import{R as _}from"./RestockApi.c6bb29fe.js";import{u as W}from"./Restock.d2277e93.js";import{u as tt}from"./use-quasar.3d22c1d6.js";import{$sktRestock as B}from"./socket.168d2ba4.js";import{_ as et}from"./PrinterSelect.9674fd20.js";import"./QLinearProgress.28b05975.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.5eb31d53.js";import"./QToolbar.43e023de.js";import"./QTd.d5df2196.js";import"./QPopupEdit.3e0f7bfa.js";import"./QTr.4997cfa2.js";import"./QLayout.a4d7a81e.js";import"./QScrollObserver.93d35e51.js";import"./QResizeObserver.dbe14e34.js";import"./QImg.cc9834ed.js";import"./QSpace.3c55510f.js";import"./QExpansionItem.b6cb32f6.js";import"./favorites.b4bc9d4b.js";import"./jspdf.plugin.autotable.7d0c7a51.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */import"./QBtnGroup.a3896a1b.js";const at={class:"flex justify-center"},ot={class:"text-center",style:"width: 50%;"},it={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},st={class:"text-bold"},lt={class:"q-mx-sm text-h6"},Ut={__name:"checkin",setup(nt){L();const q=N(),u=W(),l=tt(),x=A(),n=m(null),E=m({rowsPerPage:[0]}),s=m({state:!1,val:null}),r=m({state:!1,val:null,opts:["GEN","EMP"]}),b=F(()=>u.partitions.filter(i=>i._status==8&&i.requisition._workpoint_from==x.session.store.id_viz)),I=async()=>{u.setShowLYT(!0),u.setTitle("Validacion"),u.setButtonShow(!1),u.setButtonShowAdd(!1)},R=async i=>{l.loading.show({message:"..."}),console.log(i.ip),console.log(s.value);const t=await _.printForPartition({ip:i.ip,port:i._port,_partition:s.value.val.id,_workpoint_to:s.value.val._workpoint_to});console.log(t),t.status==200?(t.data?l.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):l.notify({message:`Sin conexion a <b>${i.name} <small>(${i.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),l.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},w=()=>{s.value.val&&(n.value=s.value.val.id),console.log(n.value);let i=b.value.findIndex(t=>t.id==n.value);console.log(i),i>=0?r.value.state=!0:(l.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),n.value=null)},D=async()=>{l.loading.show({message:"Cambiando Estado"});let i={partition:n.value,verified:x.session.credentials.staff.id,state:9,key:r.value.val};console.log(i);let t=await _.saveCheck(i);if(console.log(t),t.status==200){let o=u.partitions.findIndex(g=>g.id==t.data.partition.id);if(o>=0){if(u.partitions.splice(o,1,t.data.partition),t.data.partitionsEnd>t.data.partition.requisition._status){let g={id:t.data.partition._requisition,state:t.data.partitionsEnd};const y=await _.nextState(g);B.emit("order_refresh",{order:y.data}),console.log(y.data)}B.emit("orderpartition_refresh",{order:t.data.partition})}n.value=null,q.push(`/distribute/checkin/${t.data.partition.id}/?key=${t.data.partition.entry_key}`),l.loading.hide()}else t.status==401?(alert(t.response.data.message),console.log(t.response.data.message),l.loading.hide()):alert(`Error ${t.status}: ${t.response.data} `)};return I(),(i,t)=>(k(),T(U,null,[e(J,{padding:""},{default:a(()=>[d("div",null,[d("div",at,[d("div",ot,[e($,{onSubmit:w},{default:a(()=>[e(h,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),e(Z,{rows:b.value,"row-key":"name",grid:"",pagination:E.value,"hide-bottom":""},{item:a(o=>[d("div",it,[e(O,{bordered:""},{default:a(()=>[S((k(),j(Y,{clickable:"",onClick:()=>{s.value.state=!0,s.value.val=o.row}},{default:a(()=>[e(X,null,{default:a(()=>[e(C,{class:"text-center text-bold"},{default:a(()=>[c(p(o.row.id),1)]),_:2},1024),e(C,{class:"text-center text-overline text-caption"},{default:a(()=>[d("span",st,p(o.row.requisition.from.name),1),c(" (P: "+p(o.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[G]])]),_:2},1024)])]),_:1},8,["rows","pagination"])])]),_:1}),e(Q,{modelValue:r.value.state,"onUpdate:modelValue":t[3]||(t[3]=o=>r.value.state=o)},{default:a(()=>[e(V,null,{default:a(()=>[e($,{onSubmit:t[2]||(t[2]=()=>{r.value.val?D():M(l).notify({message:"necesito la llave :x",type:"negative",position:"center"})})},{default:a(()=>[e(f,{class:"row items-center"},{default:a(()=>[e(z,{icon:"warning",color:"orange-14","text-color":"white"}),d("span",lt,"Iniciar CheckOut #"+p(n.value),1)]),_:1}),e(f,null,{default:a(()=>[e(h,{modelValue:r.value.val,"onUpdate:modelValue":t[1]||(t[1]=o=>r.value.val=o),filled:"",type:"text",label:"LLave","auto-focus":""},null,8,["modelValue"])]),_:1}),e(P,{vertical:"",align:"center"},{default:a(()=>[e(v,{flat:"",label:"Si",color:"primary",type:"submit",disable:r.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:s.value.state,"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.state=o),persistent:""},{default:a(()=>[e(V,null,{default:a(()=>[e(f,{class:"text-bold text-h5 items-center"},{default:a(()=>[c(" Particion "+p(s.value.val.id),1)]),_:1}),e(f,{class:"text-center"},{default:a(()=>t[5]||(t[5]=[c(" Que Desesas Hacer ? ")])),_:1}),e(P,{align:"center"},{default:a(()=>[S(e(v,{flat:"",icon:"close",color:"negative"},null,512),[[K]]),e(v,{flat:"",icon:"print",color:"primary"},{default:a(()=>[e(H,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[e(et,{onSelectedPartition:R,partition:!0})]),_:1})]),_:1}),e(v,{flat:"",icon:"send",color:"positive",onClick:w})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ut as default};
