import{W as ie,a as ne,r,J as ue,X as re,o as m,d as k,w as o,e as t,Q as N,f as b,Y as n,g as d,h as u,Z as me,j as Q,_ as p,i as _,$ as Y,a0 as $,k as D,a1 as E,a2 as j,a3 as H,a4 as W}from"./index.5a92cc75.js";import{Q as O,a as y}from"./QSelect.b6220e71.js";import{Q as G,a as h,b as F}from"./QList.7902a402.js";import{Q as pe}from"./QForm.0f0d1da1.js";import{Q as L}from"./QExpansionItem.41f6d994.js";import{Q as ve}from"./QUploader.b4fa0763.js";import{Q as ce,a as fe}from"./QLayout.4b74dbff.js";import{b as A}from"./billingApi.148b768a.js";import{u as ge}from"./BillingStore.834fe3b3.js";import{u as be}from"./use-quasar.317cf8ee.js";import{d as Z}from"./dayjs.min.cbcf888d.js";import"./QCircularProgress.c3803bff.js";import"./QScrollObserver.879d7242.js";import"./QResizeObserver.a3f95062.js";import"./axios.36a303a2.js";import"./_commonjsHelpers.88e99c8f.js";const xe={class:"q-gutter-md q-mt-sm"},ye={class:"text-h6 text-bold q-mb-sm"},Ve={class:"text-h6 text-bold q-mb-md"},Ce={key:0},Te={key:1},ke={class:""},we={key:0,class:"q-gutter-md q-mt-md"},Se={key:1,class:"q-gutter-md q-mt-md"},_e={class:"row"},De={class:"col"},Fe={class:"col"},Ue={class:"col"},Ee={class:"row"},Ae={class:"col"},Qe={class:"col"},Re={class:"text-bold"},qe={class:"text-bold"},Ie={class:"text-bold"},Be=["href"],Ne={class:"text-bold"},Oe={class:"text-bold"},he={class:"text-bold"},Le=["href"],ol={__name:"BillingFormLYT",setup(ze){ge();const i=be(),X=ie(),J=ne(),R=r(!1),U=r(null),q=r(null),w=r({get:!1,register:!1}),K=r([{id:1,label:"Credito",value:"CRE"},{id:2,label:"Debito",value:"DBT"}]),v=r({client:!1,ticket:!1,data:!0}),V=r({load:!1,show:!0}),S=r({ticket:!1,client:!1}),x=r({state:!1,val:null}),f=r({state:!1,val:null}),I=r([]),B=r([]),l=r({store:null,folio:null,fecha:null,total:"",payments:[],cfdi:"",nombre:"",rfc:"",razonSocial:"",email:"",telefono:"",address:{calle:"",colonia:"",ciudad:"",cp:"",municipio:"",numInt:"",numExt:""}}),ee=async s=>{i.loading.show({message:"Obteniendo Datos"});const e=s[0],g=new FormData;g.append("file",e);const a=await A.readCostancy(g);a.fail?i.notify({type:"negative",message:"No se pudieron extraer los datos"}):(console.log(a),l.value.rfc=a.rfc,l.value.razonSocial=a.razonSocial,l.value.address.cp=a.cp,l.value.address.calle=a.calle,l.value.address.colonia=a.colonia,l.value.address.numInt=a.numInt,l.value.address.numExt=a.numExt,l.value.address.municipio=a.municipio,l.value.address.ciudad=a.entFederativa,i.loading.hide(),i.notify({type:"positive",message:"Datos extra\xEDdos correctamente"}))},z=s=>/^([A-ZÃ‘&]{3,4})(\d{6})([A-Z0-9]{3})$/.test(s==null?void 0:s.toUpperCase())||"RFC inv\xE1lido",le=s=>/\S+@\S+\.\S+/.test(s)||"Correo inv\xE1lido",ae=async()=>{if(!l.value.total||!l.value.fecha||!l.value.payments.length)return i.notify({type:"negative",message:"Primero valida el ticket"});if(!l.value.cfdi)return i.notify({type:"negative",message:"Selecciona un uso CFDI"});if(!l.value.nombre||!l.value.email||!l.value.rfc||!l.value.razonSocial||!l.value.address.cp||!l.value.address.calle||!l.value.address.colonia||!l.value.address.ciudad||!l.value.address.municipio)return i.notify({type:"negative",message:"Todos los datos del cliente son obligatorios"});for(let s of l.value.payments)if(["TAR","TBA","TCD","TSA","TSC"].includes(s.payment)&&!s.type_card)return i.notify({type:"negative",message:"Selecciona el tipo de tarjeta para todos los pagos con tarjeta"});te(l.value)},M=()=>{R.value=!0,l.value={store:l.value.store,folio:null,fecha:null,total:"",payments:[],cfdi:l.value.cfdi,nombre:"",rfc:"",razonSocial:"",email:"",telefono:"",address:{calle:"",colonia:"",ciudad:"",cp:"",municipio:"",numInt:"",numExt:""}},v.value={data:!0,ticket:!1,client:!1},S.value={ticket:!1,client:!1},V.value={load:!1,show:!0},U.value&&U.value.resetValidation(),q.value=null,w.value={get:!1,register:!1},setTimeout(()=>{R.value=!1},300),i.notify({type:"info",message:"Formulario Vacio"})},te=async s=>{i.loading.show({message:"Enviando Formulario"}),console.log(s);const e=s.payments.map(c=>{var P;const C=((P=c.type_card)==null?void 0:P.value)||null;let T=null;switch(c.payment){case"CHE":case"EFE":T=c.payment;break;case"TDB":case"TDS":case"TDA":case"TRA":T="TRA";break;case"TSA":case"TSC":case"TAR":case"TBA":case"TCD":C==="CRE"?T="TDC":C==="DBT"?T="TDD":T="TAR";break;default:T="EFE";break}return{...c,payment:T,type_card:C}}),g={...s,payments:e};console.log(g);const a=await A.sendBilling(g);a.fail?console.log(fail):(console.log(a),x.value.state=!0,x.value.val=a,i.loading.hide(),i.notify({message:"Solicitud Creada",type:"positive",position:"top"}),setTimeout(()=>{x.value.state=!1,M()},1e4))},oe=async()=>{var g,a;V.value.load=!0;let s={workpoint:(g=l.value.store)==null?void 0:g.id,folio:l.value.folio};console.log(s);const e=await A.validTicket(s);e.fail?e.fail.status==403?(console.log(e.fail.response.data),f.value.state=!0,f.value.val=e.fail.response.data):console.log(e):(console.log(e),l.value.total=Number(e.Total),l.value.fecha=Z(e.fecha).format("YYYY-MM-DD"),l.value.payments=(a=e.fpas)==null?void 0:a.map(c=>({payment:c.FPALCO,concept:c.CPTLCO,import:c.IMPLCO,type_card:null})),V.value.load=!1,V.value.show=!1,v.value.ticket=!0,S.value.ticket=!0,v.value.client=!0,S.value.client=!0)},se=async()=>{i.loading.show({message:"Cargando...."});const s=await A.index();s.fail?console.log(s.fail):(console.log(s),i.loading.hide(),I.value=s.stores,l.value.store=I.value.find(e=>e.id==X.params.sid),B.value=s.cfdi,l.value.cfdi=B.value.find(e=>e.id==2))},de=async()=>{if(z(l.value.rfc)=="RFC inv\xE1lido")i.notify({message:"El RFC no tiene el formato correcto",type:"negative",position:"top"}),q.value.focus();else{i.loading.show({message:"Revisando Registros"});let s={store:l.value.store.id,rfc:l.value.rfc};const e=await A.readRFC(s);e.fail?console.log(e):(i.loading.hide(),e.success?(w.value.get=!0,i.notify({message:e.message,type:"positive",position:"top"}),l.value.razonSocial=e.client.NOMBRE,l.value.address.cp=e.client.CODIGO,l.value.address.calle=e.client.CALLE,l.value.address.colonia=e.client.COLONIA,l.value.address.numInt=e.client.NUMINT,l.value.address.numExt=e.client.NUMEXT,l.value.address.municipio=e.client.MUNICIPIO,l.value.address.ciudad=e.client.ESTADO):(w.value.register=!0,w.value.get=!0,i.notify({message:e.message,type:"negative",position:"top"})))}};return se(),ue(()=>l.value.payments,async()=>{if(R.value||!U.value)return;await U.value.validate()&&(v.value.data=!1,v.value.ticket=!1,v.value.client=!0,S.value.client=!0)},{deep:!0}),(s,e)=>{const g=re("router-view");return m(),k(ce,{view:"hHh Lpr fFf"},{default:o(()=>[t(fe,null,{default:o(()=>[t(N,{class:"q-pa-xl q-mx-auto shadow-4",style:{"max-width":"700px","border-radius":"22px"}},{default:o(()=>[t(b,{class:"text-h5 text-primary text-weight-bold text-center q-mb-md"},{default:o(()=>e[22]||(e[22]=[n(" Solicitud de Factura \xB7 Grupo Vizcarra ")])),_:1}),t(b,null,{default:o(()=>[t(L,{modelValue:v.value.data,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.data=a),label:"Datos de la Compra",icon:"shopping_cart","header-class":"text-h6 text-primary text-weight-bold","expand-separator":""},{default:o(()=>[d("div",xe,[t(O,{modelValue:l.value.store,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.store=a),options:I.value,label:"Sucursal",filled:"",dense:"","option-label":"name",disable:""},null,8,["modelValue","options"]),t(u,{modelValue:l.value.folio,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.folio=a),type:"text",label:"Folio del Ticket",filled:"",dense:"",mask:"#-######",disable:!V.value.show},me({_:2},[V.value.show?{name:"after",fn:o(()=>[t(Q,{dense:"",color:"primary",label:"Validar",onClick:oe,loading:V.value.load,disable:!l.value.folio||!l.value.store||l.value.folio.length<8},null,8,["loading","disable"])]),key:"0"}:void 0]),1032,["modelValue","disable"])]),S.value.ticket?(m(),k(L,{key:0,modelValue:v.value.ticket,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value.ticket=a),icon:"receipt_long",label:"Detalle del Ticket","header-class":"text-h6 text-primary text-weight-bold",class:"q-mt-md"},{default:o(()=>[t(pe,{ref_key:"formTicket",ref:U,class:"q-mt-md"},{default:o(()=>[e[26]||(e[26]=d("div",{class:"text-subtitle1 q-mb-xs"},"Fecha:",-1)),d("div",ye,p(l.value.fecha),1),e[27]||(e[27]=d("div",{class:"text-subtitle1 q-mb-xs"},"Total:",-1)),d("div",Ve,"$ "+p(l.value.total),1),t(G,{bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[(m(!0),_($,null,Y(l.value.payments,(a,c)=>(m(),k(h,{key:c},{default:o(()=>[t(F,null,{default:o(()=>[t(y,{caption:""},{default:o(()=>e[23]||(e[23]=[n("Forma de Pago")])),_:1}),t(y,{class:"text-bold"},{default:o(()=>[["TAR","TBA","TCD","TSA","TSC"].includes(a.payment)?(m(),_("span",Ce,"Tarjeta")):(m(),_("span",Te,p(a.concept),1))]),_:2},1024)]),_:2},1024),t(F,{class:"text-center"},{default:o(()=>[t(y,{caption:""},{default:o(()=>e[24]||(e[24]=[n("Importe")])),_:1}),t(y,{class:"text-bold"},{default:o(()=>[n("$ "+p(Number(a.import)),1)]),_:2},1024)]),_:2},1024),["TAR","TBA","TCD","TSA","TSC"].includes(a.payment)?(m(),k(F,{key:0},{default:o(()=>[t(y,{caption:"",class:"text-center"},{default:o(()=>e[25]||(e[25]=[n("Tipo Tarjeta")])),_:1}),t(O,{modelValue:a.type_card,"onUpdate:modelValue":C=>a.type_card=C,options:K.value,filled:"",dense:"",label:"Selecciona...",class:"q-mt-xs",rules:[C=>!!C||"Selecciona un tipo"]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),_:2},1024)):D("",!0)]),_:2},1024))),128))]),_:1}),t(O,{filled:"",dense:"",class:"q-mt-md",label:"Uso de CFDI",modelValue:l.value.cfdi,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.cfdi=a),options:B.value,"option-label":"name","emit-value":"","map-options":"",rules:[a=>!!a||"Obligatorio"]},null,8,["modelValue","options","rules"]),t(u,{modelValue:l.value.notes,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.notes=a),type:"textarea",autogrow:"",filled:"",dense:"",label:"Comentarios opcionales",class:"q-mt-md"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue"])):D("",!0)]),_:1},8,["modelValue"])]),_:1}),t(b,null,{default:o(()=>[S.value.client?(m(),k(L,{key:0,modelValue:v.value.client,"onUpdate:modelValue":e[18]||(e[18]=a=>v.value.client=a),"header-class":"text-h6 text-primary text-weight-bold",label:"Datos del Cliente",icon:"person","expand-separator":""},{default:o(()=>[d("div",ke,[t(u,{filled:"",dense:"",label:"RFC",modelValue:l.value.rfc,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.rfc=a),rules:[z],ref_key:"inputrfc",ref:q,onBlur:de},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Nombre de Contacto",modelValue:l.value.nombre,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.nombre=a),rules:[a=>!!a||"Obligatorio"]},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Correo Electr\xF3nico",modelValue:l.value.email,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.email=a),rules:[le],type:"email"},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Tel\xE9fono",modelValue:l.value.telefono,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.telefono=a),mask:"##########"},null,8,["modelValue"]),w.value.register?(m(),_("div",we,[t(ve,{label:"Subir Constancia Fiscal (PDF)",accept:".pdf",onAdded:ee,class:"full-width",dense:"","hide-upload-btn":""})])):D("",!0),w.value.get?(m(),_("div",Se,[t(u,{filled:"",dense:"",label:"Raz\xF3n Social",modelValue:l.value.razonSocial,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.razonSocial=a),rules:[a=>!!a||"Obligatorio"]},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Calle",modelValue:l.value.address.calle,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.address.calle=a)},null,8,["modelValue"]),t(u,{filled:"",dense:"",label:"Colonia",modelValue:l.value.address.colonia,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.address.colonia=a)},null,8,["modelValue"]),d("div",_e,[d("div",De,[t(u,{filled:"",dense:"",label:"Num Ext",modelValue:l.value.address.numExt,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.address.numExt=a)},null,8,["modelValue"])]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),d("div",Fe,[t(u,{filled:"",dense:"",label:"Num Int",modelValue:l.value.address.numInt,"onUpdate:modelValue":e[14]||(e[14]=a=>l.value.address.numInt=a)},null,8,["modelValue"])]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),d("div",Ue,[t(u,{filled:"",dense:"",label:"Municipio",modelValue:l.value.address.municipio,"onUpdate:modelValue":e[15]||(e[15]=a=>l.value.address.municipio=a)},null,8,["modelValue"])])]),d("div",Ee,[d("div",Ae,[t(u,{filled:"",dense:"",label:"Ciudad",modelValue:l.value.address.ciudad,"onUpdate:modelValue":e[16]||(e[16]=a=>l.value.address.ciudad=a)},null,8,["modelValue"])]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),d("div",Qe,[t(u,{filled:"",dense:"",label:"C.P.",modelValue:l.value.address.cp,"onUpdate:modelValue":e[17]||(e[17]=a=>l.value.address.cp=a),mask:"#####"},null,8,["modelValue"])])])])):D("",!0)])]),_:1},8,["modelValue"])):D("",!0)]),_:1}),t(j,{align:"right",class:"q-mt-md"},{default:o(()=>[t(Q,{label:"Limpiar",flat:"",color:"primary",onClick:M}),t(Q,{label:"Enviar Solicitud",color:"primary",unelevated:"",onClick:ae})]),_:1})]),_:1}),t(H,{modelValue:x.value.state,"onUpdate:modelValue":e[19]||(e[19]=a=>x.value.state=a),persistent:""},{default:o(()=>[t(N,{class:"q-pa-lg",style:{"min-width":"350px"}},{default:o(()=>[t(b,{class:"text-center text-h5 text-primary"},{default:o(()=>e[28]||(e[28]=[n("Solicitud Generada")])),_:1}),t(b,{class:"text-subtitle1"},{default:o(()=>[e[29]||(e[29]=n(" Folio: ")),d("span",Re,p(x.value.val.id),1),e[30]||(e[30]=d("br",null,null,-1)),e[31]||(e[31]=n(" Contacto: ")),d("span",qe,p(x.value.val.name),1),e[32]||(e[32]=d("br",null,null,-1)),e[33]||(e[33]=n(" Tel\xE9fono: ")),d("span",Ie,p(x.value.val.celphone),1)]),_:1}),t(b,{class:"text-center"},{default:o(()=>[d("a",{class:"text-positive",href:`https://wa.me/5573461022?text=Cual%20es%20el%20estado%20de%20mi%20solicitud?%20Folio:%20${x.value.val.id}`}," Consultar por WhatsApp ",8,Be)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(H,{modelValue:f.value.state,"onUpdate:modelValue":e[21]||(e[21]=a=>f.value.state=a),persistent:""},{default:o(()=>[t(N,{class:"q-pa-lg",style:{"min-width":"420px","max-width":"760px","border-radius":"12px"}},{default:o(()=>[t(b,{class:"text-h6 text-primary text-weight-bold"},{default:o(()=>[e[34]||(e[34]=n(" Folio Solicitud: ")),d("span",Ne,p(f.value.val.id),1)]),_:1}),t(b,{class:"text-subtitle2"},{default:o(()=>[d("div",null,[e[35]||(e[35]=n("Contacto: ")),d("span",Oe,p(f.value.val.name),1)]),d("div",null,[e[36]||(e[36]=n("Tel\xE9fono: ")),d("span",he,p(f.value.val.celphone),1)])]),_:1}),t(E),t(b,null,{default:o(()=>[e[39]||(e[39]=d("div",{class:"text-h6 q-mb-sm text-bold"},"Historial de Proceso",-1)),t(G,{bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[!f.value.val.log||!f.value.val.log.length?(m(),k(h,{key:0},{default:o(()=>[t(F,{class:"text-center"},{default:o(()=>e[37]||(e[37]=[n("No hay movimientos registrados")])),_:1})]),_:1})):D("",!0),(m(!0),_($,null,Y(f.value.val.log,(a,c)=>(m(),k(h,{key:c,class:"row items-center"},{default:o(()=>[t(F,{class:"col"},{default:o(()=>[t(y,{class:"text-bold"},{default:o(()=>[n(p(a.name),1)]),_:2},1024),t(y,{caption:""},{default:o(()=>[n(p(W(Z)(a.pivot.created_at).format("YYYY-MM-DD HH:mm")),1)]),_:2},1024)]),_:2},1024),t(F,{class:"col-auto"},{default:o(()=>[t(y,{class:"text-caption"},{default:o(()=>e[38]||(e[38]=[n("Usuario")])),_:1}),t(y,{class:"text-bold"},{default:o(()=>[n(p(a.pivot._user),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(E),t(b,{class:"text-center"},{default:o(()=>[e[40]||(e[40]=d("div",{class:"text-h6 text-primary q-mb-sm"},"\xBFDudas o seguimiento?",-1)),d("a",{class:"text-positive",href:`https://wa.me/5573461022?text=Cual%20es%20el%20estado%20de%20mi%20solicitud?%20Folio:%20${f.value.val.id}`,target:"_blank",rel:"noopener"}," Enviar Whatsapp al soporte ",8,Le)]),_:1}),t(j,{align:"right"},{default:o(()=>[t(Q,{flat:"",label:"OK",color:"primary",onClick:e[20]||(e[20]=a=>W(J).go(0))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(g)]),_:1})]),_:1})}}};export{ol as default};
