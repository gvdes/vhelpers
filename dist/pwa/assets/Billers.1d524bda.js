import{u as $,r as _,c as U,o as b,d as D,w as d,g as l,_ as r,a4 as M,e as s,Y as E,Q as w,f as Q,b5 as z,a1 as p,i as T,a0 as B,$ as N,a2 as R,j as C,k as q,aV as O,h as L,a3 as j}from"./index.5a92cc75.js";import{Q as H}from"./QToolbarTitle.59e96771.js";import{Q as J}from"./QDate.9ed2df28.js";import{q as G,d as K}from"./QSelect.b6220e71.js";import{Q as W}from"./QToolbar.2aed37fb.js";import{Q as Y}from"./QTable.52a82dbd.js";import{Q as X}from"./QExpansionItem.41f6d994.js";import{Q as Z}from"./QList.7902a402.js";import{Q as ee}from"./QPage.db03b36e.js";import"./QDrawer.673ed727.js";import{C as te}from"./ClosePopup.7a8a9cc5.js";import"./axios.36a303a2.js";import{u as P}from"./use-quasar.317cf8ee.js";import{b as h}from"./billingApi.148b768a.js";import{u as I}from"./BillingStore.834fe3b3.js";import"./jspdf.plugin.autotable.f64f64da.js";import"./exceljs.min.9e24d01d.js";import"./reports.cb8e8b3e.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as V}from"./dayjs.min.cbcf888d.js";import"./use-render-cache.3aae9b27.js";import"./date.b388846d.js";import"./QLinearProgress.72764828.js";import"./QResizeObserver.a3f95062.js";import"./QScrollObserver.879d7242.js";import"./_commonjsHelpers.88e99c8f.js";const le={class:"row justify-between items-center q-mb-lg"},ae={class:"text-caption text-grey-6"},se={class:"row q-col-gutter-md q-mb-lg"},oe={class:"col-12 col-md-4"},ie={class:"text-h6 text-weight-medium"},ne={class:"col-12 col-md-4"},de={class:"text-h6 text-weight-medium"},re={class:"col-12 col-md-4"},ce={class:"text-h6 text-weight-medium"},ue={class:"row q-col-gutter-md"},me={class:"col-12 col-sm-6"},fe={class:"text-body1"},ve={class:"col-12 col-sm-6"},ge={class:"text-body1"},pe={class:"col-12 col-sm-6"},be={class:"text-body1"},xe={class:"col-12 col-sm-6"},_e={class:"row q-col-gutter-md"},ye={class:"col"},we={class:"text-body1"},he={class:"col"},Ce={class:"text-body1"},Se={class:"text-caption text-grey-7"},ke={class:"text-body1"},De={class:"text-caption"},Ae={class:"col-12"},Qe={class:"text-body1"},Te={__name:"viewBilling",props:{id:{default:null,type:Number}},emits:["nextState"],setup(F,{emit:S}){$(),I();const x=P(),a=_(null),f=[{name:"ARTLFA",label:"C\xF3digo",field:"ARTLFA",align:"left"},{name:"DESLFA",label:"Descripci\xF3n",field:"DESLFA",align:"left"},{name:"CANLFA",label:"Cantidad",field:"CANLFA",align:"center"},{name:"PRELFA",label:"Precio",field:"PRELFA",align:"right"},{name:"TOTLFA",label:"Total",field:"TOTLFA",align:"right"},{name:"UNIDAD",label:"UNIDAD",field:n=>n.sat.unidad,align:"right"},{name:"CLAVE",label:"CLAVE",field:n=>n.sat.clave,align:"right"}],u=U(()=>{try{const n=JSON.parse(a.value.address);return`${n.calle} ${n.numExt} ${n.numInt?"Int. "+n.numInt:""}, ${n.colonia}, ${n.ciudad}, ${n.municipio}, CP ${n.cp}`}catch{return""}}),c=F,y=S,m=async()=>{x.loading.show({message:"Obteniendo Datos"});let n={id:c.id};const e=await h.getBilling(n);e.fail?console.log(e):(console.log(e),x.loading.hide(),a.value=e)},k=n=>{let e=null;switch(n){case"EFE":e="01";break;case"TDD":e="28";break;case"TDC":e="04";break;case"TRA":e="03";break;case"CHE":e="11";break;default:e="01";break}return e},A=()=>{if(a.value._state==1){if(!a.value.nclient)return x.notify({title:"Cliente sin registro",type:"negative",position:"center",message:"El cliente no cuenta con n\xFAmero de registro"});const n=a.value.ticketSuc.products.filter(e=>{var t,o;return!((t=e.sat)!=null&&t.clave)||!((o=e.sat)!=null&&o.unidad)});if(n.length>0){const e=n.map(t=>`\u2022 ${t.DESLFA} (${t.ARTLFA})`).join("<br>");return x.notify({message:`Los siguientes productos no tienen clave o unidad SAT:<br><br>${e}`,html:!0,type:"negative",position:"center"})}a.value.payments.forEach(e=>{e.sat=k(e.payment)}),y("nextState",a.value)}else a.value._state==2?y("nextState",a.value):a.value._state==3||(a.value._state==4?console.log("este ya se acabo"):a.value._state==5&&y("nextState"))};return m(),(n,e)=>a.value?(b(),D(w,{key:0,class:"q-pa-lg"},{default:d(()=>[l("div",le,[l("div",null,[e[0]||(e[0]=l("div",{class:"text-h5 text-weight-bold"},"Factura / Solicitud",-1)),l("div",ae," Creado el: "+r(M(V)(a.value.created_at).format("DD MMM YYYY - HH:mm")),1)]),s(G,{size:"md",color:"primary","text-color":"white"},{default:d(()=>[E(r(a.value.status.name),1)]),_:1})]),l("div",se,[l("div",oe,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:d(()=>[e[1]||(e[1]=l("div",{class:"text-grey-7 text-caption"},"Ticket",-1)),l("div",ie,r(a.value.ticket),1)]),_:1})]),l("div",ne,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:d(()=>[e[2]||(e[2]=l("div",{class:"text-grey-7 text-caption"},"Total",-1)),l("div",de,"$ "+r(a.value.total),1)]),_:1})]),l("div",re,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:d(()=>[e[3]||(e[3]=l("div",{class:"text-grey-7 text-caption"},"Sucursal",-1)),l("div",ce,r(a.value.store.name),1)]),_:1})])]),s(Q,null,{default:d(()=>[e[11]||(e[11]=l("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos del Cliente",-1)),l("div",ue,[l("div",me,[e[4]||(e[4]=l("div",{class:"text-caption text-grey-7"},"Nombre",-1)),l("div",fe,r(a.value.name),1)]),l("div",ve,[e[5]||(e[5]=l("div",{class:"text-caption text-grey-7"},"Email",-1)),l("div",ge,r(a.value.email),1)]),l("div",pe,[e[6]||(e[6]=l("div",{class:"text-caption text-grey-7"},"Tel\xE9fono",-1)),l("div",be,r(a.value.celphone),1)]),l("div",xe,[e[7]||(e[7]=l("div",{class:"text-caption text-grey-7"},"Numero Registro",-1)),l("div",{class:z(["text-body1",a.value.nclient?"":"text-red"])},r(a.value.nclient?a.value.nclient:"Sin Registro"),3)])]),s(p),e[12]||(e[12]=l("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos Fiscales",-1)),l("div",_e,[l("div",ye,[e[8]||(e[8]=l("div",{class:"text-caption text-grey-7"},"RFC",-1)),l("div",we,r(a.value.rfc),1)]),l("div",he,[e[9]||(e[9]=l("div",{class:"text-caption text-grey-7"},"Raz\xF3n Social",-1)),l("div",Ce,r(a.value.razon_social),1)]),(b(!0),T(B,null,N(a.value.payments,t=>(b(),T("div",{key:t.id,class:"col"},[l("div",Se,r(t.payment),1),l("div",ke,"$ "+r(t.import),1),l("div",De,r(k(t.payment)),1)]))),128)),l("div",Ae,[e[10]||(e[10]=l("div",{class:"text-caption text-grey-7"},"Direcci\xF3n",-1)),l("div",Qe,r(u.value),1)])])]),_:1}),s(Q,null,{default:d(()=>[e[13]||(e[13]=l("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Productos",-1)),s(Y,{flat:"",bordered:"",dense:"",rows:a.value.ticketSuc.products,columns:f,"row-key":"ARTLFA",class:"q-mb-xl"},null,8,["rows"])]),_:1}),s(R,{align:"right"},{default:d(()=>[a.value._state!=4?(b(),D(C,{key:0,color:"primary",label:a.value._state==1?"Continuar":"Terminar",onClick:A},null,8,["label"])):q("",!0),O(s(C,{color:"negative",flat:"",label:"Cancelar"},null,512),[[te]])]),_:1})]),_:1})):q("",!0)}},Ve={class:"row full-width items-center justify-between q-py-sm"},st={__name:"Billers",setup(F){const S=$(),x=I(),a=P();x.setShowToolbar(!0);const f=_({from:null,to:null}),u=_({state:!1,data:null}),c=_([]),y=_({opts:[{id:1,label:"Solicitado",class:"bg-red-10 "},{id:2,label:"Proceso",class:"bg-yellow-10 "},{id:4,label:"Creado",class:"bg-green-10"}]}),m=_({columns:[{name:"date",label:"Creado",field:t=>V(t.creeated_at).format("YYYY-MM-DD HH:mm:ss"),align:"left"},{name:"id",label:"Solicitud",field:t=>t.id,align:"left"},{name:"store",label:"Sucursal",field:t=>t.store.name,align:"left"},{name:"ticket",label:"Ticket",field:t=>t.ticket,align:"left"},{name:"contact",label:"Contacto",field:t=>t.name,align:"left"},{name:"email",label:"Correo",field:t=>t.email,align:"left"},{name:"celphone",label:"Telefono",field:t=>t.celphone,align:"left"},{name:"razonSocial",label:"Razon Social",field:t=>t.razon_social,align:"left"},{name:"Status",label:"Estado",field:t=>t.status.name,align:"left"},{name:"Usuario",label:"Usuario",field:t=>t.logs.find(o=>o._state==t._state).user.nick,align:"left"}],filter:null,paginate:{rowsPerPage:15}}),k=async()=>{a.loading.show({message:"Obteniendo Datos"});let t=V(new Date).format("YYYY/MM/DD");f.value={from:t,to:t};const o=await h.getBillings({date:f.value});o.fail?console.log(o):(console.log(o),a.loading.hide(),c.value=o)},A=async()=>{a.loading.show({message:"Obteniendo Datos"});const t=await h.getBillings({date:f.value});t.fail?console.log(t):(console.log(t),a.loading.hide(),c.value=t)},n=async(t,o,i)=>{u.value.folio=o.id,u.value.state=!0},e=async t=>{if(console.log(t),t._state==1){a.loading.show({message:"Creando Factura"});let o={billing:t,user:S.session.credentials.id};const i=await h.crearFacturaInterna(o);if(i.fail)console.log(i);else{a.loading.hide(),console.log(i);let v=c.value.findIndex(g=>g.id==i.id);v>=0&&(c.value.splice(v,1,i),u.value={state:!1,data:null})}}else if(t._state==2){a.loading.show({message:"Cambiando Status"});let o={billing:t,user:S.session.credentials.id};const i=await h.finishState(o);if(i.fail)console.log(i);else{a.loading.hide(),console.log(i);let v=c.value.findIndex(g=>g.id==i.id);v>=0&&(c.value.splice(v,1,i),u.value={state:!1,data:null})}}};return k(),(t,o)=>(b(),D(ee,{padding:""},{default:d(()=>[s(W,null,{default:d(()=>[s(C,{flat:"",round:"",dense:"",icon:"receipt_long"}),s(H,null,{default:d(()=>o[4]||(o[4]=[E(" Solicitudes De Facturas ")])),_:1}),s(C,{flat:"",round:"",dense:"",icon:"event"},{default:d(()=>[s(K,null,{default:d(()=>[s(w,{class:"my-card"},{default:d(()=>[s(Q,null,{default:d(()=>[l("div",null,[o[5]||(o[5]=l("div",{class:"q-pb-sm text-center"},null,-1)),s(J,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=i=>f.value=i),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),s(R,{vertical:"",align:"center"},{default:d(()=>[s(C,{flat:"",label:"Obtener",color:"positive",onClick:A})]),_:1})]),_:1})]),_:1})]),_:1}),s(p,{spaced:"",inset:"",vertical:"",dark:""}),s(L,{modelValue:m.value.filter,"onUpdate:modelValue":o[1]||(o[1]=i=>m.value.filter=i),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"]),s(p,{spaced:"",inset:"",vertical:"",dark:""}),s(L,{modelValue:m.value.filter,"onUpdate:modelValue":o[2]||(o[2]=i=>m.value.filter=i),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])]),_:1}),s(p,{spaced:"",inset:"",vertical:"",dark:""}),(b(!0),T(B,null,N(y.value.opts,(i,v)=>(b(),D(Z,{bordered:"",key:v},{default:d(()=>[s(p,{spaced:"",inset:"",vertical:"",dark:""}),s(X,{"expand-separator":"","default-opened":"","header-class":i.class},{header:d(()=>[l("div",Ve,[l("div",null,r(i.label.toUpperCase())+" - "+r(c.value.filter(g=>g._state==i.id).length),1)])]),default:d(()=>[s(p),s(Y,{rows:c.value.filter(g=>g._state==i.id),columns:m.value.columns,pagination:m.value.paginate,filter:m.value.filter,onRowClick:n},null,8,["rows","columns","pagination","filter"])]),_:2},1032,["header-class"]),s(p,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024))),128)),s(j,{modelValue:u.value.state,"onUpdate:modelValue":o[3]||(o[3]=i=>u.value.state=i),"full-width":""},{default:d(()=>[s(Te,{id:u.value.folio,onNextState:e},null,8,["id"])]),_:1},8,["modelValue"])]),_:1}))}};export{st as default};
