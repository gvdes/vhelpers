import{p as X,bG as F,ar as Z,r as w,aU as ee,e as C,bH as te,w as z,o as ae,q as y,ag as T,s as oe,m as P,z as le,aP as se,u as G,O as ne,a as b,c as h,h as a,g as s,a2 as W,a1 as J,f as L,j as n,bz as ie,i as $,a0 as m,n as B,l as re,k as q,Q as N,G as ce,d as ue,Y as de,a3 as k,aD as me}from"./index.01aad732.js";import{Q as fe}from"./QToolbar.04979db5.js";import{Q as ve}from"./QHeader.14623a66.js";import{Q as M}from"./QTd.1c41788a.js";import{Q as pe}from"./QTr.5dfa3b08.js";import{Q as _e}from"./QTable.68c4d436.js";import{Q as be}from"./QFooter.9f2893f8.js";import{Q as ge}from"./QPage.45fc3825.js";import{Q as he,a as we}from"./QLayout.a7bbe833.js";import{Q as xe,a as U,b as E}from"./QList.4eff6dc2.js";import{Q as ye}from"./QBtnGroup.03041a08.js";import{d as ke,Q as Qe}from"./QSelect.89493f30.js";import{Q as Se}from"./QForm.fce9930c.js";import{p as D}from"./productsApi.5f6ca14f.js";import{u as Y}from"./use-quasar.00e0b448.js";import{H as Ce}from"./html5-qrcode-scanner.64619f17.js";import{_ as Be}from"./UserToolbar.53347b73.js";import"./QResizeObserver.955528d4.js";import"./QLinearProgress.a853f099.js";import"./QScrollObserver.1be2845e.js";import"./axios.60d20557.js";import"./_commonjsHelpers.88e99c8f.js";import"./QExpansionItem.9e45ed88.js";import"./QDrawer.c490ca27.js";import"./ClosePopup.c1474fd6.js";import"./auth.06336982.js";const qe=Object.keys(F);function Pe(e){return qe.reduce((f,l)=>{const v=e[l];return v!==void 0&&(f[l]=v),f},{})}var Ae=X({name:"QBtnDropdown",props:{...F,...Z,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:f,emit:l}){const{proxy:v}=le(),g=w(e.modelValue),c=w(null),p=ee(),i=C(()=>{const t={"aria-expanded":g.value===!0?"true":"false","aria-haspopup":"true","aria-controls":p.value,"aria-label":e.toggleAriaLabel||v.$q.lang.label[g.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(t["aria-disabled"]="true"),t}),d=C(()=>"q-btn-dropdown__arrow"+(g.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),o=C(()=>te(e)),x=C(()=>Pe(e));z(()=>e.modelValue,t=>{c.value!==null&&c.value[t?"show":"hide"]()}),z(()=>e.split,r);function I(t){g.value=!0,l("beforeShow",t)}function O(t){l("show",t),l("update:modelValue",!0)}function H(t){g.value=!1,l("beforeHide",t)}function A(t){l("hide",t),l("update:modelValue",!1)}function Q(t){l("click",t)}function S(t){se(t),r(),l("click",t)}function R(t){c.value!==null&&c.value.toggle(t)}function u(t){c.value!==null&&c.value.show(t)}function r(t){c.value!==null&&c.value.hide(t)}return Object.assign(v,{show:u,hide:r,toggle:R}),ae(()=>{e.modelValue===!0&&u()}),()=>{const t=[y(T,{class:d.value,name:e.dropdownIcon||v.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&t.push(y(ke,{ref:c,id:p.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:I,onShow:O,onBeforeHide:H,onHide:A},f.default)),e.split===!1?y(P,{class:"q-btn-dropdown q-btn-dropdown--simple",...x.value,...i.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:Q},{default:()=>oe(f.label,[]).concat(t),loading:f.loading}):y(ye,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...o.value,glossy:e.glossy,stretch:e.stretch},()=>[y(P,{class:"q-btn-dropdown--current",...x.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:S},{default:f.label,loading:f.loading}),y(P,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...i.value,...o.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>t)])}}});const Ve={class:"QuickRegular row items-center text-black"},$e={class:"col"},De={key:0},Ie={class:"row items-center justify-between no-wrap QuickRegular"},Oe={class:"col"},He={class:"text-grey-4 q-pl-md"},Re={class:"text--2 text-grey-5"},Me={key:1},Le={key:2,class:"flex flex-center q-pa-md"},Ne={key:0},Te={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},with_locations:{default:null,type:Boolean},with_image:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},with_prices_Invoice:{default:null,type:Boolean},with_stock:{default:null,type:Boolean}},emits:["input","similarcodes","agregar"],setup(e,{emit:f}){Y();const l=G(),v=e,g=f;let c=null;const p=w(!1),i=w(!1),d=w({val:{id:1,label:"Autocomplete",icon:"keyboard"},opts:[{id:1,label:"Autocomplete",icon:"keyboard"},{id:2,label:"barcode",icon:"fas fa-barcode"},{id:3,label:"qr_code",icon:"qr_code"}]}),o=w({buscar:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),x=C(()=>({search:o.value.buscar,with_locations:v.with_locations,with_stock:v.with_stock,with_prices:v.with_prices,limit:v.limit,_workpoint:l.session.store.id_viz,rol:l.session.credentials.rol})),I=()=>{switch(o.value.iptsearch.type){case"text":o.value.iptsearch.type="number",o.value.iptsearch.icon="fas fa-font";break;case"number":o.value.iptsearch.type="text",o.value.iptsearch.icon="fas fa-hashtag";break}},O=async(u,r,t)=>{let _=u.trim().toUpperCase();if(_.length>=3){o.value.buscar=_,console.log(x.value);const V=await D.autoCompleteProduct(x.value);if(V.fail)console.log(V);else{console.log(V);let K=V;r(()=>{o.value.options=K},j=>{j.setOptionIndex(-1),j.moveOptionSelection(1,!0)})}}},H=async()=>{if(o.value.buscar.trim().toUpperCase(),o.value.buscar.length){const u=await D.exactSearch(x.value);u.fail?console.log(u):(console.log(u),S(u))}},A=async()=>{if(p.value=!0,c){console.log("La c\xE1mara ya est\xE1 activa");return}ce(()=>{c=new Ce("reader");const u={fps:10,qrbox:r=>{const _=Math.floor(r*.8);return{width:_,height:_}}};c.start({facingMode:"environment"},u,async r=>{if(!i.value){i.value=!0;try{const t=JSON.parse(r);if(console.log(t),t.modelo){o.value.buscar=t.modelo;const _=await D.scanSearch(x.value);_.fail?console.log(_):(console.log(_),Q(),S(_))}}catch{console.log("QR inv\xE1lido: "+r)}finally{i.value=!1}}}).catch(r=>console.log("Error al iniciar c\xE1mara: "+r.message)),console.log("C\xE1mara iniciada")})},Q=()=>{if(!c){console.log("La c\xE1mara no estaba activa");return}c.stop().then(()=>{c.clear(),c=null,p.value=!1,console.log("C\xE1mara detenida")}).catch(u=>console.log("Error al detener c\xE1mara: "+u.message))},S=u=>{o.value.buscar="",g("input",u)},R=(u,r)=>{o.value.buscar="",o.value.options=void 0,u.id==3?A():Q()};return ne(()=>{Q()}),(u,r)=>(b(),h("div",Ve,[a(Ae,{color:"primary",dense:"",flat:"",icon:d.value.val.icon},{default:s(()=>[a(xe,null,{default:s(()=>[(b(!0),h(W,null,J(d.value.opts,t=>(b(),L(U,{key:t.id,clickable:"",onClick:_=>{d.value.val=t,R(t)}},{default:s(()=>[a(E,{avatar:""},{default:s(()=>[a(T,{name:t.icon},null,8,["name"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["icon"]),n("div",$e,[d.value.val.id==1?(b(),h("div",De,[a(Qe,{modelValue:o.value.buscar,"onUpdate:modelValue":r[0]||(r[0]=t=>o.value.buscar=t),"hide-selected":"",behavior:"menu",options:o.value.options,filled:"","hide-dropdown-icon":"","use-input":"",class:"text-uppercase","input-class":"text-h6 text-bold",onFilter:O,"input-debounce":400,autofocus:""},{prepend:s(()=>[a(P,{size:"md",flat:"",padding:"none",onClick:I,icon:o.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:s(t=>[a(U,ie(t.itemProps,{onClick:_=>S(t.opt)}),{default:s(()=>[a(E,null,{default:s(()=>[n("div",Ie,[n("div",Oe,[n("div",null,[$(m(t.opt.code)+" ",1),n("span",He,m(t.opt.name),1)]),n("div",Re,m(t.opt.description),1)])])]),_:2},1024)]),_:2},1040,["onClick"])]),_:1},8,["modelValue","options"])])):B("",!0),d.value.val.id==2?(b(),h("div",Me,[a(Se,{onSubmit:H,class:"q-gutter-md"},{default:s(()=>[a(re,{modelValue:o.value.buscar,"onUpdate:modelValue":r[1]||(r[1]=t=>o.value.buscar=t),type:"text",filled:"",class:"text-uppercase","input-class":"text-h6 text-bold",autofocus:""},null,8,["modelValue"])]),_:1})])):B("",!0),d.value.val.id==3?(b(),h("div",Le,[a(N,{class:"camera-card"},{default:s(()=>[a(q,{class:"flex flex-center"},{default:s(()=>[r[2]||(r[2]=n("div",{id:"reader",class:"qr-reader"},null,-1)),p.value?B("",!0):(b(),h("div",Ne,[a(P,{color:"primary",flat:"",icon:"refresh",label:"Buscar",onClick:A})]))]),_:1})]),_:1})])):B("",!0)])]))}};const je={class:"col"},ze={class:"row justify-center"},Ue={class:"row"},Ee={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},Fe={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},Ge={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},We={class:"row"},Je={class:"text-h6 col text-bold text-left"},Ye={class:"col text-bold text-center"},Ke={class:"text-h6 col text-bold text-right"},Xe={class:"text-subtitle2 col"},Ze={class:"text-weight-bold"},et={class:"text-bold text-blue-13"},tt={class:"row q-ml-sm"},qt={__name:"getProduct",setup(e){G();const f=Y();ue(),de();const l=w(null),v=w({columns:[{name:"anio",label:"A\xD1O",field:"year",align:"center"},{name:"sales",label:"COMPRAS",field:"compras",align:"center"},{name:"purchases",label:"VENTAS",field:"ventas",align:"center"}]}),g=p=>{console.log(p),c(p.id)},c=async p=>{f.loading.show({message:"Obteniendo Datos"}),l.value=null,console.log(p);const i=await D.getProduct(p);i.fail?console.log(i):(f.loading.hide(),console.log(i),i.prices.push({id:8,alias:"COS",pivot:{price:i.cost}}),i.prices.sort((d,o)=>o.id-d.id),l.value=i)};return(p,i)=>(b(),L(he,{view:"hHh Lpr fFf"},{default:s(()=>[a(ve,{class:"",bordered:""},{default:s(()=>[a(Be),a(k),a(fe,{class:"justify-between row"},{default:s(()=>[n("div",je,[i[0]||(i[0]=n("span",{class:""},"Helpers",-1)),a(T,{name:"navigate_next",color:""}),i[1]||(i[1]=n("span",{class:"text-h6"},"Informaci\xF3n Producto",-1))])]),_:1})]),_:1}),a(we,null,{default:s(()=>[a(ge,{padding:""},{default:s(()=>[n("div",ze,[a(me,{name:"bounce"},{default:s(()=>[l.value?(b(),L(N,{key:0,class:"my-card"},{default:s(()=>[a(q,{class:"item-center"},{default:s(()=>[n("div",Ue,[n("div",Ee,m(l.value.category.familia.seccion.name),1),n("div",Fe,m(l.value.category.familia.name),1),n("div",Ge,m(l.value.category.name),1)])]),_:1}),a(q,{class:"item-center"},{default:s(()=>[n("div",We,[n("div",Je,m(l.value.code),1),n("div",Ye,[i[2]||(i[2]=n("div",{class:"text-caption"},"Stock",-1)),n("div",null,m(l.value.total_stock),1)]),n("div",Ke,m(l.value.name),1)]),n("div",Xe,m(l.value.description),1)]),_:1}),a(q,{class:"item-center row"},{default:s(()=>[(b(!0),h(W,null,J(l.value.prices,(d,o)=>(b(),h("div",{class:"col text-subtitle2 text-center",key:o},[n("div",Ze,m(d.alias),1),a(k,{spaced:"",inset:"",vertical:"",dark:""}),n("div",et,m(d.pivot.price),1),a(k,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),a(q,null,{default:s(()=>[a(_e,{rows:l.value.details,hideBottom:"",columns:v.value.columns,pagination:{rowsPerPage:0}},{"bottom-row":s(()=>[a(pe,{class:"text-bold text-dark bg-yellow-12"},{default:s(()=>[a(M,{class:"text-center"},{default:s(()=>i[3]||(i[3]=[$(" Total ")])),_:1}),a(M,{class:"text-center"},{default:s(()=>[$(m(l.value.details.reduce((d,o)=>d+Number(o.compras),0)),1)]),_:1}),a(M,{class:"text-center"},{default:s(()=>[$(m(l.value.details.reduce((d,o)=>d+Number(o.ventas),0)),1)]),_:1})]),_:1})]),_:1},8,["rows","columns"])]),_:1})]),_:1})):B("",!0)]),_:1})]),a(be,{reveal:"",elevated:"",bordered:""},{default:s(()=>[a(k,{spaced:"",inset:"",vertical:"",dark:""}),n("div",tt,[a(N,{class:"col"},{default:s(()=>[a(Te,{checkState:!1,onInput:g,with_prices_Invoice:"",with_stock:"",with_locations:""})]),_:1}),a(k,{spaced:"",inset:"",vertical:"",dark:""})]),a(k,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{qt as default};
