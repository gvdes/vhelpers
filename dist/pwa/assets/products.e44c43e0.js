import{Q as ke}from"./QRadio.c7f33a74.js";import{Q as de}from"./QCheckbox.3be78416.js";import{Q as he}from"./QToggle.593247aa.js";import{i as ue,aL as we,c as C,j as z,t as ce,F as Ve,L as Y,M as Ce,k as Qe,r as F,o as b,g as $,a3 as J,a2 as K,e as t,f as d,Q as V,u as Pe,d as I,w as a,h as D,ak as B,I as Se,a0 as w,al as Fe,a4 as ne}from"./index.30fc3424.js";import{j as $e,k as qe,Q as M}from"./QCard.2e324071.js";import{b as N,a as Z,d as ee,e as H,Q as te}from"./QList.6241d31b.js";import{Q as L}from"./axios.e41ddd0a.js";import{Q as ae,a as T,q as Le}from"./QSelect.455f19ff.js";import{Q as Oe}from"./QInput.3df9da6c.js";import{Q as le}from"./QCardActions.c8fd5935.js";import{Q as De}from"./QBtnGroup.fe65aca9.js";import{Q as Ne}from"./QTable.a9b6a160.js";import{Q as Ae}from"./QPage.fb08fa7e.js";import{C as ie}from"./ClosePopup.7f1ec563.js";import"./QDrawer.3397c9d0.js";import{u as Ie}from"./use-quasar.e7801579.js";import{P as Be,d as Ee}from"./ProductsAutocomplete.a6a37d3b.js";import{_ as Ue}from"./OptionsLabels.72cc5ed9.js";import{l as re}from"./locationsApi.c19101a7.js";import{E as Te}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.f0a20129.js";import"./dayjs.min.cbcf888d.js";import"./QLinearProgress.c337c707.js";import"./QResizeObserver.97b3ce3c.js";import"./QScrollObserver.667ab999.js";/* empty css                                                                         */import"./QImg.561c45f6.js";import"./labels.b5a8077e.js";import"./_commonjsHelpers.88e99c8f.js";const pe={radio:ke,checkbox:de,toggle:he},ze=Object.keys(pe);function oe(o,x){if(typeof o=="function")return o;const i=o!==void 0?o:x;return c=>c[i]}var Re=ue({name:"QOptionGroup",props:{...$e,modelValue:{required:!0},options:{type:Array,validator:o=>o.every(we),default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],name:String,type:{type:String,default:"radio",validator:o=>ze.includes(o)},color:String,keepColor:Boolean,dense:Boolean,size:String,leftLabel:Boolean,inline:Boolean,disable:Boolean},emits:["update:modelValue"],setup(o,{emit:x,slots:i}){const{proxy:{$q:c}}=ce(),Q=Array.isArray(o.modelValue);o.type==="radio"?Q===!0&&console.error("q-option-group: model should not be array"):Q===!1&&console.error("q-option-group: model should be array in your case");const m=qe(o,c),P=C(()=>pe[o.type]),k=C(()=>oe(o.optionValue,"value")),v=C(()=>oe(o.optionLabel,"label")),y=C(()=>oe(o.optionDisable,"disable")),g=C(()=>o.options.map(n=>({val:k.value(n),name:n.name===void 0?o.name:n.name,disable:o.disable||y.value(n),leftLabel:n.leftLabel===void 0?o.leftLabel:n.leftLabel,color:n.color===void 0?o.color:n.color,checkedIcon:n.checkedIcon,uncheckedIcon:n.uncheckedIcon,dark:n.dark===void 0?m.value:n.dark,size:n.size===void 0?o.size:n.size,dense:o.dense,keepColor:n.keepColor===void 0?o.keepColor:n.keepColor}))),r=C(()=>"q-option-group q-gutter-x-sm"+(o.inline===!0?" q-option-group--inline":"")),h=C(()=>{const n={role:"group"};return o.type==="radio"&&(n.role="radiogroup",o.disable===!0&&(n["aria-disabled"]="true")),n});function u(n){x("update:modelValue",n)}return()=>z("div",{class:r.value,...h.value},o.options.map((n,S)=>{const R=i["label-"+S]!==void 0?()=>i["label-"+S](n):i.label!==void 0?()=>i.label(n):void 0;return z("div",[z(P.value,{label:R===void 0?v.value(n):null,modelValue:o.modelValue,"onUpdate:modelValue":u,...g.value[S]},R)])}))}});const je={position:{type:String,default:"bottom-right",validator:o=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(o)},offset:{type:Array,validator:o=>o.length===2},expand:Boolean};function Ge(){const{props:o,proxy:{$q:x}}=ce(),i=Ve(Ce,Y);if(i===Y)return console.error("QPageSticky needs to be child of QLayout"),Y;const c=C(()=>{const r=o.position;return{top:r.indexOf("top")!==-1,right:r.indexOf("right")!==-1,bottom:r.indexOf("bottom")!==-1,left:r.indexOf("left")!==-1,vertical:r==="top"||r==="bottom",horizontal:r==="left"||r==="right"}}),Q=C(()=>i.header.offset),m=C(()=>i.right.offset),P=C(()=>i.footer.offset),k=C(()=>i.left.offset),v=C(()=>{let r=0,h=0;const u=c.value,n=x.lang.rtl===!0?-1:1;u.top===!0&&Q.value!==0?h=`${Q.value}px`:u.bottom===!0&&P.value!==0&&(h=`${-P.value}px`),u.left===!0&&k.value!==0?r=`${n*k.value}px`:u.right===!0&&m.value!==0&&(r=`${-n*m.value}px`);const S={transform:`translate(${r}, ${h})`};return o.offset&&(S.margin=`${o.offset[1]}px ${o.offset[0]}px`),u.vertical===!0?(k.value!==0&&(S[x.lang.rtl===!0?"right":"left"]=`${k.value}px`),m.value!==0&&(S[x.lang.rtl===!0?"left":"right"]=`${m.value}px`)):u.horizontal===!0&&(Q.value!==0&&(S.top=`${Q.value}px`),P.value!==0&&(S.bottom=`${P.value}px`)),S}),y=C(()=>`q-page-sticky row flex-center fixed-${o.position} q-page-sticky--${o.expand===!0?"expand":"shrink"}`);function g(r){const h=Qe(r.default);return z("div",{class:y.value,style:v.value},o.expand===!0?h:[z("div",h)])}return{$layout:i,getStickyContent:g}}var Me=ue({name:"QPageSticky",props:je,setup(o,{slots:x}){const{getStickyContent:i}=Ge();return()=>i(x)}});const He={class:"text-right"},Je={__name:"selectsLocations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(o,{emit:x}){const i=o,c=x,Q=v=>i.sections.filter(y=>y.root===v),m=F([{options:i.sections.filter(v=>v.root===0),selected:null}]),P=(v,y)=>{m.value.splice(y+1);const g=Q(v);g.length&&m.value.push({options:g,selected:null})},k=()=>{const v=m.value.filter(g=>g.selected!==null),y=v[v.length-1];c("obtProducts",y)};return(v,y)=>(b(),$("div",null,[(b(!0),$(J,null,K(m.value,(g,r)=>(b(),$("div",{key:r},[t(ae,{modelValue:g.selected,"onUpdate:modelValue":[h=>g.selected=h,h=>P(h,r)],options:g.options,label:`Nivel ${r+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(N,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),d("div",He,[t(V,{flat:"",icon:"send",disable:!m.value[0].selected,onClick:k},null,8,["disable"])])]))}},Ke={class:"text-center"},We={class:"row text-center"},Xe={key:0,class:"col"},Ye={class:"row"},Ze={class:"row"},et={key:0,class:"col"},tt={key:1,class:"col"},lt={key:0,class:"row"},ot={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},at={class:"text-h5 text-bold text-center"},st={class:"text-subtitle2 text-bold text-center"},nt={class:"text-subtitle2 text-bold text-center"},it={class:"text-subtitle2 text-bold text-center"},rt={class:"text-subtitle2 text-bold text-center"},dt={class:"row"},ut={class:"text-center"},ct={class:"text-center"},pt={class:"text-bold q-pb-sm text-center"},vt={class:"row q-pt-xs"},ft={class:"text-negative"},Mt={__name:"products",setup(o){const x=Pe(),i=Ie(),c=F([]),Q=F([]),m=F(null),P=F(!1),k=F({val:{id:1,label:"Productos"},opts:[{id:1,label:"Productos"},{id:2,label:"Ubicacion"}]}),v=F({filter:"",pagination:{rowsPerPage:9}}),y=F({state:!1}),g=F({state:!1}),r=F({val:[0,1,2,4],opts:[{label:"Menudeo",value:1},{label:"Mayoreo",value:2},{label:"Docena",value:3},{label:"Caja",value:4}]}),h=F(null),u=F({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[]}),n=s=>{let l=[],e=[],p=new Object;return s.products.map(f=>S(f.prices)?l.push(f):e.push(f)),console.log(s),p.notFound=l,p.add=e,p},S=s=>{let l=!0;return s.map((e,p)=>{l=e.pivot.price==0}),l},R=s=>{console.log(s);let l=c.value.findIndex(e=>e.id==s.id);if(console.log(l),l>=0)c.value[l]._copies++;else{let e=j(s.prices,s.pieces);s._copies=1,s.type=e.type,s.usedPrices=e.prices,s._copies=1,c.value.push(s),console.log(s)}},ve=s=>{console.log(s);let l=c.value.findIndex(e=>e.id==s.id);if(console.log(l),l>=0)c.value[l]._copies++;else{let e=j(s.prices,s.pieces);s._copies=1,s.type=e.type,s.usedPrices=e.prices,s._copies=1,c.value.push(s),console.log(s)}},fe=s=>{let l=c.value.findIndex(e=>e.id==s.id);c.value.splice(l,1)},me=()=>{c.value=[],y.value.state=!1},ge=()=>{h.value.click()},be=async()=>{let s=document.getElementById("inputFile").files[0],l=new Te.Workbook,e=[],p=[],f=0;l.xlsx.load(s).then(_=>{if(l.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(O,A){O.value&&e.push(O.value)}),p=e.filter((O,A,U)=>U.indexOf(O)==A),e.length){let O={codes:e,_workpoint:x.session.store.id_viz};console.log(O),i.loading.show({message:"Procesando archivo, espera.."}),Ee.getMassive(O).then(A=>{let U=A.data,X=0,G=n(U);if(U.fails.notFound.map(q=>u.value.wndNotExist.push(q)),u.value.wndGetRows=G.add.length,u.value.state=!u.value.state,u.value.wndGetAdded=G.add,u.value.wndNoDataFound=G.notFound,u.value.wndNoDataFound.length>0){let q=u.value.wndNoDataFound.length;u.value.message=q<=1?"El producto no contiene precios.":"Los productos no contienen precios."}G.add.map(q=>{let se=j(q.prices,q.pieces);q._copies=1,q.type=se.type,q.usedPrices=se.prices,c.value.push(q),X++}),X&&!U.fails.notFound.length&&p.length==e.length?i.notify({message:`Etiquetas generadas: ${X}`,color:"positive",icon:"done",timeout:1e3}):(f=e.length-p.length,u.value.messageRepeat=f<=1?`${f} producto se repitio. Favor de validar su documento antes de subirlo.`:`${f} productos se repitieron. Favor de validar su documento antes de subirlo.`),console.log(u.value),i.loading.hide()}).catch(A=>{console.log(A),i.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else i.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},j=(s,l)=>{let e=[...s];const p=e.find(_=>_.pivot._type==4),f=e.find(_=>_.pivot._type==1);if(p.pivot.price==f.pivot.price){let _={id:0,alias:"OFERTA",name:"Oferta",pivot:{price:e[0].pivot.price},used:!0};return console.log("oferta"),{type:"off",prices:[_]}}else return console.log("estandar"),{type:"std",prices:e}},ye=s=>{switch(s){case"off":return"orange-9";case"std":return"green-9"}},_e=async()=>{if(k.value.val.id==2){i.loading.show({message:"Obteniendo Secciones"});const s=await re.index(x.session.store.id);s.fail?console.log(s):(console.log(s),Q.value=s),i.loading.hide()}},xe=async s=>{i.loading.show({message:"Obteniendo Productos"});let l={section:s.selected,workpoint:x.session.store.id_viz,update:P.value};const e=await re.obtProductSections(l);if(e.fail)console.log(e);else{console.log(e);let p={products:e};p.products.length>0?(n(p).add.map(_=>{let W=c.value.findIndex(E=>E.id==_.id);if(W>=0)c.value[W]._copies++;else{let E=j(_.prices,_.pieces);_._copies=1,_.type=E.type,_.usedPrices=E.prices,c.value.push(_)}}),i.loading.hide()):(i.loading.hide(),i.notify({message:"No Hay Articulos Ubicados x(",type:"negative",position:"center",icon:"mood_bad"}))}};return(s,l)=>(b(),I(Ae,{padding:""},{default:a(()=>[t(M,{class:"my-card"},{default:a(()=>[t(L,null,{default:a(()=>[d("div",Ke,[l[10]||(l[10]=d("div",{class:"text-bold"},"Selecciona los Precios",-1)),t(Re,{options:r.value.opts,type:"toggle",modelValue:r.value.val,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value.val=e),inline:""},null,8,["options","modelValue"])]),d("div",We,[t(V,{class:"col",outline:"",color:"primary",icon:"upload_file",title:"Subir Etiquetas",onClick:ge}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),c.value.length>0?(b(),$("div",Xe,[d("div",Ye,[t(V,{class:"col",outline:"",color:"primary",icon:"delete",title:"Eliminar Etiquetas",onClick:l[1]||(l[1]=e=>y.value.state=!y.value.state)}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(V,{class:"col",outline:"",color:"primary",icon:"download",title:"Descargar Etquetas",onClick:l[2]||(l[2]=e=>g.value.state=!g.value.state)})])])):D("",!0)]),d("input",{type:"file",ref_key:"inputFile",ref:h,id:"inputFile",onInput:be,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}),t(L,null,{default:a(()=>[d("div",Ze,[t(ae,{style:{width:"200px"},modelValue:k.value.val,"onUpdate:modelValue":[l[3]||(l[3]=e=>k.value.val=e),_e],options:k.value.opts,label:"Tipo",filled:"",dense:""},null,8,["modelValue","options"]),t(N,{spaced:"",inset:"",vertical:"",dark:""}),k.value.val.id==1?(b(),$("div",et,[t(Be,{onInput:R,onAgregar:ve})])):D("",!0),k.value.val.id==2?(b(),$("div",tt,[Q.value.length>0?(b(),$("div",lt,[t(Z,{dense:""},{default:a(()=>[t(ee,null,{default:a(()=>[t(H,null,{default:a(()=>[t(T,{caption:""},{default:a(()=>l[11]||(l[11]=[B("Actualizados Hoy")])),_:1}),t(T,{class:"flex flex-center"},{default:a(()=>[t(de,{modelValue:P.value,"onUpdate:modelValue":l[4]||(l[4]=e=>P.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ae,{class:"col",modelValue:m.value,"onUpdate:modelValue":l[5]||(l[5]=e=>m.value=e),options:Q.value,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),t(N,{spaced:"",inset:"",vertical:"",dark:""}),m.value?(b(),I(Je,{key:0,class:"col",sections:m.value.sections,onObtProducts:xe},null,8,["sections"])):D("",!0)])):D("",!0)])):D("",!0)])]),_:1})]),_:1}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(Ne,{rows:c.value,"row-key":"name",grid:"",filter:v.value.filter,pagination:v.value.pagination,"no-data-label":"''"},{"top-right":a(()=>[t(Oe,{borderless:"",dense:"",debounce:"300",modelValue:v.value.filter,"onUpdate:modelValue":l[6]||(l[6]=e=>v.value.filter=e),placeholder:"Buscar"},{append:a(()=>[t(Se,{name:"search"})]),_:1},8,["modelValue"])]),item:a(e=>[d("div",ot,[t(M,{class:"my-card"},{default:a(()=>[t(L,null,{default:a(()=>{var p;return[t(Le,{size:"sm",class:"fixed-right absolute-right text-bold text-white text-uppercase",color:ye(e.row.type)},{default:a(()=>[B(w(e.row.type),1)]),_:2},1032,["color"]),d("div",at,w(e.row.code),1),d("div",st,w(e.row.name),1),d("div",nt,w(e.row.label),1),d("div",it,"Longitud: "+w(e.row.large),1),d("div",rt,"Ubicacion: "+w((p=e.row.locations)==null?void 0:p.map(f=>f.path).join("/")),1),t(N,{spaced:"",inset:"",vertical:"",dark:""}),d("div",dt,[(b(!0),$(J,null,K(e.row.usedPrices.filter(f=>r.value.val.includes(f.id)),(f,_)=>(b(),$("div",{class:"col items-start",key:_},[d("div",ut,w(f.alias),1),d("div",ct,w(f.pivot.price),1)]))),128))])]}),_:2},1024),t(le,{align:"center"},{default:a(()=>[t(V,{flat:"",icon:"delete",color:"negative",onClick:p=>fe(e.row)},null,8,["onClick"]),t(V,{flat:"",icon:"add",onClick:p=>e.row._copies++},null,8,["onClick"]),d("div",null,[l[12]||(l[12]=d("div",{class:"text-caption text--2"},"copias",-1)),d("div",pt,w(e.row._copies),1)]),t(V,{flat:"",icon:"remove",onClick:p=>e.row._copies<=1?"":e.row._copies--},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),bottom:a(e=>[t(Me,{position:"bottom",class:"full-width",offset:[0,18]},{default:a(()=>[d("div",vt,[t(De,{rounded:"",flat:"",color:"primary"},{default:a(()=>[e.pagesNumber>2?(b(),I(V,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):D("",!0),t(V,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),t(V,{flat:"",disable:"","no-caps":""},{default:a(()=>[B(w(e.pagination.page)+" / "+w(e.pagesNumber),1)]),_:2},1024),t(V,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(b(),I(V,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):D("",!0)]),_:2},1024)])]),_:2},1024)]),"no-data":a(()=>l[13]||(l[13]=[])),_:1},8,["rows","filter","pagination"]),t(te,{modelValue:y.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>y.value.state=e),persistent:""},{default:a(()=>[t(M,null,{default:a(()=>[t(L,{class:"row items-center"},{default:a(()=>[t(Fe,{icon:"warning",color:"white","text-color":"negative"}),l[14]||(l[14]=d("div",{class:"q-ml-sm"},"Se eliminaran todos los articulos de la lista ",-1))]),_:1}),t(L,null,{default:a(()=>l[15]||(l[15]=[d("div",{class:"q-ml-sm"},"Deseas Continuar?",-1)])),_:1}),t(le,{align:"right"},{default:a(()=>[ne(t(V,{flat:"",label:"No",color:"positive"},null,512),[[ie]]),t(V,{flat:"",label:"Si",color:"negative",onClick:me})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:g.value.state,"onUpdate:modelValue":l[8]||(l[8]=e=>g.value.state=e),persistent:""},{default:a(()=>[t(Ue,{products:c.value,prices:r.value},null,8,["products","prices"])]),_:1},8,["modelValue"]),t(te,{modelValue:u.value.state,"onUpdate:modelValue":l[9]||(l[9]=e=>u.value.state=e)},{default:a(()=>[t(M,{class:"my-card",style:{width:"70%"}},{default:a(()=>[t(L,{class:"items-center"},{default:a(()=>[l[16]||(l[16]=d("div",{class:"text-center text-bold"},"Repetidos",-1)),d("div",ft,w(u.value.messageRepeat),1)]),_:1}),t(L,null,{default:a(()=>[l[17]||(l[17]=d("div",{class:"text-center"},"Productos Sin Precio",-1)),t(Z,null,{default:a(()=>[(b(!0),$(J,null,K(u.value.wndNoDataFound,(e,p)=>(b(),I(ee,{key:p},{default:a(()=>[t(H,null,{default:a(()=>[t(T,{overline:""},{default:a(()=>[B(w(e.code),1)]),_:2},1024)]),_:2},1024),t(H,null,{default:a(()=>[t(T,{caption:""},{default:a(()=>[B(w(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(L,null,{default:a(()=>[l[18]||(l[18]=d("div",{class:"text-center"},"Productos Sin Existencia",-1)),t(Z,null,{default:a(()=>[(b(!0),$(J,null,K(u.value.wndNotExist,(e,p)=>(b(),I(ee,{key:p},{default:a(()=>[t(H,null,{default:a(()=>[t(T,{overline:""},{default:a(()=>[B(w(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(le,{align:"right"},{default:a(()=>[ne(t(V,{flat:"",label:"OK",color:"primary"},null,512),[[ie]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Mt as default};
