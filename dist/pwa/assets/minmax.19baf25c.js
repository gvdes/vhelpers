import{Q as O,a as p}from"./QSelect.a5e41645.js";import{u as re,r as b,c as me,J as ve,q as pe,o as Q,i as F,e,w as t,g as ce,a0 as q,Q as D,f as _,a1 as E,j as h,aB as fe,b5 as G,Y as u,_ as c,a4 as w,h as P,$ as H,k as ge,a3 as xe,a2 as be,aV as _e,d as W}from"./index.221caa3e.js";import{Q as A,a as y,b as m}from"./QList.3f60b836.js";import{Q as X}from"./QTable.958e2803.js";import{Q as Y,a as we,b as Z}from"./QTabPanels.5a500cd4.js";import{Q as ke}from"./QTabs.7ac2d1e8.js";import{Q as ye}from"./QFooter.30c7bfb9.js";import{Q as Ve}from"./QPage.74a09cbe.js";import{C as Me}from"./ClosePopup.00caced2.js";import"./QExpansionItem.80d01a08.js";import"./QDrawer.b431f3e9.js";import"./axios.7cf70621.js";import{u as Qe}from"./use-quasar.ba838ac0.js";import{u as ze}from"./warehousStore.efe74723.js";import{P as Ee,d as Te}from"./ProductsAutocomplete.5402f631.js";import"./jspdf.plugin.autotable.2c427a54.js";import{E as Ne}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.125a354e.js";import{p as B}from"./productsApi.a484e3ce.js";import"./QLinearProgress.f0c22688.js";import"./use-panel.175f7d87.js";import"./use-render-cache.3aae9b27.js";import"./QResizeObserver.5ced3230.js";import"./QScrollObserver.1d0c900e.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const oa={__name:"minmax",setup(Ce){const d=re(),r=Qe(),I=ze();I.setTitle("Minimos Y Maximos"),I.setshowReportLocations(!1),I.setshowReportMinMax(!0);const L=b(null),T=b("products"),i=b({state:!1,val:null}),K=b({opts:[{id:1,name:"Disponible"},{id:3,name:"Agotado"},{id:6,name:"Bloqueado"}]}),v=b({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),n=b({min:null,max:null}),z=b(null),f=b({val:null,opts:[{id:1,label:"Pieza"},{id:2,label:"Docena"},{id:3,label:"Caja"},{id:4,label:"Media Caja"}]}),$=b({columns:[{name:"store",label:"Sucursal",field:o=>o.name,align:"left"},{name:"Stock",label:"Stock PZ",field:o=>o.pivot.stock,align:"center"}],pagination:{rowsPerPage:10}}),R=me(()=>r.platform.is.mobile),ee=o=>{console.log(o)},ae=o=>{var l;i.value.state=!0,i.value.val=o,console.log(o);const a=o.stocks.find(s=>s.id==d.session.store.id_viz);if(a){let s=1;switch((l=f.value.val)==null?void 0:l.id){case 1:s=1;break;case 2:s=12;break;case 3:s=o.pieces||1;break;case 4:s=(o.pieces||1)/2;break}z.value={min:a.pivot.min/s,max:a.pivot.max/s},n.value.min=a.pivot.min/s,n.value.max=a.pivot.max/s}},le=()=>{var l;if(!i.value.val)return;const o=i.value.val.stocks.find(s=>s.id==d.session.store.id_viz);if(!o)return;let a=1;switch((l=f.value.val)==null?void 0:l.id){case 1:a=1;break;case 2:a=12;break;case 3:a=i.value.val.pieces||1;break;case 4:a=(i.value.val.pieces||1)/2;break}o.pivot.min=n.value.min*a,o.pivot.max=n.value.max*a},te=async()=>{const o=i.value.val.stocks.find(a=>a.id==d.session.store.id_viz);if(o.pivot.min!==z.value.min){let a={product:i.value.val.id,min:o.pivot.min,_workpoint:d.session.store.id_viz};console.log(a),r.loading.show({message:"Modificando"});const l=await B.setMin(a);l.fail?console.log(l):(r.loading.hide(),z.value.min=a.min,r.notify({message:l.message,type:l.success?"positive":"negative",position:"top"}))}},oe=async()=>{const o=i.value.val.stocks.find(a=>a.id==d.session.store.id_viz);if(o.pivot.max!==z.value.max){let a={product:i.value.val.id,max:o.pivot.max,_workpoint:d.session.store.id_viz};console.log(a),r.loading.show({message:"Modificando"});const l=await B.setMax(a);l.fail?console.log(l):(r.loading.hide(),z.value.max=a.max,r.notify({message:l.message,type:l.success?"positive":"negative",position:"top"}))}},se=()=>{let o=document.getElementById("inputFile").files[0],a=new Ne.Workbook,l=[],s={};a.xlsx.load(o).then(()=>{let N=a.worksheets[0];N.getColumn("A").eachCell({includeEmpty:!0},function(k,V){let x=k.value;if(!x)return;let C=parseFloat(N.getCell(`B${V}`).value)||0,U=parseFloat(N.getCell(`C${V}`).value)||0;s[x]||(s[x]={minimo:0,maximo:0}),s[x].minimo=C,s[x].maximo=U});let j=Object.keys(s).map(k=>({codigo:k,minmax:s[k]}));if(j.forEach(k=>l.push(k.codigo)),l.length){let k={codes:l,_workpoint:d.session.store.id_viz};r.loading.show({message:"Procesando archivo, espera.."}),Te.getMassive(k).then(V=>{let x=V.data;x.fails.notFound.map(g=>v.value.wndNotExist.push(g)),x.fails.repeat.map(g=>v.value.repeat.push(g));let C=x.products;v.value.wndGetRows=C.length,v.value.state=!v.value.state;let U=C.map(g=>{var J;let M=1;switch((J=f.value.val)==null?void 0:J.id){case 1:M=1;break;case 2:M=12;break;case 3:M=g.pieces||1;break;case 4:M=(g.pieces||1)/2;break}let S=j.find(de=>de.codigo===g.code);return{id:g.id,producto:g.code,descripcion:g.description,min:S?S.minmax.minimo*M:0,max:S?S.minmax.maximo*M:0}});v.value.wndTotal=U,r.loading.hide()}).catch(V=>{console.log(V),r.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ie=async()=>{r.loading.show({message:"actualizando Min y Max"});let o={workpoint:d.session.store.id_viz,products:v.value.wndTotal};console.log(o);const a=await B.setMassisveMinMax(o);a.fail?console.log(a):(r.loading.hide(),r.notify({message:"Datos Actualizados",type:"positive",position:"center"}),console.log(a),v.value={state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]})},ne=async o=>{r.loading.show({message:"Cambiando Estado"});let a={_product:i.value.val.id,_status:o,wid:d.session.store.id_viz};console.log(a);const l=await B.updateStatusProduct(a);l.fail?console.log(l):(console.log(l),r.loading.hide(),r.notify({message:"Estado Actualizado",type:"positive",position:"right"}))};return ve([()=>f.value.val,()=>n.value.min,()=>n.value.max],([o,a,l],[s,N,ue])=>{localStorage.setItem("minmaxType",JSON.stringify(o)),le()},{deep:!0}),pe(()=>{const o=localStorage.getItem("minmaxType");o&&(f.value.val=JSON.parse(o))}),(o,a)=>(Q(),F(q,null,[e(Ve,{padding:""},{default:t(()=>[e(D,{class:"my-card"},{default:t(()=>[e(_,{class:"row"},{default:t(()=>[e(O,{class:"col",modelValue:f.value.val,"onUpdate:modelValue":a[0]||(a[0]=l=>f.value.val=l),options:f.value.opts,label:"UNIDAD",filled:"",dense:"",hint:f.value.val?`Los min y max que generes se pondran en ${f.value.val.label}`:""},null,8,["modelValue","options","hint"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(h,{disable:!f.value.val,color:"primary",title:"subirArchivo",icon:"upload",onClick:a[1]||(a[1]=()=>L.value.click()),flat:"",rounded:""},null,8,["disable"])]),_:1})]),_:1}),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(fe,{name:"bounce"},{default:t(()=>[i.value.state?(Q(),F("div",{key:0,class:G(R.value?"":"row")},[e(D,{class:G(R.value?"":"col")},{default:t(()=>[e(_,null,{default:t(()=>[e(A,null,{default:t(()=>[e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[10]||(a[10]=[u("Codigo")])),_:1}),e(m,null,{default:t(()=>[u(c(i.value.val.code),1)]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[11]||(a[11]=[u("Descripcion")])),_:1}),e(m,null,{default:t(()=>[u(c(i.value.val.description),1)]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[12]||(a[12]=[u("PXC")])),_:1}),e(m,null,{default:t(()=>[u(c(i.value.val.pieces),1)]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>a[13]||(a[13]=[u("Estado")])),_:1}),e(m,null,{default:t(()=>[e(O,{modelValue:i.value.val.stateToVal.state,"onUpdate:modelValue":[a[2]||(a[2]=l=>i.value.val.stateToVal.state=l),ne],"option-value":"id",options:K.value.opts,filled:"",dense:"","option-label":"name","emit-value":"","map-options":""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>[e(p,{caption:""},{default:t(()=>a[14]||(a[14]=[u("GEN")])),_:1}),e(p,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==w(d).session.store.id_viz).pivot.gen),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(p,{caption:""},{default:t(()=>a[15]||(a[15]=[u("EXH")])),_:1}),e(p,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==w(d).session.store.id_viz).pivot.exh),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(p,{caption:""},{default:t(()=>a[16]||(a[16]=[u("FDT")])),_:1}),e(p,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==w(d).session.store.id_viz).pivot.fdt),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(p,{caption:""},{default:t(()=>a[17]||(a[17]=[u("EnTransito")])),_:1}),e(p,{overline:""},{default:t(()=>[u(c(i.value.val.stocks.find(l=>l.id==w(d).session.store.id_viz).pivot.in_transit),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{class:"row"},{default:t(()=>[e(P,{modelValue:n.value.min,"onUpdate:modelValue":a[3]||(a[3]=l=>n.value.min=l),type:"number",label:"Minimo",class:"col",filled:"","input-class":"text-center",error:Number(n.value.max)<=Number(n.value.min)||Number(n.value.min)>=Number(n.value.max),"error-message":n.value.max<=n.value.min||n.value.min>=n.value.max?"El maximo es menor que el minimo":"El minimo es mayor que el maximo",onBlur:te},null,8,["modelValue","error","error-message"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(P,{modelValue:n.value.max,"onUpdate:modelValue":a[4]||(a[4]=l=>n.value.max=l),type:"number",label:"Maximo",class:"col",filled:"","input-class":"text-center",error:Number(n.value.max)<=Number(n.value.min)||Number(n.value.min)>=Number(n.value.max),"error-message":n.value.max<=n.value.min||n.value.min>=n.value.max?"El maximo es menor que el minimo":"El minimo es mayor que el maximo",onBlur:oe},null,8,["modelValue","error","error-message"])]),_:1}),e(_,{class:"row"},{default:t(()=>[e(P,{disable:"",modelValue:i.value.val.stocks.find(l=>l.id==w(d).session.store.id_viz).pivot.min,"onUpdate:modelValue":a[5]||(a[5]=l=>i.value.val.stocks.find(s=>s.id==w(d).session.store.id_viz).pivot.min=l),type:"number",label:"Minimo",class:"col",filled:"","input-class":"text-center"},null,8,["modelValue"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(P,{disable:"",modelValue:i.value.val.stocks.find(l=>l.id==w(d).session.store.id_viz).pivot.max,"onUpdate:modelValue":a[6]||(a[6]=l=>i.value.val.stocks.find(s=>s.id==w(d).session.store.id_viz).pivot.max=l),type:"number",label:"Maximo",class:"col",filled:"","input-class":"text-center"},null,8,["modelValue"])]),_:1}),e(_,null,{default:t(()=>[e(A,{bordered:""},{default:t(()=>[(Q(!0),F(q,null,H(i.value.val.stocks.filter(l=>l._type==1),(l,s)=>(Q(),W(y,{key:s},{default:t(()=>[e(m,{class:"text-bold"},{default:t(()=>[u(c(l.name),1)]),_:2},1024),e(m,{class:"text-center"},{default:t(()=>[u(c(l.pivot.stock),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["class"]),e(E,{spaced:"",inset:"",vertical:"",dark:""}),e(X,{class:G(R.value?"":"col"),rows:i.value.val.stocks.filter(l=>l._type==2),columns:$.value.columns,pagination:$.value.pagination},null,8,["class","rows","columns","pagination"])],2)):ge("",!0)]),_:1}),e(xe,{modelValue:v.value.state,"onUpdate:modelValue":a[9]||(a[9]=l=>v.value.state=l),persistent:""},{default:t(()=>[e(D,{style:{width:"800px","max-width":"90vw"}},{default:t(()=>[e(_,{class:"text-center text-h6 text-bold"},{default:t(()=>a[18]||(a[18]=[u(" Resultado de Importacion ")])),_:1}),e(_,null,{default:t(()=>[e(A,{bordered:""},{default:t(()=>[e(y,null,{default:t(()=>[e(m,null,{default:t(()=>[e(p,{class:"text-center"},{default:t(()=>a[19]||(a[19]=[u("Productos Encontrados")])),_:1}),e(p,{class:"text-center"},{default:t(()=>[u(c(v.value.wndGetRows),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(p,{class:"text-center"},{default:t(()=>a[20]||(a[20]=[u("Productos Repetidos")])),_:1}),e(p,{class:"text-center"},{default:t(()=>[u(c(v.value.repeat.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(ke,{modelValue:T.value,"onUpdate:modelValue":a[7]||(a[7]=l=>T.value=l),class:"text-teal"},{default:t(()=>[e(Y,{name:"products",icon:"local_mall",label:"Encontrados"}),e(Y,{name:"notFund",icon:"wrong_location",label:"No Encontrados"})]),_:1},8,["modelValue"])]),_:1}),e(_,null,{default:t(()=>[e(we,{modelValue:T.value,"onUpdate:modelValue":a[8]||(a[8]=l=>T.value=l),animated:""},{default:t(()=>[e(Z,{name:"products"},{default:t(()=>[e(X,{rows:v.value.wndTotal,"virtual-scroll":"",flat:"",bordered:"",style:{height:"400px"},"row-key":"producto"},null,8,["rows"])]),_:1}),e(Z,{name:"notFund"},{default:t(()=>[e(A,{bordered:""},{default:t(()=>[(Q(!0),F(q,null,H(v.value.wndNotExist,(l,s)=>(Q(),W(y,{key:s},{default:t(()=>[e(m,null,{default:t(()=>[u(c(l),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(be,{align:"center"},{default:t(()=>[e(h,{flat:"",label:"Modificar",color:"positive",onClick:ie}),_e(e(h,{flat:"",label:"Cancelar",color:"negative"},null,512),[[Me]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ye,{reveal:"",elevated:"",bordered:""},{default:t(()=>[e(D,{class:"my-card"},{default:t(()=>[e(Ee,{onInput:ee,onAgregar:ae,"workpoint-status":"all",checkState:!0,wkpToVal:w(d).session.store.id_viz},null,8,["wkpToVal"])]),_:1})]),_:1})]),_:1}),ce("input",{type:"file",ref_key:"inputFile",ref:L,id:"inputFile",onInput:se,hidden:"",accept:".xlsx,.xls"},null,544)],64))}};export{oa as default};
