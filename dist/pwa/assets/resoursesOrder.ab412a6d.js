import{o as g}from"./orderApi.c7b0500d.js";const v=(a,t,c)=>{const f=t.category.familia.seccion.id,i=c.find(e=>e._category==f).rules;let s=0,o=0,n=0;if(!i)return!1;let m=a.filter(e=>e.id===t.id).reduce((e,r)=>e+Number(u(r.pivot,r.pieces)),0),p=a.filter(e=>e.category.familia.id===t.category.familia.id).reduce((e,r)=>e+Number(u(r.pivot,r.pieces)),0),l=a.filter(e=>e.category.familia.seccion.id===t.category.familia.seccion.id&&e.id!==t.id).reduce((e,r)=>e+Number(u(r.pivot,r.pieces)),0);a.findIndex(e=>e.id==t.id)>=0?(s=m,o=p,n=l):(s=m+Number(t.pivot.units),o=p+Number(t.pivot.units),n=l+Number(t.pivot.units));for(const e of i)if(e._type===2&&(e.sameModel==1&&s>=e.min&&(!e.max||s<=e.max)||e.sameModel==0&&o>=e.min&&(!e.max||o<=e.max)||e.sameModel==0&&n>=e.min&&(!e.max||o<=e.max)&&e.family==0))return!0;return!1},d=(a,t,c)=>{const f=t.category.familia.seccion.id,i=c.find(e=>e._category==f).rules;let s=0,o=0,n=0;if(!i)return!1;let m=a.filter(e=>e.id===t.id).reduce((e,r)=>e+Number(u(r.pivot,r.pieces)),0),p=a.filter(e=>e.category.familia.id===t.category.familia.id).reduce((e,r)=>e+Number(u(r.pivot,r.pieces)),0),l=a.filter(e=>e.category.familia.seccion.id===t.category.familia.seccion.id&&e.id!==t.id).reduce((e,r)=>e+Number(u(r.pivot,r.pieces)),0);a.findIndex(e=>e.id==t.id)>=0?(s=m,o=p,n=l):(s=m+Number(t.pivot.units),o=p+Number(t.pivot.units),n=l+Number(t.pivot.units));for(const e of i)if(e._type===3&&(e.sameModel==1&&s>=e.min&&(!e.max||s<=e.max)||e.sameModel==0&&o>=e.min&&(!e.max||o<=e.max)||e.sameModel==0&&n>=e.min&&(!e.max||o<=e.max)&&e.family==0))return!0;return!1},y=(a,t)=>{let c=0;return c=a.filter(i=>i.id===t.id).reduce((i,s)=>i+Number(u(s.pivot,s.pieces)),0)+Number(t.pivot.units),console.log(c),c>=t.pieces},b=async(a,t,c)=>{const f=[];console.log(t);for(const i of a){const s=i.pivot._supply_by==3?i.pivot.amount*i.pieces:i.pivot._supply_by==2?i.pivot.amount*12:i.pivot.amount;let o=0;t.client._price_list<=3?y(a,i)?o=4:d(a,i,c)?o=3:v(a,i,c)?o=2:o=1:o=t.client._price_list;const n=i.prices.find(m=>m.id==o);if(n){const m=i.pivot.price,p=i.pivot._price_list,l=n.pivot.price;(m!==l||p!==o)&&(i.pivot._price_list=o,i.pivot.price=l,i.pivot.total=s*l,f.push({_order:i.pivot._order,_product:i.id,_price_list:o,price:l,total:s*l}))}}if(f.length>0){const i=await g.updateProductPrices(f);console.log(i),i.fail?console.error("Error al actualizar precios:",i):console.log("Precios actualizados correctamente")}},x=async(a,t,c)=>{const f=[];for(const i of a){const s=i.pivot._supply_by==3?i.pivot.amount*i.pieces:i.pivot._supply_by==2?i.pivot.amount*12:i.pivot.amount;let o=0;t<=3?y(a,i)?o=4:d(a,i,c)?o=3:v(a,i,c)?o=2:o=1:o=t;const n=i.prices.find(m=>m.id==o);if(n){const m=i.pivot.price,p=i.pivot._price_list,l=n.pivot.price;(m!==l||p!==o)&&(i.pivot._price_list=o,i.pivot.price=l,i.pivot.total=s*l,f.push({_product:i.id,_price_list:o,price:l,total:s*l}))}}},u=(a,t)=>a.units;var N={verificarPrecioMayoreo:v,verificarPrecioDocena:d,actualizarPreciosProductos:b,actualizarPreciosProductosSales:x,verificarPrecioCaja:y};export{N as R};
