import{Q as N}from"./QSpace.4eaae24f.js";import{r as f,c as z,o as Q,a as V,w as s,e as l,f as i,b2 as $,Y as h,aF as E,Q as k,a4 as r,a5 as M,a3 as j}from"./index.b92dd970.js";import{Q as C}from"./QSelect.aba570a7.js";import{Q as _}from"./QSeparator.9ed28fa7.js";import{Q as P}from"./QInput.1622385a.js";import{Q as W,a as u}from"./QTr.53982df9.js";import{d as S,Q as J}from"./deposits.12c9bb1c.js";import{Q as G}from"./QTable.dbf1f078.js";import{Q as U,a as x}from"./QCard.7eb7d094.js";import{Q as B}from"./QDialog.d832f787.js";import{Q as H}from"./QDate.686093bf.js";import{Q as K}from"./QCardActions.acb6c307.js";import{Q as X}from"./QPage.6b3d4261.js";import{u as Z}from"./VDB.40e0e52b.js";import"./ClosePopup.85079279.js";import{u as ee}from"./use-quasar.03dae121.js";import{d as te}from"./dayjs.min.cbcf888d.js";import"./jspdf.plugin.autotable.95e2f6b3.js";import{E as le}from"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{$socket as w}from"./socket.e8679fa2.js";import"./use-key-composition.3d5c685a.js";import"./uid.937d8ee7.js";import"./QItemSection.78b45b77.js";import"./position-engine.ef70afb5.js";import"./rtl.276c3f1b.js";import"./axios.ba7b1b0e.js";import"./axios.9ab26c22.js";import"./QList.25de2146.js";import"./QLinearProgress.c27a8b87.js";import"./QCheckbox.54ac594f.js";import"./use-render-cache.3aae9b27.js";import"./date.754fee93.js";import"./_commonjsHelpers.88e99c8f.js";const oe={class:"text-bold text-left"},ae={class:"text-bold text-center"},se={class:"text-bold text-center"},ie={class:"text-bold text-center"},ne={class:"text-bold text-center"},re={class:"text-bold text-left"},de={class:"text-bold text-center"},ue={class:"text-bold text-center"},ce={class:"text-bold text-left"},me=["src"],pe={class:"text-h6"},ve={class:"text-subtitle2"},fe={class:"q-pa-md"},Ke={__name:"Confirm",setup(ge){const F=Z(),c=ee();w.connect(),w.on("List",e=>{console.log(e),m.value.push(e)}),w.on("ChangeTicket",e=>{let o=m.value.findIndex(t=>t.id==e.id);o>=0&&(m.value[o].ticket=e.ticket,c.notify({message:`El deposito de $ ${e.import} se agrego el ticket ${e.ticket}`,type:"positive",position:"center"}))});const p=f({state:!1,val:null}),n=f({val:{id:1,name:"Pendiente"},opts:[]}),T=["yellow-11","green-11","red-11"],v=f(!1),g=f(null),d=f({val:null,opts:[]}),m=f([]),b=f({columns:[{name:"id",label:"Id",align:"center",field:e=>e.id},{name:"created",label:"Creado por",align:"center",field:e=>e.send_by},{name:"store",label:"Sucursal",align:"center",field:e=>e.store.name},{name:"origin",label:"Origen",align:"center",field:e=>e.origin},{name:"destiny",label:"Destino",align:"center",field:e=>e.destiny},{name:"concept",label:"Concepto",align:"left",field:e=>e.concept},{name:"reference",label:"Referencia / Folio",align:"center",field:e=>e.refernce},{name:"amount",label:"Importe",align:"center",field:e=>e.amount},{name:"status",label:"Estado",align:"left",field:e=>e.status.name},{name:"ticket",label:"Ticket",align:"center",field:e=>e.ticket},{name:"picture",label:"Foto",align:"center",field:e=>e.picture}],filter:""}),D=z(()=>d.value.val&&n.value.val?m.value.filter(e=>e._store==d.value.val.id&&e._status==n.value.val.id):d.value.val&&!n.value.val?m.value.filter(e=>e._store==d.value.val.id):!d.value.val&&n.value.val?m.value.filter(e=>e._status==n.value.val.id):m.value),A=async()=>{let e=new Date,o=te(e).format("YYYY/MM/DD");g.value=o,console.log(o),c.loading.show({message:"Obteniendo Datos"}),c.loading.show({message:"Obteniendo Datos"});const t=await S.getForm({filt:g.value});t.fail?console.log(t):(console.log(t),c.loading.hide(),m.value=t.deposit,n.value.opts=t.status,d.value.opts=t.stores)},I=e=>{p.value.val=e,p.value.state=!0},q=async e=>{c.loading.show({message:"Cambiando estado"});let o={id:e.id,status:e.status.id};console.log(o);const t=await S.changeStatus(o);console.log(t),t.fail?console.log(t):(c.loading.hide(),e._status=e.status.id,w.emit("ChangeStatus",t),c.notify({message:"Se cambio de estado",type:"positive"}))},O=async()=>{console.log(g.value),c.loading.show({message:"Obteniendo Datos"});const e=await S.getForm({filt:g.value});e.fail?console.log(e):(console.log(e),c.loading.hide(),m.value=e.deposit,v.value=!1)},R=async()=>{const e=new le.Workbook,o=e.addWorksheet("Comparativo");o.addRow(b.value.columns.map(a=>a.label)),D.value.forEach(async a=>{o.addRow([a.id,a.send_by,a.store.name,a.origin,a.destiny,a.concept,a.refernce,a.amount,a.status.name,a.ticket,`http://192.168.10.160:1920/Assist/public/storage/${a.picture}`])}),(async()=>{const a=await e.xlsx.writeBuffer(),Y=new Blob([a],{type:"application/octet-stream"}),L=URL.createObjectURL(Y),y=document.createElement("a");y.href=L,y.download=`Comparativo${F.session.store.alias}.xlsx`,document.body.appendChild(y),y.click(),document.body.removeChild(y)})()};return A(),(e,o)=>(Q(),V(X,{padding:""},{default:s(()=>[l(G,{title:"Depositos",rows:D.value,"row-key":"id","rows-per-page-options":[0],separator:"cell",columns:b.value.columns,filter:b.value.filter},{top:s(t=>[o[10]||(o[10]=i("div",{class:"col-2 q-table__title q-mr-xl"},"Depositos",-1)),l(N),l(C,{modelValue:d.value.val,"onUpdate:modelValue":o[1]||(o[1]=a=>d.value.val=a),options:d.value.opts,label:"Sucursal","option-label":"name",filled:"",style:{width:"200px"}},$({_:2},[d.value.val?{name:"append",fn:s(()=>[l(h,{name:"cancel",onClick:o[0]||(o[0]=E(a=>d.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),l(_,{spaced:"",inset:"",vertical:""}),l(C,{modelValue:n.value.val,"onUpdate:modelValue":o[3]||(o[3]=a=>n.value.val=a),options:n.value.opts,label:"Estado","option-label":"name",filled:"",style:{width:"200px"}},$({_:2},[n.value.val?{name:"append",fn:s(()=>[l(h,{name:"cancel",onClick:o[2]||(o[2]=E(a=>n.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),l(_,{spaced:"",inset:"",vertical:""}),l(k,{color:"primary",icon:"event",onClick:o[4]||(o[4]=a=>v.value=!v.value),flat:"",round:""}),l(_,{spaced:"",inset:"",vertical:""}),l(k,{color:"primary",icon:"download",onClick:R,flat:"",round:""}),l(_,{spaced:"",inset:"",vertical:""}),l(P,{borderless:"",dense:"",debounce:"300",modelValue:b.value.filter,"onUpdate:modelValue":o[5]||(o[5]=a=>b.value.filter=a),placeholder:"Search"},{append:s(()=>[l(h,{name:"search"})]),_:1},8,["modelValue"])]),body:s(t=>[l(W,{props:t},{default:s(()=>[l(u,{key:"id",props:t},{default:s(()=>[i("div",oe,r(t.row.id),1)]),_:2},1032,["props"]),l(u,{key:"created",props:t},{default:s(()=>[i("div",ae,r(t.row.send_by),1)]),_:2},1032,["props"]),l(u,{key:"store",props:t},{default:s(()=>[i("div",se,r(t.row.store.name),1)]),_:2},1032,["props"]),l(u,{key:"origin",props:t},{default:s(()=>[i("div",ie,r(t.row.origin),1)]),_:2},1032,["props"]),l(u,{key:"destiny",props:t},{default:s(()=>[i("div",ne,r(t.row.destiny),1)]),_:2},1032,["props"]),l(u,{key:"concept",props:t},{default:s(()=>[i("div",re,r(t.row.concept),1)]),_:2},1032,["props"]),l(u,{key:"reference",props:t},{default:s(()=>[i("div",de,r(t.row.refernce),1)]),_:2},1032,["props"]),l(u,{key:"amount",props:t},{default:s(()=>[i("div",ue,"$ "+r(Number(t.row.import).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),_:2},1032,["props"]),l(u,{key:"status",props:t},{default:s(()=>[l(C,{"bg-color":T[t.row.status.id-1],modelValue:t.row.status,"onUpdate:modelValue":[a=>t.row.status=a,a=>q(t.row)],options:n.value.opts,label:"Estado",filled:"","option-label":"name",dense:""},null,8,["bg-color","modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"]),l(u,{key:"ticket",props:t},{default:s(()=>[i("div",ce,r(t.row.ticket),1)]),_:2},1032,["props"]),l(u,{key:"picture",props:t,onClick:a=>I(t.row)},{default:s(()=>[t.row.picture!=null?(Q(),V(J,{key:0,src:`http://192.168.10.160:1920/Assist/public/storage/${t.row.picture}`,ratio:1.7,"spinner-color":"primary","spinner-size":"20px",style:{width:"100px"}},null,8,["src"])):(Q(),V(M,{key:1,rounded:"",size:"100px","font-size":"52px",color:"white","text-color":"primary",icon:"close"}))]),_:2},1032,["props","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),l(B,{modelValue:p.value.state,"onUpdate:modelValue":o[6]||(o[6]=t=>p.value.state=t)},{default:s(()=>[l(U,{class:"my-card"},{default:s(()=>[i("img",{src:`http://192.168.10.160:1920/Assist/public/storage/${p.value.val.picture}`},null,8,me),l(x,null,{default:s(()=>[i("div",pe,"Creado: "+r(p.value.val.send_by),1),i("div",ve,"Estado: "+r(p.value.val.status.name),1)]),_:1}),l(x,null,{default:s(()=>[j(r(p.value.val.concept),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:v.value,"onUpdate:modelValue":o[9]||(o[9]=t=>v.value=t)},{default:s(()=>[l(U,{class:"my-card"},{default:s(()=>[l(x,null,{default:s(()=>[i("div",fe,[o[11]||(o[11]=i("div",{class:"q-pb-sm"},null,-1)),l(H,{modelValue:g.value,"onUpdate:modelValue":o[7]||(o[7]=t=>g.value=t),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),l(x,null,{default:s(()=>[l(K,{align:"right"},{default:s(()=>[l(k,{flat:"",icon:"close",color:"negative",onClick:o[8]||(o[8]=t=>v.value=!v.value)}),l(k,{flat:"",icon:"check",color:"positive",onClick:O})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ke as default};
