import{j as Y,E as H,r as V,N as J,c as _,n as Q,q as W,T as X,k as R,F as Z,m as ee,G as te,o as x,a as k,w as r,h as N,u as ae,aD as oe,e as l,Q as g,f as A,i as c,a4 as m,a3 as h,Y as L,g as le,a0 as se,a1 as ne,a2 as j,b2 as re,a6 as ie}from"./index.d7546a8a.js";import{Q as ue}from"./QToolbar.5407b6a4.js";import{Q as D}from"./QSeparator.56d57341.js";import{Q as ce}from"./QHeader.8f062dcc.js";import{a as O,b as C}from"./QSelect.f1bbf113.js";import{Q as U}from"./QList.3ce1689a.js";import{Q as M,a as E}from"./QCard.9928c32f.js";import{Q as G}from"./QCardActions.83b43f07.js";import{Q as de}from"./QDialog.c86cf055.js";import{Q as ve}from"./QResizeObserver.07a0c910.js";import{Q as fe}from"./QPage.9746ecc5.js";import{u as me}from"./VDB.9e9c1666.js";import{u as pe}from"./use-quasar.b3fd5563.js";import"./jspdf.plugin.autotable.b7e64e9b.js";import{t as P}from"./transferApi.09b82a88.js";import"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{P as ge}from"./ProductsAutocomplete.2c81962c.js";import"./use-key-composition.66c79efa.js";import"./uid.42677368.js";import"./position-engine.bbe43243.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.eed4c97e.js";import"./axios.f1f32898.js";import"./QInput.72908bff.js";var he=Y({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(u,{slots:q,emit:y}){const{proxy:{$q:b}}=ee(),t=Z(te,H);if(t===H)return console.error("QFooter needs to be child of QLayout"),H;const i=V(parseInt(u.heightHint,10)),e=V(!0),d=V(J.value===!0||t.isContainer.value===!0?0:window.innerHeight),w=_(()=>u.reveal===!0||t.view.value.indexOf("F")>-1||b.platform.is.ios&&t.isContainer.value===!0),B=_(()=>t.isContainer.value===!0?t.containerHeight.value:d.value),T=_(()=>{if(u.modelValue!==!0)return 0;if(w.value===!0)return e.value===!0?i.value:0;const o=t.scroll.value.position+B.value+i.value-t.height.value;return o>0?o:0}),$=_(()=>u.modelValue!==!0||w.value===!0&&e.value!==!0),I=_(()=>u.modelValue===!0&&$.value===!0&&u.reveal===!0),z=_(()=>"q-footer q-layout__section--marginal "+(w.value===!0?"fixed":"absolute")+"-bottom"+(u.bordered===!0?" q-footer--bordered":"")+($.value===!0?" q-footer--hidden":"")+(u.modelValue!==!0?" q-layout--prevent-focus"+(w.value!==!0?" hidden":""):"")),F=_(()=>{const o=t.rows.value.bottom,v={};return o[0]==="l"&&t.left.space===!0&&(v[b.lang.rtl===!0?"right":"left"]=`${t.left.size}px`),o[2]==="r"&&t.right.space===!0&&(v[b.lang.rtl===!0?"left":"right"]=`${t.right.size}px`),v});function f(o,v){t.update("footer",o,v)}function p(o,v){o.value!==v&&(o.value=v)}function S({height:o}){p(i,o),f("size",o)}function s(){if(u.reveal!==!0)return;const{direction:o,position:v,inflectionPoint:K}=t.scroll.value;p(e,o==="up"||v-K<100||t.height.value-B.value-v-i.value<300)}function a(o){I.value===!0&&p(e,!0),y("focusin",o)}Q(()=>u.modelValue,o=>{f("space",o),p(e,!0),t.animate()}),Q(T,o=>{f("offset",o)}),Q(()=>u.reveal,o=>{o===!1&&p(e,u.modelValue)}),Q(e,o=>{t.animate(),y("reveal",o)}),Q([i,t.scroll,t.height],s),Q(()=>b.screen.height,o=>{t.isContainer.value!==!0&&p(d,o)});const n={};return t.instances.footer=n,u.modelValue===!0&&f("size",i.value),f("space",u.modelValue),f("offset",T.value),W(()=>{t.instances.footer===n&&(t.instances.footer=void 0,f("size",0),f("offset",0),f("space",!1))}),()=>{const o=X(q.default,[R(ve,{debounce:0,onResize:S})]);return u.elevated===!0&&o.push(R("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),R("footer",{class:z.value,style:F.value,onFocusin:a},o)}}});const _e={class:"row items-center"},ye={class:"col"},xe={class:"col"},be={class:"text-h6"},we={class:"text-center text-bold"},Qe={class:"text-center text-h4"},ke={class:"text-center text-h6 text-grey-14"},Ce={class:"text-center"},Ve={class:"q-pa-xs"},Pe=c("div",{class:"text-bold text-h6"},"Cantidad:",-1),qe={class:"row"},Be={class:"col column q-py-md"},at={__name:"viewTransfer",setup(u){const q=ae(),y=oe(),b=me(),t=pe(),i=V(null),e=V({val:null,state:!1}),d=V([]),w=_(()=>{var s;return((s=d.value)==null?void 0:s.filter(a=>{var n;return a.product==((n=e.value.val)==null?void 0:n.product)}).length)>0}),B=async()=>{const s=y.params.oid,a=await P.getTransfer(s);a.fail?console.log(a):(i.value=a,d.value=a.bodie,console.log(i.value))},T=s=>{console.log(s)},$=s=>{let a=d.value.findIndex(n=>n.product==s.code);console.log(a),a>=0?t.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(e.value.val={product:s.code,description:s.description,amount:1},e.value.state=!0,console.log(s))},I=async()=>{t.loading.show({message:"Insertando Producto"}),console.log(e.value.val),e.value.val._transfer=y.params.oid;const s=await P.addProduct(e.value.val);s.fail?console.log(s):(console.log(s),d.value.push(e.value.val),e.value={val:null,state:!1},t.loading.hide())},z=async()=>{t.loading.show({message:"Editando Producto"}),console.log(e.value.val),e.value.val._transfer=y.params.oid;const s=await P.editProduct(e.value.val);if(s.fail)console.log(s);else{console.log(s);let a=d.value.findIndex(n=>n.product==e.value.val.product);a>=0&&(d.value[a].amount=e.value.val.amount,t.notify({type:"positive",position:"center"}),e.value={val:null,state:!1},t.loading.hide())}},F=async()=>{t.loading.show({message:"Eliminando Producto"}),console.log(e.value.val),e.value.val._transfer=y.params.oid;const s=await P.removeProduct(e.value.val);if(s.fail)console.log(s);else{console.log(s);let a=d.value.findIndex(n=>n.product==e.value.val.product);a>=0&&(d.value.splice(a,1),t.notify({type:"positive",position:"center"}),e.value={val:null,state:!1},t.loading.hide())}},f=s=>{e.value.state=!0,e.value.val=s},p=()=>{e.value={val:null,state:!1}},S=async()=>{t.loading.show({message:"Terminando Traspaso"});let s={user:b.session.name,traspaso:i.value,products:d.value};const a=await P.endTransfer(s);a.fail?console.log(a):(t.notify({message:a,position:"center",type:"positive"}),console.log(a),t.loading.hide(),q.push("/transfers"))};return B(),(s,a)=>i.value?(x(),k(fe,{key:0,padding:""},{default:r(()=>[l(ce,{reveal:"",bordered:"",class:"bg-white text-black"},{default:r(()=>[l(ue,{class:"justify-between"},{default:r(()=>[l(g,{color:"primary",icon:"arrow_back",flat:"",onClick:a[0]||(a[0]=n=>A(q).push("/transfers")),round:""}),c("div",null,m(i.value.store.name),1),c("div",_e,[c("div",ye,m(i.value.origin.name),1),h(),l(L,{name:"arrow_forward",class:"col"}),c("div",xe,m(i.value.destiny.name),1)]),c("div",null,m(i.value.created_by),1),c("div",null,[h("Traspaso "),l(L,{name:"navigate_next",color:"primary"}),h(),c("span",be,m(i.value.code_fs),1)])]),_:1}),l(D),c("div",we,m(i.value.notes),1)]),_:1}),l(D,{spaced:"",inset:"",vertical:"",dark:""}),l(U,{bordered:""},{default:r(()=>[l(O,null,{default:r(()=>[l(C,null,{default:r(()=>[h(" Producto ")]),_:1}),l(C,null,{default:r(()=>[h(" Descripcion ")]),_:1}),l(C,{class:"text-center"},{default:r(()=>[h(" Cantidad ")]),_:1})]),_:1})]),_:1}),(x(!0),le(ne,null,se(d.value,(n,o)=>(x(),k(U,{bordered:"",key:o},{default:r(()=>[j((x(),k(O,{clickable:"",onClick:v=>f(n)},{default:r(()=>[l(C,null,{default:r(()=>[h(m(n.product),1)]),_:2},1024),l(C,null,{default:r(()=>[h(m(n.description),1)]),_:2},1024),l(C,{class:"text-center"},{default:r(()=>[h(m(n.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[ie]]),l(D)]),_:2},1024))),128)),l(de,{modelValue:e.value.state,"onUpdate:modelValue":a[4]||(a[4]=n=>e.value.state=n),persistent:"",position:"bottom"},{default:r(()=>[l(M,{style:{width:"300","max-width":"40vw"}},{default:r(()=>[l(E,null,{default:r(()=>[c("div",Qe,m(e.value.val.product),1),c("div",ke,m(e.value.val.description),1)]),_:1}),l(E,null,{default:r(()=>[c("div",Ce,[c("div",Ve,[Pe,c("div",qe,[l(g,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:a[1]||(a[1]=n=>e.value.val.amount>1?e.value.val.amount--:"")}),c("div",Be,[j(c("input",{type:"number",min:"1","onUpdate:modelValue":a[2]||(a[2]=n=>e.value.val.amount=n),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[re,e.value.val.amount]])]),l(g,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:a[3]||(a[3]=n=>e.value.val.amount++)})])])])]),_:1}),A(w)?(x(),k(G,{key:1,align:"center"},{default:r(()=>[l(g,{flat:"",icon:"close",color:"red-10",onClick:p}),l(g,{flat:"",label:"Eliminar",color:"negative",onClick:F}),l(g,{flat:"",label:"Editar",color:"blue-10",onClick:z})]),_:1})):(x(),k(G,{key:0,align:"center"},{default:r(()=>[l(g,{flat:"",label:"Cancelar",color:"negative",onClick:p}),l(g,{flat:"",label:"Agregar",color:"positive",onClick:I})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),l(he,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:r(()=>[l(M,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:r(()=>[l(E,{class:"row"},{default:r(()=>[l(ge,{class:"col",checkState:!1,onInput:T,onAgregar:$}),d.value.length>0?(x(),k(g,{key:0,color:"primary",flat:"",icon:"east",onClick:S,round:""})):N("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):N("",!0)}};export{at as default};
