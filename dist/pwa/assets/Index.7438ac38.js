import{a as q,u as j,r as m,c as S,o as D,g as N,e,w as i,f as s,a0 as f,S as A,b6 as W,aI as X,Q as b,a1 as B,an as Z,ak as M,a4 as I,a3 as z,d as T,h as E,aA as H}from"./index.5d1587b8.js";import{Q as u}from"./QCardSection.126a1f08.js";import{Q as V}from"./QCard.54bfbc35.js";import{b as r,Q as G}from"./QList.07e4a383.js";import{c as P}from"./QDrawer.321cde08.js";import{Q as h}from"./QPage.2113692a.js";import{Q as J}from"./QInput.8a11a2ce.js";import{Q as O,d as ee}from"./QSelect.2830bf69.js";import{Q as K}from"./QCardActions.ac2250ab.js";import{u as L}from"./use-quasar.c1bcf1af.js";import"./jspdf.plugin.autotable.0712c099.js";import{r as U}from"./refundsApi.ce3c7a93.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as C}from"./dayjs.min.cbcf888d.js";import{Q as te}from"./QDate.5bd53ca2.js";import{Q as se}from"./QTable.52a96cf7.js";import{C as le}from"./ClosePopup.18137bc7.js";import{p as oe}from"./Refund.7883d261.js";import"./axios.7afe1591.js";import"./use-key-composition.e6d81a7d.js";import"./QResizeObserver.942de858.js";import"./QScrollObserver.9edb0cab.js";import"./_commonjsHelpers.88e99c8f.js";import"./use-render-cache.3aae9b27.js";import"./date.a97bc80b.js";import"./QLinearProgress.1c16105b.js";import"./QCheckbox.41464cb5.js";const ae={class:"text-bold text-centerz"},ie={class:"row"},ne=["onClick"],re={class:"col"},de={class:"text-bold"},ue={class:"col"},ce={class:"text-bold"},ve={class:"col"},fe={class:"text-bold"},me={class:"col"},pe={class:"text-bold"},_e={class:"col"},ye={class:"text-bold"},xe={class:"col"},we={class:"text-bold"},be={class:"text-bold"},ge={class:"text-bold"},Ve={class:"col"},ke={class:"text-bold"},De={class:"col"},Ce={class:"text-caption"},Qe={class:"text-bold"},F={__name:"ViewRefunds",props:{refunds:{type:Array,default:[]},status:{type:Array,default:[]}},setup(Q){const k=q(),d=j(),y=L(),c=m(null),v=m(null),p=m({state:!1,val:null}),x=Q,w=m({columns:[{name:"id",label:"ID",field:t=>t.id},{name:"reference",label:"REFERENCIA",field:t=>t.reference},{name:"destiny",label:"DESTINO",field:t=>t.storefrom.name},{name:"origin",label:"ORIGEN",field:t=>t.storeto.name},{name:"createby",label:"CREADO POR",field:t=>t.createdby.complete_name},{name:"date",label:"FECHA",field:t=>C(t.created_at).format("DD-MM-YYYY HH:mm:ss")},{name:"status",label:"Estado",field:t=>t.status}],filter:""}),g=S(()=>c.value&&!v.value?x.refunds.filter(t=>t.status.id==c.value.id):!c.value&&v.value?x.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==v.value):c.value&&v.value?x.refunds.filter(t=>C(t.created_at).format("YYYY/MM/DD")==v.value&&t.status.id==c.value.id):x.refunds),n=t=>{switch(t){case 1:return"red";case 2:return"yellow";case 3:return"blue";case 4:return"green"}},$=t=>{t.status.id==1&&t.storefrom.id==d.session.store.id?(console.log("terminar el que se esta creando"),k.push(`/refunds/${t.id}`)):t.status.id==1&&t.storeto.id==d.session.store.id?y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storefrom.id==d.session.store.id?y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storeto.id==d.session.store.id?(console.log("se va a recibir"),p.value.state=!0,p.value.val=t):t.status.id==3&&t.storeto.id==d.session.store.id?k.push(`/refunds/verified/${t.id}`):t.status.id==4&&y.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"})},R=async t=>{y.loading.show({message:"Cambiando Estado"});let a={id:t.id,uid:d.session.id};const l=await U.nexState(a);l.fail?console.log(l):(k.push(`/refunds/verified/${t.id}`),y.loading.hide())},Y=t=>{console.log(t),oe.refund(t)};return(t,a)=>(D(),N(z,null,[e(se,{rows:g.value,grid:"",columns:w.value.columns,filter:w.value.filter},{"top-left":i(()=>[s("div",ae,f(v.value),1)]),"top-right":i(()=>[s("div",ie,[e(J,{class:"col",filled:"",dense:"",modelValue:w.value.filter,"onUpdate:modelValue":a[0]||(a[0]=l=>w.value.filter=l),placeholder:"Buscar"},{append:i(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{class:"col",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),options:Q.status,label:"Estado",dense:"",filled:"","option-label":"name"},W({_:2},[c.value?{name:"append",fn:i(()=>[e(A,{name:"cancel",onClick:a[1]||(a[1]=X(l=>c.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(b,{color:"primary",flat:"",icon:"event"},{default:i(()=>[e(ee,null,{default:i(()=>[e(te,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=l=>v.value=l),landscape:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})])]),item:i(l=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:o=>$(l.row)},[e(V,{bordered:"",class:"text-center my-card"},{default:i(()=>[e(u,{class:"row",dense:""},{default:i(()=>[s("div",re,[a[6]||(a[6]=s("div",{class:"text-caption"},"ID",-1)),s("div",de,f(l.row.id),1)]),e(r,{vertical:""}),s("div",ue,[a[7]||(a[7]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",ce,f(l.row.reference),1)]),e(r,{vertical:""}),s("div",ve,[a[8]||(a[8]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",fe,f(B(C)(l.row.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:2},1024),e(r),e(u,{class:"row"},{default:i(()=>[s("div",me,[a[9]||(a[9]=s("div",{class:"text-caption"},"Origen",-1)),s("div",pe,f(l.row.storefrom.name),1)]),e(r,{vertical:""}),s("div",_e,[a[10]||(a[10]=s("div",{class:"text-caption"},"Destino",-1)),s("div",ye,f(l.row.storeto.name),1)])]),_:2},1024),e(r),e(u,{class:"row"},{default:i(()=>[s("div",xe,[a[11]||(a[11]=s("div",{class:"text-caption"},"Tipo",-1)),s("div",we,f(l.row.type.name),1)]),e(r,{vertical:""}),s("div",{class:Z(`col bg-${n(l.row.status.id)}`)},[a[12]||(a[12]=s("div",{class:"text-caption"},"Estado",-1)),s("div",be,f(l.row.status.name),1)],2)]),_:2},1024),e(r),e(u,null,{default:i(()=>[a[13]||(a[13]=s("div",{class:"text-caption"},"Creado Por",-1)),s("div",ge,f(l.row.createdby.complete_name),1)]),_:2},1024),e(u,{class:"row",onClick:o=>Y(l.row)},{default:i(()=>[s("div",Ve,[a[14]||(a[14]=s("div",{class:"text-caption"},"Devolucion",-1)),s("div",ke,f(l.row.fs_id),1)]),e(r,{vertical:""}),s("div",De,[s("div",Ce,f(l.row._type==1?"ABONO":"ENTRADA"),1),s("div",Qe,f(l.row._type==1?l.row.season_ticket:l.row.entry),1)])]),_:2},1032,["onClick"])]),_:2},1024)],8,ne)]),_:1},8,["rows","columns","filter"]),e(G,{modelValue:p.value.state,"onUpdate:modelValue":a[5]||(a[5]=l=>p.value.state=l),persistent:""},{default:i(()=>[e(V,null,{default:i(()=>[e(u,{class:"text-center text-bold text-h5"},{default:i(()=>a[15]||(a[15]=[M(" Quires recepcionar la devolucion ? ")])),_:1}),e(K,{align:"right"},{default:i(()=>[I(e(b,{flat:"",label:"Cancelar",color:"negative"},null,512),[[le]]),e(b,{flat:"",label:"Recibir",color:"positive",onClick:a[4]||(a[4]=l=>R(p.value.val))})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},$e={class:"row justify-between"},Re={class:"row"},Ye={key:0},Ee={class:"row"},Se={class:"row"},nt={__name:"Index",setup(Q){const k=q(),d=j(),y=L(),c=m([]),v=m([]),p=m([]),x=m(null),w=m(!1),g=m(!1),n=m({state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:d.session.store.id,store_to:null,_created_by:d.session.id}),$=S(()=>n.value.type?n.value.type.id==1?p.value.filter(l=>l._type==1):p.value.filter(l=>l._type==2):p.value),R=S(()=>!(n.value.reference&&n.value.type&&n.value.provider)),Y=async()=>{y.loading.show({message:"Obteniendo Datos",type:"positive",position:"center"});let l=d.session.store.id;const o=await U.index(l);o.error?console.log(o):(console.log(o),c.value=o.types,p.value=o.provider,x.value=o.refunds,v.value=o.status,y.loading.hide())},t=async()=>{n.value={state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:d.session.store.id,store_to:null,_created_by:d.session.id}},a=async()=>{n.value.store_to=n.value.provider._store,console.log(n.value);const l=await U.addRefund(n.value);l.error?console.log(l):(console.log(l),y.notify({message:"Se creo correctamente la devolucion",type:"positive",position:"center"}),k.push(`/refunds/${l.id}`))};return Y(),(l,o)=>(D(),N(z,null,[e(h,{padding:""},{default:i(()=>[e(V,null,{default:i(()=>[e(u,null,{default:i(()=>[s("div",$e,[s("div",null,[o[8]||(o[8]=M("Helpers ")),e(A,{name:"navigate_next",color:"primary"}),o[9]||(o[9]=M()),o[10]||(o[10]=s("span",{class:"text-h6"},"Devoluciones ",-1))]),s("div",Re,[B(d).session.store.id!=1?(D(),T(b,{key:0,color:"primary",icon:"add",flat:"",onClick:o[0]||(o[0]=_=>n.value.state=!n.value.state)})):E("",!0)])])]),_:1})]),_:1}),e(r,{spaced:"",inset:"",vertical:"",dark:""}),x.value?(D(),N("div",Ye,[e(V,{class:"my-card"},{default:i(()=>[e(u,{class:"text-center text-bold text-h6"},{default:i(()=>[s("div",Ee,[o[11]||(o[11]=s("div",{class:"col"},"Destino",-1)),e(b,{color:"grey",round:"",flat:"",dense:"",icon:w.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[1]||(o[1]=_=>w.value=!w.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:i(()=>[e(P,null,{default:i(()=>[I(s("div",null,[e(F,{refunds:x.value.to,status:v.value},null,8,["refunds","status"])],512),[[H,w.value]])]),_:1})]),_:1})]),_:1}),e(r,{spaced:"",inset:"",vertical:"",dark:""}),B(d).session.store.id!=1?(D(),T(V,{key:0,class:"my-card"},{default:i(()=>[e(u,{class:"text-center text-bold text-h6"},{default:i(()=>[s("div",Se,[o[12]||(o[12]=s("div",{class:"col"},"Origen",-1)),e(b,{color:"grey",round:"",flat:"",dense:"",icon:g.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[2]||(o[2]=_=>g.value=!g.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:i(()=>[e(P,null,{default:i(()=>[I(s("div",null,[e(F,{refunds:x.value.from,status:v.value},null,8,["refunds","status"])],512),[[H,g.value]])]),_:1})]),_:1})]),_:1})):E("",!0)])):E("",!0)]),_:1}),e(G,{modelValue:n.value.state,"onUpdate:modelValue":o[7]||(o[7]=_=>n.value.state=_),persistent:""},{default:i(()=>[e(V,null,{default:i(()=>[e(u,null,{default:i(()=>o[13]||(o[13]=[s("span",{class:"text-center text-h6 text-bold"},"Nueva Devolucion",-1)])),_:1}),e(u,null,{default:i(()=>[e(J,{modelValue:n.value.reference,"onUpdate:modelValue":o[3]||(o[3]=_=>n.value.reference=_),type:"text",label:"Referencia",filled:"",dense:""},null,8,["modelValue"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:n.value.type,"onUpdate:modelValue":[o[4]||(o[4]=_=>n.value.type=_),o[5]||(o[5]=()=>n.value.provider=null)],options:c.value,label:"Tipo",filled:"",dense:"","option-label":"name"},null,8,["modelValue","options"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:n.value.provider,"onUpdate:modelValue":o[6]||(o[6]=_=>n.value.provider=_),options:$.value,label:"Destino",filled:"",dense:"",disable:n.value.type==null,"option-label":"name"},null,8,["modelValue","options","disable"]),e(r,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(K,{align:"right"},{default:i(()=>[e(b,{flat:"",label:"Cancel",color:"primary",onClick:t}),e(b,{flat:"",label:"Enviar",color:"primary",onClick:a,disable:R.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{nt as default};
