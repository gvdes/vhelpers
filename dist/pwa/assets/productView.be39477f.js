import{a as z,Q as L}from"./QSelect.9889a937.js";import{a as S,d as g,e as u,b as x}from"./QList.eb8278b8.js";import{Q as B}from"./QCardSection.c56eb11d.js";import{u as M,a as O,aI as T,c as P,l as $,p as F,o as v,d as y,w as i,e,f as a,a0 as d,g as h,a3 as D,a2 as q,al as r,ak as A,Q as b,a4 as G,b9 as H,h as _}from"./index.55af4c22.js";import{Q as J}from"./QInput.bb35ed2f.js";import{Q as K}from"./QSpace.d77ab61d.js";import{Q as W}from"./QCardActions.d9a34e26.js";import{Q as X}from"./QCard.87a66689.js";import{u as Y}from"./use-quasar.c7466d1e.js";import{o as w}from"./orderApi.022ffd76.js";import{R as k}from"./resoursesOrder.7e93f274.js";const Z={class:"row"},tt={class:"text-subtitle2 col text-bold text-left text-muted text-overline"},et={class:"text-subtitle2 col text-bold text-center text-muted text-overline"},ot={class:"text-subtitle2 col text-bold text-right text-muted text-overline"},lt={class:"row"},st={class:"text-h6 col text-bold text-left text-strong"},it={class:"text-h6 col text-bold text-right text-strong"},at={class:"text-subtitle2 col text-muted"},dt={class:"item-center row"},rt={class:"row items-end"},ct={class:"text-center"},ut={class:"col q-pa-xs"},nt={class:"col column q-py-md bg-section",style:{"border-radius":"8px"}},pt={class:"col q-pa-xs"},_t={__name:"productView",props:{product:{type:Object,default:{}},order:{type:Object,default:{}},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]},units:{type:Array,default:[]},unit:{type:Object,default:{}}},emits:["reset","addProduct","deleteProduct"],setup(l,{emit:N}){M();const f=Y();O(),T();const t=l,Q=N,C=P(()=>!t.product.pivot.amount||t.product.pivot.amount<=0),n=P(()=>t.product.pivot._supply_by==3?t.product.pivot.amount*t.product.pieces:t.product.pivot._supply_by==2?t.product.pivot.amount*12:t.product.pivot.amount),I=()=>{t.product.pivot._supply_by=t.product.units.id},U=P(()=>t.order.client._price_list<=3?[1,2,3,4]:[t.order.client._price_list]),p=P(()=>t.order.client._price_list<=3?n.value>=t.product.pieces&&(t.product.pivot._supply_by==1||t.product.pivot._supply_by==2)||t.product.pivot._supply_by==3?4:k.verificarPrecioDocena(t.products,t.product,t.rules)?3:k.verificarPrecioMayoreo(t.products,t.product,t.rules)?2:1:t.order.client._price_list),V=()=>{Q("reset")},j=async()=>{f.loading.show({message:"Editando Producto"});let c=t.product.prices.find(m=>m.id==p.value).pivot.price,s=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=p.value,t.product.pivot.price=c,t.product.pivot.total=s,console.log(t.product.pivot);const o=await w.editProduct(t.product.pivot);o.fail?console.log(o):(f.loading.hide(),V(),k.actualizarPreciosProductos(t.products,t.order,t.rules))},R=async()=>{f.loading.show({message:"Agregando producto"});let c=t.product.prices.find(m=>m.id==p.value).pivot.price,s=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=p.value,t.product.pivot.price=c,t.product.pivot.total=s,t.product.pivot._product=t.product.id,t.product.pivot._order=t.order.id,console.log(t.product.pivot);const o=await w.addProduct(t.product.pivot);o.fail?console.log(o):(Q("addProduct",t.product),f.loading.hide(),k.actualizarPreciosProductos(t.products,t.order,t.rules))},E=async()=>{f.loading.show({message:"Eliminando Producto"});const c=await w.deleteProduct(t.product.pivot);c.fail?console.log(c):(Q("deleteProduct",t.product),f.loading.hide(),k.actualizarPreciosProductos(t.products,t.order,t.rules))};return $(n,c=>{t.product.pivot.units=c},t.product.units),F(()=>{!t.product.pivot._supply_by&&t.units.length&&(t.product.pivot._supply_by=t.product.units),t.product.pivot.amount||(t.product.pivot.amount=1),t.product.pivot.units=n.value}),(c,s)=>(v(),y(X,{class:"card-bg"},{default:i(()=>[e(B,null,{default:i(()=>[a("div",Z,[a("div",tt,d(l.product.category.familia.seccion.name),1),a("div",et,d(l.product.category.familia.name),1),a("div",ot,d(l.product.category.name),1)]),a("div",lt,[a("div",st,d(l.product.code),1),a("div",it,d(l.product.name),1)]),a("div",at,d(l.product.description),1),e(S,{class:"q-mt-md q-mb-md"},{default:i(()=>[e(g,null,{default:i(()=>[(v(!0),h(D,null,q(l.product.stocks,(o,m)=>(v(),y(u,{key:m},{default:i(()=>[e(z,{caption:"",class:"text-center text-muted"},{default:i(()=>[r(d(o.alias),1)]),_:2},1024),e(z,{overline:"",class:"text-center text-strong"},{default:i(()=>[r(d(o.pivot.stock),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a("div",dt,[(v(!0),h(D,null,q(l.product.prices.filter(o=>U.value.includes(o.id)),(o,m)=>(v(),h("div",{class:"col text-subtitle2 text-center",key:m},[a("div",{class:A(o.id==p.value?"text-strong":"text-caption text-muted text-strike")},d(o.alias),3),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),a("div",{class:A(o.id==p.value?"text-bold text-price":"text-caption text-muted")},d(o.pivot.price),3),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}})]))),128))])]),_:1}),e(B,null,{default:i(()=>[a("div",rt,[a("div",ct,[a("div",ut,[s[5]||(s[5]=a("div",{class:"text-bold text-h6 text-strong"},"Cantidad:",-1)),e(b,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:s[0]||(s[0]=o=>l.product.pivot.amount++)}),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),a("div",nt,[G(a("input",{type:"number",min:"1","onUpdate:modelValue":s[1]||(s[1]=o=>l.product.pivot.amount=o),class:"text-center exo clean-input",style:{width:"100px","font-size":"3em",margin:"auto"}},null,512),[[H,l.product.pivot.amount]])]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(b,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:s[2]||(s[2]=o=>l.product.pivot.amount>1?l.product.pivot.amount--:"")})])]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),a("div",pt,[e(L,{dense:"",filled:"",modelValue:l.product.units,"onUpdate:modelValue":[s[3]||(s[3]=o=>l.product.units=o),I],options:l.units,label:"Surtir por","option-label":"name"},null,8,["modelValue","options"]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(J,{dense:"",filled:"",modelValue:l.product.pivot.comments,"onUpdate:modelValue":s[4]||(s[4]=o=>l.product.pivot.comments=o),type:"text",label:"Notas"},null,8,["modelValue"]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(S,{dense:""},{default:i(()=>[e(g,{class:"bg-highlight"},{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>s[6]||(s[6]=[r("P x C")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(d(l.product.pieces)+" pzs",1)]),_:1})]),_:1}),e(g,null,{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>s[7]||(s[7]=[r("Cajas")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(d(Number(n.value/l.product.pieces).toFixed(1)),1)]),_:1})]),_:1}),e(g,{class:"bg-highlight"},{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>s[8]||(s[8]=[r("Unidades")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(d(n.value)+" pzs",1)]),_:1})]),_:1}),e(g,null,{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>s[9]||(s[9]=[r("Precio")])),_:1}),e(u,{class:"text-bold text-center text-price"},{default:i(()=>[r(d(l.product.prices.find(o=>o.id==p.value).pivot.price),1)]),_:1})]),_:1}),e(g,null,{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>s[10]||(s[10]=[r("Total")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(d(l.product.prices.find(o=>o.id==p.value).pivot.price*n.value),1)]),_:1})]),_:1})]),_:1})])])]),_:1}),e(W,null,{default:i(()=>[e(b,{flat:"",icon:"close",onClick:V}),e(K),l.edit?_("",!0):(v(),y(b,{key:0,flat:"",icon:"add",color:"positive",onClick:R,disable:C.value},null,8,["disable"])),l.edit?(v(),y(b,{key:1,flat:"",icon:"delete",color:"negative",onClick:E})):_("",!0),l.edit?(v(),y(b,{key:2,flat:"",icon:"edit",color:"warning",onClick:j,disable:C.value},null,8,["disable"])):_("",!0)]),_:1})]),_:1}))}};export{_t as _};
