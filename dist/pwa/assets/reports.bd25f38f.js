import{Q as h}from"./QTable.0b86df47.js";import{Q as w}from"./QCard.05f24660.js";import{Q as j}from"./QList.665eff37.js";import{Q as L}from"./QPage.d062feb2.js";import{r as m,c,o as k,g as H,d as x,w as i,e as s,f as d,a0 as b,a1 as E,Q as z,al as C,h as T,a3 as P,aW as W,a as J,u as O}from"./index.1f7b8a29.js";import{u as R}from"./use-quasar.86b2ec74.js";import{d as U}from"./dayjs.min.cbcf888d.js";import"./QSelect.5b758eaa.js";import"./QDrawer.b65965dc.js";import"./QExpansionItem.d748f98e.js";import{Q as B}from"./QCardSection.ff59d0d4.js";import"./QCardActions.b3b7497c.js";import"./ClosePopup.f4c3add5.js";import"./axios.e19957ad.js";import{c as q}from"./cyclecountStore.8292398b.js";import{Q as N,a as G,b as A}from"./QTabPanels.1228620c.js";import{Q as K}from"./QTabs.8c66d7b7.js";import{C as X}from"./cicsdb.82c2d54b.js";import{E as Z}from"./exceljs.min.9e24d01d.js";import{f as ee}from"./FileSaver.min.89adfc30.js";import"./use-key-composition.6cabea2f.js";import"./QLinearProgress.2095a778.js";import"./QCheckbox.26d8e156.js";import"./use-checkbox.84100de6.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.acde25c3.js";import"./QScrollObserver.b39d7e32.js";import"./TouchSwipe.6421a154.js";import"./use-render-cache.3aae9b27.js";const le={class:"row justify-between"},ae={class:"text-h6"},oe={class:"text-subtitle2"},te={class:"text-subtitle2"},se={class:"text-subtitle2"},ne={class:"text-white"},re={__name:"Viewer",props:{folio:[String,Number],store:[String,Number]},emits:["errorsearch"],setup(Q,{emit:I}){const p=R(),u=Q,g=u.folio,y=u.store,e=m(null),o=m(null),n=m("body"),f=m(null),S=m({cols:[{name:"id",field:"id",label:"ID",align:"left"},{name:"lcode",field:"code",label:"Codigo"},{name:"scode",field:"name",label:"Codigo C."},{name:"descr",field:"description",label:"Articulo",align:"left",classes:"fs-dec4"},{name:"sai",field:l=>l.ordered.stocks,label:"SAI",align:"center"},{name:"counteds",field:l=>l.ordered.stocks_acc,label:"UC",align:"center"},{name:"sat",field:l=>{var a;return(a=l.ordered.stocks_end)!=null?a:"--"},label:"SAT",align:"center"},{name:"ufus",field:l=>l.ordered.stocks_acc-l.ordered.stocks,label:"UF/US",align:"center"},{name:"locs",field:l=>l.locations.map(a=>a.path).join(", "),label:"Ubicacion (es)",align:"left"}],columnsLog:[{name:"id",field:"id",label:"ID",align:"left"},{name:"name",field:"name",label:"Nombre",align:"left"},{name:"responsable",field:l=>l.details.responsable,label:"Responsable",align:"left"},{name:"fecha",field:"created_at",label:"Fecha",align:"left"}]}),_=c(()=>e.value?e.value.created_by:null),Y=c(()=>e.value?e.value.log:[]),V=c(()=>e.value&&e.value.responsables&&e.value.responsables.length?e.value.responsables.map(l=>l.nick).join(","):""),M=c(()=>e.value&&e.value.products&&e.value.products.length?e.value.products:[]),D=c(()=>e.value?e.value.status.name:"");c(()=>""),c(()=>""),(async()=>{p.loading.show({message:"Obteniendo Informacion"});const l=await X.find(g,y);console.log(l),l.fail?o.value=l.fail:e.value=l.inventory,p.loading.hide()})();const F=l=>{let a=`INV_${e.value.id}_${e.value.workpoint.alias}.xlsx`;console.log(a);let v=new Z.Workbook,t=v.addWorksheet("Sheet1");t.columns=[{header:"ID",key:"id"},{header:"Codigo",key:"lcode"},{header:"Codigo C.",key:"scode"},{header:"Articulo",key:"description"},{header:"SAI",key:"sai"},{header:"UC",key:"uc"},{header:"SAT",key:"sat"},{header:"UF/US",key:"ufus"},{header:"Ubicacion(es)",key:"locs"}],M.value.forEach(r=>{t.addRow({id:r.id,lcode:r.code,scode:r.name,description:r.description,sai:parseInt(r.ordered.stocks),uc:parseInt(r.ordered.stocks_acc),sat:parseInt(r.ordered.stocks_end),ufus:parseInt(r.ordered.stocks_acc)-parseInt(r.ordered.stocks),locs:r.locations.map($=>$.path).join(", ")})}),t.getCell("L2").value="Folio:",t.getCell("M2").value=e.value.id,t.getCell("L3").value="Sucursal:",t.getCell("M3").value=e.value.workpoint.name,t.getCell("L4").value="Estado:",t.getCell("M4").value=D.value,t.getCell("L5").value="Creado por:",t.getCell("M5").value=_.value?_.value.names:"",t.getCell("L6").value="Realizado por:",t.getCell("M6").value=V.value,t.getCell("L7").value="Inicio:",t.getCell("M7").value="",t.getCell("L8").value="Termino:",t.getCell("M8").value="",v.xlsx.writeBuffer().then(r=>ee(new Blob([r],{type:"application/octet-stream"}),a))};return(l,a)=>(k(),H(P,null,[e.value?(k(),x(w,{key:0,class:"my-card"},{default:i(()=>[s(B,null,{default:i(()=>[d("div",le,[d("div",ae,"Inventario "+b(E(g)),1),d("div",null,[s(z,{color:"primary",label:"descargar",onClick:F})])]),d("div",oe,[a[2]||(a[2]=C("Creado por: ")),d("b",null,b(_.value?_.value.names:"Nobody"),1)]),d("div",te,[a[3]||(a[3]=C("Realizado por: ")),d("b",null,b(V.value),1)]),d("div",se,[a[4]||(a[4]=C("Estado: ")),d("b",null,b(D.value),1)])]),_:1}),s(K,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=v=>n.value=v)},{default:i(()=>[s(N,{name:"log",label:"Log"}),s(N,{name:"body",label:"Resumen"})]),_:1},8,["modelValue"]),s(G,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=v=>n.value=v),animated:""},{default:i(()=>[s(A,{name:"log"},{default:i(()=>[a[5]||(a[5]=d("div",{class:"text-h6"},"Log",-1)),s(h,{rows:Y.value,columns:S.value.columnsLog},null,8,["rows","columns"])]),_:1}),s(A,{name:"body"},{default:i(()=>[s(h,{flat:"",rows:M.value,columns:S.value.cols,"row-key":"name",ref_key:"rowsproducts",ref:f},null,8,["rows","columns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):T("",!0),o.value?(k(),x(w,{key:1,class:"bg-negative"},{default:i(()=>[s(B,null,{default:i(()=>[d("pre",ne,b(o.value),1)]),_:1})]),_:1})):T("",!0)],64))}},Re={__name:"reports",setup(Q){m(""),R(),W(),J();const I=O(),p=q();p.settitle("Ciclicos"),p.setshowBtns(!0);const u=m({state:!1,data:null}),g=c(()=>p.cyclecounts),y=m({cols:[{name:"id",field:"id",label:"Folio"},{name:"started",field:o=>U(o.created_at).format("YYYY/MM/DD HH:mm:ss"),label:"Creacion",align:"center"},{name:"status",field:o=>o.status.name,label:"Estado",align:"center"},{name:"ended",field:o=>{let n=o.log.find(f=>f.id==3);return n?U(n.pivot.created_at).format("YYYY/MM/DD HH:mm:ss"):"--"},align:"center",label:"Termino"},{name:"models",field:"products_count",label:"Modelos"},{name:"type",field:o=>o.type.name,label:"Tipo"},{name:"warehouse",field:o=>o.settings?JSON.parse(o.settings).warehouse.name:"---",label:"Almacen"}]}),e=async(o,n,f)=>{u.value.folio=n.id,u.value.state=!0};return(o,n)=>(k(),x(L,{padding:""},{default:i(()=>[s(L,{padding:""},{default:i(()=>[s(w,{class:"my-card",flat:""},{default:i(()=>[s(h,{title:"Inventarios",rows:g.value,columns:y.value.cols,"row-key":"id",onRowClick:e},null,8,["rows","columns"])]),_:1}),s(j,{modelValue:u.value.state,"onUpdate:modelValue":n[0]||(n[0]=f=>u.value.state=f),"full-width":""},{default:i(()=>[s(re,{folio:u.value.folio,store:E(I).session.store.id_viz},null,8,["folio","store"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}};export{Re as default};
