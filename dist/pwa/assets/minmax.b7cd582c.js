import{Q as ie,a as p}from"./QSelect.12dc6247.js";import{b as z,a as F,d as y,e as r,Q as ne}from"./QList.305caac5.js";import{u as ue,r as k,c as de,l as re,p as me,o as M,g as D,e,w as l,f as ve,a3 as U,Q as R,U as pe,an as G,ak as u,a0 as c,a1 as w,a2 as J,h as ce,a4 as fe,d as O}from"./index.77abf6d1.js";import{Q as g}from"./QCardSection.578649e2.js";import{Q as P}from"./QCard.4b64cf3a.js";import{Q as I}from"./QInput.296f34c4.js";import{Q as H}from"./QTable.e8d8347a.js";import{Q as W,a as xe,b as X}from"./QTabPanels.e5c3a3f6.js";import{Q as ge}from"./QTabs.b0e9c02c.js";import{Q as be}from"./QCardActions.82c96ee7.js";import{Q as _e}from"./QFooter.40d93853.js";import{Q as ke}from"./QPage.a56dd8cd.js";import{C as we}from"./ClosePopup.2e567ed2.js";import"./QDrawer.6038474d.js";import"./axios.3c55aa06.js";import{u as ye}from"./use-quasar.ef5b2aed.js";import{u as Qe}from"./warehousStore.9fafbe2e.js";import{P as Ve,d as Me}from"./ProductsAutocomplete.5c6be8f2.js";import"./jspdf.plugin.autotable.b5a44541.js";import{E as Ne}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{p as q}from"./productsApi.4d61953c.js";import"./use-key-composition.09ed0229.js";import"./QLinearProgress.20583cc8.js";import"./QCheckbox.7cd0a6fa.js";import"./use-render-cache.3aae9b27.js";import"./QResizeObserver.4d389a46.js";import"./QScrollObserver.1ae8179f.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const ia={__name:"minmax",setup(ze){const d=ue(),m=ye();Qe().setTitle("Minimos Y Maximos");const h=k(null),C=k("products"),n=k({state:!1,val:null}),v=k({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),i=k({min:null,max:null}),N=k(null),f=k({val:null,opts:[{id:1,label:"Pieza"},{id:2,label:"Docena"},{id:3,label:"Caja"},{id:4,label:"Media Caja"}]}),L=k({columns:[{name:"store",label:"Sucursal",field:o=>o.name,align:"left"},{name:"Stock",label:"Stock PZ",field:o=>o.pivot.stock,align:"center"}],pagination:{rowsPerPage:10}}),A=de(()=>m.platform.is.mobile),Y=o=>{console.log(o)},Z=o=>{var t;n.value.state=!0,n.value.val=o,console.log(o);const a=o.stocks.find(s=>s.id==d.session.store.id_viz);if(a){let s=1;switch((t=f.value.val)==null?void 0:t.id){case 1:s=1;break;case 2:s=12;break;case 3:s=o.pieces||1;break;case 4:s=(o.pieces||1)/2;break}N.value={min:a.pivot.min/s,max:a.pivot.max/s},i.value.min=a.pivot.min/s,i.value.max=a.pivot.max/s}},K=()=>{var t;if(!n.value.val)return;const o=n.value.val.stocks.find(s=>s.id==d.session.store.id_viz);if(!o)return;let a=1;switch((t=f.value.val)==null?void 0:t.id){case 1:a=1;break;case 2:a=12;break;case 3:a=n.value.val.pieces||1;break;case 4:a=(n.value.val.pieces||1)/2;break}o.pivot.min=i.value.min*a,o.pivot.max=i.value.max*a},ee=async()=>{const o=n.value.val.stocks.find(a=>a.id==d.session.store.id_viz);if(o.pivot.min!==N.value.min){let a={product:n.value.val.id,min:o.pivot.min,_workpoint:d.session.store.id_viz};console.log(a),m.loading.show({message:"Modificando"});const t=await q.setMin(a);t.fail?console.log(t):(m.loading.hide(),N.value.min=a.min,m.notify({message:t.message,type:t.success?"positive":"negative",position:"top"}))}},ae=async()=>{const o=n.value.val.stocks.find(a=>a.id==d.session.store.id_viz);if(o.pivot.max!==N.value.max){let a={product:n.value.val.id,max:o.pivot.max,_workpoint:d.session.store.id_viz};console.log(a),m.loading.show({message:"Modificando"});const t=await q.setMax(a);t.fail?console.log(t):(m.loading.hide(),N.value.max=a.max,m.notify({message:t.message,type:t.success?"positive":"negative",position:"top"}))}},le=()=>{let o=document.getElementById("inputFile").files[0],a=new Ne.Workbook,t=[],s={};a.xlsx.load(o).then(()=>{let E=a.worksheets[0];E.getColumn("A").eachCell({includeEmpty:!0},function(_,Q){let b=_.value;if(!b)return;let T=parseFloat(E.getCell(`B${Q}`).value)||0,B=parseFloat(E.getCell(`C${Q}`).value)||0;s[b]||(s[b]={minimo:0,maximo:0}),s[b].minimo=T,s[b].maximo=B});let $=Object.keys(s).map(_=>({codigo:_,minmax:s[_]}));if($.forEach(_=>t.push(_.codigo)),t.length){let _={codes:t,_workpoint:d.session.store.id_viz};m.loading.show({message:"Procesando archivo, espera.."}),Me.getMassive(_).then(Q=>{let b=Q.data;b.fails.notFound.map(x=>v.value.wndNotExist.push(x)),b.fails.repeat.map(x=>v.value.repeat.push(x));let T=b.products;v.value.wndGetRows=T.length,v.value.state=!v.value.state;let B=T.map(x=>{var j;let V=1;switch((j=f.value.val)==null?void 0:j.id){case 1:V=1;break;case 2:V=12;break;case 3:V=x.pieces||1;break;case 4:V=(x.pieces||1)/2;break}let S=$.find(se=>se.codigo===x.code);return{id:x.id,producto:x.code,descripcion:x.description,min:S?S.minmax.minimo*V:0,max:S?S.minmax.maximo*V:0}});v.value.wndTotal=B,m.loading.hide()}).catch(Q=>{console.log(Q),m.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else m.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},te=async()=>{m.loading.show({message:"actualizando Min y Max"});let o={workpoint:d.session.store.id_viz,products:v.value.wndTotal};console.log(o);const a=await q.setMassisveMinMax(o);a.fail?console.log(a):(m.loading.hide(),m.notify({message:"Datos Actualizados",type:"positive",position:"center"}),console.log(a),v.value={state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]})};return re([()=>f.value.val,()=>i.value.min,()=>i.value.max],([o,a,t],[s,E,oe])=>{localStorage.setItem("minmaxType",JSON.stringify(o)),K()},{deep:!0}),me(()=>{const o=localStorage.getItem("minmaxType");o&&(f.value.val=JSON.parse(o))}),(o,a)=>(M(),D(U,null,[e(ke,{padding:""},{default:l(()=>[e(P,{class:"my-card"},{default:l(()=>[e(g,{class:"row"},{default:l(()=>[e(ie,{class:"col",modelValue:f.value.val,"onUpdate:modelValue":a[0]||(a[0]=t=>f.value.val=t),options:f.value.opts,label:"UNIDAD",filled:"",dense:"",hint:f.value.val?`Los min y max que generes se pondran en ${f.value.val.label}`:""},null,8,["modelValue","options","hint"]),e(z,{spaced:"",inset:"",vertical:"",dark:""}),e(R,{disable:!f.value.val,color:"primary",title:"subirArchivo",icon:"upload",onClick:a[1]||(a[1]=()=>h.value.click()),flat:"",rounded:""},null,8,["disable"])]),_:1})]),_:1}),e(z,{spaced:"",inset:"",vertical:"",dark:""}),e(pe,{name:"bounce"},{default:l(()=>[n.value.state?(M(),D("div",{key:0,class:G(A.value?"":"row")},[e(P,{class:G(A.value?"":"col")},{default:l(()=>[e(g,null,{default:l(()=>[e(F,null,{default:l(()=>[e(y,null,{default:l(()=>[e(r,null,{default:l(()=>a[9]||(a[9]=[u("Codigo")])),_:1}),e(r,null,{default:l(()=>[u(c(n.value.val.code),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(r,null,{default:l(()=>a[10]||(a[10]=[u("Descripcion")])),_:1}),e(r,null,{default:l(()=>[u(c(n.value.val.description),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(r,null,{default:l(()=>a[11]||(a[11]=[u("PXC")])),_:1}),e(r,null,{default:l(()=>[u(c(n.value.val.pieces),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[a[16]||(a[16]=u("> ")),e(r,null,{default:l(()=>[e(p,{caption:""},{default:l(()=>a[12]||(a[12]=[u("GEN")])),_:1}),e(p,{overline:""},{default:l(()=>[u(c(n.value.val.stocks.find(t=>t.id==w(d).session.store.id_viz).pivot.gen),1)]),_:1})]),_:1}),e(r,null,{default:l(()=>[e(p,{caption:""},{default:l(()=>a[13]||(a[13]=[u("EXH")])),_:1}),e(p,{overline:""},{default:l(()=>[u(c(n.value.val.stocks.find(t=>t.id==w(d).session.store.id_viz).pivot.exh),1)]),_:1})]),_:1}),e(r,null,{default:l(()=>[e(p,{caption:""},{default:l(()=>a[14]||(a[14]=[u("FDT")])),_:1}),e(p,{overline:""},{default:l(()=>[u(c(n.value.val.stocks.find(t=>t.id==w(d).session.store.id_viz).pivot.fdt),1)]),_:1})]),_:1}),e(r,null,{default:l(()=>[e(p,{caption:""},{default:l(()=>a[15]||(a[15]=[u("EnTransito")])),_:1}),e(p,{overline:""},{default:l(()=>[u(c(n.value.val.stocks.find(t=>t.id==w(d).session.store.id_viz).pivot.in_transit),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g),e(g,{class:"row"},{default:l(()=>[e(I,{modelValue:i.value.min,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value.min=t),type:"number",label:"Minimo",class:"col",filled:"","input-class":"text-center",error:Number(i.value.max)<=Number(i.value.min)||Number(i.value.min)>=Number(i.value.max),"error-message":i.value.max<=i.value.min||i.value.min>=i.value.max?"El maximo es menor que el minimo":"El minimo es mayor que el maximo",onBlur:ee},null,8,["modelValue","error","error-message"]),e(z,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{modelValue:i.value.max,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value.max=t),type:"number",label:"Maximo",class:"col",filled:"","input-class":"text-center",error:Number(i.value.max)<=Number(i.value.min)||Number(i.value.min)>=Number(i.value.max),"error-message":i.value.max<=i.value.min||i.value.min>=i.value.max?"El maximo es menor que el minimo":"El minimo es mayor que el maximo",onBlur:ae},null,8,["modelValue","error","error-message"])]),_:1}),e(g,{class:"row"},{default:l(()=>[e(I,{disable:"",modelValue:n.value.val.stocks.find(t=>t.id==w(d).session.store.id_viz).pivot.min,"onUpdate:modelValue":a[4]||(a[4]=t=>n.value.val.stocks.find(s=>s.id==w(d).session.store.id_viz).pivot.min=t),type:"number",label:"Minimo",class:"col",filled:"","input-class":"text-center"},null,8,["modelValue"]),e(z,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{disable:"",modelValue:n.value.val.stocks.find(t=>t.id==w(d).session.store.id_viz).pivot.max,"onUpdate:modelValue":a[5]||(a[5]=t=>n.value.val.stocks.find(s=>s.id==w(d).session.store.id_viz).pivot.max=t),type:"number",label:"Maximo",class:"col",filled:"","input-class":"text-center"},null,8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(F,{bordered:""},{default:l(()=>[(M(!0),D(U,null,J(n.value.val.stocks.filter(t=>t._type==1),(t,s)=>(M(),O(y,{key:s},{default:l(()=>[e(r,{class:"text-bold"},{default:l(()=>[u(c(t.name),1)]),_:2},1024),e(r,{class:"text-center"},{default:l(()=>[u(c(t.pivot.stock),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["class"]),e(z,{spaced:"",inset:"",vertical:"",dark:""}),e(H,{class:G(A.value?"":"col"),rows:n.value.val.stocks.filter(t=>t._type==2),columns:L.value.columns,pagination:L.value.pagination},null,8,["class","rows","columns","pagination"])],2)):ce("",!0)]),_:1}),e(ne,{modelValue:v.value.state,"onUpdate:modelValue":a[8]||(a[8]=t=>v.value.state=t),persistent:""},{default:l(()=>[e(P,{style:{width:"800px","max-width":"90vw"}},{default:l(()=>[e(g,{class:"text-center text-h6 text-bold"},{default:l(()=>a[17]||(a[17]=[u(" Resultado de Importacion ")])),_:1}),e(g,null,{default:l(()=>[e(F,{bordered:""},{default:l(()=>[e(y,null,{default:l(()=>[e(r,null,{default:l(()=>[e(p,{class:"text-center"},{default:l(()=>a[18]||(a[18]=[u("Productos Encontrados")])),_:1}),e(p,{class:"text-center"},{default:l(()=>[u(c(v.value.wndGetRows),1)]),_:1})]),_:1}),e(r,null,{default:l(()=>[e(p,{class:"text-center"},{default:l(()=>a[19]||(a[19]=[u("Productos Repetidos")])),_:1}),e(p,{class:"text-center"},{default:l(()=>[u(c(v.value.repeat.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(ge,{modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=t=>C.value=t),class:"text-teal"},{default:l(()=>[e(W,{name:"products",icon:"local_mall",label:"Encontrados"}),e(W,{name:"notFund",icon:"wrong_location",label:"No Encontrados"})]),_:1},8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(xe,{modelValue:C.value,"onUpdate:modelValue":a[7]||(a[7]=t=>C.value=t),animated:""},{default:l(()=>[e(X,{name:"products"},{default:l(()=>[e(H,{rows:v.value.wndTotal,"virtual-scroll":"",flat:"",bordered:"",style:{height:"400px"},"row-key":"producto"},null,8,["rows"])]),_:1}),e(X,{name:"notFund"},{default:l(()=>[e(F,{bordered:""},{default:l(()=>[(M(!0),D(U,null,J(v.value.wndNotExist,(t,s)=>(M(),O(y,{key:s},{default:l(()=>[e(r,null,{default:l(()=>[u(c(t),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(be,{align:"center"},{default:l(()=>[e(R,{flat:"",label:"Modificar",color:"positive",onClick:te}),fe(e(R,{flat:"",label:"Cancelar",color:"negative"},null,512),[[we]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(_e,{reveal:"",elevated:"",bordered:""},{default:l(()=>[e(P,{class:"my-card"},{default:l(()=>[e(Ve,{onInput:Y,onAgregar:Z,"workpoint-status":"all"})]),_:1})]),_:1})]),_:1}),ve("input",{type:"file",ref_key:"inputFile",ref:h,id:"inputFile",onInput:le,hidden:"",accept:".xlsx,.xls"},null,544)],64))}};export{ia as default};
