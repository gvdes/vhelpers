import{Q as r}from"./QSeparator.5be9a59e.js";import{aE as _,u as j,r as p,c as O,o as G,a as W,w as i,e as a,f,Y as z,Q as T,a5 as K,a3 as X}from"./index.62c2a511.js";import{Q as A,b as Z}from"./QSelect.2c4767b3.js";import{Q as h}from"./QToolbar.6de377a5.js";import{Q as ee}from"./QHeader.42981c62.js";import{Q as C}from"./QInput.35e2952a.js";import{Q as le}from"./QDate.a6ff060a.js";import{Q as ae}from"./QTable.5e01f534.js";import{Q as te,a as oe}from"./QLayout.fbed4118.js";import{u as se,Q as D,a as N}from"./use-quasar.6d95b474.js";import{Q as ie}from"./QForm.95205fb5.js";import{Q as S}from"./QDialog.57daa15a.js";import{Q as L}from"./QCardActions.0c6934eb.js";import{C as ne}from"./ClosePopup.0de3bfc4.js";import"./AppFullscreen.c994e9bb.js";import"./auto.ba62c17c.js";import"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.03a4ae94.js";import{_ as ue}from"./UserToolbar.3ce921ca.js";import{A as re}from"./assistApi.2e43d6ae.js";import{u as R}from"./VDB.90d5996b.js";import{a as I}from"./axios.9ab26c22.js";import{a as de}from"./axios.ba7b1b0e.js";import"./use-key-composition.034df0e8.js";import"./uid.937d8ee7.js";import"./QItemSection.7edb7927.js";import"./position-engine.32961d90.js";import"./rtl.276c3f1b.js";import"./QResizeObserver.ac50d480.js";import"./use-render-cache.3aae9b27.js";import"./date.e89822da.js";import"./QList.56766321.js";import"./QLinearProgress.9efd24f2.js";import"./QCheckbox.f0e3188c.js";import"./_commonjsHelpers.88e99c8f.js";const ve={class:"col"},pe={class:"col"},me={class:"row"},fe={class:"q-ml-sm"},Ze={__name:"AdvancesLYT",setup(ce){const d=se();_();const B=j(),k=R();R();const u=p([]),b=p(null),m=p([]),o=p({val:null,state:!1}),v=p({val:null,opts:[]}),s=p({state:!1,val:null,body:null}),n=p({state:!1,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}),g=p([]),E=p(g.value),V=p({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODANT,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJANT,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"OBSERVACION",field:t=>t.OBSANT,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPANT).toFixed(2),align:"center",sortable:!0},{name:"client",label:"CLEINTE",field:t=>t.NOFCLI,align:"left",sortable:!0}]}),U=O(()=>b.value&&!v.value.val?m.value.filter(t=>t.FECHA==b.value):!b.value&&v.value.val?m.value.filter(t=>t.CAJANT==v.value.val.CODTER):b.value&&v.value.val?m.value.filter(t=>t.FECHA==b.value&&t.CAJANT==v.value.val.CODTER):m.value),x=O(()=>{if(o.value){const t=m.value.find(l=>l.CODRET===o.value.val.CODRET);if(!t)return!1;let e={CAJANT:t.CAJANT,CODANT:t.CODANT,OBSANT:t.OBSANT,DESTER:t.DESTER,FECHA:t.FECHA,IMPANT:Number(t.IMPANT).toFixed(2),CLIENTE:{CLIANT:t.CLIANT,NOFCLI:t.NOFCLI}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),M=O(()=>!n.value.OBSANT||!n.value.DESTER||!n.value.IMPANT||!n.value.CLIENTE),P=async()=>{d.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const t=await re.index();t.error||(console.log(t),u.value.opts=t,d.loading.hide())},H=(t,e)=>{o.value.state=!o.value.state,console.log(e);let l={CAJANT:e.CAJANT,CODANT:e.CODANT,OBSANT:e.OBSANT,DESTER:e.DESTER,FECHA:e.FECHA,IMPANT:Number(e.IMPANT).toFixed(2),CLIENTE:{CLIANT:e.CLIANT,NOFCLI:e.NOFCLI}};o.value.val={...l}},J=async()=>{console.log(u.value.val.id);let t=u.value.val.id;console.log(t);try{let e=await de.get(`/cashier/getPrinters/${t}`);e.status==200&&(s.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),d.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},$=async()=>{console.log(u.value.val.ip_address),d.loading.show({message:"Obteniendo Registros"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/getAdvances`;const l=await I.get(e);l.status!=200?console.log(l):(console.log(l.data),m.value=l.data.anticipos,v.value.opts=l.data.terminal,g.value=l.data.clientes,J(),d.loading.hide())},Q=async()=>{console.log(u.value.val.ip_address);let t={print:s.value.val.ip_address,codant:o.value.val.CODANT};console.log(t),d.loading.show({message:"Imprimiendo Anticipo"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/printAdvance`;const c=await I.post(l,t);c.status!=200?console.log(c):(console.log(c.data),s.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide())},Y=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),d.loading.show({message:"Modificando Anticipo"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/modifyAdvances`;const l=await I.post(e,o.value.val);if(l.status!=200)console.log(l);else{console.log(l.data);let c=m.value.findIndex(y=>y.CODANT==l.data.CODANT);c>=0&&(m.value[c]=l.data),s.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide()}},w=(t,e,l)=>{if(t===""){e(()=>{E.value=g.value});return}e(()=>{const c=t.toLowerCase();E.value=g.value.filter(y=>y.NOFCLI.toLowerCase().includes(c))})},q=async()=>{n.value.Print=s.value.val.ip_address,console.log(n.value),d.loading.show({message:"Agregando Anticipo"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/addAdvances`;const l=await I.post(e,n.value);l.status!=200?console.log(l):(console.log(l.data),m.value.push(l.data),s.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide(),F())},F=()=>{n.value={state:!1,CAJANT:null,CODANT:null,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}};return k.session.rol==="adm"||k.session.rol==="root"?P():(d.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),B.replace("/")),(t,e)=>(G(),W(te,{view:"hHh Lpr fFf"},{default:i(()=>[a(ee,{class:"bg-grey-3 text-dark",bordered:""},{default:i(()=>[a(ue),a(r),a(h,{class:"justify-between row"},{default:i(()=>[f("div",ve,[e[20]||(e[20]=f("span",{class:"text-grey"},"Helpers",-1)),a(z,{name:"navigate_next",color:"primary"}),e[21]||(e[21]=f("span",{class:"text-h6"},"Anticipos Sucursal",-1))]),f("div",pe,[f("div",me,[e[22]||(e[22]=f("div",{class:"col"},null,-1)),a(A,{class:"col",modelValue:u.value.val,"onUpdate:modelValue":[e[0]||(e[0]=l=>u.value.val=l),$],options:u.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(oe,null,{default:i(()=>[a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(ae,{rows:U.value,filter:V.value.filter,columns:V.value.columns,onRowClick:H},{"top-right":i(()=>[a(C,{modelValue:V.value.filter,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value.filter=l),type:"text",label:"Buscar",filled:"",dense:"",disable:!u.value.val},null,8,["modelValue","disable"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:v.value.val,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.val=l),options:v.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!u.value.val},null,8,["modelValue","options","disable"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"event",flat:"",round:"",disable:!u.value.val},{default:i(()=>[a(Z,null,{default:i(()=>[a(le,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"add",flat:"",onClick:e[4]||(e[4]=l=>n.value.state=!n.value.state),disable:!u.value.val},null,8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),a(S,{modelValue:s.value.state,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.state=l)},{default:i(()=>[a(D,{class:"my-card"},{default:i(()=>[a(N,null,{default:i(()=>e[23]||(e[23]=[f("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),a(N,null,{default:i(()=>[a(ie,{onSubmit:Q,class:"q-gutter-md"},{default:i(()=>[a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),f("div",null,[a(T,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(S,{modelValue:o.value.state,"onUpdate:modelValue":e[13]||(e[13]=l=>o.value.state=l),persistent:""},{default:i(()=>[a(D,{style:{width:"300px"}},{default:i(()=>[a(N,{class:"text-bold text-center text-h5"},{default:i(()=>[f("span",fe,"Retirada "+K(o.value.val.CODRET),1)]),_:1}),a(N,null,{default:i(()=>[a(C,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.val.FECHA=l),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.val.DESTER=l),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:o.value.val.CLIENTE,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.val.CLIENTE=l),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:w},null,8,["modelValue","options"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.OBSANT,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.val.OBSANT=l),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.IMPANT,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.val.IMPANT=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(r,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(L,{align:"center"},{default:i(()=>[X(a(T,{flat:"",color:"negative",icon:"close"},null,512),[[ne]]),a(T,{flat:"",color:"primary",icon:"print",onClick:Q,disable:!x.value||!s.value.val},null,8,["disable"]),a(T,{flat:"",color:"yellow",icon:"edit",disable:x.value||!s.value.val,onClick:Y},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(S,{modelValue:n.value.state,"onUpdate:modelValue":e[19]||(e[19]=l=>n.value.state=l),persistent:""},{default:i(()=>[a(D,{style:{width:"300px"}},{default:i(()=>[a(N,{class:"text-bold text-center text-h5"}),a(N,null,{default:i(()=>[a(A,{modelValue:n.value.DESTER,"onUpdate:modelValue":e[14]||(e[14]=l=>n.value.DESTER=l),options:v.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{modelValue:n.value.CLIENTE,"onUpdate:modelValue":e[15]||(e[15]=l=>n.value.CLIENTE=l),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:w,dense:""},null,8,["modelValue","options"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:n.value.OBSANT,"onUpdate:modelValue":e[16]||(e[16]=l=>n.value.OBSANT=l),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:n.value.IMPANT,"onUpdate:modelValue":e[17]||(e[17]=l=>n.value.IMPANT=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(r,{spaced:"",inset:"",vertical:"",dark:""}),a(A,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[18]||(e[18]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(r,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(L,{align:"center"},{default:i(()=>[a(T,{flat:"",color:"negative",icon:"close",onClick:F}),a(T,{flat:"",color:"positive",icon:"send",disable:M.value||!s.value.val,onClick:q},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ze as default};
