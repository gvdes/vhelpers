import{Q as R}from"./QSeparator.077bcec3.js";import{r as h,c as E,o as L,a as U,w as i,e as t,i as x,a3 as c,Y as T,Q as k,f as Q,h as Y,a4 as b,a$ as G,a2 as D}from"./index.d99a3dba.js";import{Q as Z}from"./QToolbar.b2f509cd.js";import{Q as ee}from"./QHeader.46507f70.js";import{u as oe,Q as F,a as $}from"./use-quasar.347b3d73.js";import{Q as z}from"./QSelect.1878f564.js";import{Q as ae}from"./QForm.16101cd6.js";import{Q as I}from"./QDialog.3249734c.js";import{Q as M}from"./QInput.b88bb562.js";import{Q as te,a as m}from"./QTr.a10261fb.js";import{Q as le}from"./QTable.da8f5ca5.js";import{Q as se}from"./QCardActions.26610376.js";import{Q as ie}from"./QPage.3853e168.js";import{Q as re,a as ne}from"./QLayout.7239318b.js";import{C as j}from"./ClosePopup.5e0a748b.js";import{u as ue}from"./VDB.4fecc783.js";import{_ as ce}from"./UserToolbar.43ac0c3b.js";import{v as V,a as de}from"./axios.ae0a941c.js";import"./jspdf.plugin.autotable.61655885.js";import{E as me}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import"./QResizeObserver.7570a623.js";import"./use-key-composition.02e38e6e.js";import"./uid.42677368.js";import"./position-engine.c71db0a5.js";import"./rtl.b51694b1.js";import"./QList.7b3ee2fa.js";import"./QLinearProgress.4ac7f413.js";import"./QCheckbox.c11a3e8f.js";import"./axios.f1f32898.js";import"./_commonjsHelpers.88e99c8f.js";var B={getSeccion(p){return V.get(`/resources/getSeccion/${p}`).then(s=>s.data).catch(s=>({fail:s}))},getProductsCompare(p,s){return V.post(`/resources/getProductReport/${p}`,s).then(u=>u.data).catch(u=>({fail:u}))},getProductsCompareLocation(p,s){return V.post(`/resources/getProductReportLocations/${p}`,s).then(u=>u.data).catch(u=>({fail:u}))},create(p){return V.post("/resources/create",p).then(s=>s.data).catch(s=>({fail:s}))},preview(p){return V.post("/resources/preview",p).then(s=>s.data).catch(s=>({fail:s}))}};const pe=x("span",{class:"text-h6"},"Resurtido",-1),fe=x("div",{class:"text-h6 text-center"},"Impresora",-1),ve={class:"row"},ge=x("div",{class:"text-h6"},"Agrega una nota",-1),Xe={__name:"RequisitionLYT",setup(p){const s=ue(),u=oe(),S=h({status:!1}),f=h({val:null,opts:[]}),v=h({val:[],opts:[]}),w=h([]),C=h(null),d=h({state:!1,val:null,body:[]}),g=h({val:null,opts:[]}),P=h({columns:[{name:"codigo",label:"Codigo",align:"left",sortable:!0,field:e=>e.code},{name:"description",label:"Descripcion",align:"left",sortable:!0,field:e=>e.description},{name:"Familia",label:"Familia",align:"left",sortable:!0,field:e=>e.categories.familia.name},{name:"Categoria",label:"Categoria",align:"left",sortable:!0,field:e=>e.categories.name},{name:"pieces",label:"PXC",align:"center",sortable:!0,field:e=>e.pieces},{name:"cedis",label:"Ced CJ",align:"center",sortable:!0,field:e=>e.cedis},{name:"texcoco",label:"Tex CJ",align:"center",sortable:!0,field:e=>e.texcoco},{name:"Sucursal",label:`${s.session.store.name}`,align:"center",sortable:!0,field:e=>e.sucursal},{name:"min",label:"Minimo",align:"center",sortable:!0,field:e=>e.min},{name:"max",label:"Maximo",align:"center",sortable:!0,field:e=>e.max},{name:"action",align:"center"}],filter:""}),_=E(()=>w.value.map(e=>{let o=Math.round(Number(e.stocks.filter(r=>r.id==1).map(r=>r.pivot.stock))/Number(e.pieces)),n=Math.round(Number(e.stocks.filter(r=>r.id==2).map(r=>r.pivot.stock))/Number(e.pieces)),l=Number(e.stocks.filter(r=>r.id==s.session.store.id_viz).map(r=>r.pivot.stock)),a=Math.round(Number(e.stocks.filter(r=>r.id==s.session.store.id_viz).map(r=>r.pivot.stock))*100/Number(e.pieces));return{id:e.id,name:e.name,code:e.code,cost:e.cost,description:e.description,categories:e.categories,pieces:e.pieces,min:Number(e.stocks.filter(r=>r.id==s.session.store.id_viz).map(r=>r.pivot.min)),max:Number(e.stocks.filter(r=>r.id==s.session.store.id_viz).map(r=>r.pivot.max)),cedis:o,texcoco:n,sucursal:l,percentage:a}}).filter(e=>s.session.store.id_viz==4?e.cedis+e.texcoco>0&&e.percentage<=20:e.cedis+e.texcoco>0&&e.sucursal<=e.min&&e.min>0)),N=E(()=>v.value.val.length>0?_.value.filter(e=>v.value.val.includes(e.categories.name)):_.value),q=async()=>{let e=s.session.store.id_viz;u.loading.show({message:"Obteniendo secciones"});const o=await B.getSeccion(e);o.fail?console.log(o):(console.log(o),f.value.opts=o.families,g.value.opts=o.locations?o.locations[0].sections:null,u.loading.hide()),console.log(o)},A=async()=>{if(f.value.val){u.loading.show({message:"Obteniendo Reporte"}),console.log(f.value.val.map(l=>l.id));let e=s.session.store.id_viz,o=f.value.val.map(l=>l.id);const n=await B.getProductsCompare(e,{data:o});n.fail?console.log(n):(u.loading.hide(),console.log(n),w.value=n,w.value.forEach(l=>{const a=l.categories.name;a&&!v.value.opts.includes(a)&&v.value.opts.push(a)}))}},O=async()=>{if(g.value.val){console.log(g.value.val),u.loading.show({message:"Obteniendo Reporte"}),console.log(g.value.val.map(l=>l.id));let e=s.session.store.id_viz,o=g.value.val.map(l=>l.id);const n=await B.getProductsCompareLocation(e,{data:o});console.log(n),n.fail?console.log(n):(u.loading.hide(),console.log(n),w.value=n,w.value.forEach(l=>{const a=l.categories.name;a&&!v.value.opts.includes(a)&&v.value.opts.push(a)}))}},H=async()=>{u.loading.show({message:"Creando Pedido"});let e={workpoint_from:s.session.store.id_viz,workpoint_to:1,products:N.value,notes:C.value,id_userviz:s.session.id,type:2};console.log(e);const o=await B.create(e);o.fail?console.log(o):(console.log(o),u.notify({message:`Se creo el pedido ${o.order.id}`,type:"positive",position:"center"}),w.value=[],C.value=[],f.value.val=null,g.value.val=null,v.value.val=[],u.loading.hide())},J=e=>{console.log(e);let o=w.value.findIndex(n=>n.id===e.id);console.log(o),o>=0&&w.value.splice(o,1)},X=async()=>{console.log("aqui imprimo");let e={products:N.value,from:s.session.store,ip_address:d.value.val.ip_address};const o=await B.preview(e);o.fail?console.log(o):(console.log(o),u.notify({message:"Impresion Correcta",type:"positive",position:"center"}),d.value.val=null,d.value.state=!1)},K=async()=>{const e=new me.Workbook,o=e.addWorksheet("Resurtido");console.log(),o.addTable({name:"Resurtido",ref:"A1",headerRow:!0,totalsRow:!1,style:{showRowStripes:!0},columns:[{name:"Codigo",filterButton:!0},{name:"Descripcion",filterButton:!0},{name:"Seccion",filterButton:!0},{name:"Familia",filterButton:!0},{name:"Categoria",filterButton:!0},{name:"PXC",filterButton:!0},{name:"Cedis",filterButton:!0},{name:"Texcoco",filterButton:!0},{name:"Sucursal",filterButton:!0},{name:"MIN",filterButton:!0},{name:"MAX",filterButton:!0},{name:"Porcentaje",filterButton:!0}],rows:N.value.map(l=>[l.code,l.description,l.categories.familia.seccion.name,l.categories.familia.name,l.categories.name,l.pieces,l.cedis,l.texcoco,l.sucursal,l.min,l.max,l.percentage])}),o.columns.forEach(l=>{let a=0;l.eachCell({includeEmpty:!0},r=>{const y=r.value?r.value.toString().length:10;y>a&&(a=y)}),l.width=a<10?10:a}),(async()=>{const l=await e.xlsx.writeBuffer(),a=new Blob([l],{type:"application/octet-stream"}),r=URL.createObjectURL(a),y=document.createElement("a");y.href=r,y.download="Resurtido.xlsx",document.body.appendChild(y),y.click(),document.body.removeChild(y)})()},W=async()=>{let e=s.session.store.id;console.log(e);try{let o=await de.get(`/cashier/getPrinters/${e}`);o.status==200&&(d.value.body=o.data,console.log(o),d.value.state=!0)}catch(o){console.log(o),u.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}};return q(),(e,o)=>(L(),U(re,{view:"hHh Lpr fFf"},{default:i(()=>[t(ee,{class:"transparent text-dark",bordered:""},{default:i(()=>[t(ce),t(R),t(Z,{class:"justify-between"},{default:i(()=>[x("div",null,[c("Helpers "),t(T,{name:"navigate_next",color:"primary"}),c(),pe])]),_:1})]),_:1}),t(I,{modelValue:d.value.state,"onUpdate:modelValue":o[1]||(o[1]=n=>d.value.state=n)},{default:i(()=>[t(F,{class:"my-card"},{default:i(()=>[t($,null,{default:i(()=>[fe]),_:1}),t($,null,{default:i(()=>[t(ae,{onSubmit:X,class:"q-gutter-md"},{default:i(()=>[t(z,{dense:"","option-label":"name",modelValue:d.value.val,"onUpdate:modelValue":o[0]||(o[0]=n=>d.value.val=n),options:d.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),x("div",null,[t(k,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:d.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ne,null,{default:i(()=>[t(ie,{padding:""},{default:i(()=>{var n,l;return[x("div",ve,[Q(s).session.store.id_viz==4?(L(),U(z,{key:0,class:"col",modelValue:g.value.val,"onUpdate:modelValue":o[2]||(o[2]=a=>g.value.val=a),options:g.value.opts,label:"Ubicacion","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:O,disable:((n=f.value.val)==null?void 0:n.length)>0},null,8,["modelValue","options","disable"])):Y("",!0),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(z,{class:"col",modelValue:f.value.val,"onUpdate:modelValue":o[3]||(o[3]=a=>f.value.val=a),options:f.value.opts,label:"Familia","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:A,disable:((l=g.value.val)==null?void 0:l.length)>0},null,8,["modelValue","options","disable"]),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(z,{class:"col",modelValue:v.value.val,"onUpdate:modelValue":o[4]||(o[4]=a=>v.value.val=a),options:v.value.opts,label:"Categoria",filled:"",disable:!f.value.val,multiple:"","use-chips":""},null,8,["modelValue","options","disable"])]),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(le,{rows:Q(N),columns:P.value.columns,separator:"cell",filter:P.value.filter},{"top-right":i(()=>[t(M,{borderless:"",dense:"",debounce:"300",modelValue:P.value.filter,"onUpdate:modelValue":o[5]||(o[5]=a=>P.value.filter=a),placeholder:"Buscar"},{append:i(()=>[t(T,{name:"search"})]),_:1},8,["modelValue"]),t(k,{color:"primary","icon-right":"send",flat:"",onClick:o[6]||(o[6]=a=>S.value.state=!S.value.state),disable:Q(_).length==0},null,8,["disable"]),t(k,{color:"primary",icon:"print",flat:"",onClick:W,disable:Q(_).length==0},null,8,["disable"]),t(k,{color:"primary",icon:"download",flat:"",onClick:K,disable:Q(_).length==0},null,8,["disable"])]),body:i(a=>[t(te,{props:a},{default:i(()=>[t(m,{key:"codigo",props:a},{default:i(()=>[c(b(a.row.code),1)]),_:2},1032,["props"]),t(m,{key:"description",props:a},{default:i(()=>[c(b(a.row.description),1)]),_:2},1032,["props"]),t(m,{key:"Familia",props:a},{default:i(()=>[c(b(a.row.categories.familia.name),1)]),_:2},1032,["props"]),t(m,{key:"Categoria",props:a},{default:i(()=>[c(b(a.row.categories.name),1)]),_:2},1032,["props"]),t(m,{key:"pieces",props:a},{default:i(()=>[c(b(a.row.pieces),1)]),_:2},1032,["props"]),t(m,{key:"cedis",props:a},{default:i(()=>[c(b(a.row.cedis),1)]),_:2},1032,["props"]),t(m,{key:"texcoco",props:a},{default:i(()=>[c(b(a.row.texcoco),1)]),_:2},1032,["props"]),t(m,{key:"Sucursal",props:a},{default:i(()=>[c(b(a.row.sucursal),1)]),_:2},1032,["props"]),t(m,{key:"min",props:a},{default:i(()=>[c(b(a.row.min),1)]),_:2},1032,["props"]),t(m,{key:"max",props:a},{default:i(()=>[c(b(a.row.max),1)]),_:2},1032,["props"]),t(m,{key:"action",props:a},{default:i(()=>[t(k,{color:"negative",icon:"delete",onClick:r=>J(a.row),flat:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),t(I,{modelValue:S.value.state,"onUpdate:modelValue":o[10]||(o[10]=a=>S.value.state=a),persistent:""},{default:i(()=>[t(F,{style:{"min-width":"350px"}},{default:i(()=>[t($,null,{default:i(()=>[ge]),_:1}),t($,{class:"q-pt-none"},{default:i(()=>[t(M,{dense:"",modelValue:C.value,"onUpdate:modelValue":o[7]||(o[7]=a=>C.value=a),autofocus:"",onKeyup:o[8]||(o[8]=G(a=>e.prompt=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(se,{align:"right",class:"text-primary"},{default:i(()=>[D(t(k,{flat:"",label:"Cancelar",onClick:o[9]||(o[9]=a=>C.value=null)},null,512),[[j]]),D(t(k,{flat:"",label:"Enviar Pedido",onClick:H},null,512),[[j]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1})]),_:1})]),_:1}))}};export{Xe as default};
