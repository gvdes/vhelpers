import{Q as q}from"./QInput.becc7b73.js";import{c as H,Q as I,a as w,b as n}from"./QSeparator.71b2bdf4.js";import{u as M,aH as j,r as C,c as b,m as z,t as G,o as r,g as V,e,w as a,a3 as k,f as J,a as Q,h as L,Q as x,a6 as u,a4 as N,a5 as K,a0 as c}from"./index.2755a6d2.js";import{Q as B}from"./QList.dc07f2ef.js";import{Q as W}from"./QPage.823ea121.js";import{u as X,Q as Y,a as R}from"./use-quasar.f671fe44.js";import{Q as Z}from"./QCardActions.d47f4c8c.js";import{C as ee}from"./ClosePopup.5ffcc6e3.js";import{u as te}from"./VDB.a2fb4ba7.js";import{u as ae,r as U}from"./requisitionApi.f165d649.js";import{i as oe}from"./resoursesApi.de75c02f.js";import"./axios.0d2bd0f9.js";const le={class:"row"},Qe={__name:"viewRequisition",setup(se){const d=te(),m=X(),S=M(),$=j(),p=C(!1),i=ae(),_=$.params.oid,f=C(null),v=C([]),g=C(""),y=b(()=>g.value.length<=0?v.value:v.value.filter(o=>o.description.toLowerCase().includes(g.value.toLowerCase()))),P=b(()=>y.value.some(o=>o.amount>0)),h=b(()=>y.value.filter(o=>o.amount>0)),O=async()=>{m.loading.show({message:"Obteniendo Datos"});const o=await U.getRequisition(d.session.store.id,_);o.status!==200?console.log(o):(m.loading.hide(),console.log(o),f.value=o.data,T(),i.setTitle(`${o.data.notes||_}`),i.setShowCreateButton(!1),i.setShowOrders(!1))},T=async()=>{const o=await oe.getAssortmentInsumos();o.error?console.log(o):(console.log(o),v.value=o,f.value.bodie.length>0&&v.value.forEach(t=>{const l=f.value.bodie.find(s=>s.code===t.code);console.log(l),l?t.amount=l.amount:t.amount=0}))},A=async()=>{m.loading.show({message:"Cerrando Pedido"});let o={id:_,products:h.value};const t=await U.finishRequisition(o);t.status!=200?console.log(t):(S.push("/assortment"),m.loading.hide())};return z(()=>{d.session.rol=="aux"||d.session.rol=="gen"||d.session.rol=="aud"||d.session.rol=="root"?O():(m.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),S.replace("/"))}),G(()=>{i.setTitle("Pedidos Insumos"),i.setShowCreateButton(!0),i.setShowOrders(!0)}),(o,t)=>(r(),V(k,null,[e(W,{padding:""},{default:a(()=>{var l;return[J("div",le,[e(q,{class:"col",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),P.value?(r(),Q(I,{key:0,spaced:"",inset:"",vertical:"",dark:""})):L("",!0),P.value?(r(),Q(x,{key:1,color:"primary",flat:"",dense:"",icon:"send",onClick:t[1]||(t[1]=s=>p.value=!p.value),disable:((l=f.value)==null?void 0:l._status)>1},null,8,["disable"])):L("",!0)]),e(I,{spaced:"",inset:"",vertical:"",dark:""}),e(B,null,{default:a(()=>[e(w,null,{default:a(()=>[e(n,null,{default:a(()=>t[3]||(t[3]=[u("Codigo")])),_:1}),e(n,null,{default:a(()=>t[4]||(t[4]=[u("Descripcion")])),_:1}),e(n,null,{default:a(()=>t[5]||(t[5]=[u("Cantidad")])),_:1})]),_:1})]),_:1}),(r(!0),V(k,null,N(y.value,(s,E)=>(r(),Q(B,{bordered:"",key:E},{default:a(()=>[e(w,null,{default:a(()=>[e(n,null,{default:a(()=>[u(c(s.code),1)]),_:2},1024),e(n,null,{default:a(()=>[u(c(s.description),1)]),_:2},1024),e(n,null,{default:a(()=>{var D;return[e(q,{modelValue:s.amount,"onUpdate:modelValue":F=>s.amount=F,type:"number",filled:"",disable:((D=f.value)==null?void 0:D._status)>1},null,8,["modelValue","onUpdate:modelValue","disable"])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1}),e(H,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=l=>p.value=l),persistent:""},{default:a(()=>[e(Y,{style:{width:"500px"}},{default:a(()=>[e(R,{class:"text-bold text-h6 text-center"},{default:a(()=>t[6]||(t[6]=[u(" Se Creara Pedido ")])),_:1}),e(R,null,{default:a(()=>[(r(!0),V(k,null,N(h.value,(l,s)=>(r(),Q(B,{key:s,bordered:""},{default:a(()=>[e(w,null,{default:a(()=>[e(n,null,{default:a(()=>[u(c(l.code),1)]),_:2},1024),e(n,null,{default:a(()=>[u(c(l.description),1)]),_:2},1024),e(n,null,{default:a(()=>[u(c(l.amount),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(Z,{align:"right"},{default:a(()=>[K(e(x,{flat:"",label:"Cancel",color:"primary"},null,512),[[ee]]),e(x,{flat:"",label:"Crear",color:"primary",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Qe as default};
