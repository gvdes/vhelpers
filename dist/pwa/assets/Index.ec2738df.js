import{bx as j,W as F,a as z,u as J,r,c as w,J as W,o as f,d as b,w as m,g as Z,e as n,j as k,k as y,a4 as G,Z as K,ae as C,bD as I,a1 as $,h as O,b5 as h}from"./index.504c35c2.js";import{Q as X}from"./QSelect.4aa8ea70.js";import{Q}from"./QTable.1aa507cd.js";import{Q as Y}from"./QPage.7e16f176.js";import{d as ee}from"./dayjs.min.cbcf888d.js";import"./axios.4a57e5be.js";import{o as le}from"./orderApi.83dc627f.js";import{u as ae}from"./OrderStore.fb778186.js";import{u as te}from"./use-quasar.67494b23.js";import{r as oe}from"./reports.7583f9c5.js";import"./QList.0ff006d5.js";import"./QExpansionItem.500c9e37.js";import"./QDrawer.c15a4823.js";import"./ClosePopup.677ccf58.js";/* empty css                                                                         */import"./socket.168d2ba4.js";import"./QLinearProgress.81f26e11.js";import"./_commonjsHelpers.88e99c8f.js";import"./exceljs.min.9e24d01d.js";import"./QResizeObserver.9bc3b086.js";import"./QScrollObserver.e07350e2.js";const se={__name:"Index",setup(re){F();const S=z(),d=ae();d.setTitle("INICIO"),d.setshowLyt(!0),d.setShowEvent(!0);const g=te(),T=J(),o=r(null),s=r(null),i=r(!1);r(null);let V=null;const x=r({rowsPerPage:10}),c=r([]),t=r(null),p=r({columns:[{name:"id",label:"FOLIO",field:e=>e.id,align:"left",sortable:!0},{name:"created",label:"Creado Por",field:e=>{var l,a,u;return`${(l=e.created_by)==null?void 0:l.names} ${(a=e.created_by)==null?void 0:a.surname_pat} ${(u=e.created_by)==null?void 0:u.surname_mat}`},align:"left",sortable:!0},{name:"client",label:"CLIENTE",field:e=>e.name,align:"left",sortable:!0},{name:"status",label:"ESTADO",field:e=>{var l;return(l=e.status)==null?void 0:l.name},align:"center",classes:e=>`text-${D.value[e.status.id-1]}`,sortable:!0},{name:"created_time",label:"HORA",field:e=>ee(e.created_at).format("HH:mm:ss"),align:"center",sortable:!0}],filter:null}),v=r({columns:[{name:"id",label:"ID",field:e=>e.id,sortable:!0,align:"left"},{name:"name",label:"Nombre",field:e=>`${e.names} ${e.surname_pat} ${e.surname_mat}`,sortable:!0,align:"left"},{name:"pedidos",label:"Pedidos",field:e=>e.filteredCount,sortable:!0,align:"center"}],filter:null}),D=r(["grey-6","red-5","deep-orange-10","blue-4","blue-10","teal-4","teal-10","green-5","green-10","light-green-10"]),_=w(()=>g.platform.is.mobile),B=w(()=>{let e=d.orders;return o.value&&(e=e.filter(l=>l._created_by===o.value.id)),t.value&&(e=e.filter(l=>l._status===t.value.id)),s.value&&(e=e.filter(l=>l.id===s.value.id)),e}),U=()=>{i.value=!0},E=()=>{V=setTimeout(()=>{i.value=!0},600)},P=()=>{clearTimeout(V)},R=w(()=>d.users.map(e=>{let l=e.orders;return s.value&&(l=l.filter(a=>a.id===s.value.id)),t.value&&(l=l.filter(a=>a._status===t.value.id)),o.value&&o.value.id!==e.id&&(l=[]),{...e,filteredOrders:l,filteredCount:l.length}}).filter(e=>e.filteredCount>0||!t.value&&!s.value&&!o.value)),N=(e,l)=>{o.value=l,s.value=null},A=(e,l)=>{s.value=l,o.value=null},q=()=>{o.value=null,s.value=null,t.value=null},H=(e,l)=>{S.push(`/preorders/pedidos/${l.id}`)},L=()=>{i.value=!1,c.value=[]},M=async()=>{console.log("Descargar:",c.value),g.loading.show({message:"Descargando Datos"});let e=c.value.map(a=>a.id);console.log(e);const l=await le.getOrdersDownload({prvs:e,store:T.session.store.id_va});if(l.fail)console.log(l);else{console.log(l);let a={key:"Preventas",value:l};await oe.preorders(a),i.value=!1,c.value=[],g.loading.hide()}};return W(t,()=>{s.value=null,o.value=null}),(e,l)=>(f(),b(Y,{padding:""},{default:m(()=>[Z("div",{class:h(_.value?"":"row")},[n(Q,{class:h(_.value?"":"col"),rows:B.value,columns:p.value.columns,filter:p.value.filter,pagination:x.value,"row-key":"id","row-class":a=>{var u;return((u=s.value)==null?void 0:u.id)===a.id?"bg-blue-1":""},onRowClick:A,onRowDblclick:H,onTouchstart:E,onContextmenu:I(U,["prevent"]),onTouchend:P,selection:i.value?"multiple":"none",selected:c.value,"onUpdate:selected":l[3]||(l[3]=a=>c.value=a)},{"top-right":m(()=>[i.value?(f(),b(k,{key:0,icon:"download",color:"primary",flat:"",onClick:M})):y("",!0),i.value?(f(),b(k,{key:1,flat:"",dense:"",icon:"close",class:"q-ml-sm",onClick:L})):y("",!0),n(X,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value=a),options:G(d).process,label:"Estado",filled:"",style:{width:"130px"},dense:"","option-label":"name"},K({_:2},[t.value?{name:"append",fn:m(()=>[n(C,{name:"cancel",onClick:l[0]||(l[0]=I(a=>t.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),o.value||s.value||t.value?(f(),b(k,{key:2,class:"q-ml-md",icon:"filter_alt_off",flat:"",dense:"",onClick:q})):y("",!0),n($,{spaced:"",inset:"",vertical:"",dark:""}),n(O,{borderless:"",dense:"",debounce:"300",modelValue:p.value.filter,"onUpdate:modelValue":l[2]||(l[2]=a=>p.value.filter=a),placeholder:"Buscar"},{append:m(()=>[n(C,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["class","rows","columns","filter","pagination","row-class","selection","selected"]),n($,{spaced:"",inset:"",vertical:"",dark:""}),n(Q,{class:h(_.value?"":"col"),rows:R.value,columns:v.value.columns,filter:v.value.filter,pagination:x.value,"row-key":"id","row-class":a=>{var u;return((u=o.value)==null?void 0:u.id)===a.id?"bg-blue-1":""},onRowClick:N},{"top-right":m(()=>[n(O,{borderless:"",dense:"",debounce:"300",modelValue:v.value.filter,"onUpdate:modelValue":l[4]||(l[4]=a=>v.value.filter=a),placeholder:"Buscar"},{append:m(()=>[n(C,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["class","rows","columns","filter","pagination","row-class"])],2)]),_:1}))}};var Oe=j(se,[["__scopeId","data-v-741e4a18"]]);export{Oe as default};
