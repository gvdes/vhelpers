import{Q as u}from"./QSeparator.d085a7d5.js";import{r as p,c as w,o as q,a as j,w as n,aD as G,u as z,e as a,i as c,Y as K,f as C,Q as R,a4 as X,a2 as Z}from"./index.6b919260.js";import{Q as b,b as ee}from"./QSelect.8ec1d6fa.js";import{Q as le}from"./QToolbar.0c7c1e85.js";import{Q as ae}from"./QHeader.6bf7bcde.js";import{Q as f}from"./QInput.915469e0.js";import{Q as te}from"./QDate.e368d8f9.js";import{Q as oe}from"./QTable.afd27c73.js";import{Q as se,a as ie}from"./QLayout.c65325c1.js";import{Q as A,a as V}from"./QCard.8fb4f9b5.js";import{Q as ne}from"./QForm.1e47dfdd.js";import{Q as k}from"./QDialog.426be046.js";import{Q}from"./QCardActions.657489ad.js";import{C as ue}from"./ClosePopup.b39444cf.js";import"./AppFullscreen.ffd55fc5.js";import{u as de}from"./use-quasar.cf091104.js";import"./auto.c5e70433.js";import"./dayjs.min.25545ff6.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.e02077b2.js";import{_ as re}from"./UserToolbar.576da930.js";import{A as ve}from"./assistApi.38e3af0e.js";import{u as H}from"./VDB.67686440.js";import{a as y}from"./axios.f1f32898.js";import{a as pe}from"./axios.76bdd693.js";import"./use-key-composition.abdd2bcc.js";import"./uid.42677368.js";import"./QItemSection.b320ee72.js";import"./position-engine.a0970efb.js";import"./rtl.b51694b1.js";import"./QResizeObserver.dbdd5c11.js";import"./use-cache.b0833c75.js";import"./date.b1069da3.js";import"./QList.c1754208.js";import"./QLinearProgress.bdaaec4d.js";import"./QCheckbox.b0154d03.js";import"./_commonjsHelpers.88e99c8f.js";const me={class:"col"},fe=c("span",{class:"text-grey"},"Helpers",-1),ce=c("span",{class:"text-h6"},"Retiradas de Cajas",-1),Ee={class:"col"},Re={class:"row"},be=c("div",{class:"col"},null,-1),Oe=c("div",{class:"text-h6 text-center"},"Impresora",-1),Ve={class:"q-ml-sm"},sl={__name:"withdrawals",setup(Te){const r=de();G();const S=z(),F=H(),U=H(),d=p([]),O=p(null),m=p([]),o=p({val:null,state:!1}),v=p({val:null,opts:[]}),s=p({state:!1,val:null,body:null}),T=p([]),D=p(T.value),i=p({state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}),g=p({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:t=>t.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:t=>t.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:t=>t.NOFPRO,align:"left",sortable:!0}]}),M=w(()=>O.value&&!v.value.val?m.value.filter(t=>t.FECHA==O.value):!O.value&&v.value.val?m.value.filter(t=>t.CAJRET==v.value.val.CODTER):O.value&&v.value.val?m.value.filter(t=>t.FECHA==O.value&&t.CAJRET==v.value.val.CODTER):m.value),N=w(()=>{if(o.value){const t=m.value.find(l=>l.CODRET===o.value.val.CODRET);if(!t)return!1;let e={CAJRET:t.CAJRET,CODRET:t.CODRET,CONRET:t.CONRET,DESTER:t.DESTER,FECHA:t.FECHA,HORA:t.HORA,IMPRET:Number(t.IMPRET).toFixed(2),PROVEEDOR:{PRORET:t.PRORET,NOFPRO:t.NOFPRO}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),_=w(()=>!i.value.CONRET||!i.value.DESTER||!i.value.IMPRET||!i.value.PROVEEDOR),h=async()=>{r.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const t=await ve.index();t.error||(console.log(t),d.value.opts=t,r.loading.hide(),J())},$=(t,e)=>{o.value.state=!o.value.state,console.log(e);let l={CAJRET:e.CAJRET,CODRET:e.CODRET,CONRET:e.CONRET,DESTER:e.DESTER,FECHA:e.FECHA,HORA:e.HORA,IMPRET:Number(e.IMPRET).toFixed(2),PROVEEDOR:{PRORET:e.PRORET,NOFPRO:e.NOFPRO}};o.value.val={...l}},J=async()=>{let t=U.session.store.id;console.log(t);try{let e=await pe.get(`/cashier/getPrinters/${t}`);e.status==200&&(s.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),r.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},L=async()=>{console.log(d.value.val.ip_address),r.loading.show({message:"Obteniendo Registros"});let e=`http://${d.value.val.ip_address}/storetools/public/api/reports/getWithdrawals`;const l=await y.get(e);l.status!=200?console.log(l):(console.log(l.data),m.value=l.data.cuts,v.value.opts=l.data.terminal,T.value=l.data.proveedores,r.loading.hide())},I=async()=>{console.log(d.value.val.ip_address);let t={print:s.value.val.ip_address,codret:o.value.val.CODRET};console.log(t),r.loading.show({message:"Imprimiendo Retirada"});let l=`http://${d.value.val.ip_address}/storetools/public/api/reports/printWitrawal`;const E=await y.post(l,t);E.status!=200?console.log(E):(console.log(E.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide())},B=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),r.loading.show({message:"Modificando Retirada"});let e=`http://${d.value.val.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const l=await y.post(e,o.value.val);if(l.status!=200)console.log(l);else{console.log(l.data);let E=m.value.findIndex(P=>P.CODRET==l.data.CODRET);E>=0&&(m.value[E]=l.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide()}},W=async()=>{i.value.Print=s.value.val.ip_address,console.log(i.value),r.loading.show({message:"Agregando Anticipo"});let e=`http://${d.value.val.ip_address}/storetools/public/api/reports/addWithdrawal`;const l=await y.post(e,i.value);l.status!=200?console.log(l):(console.log(l.data),m.value.push(l.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide(),x())},x=()=>{i.value={state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}},Y=(t,e,l)=>{if(t===""){e(()=>{D.value=T.value});return}e(()=>{const E=t.toLowerCase();D.value=T.value.filter(P=>P.NOFCLI.toLowerCase().includes(E))})};return F.session.rol==="adm"||F.session.rol==="root"?h():(r.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),S.replace("/")),(t,e)=>(q(),j(se,{view:"hHh Lpr fFf"},{default:n(()=>[a(ae,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[a(re),a(u),a(le,{class:"justify-between row"},{default:n(()=>[c("div",me,[fe,a(K,{name:"navigate_next",color:"primary"}),ce]),c("div",Ee,[c("div",Re,[be,a(b,{class:"col",modelValue:d.value.val,"onUpdate:modelValue":[e[0]||(e[0]=l=>d.value.val=l),L],options:d.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(ie,null,{default:n(()=>[a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(oe,{rows:C(M),filter:g.value.filter,columns:g.value.columns,onRowClick:$},{"top-right":n(()=>[a(f,{modelValue:g.value.filter,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value.filter=l),type:"text",label:"Buscar",filled:"",dense:"",disable:!d.value.val},null,8,["modelValue","disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:v.value.val,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.val=l),options:v.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!d.value.val},null,8,["modelValue","options","disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(R,{color:"primary",icon:"event",flat:"",round:"",disable:!d.value.val},{default:n(()=>[a(ee,null,{default:n(()=>[a(te,{modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=l=>O.value=l),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(R,{color:"primary",icon:"add",flat:"",onClick:e[4]||(e[4]=l=>i.value.state=!i.value.state),disable:!d.value.val},null,8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),a(k,{modelValue:s.value.state,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.state=l)},{default:n(()=>[a(A,{class:"my-card"},{default:n(()=>[a(V,null,{default:n(()=>[Oe]),_:1}),a(V,null,{default:n(()=>[a(ne,{onSubmit:I,class:"q-gutter-md"},{default:n(()=>[a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),c("div",null,[a(R,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(k,{modelValue:o.value.state,"onUpdate:modelValue":e[14]||(e[14]=l=>o.value.state=l),persistent:""},{default:n(()=>[a(A,{style:{width:"300px"}},{default:n(()=>[a(V,{class:"text-bold text-center text-h5"},{default:n(()=>[c("span",Ve,"Retirada "+X(o.value.val.CODRET),1)]),_:1}),a(V,null,{default:n(()=>[a(f,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.val.FECHA=l),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(f,{modelValue:o.value.val.HORA,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.val.HORA=l),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(f,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.val.DESTER=l),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.val.PROVEEDOR=l),options:T.value,label:"Proveedor",filled:"","option-label":"NOFPRO"},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(f,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.val.CONRET=l),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(f,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.val.IMPRET=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(Q,{align:"center"},{default:n(()=>[Z(a(R,{flat:"",color:"negative",icon:"close"},null,512),[[ue]]),a(R,{flat:"",color:"primary",icon:"print",onClick:I,disable:!C(N)||!s.value.val},null,8,["disable"]),a(R,{flat:"",color:"yellow",icon:"edit",disable:C(N)||!s.value.val,onClick:B},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(k,{modelValue:i.value.state,"onUpdate:modelValue":e[21]||(e[21]=l=>i.value.state=l),persistent:""},{default:n(()=>[a(A,{style:{width:"300px"}},{default:n(()=>[a(V,{class:"text-bold text-center text-h5"}),a(V,null,{default:n(()=>[a(f,{modelValue:i.value.FECHA,"onUpdate:modelValue":e[15]||(e[15]=l=>i.value.FECHA=l),type:"date",label:"Fecha",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:i.value.DESTER,"onUpdate:modelValue":e[16]||(e[16]=l=>i.value.DESTER=l),options:v.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:i.value.PROVEEDOR,"onUpdate:modelValue":e[17]||(e[17]=l=>i.value.PROVEEDOR=l),options:D.value,label:"Proveedor",filled:"","option-label":"NOFPRO","use-input":"","input-debounce":"0",onFilter:Y,dense:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(f,{modelValue:i.value.CONRET,"onUpdate:modelValue":e[18]||(e[18]=l=>i.value.CONRET=l),type:"text",label:"Observacion",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(f,{modelValue:i.value.IMPRET,"onUpdate:modelValue":e[19]||(e[19]=l=>i.value.IMPRET=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[20]||(e[20]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(Q,{align:"center"},{default:n(()=>[a(R,{flat:"",color:"negative",icon:"close",onClick:x}),a(R,{flat:"",color:"positive",icon:"send",disable:C(_)||!s.value.val,onClick:W},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{sl as default};
