import{u as ue,aE as ce,r as h,c as pe,o as P,a as I,w as o,h as j,e as t,Q as m,ak as ve,f as d,a4 as u,a3 as i,Y as H,g as fe,a0 as me,a1 as ge,a2 as L,b3 as we,a6 as xe}from"./index.5fd56673.js";import{Q as ye}from"./QToolbar.de55ab19.js";import{Q as D}from"./QSeparator.0a621bed.js";import{Q as _e}from"./QHeader.09cc9bf6.js";import{Q as C,a as r}from"./QItemSection.d2690b27.js";import{Q as R}from"./QList.befb6864.js";import{Q as T,a as Q}from"./QCard.596e448f.js";import{Q as W}from"./QCardActions.bb2bd605.js";import{Q as $}from"./QDialog.59a4ddef.js";import{Q as be}from"./QFooter.5b83b4b2.js";import{Q as ke}from"./QPage.4b5156cc.js";import{u as he}from"./VDB.f0615c4a.js";import{u as Pe}from"./use-quasar.6f063f50.js";import"./jspdf.plugin.autotable.8d2d370c.js";import{o as E}from"./outputsApi.83ef178b.js";import{E as J}from"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{P as Ce,d as Qe}from"./ProductsAutocomplete.275e8bfa.js";import"./QResizeObserver.934530db.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.2f5f6197.js";import"./axios.9ab26c22.js";import"./QInput.ab508c72.js";import"./use-key-composition.977fa0e4.js";import"./uid.937d8ee7.js";import"./QSelect.844c57c0.js";import"./position-engine.99a3d7e6.js";import"./rtl.276c3f1b.js";/* empty css                                                                         */const Ee={class:"row items-center"},Fe={class:"col"},Ve={class:"text-h6"},Ie={class:"text-center text-bold"},Se={class:"text-center text-bold row"},Be={class:"col"},Ne={class:"col"},Ae={class:"text-center text-h4"},De={class:"text-center text-h6 text-grey-14"},Re={class:"text-center"},Te={class:"q-pa-xs"},$e={class:"row"},Oe={class:"col column q-py-md"},gt={__name:"viewOutputs",setup(qe){const N=ue(),F=ce(),w=he(),n=Pe(),p=h(null),c=h([]),s=h({val:null,state:!1}),x=h({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),g=h({state:!1,encontrados:[],faltantes:[],products:null}),O=h(null),q=h(null),Y=pe(()=>{var l;return((l=c.value)==null?void 0:l.filter(e=>{var a;return e.product==((a=s.value.val)==null?void 0:a.product)}).length)>0}),K=async()=>{n.loading.show({message:"Obteniendo datos"});const l=F.params.oid,e=await E.getOutput(l);e.fail?console.log(e):(console.log(e),n.loading.hide(),w.session.rol=="aud"||(w.session.rol=="aux"||w.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||w.session.rol=="alm"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(p.value=e,c.value=e.bodie,console.log(p.value)):(N.push("/outputs"),n.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},X=l=>{console.log(l)},Z=l=>{let e=c.value.findIndex(a=>a.product==l.code);console.log(e),e>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(s.value.val={product:l.code,description:l.description,amount:1},s.value.state=!0,console.log(l))},ee=async()=>{n.loading.show({message:"Insertando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const l=await E.addProduct(s.value.val);l.fail?console.log(l):(console.log(l),c.value.push(s.value.val),s.value={val:null,state:!1},n.loading.hide())},te=async()=>{n.loading.show({message:"Editando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const l=await E.editProduct(s.value.val);if(l.fail)console.log(l);else{console.log(l);let e=c.value.findIndex(a=>a.product==s.value.val.product);e>=0&&(c.value[e].amount=s.value.val.amount,n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},oe=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const l=await E.removeProduct(s.value.val);if(l.fail)console.log(l);else{console.log(l);let e=c.value.findIndex(a=>a.product==s.value.val.product);e>=0&&(c.value.splice(e,1),n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},le=async()=>{n.loading.show({message:"Terminando Salida"});let l={user:w.session.name,output:p.value,products:c.value};console.log(l);const e=await E.endOutput(l);e.fail?console.log(e):(n.notify({message:e,position:"center",type:"positive"}),console.log(e),n.loading.hide(),N.push("/outputs"))},ae=l=>{s.value.state=!0,s.value.val=l},G=()=>{s.value={val:null,state:!1}},se=()=>{O.value.click()},ne=async()=>{let l=document.getElementById("inputFile").files[0],e=new J.Workbook,a=[],y={};e.xlsx.load(l).then(U=>{let S=e.worksheets[0],b=S.getColumn("A");S.getColumn("B"),b.eachCell({includeEmpty:!0},function(f,_){let V=f.value,B=S.getCell(`B${_}`),A=parseFloat(B.value);y[V]?y[V]+=A:y[V]=A});let v=Object.keys(y).map(f=>({codigo:f,cantidad:y[f]}));if(v.forEach(f=>a.push(f.codigo)),a.length){let f={codes:a,_workpoint:w.session.store.id_viz};n.loading.show({message:"Procesando archivo, espera.."}),Qe.getMassive(f).then(_=>{let V=_.data;V.fails.notFound.map(k=>x.value.wndNotExist.push(k)),V.fails.repeat.map(k=>x.value.repeat.push(k));let B=_.data.products;x.value.wndGetRows=B.length,x.value.state=!x.value.state,console.log(B);let A=B.map(k=>{let z=v.find(re=>re.codigo===k.code);return{product:k.code,description:k.description,amount:z?z.cantidad:0,_output:F.params.oid}});M(A),n.loading.hide()}).catch(_=>{console.log(_),n.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ie=()=>{q.value.click()},de=async()=>{let l=document.getElementById("inputFilePreventa").files[0],e=new J.Workbook,a=[];e.xlsx.load(l).then(async y=>{let S=e.worksheets[0].getColumn("A");if(n.loading.show({message:"Procesando archivo, espera.."}),S.eachCell({includeEmpty:!0},function(b,v){b.value&&a.push(b.value)}),a.length){let b={codes:a,_workpoint:w.session.store.id_viz};console.log(b);const v=await E.outputPreventa(b);if(v.fail)alert(v);else{g.value.encontrados=v.Encontrados,g.value.faltantes=v.Faltantes,g.value.products=v.products.length,g.value.state=!g.value.state,v.products.forEach(_=>_._output=F.params.oid);let f=v.products;console.log(f),M(f),n.loading.hide()}}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},M=async l=>{const e=await E.addProductMasive(l);e.fail?console.log(e):(console.log(e),l.map(a=>{c.value.push(a)}),n.loading.hide())};return w.session.rol=="root"||w.session.rol=="aud"?K():(n.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),N.replace("/")),(l,e)=>p.value?(P(),I(ke,{key:0,padding:""},{default:o(()=>[t(_e,{reveal:"",bordered:"",class:"bg-white text-black"},{default:o(()=>[t(ye,{class:"justify-between"},{default:o(()=>[t(m,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=a=>ve(N).push("/transfers")),round:""}),d("div",null,u(p.value.store.name),1),d("div",Ee,[d("div",Fe,u(p.value.warehouse.name),1),e[7]||(e[7]=i()),t(H,{name:"arrow_forward",class:"col"})]),d("div",null,u(p.value.created_by),1),d("div",null,[e[8]||(e[8]=i("salida ")),t(H,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=i()),d("span",Ve,u(p.value.code_fs),1)])]),_:1}),t(D),d("div",Ie,u(p.value.notes),1),t(D),d("div",Se,[d("div",Be,[t(m,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:se})]),d("div",Ne,[t(m,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:ie})]),d("input",{type:"file",ref_key:"inputFile",ref:O,id:"inputFile",onInput:ne,hidden:"",accept:".xlsx,.xls"},null,544),d("input",{type:"file",ref_key:"inputFilePreventa",ref:q,id:"inputFilePreventa",onInput:de,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1}),t(D,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{bordered:""},{default:o(()=>[t(C,null,{default:o(()=>[t(r,null,{default:o(()=>e[10]||(e[10]=[i(" Producto ")])),_:1}),t(r,null,{default:o(()=>e[11]||(e[11]=[i(" Descripcion ")])),_:1}),t(r,{class:"text-center"},{default:o(()=>e[12]||(e[12]=[i(" Cantidad ")])),_:1})]),_:1})]),_:1}),(P(!0),fe(ge,null,me(c.value,(a,y)=>(P(),I(R,{bordered:"",key:y},{default:o(()=>[L((P(),I(C,{clickable:"",onClick:U=>ae(a)},{default:o(()=>[t(r,null,{default:o(()=>[i(u(a.product),1)]),_:2},1024),t(r,null,{default:o(()=>[i(u(a.description),1)]),_:2},1024),t(r,{class:"text-center"},{default:o(()=>[i(u(a.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[xe]]),t(D)]),_:2},1024))),128)),t($,{modelValue:s.value.state,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.state=a),persistent:"",position:"bottom"},{default:o(()=>[t(T,{style:{width:"300","max-width":"40vw"}},{default:o(()=>[t(Q,null,{default:o(()=>[d("div",Ae,u(s.value.val.product),1),d("div",De,u(s.value.val.description),1)]),_:1}),t(Q,null,{default:o(()=>[d("div",Re,[d("div",Te,[e[13]||(e[13]=d("div",{class:"text-bold text-h6"},"Cantidad:",-1)),d("div",$e,[t(m,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=a=>s.value.val.amount--)}),d("div",Oe,[L(d("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.val.amount=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[we,s.value.val.amount]])]),t(m,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=a=>s.value.val.amount++)})])])])]),_:1}),Y.value?(P(),I(W,{key:1,align:"center"},{default:o(()=>[t(m,{flat:"",icon:"close",color:"red-10",onClick:G}),t(m,{flat:"",label:"Eliminar",color:"negative",onClick:oe}),t(m,{flat:"",label:"Editar",color:"blue-10",onClick:te})]),_:1})):(P(),I(W,{key:0,align:"center"},{default:o(()=>[t(m,{flat:"",label:"Cancelar",color:"negative",onClick:G}),t(m,{flat:"",label:"Agregar",color:"positive",onClick:ee})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:x.value.state,"onUpdate:modelValue":e[5]||(e[5]=a=>x.value.state=a)},{default:o(()=>[t(T,null,{default:o(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:o(()=>e[14]||(e[14]=[i(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:o(()=>[t(R,{bordered:""},{default:o(()=>[t(C,null,{default:o(()=>[t(r,null,{default:o(()=>e[15]||(e[15]=[i("Productos Encontrados")])),_:1}),t(r,null,{default:o(()=>[i(u(x.value.wndGetRows),1)]),_:1})]),_:1}),t(C,null,{default:o(()=>[t(r,null,{default:o(()=>e[16]||(e[16]=[i("Productos Sin Datos")])),_:1}),t(r,null,{default:o(()=>[i(u(x.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:g.value.state,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value.state=a)},{default:o(()=>[t(T,null,{default:o(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:o(()=>e[17]||(e[17]=[i(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:o(()=>[t(R,{bordered:""},{default:o(()=>[t(C,null,{default:o(()=>[t(r,null,{default:o(()=>e[18]||(e[18]=[i("Pedidos Encontrados")])),_:1}),t(r,null,{default:o(()=>[i(u(g.value.encontrados),1)]),_:1})]),_:1}),t(C,null,{default:o(()=>[t(r,null,{default:o(()=>e[19]||(e[19]=[i("Pedidos Sin Encontrar")])),_:1}),t(r,null,{default:o(()=>[i(u(g.value.faltantes),1)]),_:1})]),_:1}),t(C,null,{default:o(()=>[t(r,null,{default:o(()=>e[20]||(e[20]=[i("Productos Encontrados")])),_:1}),t(r,null,{default:o(()=>[i(u(g.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(be,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:o(()=>[t(T,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:o(()=>[t(Q,{class:"row"},{default:o(()=>[t(Ce,{class:"col",checkState:!1,onInput:X,onAgregar:Z}),c.value.length>0?(P(),I(m,{key:0,color:"primary",flat:"",icon:"east",onClick:le,round:""})):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)}};export{gt as default};
