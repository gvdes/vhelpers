import{a as D,Q as O}from"./QSelect.b5f1ae17.js";import{a as S,d as b,e as u,b as x}from"./QList.d68a349f.js";import{Q as q}from"./QCardSection.f4589af8.js";import{u as T,a as $,aI as F,c as P,l as G,p as H,o as m,d as y,w as l,e,f as d,a0 as a,g as _,a3 as A,a2 as N,ak as Q,a1 as I,al as r,Q as g,a4 as J,b9 as K,h as w}from"./index.ed94ea26.js";import{Q as W}from"./QInput.ee97feca.js";import{Q as X}from"./QSpace.71afb6a5.js";import{Q as Y}from"./QCardActions.6a2d084b.js";import{Q as Z}from"./QCard.22598671.js";import{u as tt}from"./use-quasar.a481f184.js";import{o as C}from"./orderApi.461296e5.js";import{R as k}from"./resoursesOrder.f2dbe5da.js";const et={class:"row"},ot={class:"text-subtitle2 col text-bold text-left text-muted text-overline"},st={class:"text-subtitle2 col text-bold text-center text-muted text-overline"},it={class:"text-subtitle2 col text-bold text-right text-muted text-overline"},lt={class:"row"},dt={class:"text-h6 col text-bold text-left text-strong"},at={class:"text-h6 col text-bold text-right text-strong"},rt={class:"text-subtitle2 col text-muted"},ct={class:"item-center row"},ut={class:"row items-end"},nt={class:"text-center"},pt={class:"col q-pa-xs"},vt={class:"col column q-py-md bg-section",style:{"border-radius":"8px"}},mt={class:"col q-pa-xs"},Ct={__name:"productView",props:{product:{type:Object,default:{}},order:{type:Object,default:{}},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]},units:{type:Array,default:[]},unit:{type:Object,default:{}}},emits:["reset","addProduct","deleteProduct"],setup(s,{emit:U}){const V=T(),f=tt();$(),F();const t=s,h=U,z=P(()=>!t.product.pivot.amount||t.product.pivot.amount<=0),n=P(()=>t.product.pivot._supply_by==3?t.product.pivot.amount*t.product.pieces:t.product.pivot._supply_by==2?t.product.pivot.amount*12:t.product.pivot.amount),j=()=>{t.product.pivot._supply_by=t.product.units.id},R=P(()=>t.order.client._price_list<=3?[1,2,3,4]:[t.order.client._price_list]),v=P(()=>t.order.client._price_list<=3?n.value>=t.product.pieces&&(t.product.pivot._supply_by==1||t.product.pivot._supply_by==2)||t.product.pivot._supply_by==3?4:k.verificarPrecioDocena(t.products,t.product,t.rules)?3:k.verificarPrecioMayoreo(t.products,t.product,t.rules)?2:1:t.order.client._price_list),B=()=>{h("reset")},E=async()=>{f.loading.show({message:"Editando Producto"});let c=t.product.prices.find(p=>p.id==v.value).pivot.price,i=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=v.value,t.product.pivot.price=c,t.product.pivot.total=i,console.log(t.product.pivot);const o=await C.editProduct(t.product.pivot);o.fail?console.log(o):(f.loading.hide(),B(),k.actualizarPreciosProductos(t.products,t.order,t.rules))},L=async()=>{f.loading.show({message:"Agregando producto"});let c=t.product.prices.find(p=>p.id==v.value).pivot.price,i=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=v.value,t.product.pivot.price=c,t.product.pivot.total=i,t.product.pivot._product=t.product.id,t.product.pivot._order=t.order.id,console.log(t.product.pivot);const o=await C.addProduct(t.product.pivot);o.fail?console.log(o):(h("addProduct",t.product),f.loading.hide(),k.actualizarPreciosProductos(t.products,t.order,t.rules))},M=async()=>{f.loading.show({message:"Eliminando Producto"});const c=await C.deleteProduct(t.product.pivot);c.fail?console.log(c):(h("deleteProduct",t.product),f.loading.hide(),k.actualizarPreciosProductos(t.products,t.order,t.rules))};return G(n,c=>{t.product.pivot.units=c},t.product.units),H(()=>{!t.product.pivot._supply_by&&t.units.length&&(t.product.pivot._supply_by=t.product.units),t.product.pivot.amount||(t.product.pivot.amount=1),t.product.pivot.units=n.value}),(c,i)=>(m(),y(Z,{class:"card-bg"},{default:l(()=>[e(q,null,{default:l(()=>[d("div",et,[d("div",ot,a(s.product.category.familia.seccion.name),1),d("div",st,a(s.product.category.familia.name),1),d("div",it,a(s.product.category.name),1)]),d("div",lt,[d("div",dt,a(s.product.code),1),d("div",at,a(s.product.name),1)]),d("div",rt,a(s.product.description),1),e(S,{class:"q-mt-md q-mb-md"},{default:l(()=>[e(b,null,{default:l(()=>[(m(!0),_(A,null,N([...s.product.stocks].sort((o,p)=>o.id-p.id),(o,p)=>(m(),y(u,{key:p},{default:l(()=>[e(D,{caption:"",class:Q(["text-center",o.id==I(V).session.store.id?"text-bold text-blue":"text-caption"])},{default:l(()=>[r(a(o.alias),1)]),_:2},1032,["class"]),e(D,{overline:"",class:Q(["text-center text-bold",[o.pivot.stock<0?"text-red":"text-caption text-overline",o.id==I(V).session.store.id?"text-blue":"text-caption"]])},{default:l(()=>[r(a(o.pivot.stock),1)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1}),d("div",ct,[(m(!0),_(A,null,N(s.product.prices.filter(o=>R.value.includes(o.id)),(o,p)=>(m(),_("div",{class:"col text-subtitle2 text-center",key:p},[d("div",{class:Q(o.id==v.value?"text-strong":"text-caption text-muted text-strike")},a(o.alias),3),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),d("div",{class:Q(o.id==v.value?"text-bold text-price":"text-caption text-muted")},a(o.pivot.price),3),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}})]))),128))])]),_:1}),e(q,null,{default:l(()=>[d("div",ut,[d("div",nt,[d("div",pt,[i[5]||(i[5]=d("div",{class:"text-bold text-h6 text-strong"},"Cantidad:",-1)),e(g,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:i[0]||(i[0]=o=>s.product.pivot.amount++)}),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),d("div",vt,[J(d("input",{type:"number",min:"1","onUpdate:modelValue":i[1]||(i[1]=o=>s.product.pivot.amount=o),class:"text-center exo clean-input",style:{width:"100px","font-size":"3em",margin:"auto"}},null,512),[[K,s.product.pivot.amount]])]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(g,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:i[2]||(i[2]=o=>s.product.pivot.amount>1?s.product.pivot.amount--:"")})])]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),d("div",mt,[e(O,{dense:"",filled:"",modelValue:s.product.units,"onUpdate:modelValue":[i[3]||(i[3]=o=>s.product.units=o),j],options:s.units,label:"Surtir por","option-label":"name"},null,8,["modelValue","options"]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(W,{dense:"",filled:"",modelValue:s.product.pivot.comments,"onUpdate:modelValue":i[4]||(i[4]=o=>s.product.pivot.comments=o),type:"text",label:"Notas"},null,8,["modelValue"]),e(x,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(S,{dense:""},{default:l(()=>[e(b,{class:"bg-highlight"},{default:l(()=>[e(u,{class:"text-left text-caption text-muted"},{default:l(()=>i[6]||(i[6]=[r("P x C")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:l(()=>[r(a(s.product.pieces)+" pzs",1)]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(u,{class:"text-left text-caption text-muted"},{default:l(()=>i[7]||(i[7]=[r("Cajas")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:l(()=>[r(a(Number(n.value/s.product.pieces).toFixed(1)),1)]),_:1})]),_:1}),e(b,{class:"bg-highlight"},{default:l(()=>[e(u,{class:"text-left text-caption text-muted"},{default:l(()=>i[8]||(i[8]=[r("Unidades")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:l(()=>[r(a(n.value)+" pzs",1)]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(u,{class:"text-left text-caption text-muted"},{default:l(()=>i[9]||(i[9]=[r("Precio")])),_:1}),e(u,{class:"text-bold text-center text-price"},{default:l(()=>[r(a(s.product.prices.find(o=>o.id==v.value).pivot.price),1)]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(u,{class:"text-left text-caption text-muted"},{default:l(()=>i[10]||(i[10]=[r("Total")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:l(()=>[r(a(s.product.prices.find(o=>o.id==v.value).pivot.price*n.value),1)]),_:1})]),_:1})]),_:1})])])]),_:1}),e(Y,null,{default:l(()=>[e(g,{flat:"",icon:"close",onClick:B}),e(X),s.edit?w("",!0):(m(),y(g,{key:0,flat:"",icon:"add",color:"positive",onClick:L,disable:z.value},null,8,["disable"])),s.edit?(m(),y(g,{key:1,flat:"",icon:"delete",color:"negative",onClick:M})):w("",!0),s.edit?(m(),y(g,{key:2,flat:"",icon:"edit",color:"warning",onClick:E,disable:z.value},null,8,["disable"])):w("",!0)]),_:1})]),_:1}))}};export{Ct as _};
