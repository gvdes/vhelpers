import{Q as q}from"./QInput.9af5332c.js";import{Q as B}from"./QForm.11c092c7.js";import{a as y,d as I}from"./QSelect.dc53555f.js";import{Q as R,a as D,e as E,d as F}from"./QList.c137fe0a.js";import{Q as N}from"./QTable.5c40b0ca.js";import{Q as T}from"./QPage.99e84550.js";import{u as z,Q as A,a as Q}from"./axios.0ca3d3b5.js";import{aH as H,a as L,u as U,r as m,c as j,o as k,g as M,e as a,w as o,a3 as Y,f as u,an as G,a4 as S,d as J,ak as d,a0 as c,Q as f,am as K}from"./index.5ce9d232.js";import{Q as O}from"./QCardActions.d44ea519.js";import{C as W}from"./ClosePopup.143b743d.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.66daa69b.js";import{u as X}from"./Restock.8695c3a2.js";import{$sktRestock as h}from"./socket.3fae67a0.js";import{_ as Z}from"./PrinterSelect.cecefa1e.js";import"./QLinearProgress.858bb278.js";import"./QCheckbox.ec9ea093.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.91db7e15.js";const tt={class:"flex justify-center"},et={class:"text-center",style:"width: 50%;"},at={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},ot={class:"text-bold"},St={__name:"supply",setup(st){H(),L();const n=X(),r=z(),_=U(),l=m(null),C=m({rowsPerPage:[0]}),i=m({state:!1,val:null}),v=j(()=>n.partitions.filter(s=>s._status==3&&s.requisition._workpoint_to==_.session.store.id_viz)),P=async()=>{n.setTitle("Surtido"),n.setButtonShow(!1)},V=async s=>{r.loading.show({message:"..."}),console.log(s.ip),console.log(i.value);const e=await g.printForPartition({ip:s.ip,port:s._port,_partition:i.value.val.id,_workpoint_to:i.value.val._workpoint_to});console.log(e),e.status==200?(e.data?r.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):r.notify({message:`Sin conexion a <b>${s.name} <small>(${s.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),r.loading.hide()):(console.error(e),alert(`Error ${e.status}: ${e.data}`))},x=async()=>{if(v.value.findIndex(e=>e.id==l.value)>=0){r.loading.show({message:"Cambiando Estado"});let e={partition:l.value,surtidor:_.session.credentials.staff,state:4};console.log(e);let t=await g.saveSupply(e);if(console.log(t),t.status==200){let b=n.partitions.findIndex(p=>p.id==t.data.partition.id);if(b>=0){if(n.partitions.splice(b,1,t.data.partition),t.data.partitionsEnd>t.data.partition.requisition._status){let p={id:t.data.partition._requisition,state:t.data.partitionsEnd};const w=await g.nextState(p);h.emit("order_refresh",{order:w.data}),console.log(w.data)}h.emit("orderpartition_refresh",{order:t.data.partition})}l.value=null,i.value={state:!1,val:null},r.loading.hide()}else t.status==401?(r.notify({message:"Ya esta surtido",type:"negative",position:"bottom"}),r.loading.hide(),l.value=null):alert(`Error ${t.status}: ${t.data.message} 2`)}else r.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),l.value=null},$=s=>{switch(s){case 4:return"bg-blue-11";case 7:return"bg-red-11";case 5:return"bg-purple-11";case 9:return"bg-green-11";case 23:return"bg-yellow-11";case 13:return"bg-brown-12";default:return""}};return P(),(s,e)=>(k(),M(Y,null,[a(T,{padding:""},{default:o(()=>[u("div",null,[u("div",tt,[u("div",et,[a(B,{onSubmit:x},{default:o(()=>[a(q,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value=t),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),a(N,{rows:v.value,"row-key":"name",grid:"",pagination:C.value,"hide-bottom":""},{item:o(t=>[u("div",at,[a(D,{bordered:"",class:G($(t.row.requisition.from.id))},{default:o(()=>[S((k(),J(F,{clickable:"",onClick:()=>{i.value.state=!0,i.value.val=t.row}},{default:o(()=>[a(E,null,{default:o(()=>[a(y,{class:"text-center text-bold"},{default:o(()=>[d(c(t.row.id),1)]),_:2},1024),a(y,{class:"text-center text-overline text-caption"},{default:o(()=>[u("span",ot,c(t.row.requisition.from.name),1),d(" (P: "+c(t.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[K]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),a(R,{modelValue:i.value.state,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.state=t),persistent:""},{default:o(()=>[a(A,null,{default:o(()=>[a(Q,{class:"text-bold text-h5 items-center"},{default:o(()=>[d(" Particion "+c(i.value.val.id),1)]),_:1}),a(Q,{class:"text-center"},{default:o(()=>e[3]||(e[3]=[d(" Que Desesas Hacer ? ")])),_:1}),a(O,{align:"center"},{default:o(()=>[S(a(f,{flat:"",icon:"close",color:"negative"},null,512),[[W]]),a(f,{flat:"",icon:"print",color:"primary"},{default:o(()=>[a(I,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:o(()=>[a(Z,{onSelectedPartition:V,partition:!0})]),_:1})]),_:1}),a(f,{flat:"",icon:"send",color:"positive",onClick:e[1]||(e[1]=()=>{l.value=i.value.val.id,x()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{St as default};
