import{Q as K}from"./QToolbarTitle.547aa48d.js";import{u as Y,r as d,c as T,o as j,d as Z,w as r,e,ak as A,f as k,a0 as B,b6 as q,Q as m,a1 as L,g as _,a3 as h,a4 as ee}from"./index.35a937f8.js";import{b as s,Q as G}from"./QList.da739209.js";import{Q as le}from"./QToolbar.8c75c4f7.js";import{Q as ae}from"./QSpace.0b95ff1d.js";import{Q as oe}from"./QTable.0c580f6f.js";import{a as R,Q as z}from"./axios.0dad148f.js";import{Q as g}from"./QInput.64a0db59.js";import{Q as J}from"./QCardActions.6922cece.js";import{Q as te}from"./QPage.6ae7d420.js";import{C as se}from"./ClosePopup.cf749f5f.js";import{u as W}from"./ProductsStore.046f6f22.js";import{Q as p}from"./QSelect.ea01bb0c.js";import{d as ne}from"./dayjs.min.cbcf888d.js";import{E as ie}from"./exceljs.min.9e24d01d.js";import{u as X}from"./use-quasar.974edd9e.js";import"./socket.3fae67a0.js";import{p as H}from"./productsApi.4a1d10f8.js";import"./QLinearProgress.63e0a86a.js";import"./QCheckbox.e684fb91.js";import"./_commonjsHelpers.88e99c8f.js";const re={class:"text-bold"},ue={class:"row"},de={class:"row"},ve={__name:"formProduct",props:{documentHigh:{type:Object}},emits:["addingProduct","closePopup"],setup($,{emit:O}){Y();const E=X(),n=W(),f=d(!1),b=d(!1),v=d(n.providers),u=d(n.makers),P=d(n.MedidasPers),S=O,V=d({state:!1,message:null,body:null}),l=d({val:{code:null,cb:null,short_code:null,description:null,categoria:null,familia:null,section:null,provider:null,reference:null,makers:null,cost:0,pxc:null,nluces:null,umc:null,pr:null,mnp:null}}),Q=T(()=>n.categories.filter(t=>t.deep==0)),i=T(()=>{let t=n.categories.filter(a=>a.deep==1);return l.value.val.section?t.filter(a=>a.root==l.value.val.section.id):t}),c=T(()=>{let t=n.categories.filter(a=>a.deep==2);return l.value.val.familia?t.filter(a=>a.root==l.value.val.familia.id):t}),D=async()=>{if(l.value.val.cb){f.value=!0;const t=await H.searchBarcode(l.value.val.cb);t.error?(console.log(t),f.value=!1):(console.log(t),t&&(E.notify({message:"El codigo de barras esta duplicado",type:"negative",position:"bottom"}),V.value.state=!0,V.value.message="El codigo ya existe en un  articulo",V.value.body=t),f.value=!1)}},U=async()=>{if(l.value.val.code){console.log(l.value.val.code),b.value=!0;const t=await H.searchCode(l.value.val.code);console.log(t),t.fail?(console.log(t),b.value=!1):(console.log(t),t.exist&&(E.notify({message:"El codigo ya existe",type:"negative",position:"bottom"}),alert("El codigo ya existe Favor de revisarlo"),l.value.val.code=null),l.value.val.cco=t.cco,b.value=!1)}},C=async()=>{if(l.value.val.section&&l.value.val.familia&&l.value.val.categoria){const t=await H.generateBarcode(l.value.val.categoria);t.error?console.log(t):(console.log(t),l.value.val.cb=t)}else E.notify({message:"Selecciona categorias para poder generar el codigo de barras",type:"negative",position:"bottom"})},F=(t,a,o)=>{a(()=>{const x=t.toLowerCase();v.value=n.providers.filter(w=>w.name.toLowerCase().indexOf(x)>-1)})},I=(t,a,o)=>{a(()=>{const x=t.toLowerCase();u.value=n.makers.filter(w=>w.name.toLowerCase().indexOf(x)>-1)})},y=(t,a,o)=>{a(()=>{const x=t.toLowerCase();P.value=n.MedidasPers.filter(w=>w.large.toLowerCase().indexOf(x)>-1)})},M=()=>{},N=()=>{S("closePopup")};return(t,a)=>(j(),Z(z,{style:{width:"700px","max-width":"80vw"}},{default:r(()=>[e(R,{class:"text-center text-h5"},{default:r(()=>[a[16]||(a[16]=A(" Documento : ")),k("span",re,B($.documentHigh.nameDoc),1)]),_:1}),e(s),e(R,null,{default:r(()=>[e(g,{modelValue:l.value.val.code,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.val.code=o),type:"text",label:"Codigo",filled:"",dense:"",maxlength:"13",onBlur:U,loading:b.value},null,8,["modelValue","loading"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),k("div",ue,[e(g,{class:"col",modelValue:l.value.val.cco,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.val.cco=o),type:"number",label:"Codigo Corto",filled:"",dense:"",disable:""},null,8,["modelValue"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{class:"col",modelValue:l.value.val.cb,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.val.cb=o),type:"text",label:"Codigo de Barras",filled:"",dense:"",onBlur:D,loading:f.value,error:V.value.state,"error-message":V.value.message},q({_:2},[f.value?void 0:{name:"append",fn:r(()=>{var o;return[e(m,{icon:"qr_code_2",flat:"",title:"Generar codigo de barras",disable:((o=l.value.val.cb)==null?void 0:o.length)>0,onClick:C},null,8,["disable"])]}),key:"0"}]),1032,["modelValue","loading","error","error-message"]),e(s,{spaced:"",inset:"",vertical:"",dark:""})]),e(g,{modelValue:l.value.val.description,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.val.description=o),type:"text",label:"Descripcion",filled:"",dense:""},null,8,["modelValue"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),k("div",de,[e(p,{class:"col",modelValue:l.value.val.section,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.val.section=o),options:Q.value,label:"SECCION",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{class:"col",modelValue:l.value.val.famlia,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.val.famlia=o),options:i.value,label:"FAMILIA",filled:"","option-label":"name",dense:"",disable:!l.value.val.section},null,8,["modelValue","options","disable"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{class:"col",modelValue:l.value.val.categoria,"onUpdate:modelValue":a[6]||(a[6]=o=>l.value.val.categoria=o),options:c.value,label:"CATEGORIA",filled:"","option-label":"name",dense:"",disable:!l.value.val.familia},null,8,["modelValue","options","disable"])]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{modelValue:l.value.val.provider,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.val.provider=o),options:v.value,label:"PROVEEDOR",filled:"","option-label":"name",dense:"","use-input":"","fill-input":"",onFilter:F},null,8,["modelValue","options"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{modelValue:l.value.val.reference,"onUpdate:modelValue":a[8]||(a[8]=o=>l.value.val.reference=o),options:L(n).reference,label:"REFERENCIA",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{modelValue:l.value.val.makers,"onUpdate:modelValue":a[9]||(a[9]=o=>l.value.val.makers=o),options:u.value,label:"FABRICANTE",filled:"","option-label":"name",dense:"","use-input":"","fill-input":"",onFilter:I},null,8,["modelValue","options"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{modelValue:l.value.val.cost,"onUpdate:modelValue":a[10]||(a[10]=o=>l.value.val.cost=o),type:"number",label:"COSTO",filled:"",dense:""},null,8,["modelValue"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{modelValue:l.value.val.pxc,"onUpdate:modelValue":a[11]||(a[11]=o=>l.value.val.pxc=o),type:"text",label:"PXC",filled:"",dense:""},null,8,["modelValue"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{modelValue:l.value.val.nluces,"onUpdate:modelValue":a[12]||(a[12]=o=>l.value.val.nluces=o),type:"text",label:"NUMERO LUCES",filled:"",dense:""},null,8,["modelValue"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{modelValue:l.value.val.umc,"onUpdate:modelValue":a[13]||(a[13]=o=>l.value.val.umc=o),options:L(n).unitsMeasure,label:"U MEDIDA COMPRA",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{modelValue:l.value.val.pr,"onUpdate:modelValue":a[14]||(a[14]=o=>l.value.val.pr=o),options:L(n).productRe,label:"PRODUCTO RESURTIBLE",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(p,{modelValue:l.value.val.mnp,"onUpdate:modelValue":a[15]||(a[15]=o=>l.value.val.mnp=o),options:P.value,label:"MEDIDA / PERSONAJE",filled:"","option-label":"large",dense:"","use-input":"","fill-input":"",onFilter:y},null,8,["modelValue","options"])]),_:1}),e(J,{align:"center"},{default:r(()=>[e(m,{flat:"",label:"CANCELAR",onClick:N}),e(m,{flat:"",label:"AGREGAR",onClick:M})]),_:1})]),_:1}))}},ce={class:"text-caption"},pe={class:"text-bold"},Ie={__name:"higthProducts",setup($){const O=Y();X(),W().setTitle("Alta Productos");const n=d(!1),f=d(null),b=d([]),v=d({state:!1,val:null}),u=d({state:!1,autor:O.session.credentials.staff,nameDoc:null,date:null}),P=()=>{f.value.click()},S=()=>{const Q=document.getElementById("inputFile").files[0];new ie.Workbook().xlsx.load(Q).then(c=>{const D=c.worksheets[0],U=[];D.getRow(1).eachCell(C=>{U.push(C.value)}),D.eachRow((C,F)=>{if(F===1)return;console.log();const I=C.values.slice(1),y={};U.forEach((M,N)=>{var t;y[M]=(t=I[N])!=null?t:null}),console.log(y),b.value.push(y)})})},V=()=>{v.value.state=!1,u.value.state=!0,u.value.nameDoc=v.value.val,u.value.date=ne().format("YYYY-MM-DD HH:mm:ss"),n.value=!0},l=()=>{n.value=!1};return(Q,i)=>(j(),_(h,null,[e(te,{padding:""},{default:r(()=>[e(le,null,{default:r(()=>[e(K),e(m,{flat:"",round:"",dense:"",icon:"download",class:"q-mr-xs",size:"lg",title:"Descargar Archivo",disable:b.value.length==0},null,8,["disable"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{flat:"",round:"",dense:"",icon:"upload_file",size:"lg",onClick:P,title:"Subir Archivo",disable:u.value.state},null,8,["disable"]),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(m,{icon:"add",onClick:i[0]||(i[0]=c=>v.value.state=!v.value.state),title:"Crear Documento",flat:"",round:"",dense:"",size:"lg",disable:u.value.state},null,8,["disable"])]),_:1}),e(s,{spaced:"",inset:"",vertical:"",dark:""}),e(oe,{rows:b.value},q({_:2},[u.value.state?{name:"top",fn:r(()=>[k("div",null,[k("div",ce,[A(B(u.value.autor.complete_name)+" ",1),e(s),A(" "+B(u.value.date),1)]),k("div",pe,B(u.value.nameDoc),1)]),e(ae),e(m,{color:"primary",icon:"inventory",flat:"",onClick:i[1]||(i[1]=c=>n.value=!n.value)})]),key:"0"}:void 0]),1032,["rows"]),e(G,{modelValue:n.value,"onUpdate:modelValue":i[2]||(i[2]=c=>n.value=c),persistent:"",position:"right","full-height":""},{default:r(()=>[e(ve,{documentHigh:u.value,onClosePopup:l},null,8,["documentHigh"])]),_:1},8,["modelValue"]),e(G,{modelValue:v.value.state,"onUpdate:modelValue":i[4]||(i[4]=c=>v.value.state=c),persistent:""},{default:r(()=>[e(z,null,{default:r(()=>[e(R,{class:"text-bold text-h6"},{default:r(()=>i[5]||(i[5]=[A(" Nombre de el nuevo Documento ")])),_:1}),e(R,null,{default:r(()=>[e(g,{modelValue:v.value.val,"onUpdate:modelValue":i[3]||(i[3]=c=>v.value.val=c),type:"text",label:"Nombre"},null,8,["modelValue"])]),_:1}),e(J,{align:"right"},{default:r(()=>[ee(e(m,{flat:"",label:"Cancelar",color:"primary"},null,512),[[se]]),e(m,{flat:"",label:"Crear",color:"primary",onClick:V})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),k("input",{type:"file",ref_key:"inputFile",ref:f,id:"inputFile",onInput:S,hidden:"",accept:".xlsx,.xls"},null,544)],64))}};export{Ie as default};
