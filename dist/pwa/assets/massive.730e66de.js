import{u as ge,r,c as W,l as be,o as m,d as $,w as u,e as o,Q as w,h as B,g as y,a3 as he,a2 as ke,f as N,ak as z,a0 as we,a4 as q}from"./index.e9989cb6.js";import{b as D,Q as G}from"./QList.1e7f4bf4.js";import{Q as A}from"./QSelect.972fc9ba.js";import{Q as V}from"./axios.3ec70faf.js";import{Q as T}from"./QCard.c269a07c.js";import{Q as F}from"./QTable.38388707.js";import{Q as H}from"./QCardActions.d40deb8f.js";import{Q as Ce}from"./QPage.a33496de.js";import{C as J}from"./ClosePopup.5ff6d6a0.js";import"./QDrawer.585bbd1d.js";import{u as ye}from"./use-quasar.6179454f.js";import{u as Ve}from"./warehousStore.a829354c.js";import"./QInput.7d6b8819.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.38b24ade.js";import{E as K}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as I}from"./locationsApi.37c19dbd.js";import"./QLinearProgress.58e373b6.js";import"./QCheckbox.53cb1e13.js";import"./QResizeObserver.abb63167.js";import"./QScrollObserver.35fd6caa.js";import"./_commonjsHelpers.88e99c8f.js";const _e={key:0},xe={key:1},Ee={key:0},Se={key:0,class:"row"},Ue={key:1},Qe={key:0},Be={class:"text-left"},De={key:2},tl={__name:"massive",setup(Ae){const R=ge(),d=ye();Ve().setTitle("Acciones Masivas");const M=r([]),t=r({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),O=r(null),X=r(null),Y=r(null),le=r([]),L=r([]),ae=r(0),P=r(null),E=r({val:[],status:!1}),S=r({val:[],status:!1}),_=r({val:null,types:[{id:1,label:"CREAR"},{id:2,label:"ELIMINAR"}]}),U=r({val:null,opts:[{id:1,label:"CATEGORIAS"},{id:2,label:"UBICACION"},{id:3,label:"EXCEL"}]}),h=r({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),Z=r({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"locations",label:"Ubicacion",field:l=>l.locations.map(e=>e.path).join("/"),align:"left"}]}),oe=W(()=>t.value.all.filter(l=>l.deep==0)),te=W(()=>t.value.seccion.val.length>0?t.value.all.filter(l=>l.deep==1&&t.value.seccion.val.map(e=>e.id).includes(l.root)):t.value.all.filter(l=>l.deep==1)),se=W(()=>{if(t.value.seccion.val.length>0&&t.value.familias.val.length==0){let l=t.value.all.filter(e=>e.deep==1&&t.value.seccion.val.map(a=>a.id).includes(e.root)).map(e=>e.id);return t.value.all.filter(e=>e.deep==2&&l.includes(e.root))}else return t.value.familias.val.length>0?t.value.all.filter(l=>l.deep==2&&t.value.familias.val.map(e=>e.id).includes(l.root)):t.value.all.filter(l=>l.deep==2)}),ie=async()=>{d.loading.show({message:"Obteniendo Secciones"});const l=await I.getInit(R.session.store.id);l.fail?console.log(l):(console.log(l),M.value=l.celler,t.value.all=l.categories),d.loading.hide()},ne=()=>{const l=O.value.sections||[];ae.value=Math.max(...l.map(e=>e.deep)),L.value=[{options:l.filter(e=>e.root===0),selected:null}],le.value=L.value[0].options},ee=l=>{var e;return((e=O.value.sections)==null?void 0:e.filter(a=>a.root===l))||[]},ue=(l,e)=>{L.value.splice(e+1);const a=ee(l);a.length>0&&L.value.push({options:a,selected:null})},ce=async()=>{d.loading.show({message:"Obeniendo Productos"});let l={workpoint:R.session.store.id_viz,section:P.value.selected};const e=await I.obtProduct(l);e.fail?console.log(e):(console.log(e),E.value.status=!0,E.value.val=e,d.loading.hide())},de=async()=>{d.loading.show({message:"Eliminando Ubicaciones"});let l={products:E.value.val.map(a=>a.id),section:P.value.selected};console.log(l);const e=await I.deleteSectionProducts(l);e.fail?console.log(e):(console.log(e),E.value={val:[],status:!1},d.loading.hide())},re=async()=>{var a,n,p;d.loading.show({message:"El reporte puede tardar unos minutos"});let l={workpoint:R.session.store.id_viz,sections:(a=t.value.seccion.val)==null?void 0:a.map(i=>i.id),familys:(n=t.value.familias.val)==null?void 0:n.map(i=>i.id),categories:(p=t.value.categories.val)==null?void 0:p.map(i=>i.id)};console.log(l);const e=await I.obtProductCategories(l);e.fail?console.log(e):(d.loading.hide(),console.log(e),S.value.status=!0,S.value.val=e)},pe=async()=>{d.loading.show({message:"Eliminando Ubicaciones"});let l={products:S.value.val.map(a=>({product:a.id,locations:a.locations.map(n=>n.id)}))};const e=await I.deleteCategoriesLocations(l);e.fail?console.log(e):(console.log(e),console.log(e),S.value={val:[],status:!1},d.loading.hide())},ve=()=>{var n;let l=(n=document.getElementById("refCreate"))==null?void 0:n.files[0],e=new K.Workbook,a={};d.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async p=>{let i=e.worksheets[0],f=i.getColumn("A");i.getColumn("B"),f.eachCell({includeEmpty:!0},function(k,g){if(g===1)return;let b=k.value,s=i.getCell(`B${g}`).value;!b||(a[b]||(a[b]=[]),a[b].includes(s)||a[b].push(s||cantidad))});let v=Object.keys(a).map(k=>({_product:k,_location:a[k],_workpoint:R.session.store.id_viz}));console.log(v);const c=await I.addMassiveLocation(v);c.fail?console.log(c):(console.log(c),h.value.state=!0,h.value.val=c,d.loading.hide())})},me=()=>{var n;let l=(n=document.getElementById("refCreate"))==null?void 0:n.files[0],e=new K.Workbook,a={};d.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async p=>{let i=e.worksheets[0],f=i.getColumn("A");i.getColumn("B"),f.eachCell({includeEmpty:!0},function(c,k){if(k===1)return;let g=c.value,b=i.getCell(`B${k}`).value;!g||(a[g]||(a[g]=[]),a[g].includes(b)||a[g].push(b||cantidad))});let v=Object.keys(a).map(c=>({_product:c,_location:a[c],_workpoint:R.session.store.id_viz}));if(console.log(v),v.length){const c=await I.addMassiveLocation(v);c.fail?console.log(c):(console.log(c),h.value.state=!0,h.value.val=c,d.loading.hide())}else d.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},fe=async()=>{const l=new K.Workbook;M.value.forEach((p,i)=>{var b;const f=l.addWorksheet(`${p.name}_${i}`),v=p.sections||[],c=Math.max(...v.map(s=>s.deep||1)),k=[];for(let s=0;s<=c;s++)k.push(`NOMBRE_${s}`,`PATH_${s}`,`ID_${s}`);f.addRow(k);const g=(s,Q)=>{const C=Array(c*3).fill("");for(let x=0;x<Q.length;x++)C[x]=Q[x];C[s.deep*3]=s.name,C[s.deep*3+1]=s.path,C[s.deep*3+2]=s.id,f.addRow(C),v.filter(x=>x.root===s.id).forEach(x=>g(x,C))};v.filter(s=>s.deep===0).forEach(s=>g(s,[s.name,s.path,s.path])),(b=f.columns)==null||b.forEach(s=>{let Q=0;s.eachCell({includeEmpty:!0},C=>{const j=C.value?C.value.toString().length:10;j>Q&&(Q=j)}),s.width=Q<10?10:Q})});const e=await l.xlsx.writeBuffer(),a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.download="almacenes.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return ie(),be(L,l=>{const e=l.filter(a=>a.selected!==null);if(e.length){const a=e[e.length-1];ee(a.selected),P.value=a}},{deep:!0}),(l,e)=>(m(),$(Ce,{padding:""},{default:u(()=>[o(T,{class:"my-card"},{default:u(()=>[o(V,{class:"row"},{default:u(()=>{var a,n;return[o(w,{icon:"download",flat:"",onClick:fe,title:"descargar Estructura"}),o(D,{spaced:"",inset:"",vertical:"",dark:""}),o(A,{dense:"",class:"col",modelValue:_.value.val,"onUpdate:modelValue":e[0]||(e[0]=p=>_.value.val=p),options:_.value.types,label:"Tipo",filled:""},null,8,["modelValue","options"]),((a=_.value.val)==null?void 0:a.id)==2?(m(),$(D,{key:0,spaced:"",inset:"",vertical:"",dark:""})):B("",!0),((n=_.value.val)==null?void 0:n.id)==2?(m(),$(A,{key:1,dense:"",class:"col",modelValue:U.value.val,"onUpdate:modelValue":e[1]||(e[1]=p=>U.value.val=p),options:U.value.opts,label:"MEDIO",filled:""},null,8,["modelValue","options"])):B("",!0)]}),_:1}),_.value.val?(m(),$(V,{key:0},{default:u(()=>{var a,n,p;return[_.value.val.id==1?(m(),y("div",_e,[o(w,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[2]||(e[2]=()=>X.value.click())})])):_.value.val.id==2?(m(),y("div",xe,[U.value.val?(m(),y("div",Ee,[((a=U.value.val)==null?void 0:a.id)==1?(m(),y("div",Se,[o(A,{class:"col",modelValue:t.value.seccion.val,"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.seccion.val=i),options:oe.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(D,{spaced:"",inset:"",vertical:"",dark:""}),o(A,{class:"col",modelValue:t.value.familias.val,"onUpdate:modelValue":e[4]||(e[4]=i=>t.value.familias.val=i),options:te.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:t.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(D,{spaced:"",inset:"",vertical:"",dark:""}),o(A,{class:"col",modelValue:t.value.categories.val,"onUpdate:modelValue":e[5]||(e[5]=i=>t.value.categories.val=i),options:se.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:t.value.seccion.val.length==0||t.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(D,{spaced:"",inset:"",vertical:"",dark:""}),o(w,{color:"primary",label:t.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:re},null,8,["label"])])):((n=U.value.val)==null?void 0:n.id)==2?(m(),y("div",Ue,[M.value.length>0?(m(),y("div",Qe,[o(A,{modelValue:O.value,"onUpdate:modelValue":[e[6]||(e[6]=i=>O.value=i),ne],options:M.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),o(D,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),y(he,null,ke(L.value,(i,f)=>(m(),y("div",{key:f},[N("div",null,[o(A,{modelValue:i.selected,"onUpdate:modelValue":[v=>i.selected=v,v=>ue(v,f)],options:i.options,label:`Nivel ${f+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(D,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):B("",!0),N("div",Be,[o(w,{icon:"delete",flat:"",onClick:ce,disable:!O.value},null,8,["disable"])])])):((p=U.value.val)==null?void 0:p.id)==3?(m(),y("div",De,[o(w,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[7]||(e[7]=()=>Y.value.click())})])):B("",!0)])):B("",!0)])):B("",!0)]}),_:1})):B("",!0)]),_:1}),o(G,{modelValue:E.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>E.value.status=a),persistent:""},{default:u(()=>[o(T,null,{default:u(()=>[o(V,{class:"row items-center"},{default:u(()=>[z(" Vaciar Seccion "+we(P.value.options.find(a=>a.id==P.value.selected).name),1)]),_:1}),o(V,null,{default:u(()=>[o(F,{title:"Productos",rows:E.value.val,columns:Z.value.columns},null,8,["rows","columns"])]),_:1}),o(H,{align:"right"},{default:u(()=>[q(o(w,{flat:"",label:"Cancel",color:"primary"},null,512),[[J]]),o(w,{flat:"",label:"Vaciar Seccion",color:"negative",onClick:de})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(G,{modelValue:S.value.status,"onUpdate:modelValue":e[9]||(e[9]=a=>S.value.status=a),persistent:""},{default:u(()=>[o(T,null,{default:u(()=>[o(V,{class:"row items-center"},{default:u(()=>e[11]||(e[11]=[z(" Eliminar Ubicaciones de los Articulos ")])),_:1}),o(V,null,{default:u(()=>[o(F,{title:"Productos",rows:S.value.val,columns:Z.value.columns},null,8,["rows","columns"])]),_:1}),o(H,{align:"right"},{default:u(()=>[q(o(w,{flat:"",label:"Cancel",color:"primary"},null,512),[[J]]),o(w,{flat:"",label:"Eliminar Ubicacion",color:"negative",onClick:pe})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(G,{modelValue:h.value.state,"onUpdate:modelValue":e[10]||(e[10]=a=>h.value.state=a),persistent:""},{default:u(()=>[o(T,null,{default:u(()=>[o(V,{class:"text-bold text-center text-h6"},{default:u(()=>e[12]||(e[12]=[z(" Resultados de Importacion ")])),_:1}),o(V,null,{default:u(()=>[o(F,{rows:h.value.val.goals,columns:h.value.table.columns},null,8,["rows","columns"])]),_:1}),o(V,null,{default:u(()=>[o(F,{rows:h.value.val.fails,columns:h.value.table.columns},null,8,["rows","columns"])]),_:1}),o(H,{align:"right"},{default:u(()=>[q(o(w,{flat:"",label:"OK",color:"primary"},null,512),[[J]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),N("input",{type:"file",ref_key:"refCreate",ref:X,id:"refCreate",onInput:ve,hidden:"",accept:".xlsx,.xls"},null,544),N("input",{type:"file",ref_key:"refDelete",ref:Y,id:"refDelete",onInput:me,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}))}};export{tl as default};
