import{b as Y,Q as X}from"./QList.2ac5eca7.js";import{Q as K}from"./QHeader.cb9c74e1.js";import{r as w,c as h,o as M,g as I,d as R,w as u,e as n,f as v,a0 as E,a1 as z,Q as T,ak as U,a3 as F,a2 as Z,h as j,aH as ee,a as te,u as ae,n as oe,E as le,aI as se}from"./index.e40eb483.js";import{Q as ne,d as re}from"./QSelect.d08658eb.js";import{Q as ie}from"./QInput.ebeecdfc.js";import{Q as de}from"./QForm.ec415271.js";import{Q as ue}from"./QToolbar.6f6e5304.js";import{Q as P}from"./QTable.ed50ebb3.js";import{v as H,a as O,Q as A}from"./axios.a2d28419.js";import{Q as ce}from"./QPage.3fa3f222.js";import{Q as me,a as ve}from"./QLayout.7a676e44.js";import{u as fe}from"./use-quasar.d56e8514.js";import{d as V}from"./dayjs.min.cbcf888d.js";import{_ as pe}from"./UserToolbar.e039e053.js";import{Q as be,a as N,b as ge,c as q}from"./QTabPanels.2627f35a.js";import{E as ye}from"./exceljs.min.9e24d01d.js";import{c as D}from"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.1fc9e102.js";import"./QLinearProgress.53268299.js";import"./QCheckbox.fc5dbcf1.js";import"./QScrollObserver.1e2e6f76.js";import"./QDrawer.99dd8c46.js";import"./QCardActions.5acea791.js";import"./ClosePopup.8fedccbb.js";import"./auth.f08b9687.js";import"./use-render-cache.3aae9b27.js";var W={index({dateranges:C,view:k,store:p}){let g=k.id;return C.to,C.from,H.get(`/ciclicos?v=${g}&store=${p}`).then(_=>_.data).catch(_=>({fail:_}))},find(C,k){return H.get(`/ciclicos/${C}?store=${k}`).then(p=>p.data).catch(p=>({fail:p}))}},G={exports:{}};(function(C,k){(function(p,g){g()})(D,function(){function p(o,e){return typeof e=="undefined"?e={autoBom:!1}:typeof e!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function g(o,e,m){var l=new XMLHttpRequest;l.open("GET",o),l.responseType="blob",l.onload=function(){x(l.response,e,m)},l.onerror=function(){console.error("could not download file")},l.send()}function _(o){var e=new XMLHttpRequest;e.open("HEAD",o,!1);try{e.send()}catch{}return 200<=e.status&&299>=e.status}function s(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(e)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof D=="object"&&D.global===D?D:void 0,b=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),x=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(o,e,m){var l=d.URL||d.webkitURL,c=document.createElement("a");e=e||o.name||"download",c.download=e,c.rel="noopener",typeof o=="string"?(c.href=o,c.origin===location.origin?s(c):_(c.href)?g(o,e,m):s(c,c.target="_blank")):(c.href=l.createObjectURL(o),setTimeout(function(){l.revokeObjectURL(c.href)},4e4),setTimeout(function(){s(c)},0))}:"msSaveOrOpenBlob"in navigator?function(o,e,m){if(e=e||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(p(o,m),e);else if(_(o))g(o,e,m);else{var l=document.createElement("a");l.href=o,l.target="_blank",setTimeout(function(){s(l)})}}:function(o,e,m,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof o=="string")return g(o,e,m);var c=o.type==="application/octet-stream",S=/constructor/i.test(d.HTMLElement)||d.safari,L=/CriOS\/[\d]+/.test(navigator.userAgent);if((L||c&&S||b)&&typeof FileReader!="undefined"){var Q=new FileReader;Q.onloadend=function(){var f=Q.result;f=L?f:f.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=f:location=f,l=null},Q.readAsDataURL(o)}else{var i=d.URL||d.webkitURL,r=i.createObjectURL(o);l?l.location=r:location.href=r,l=null,setTimeout(function(){i.revokeObjectURL(r)},4e4)}});d.saveAs=x.saveAs=x,C.exports=x})})(G);var we=G.exports;const ke={class:"row justify-between"},he={class:"text-h6"},_e={class:"text-subtitle2"},xe={class:"text-subtitle2"},Ce={class:"text-subtitle2"},Qe={class:"text-white"},Me={__name:"Viewer",props:{folio:[String,Number],store:[String,Number]},emits:["errorsearch"],setup(C,{emit:k}){const p=C,g=p.folio,_=p.store,s=w(null),d=w(null),b=w("body"),x=w(null),o=w({cols:[{name:"id",field:"id",label:"ID",align:"left"},{name:"lcode",field:"code",label:"Codigo"},{name:"scode",field:"name",label:"Codigo C."},{name:"descr",field:"description",label:"Articulo",align:"left",classes:"fs-dec4"},{name:"sai",field:i=>i.ordered.stocks,label:"SAI",align:"center"},{name:"counteds",field:i=>i.ordered.stocks_acc,label:"UC",align:"center"},{name:"sat",field:i=>{var r;return(r=i.ordered.stocks_end)!=null?r:"--"},label:"SAT",align:"center"},{name:"ufus",field:i=>i.ordered.stocks_acc-i.ordered.stocks,label:"UF/US",align:"center"},{name:"locs",field:i=>i.locations.map(r=>r.path).join(", "),label:"Ubicacion (es)",align:"left"}]}),e=h(()=>s.value?s.value.created_by:null),m=h(()=>s.value?s.value.log:[]),l=h(()=>s.value&&s.value.responsables&&s.value.responsables.length?s.value.responsables.map(i=>i.nick).join(","):""),c=h(()=>s.value&&s.value.products&&s.value.products.length?s.value.products:[]),S=h(()=>s.value?s.value.status.name:"");h(()=>""),h(()=>""),(async()=>{const i=await W.find(g,_);console.log(i),i.fail?d.value=i.fail:s.value=i.inventory})();const Q=i=>{let r=`INV_${s.value.id}_${s.value.workpoint.alias}.xlsx`;console.log(r);let f=new ye.Workbook,t=f.addWorksheet("Sheet1");t.columns=[{header:"ID",key:"id"},{header:"Codigo",key:"lcode"},{header:"Codigo C.",key:"scode"},{header:"Articulo",key:"description"},{header:"SAI",key:"sai"},{header:"UC",key:"uc"},{header:"SAT",key:"sat"},{header:"UF/US",key:"ufus"},{header:"Ubicacion(es)",key:"locs"}],c.value.forEach(a=>{t.addRow({id:a.id,lcode:a.code,scode:a.name,description:a.description,sai:parseInt(a.ordered.stocks),uc:parseInt(a.ordered.stocks_acc),sat:parseInt(a.ordered.stocks_end),ufus:parseInt(a.ordered.stocks_acc)-parseInt(a.ordered.stocks),locs:a.locations.map(y=>y.path).join(", ")})}),t.getCell("L2").value="Folio:",t.getCell("M2").value=s.value.id,t.getCell("L3").value="Sucursal:",t.getCell("M3").value=s.value.workpoint.name,t.getCell("L4").value="Estado:",t.getCell("M4").value=S.value,t.getCell("L5").value="Creado por:",t.getCell("M5").value=e.value?e.value.names:"",t.getCell("L6").value="Realizado por:",t.getCell("M6").value=l.value,t.getCell("L7").value="Inicio:",t.getCell("M7").value="",t.getCell("L8").value="Termino:",t.getCell("M8").value="",f.xlsx.writeBuffer().then(a=>we(new Blob([a],{type:"application/octet-stream"}),r))};return(i,r)=>(M(),I(F,null,[s.value?(M(),R(A,{key:0,class:"my-card"},{default:u(()=>[n(O,null,{default:u(()=>[v("div",ke,[v("div",he,"Inventario "+E(z(g)),1),v("div",null,[n(T,{color:"primary",label:"descargar",onClick:Q})])]),v("div",_e,[r[2]||(r[2]=U("Creado por: ")),v("b",null,E(e.value?e.value.names:"Nobody"),1)]),v("div",xe,[r[3]||(r[3]=U("Realizado por: ")),v("b",null,E(l.value),1)]),v("div",Ce,[r[4]||(r[4]=U("Estado: ")),v("b",null,E(S.value),1)])]),_:1}),n(be,{modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=f=>b.value=f)},{default:u(()=>[n(N,{name:"log",label:"Log"}),n(N,{name:"body",label:"Resumen"})]),_:1},8,["modelValue"]),n(ge,{modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=f=>b.value=f),animated:""},{default:u(()=>[n(q,{name:"log"},{default:u(()=>[r[5]||(r[5]=v("div",{class:"text-h6"},"Log",-1)),(M(!0),I(F,null,Z(m.value,(f,t)=>(M(),I("div",{key:t},[v("pre",null,E(f),1)]))),128))]),_:1}),n(q,{name:"body"},{default:u(()=>[n(P,{flat:"",rows:c.value,columns:o.value.cols,"row-key":"name",ref_key:"rowsproducts",ref:x},null,8,["rows","columns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):j("",!0),d.value?(M(),R(A,{key:1,class:"bg-negative"},{default:u(()=>[n(O,null,{default:u(()=>[v("pre",Qe,E(d.value),1)]),_:1})]),_:1})):j("",!0)],64))}},Se={class:"row items-center"},Ee={key:0,class:"text-right"},tt={__name:"CiclicosLayout",setup(C){const k=w(""),p=fe(),g=ee(),_=te(),s=ae(),d=w({state:!1,data:null}),b=w(null),x=w([]),o=w({cols:[{name:"id",field:"id",label:"Folio"},{name:"started",field:t=>V(t.created_at).format("YYYY/MM/DD HH:mm:ss"),label:"Creacion",align:"center"},{name:"status",field:t=>t.status.name,label:"Estado",align:"center"},{name:"ended",field:t=>{let a=t.log.find(y=>y.id==3);return a?V(a.pivot.created_at).format("YYYY/MM/DD HH:mm:ss"):"--"},align:"center",label:"Termino"},{name:"models",field:"products_count",label:"Modelos"},{name:"type",field:t=>t.type.name,label:"Tipo"},{name:"warehouse",field:t=>t.settings?t.settings.warehouse.name:"---",label:"Almacen"}]}),e=w([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"c",label:"otra ...",disable:!0}]),m=w({from:V(Date.now()).startOf("day"),to:V(Date.now()).endOf("day")}),l=h(()=>x.value.map(t=>(t.settings=JSON.parse(t.settings),t))),c=h(()=>k.value&&k.value.length),S=h(()=>m.value.from.format("YYYY/MM/DD")),L=h(()=>m.value.to.format("YYYY/MM/DD")),Q=()=>{console.log("searching folio"),d.value.folio=k.value,d.value.state=!0},i=async(t,a,y)=>{d.value.folio=a.id,d.value.state=!0},r=async()=>{var B;console.log(s.session),p.loading.show({message:"Cargado vista..."});let t=(B=g.query.v)!=null?B:"day",a=e.value.findIndex(J=>J.id==t),y=a>=0?a:0;console.log(y),b.value=e.value[y],m.value.from=V(Date.now()).startOf(b.value.id);const $=await W.index({dateranges:m,view:b.value,store:s.session.store.id_viz});console.log($),x.value=$.inventories,p.loading.hide()},f=()=>{_.push(`/ciclicos?v=${b.value.id}`)};return r(),oe(()=>g.query,()=>{r()}),(t,a)=>(M(),R(me,{view:"hHh Lpr fFf"},{default:u(()=>[n(K,{class:"bg-grey-3 text-dark",bordered:""},{default:u(()=>[n(pe),n(Y)]),_:1}),n(ve,null,{default:u(()=>[n(ue,{class:"justify-between"},{default:u(()=>[v("div",null,[a[3]||(a[3]=v("span",{class:"text-grey"},"Helpers",-1)),a[4]||(a[4]=U()),n(le,{name:"navigate_next",color:"primary"}),a[5]||(a[5]=U()),a[6]||(a[6]=v("span",{class:"text-h6"},"Ciclicos",-1))]),v("div",Se,[n(ne,{modelValue:b.value,"onUpdate:modelValue":[a[0]||(a[0]=y=>b.value=y),f],options:e.value,label:"Vista",autofocus:"",borderless:""},{prepend:u(()=>[n(T,{dense:"",flat:"",color:"primary",icon:"autorenew",onClick:se(r,["stop"])})]),_:1},8,["modelValue","options"]),n(T,{color:"primary",icon:"search",dense:"",flat:""},{default:u(()=>[n(re,null,{default:u(()=>[a[7]||(a[7]=v("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Inventario",-1)),n(Y),n(de,{dense:"",onSubmit:Q,class:"q-gutter-md q-pa-md"},{default:u(()=>[n(ie,{modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=y=>k.value=y),type:"number",label:"Folio",autofocus:""},null,8,["modelValue"]),c.value?(M(),I("div",Ee,[n(T,{type:"submit",color:"primary",icon:"search"})])):j("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),n(ce,{padding:""},{default:u(()=>[n(A,{class:"my-card",flat:""},{default:u(()=>[n(P,{title:`Inventarios del ${S.value} al ${L.value} [ ${x.value.length} ]`,rows:l.value,columns:o.value.cols,"row-key":"id",onRowClick:i},null,8,["title","rows","columns"])]),_:1}),n(X,{modelValue:d.value.state,"onUpdate:modelValue":a[2]||(a[2]=y=>d.value.state=y),"full-width":""},{default:u(()=>[n(Me,{folio:d.value.folio,store:z(s).session.store.id_viz},null,8,["folio","store"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{tt as default};
