import{aH as E,a as H,u as R,r as b,c as G,p as K,o as d,d as x,w as i,e as o,f as l,S as P,aI as z,h as _,ak as c,a0 as n,an as X,a1 as g,g as v,a2 as J,a3 as W,Q as p}from"./index.1caea72c.js";import{Q as B,a as I}from"./QSelect.f9196b14.js";import{Q as Y}from"./QInput.1e2dc3e6.js";import{b as y,Q as Z,a as tt,d as et,e as ot}from"./QList.c5925261.js";import{Q as C}from"./QCardSection.e7ec6c6e.js";import{Q as V}from"./QImg.e49be0f5.js";import{Q as j}from"./QBtnGroup.0d2eba0f.js";import{Q as A}from"./QCard.c7bbc0b0.js";import{Q as st}from"./QPageSticky.3dadf1ae.js";import{Q as at}from"./QTable.12d1f84c.js";import{Q as it}from"./QPage.b53b15b6.js";import"./dayjs.min.cbcf888d.js";import{c as lt,a as rt}from"./catalogStore.0f5fc7b4.js";import{u as nt}from"./use-quasar.2a5547a4.js";import"./QDrawer.25422a8a.js";import"./QCardActions.70d330c5.js";import"./ClosePopup.f2176256.js";import{v as $}from"./axios.d0e85866.js";import"./socket.05630e21.js";import"./Restock.f8df692f.js";import"./use-key-composition.2156c461.js";import"./QLinearProgress.478806cb.js";import"./QCheckbox.5473f73d.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.cbcc886d.js";import"./QScrollObserver.83cb7307.js";import"./QToolbar.934f2598.js";import"./QForm.3c7e1f82.js";import"./QRadio.54142cc7.js";import"./QTd.ec2d11eb.js";import"./QPopupEdit.806030d9.js";import"./QTr.8b167a68.js";import"./QLayout.5d2bfff3.js";import"./jspdf.plugin.autotable.c889c6b6.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const dt={class:"row justify-end q-gutter-sm full-width"},ct={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},ut={class:"col"},mt={class:"text-bold"},vt={class:"col"},pt={class:"text-bold"},ft={class:"col"},gt={class:"row"},_t={class:"text-caption"},kt={class:"text-caption"},bt={class:"text-caption"},xt={class:"text-caption"},yt=["onClick"],ht={key:1,class:"col-6 flex flex-center bg-grey-2",style:{height:"100%"}},wt={class:"col-6 q-pa-sm flex flex--column justify-between"},Ct={class:"text-center text-bold text-red-10"},Qt={class:"q-mt-md"},Pt={class:"col"},Vt={class:"text-bold"},$t={key:0,class:"col"},St={class:"text-bold"},qt={key:1,class:"col"},Nt={key:0,class:"col"},zt={key:1,class:"col"},Bt={class:"q-ml-md q-mr-md text-white bg-primary"},It={class:"row q-pt-xs"},xe={__name:"viewCatalogFamily",setup(jt){const S=E();H();const u=lt(),q=nt(),h=R(),k=b({state:!1,val:null}),N=b([]),w=b({pagination:{rowsPerPage:12},filter:""}),f=b({val:null,opts:[{id:1,label:"Agotados"},{id:2,label:"Mayor a 1"},{id:3,label:"Mayor a 25"},{id:4,label:"Mayor a 50"},{id:5,label:"Mayor a 100"}]}),m=b({val:null,opts:[]}),D=G(()=>N.value.filter(a=>{var e;const s=m.value.val?a._category===m.value.val.id:!0;let t=!0;if(f.value.val){const r=(e=a.stocks.reduce((Q,U)=>Q+Number(U.pivot.stock),0))!=null?e:0;switch(f.value.val.id){case 1:t=r===0;break;case 2:t=r>1;break;case 3:t=r>25;break;case 4:t=r>50;break;case 5:t=r>100;break}}return s&&t})),M=async()=>{q.loading.show({message:"Obteniendo Hijos"}),console.log(S.params.fid);const a={family:S.params.fid,workpoint:h.session.store.id_viz},s=await rt.getFamilysProducts(a);if(s.fail)console.log(s);else{u.setTitle(`Cat\xE1logo ${s.family.name}`),m.value.opts=s.categories;const t=s.family.products.map(e=>({...e,order:0}));if(u.orderState)for(const e of t){const r=u.order.products.find(Q=>Q.id===e.id);r&&(e.pivot=r.pivot)}N.value=t,q.loading.hide()}},F=a=>{k.value.state=!0,k.value.val=a},L=a=>{const s={order:u.order.id,_product:a.id,units:1,price:a.prices.find(t=>t.id==1).pivot.price,total:a.prices.find(t=>t.id==1).pivot.price,amount:1,amountDelivered:0,toDelivered:0,_price_list:1,_supply_by:1};a.pivot={...s},u.pushProduct(a)},O=a=>{a.pivot.amount++,a.pivot.units++,a.pivot.total=a.pivot.amount*a.pivot.price,u.updateProduct(a)},T=a=>{a.pivot.amount--,a.pivot.units--,a.pivot.amount<=0?(delete a.pivot,u.removeProduct(a.id)):(a.pivot.total=a.pivot.amount*a.pivot.price,u.updateProduct(a))};return K(()=>{M()}),(a,s)=>(d(),x(it,{padding:""},{default:i(()=>[o(at,{rows:D.value,"row-key":"id",grid:"",pagination:w.value.pagination,filter:w.value.filter},{top:i(()=>[l("div",dt,[o(B,{modelValue:f.value.val,"onUpdate:modelValue":s[1]||(s[1]=t=>f.value.val=t),options:f.value.opts,label:"Stocks",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:i(()=>[f.value.val!==null?(d(),x(P,{key:0,name:"close",onClick:s[0]||(s[0]=z(t=>f.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):_("",!0)]),_:1},8,["modelValue","options"]),o(B,{modelValue:m.value.val,"onUpdate:modelValue":s[3]||(s[3]=t=>m.value.val=t),options:m.value.opts,"option-label":"name",label:"Categor\xEDas",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:i(()=>[m.value.val!==null?(d(),x(P,{key:0,name:"close",onClick:s[2]||(s[2]=z(t=>m.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):_("",!0)]),_:1},8,["modelValue","options"]),o(Y,{dense:"",debounce:"300",modelValue:w.value.filter,"onUpdate:modelValue":s[4]||(s[4]=t=>w.value.filter=t),placeholder:"Buscar",class:"col-auto",outlined:""},{append:i(()=>[o(P,{name:"search"})]),_:1},8,["modelValue"])])]),item:i(t=>[l("div",ct,[o(A,{flat:"",bordered:""},{default:i(()=>[o(C,{class:"text-center row"},{default:i(()=>[l("div",ut,[s[6]||(s[6]=c(" Codigo: ")),l("span",mt,n(t.row.code),1)]),l("div",vt,[s[7]||(s[7]=c(" CCO: ")),l("span",pt,n(t.row.name),1)]),l("div",ft,[l("div",null,[s[8]||(s[8]=c(" STOCK: ")),l("span",{class:X(["text-bold",t.row.stocks.find(e=>e.id==g(h).session.store.id_viz).pivot.stock<=0?"text-red":""])},n(t.row.stocks.find(e=>e.id==g(h).session.store.id_viz).pivot.stock<=0?"Agotado":t.row.stocks.find(e=>e.id==g(h).session.store.id_viz).pivot.stock),3)]),l("div",gt,[l("div",_t,[c(n(t.row.stocks.find(e=>e.id==1).alias)+" ",1),l("div",kt,n(t.row.stocks.find(e=>e.id==1).pivot.stock),1)]),o(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",bt,[c(n(t.row.stocks.find(e=>e.id==2).alias)+" ",1),l("div",xt,n(t.row.stocks.find(e=>e.id==2).pivot.stock),1)])])])]),_:2},1024),o(y),o(C,{class:"row items-stretch",tyle:"min-height: 260px;"},{default:i(()=>[t.row.imgcover?(d(),v("div",{key:0,class:"col-6 flex flex-center bg-grey-2",onClick:e=>F(`${g($)}/Products/${t.row.id}/${t.row.imgcover}`),style:{height:"100%"}},[o(V,{src:`${g($)}/Products/${t.row.id}/${t.row.imgcover}`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])],8,yt)):(d(),v("div",ht,[o(V,{src:`${g($)}/Products/sinpicture.png`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])])),l("div",wt,[l("div",Ct,n(t.row.description),1),o(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",Qt,[(d(!0),v(W,null,J(t.row.prices,(e,r)=>(d(),v("div",{key:r},[o(tt,{bordered:"",dense:""},{default:i(()=>[o(et,null,{default:i(()=>[o(ot,null,{default:i(()=>[o(I,{class:"text-center text-bold"},{default:i(()=>[c(n(e.name),1)]),_:2},1024),o(I,{class:"text-center"},{default:i(()=>[c("$ "+n(e.pivot.price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),o(y,{spaced:"",inset:"",vertical:"",dark:""})])]),_:2},1024),o(y),o(C,{class:"text-center row"},{default:i(()=>[l("div",Pt,[s[9]||(s[9]=c(" Piezas X Caja: ")),l("span",Vt,n(t.row.pieces),1)]),t.row.large?(d(),v("div",$t,[s[10]||(s[10]=c(" MED: ")),l("span",St,n(t.row.large),1)])):_("",!0),g(u).orderState?(d(),v("div",qt,[t.row.pivot?(d(),v("div",zt,[o(j,{rounded:"",class:"bg-primary"},{default:i(()=>[o(p,{size:"sm",color:"primary",icon:"remove",onClick:e=>T(t.row)},null,8,["onClick"]),l("div",Bt,n(t.row.pivot.amount),1),o(p,{size:"sm",color:"primary",icon:"add",onClick:e=>O(t.row)},null,8,["onClick"])]),_:2},1024)])):(d(),v("div",Nt,[o(p,{color:t.row.stocks.reduce((e,r)=>e+Number(r.pivot.stock),0)<=0?"negative":"primary",rounded:"",label:t.row.stocks.reduce((e,r)=>e+Number(r.pivot.stock),0)<=0?"Agotado":"Agregar",onClick:e=>L(t.row),size:"sm",disable:t.row.stocks.reduce((e,r)=>e+Number(r.pivot.stock),0)<=0},null,8,["color","label","onClick","disable"])]))])):_("",!0)]),_:2},1024)]),_:2},1024)])]),bottom:i(t=>[o(st,{position:"bottom",class:"full-width",offset:[0,18]},{default:i(()=>[l("div",It,[o(j,{rounded:"",class:""},{default:i(()=>[t.pagesNumber>2?(d(),x(p,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):_("",!0),o(p,{icon:"chevron_left",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),o(p,{flat:"",disable:"","no-caps":""},{default:i(()=>[c(n(t.pagination.page)+" / "+n(t.pagesNumber),1)]),_:2},1024),o(p,{icon:"chevron_right",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),t.pagesNumber>2?(d(),x(p,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:t.lastPage,class:"q-px-sm"},null,8,["onClick"])):_("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","pagination","filter"]),o(Z,{modelValue:k.value.state,"onUpdate:modelValue":s[5]||(s[5]=t=>k.value.state=t)},{default:i(()=>[o(A,{flat:"",class:"bg-transparent",style:{width:"700px","max-width":"80vw"}},{default:i(()=>[o(C,{class:"flex flex-center"},{default:i(()=>[o(V,{src:k.value.val,"spinner-color":"primary",style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{xe as default};
