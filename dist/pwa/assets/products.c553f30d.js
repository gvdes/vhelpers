import{r as b,o as u,i as w,a0 as G,$ as H,e as l,a1 as Q,g as s,j as v,u as ve,J as me,q as fe,O as ge,d as E,w as a,f as C,bE as _e,k as V,Y as q,bi as be,Q as L,h as we,ae as xe,_ as p,a2 as M,b7 as ye,aV as ee,a3 as j}from"./index.504c35c2.js";import{Q as K,a as $,q as ke}from"./QSelect.4aa8ea70.js";import{Q as z,a as Y,b as R}from"./QList.0ff006d5.js";import{Q as he}from"./QBtnGroup.8b2967b8.js";import{Q as Ce}from"./QPageSticky.0743149c.js";import{Q as Pe}from"./QTable.1aa507cd.js";import{Q as Ve}from"./QPage.7e16f176.js";import{C as te}from"./ClosePopup.677ccf58.js";import"./QExpansionItem.500c9e37.js";import"./QDrawer.c15a4823.js";import"./axios.4a57e5be.js";import{u as Qe}from"./use-quasar.67494b23.js";import{P as Fe,d as Ne}from"./ProductsAutocomplete.d4dfa6c6.js";import{_ as Se}from"./OptionsLabels.6a6b8fe1.js";import{l as le}from"./locationsApi.4e7b17c5.js";import{E as Ee}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.31def0a3.js";import"./dayjs.min.cbcf888d.js";import"./QLinearProgress.81f26e11.js";import"./QResizeObserver.9bc3b086.js";import"./QScrollObserver.e07350e2.js";/* empty css                                                                         */import"./QImg.88dbb69d.js";import"./labels.f18c7f38.js";import"./_commonjsHelpers.88e99c8f.js";const qe={class:"text-right"},Ae={__name:"selectsLocations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(W,{emit:F}){const m=W,n=F,A=f=>m.sections.filter(_=>_.root===f),x=b([{options:m.sections.filter(f=>f.root===0),selected:null}]),I=(f,_)=>{x.value.splice(_+1);const g=A(f);g.length&&x.value.push({options:g,selected:null})},h=()=>{const f=x.value.filter(g=>g.selected!==null),_=f[f.length-1];n("obtProducts",_)};return(f,_)=>(u(),w("div",null,[(u(!0),w(G,null,H(x.value,(g,k)=>(u(),w("div",{key:k},[l(K,{modelValue:g.selected,"onUpdate:modelValue":[N=>g.selected=N,N=>I(N,k)],options:g.options,label:`Nivel ${k+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),l(Q,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),s("div",qe,[l(v,{flat:"",icon:"send",disable:!x.value[0].selected,onClick:h},null,8,["disable"])])]))}},Ie={class:"text-center"},Ue={class:"row text-center"},De={key:0,class:"col"},Oe={class:"row"},$e={class:"row"},Be={key:0,class:"col"},Te={key:1,class:"col"},Le={key:0,class:"row"},Re={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ge={class:"text-h5 text-bold text-center"},He={class:"text-subtitle2 text-bold text-center"},Je={class:"text-subtitle2 text-bold text-center"},Me={class:"text-subtitle2 text-bold text-center"},je={class:"text-subtitle2 text-bold text-center"},ze={class:"row"},Ye={class:"text-center"},Ke={class:"text-center"},We={class:"text-bold q-pb-sm text-center"},Xe={class:"row q-pt-xs"},Ze={class:"text-negative"},Qt={__name:"products",setup(W){const F=ve(),m=Qe(),n=b([]),A=b([]),x=b(null),I=b(!1),h=b({val:{id:1,label:"Productos"},opts:[{id:1,label:"Productos"},{id:2,label:"Ubicacion"}]}),f=b({filter:"",pagination:{rowsPerPage:9}}),_=b({state:!1}),g=b({state:!1}),k=b({val:[0,1,2,4],opts:[{label:"Menudeo",value:1},{label:"Mayoreo",value:2},{label:"Docena",value:3},{label:"Caja",value:4}]}),N=b(null),c=b({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[]}),X=o=>{let t=[],e=[],i=new Object;return o.products.map(d=>oe(d.prices)?t.push(d):e.push(d)),console.log(o),i.notFound=t,i.add=e,i},oe=o=>{let t=!0;return o.map((e,i)=>{t=e.pivot.price==0}),t},ae=o=>{console.log(o);let t=n.value.findIndex(e=>e.id==o.id);if(console.log(t),t>=0)n.value[t]._copies++;else{let e=B(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,n.value.push(o),console.log(o)}},se=o=>{console.log(o);let t=n.value.findIndex(e=>e.id==o.id);if(console.log(t),t>=0)n.value[t]._copies++;else{let e=B(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,n.value.push(o),console.log(o)}},ie=o=>{let t=n.value.findIndex(e=>e.id==o.id);n.value.splice(t,1)},ne=()=>{n.value=[],_.value.state=!1},de=()=>{N.value.click()},re=async()=>{let o=document.getElementById("inputFile").files[0],t=new Ee.Workbook,e=[],i=[],d=0;t.xlsx.load(o).then(r=>{if(t.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(P,S){P.value&&e.push(P.value)}),i=e.filter((P,S,O)=>O.indexOf(P)==S),e.length){let P={codes:e,_workpoint:F.session.store.id_viz};console.log(P),m.loading.show({message:"Procesando archivo, espera.."}),Ne.getMassive(P).then(S=>{let O=S.data,J=0,T=X(O);if(O.fails.notFound.map(y=>c.value.wndNotExist.push(y)),c.value.wndGetRows=T.add.length,c.value.state=!c.value.state,c.value.wndGetAdded=T.add,c.value.wndNoDataFound=T.notFound,c.value.wndNoDataFound.length>0){let y=c.value.wndNoDataFound.length;c.value.message=y<=1?"El producto no contiene precios.":"Los productos no contienen precios."}T.add.map(y=>{let Z=B(y.prices,y.pieces);y._copies=1,y.type=Z.type,y.usedPrices=Z.prices,n.value.push(y),J++}),J&&!O.fails.notFound.length&&i.length==e.length?m.notify({message:`Etiquetas generadas: ${J}`,color:"positive",icon:"done",timeout:1e3}):(d=e.length-i.length,c.value.messageRepeat=d<=1?`${d} producto se repitio. Favor de validar su documento antes de subirlo.`:`${d} productos se repitieron. Favor de validar su documento antes de subirlo.`),console.log(c.value),m.loading.hide()}).catch(S=>{console.log(S),m.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else m.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},B=(o,t)=>{let e=[...o];e.sort((r,U)=>r.pivot._type-U.pivot._type),console.log(e);const i=e.find(r=>r.pivot._type==4),d=e.find(r=>r.pivot._type==1);if(i.pivot.price==d.pivot.price){let r={id:0,alias:"OFERTA",name:"Oferta",pivot:{price:e[0].pivot.price},used:!0};return console.log("oferta"),{type:"off",prices:[r]}}else return console.log("estandar"),{type:"std",prices:e}},ue=o=>{switch(o){case"off":return"orange-9";case"std":return"green-9"}},ce=async()=>{if(h.value.val.id==2){m.loading.show({message:"Obteniendo Secciones"});let o={_rol:F.session.credentials._rol,_workpoint:F.session.store.id_viz};console.log(o);const t=await le.index(o);t.fail?console.log(t):(console.log(t),A.value=t),m.loading.hide()}},pe=async o=>{m.loading.show({message:"Obteniendo Productos"});let t={section:o.selected,workpoint:F.session.store.id_viz,update:I.value};const e=await le.obtProductSections(t);if(e.fail)console.log(e);else{console.log(e);let i={products:e};i.products.length>0?(X(i).add.map(r=>{let U=n.value.findIndex(D=>D.id==r.id);if(U>=0)n.value[U]._copies++;else{let D=B(r.prices,r.pieces);r._copies=1,r.type=D.type,r.usedPrices=D.prices,n.value.push(r)}}),m.loading.hide()):(m.loading.hide(),m.notify({message:"No Hay Articulos Ubicados x(",type:"negative",position:"center",icon:"mood_bad"}))}};return me(()=>n.value,o=>{localStorage.setItem("applabels",JSON.stringify(o))},{deep:!0}),fe(()=>{const o=localStorage.getItem("applabels");o&&(n.value=JSON.parse(o))}),ge(()=>{}),(o,t)=>(u(),E(Ve,{padding:""},{default:a(()=>[l(L,{class:"my-card"},{default:a(()=>[l(C,null,{default:a(()=>[s("div",Ie,[t[10]||(t[10]=s("div",{class:"text-bold"},"Selecciona los Precios",-1)),l(_e,{options:k.value.opts,type:"toggle",modelValue:k.value.val,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value.val=e),inline:""},null,8,["options","modelValue"])]),s("div",Ue,[l(v,{class:"col",outline:"",color:"primary",icon:"upload_file",title:"Subir Etiquetas",onClick:de}),l(Q,{spaced:"",inset:"",vertical:"",dark:""}),n.value.length>0?(u(),w("div",De,[s("div",Oe,[l(v,{class:"col",outline:"",color:"primary",icon:"delete",title:"Eliminar Etiquetas",onClick:t[1]||(t[1]=e=>_.value.state=!_.value.state)}),l(Q,{spaced:"",inset:"",vertical:"",dark:""}),l(v,{class:"col",outline:"",color:"primary",icon:"download",title:"Descargar Etquetas",onClick:t[2]||(t[2]=e=>g.value.state=!g.value.state)})])])):V("",!0)]),s("input",{type:"file",ref_key:"inputFile",ref:N,id:"inputFile",onInput:re,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}),l(C,null,{default:a(()=>[s("div",$e,[l(K,{style:{width:"80px"},modelValue:h.value.val,"onUpdate:modelValue":[t[3]||(t[3]=e=>h.value.val=e),ce],options:h.value.opts,filled:"",dense:"","hide-dropdown-icon":""},null,8,["modelValue","options"]),l(Q,{spaced:"",inset:"",vertical:"",dark:""}),h.value.val.id==1?(u(),w("div",Be,[l(Fe,{onInput:ae,onAgregar:se,with_prices:"",withHistoric:""})])):V("",!0),h.value.val.id==2?(u(),w("div",Te,[A.value.length>0?(u(),w("div",Le,[l(z,{dense:""},{default:a(()=>[l(Y,null,{default:a(()=>[l(R,null,{default:a(()=>[l($,{caption:""},{default:a(()=>t[11]||(t[11]=[q("ACT HOY")])),_:1}),l($,{class:"flex flex-center"},{default:a(()=>[l(be,{dense:"",modelValue:I.value,"onUpdate:modelValue":t[4]||(t[4]=e=>I.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(K,{class:"col",modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=e=>x.value=e),options:A.value,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),l(Q,{spaced:"",inset:"",vertical:"",dark:""}),x.value?(u(),E(Ae,{key:0,class:"col",sections:x.value.sections,onObtProducts:pe},null,8,["sections"])):V("",!0)])):V("",!0)])):V("",!0)])]),_:1})]),_:1}),l(Q,{spaced:"",inset:"",vertical:"",dark:""}),l(Pe,{rows:n.value,"row-key":"name",grid:"",filter:f.value.filter,pagination:f.value.pagination,"no-data-label":"''"},{"top-right":a(()=>[l(we,{borderless:"",dense:"",debounce:"300",modelValue:f.value.filter,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value.filter=e),placeholder:"Buscar"},{append:a(()=>[l(xe,{name:"search"})]),_:1},8,["modelValue"])]),item:a(e=>[s("div",Re,[l(L,{class:"my-card"},{default:a(()=>[l(C,null,{default:a(()=>{var i;return[l(ke,{size:"sm",class:"fixed-right absolute-right text-bold text-white text-uppercase",color:ue(e.row.type)},{default:a(()=>[q(p(e.row.type),1)]),_:2},1032,["color"]),s("div",Ge,p(e.row.code),1),s("div",He,p(e.row.name),1),s("div",Je,p(e.row.label),1),s("div",Me,"Longitud: "+p(e.row.large),1),s("div",je,"Ubicacion: "+p((i=e.row.locations)==null?void 0:i.map(d=>d.path).join("/")),1),l(Q,{spaced:"",inset:"",vertical:"",dark:""}),s("div",ze,[(u(!0),w(G,null,H(e.row.usedPrices.filter(d=>k.value.val.includes(d.id)),(d,r)=>(u(),w("div",{class:"col items-start",key:r},[s("div",Ye,p(d.alias),1),s("div",Ke,p(d.pivot.price),1)]))),128))])]}),_:2},1024),l(M,{align:"center"},{default:a(()=>[l(v,{flat:"",icon:"delete",color:"negative",onClick:i=>ie(e.row)},null,8,["onClick"]),l(v,{flat:"",icon:"add",onClick:i=>e.row._copies++},null,8,["onClick"]),s("div",null,[t[12]||(t[12]=s("div",{class:"text-caption text--2"},"copias",-1)),s("div",We,p(e.row._copies),1)]),l(v,{flat:"",icon:"remove",onClick:i=>e.row._copies<=1?"":e.row._copies--},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),bottom:a(e=>[l(Ce,{position:"bottom",class:"full-width",offset:[0,18]},{default:a(()=>[s("div",Xe,[l(he,{rounded:"",flat:"",color:"primary"},{default:a(()=>[e.pagesNumber>2?(u(),E(v,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):V("",!0),l(v,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),l(v,{flat:"",disable:"","no-caps":""},{default:a(()=>[q(p(e.pagination.page)+" / "+p(e.pagesNumber),1)]),_:2},1024),l(v,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(u(),E(v,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):V("",!0)]),_:2},1024)])]),_:2},1024)]),"no-data":a(()=>t[13]||(t[13]=[])),_:1},8,["rows","filter","pagination"]),l(j,{modelValue:_.value.state,"onUpdate:modelValue":t[7]||(t[7]=e=>_.value.state=e),persistent:""},{default:a(()=>[l(L,null,{default:a(()=>[l(C,{class:"row items-center"},{default:a(()=>[l(ye,{icon:"warning",color:"white","text-color":"negative"}),t[14]||(t[14]=s("div",{class:"q-ml-sm"},"Se eliminaran todos los articulos de la lista ",-1))]),_:1}),l(C,null,{default:a(()=>t[15]||(t[15]=[s("div",{class:"q-ml-sm"},"Deseas Continuar?",-1)])),_:1}),l(M,{align:"right"},{default:a(()=>[ee(l(v,{flat:"",label:"No",color:"positive"},null,512),[[te]]),l(v,{flat:"",label:"Si",color:"negative",onClick:ne})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(j,{modelValue:g.value.state,"onUpdate:modelValue":t[8]||(t[8]=e=>g.value.state=e),persistent:""},{default:a(()=>[l(Se,{products:n.value,prices:k.value},null,8,["products","prices"])]),_:1},8,["modelValue"]),l(j,{modelValue:c.value.state,"onUpdate:modelValue":t[9]||(t[9]=e=>c.value.state=e)},{default:a(()=>[l(L,{class:"my-card",style:{width:"70%"}},{default:a(()=>[l(C,{class:"items-center"},{default:a(()=>[t[16]||(t[16]=s("div",{class:"text-center text-bold"},"Repetidos",-1)),s("div",Ze,p(c.value.messageRepeat),1)]),_:1}),l(C,null,{default:a(()=>[t[17]||(t[17]=s("div",{class:"text-center"},"Productos Sin Precio",-1)),l(z,null,{default:a(()=>[(u(!0),w(G,null,H(c.value.wndNoDataFound,(e,i)=>(u(),E(Y,{key:i},{default:a(()=>[l(R,null,{default:a(()=>[l($,{overline:""},{default:a(()=>[q(p(e.code),1)]),_:2},1024)]),_:2},1024),l(R,null,{default:a(()=>[l($,{caption:""},{default:a(()=>[q(p(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(C,null,{default:a(()=>[t[18]||(t[18]=s("div",{class:"text-center"},"Productos Sin Existencia",-1)),l(z,null,{default:a(()=>[(u(!0),w(G,null,H(c.value.wndNotExist,(e,i)=>(u(),E(Y,{key:i},{default:a(()=>[l(R,null,{default:a(()=>[l($,{overline:""},{default:a(()=>[q(p(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(M,{align:"right"},{default:a(()=>[ee(l(v,{flat:"",label:"OK",color:"primary"},null,512),[[te]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Qt as default};
