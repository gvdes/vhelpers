import{Q as y}from"./QInput.ef270ff5.js";import{Q as k}from"./QForm.0205099a.js";import{a as h,d as L}from"./QSelect.7c53d595.js";import{Q as S,a as N,e as A,d as F}from"./QList.74ccfe08.js";import{Q as T}from"./QTable.6da12024.js";import{Q as U}from"./QPage.73b9b0ac.js";import{aI as M,a as j,u as z,r as p,c as G,o as V,g as H,e,w as o,a3 as O,f as d,a4 as P,d as Y,al as c,a0 as m,a1 as J,am as K,Q as f,an as W}from"./index.b909a2e6.js";import{Q as v}from"./QCardSection.93c12370.js";import{Q as $}from"./QCardActions.828cc799.js";import{Q as C}from"./QCard.dd1c31ca.js";import{C as X}from"./ClosePopup.5c8b78f8.js";import"./dayjs.min.cbcf888d.js";import{R as _}from"./RestockApi.88cf4473.js";import{u as Z}from"./Restock.9ae54737.js";import{u as tt}from"./use-quasar.c4dba85c.js";import{$sktRestock as B}from"./socket.05630e21.js";import{_ as et}from"./PrinterSelect.39ca7229.js";import"./use-key-composition.2d6f7b01.js";import"./QLinearProgress.b83c9a29.js";import"./QCheckbox.6ac6cb3a.js";import"./use-checkbox.3c878e53.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.af1ce7ca.js";import"./QToolbar.04972804.js";import"./QRadio.76e98d70.js";import"./QTd.ab629733.js";import"./QPopupEdit.293d843b.js";import"./QTr.f4d443d1.js";import"./QLayout.ffb03572.js";import"./QScrollObserver.f8596932.js";import"./QResizeObserver.18272573.js";import"./QDrawer.0f50d500.js";import"./QExpansionItem.a370d70a.js";import"./jspdf.plugin.autotable.d01f28de.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */import"./QBtnGroup.7a839392.js";const ot={class:"flex justify-center"},at={class:"text-center",style:"width: 50%;"},it={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},st={class:"text-bold"},lt={class:"q-mx-sm text-h6"},Ot={__name:"checkin",setup(rt){M();const I=j(),u=Z(),l=tt(),x=z(),r=p(null),q=p({rowsPerPage:[0]}),s=p({state:!1,val:null}),n=p({state:!1,val:null,opts:["GEN","EMP"]}),w=G(()=>u.partitions.filter(i=>i._status==8&&i.requisition._workpoint_from==x.session.store.id_viz)),E=async()=>{u.setShowLYT(!0),u.setTitle("Validacion"),u.setButtonShow(!1),u.setButtonShowAdd(!1)},R=async i=>{l.loading.show({message:"..."}),console.log(i.ip),console.log(s.value);const t=await _.printForPartition({ip:i.ip,port:i._port,_partition:s.value.val.id,_workpoint_to:s.value.val._workpoint_to});console.log(t),t.status==200?(t.data?l.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):l.notify({message:`Sin conexion a <b>${i.name} <small>(${i.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),l.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},Q=()=>{s.value.val&&(r.value=s.value.val.id),console.log(r.value);let i=w.value.findIndex(t=>t.id==r.value);console.log(i),i>=0?n.value.state=!0:(l.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),r.value=null)},D=async()=>{l.loading.show({message:"Cambiando Estado"});let i={partition:r.value,verified:x.session.credentials.staff.id,state:9,key:n.value.val};console.log(i);let t=await _.saveCheck(i);if(console.log(t),t.status==200){let a=u.partitions.findIndex(g=>g.id==t.data.partition.id);if(a>=0){if(u.partitions.splice(a,1,t.data.partition),t.data.partitionsEnd>t.data.partition.requisition._status){let g={id:t.data.partition._requisition,state:t.data.partitionsEnd};const b=await _.nextState(g);B.emit("order_refresh",{order:b.data}),console.log(b.data)}B.emit("orderpartition_refresh",{order:t.data.partition})}r.value=null,I.push(`/distribute/checkin/${t.data.partition.id}/?key=${t.data.partition.entry_key}`),l.loading.hide()}else t.status==401?(alert(t.response.data.message),console.log(t.response.data.message),l.loading.hide()):alert(`Error ${t.status}: ${t.response.data} `)};return E(),(i,t)=>(V(),H(O,null,[e(U,{padding:""},{default:o(()=>[d("div",null,[d("div",ot,[d("div",at,[e(k,{onSubmit:Q},{default:o(()=>[e(y,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),e(T,{rows:w.value,"row-key":"name",grid:"",pagination:q.value,"hide-bottom":""},{item:o(a=>[d("div",it,[e(N,{bordered:""},{default:o(()=>[P((V(),Y(F,{clickable:"",onClick:()=>{s.value.state=!0,s.value.val=a.row}},{default:o(()=>[e(A,null,{default:o(()=>[e(h,{class:"text-center text-bold"},{default:o(()=>[c(m(a.row.id),1)]),_:2},1024),e(h,{class:"text-center text-overline text-caption"},{default:o(()=>[d("span",st,m(a.row.requisition.from.name),1),c(" (P: "+m(a.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[W]])]),_:2},1024)])]),_:1},8,["rows","pagination"])])]),_:1}),e(S,{modelValue:n.value.state,"onUpdate:modelValue":t[3]||(t[3]=a=>n.value.state=a)},{default:o(()=>[e(C,null,{default:o(()=>[e(k,{onSubmit:t[2]||(t[2]=()=>{n.value.val?D():J(l).notify({message:"necesito la llave :x",type:"negative",position:"center"})})},{default:o(()=>[e(v,{class:"row items-center"},{default:o(()=>[e(K,{icon:"warning",color:"orange-14","text-color":"white"}),d("span",lt,"Iniciar CheckOut #"+m(r.value),1)]),_:1}),e(v,null,{default:o(()=>[e(y,{modelValue:n.value.val,"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.val=a),filled:"",type:"text",label:"LLave","auto-focus":""},null,8,["modelValue"])]),_:1}),e($,{vertical:"",align:"center"},{default:o(()=>[e(f,{flat:"",label:"Si",color:"primary",type:"submit",disable:n.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(S,{modelValue:s.value.state,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.state=a),persistent:""},{default:o(()=>[e(C,null,{default:o(()=>[e(v,{class:"text-bold text-h5 items-center"},{default:o(()=>[c(" Particion "+m(s.value.val.id),1)]),_:1}),e(v,{class:"text-center"},{default:o(()=>t[5]||(t[5]=[c(" Que Desesas Hacer ? ")])),_:1}),e($,{align:"center"},{default:o(()=>[P(e(f,{flat:"",icon:"close",color:"negative"},null,512),[[X]]),e(f,{flat:"",icon:"print",color:"primary"},{default:o(()=>[e(L,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:o(()=>[e(et,{onSelectedPartition:R,partition:!0})]),_:1})]),_:1}),e(f,{flat:"",icon:"send",color:"positive",onClick:Q})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ot as default};
