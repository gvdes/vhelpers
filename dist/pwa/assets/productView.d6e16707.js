import{a as z,Q as L}from"./QSelect.32f0280a.js";import{a as S,d as y,e as u,b as m}from"./QList.07d01330.js";import{Q as B}from"./QCardSection.1b402229.js";import{u as M,a as O,aH as T,c as k,l as $,p as F,o as v,d as g,w as d,e,f as s,a0 as a,g as w,a3 as D,a2 as q,ak as r,an as A,Q as b,a4 as H,b9 as G,h as _}from"./index.44dd17ce.js";import{Q as J}from"./QInput.fdac79bb.js";import{Q as K}from"./QSpace.1bc90227.js";import{Q as W}from"./QCardActions.bb5ccb52.js";import{Q as X}from"./QCard.9a73268d.js";import{u as Y}from"./use-quasar.c133d20e.js";import{o as C}from"./orderApi.a3ff8a23.js";import{R as P}from"./resoursesOrder.ff7d471f.js";const Z={class:"row"},tt={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},et={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},ot={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},lt={class:"row"},it={class:"text-h6 col text-bold text-left"},dt={class:"text-h6 col text-bold text-right"},st={class:"text-subtitle2 col"},at={class:"item-center row"},rt={class:"row items-end"},ct={class:"text-center"},ut={class:"col q-pa-xs"},nt={class:"col column q-py-md"},pt={class:"col q-pa-xs"},_t={__name:"productView",props:{product:{type:Object,default:{}},order:{type:Object,default:{}},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]},units:{type:Array,default:[]},unit:{type:Object,default:{}}},emits:["reset","addProduct","deleteProduct"],setup(l,{emit:N}){M();const f=Y();O(),T();const t=l,Q=N,h=k(()=>!t.product.pivot.amount||t.product.pivot.amount<=0),n=k(()=>t.product.pivot._supply_by==3?t.product.pivot.amount*t.product.pieces:t.product.pivot._supply_by==2?t.product.pivot.amount*12:t.product.pivot.amount),U=()=>{t.product.pivot._supply_by=t.product.units.id},j=k(()=>t.order.client._price_list<=3?[1,2,3,4]:[t.order.client._price_list]),p=k(()=>t.order.client._price_list<=3?n.value>=t.product.pieces&&(t.product.pivot._supply_by==1||t.product.pivot._supply_by==2)||t.product.pivot._supply_by==3?4:P.verificarPrecioDocena(t.products,t.product,t.rules)?3:P.verificarPrecioMayoreo(t.products,t.product,t.rules)?2:1:t.order.client._price_list),V=()=>{Q("reset")},I=async()=>{f.loading.show({message:"Editando Producto"});let c=t.product.prices.find(x=>x.id==p.value).pivot.price,i=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=p.value,t.product.pivot.price=c,t.product.pivot.total=i,console.log(t.product.pivot);const o=await C.editProduct(t.product.pivot);o.fail?console.log(o):(f.loading.hide(),V(),P.actualizarPreciosProductos(t.products,t.order,t.rules))},R=async()=>{f.loading.show({message:"Agregando producto"});let c=t.product.prices.find(x=>x.id==p.value).pivot.price,i=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=p.value,t.product.pivot.price=c,t.product.pivot.total=i,t.product.pivot._product=t.product.id,t.product.pivot._order=t.order.id,console.log(t.product.pivot);const o=await C.addProduct(t.product.pivot);o.fail?console.log(o):(Q("addProduct",t.product),f.loading.hide(),P.actualizarPreciosProductos(t.products,t.order,t.rules))},E=async()=>{f.loading.show({message:"Eliminando Producto"});const c=await C.deleteProduct(t.product.pivot);c.fail?console.log(c):(Q("deleteProduct",t.product),f.loading.hide(),P.actualizarPreciosProductos(t.products,t.order,t.rules))};return $(n,c=>{t.product.pivot.units=c},t.product.units),F(()=>{!t.product.pivot._supply_by&&t.units.length&&(t.product.pivot._supply_by=t.product.units),t.product.pivot.amount||(t.product.pivot.amount=1),t.product.pivot.units=n.value}),(c,i)=>(v(),g(X,null,{default:d(()=>[e(B,{class:"item-center"},{default:d(()=>[s("div",Z,[s("div",tt,a(l.product.category.familia.seccion.name),1),s("div",et,a(l.product.category.familia.name),1),s("div",ot,a(l.product.category.name),1)]),s("div",lt,[s("div",it,a(l.product.code),1),s("div",dt,a(l.product.name),1)]),s("div",st,a(l.product.description),1),e(S,{class:"q-mt-md q-mb-md"},{default:d(()=>[e(y,null,{default:d(()=>[(v(!0),w(D,null,q(l.product.stocks,(o,x)=>(v(),g(u,null,{default:d(()=>[e(z,{caption:"",class:"text-center"},{default:d(()=>[r(a(o.alias),1)]),_:2},1024),e(z,{overline:"",class:"text-center"},{default:d(()=>[r(a(o.pivot.stock),1)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1}),s("div",at,[(v(!0),w(D,null,q(l.product.prices.filter(o=>j.value.includes(o.id)),(o,x)=>(v(),w("div",{class:"col text-subtitle2 text-center",key:x},[s("div",{class:A(o.id==p.value?"text-weight-bold":"text-caption text-strike")},a(o.alias),3),e(m,{spaced:"",inset:"",vertical:"",dark:""}),s("div",{class:A(o.id==p.value?"text-bold  text-blue-13":"text-caption")},a(o.pivot.price),3),e(m,{spaced:"",inset:"",vertical:"",dark:""})]))),128))])]),_:1}),e(B,null,{default:d(()=>[s("div",rt,[s("div",ct,[s("div",ut,[i[5]||(i[5]=s("div",{class:"text-bold text-h6"},"Cantidad:",-1)),e(b,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:i[0]||(i[0]=o=>l.product.pivot.amount++)}),e(m,{spaced:"",inset:"",vertical:"",dark:""}),s("div",nt,[H(s("input",{type:"number",min:"1","onUpdate:modelValue":i[1]||(i[1]=o=>l.product.pivot.amount=o),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[G,l.product.pivot.amount]])]),e(m,{spaced:"",inset:"",vertical:"",dark:""}),e(b,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:i[2]||(i[2]=o=>l.product.pivot.amount>1?l.product.pivot.amount--:"")})])]),e(m,{spaced:"",inset:"",vertical:"",dark:""}),s("div",pt,[e(L,{dense:"",filled:"",modelValue:l.product.units,"onUpdate:modelValue":[i[3]||(i[3]=o=>l.product.units=o),U],options:l.units,label:"Surtir por","option-label":"name"},null,8,["modelValue","options"]),e(m,{spaced:"",inset:"",vertical:"",dark:""}),e(J,{dense:"",filled:"",modelValue:l.product.pivot.comments,"onUpdate:modelValue":i[4]||(i[4]=o=>l.product.pivot.comments=o),type:"text",label:"Notas"},null,8,["modelValue"]),e(m,{spaced:"",inset:"",vertical:"",dark:""}),e(S,{dense:""},{default:d(()=>[e(y,{class:"bg-grey-11"},{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>i[6]||(i[6]=[r("P x C")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[r(a(l.product.pieces)+" pzs",1)]),_:1})]),_:1}),e(y,null,{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>i[7]||(i[7]=[r("Cajas")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[r(a(Number(n.value/l.product.pieces).toFixed(1)),1)]),_:1})]),_:1}),e(y,{class:"bg-grey-11"},{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>i[8]||(i[8]=[r("Unidades")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[r(a(n.value)+" pzs",1)]),_:1})]),_:1}),e(y,null,{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>i[9]||(i[9]=[r("Precio")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[r(a(l.product.prices.find(o=>o.id==p.value).pivot.price),1)]),_:1})]),_:1}),e(y,null,{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>i[10]||(i[10]=[r("Total")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[r(a(l.product.prices.find(o=>o.id==p.value).pivot.price*n.value),1)]),_:1})]),_:1})]),_:1})])])]),_:1}),e(W,null,{default:d(()=>[e(b,{flat:"",icon:"close",onClick:V}),e(K),l.edit?_("",!0):(v(),g(b,{key:0,flat:"",icon:"add",color:"positive",onClick:R,disable:h.value},null,8,["disable"])),l.edit?(v(),g(b,{key:1,flat:"",icon:"delete",color:"negative",onClick:E})):_("",!0),l.edit?(v(),g(b,{key:2,flat:"",icon:"edit",color:"warning",onClick:I,disable:h.value},null,8,["disable"])):_("",!0)]),_:1})]),_:1}))}};export{_t as _};
