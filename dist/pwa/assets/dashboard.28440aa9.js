import{Q as Le}from"./QDate.aa2035a0.js";import{a as E,Q as X}from"./QCard.ed8a4ec3.js";import{i as fe,aR as je,aS as qe,j as H,c as q,U as Oe,l as Ae,T as Fe,r as b,q as Ye,p as He,aY as Ge,X as re,ac as Xe,b8 as Je,aL as Ke,aH as Ce,aw as We,o as p,g as $,e,w as t,f as i,a0 as g,a1 as W,h as I,d as j,Q as A,a3 as T,a2 as J,ak as k,S as le,a4 as Z,am as Ze,al as Pe,a as Me,u as Ee,an as et,aA as tt,m as at}from"./index.b88ae616.js";import{Q as ce}from"./QCardActions.f536c2a4.js";import{h as lt,k as ot,b as N,a as ue,d as ee,e as V,Q as K}from"./QList.e1ed14ab.js";import{a as st,b as it,u as ve}from"./axios.baa68d0f.js";import{d as te}from"./dayjs.min.cbcf888d.js";import{u as ge}from"./Restock.d30f9d67.js";import{$sktRestock as Ie}from"./socket.3fae67a0.js";import{Q as me}from"./QInput.02eab578.js";import{Q as oe,a as $e}from"./QTable.1abca458.js";import{Q as ye,a as _e}from"./QTr.a3d16df6.js";import{b as nt,d as ke,a as L}from"./QSelect.ea5bf1f8.js";import{Q as rt}from"./QPage.2e773c38.js";import{R as Y}from"./RestockApi.09d98da7.js";import{Q as dt,a as xe,b as ut,c as he}from"./QTabPanels.574a5b96.js";import{Q as ct}from"./QToggle.407d5140.js";import{Q as mt}from"./QBadge.3e823bda.js";import{C as we}from"./ClosePopup.402ac977.js";import{I as Ve}from"./invoices.9defef1b.js";import"./browser.eff7c919.js";import{_ as De}from"./PrinterSelect.e8b373fe.js";import"./use-render-cache.3aae9b27.js";import"./date.9c66c03d.js";import"./_commonjsHelpers.88e99c8f.js";import"./QLinearProgress.55a95414.js";import"./QCheckbox.7f9d0214.js";import"./QResizeObserver.e371e701.js";import"./touch.9135741d.js";import"./jspdf.plugin.autotable.89953d0c.js";import"./QBtnGroup.48c3e0e0.js";const pt='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var ft=fe({name:"QSpinnerGrid",props:je,setup(o){const{cSize:y,classes:m}=qe(o);return()=>H("svg",{class:m.value,fill:"currentColor",width:y.value,height:y.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:pt})}}),vt=fe({name:"QInnerLoading",props:{...st,...lt,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(o,{slots:y}){const m=Ae(),f=it(o,m.proxy.$q),{transitionProps:_,transitionStyle:w}=ot(o),v=q(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(f.value===!0?" q-inner-loading--dark":"")),r=q(()=>"q-inner-loading__label"+(o.labelClass!==void 0?` ${o.labelClass}`:""));function x(){const h=[H(Fe,{size:o.size,color:o.color})];return o.label!==void 0&&h.push(H("div",{class:r.value,style:o.labelStyle},[o.label])),h}function u(){return o.showing===!0?H("div",{class:v.value,style:w.value},y.default!==void 0?y.default():x()):null}return()=>H(Oe,_.value,u)}});const gt='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var bt=fe({name:"QSpinnerDots",props:je,setup(o){const{cSize:y,classes:m}=qe(o);return()=>H("svg",{class:m.value,fill:"currentColor",width:y.value,height:y.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:gt})}});const Se=XMLHttpRequest,Ne=Se.prototype.open,yt=["top","right","bottom","left"];let pe=[],ae=0;function _t({p:o,pos:y,active:m,horiz:f,reverse:_,dir:w}){let v=1,r=1;return f===!0?(_===!0&&(v=-1),y==="bottom"&&(r=-1),{transform:`translate3d(${v*(o-100)}%,${m?0:r*-200}%,0)`}):(_===!0&&(r=-1),y==="right"&&(v=-1),{transform:`translate3d(${m?0:w*v*-200}%,${r*(o-100)}%,0)`})}function kt(o,y){return typeof y!="number"&&(o<25?y=Math.random()*3+3:o<65?y=Math.random()*3:o<85?y=Math.random()*2:o<99?y=.6:y=0),nt(o+y,0,100)}function xt(o){ae++,pe.push(o),!(ae>1)&&(Se.prototype.open=function(y,m){const f=[],_=()=>{pe.forEach(v=>{(v.hijackFilter.value===null||v.hijackFilter.value(m)===!0)&&(v.start(),f.push(v.stop))})},w=()=>{f.forEach(v=>{v()})};this.addEventListener("loadstart",_,{once:!0}),this.addEventListener("loadend",w,{once:!0}),Ne.apply(this,arguments)})}function ht(o){pe=pe.filter(y=>y.start!==o),ae=Math.max(0,ae-1),ae===0&&(Se.prototype.open=Ne)}var wt=fe({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:o=>yt.includes(o)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(o,{emit:y}){const{proxy:m}=Ae(),f=b(0),_=b(!1),w=b(!0);let v=0,r=null,x;const u=q(()=>`q-loading-bar q-loading-bar--${o.position}`+(o.color!==void 0?` bg-${o.color}`:"")+(w.value===!0?"":" no-transition")),h=q(()=>o.position==="top"||o.position==="bottom"),B=q(()=>h.value===!0?"height":"width"),O=q(()=>{const D=_.value,z=_t({p:f.value,pos:o.position,active:D,horiz:h.value,reverse:m.$q.lang.rtl===!0&&["top","bottom"].includes(o.position)?o.reverse===!1:o.reverse,dir:m.$q.lang.rtl===!0?-1:1});return z[B.value]=o.size,z.opacity=D?1:0,z}),U=q(()=>_.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":f.value}:{"aria-hidden":"true"});function Q(D=300){const z=x;return x=Math.max(0,D)||0,v++,v>1?(z===0&&D>0?P():r!==null&&z>0&&D<=0&&(clearTimeout(r),r=null),v):(r!==null&&clearTimeout(r),y("start"),f.value=0,r=setTimeout(()=>{r=null,w.value=!0,D>0&&P()},_._value===!0?500:1),_._value!==!0&&(_.value=!0,w.value=!1),v)}function S(D){return v>0&&(f.value=kt(f.value,D)),v}function M(){if(v=Math.max(0,v-1),v>0)return v;r!==null&&(clearTimeout(r),r=null),y("stop");const D=()=>{w.value=!0,f.value=100,r=setTimeout(()=>{r=null,_.value=!1},1e3)};return f.value===0?r=setTimeout(D,1):D(),v}function P(){f.value<100&&(r=setTimeout(()=>{r=null,S(),P()},x))}let F;return Ye(()=>{o.skipHijack!==!0&&(F=!0,xt({start:Q,stop:M,hijackFilter:q(()=>o.hijackFilter||null)}))}),He(()=>{r!==null&&clearTimeout(r),F===!0&&ht(Q)}),Object.assign(m,{start:Q,stop:M,increment:S}),()=>H("div",{class:u.value,style:O.value,...U.value})}});const de=b(null),Qe=Ge({isActive:!1},{start:re,stop:re,increment:re,setDefaults:re,install({$q:o,parentApp:y}){if(o.loadingBar=this,this.__installed===!0){o.config.loadingBar!==void 0&&this.setDefaults(o.config.loadingBar);return}const m=b(o.config.loadingBar!==void 0?{...o.config.loadingBar}:{});function f(){Qe.isActive=!0}function _(){Qe.isActive=!1}const w=Xe("q-loading-bar");Je({name:"LoadingBar",devtools:{hide:!0},setup:()=>()=>H(wt,{...m.value,onStart:f,onStop:_,ref:de})},y).mount(w),Object.assign(this,{start(v){de.value.start(v)},stop(){de.value.stop()},increment(){de.value.increment.apply(null,arguments)},setDefaults(v){Ke(v)===!0&&Object.assign(m.value,v)}})}}),Ct={class:"text-h6"},St={class:"q-px-lg text-center"},$t={class:"text-h6"},Vt={class:"text-right"},Dt={class:"text-h6"},Qt={class:"text-center col"},jt={class:"text-h6"},qt={key:0,class:"text-center col"},At={class:"text-h6"},Pt={class:"col row"},Mt={key:1,class:"col"},Et={class:"full-width row items-center"},It={class:"col text-dark"},Nt={class:"text-h6"},Tt={class:"text-bold"},Bt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Ut={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},zt={class:"text-overline text-grey-7"},Rt={key:0},Lt={key:1},Ot={key:0},Ft={key:1},Yt={class:"row"},Ht={key:0,class:"col"},Gt={class:"q-ml-sm text-bold"},Xt={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(o,{emit:y}){const m=ve(),f=ge();Ce();const _=b([]),w=o,v=b({opts:[],val:[],filter:[]});b({opts:null,val:null,filter:null});const r=b(null),x=y,u=b(w.head),h=b(null),B=b(!0),O=b([]),U=b("supliers"),Q=b(null),S=b([]),M=b(!1);b({state:!1}),b({state:!1,key:null});const P=b(null),F=b(!1),D=b({state:!1}),z=b(null),c=b([]),n=b({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,s)=>a+s.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,s)=>a+s.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:l=>l.category.familia.seccion.name,align:"left"},{name:"family",label:"Familia",field:l=>l.category.familia.name,align:"left"},{name:"category",label:"Categoria",field:l=>l.category.name,align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),d=q(()=>S.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));q(()=>Q.value&&(Q.value.id==2||Q.value.id==6)),q(()=>O.value.find(l=>l.id==Q.value.id).pivot),q(()=>P.value.map(l=>l._status).includes(6));const C=async()=>{x("loading"),console.log(u.value.id),B.value=!0;let l=await Y.order(u.value.id);console.log(l),S.value=l.data.order.products,O.value=l.data.order.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),P.value=l.data.order.partition,Q.value=l.data.order.status,h.value=l.data.order,z.value=l.data.order.invoice,_.value=Object.values(l.data.ubicaciones).map(a=>({...a,partition:1})),v.value.opts=f.users,B.value=!1,x("loaded")},se=()=>{D.value.state=!0},ie=()=>{F.value=!0},ne=async()=>{m.loading.show({message:"Cambiando Estado"}),console.log("Iniciando surtido"),x("loading"),M.value=!0;let l=3,a={id:u.value.id,state:l};const s=await Y.nextState(a);if(s.status==200){M.value=!1,m.notify({message:`Surtido iniciado para el pedido  ${u.value.id}`,icon:"done",position:"center",color:"teal"});let G={ubicaciones:_.value,pedido:u.value.id,status:l,_workpoint_to:u.value.to.id,_workpoint_from:u.value.from.id},R=await Y.createParitions(G);console.log(R),R.fail?(console.log(R),alert(`Error ${R.status}: ${R.data} 2`)):(R.forEach(Re=>{Ie.emit("partitionCreate",Re)}),m.loading.hide(),C(),x("fresh",h.value),D.value.state=!1)}else console.log(s),alert(`Error ${s.status}: ${s.data} 1`);x("loaded")},be=async l=>{m.loading.show({message:"..."}),console.log(l);const a=await Y.printForSupply({ip:l.ip,port:l._port,order:u.value.id});console.log(a),a.status==200?(a.data?m.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):m.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),m.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Te=async l=>{m.loading.show({message:"..."}),console.log(l.ip),console.log(r.value);const a=await Y.printForPartition({ip:l.ip,port:l._port,_partition:r.value,_workpoint_to:u.value._workpoint_to});console.log(a),a.status==200?(a.data?m.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):m.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),m.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Be=async()=>{console.log("Eliminando Pedido"),x("loading");let l=100,a={id:u.value.id,state:l};const s=await Y.nextState(a);s.status==200?(F.value=!1,m.notify({message:`Surtido Cancelado para el pedido  ${u.value.id}`,icon:"close",position:"center",color:"negative"}),x("fresh",h.value,!0)):alert(`Error ${s.status}: ${s.data} 1`),x("loaded")},Ue=l=>{console.log(l.id),r.value=l.id},ze=async l=>{console.log(l);const a=await Y.partitionFresh(l.id);console.log(a),a.status==200&&(a.data.order.requisition.from._type!=1?Ve.invoiceFormat(a.data.order):Ve.transferFormat(a.data.order))};return We(()=>c.value=n.value.columns.map(l=>l.name)),C(),(l,a)=>(p(),$(T,null,[e(X,{class:"full-width"},{default:t(()=>[e(E,{class:"row justify-between"},{default:t(()=>[i("div",null,[a[6]||(a[6]=i("div",{class:"text-overline text-grey-7"},"Sucursal",-1)),i("div",Ct,g(u.value.from.alias),1)]),i("div",St,[a[7]||(a[7]=i("div",{class:"text-overline text-grey-7"},"Folio",-1)),i("div",$t,g(u.value.id),1)]),i("div",Vt,[a[8]||(a[8]=i("div",{class:"text-overline text-grey-7"},"Agente",-1)),i("div",Dt,g(u.value.created_by.nick),1)])]),_:1}),e(N),e(E,{class:"row justify-between"},{default:t(()=>[i("div",Qt,[a[9]||(a[9]=i("div",{class:"text-overline text-grey-7"},"Fecha",-1)),i("div",jt,g(W(te)(u.value.updated_at).format("YYYY-MM-DD")),1)]),u.value.notes?(p(),$("div",qt,[a[10]||(a[10]=i("div",{class:"text-overline text-grey-7 col"},"Notas",-1)),i("div",At,g(u.value.notes),1)])):I("",!0),i("div",Pt,[Q.value&&Q.value.id>=2?(p(),j(A,{key:0,size:"md",class:"col",color:"primary",icon:"print",flat:"",dense:""},{default:t(()=>[e(ke,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(De,{onSelected:be,partition:!1})]),_:1})]),_:1})):I("",!0),e(N,{spaced:"",inset:"",vertical:"",dark:""}),Q.value&&Q.value.id==2?(p(),$("div",Mt,[e(A,{size:"12px",class:"full-width",color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:se,flat:""}),e(N,{spaced:"",inset:"",vertical:"",dark:""}),e(A,{size:"12px",class:"full-width",color:"negative",icon:"close",dense:"",label:"Cancelar",onClick:ie,flat:""})])):I("",!0)])]),_:1}),e(N),B.value?(p(),j(E,{key:0,class:"text-center"},{default:t(()=>[e(bt,{size:"50px",color:"purple"})]),_:1})):(p(),$(T,{key:1},[e(N),e(dt,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=s=>U.value=s),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(xe,{name:"log",label:"Log"}),e(xe,{name:"basket",label:"Productos"}),e(xe,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(ut,{modelValue:U.value,"onUpdate:modelValue":a[3]||(a[3]=s=>U.value=s),animated:""},{default:t(()=>[e(he,{name:"log"},{default:t(()=>[e(ue,null,{default:t(()=>[(p(!0),$(T,null,J(O.value,s=>(p(),j(ee,{key:s.id},{default:t(()=>[e(V,{avatar:""},{default:t(()=>[k(g(s.id),1)]),_:2},1024),e(V,null,{default:t(()=>[k(g(s.name),1)]),_:2},1024),e(V,null,{default:t(()=>[k(g(s.pivot.details.responsable),1)]),_:2},1024),e(V,null,{default:t(()=>[k("de "+g(W(te)(s.pivot.created_at).format("h:mm a"))+" a "+g(W(te)(s.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(he,{name:"basket"},{default:t(()=>[S.value.length?(p(),j(oe,{key:0,"row-key":"id",flat:"",rows:S.value,columns:n.value.columns,pagination:n.value.pagination,filter:n.value.filter,"visible-columns":c.value},{top:t(()=>[i("div",Et,[i("div",It,[i("span",Nt,[e(A,{color:"pink-5",icon:"sync",onClick:C,round:"",dense:"",flat:""}),k(" Productos: "+g(S.value.length),1)]),a[11]||(a[11]=k(", ")),i("span",Tt,"Piezas: "+g(d.value),1)]),e(me,{dense:"",modelValue:n.value.filter,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.filter=s),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(N,{spaced:"",inset:"",vertical:"",dark:""}),e(A,{color:"secondary",icon:"fas fa-eye","no-caps":"",flat:""},{default:t(()=>[e(ke,{style:{"min-width":"200px"}},{default:t(()=>[e(ue,null,{default:t(()=>[(p(!0),$(T,null,J(n.value.columns,(s,G)=>Z((p(),j(ee,{tag:"label",key:G},{default:t(()=>[e(V,null,{default:t(()=>[e(L,null,{default:t(()=>[k(g(s.label),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[k(g(s.coldesc),1)]),_:2},1024)]),_:2},1024),e(V,{side:"",top:""},{default:t(()=>[e(ct,{color:"pink-5",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=R=>c.value=R),val:s.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[Ze]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(p(),$("div",Bt,"Nada por aqui"))]),_:1}),e(he,{name:"supliers"},{default:t(()=>[e(oe,{rows:P.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(s=>[i("div",Ut,[e(X,{flat:"",bordered:""},{default:t(()=>[e(E,{class:"text-center"},{default:t(()=>[a[12]||(a[12]=k(" Surtidor ")),a[13]||(a[13]=i("br",null,null,-1)),i("strong",null,g(s.row._suplier),1),e(N,{spaced:"",inset:"",vertical:"",dark:""}),e(le,{name:"print",color:"pink",size:"sm",onClick:G=>Ue(s.row)},{default:t(()=>[e(ke,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(De,{onSelectedPartition:Te,partition:!0})]),_:1})]),_:2},1032,["onClick"]),a[14]||(a[14]=i("br",null,null,-1)),i("div",zt,[e(mt,{color:"primary","text-color":"white",label:s.row.status.name},null,8,["label"])])]),_:2},1024),e(N),e(E,{class:"flex justify-between"},{default:t(()=>[u.value.from._type!=1?(p(),$("div",Rt,a[15]||(a[15]=[i("div",null,"Salida",-1),i("div",null,"Entrada",-1)]))):(p(),$("div",Lt,a[16]||(a[16]=[i("div",null,"Traspaso",-1)]))),a[17]||(a[17]=i("div",null,"Herramientas",-1))]),_:1}),e(N),e(E,{class:"flex justify-between"},{default:t(()=>[u.value.from._type!=1?(p(),$("div",Ot,[i("div",null,g(s.row.invoice),1),i("div",null,g(s.row.invoice_received),1)])):(p(),$("div",Ft,[i("div",null,g(s.row.invoice),1)])),i("div",Yt,[s.row._status>=6?(p(),$("div",Ht,[e(A,{color:"pink",icon:"list",onClick:G=>ze(s.row),flat:""},null,8,["onClick"])])):I("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(K,{modelValue:D.value.state,"onUpdate:modelValue":a[4]||(a[4]=s=>D.value.state=s),persistent:""},{default:t(()=>[e(X,{style:{width:"400px"}},{default:t(()=>[e(E,{class:"row items-center"},{default:t(()=>[e(ue,null,{default:t(()=>[(p(!0),$(T,null,J(_.value,(s,G)=>(p(),j(ee,{key:G},{default:t(()=>[e(V,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md",caption:""},{default:t(()=>a[18]||(a[18]=[k("Ubicaciones")])),_:1}),e(L,null,{default:t(()=>[k(g(s.name),1)]),_:2},1024)]),_:2},1024),e(V,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md text-center",caption:""},{default:t(()=>a[19]||(a[19]=[k("Productos")])),_:1}),e(L,{class:"text-center"},{default:t(()=>[k(g(s.cantidad),1)]),_:2},1024)]),_:2},1024),e(V,{class:"q-mt-md"},{default:t(()=>[e(L,{class:"text-center",caption:""},{default:t(()=>a[20]||(a[20]=[k("Particiones")])),_:1}),e(L,{class:"q-mb-sm text-center"},{default:t(()=>[e(me,{modelValue:s.partition,"onUpdate:modelValue":R=>s.partition=R,type:"number",dense:"",filled:"","input-class":"text-center",min:1,error:s.partition==0||s.partition>s.cantidad,"error-message":s.partition>s.cantidad?"No se pueden generar mas particiones que articulos":"la particiones tienen que ser minimo "},null,8,["modelValue","onUpdate:modelValue","error","error-message"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(ce,{align:"right"},{default:t(()=>[Z(e(A,{flat:"",label:"Cancel",color:"primary"},null,512),[[we]]),e(A,{flat:"",label:"Continuar",color:"primary",onClick:ne})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:F.value,"onUpdate:modelValue":a[5]||(a[5]=s=>F.value=s),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(E,{class:"row items-center"},{default:t(()=>[e(Pe,{icon:"warning",color:"negative","text-color":"white"}),a[21]||(a[21]=i("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1)),i("div",Gt,g(u.value.id),1)]),_:1}),e(ce,{align:"center"},{default:t(()=>[Z(e(A,{flat:"",label:"Cancel",color:"positive"},null,512),[[we]]),e(A,{flat:"",label:"Confirmar",color:"negative",onClick:Be})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Jt={class:"text-h6"},Kt={class:"row q-mt-md"},Wt={class:"q-ml-sm text-h6"},Zt={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(o,{emit:y}){ge();const m=ve(),f=b({state:!1,action:null}),_=b({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),w={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},v=y,r=o,x=b(r.rows),u=b(r.name),h=b(r.type),B=q(()=>h.value?w[h.value]:{l:"",c:""}),O=()=>{const S=w[h.value];f.value.action=S,f.value.state=!0},U=async()=>{m.loading.show({message:"Espera..."});const S=await Y.massiveAction({action:h.value});console.log(S),S.status==200?(S.data,f.value.state=!1,f.value.action=null,m.loading.hide(),m.notify({position:"center",color:"positive",icon:"done"}),v("cardResumeActived")):(console.error(S.data),alert(`Error ${S.status}: ${S.data.msg}`))},Q=(S,M,P)=>{console.log(S),console.log(M),console.log(P),console.log(h.value)};return(S,M)=>(p(),$(T,null,[e(oe,{"row-key":"ID",rows:x.value,columns:_.value.columns,filter:_.value.filter,onRowClick:Q},{top:t(()=>[i("div",Jt,g(u.value),1),i("div",Kt,[e(A,{color:B.value.c,icon:"warning",label:B.value.l,onClick:O},null,8,["color","label"]),e(me,{modelValue:_.value.filter,"onUpdate:modelValue":M[0]||(M[0]=P=>_.value.filter=P),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(K,{modelValue:f.value.state,"onUpdate:modelValue":M[1]||(M[1]=P=>f.value.state=P),persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(E,{class:"row items-center"},{default:t(()=>[e(Pe,{icon:"warning",color:f.value.action.c,"text-color":"white"},null,8,["color"]),i("span",Wt,g(f.value.action.l),1)]),_:1}),e(E,null,{default:t(()=>[k(g(f.value.action.desc),1)]),_:1}),e(ce,{align:"right"},{default:t(()=>[Z(e(A,{flat:"",label:"cancelar",color:"primary"},null,512),[[we]]),e(A,{flat:"",label:"continuar",color:"primary",onClick:U})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ea={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},ta={class:"text-h6"},aa={class:"row q-mb-md items-start justify-around"},la={class:"text-left"},oa={class:"text-h5"},sa={class:"text--2"},ia={class:"full-width row items-center"},na={class:"col text-h6 text-dark"},ra={__name:"AdminDashboard",props:{dash:{type:Object,default:{}}},emits:["reloadDashboard","freshOrder"],setup(o,{emit:y}){Ce(),Me();const m=Ee(),f=ge(),_=ve(),w=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],v=y,r=b({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:c=>c.log.length==1?c.log[0].name:c.log[c.log.length-1].name,align:"left",sortable:!0,sort:(c,n,d,C)=>parseInt(d._status)-parseInt(C._status),classes:c=>w[c._status?parseInt(c._status)-1:parseInt(c.status.id)-1]},{name:"suplier",label:"Surtidores",field:c=>{var n;return(n=c.partition)==null?void 0:n.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:c=>te(c.log.find(n=>n.id==c.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:c=>c.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:c=>c.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:c=>c.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:c=>c.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),x=b(!1),u=b({state:!1,title:"",data:null,name:null,type:null}),h=b({state:!1,head:null,block:!0}),B=q(()=>f.ordersSize),O=q(()=>f.ordersok.filter(c=>c._status!=100&&c._workpoint_to==m.session.store.id_viz)),U=q(()=>f.ordersok.filter(c=>c._status==100)),Q=q(()=>f.orderserrors),S=q(()=>f.resume),M=async c=>{console.log(c.row),h.value.head=c.row,h.value.state=!0},P=async c=>{_.loading.show({message:"cargando..."+c});const n=await Y.report(c);console.log(n.data),u.value.data=n.data.rows,u.value.name=n.data.name,u.value.type=c,u.value.state=!0,_.loading.hide()},F=()=>{u.value.state=!1,u.state=!1,v("reloadDashboard")},D=(c,n=!1)=>{console.log(c),n&&(h.value.state=!1),v("freshOrder",c)},z=()=>{x.value=!0};return(c,n)=>(p(),j(rt,{padding:"",class:"bg-grey-2"},{default:t(()=>[Q.value.length?(p(),$("div",ea,[n[6]||(n[6]=i("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1)),i("div",ta,g(Q.value.map(d=>d.id).join("id")),1),n[7]||(n[7]=i("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1))])):I("",!0),i("div",aa,[(p(!0),$(T,null,J(S.value,d=>(p(),j(A,{stack:"","no-caps":"",class:"q-py-md",key:d.key,onClick:C=>P(d.key),color:d.total==0?"teal-10":"pink-13",disabled:d.total==0},{default:t(()=>[i("div",la,[i("div",oa,g(d.total),1),i("div",sa,g(d.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(oe,{flat:"",bordered:"","row-key":"id",rows:O.value,columns:r.value.columns,filter:r.value.filter,pagination:r.value.pagination},{top:t(()=>[i("div",ia,[i("div",na,"Pedidos: "+g(B.value),1),e(me,{dense:"",modelValue:r.value.filter,"onUpdate:modelValue":n[0]||(n[0]=d=>r.value.filter=d),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(le,{name:"search"})]),_:1},8,["modelValue"]),e(N,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[e(le,{name:"archive",size:"md",color:"negative",onClick:z})])])]),header:t(d=>[e(ye,{props:d},{default:t(()=>[e($e,{"auto-width":""}),(p(!0),$(T,null,J(d.cols,C=>(p(),j($e,{key:C.name,props:d},{default:t(()=>[k(g(C.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(d=>[e(ye,{props:d},{default:t(()=>[e(_e,{"auto-width":""},{default:t(()=>[d.row?(p(),j(A,{key:0,size:"sm",dense:"",round:"",flat:"",onClick:C=>d.expand=!d.expand,icon:d.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])):I("",!0)]),_:2},1024),(p(!0),$(T,null,J(d.cols,C=>(p(),j(_e,{key:C.name,props:d,onClick:se=>M(d)},{default:t(()=>[k(g(C.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(ye,{props:d},{default:t(()=>[e(_e,{colspan:"100%"},{default:t(()=>[e(ue,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(ee,null,{default:t(()=>[e(V,null,{default:t(()=>n[8]||(n[8]=[k("ID")])),_:1}),e(V,null,{default:t(()=>n[9]||(n[9]=[k("ESTADO")])),_:1}),e(V,null,{default:t(()=>n[10]||(n[10]=[k("Utima Actividad")])),_:1}),d.row.from._type==2?(p(),j(V,{key:0},{default:t(()=>n[11]||(n[11]=[k("SALIDA")])),_:1})):I("",!0),d.row.from._type==2?(p(),j(V,{key:1},{default:t(()=>n[12]||(n[12]=[k("ENTRADA")])),_:1})):I("",!0),d.row.from._type==1?(p(),j(V,{key:2},{default:t(()=>n[13]||(n[13]=[k("TRASPASO")])),_:1})):I("",!0)]),_:2},1024),(p(!0),$(T,null,J(d.row.partition,(C,se)=>(p(),$("div",{key:se},[e(ee,null,{default:t(()=>[e(V,null,{default:t(()=>[e(L,{overline:""},{default:t(()=>[k(g(C._suplier),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[k(g(C.id),1)]),_:2},1024)]),_:2},1024),e(V,{class:et(`${w[C.status.id-1]}`)},{default:t(()=>[k(g(C.status.name),1)]),_:2},1032,["class"]),e(V,null,{default:t(()=>{var ie,ne;return[k(g(W(te)((ne=(ie=C.log)==null?void 0:ie.find(be=>be.id==C._status))==null?void 0:ne.pivot.updated_at).format("YYYY-MM-DD HH:mm:ss")),1)]}),_:2},1024),d.row.from._type==2?(p(),j(V,{key:0},{default:t(()=>[k(g(C.invoice),1)]),_:2},1024)):I("",!0),d.row.from._type==2?(p(),j(V,{key:1},{default:t(()=>[k(g(C.invoice_received),1)]),_:2},1024)):I("",!0),d.row.from._type==1?(p(),j(V,{key:2},{default:t(()=>[k(g(C.invoice),1)]),_:2},1024)):I("",!0)]),_:2},1024),e(N,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[tt,d.expand]])]),_:1},8,["rows","columns","filter","pagination"]),e(K,{"full-width":"",modelValue:h.value.state,"onUpdate:modelValue":n[3]||(n[3]=d=>h.value.state=d),persistent:h.value.block,"no-esc-dismiss":h.value.block,"no-backdrop-dismiss":h.value.block},{default:t(()=>[e(Xt,{head:h.value.head,onLoaded:n[1]||(n[1]=d=>h.value.block=!1),onLoading:n[2]||(n[2]=d=>h.value.block=!0),onFresh:D,onChofiAssigned:D},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(K,{modelValue:u.value.state,"onUpdate:modelValue":n[4]||(n[4]=d=>u.value.state=d)},{default:t(()=>[e(Zt,{rows:u.value.data,name:u.value.name,type:u.value.type,onCardResumeActived:F},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(K,{modelValue:x.value,"onUpdate:modelValue":n[5]||(n[5]=d=>x.value=d),"full-width":""},{default:t(()=>[e(X,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(E,{class:"q-pt-none"},{default:t(()=>[e(oe,{flat:"",bordered:"","row-key":"id",rows:U.value,columns:r.value.columns,pagination:r.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const da={class:"q-pa-md"},ua={class:"q-pb-sm"},ca={key:0},La={__name:"dashboard",setup(o){const y=Ce();Me();const m=ge();ve(),Ee();const f=b({val:null}),_=b(!1),w=async()=>{m.setTitle("Dashboard"),m.setButtonShow(!0)},v=r=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",r.id),Ie.emit("order_refresh",{order:r})};return at(()=>y.query,()=>{w()}),w(),(r,x)=>(p(),$(T,null,[e(K,{modelValue:_.value,"onUpdate:modelValue":x[2]||(x[2]=u=>_.value=u)},{default:t(()=>[e(X,{class:"my-card"},{default:t(()=>[e(E,null,{default:t(()=>[i("div",da,[i("div",ua,g(f.value.val),1),e(Le,{modelValue:f.value.val,"onUpdate:modelValue":x[0]||(x[0]=u=>f.value.val=u),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(E,null,{default:t(()=>[e(ce,{align:"right"},{default:t(()=>[e(A,{flat:"",icon:"close",color:"negative",onClick:x[1]||(x[1]=u=>_.value=!_.value)}),e(A,{flat:"",icon:"check",color:"positive",onClick:r.buscas},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),W(m).showLoad?(p(),$("div",ca,[e(vt,{showing:W(m).showLoad},{default:t(()=>[e(ft,{size:"5.5em",color:"primary"}),x[3]||(x[3]=k(" Obteniendo Datos... "))]),_:1},8,["showing"])])):(p(),j(ra,{key:1,onReload:w,onFreshOrder:v}))],64))}};export{La as default};
