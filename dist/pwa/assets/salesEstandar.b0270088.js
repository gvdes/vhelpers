import{u as G,a as W,aH as X,c as k,o as w,d as h,w as s,e as o,f as i,a0 as _,g as K,a3 as ve,a4 as me,a9 as M,Q as f,a5 as I,b1 as fe,b4 as ge,h as Q,r as x,m as be,q as ye,p as xe,a1 as O,n as R}from"./index.a996e2bc.js";import{Q as D,c as A}from"./QSeparator.cc594f43.js";import{a as g,Q as V}from"./QCard.9a36efc8.js";import{Q as E}from"./QTable.241b3670.js";import{Q as j}from"./QInput.b8856860.js";import{Q as z}from"./QCardActions.25ca6b75.js";import{Q as J}from"./QForm.5fd700d5.js";import{Q as _e}from"./QFooter.1c9b6500.js";import{Q as we}from"./QPage.6de0c99c.js";import{C as H}from"./ClosePopup.4a561a41.js";import{u as Pe,c as Y}from"./cashApi.03e66147.js";import"./QSelect.a465bb99.js";import"./QExpansionItem.6ddeb7ab.js";import"./QList.425ee15a.js";import"./QDrawer.69ec4bec.js";import{u as Z}from"./axios.13708793.js";import{P as he}from"./ProductsAutocomplete.616fbf62.js";import{Q as De}from"./QSpace.a089bff3.js";import{R as N}from"./resoursesOrder.b83a457d.js";import{_ as ke}from"./PaymentSales.4855bb52.js";import{o as Ce}from"./orderApi.febe7b14.js";import"./QLinearProgress.80ba80eb.js";import"./QCheckbox.27d249eb.js";import"./QResizeObserver.08146584.js";import"./QScrollObserver.1d28df49.js";import"./touch.9135741d.js";/* empty css                                                                         */const Ve={class:"row"},Ne={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},Qe={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},Se={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},Be={class:"row"},$e={class:"text-h6 col text-bold text-left"},Re={class:"text-h6 col text-bold text-right"},Ae={class:"text-subtitle2 col"},Te={class:"text-center"},qe={class:"q-pa-xs"},Fe={class:"row items-center justify-center q-gutter-md"},Le={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(d,{emit:T}){G();const v=Z();W(),X();const l=d,b=T,C=k(()=>!l.product.pivot.amountDelivered||l.product.pivot.amountDelivered<=0),u=k(()=>l.product.pivot._supply_by==3?l.product.pivot.amountDelivered*l.product.pieces:l.product.pivot._supply_by==2?l.product.pivot.amountDelivered*12:l.product.pivot.amountDelivered),m=k(()=>l._price_list<=3?[1,2,3,4]:[l._price_list]),n=k(()=>l._price_list<=3?u.value>=l.product.pieces&&(l.product.pivot._supply_by==1||l.product.pivot._supply_by==2)||l.product.pivot._supply_by==3?4:N.verificarPrecioDocena(l.products,l.product,l.rules)?3:N.verificarPrecioMayoreo(l.products,l.product,l.rules)?2:1:l._price_list),a=()=>{b("reset")},y=async()=>{v.loading.show({message:"Editando Producto"});let P=l.product.prices.find(p=>p.id==n.value).pivot.price,c=u.value*P;l.product.pivot.toDelivered=u.value,l.product.pivot._price_list=n.value,l.product.pivot.price=P,l.product.pivot.total=c,v.loading.hide(),a(),N.actualizarPreciosProductosSales(l.products,l._price_list,l.rules),b("editProduct")},S=async()=>{v.loading.show({message:"Agregando producto"});let P=l.product.prices.find(p=>p.id==n.value).pivot.price,c=u.value*P;l.product.pivot.toDelivered=u.value,l.product.pivot._price_list=n.value,l.product.pivot.price=P,l.product.pivot.total=c,l.product.pivot._product=l.product.id,console.log(l.product),b("addProduct",l.product),v.loading.hide(),N.actualizarPreciosProductosSales(l.products,l._price_list,l.rules)},B=async()=>{v.loading.show({message:"Eliminando Producto"}),b("deleteProduct",l.product),v.loading.hide(),N.actualizarPreciosProductosSales(l.products,l._price_list,l.rules)};return(P,c)=>(w(),h(V,null,{default:s(()=>[o(g,{class:"item-center"},{default:s(()=>[i("div",Ve,[i("div",Ne,_(d.product.categories.familia.seccion.name),1),i("div",Qe,_(d.product.categories.familia.name),1),i("div",Se,_(d.product.categories.name),1)])]),_:1}),o(g,{class:"item-center"},{default:s(()=>[i("div",Be,[i("div",$e,_(d.product.code),1),i("div",Re,_(d.product.name),1)]),i("div",Ae,_(d.product.description),1)]),_:1}),o(g,{class:"item-center row"},{default:s(()=>[(w(!0),K(ve,null,me(d.product.prices.filter(p=>m.value.includes(p.id)),(p,$)=>(w(),K("div",{class:"col text-subtitle2 text-center",key:$},[i("div",{class:M(p.id==n.value?"text-weight-bold":"text-caption text-strike")},_(p.alias),3),o(D,{spaced:"",inset:"",vertical:"",dark:""}),i("div",{class:M(p.id==n.value?"text-bold  text-blue-13":"text-caption")},_(p.pivot.price),3),o(D,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),o(g,null,{default:s(()=>[i("div",Te,[i("div",qe,[c[4]||(c[4]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",Fe,[o(f,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:c[0]||(c[0]=p=>d.product.pivot.amountDelivered>1?d.product.pivot.amountDelivered--:"")}),I(i("input",{type:"number",min:"1","onUpdate:modelValue":c[1]||(c[1]=p=>d.product.pivot.amountDelivered=p),class:"text-center exo",style:{width:"100px","font-size":"3em",border:"none"},autofocus:"",onKeydown:c[2]||(c[2]=fe(p=>d.edit?y():S(),["enter"]))},null,544),[[ge,d.product.pivot.amountDelivered]]),o(f,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:c[3]||(c[3]=p=>d.product.pivot.amountDelivered++)})])])])]),_:1}),o(z,null,{default:s(()=>[o(f,{flat:"",icon:"close",onClick:a}),o(De),d.edit?Q("",!0):(w(),h(f,{key:0,flat:"",icon:"add",color:"positive",onClick:S,disable:C.value},null,8,["disable"])),d.edit?(w(),h(f,{key:1,flat:"",icon:"delete",color:"negative",onClick:B})):Q("",!0),d.edit?(w(),h(f,{key:2,flat:"",icon:"edit",color:"warning",onClick:y,disable:C.value},null,8,["disable"])):Q("",!0)]),_:1})]),_:1}))}},Ee={class:"col"},Ie={class:"col"},ze={class:"col"},Ue={class:"text-center text-h6"},Ke={class:"col"},Me={class:"text-center text-h6"},yt={__name:"salesEstandar",setup(d){const T=G(),v=Z();W(),X();const l=Pe();console.log(l.rules);const b=x(null),C=x({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),u=x({val:null,opts:[]}),m=x({val:null,opts:[]}),n=x({state:!1,val:null,edit:!1}),a=x({client:null,dependiente:null,products:[]}),y=x(!1),S=x({columns:[{name:"code",label:"Codigo",field:e=>e.code,align:"left"},{name:"description",label:"Descripcion",field:e=>e.description,align:"left"},{name:"verify",label:"Verificado",field:e=>e.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:e=>e.pivot.price,align:"center"},{name:"total",label:"Total",field:e=>e.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),B=x({columns:[{name:"id",label:"Codigo",field:e=>e.id,align:"left"},{name:"Nombre",label:"Descripcion",field:e=>e.name,align:"left"},{name:"Telefono",label:"Pedido",field:e=>e.celphone,align:"center"}],pagination:{rowsPerPage:0}}),P=x({columns:[{name:"id",label:"Codigo",field:e=>e.id,align:"left"},{name:"Nombre",label:"Descripcion",field:e=>e.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),c=k(()=>Number(a.value.products.reduce((e,t)=>e+t.pivot.total,0)).toFixed(2)),p=k(()=>a.value.products.reduce((e,t)=>e+Number(t.pivot.toDelivered),0)),$=k(()=>a.value.products.length>0&&a.value.dependiente&&a.value.client),ee=e=>{console.log(e);let t=a.value.products.findIndex(r=>r.id==e.id);t>=0?(n.value.val=a.value.products[t],n.value.state=!0,n.value.edit=!0):(e.pivot=C.value,n.value.val=e,n.value.state=!0,n.value.edit=!1)},te=e=>{console.log(e);let t=a.value.products.findIndex(r=>r.id==e.id);t>=0?(n.value.val=a.value.products[t],n.value.state=!0,n.value.edit=!0):(e.pivot=C.value,n.value.val=e,n.value.state=!0,n.value.edit=!1)},le=(e,t)=>{console.log(t),n.value.val=t,n.value.edit=!0,n.value.state=!0},oe=()=>{console.log("cambio de cliente"),u.value.state=!0},ae=async()=>{if(u.value.val){const e=await Ce.getClient(u.value);e.fail?console.log(e):e.length>0?(console.log(e),u.value.opts=e):v.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(e)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},ie=async(e,t)=>{v.loading.show({message:"Recalculando Ticket"}),a.value.client=t,N.actualizarPreciosProductosSales(a.value.products,t._price_list,l.rules),u.value={state:!1,val:null,opts:[]},v.loading.hide()},se=()=>{console.log("cambio de cliente"),m.value.state=!0},ne=async()=>{if(m.value.val){let e={val:m.value.val,sto:T.session.store.id};const t=await Y.getDependiente(e);t.fail?console.log(t):t.length>0?(console.log(t),m.value.opts=t):v.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},re=(e,t)=>{a.value.dependiente=t,m.value={state:!1,val:null,opts:[]},v.loading.hide()},ue=e=>{a.value.products.push(e),q(),R(()=>{var t;(t=b.value)==null||t.focus()})},de=()=>{R(()=>{var e;(e=b.value)==null||e.focus()})},ce=e=>{let t=a.value.products.findIndex(r=>r.id==e.id);t>=0&&(a.value.products.splice(t,1),q()),R(()=>{var r;(r=b.value)==null||r.focus()})},pe=async e=>{v.loading.show({message:"Realizando Ticket"}),a.value.payments=e,a.value.change=e.conditions.super?0:Number.parseFloat(e.SFPA.val)+Number.parseFloat(e.PFPA.val)+Number.parseFloat(e.VALE.val)-a.value.products.reduce((F,L)=>F+L.pivot.total,0),a.value.total=a.value.products.reduce((F,L)=>F+L.pivot.total,0);let t={order:a.value,cashier:l.cash};console.log(t);const r=await Y.addSaleStandar(t);r.fail?console.log(r):(console.log(r),y.value=!1,a.value={client:null,dependiente:null,products:[]},localStorage.removeItem("current_sale"),v.loading.hide())},q=()=>{n.value={state:!1,val:null,edit:!1},C.value={amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},R(()=>{var e;(e=b.value)==null||e.focus()})},U=e=>{e.ctrlKey&&e.key.toLowerCase()==="b"?(e.preventDefault(),u.value.state||(u.value.state=!0)):e.ctrlKey&&e.key.toLowerCase()==="d"?(e.preventDefault(),m.value.state||(m.value.state=!0)):e.altKey&&e.key==="Enter"&&$.value&&(e.preventDefault(),y.value||(y.value=!0))};return be(()=>a.value,e=>{localStorage.setItem("current_sale",JSON.stringify(e))},{deep:!0}),ye(()=>{const e=localStorage.getItem("current_sale");e&&(a.value=JSON.parse(e)),window.addEventListener("keydown",U)}),xe(()=>{window.removeEventListener("keydown",U)}),(e,t)=>(w(),h(we,null,{default:s(()=>[o(V,{class:"my-card"},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[i("div",Ee,[t[7]||(t[7]=i("div",{class:"text-caption text-center"},"Dependiente",-1)),o(f,{class:"full-width",flat:"",label:a.value.dependiente?a.value.dependiente.complete_name:"CTRL+d",onClick:se},null,8,["label"])]),o(D,{spaced:"",inset:"",vertical:"",dark:""}),i("div",Ie,[t[8]||(t[8]=i("div",{class:"text-caption text-center"},"Cliente",-1)),o(f,{class:"full-width",flat:"",label:a.value.client?a.value.client.name:"CTRL+b",onClick:oe},null,8,["label"])])]),_:1})]),_:1}),o(D,{spaced:"",inset:"",vertical:"",dark:""}),o(V,{class:"my-card"},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[i("div",ze,[t[9]||(t[9]=i("div",{class:"text-caption text-center"},"Total",-1)),i("div",Ue,"$ "+_(c.value),1)]),i("div",Ke,[t[10]||(t[10]=i("div",{class:"text-caption text-center"},"Cantidad",-1)),i("div",Me,_(p.value),1)])]),_:1})]),_:1}),o(D,{spaced:"",inset:"",vertical:"",dark:""}),o(E,{rows:a.value.products,columns:S.value.columns,"hide-bottom":"",pagination:S.value.pagination,onRowClick:le},null,8,["rows","columns","pagination"]),o(A,{modelValue:n.value.state,"onUpdate:modelValue":t[0]||(t[0]=r=>n.value.state=r),persistent:"",position:"bottom"},{default:s(()=>[o(Le,{product:n.value.val,_price_list:u.value.val?u.value.val._price_list:1,edit:n.value.edit,onReset:q,products:a.value.products,rules:O(l).rules,onAddProduct:ue,onDeleteProduct:ce,onEditProduct:de},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),o(A,{modelValue:u.value.state,"onUpdate:modelValue":t[2]||(t[2]=r=>u.value.state=r)},{default:s(()=>[o(V,{style:{width:"700px"}},{default:s(()=>[o(J,{onSubmit:ae},{default:s(()=>[t[11]||(t[11]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),t[12]||(t[12]=i("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),o(g,null,{default:s(()=>[o(D,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[o(j,{autofocus:"",modelValue:u.value.val,"onUpdate:modelValue":t[1]||(t[1]=r=>u.value.val=r),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),u.value.opts.length>0?(w(),h(g,{key:0},{default:s(()=>[o(E,{rows:u.value.opts,columns:B.value.columns,pagination:B.value.pagination,onRowClick:ie},null,8,["rows","columns","pagination"])]),_:1})):Q("",!0),o(z,{align:"right"},{default:s(()=>[I(o(f,{flat:"",label:"Cancelar",color:"primary"},null,512),[[H]]),o(f,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(A,{modelValue:m.value.state,"onUpdate:modelValue":t[4]||(t[4]=r=>m.value.state=r)},{default:s(()=>[o(V,{style:{width:"700px"}},{default:s(()=>[o(J,{onSubmit:ne},{default:s(()=>[t[13]||(t[13]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),t[14]||(t[14]=i("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),o(g,null,{default:s(()=>[o(D,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[o(j,{autofocus:"",modelValue:m.value.val,"onUpdate:modelValue":t[3]||(t[3]=r=>m.value.val=r),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),m.value.opts.length>0?(w(),h(g,{key:0},{default:s(()=>[o(E,{rows:m.value.opts,columns:P.value.columns,pagination:P.value.pagination,onRowClick:re},null,8,["rows","columns","pagination"])]),_:1})):Q("",!0),o(z,{align:"right"},{default:s(()=>[I(o(f,{flat:"",label:"Cancelar",color:"primary"},null,512),[[H]]),o(f,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",null,[o(A,{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=r=>y.value=r)},{default:s(()=>[o(ke,{total:Number(c.value),paymeths:O(l).methods,client:a.value.client.id,onSendTicket:pe},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),o(_e,{bordered:"",class:"bg-white"},{default:s(()=>[o(V,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[o(he,{ref_key:"productRef",ref:b,class:"col",checkState:!1,onInput:te,onAgregar:ee},null,512),$.value?(w(),h(f,{key:0,color:"primary",flat:"",icon:"east",onClick:t[6]||(t[6]=r=>y.value=!y.value),round:""})):Q("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{yt as default};
