import{d as q,e as N,b as _}from"./QList.6eadd021.js";import{u as j,r as g,c as J,o as u,g as x,e,w as t,d as S,al as G,ak as h,b5 as T,I as H,f as o,Q as K,a0 as d,h as k,n as W,a as X,aH as Y,T as Z,a2 as ee,a3 as te}from"./index.41673bde.js";import{Q as ae}from"./QToolbar.624c85e5.js";import{Q as oe}from"./QHeader.dcdccaf7.js";import{Q as b}from"./QCardSection.3c63fbe4.js";import{Q as $}from"./QTd.4dd05c59.js";import{Q as se}from"./QTr.e6a5ea8c.js";import{Q as le}from"./QTable.3c5d7999.js";import{Q as B}from"./QCard.2b05cd0d.js";import{Q as ie}from"./QFooter.c42b003e.js";import{Q as re}from"./QPage.00d8b7d4.js";import{Q as ne,a as ce}from"./QLayout.ac4e7fc0.js";import{Q as de}from"./QBadge.6c0afdc7.js";import{Q as O}from"./QSelect.4caaa115.js";import{Q as ue}from"./QInput.af481172.js";import{Q as pe}from"./QForm.ad984b89.js";import{p as C}from"./productsApi.782a4bd8.js";import{u as R}from"./use-quasar.e6a885ef.js";import{H as me}from"./html5-qrcode-scanner.64619f17.js";import{_ as fe}from"./UserToolbar.8f82f530.js";import"./QResizeObserver.ec80bccb.js";import"./QLinearProgress.eb6bfd76.js";import"./QCheckbox.dcde476f.js";import"./QScrollObserver.2d1295a1.js";import"./axios.71442fda.js";import"./_commonjsHelpers.88e99c8f.js";import"./QDrawer.81ecd829.js";import"./QCardActions.0176ae37.js";import"./ClosePopup.4fc62d02.js";import"./auth.5a938a17.js";const ve={class:"QuickRegular row items-center text-black"},_e={class:"col"},ge={key:0},xe={class:"row items-center justify-between no-wrap QuickRegular"},be={class:"col"},he={class:"text-grey-4 q-pl-md"},ye={class:"text--2 text-grey-5"},we={key:1},Qe={key:2,class:"flex flex-center q-pa-md"},ke={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},with_locations:{default:null,type:Boolean},with_image:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},with_prices_Invoice:{default:null,type:Boolean},with_stock:{default:null,type:Boolean}},emits:["input","similarcodes","agregar"],setup(I,{emit:y}){R();const r=j(),v=I,P=y;let p=null;const m=g(!1),s=g(!1),n=g({val:{id:1,label:"Autocomplete",icon:"keyboard"},opts:[{id:1,label:"Autocomplete",icon:"keyboard"},{id:2,label:"barcode",icon:"fas fa-barcode"},{id:3,label:"qr_code",icon:"qr_code"}]}),a=g({buscar:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),w=J(()=>({search:a.value.buscar,with_locations:v.with_locations,with_stock:v.with_stock,with_prices:v.with_prices,limit:v.limit,_workpoint:r.session.store.id_viz,rol:r.session.credentials.rol})),F=()=>{switch(a.value.iptsearch.type){case"text":a.value.iptsearch.type="number",a.value.iptsearch.icon="fas fa-font";break;case"number":a.value.iptsearch.type="text",a.value.iptsearch.icon="fas fa-hashtag";break}},L=async(c,i,l)=>{let f=c.trim().toUpperCase();if(f.length>=3){a.value.buscar=f,console.log(w.value);const Q=await C.autoCompleteProduct(w.value);if(Q.fail)console.log(Q);else{console.log(Q);let M=Q;i(()=>{a.value.options=M},A=>{A.setOptionIndex(-1),A.moveOptionSelection(1,!0)})}}},U=async()=>{if(a.value.buscar.trim().toUpperCase(),a.value.buscar.length){const c=await C.exactSearch(w.value);c.fail?console.log(c):(console.log(c),V(c))}},E=async()=>{if(p){console.log("La c\xE1mara ya est\xE1 activa");return}m.value=!0,W(()=>{p=new me("reader");const c={fps:20};p.start({facingMode:"environment"},c,async i=>{if(!s.value){s.value=!0;try{const l=JSON.parse(i);if(console.log(l),l.modelo){a.value.buscar=l.modelo;const f=await C.scanSearch(w.value);f.fail?console.log(f):(console.log(f),V(f))}}catch{console.log("QR inv\xE1lido: "+i)}finally{s.value=!1}}}).catch(i=>console.log("Error al iniciar c\xE1mara: "+i.message)),console.log("C\xE1mara iniciada")})},z=()=>{if(!p){console.log("La c\xE1mara no estaba activa");return}p.stop().then(()=>{p.clear(),p=null,m.value=!1,console.log("C\xE1mara detenida")}).catch(c=>console.log("Error al detener c\xE1mara: "+c.message))},V=c=>{a.value.buscar="",P("input",c)},D=(c,i)=>{c.id==3?E():z()};return(c,i)=>(u(),x("div",ve,[e(O,{modelValue:n.value.val,"onUpdate:modelValue":[i[0]||(i[0]=l=>n.value.val=l),D],class:"flex items-center justify-center","options-dense":"",options:n.value.opts,filled:"",style:{width:"60px"},"hide-dropdown-icon":""},{selected:t(()=>[n.value.val?(u(),S(G,{key:0,size:"xl","text-color":"primary",class:"text-left flex items-left justify-left",icon:n.value.val.icon},null,8,["icon"])):(u(),S(de,{key:1},{default:t(()=>i[3]||(i[3]=[h("*no hay :{*")])),_:1}))]),option:t(l=>[e(q,T(l.itemProps,{class:"flex items-center justify-center"}),{default:t(()=>[e(N,{avatar:"",class:"text-center"},{default:t(()=>[e(H,{name:l.opt.icon},null,8,["name"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),o("div",_e,[n.value.val.id==1?(u(),x("div",ge,[e(O,{modelValue:a.value.buscar,"onUpdate:modelValue":i[1]||(i[1]=l=>a.value.buscar=l),"hide-selected":"",behavior:"menu",options:a.value.options,filled:"","hide-dropdown-icon":"","use-input":"",class:"text-uppercase","input-class":"text-h6 text-bold",onFilter:L,"input-debounce":400,autofocus:""},{prepend:t(()=>[e(K,{size:"md",flat:"",padding:"none",onClick:F,icon:a.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:t(l=>[e(q,T(l.itemProps,{onClick:f=>V(l.opt)}),{default:t(()=>[e(N,null,{default:t(()=>[o("div",xe,[o("div",be,[o("div",null,[h(d(l.opt.code)+" ",1),o("span",he,d(l.opt.name),1)]),o("div",ye,d(l.opt.description),1)])])]),_:2},1024)]),_:2},1040,["onClick"])]),_:1},8,["modelValue","options"])])):k("",!0),n.value.val.id==2?(u(),x("div",we,[e(pe,{onSubmit:U,class:"q-gutter-md"},{default:t(()=>[e(ue,{modelValue:a.value.buscar,"onUpdate:modelValue":i[2]||(i[2]=l=>a.value.buscar=l),type:"text",filled:"",class:"text-uppercase","input-class":"text-h6 text-bold",autofocus:""},null,8,["modelValue"])]),_:1})])):k("",!0),n.value.val.id==3?(u(),x("div",Qe,[e(B,{class:"camera-card"},{default:t(()=>[e(b,{class:"flex flex-center"},{default:t(()=>i[4]||(i[4]=[o("div",{id:"reader",class:"qr-reader"},null,-1)])),_:1})]),_:1})])):k("",!0)])]))}};const Ce={class:"col"},Se={class:"row justify-center"},Pe={class:"row"},Ve={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},$e={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},Be={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},Ie={class:"row"},Ae={class:"text-h6 col text-bold text-left"},qe={class:"col text-bold text-center"},Ne={class:"text-h6 col text-bold text-right"},Te={class:"text-subtitle2 col"},Oe={class:"text-weight-bold"},je={class:"text-bold text-blue-13"},He={class:"row q-ml-sm"},vt={__name:"getProduct",setup(I){j();const y=R();X(),Y();const r=g(null),v=g({columns:[{name:"anio",label:"A\xD1O",field:"year",align:"center"},{name:"sales",label:"COMPRAS",field:"compras",align:"center"},{name:"purchases",label:"VENTAS",field:"ventas",align:"center"}]}),P=m=>{console.log(m),p(m.id)},p=async m=>{y.loading.show({message:"Obteniendo Datos"}),r.value=null,console.log(m);const s=await C.getProduct(m);s.fail?console.log(s):(y.loading.hide(),console.log(s),s.prices.push({id:8,alias:"COS",pivot:{price:s.cost}}),s.prices.sort((n,a)=>a.id-n.id),r.value=s)};return(m,s)=>(u(),S(ne,{view:"hHh Lpr fFf"},{default:t(()=>[e(oe,{class:"bg-grey-3 text-dark",bordered:""},{default:t(()=>[e(fe),e(_),e(ae,{class:"justify-between row"},{default:t(()=>[o("div",Ce,[s[0]||(s[0]=o("span",{class:"text-grey"},"Helpers",-1)),e(H,{name:"navigate_next",color:"primary"}),s[1]||(s[1]=o("span",{class:"text-h6"},"Informaci\xF3n Producto",-1))])]),_:1})]),_:1}),e(ce,null,{default:t(()=>[e(re,{padding:""},{default:t(()=>[o("div",Se,[e(Z,{name:"bounce"},{default:t(()=>[r.value?(u(),S(B,{key:0,class:"my-card"},{default:t(()=>[e(b,{class:"item-center"},{default:t(()=>[o("div",Pe,[o("div",Ve,d(r.value.category.familia.seccion.name),1),o("div",$e,d(r.value.category.familia.name),1),o("div",Be,d(r.value.category.name),1)])]),_:1}),e(b,{class:"item-center"},{default:t(()=>[o("div",Ie,[o("div",Ae,d(r.value.code),1),o("div",qe,[s[2]||(s[2]=o("div",{class:"text-caption"},"Stock",-1)),o("div",null,d(r.value.total_stock),1)]),o("div",Ne,d(r.value.name),1)]),o("div",Te,d(r.value.description),1)]),_:1}),e(b,{class:"item-center row"},{default:t(()=>[(u(!0),x(te,null,ee(r.value.prices,(n,a)=>(u(),x("div",{class:"col text-subtitle2 text-center",key:a},[o("div",Oe,d(n.alias),1),e(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",je,d(n.pivot.price),1),e(_,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),e(b,null,{default:t(()=>[e(le,{rows:r.value.details,hideBottom:"",columns:v.value.columns,pagination:{rowsPerPage:0}},{"bottom-row":t(()=>[e(se,{class:"text-bold bg-yellow-12"},{default:t(()=>[e($,{class:"text-center"},{default:t(()=>s[3]||(s[3]=[h(" Total ")])),_:1}),e($,{class:"text-center"},{default:t(()=>[h(d(r.value.details.reduce((n,a)=>n+Number(a.compras),0)),1)]),_:1}),e($,{class:"text-center"},{default:t(()=>[h(d(r.value.details.reduce((n,a)=>n+Number(a.ventas),0)),1)]),_:1})]),_:1})]),_:1},8,["rows","columns"])]),_:1})]),_:1})):k("",!0)]),_:1})]),e(ie,{reveal:"",elevated:"",bordered:""},{default:t(()=>[e(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",He,[e(B,{class:"col"},{default:t(()=>[e(ke,{checkState:!1,onInput:P,with_prices_Invoice:"",with_stock:"",with_locations:""})]),_:1}),e(_,{spaced:"",inset:"",vertical:"",dark:""})]),e(_,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{vt as default};
