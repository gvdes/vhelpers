import{u as G,aE as H,c as D,o as w,a as h,w as s,e as o,f as i,a4 as _,g as K,a1 as ve,a0 as me,aZ as M,Q as f,a2 as I,b0 as fe,b3 as ge,h as Q,r as x,m as be,q as ye,p as xe,ak as O,n as R}from"./index.b92dd970.js";import{Q as k}from"./QSeparator.9ed28fa7.js";import{a as g,Q as V}from"./QCard.7eb7d094.js";import{Q as L}from"./QTable.dbf1f078.js";import{Q as A}from"./QDialog.d832f787.js";import{Q as j}from"./QInput.1622385a.js";import{Q as z}from"./QCardActions.acb6c307.js";import{Q as J}from"./QForm.a4b8484e.js";import{Q as _e}from"./QFooter.9da741d8.js";import{Q as we}from"./QPage.6b3d4261.js";import{C as Y}from"./ClosePopup.85079279.js";import{u as W}from"./VDB.40e0e52b.js";import{u as Pe,c as Z}from"./cashApi.f9ab100c.js";import{P as he}from"./ProductsAutocomplete.a2fa634e.js";import{Q as ke}from"./QSpace.4eaae24f.js";import{u as X}from"./use-quasar.03dae121.js";import"./axios.ba7b1b0e.js";import{R as N}from"./resoursesOrder.1372bab5.js";import{_ as De}from"./PaymentSales.60e77bd7.js";import{o as Ce}from"./orderApi.2c82d5dd.js";import"./QList.25de2146.js";import"./QSelect.aba570a7.js";import"./use-key-composition.3d5c685a.js";import"./uid.937d8ee7.js";import"./QItemSection.78b45b77.js";import"./position-engine.ef70afb5.js";import"./rtl.276c3f1b.js";import"./QLinearProgress.c27a8b87.js";import"./QCheckbox.54ac594f.js";import"./QResizeObserver.50734c85.js";/* empty css                                                                         */import"./axios.9ab26c22.js";const Ve={class:"row"},Ne={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},Qe={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},Se={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},Be={class:"row"},$e={class:"text-h6 col text-bold text-left"},Re={class:"text-h6 col text-bold text-right"},Ae={class:"text-subtitle2 col"},Te={class:"text-center"},qe={class:"q-pa-xs"},Ee={class:"row items-center justify-center q-gutter-md"},Fe={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(d,{emit:T}){W();const v=X();G(),H();const l=d,b=T,C=D(()=>!l.product.pivot.amountDelivered||l.product.pivot.amountDelivered<=0),u=D(()=>l.product.pivot._supply_by==3?l.product.pivot.amountDelivered*l.product.pieces:l.product.pivot._supply_by==2?l.product.pivot.amountDelivered*12:l.product.pivot.amountDelivered),m=D(()=>l._price_list<=3?[1,2,3,4]:[l._price_list]),n=D(()=>l._price_list<=3?u.value>=l.product.pieces&&(l.product.pivot._supply_by==1||l.product.pivot._supply_by==2)||l.product.pivot._supply_by==3?4:N.verificarPrecioDocena(l.products,l.product,l.rules)?3:N.verificarPrecioMayoreo(l.products,l.product,l.rules)?2:1:l._price_list),a=()=>{b("reset")},y=async()=>{v.loading.show({message:"Editando Producto"});let P=l.product.prices.find(p=>p.id==n.value).pivot.price,c=u.value*P;l.product.pivot.toDelivered=u.value,l.product.pivot._price_list=n.value,l.product.pivot.price=P,l.product.pivot.total=c,v.loading.hide(),a(),N.actualizarPreciosProductosSales(l.products,l._price_list,l.rules),b("editProduct")},S=async()=>{v.loading.show({message:"Agregando producto"});let P=l.product.prices.find(p=>p.id==n.value).pivot.price,c=u.value*P;l.product.pivot.toDelivered=u.value,l.product.pivot._price_list=n.value,l.product.pivot.price=P,l.product.pivot.total=c,l.product.pivot._product=l.product.id,console.log(l.product),b("addProduct",l.product),v.loading.hide(),N.actualizarPreciosProductosSales(l.products,l._price_list,l.rules)},B=async()=>{v.loading.show({message:"Eliminando Producto"}),b("deleteProduct",l.product),v.loading.hide(),N.actualizarPreciosProductosSales(l.products,l._price_list,l.rules)};return(P,c)=>(w(),h(V,null,{default:s(()=>[o(g,{class:"item-center"},{default:s(()=>[i("div",Ve,[i("div",Ne,_(d.product.categories.familia.seccion.name),1),i("div",Qe,_(d.product.categories.familia.name),1),i("div",Se,_(d.product.categories.name),1)])]),_:1}),o(g,{class:"item-center"},{default:s(()=>[i("div",Be,[i("div",$e,_(d.product.code),1),i("div",Re,_(d.product.name),1)]),i("div",Ae,_(d.product.description),1)]),_:1}),o(g,{class:"item-center row"},{default:s(()=>[(w(!0),K(ve,null,me(d.product.prices.filter(p=>m.value.includes(p.id)),(p,$)=>(w(),K("div",{class:"col text-subtitle2 text-center",key:$},[i("div",{class:M(p.id==n.value?"text-weight-bold":"text-caption text-strike")},_(p.alias),3),o(k,{spaced:"",inset:"",vertical:"",dark:""}),i("div",{class:M(p.id==n.value?"text-bold  text-blue-13":"text-caption")},_(p.pivot.price),3),o(k,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),o(g,null,{default:s(()=>[i("div",Te,[i("div",qe,[c[4]||(c[4]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",Ee,[o(f,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:c[0]||(c[0]=p=>d.product.pivot.amountDelivered>1?d.product.pivot.amountDelivered--:"")}),I(i("input",{type:"number",min:"1","onUpdate:modelValue":c[1]||(c[1]=p=>d.product.pivot.amountDelivered=p),class:"text-center exo",style:{width:"100px","font-size":"3em",border:"none"},autofocus:"",onKeydown:c[2]||(c[2]=fe(p=>d.edit?y():S(),["enter"]))},null,544),[[ge,d.product.pivot.amountDelivered]]),o(f,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:c[3]||(c[3]=p=>d.product.pivot.amountDelivered++)})])])])]),_:1}),o(z,null,{default:s(()=>[o(f,{flat:"",icon:"close",onClick:a}),o(ke),d.edit?Q("",!0):(w(),h(f,{key:0,flat:"",icon:"add",color:"positive",onClick:S,disable:C.value},null,8,["disable"])),d.edit?(w(),h(f,{key:1,flat:"",icon:"delete",color:"negative",onClick:B})):Q("",!0),d.edit?(w(),h(f,{key:2,flat:"",icon:"edit",color:"warning",onClick:y,disable:C.value},null,8,["disable"])):Q("",!0)]),_:1})]),_:1}))}},Le={class:"col"},Ie={class:"col"},ze={class:"col"},Ue={class:"text-center text-h6"},Ke={class:"col"},Me={class:"text-center text-h6"},ht={__name:"salesEstandar",setup(d){const T=W(),v=X();G(),H();const l=Pe();console.log(l.rules);const b=x(null),C=x({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),u=x({val:null,opts:[]}),m=x({val:null,opts:[]}),n=x({state:!1,val:null,edit:!1}),a=x({client:null,dependiente:null,products:[]}),y=x(!1),S=x({columns:[{name:"code",label:"Codigo",field:e=>e.code,align:"left"},{name:"description",label:"Descripcion",field:e=>e.description,align:"left"},{name:"verify",label:"Verificado",field:e=>e.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:e=>e.pivot.price,align:"center"},{name:"total",label:"Total",field:e=>e.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),B=x({columns:[{name:"id",label:"Codigo",field:e=>e.id,align:"left"},{name:"Nombre",label:"Descripcion",field:e=>e.name,align:"left"},{name:"Telefono",label:"Pedido",field:e=>e.celphone,align:"center"}],pagination:{rowsPerPage:0}}),P=x({columns:[{name:"id",label:"Codigo",field:e=>e.id,align:"left"},{name:"Nombre",label:"Descripcion",field:e=>e.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),c=D(()=>Number(a.value.products.reduce((e,t)=>e+t.pivot.total,0)).toFixed(2)),p=D(()=>a.value.products.reduce((e,t)=>e+Number(t.pivot.toDelivered),0)),$=D(()=>a.value.products.length>0&&a.value.dependiente&&a.value.client),ee=e=>{console.log(e);let t=a.value.products.findIndex(r=>r.id==e.id);t>=0?(n.value.val=a.value.products[t],n.value.state=!0,n.value.edit=!0):(e.pivot=C.value,n.value.val=e,n.value.state=!0,n.value.edit=!1)},te=e=>{console.log(e);let t=a.value.products.findIndex(r=>r.id==e.id);t>=0?(n.value.val=a.value.products[t],n.value.state=!0,n.value.edit=!0):(e.pivot=C.value,n.value.val=e,n.value.state=!0,n.value.edit=!1)},le=(e,t)=>{console.log(t),n.value.val=t,n.value.edit=!0,n.value.state=!0},oe=()=>{console.log("cambio de cliente"),u.value.state=!0},ae=async()=>{if(u.value.val){const e=await Ce.getClient(u.value);e.fail?console.log(e):e.length>0?(console.log(e),u.value.opts=e):v.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(e)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},ie=async(e,t)=>{v.loading.show({message:"Recalculando Ticket"}),a.value.client=t,N.actualizarPreciosProductosSales(a.value.products,t._price_list,l.rules),u.value={state:!1,val:null,opts:[]},v.loading.hide()},se=()=>{console.log("cambio de cliente"),m.value.state=!0},ne=async()=>{if(m.value.val){let e={val:m.value.val,sto:T.session.store.id};const t=await Z.getDependiente(e);t.fail?console.log(t):t.length>0?(console.log(t),m.value.opts=t):v.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},re=(e,t)=>{a.value.dependiente=t,m.value={state:!1,val:null,opts:[]},v.loading.hide()},ue=e=>{a.value.products.push(e),q(),R(()=>{var t;(t=b.value)==null||t.focus()})},de=()=>{R(()=>{var e;(e=b.value)==null||e.focus()})},ce=e=>{let t=a.value.products.findIndex(r=>r.id==e.id);t>=0&&(a.value.products.splice(t,1),q()),R(()=>{var r;(r=b.value)==null||r.focus()})},pe=async e=>{v.loading.show({message:"Realizando Ticket"}),a.value.payments=e,a.value.change=e.conditions.super?0:Number.parseFloat(e.SFPA.val)+Number.parseFloat(e.PFPA.val)+Number.parseFloat(e.VALE.val)-a.value.products.reduce((E,F)=>E+F.pivot.total,0),a.value.total=a.value.products.reduce((E,F)=>E+F.pivot.total,0);let t={order:a.value,cashier:l.cash};console.log(t);const r=await Z.addSaleStandar(t);r.fail?console.log(r):(console.log(r),y.value=!1,a.value={client:null,dependiente:null,products:[]},localStorage.removeItem("current_sale"),v.loading.hide())},q=()=>{n.value={state:!1,val:null,edit:!1},C.value={amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},R(()=>{var e;(e=b.value)==null||e.focus()})},U=e=>{e.ctrlKey&&e.key.toLowerCase()==="b"?(e.preventDefault(),u.value.state||(u.value.state=!0)):e.ctrlKey&&e.key.toLowerCase()==="d"?(e.preventDefault(),m.value.state||(m.value.state=!0)):e.altKey&&e.key==="Enter"&&$.value&&(e.preventDefault(),y.value||(y.value=!0))};return be(()=>a.value,e=>{localStorage.setItem("current_sale",JSON.stringify(e))},{deep:!0}),ye(()=>{const e=localStorage.getItem("current_sale");e&&(a.value=JSON.parse(e)),window.addEventListener("keydown",U)}),xe(()=>{window.removeEventListener("keydown",U)}),(e,t)=>(w(),h(we,null,{default:s(()=>[o(V,{class:"my-card"},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[i("div",Le,[t[7]||(t[7]=i("div",{class:"text-caption text-center"},"Dependiente",-1)),o(f,{class:"full-width",flat:"",label:a.value.dependiente?a.value.dependiente.complete_name:"CTRL+d",onClick:se},null,8,["label"])]),o(k,{spaced:"",inset:"",vertical:"",dark:""}),i("div",Ie,[t[8]||(t[8]=i("div",{class:"text-caption text-center"},"Cliente",-1)),o(f,{class:"full-width",flat:"",label:a.value.client?a.value.client.name:"CTRL+b",onClick:oe},null,8,["label"])])]),_:1})]),_:1}),o(k,{spaced:"",inset:"",vertical:"",dark:""}),o(V,{class:"my-card"},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[i("div",ze,[t[9]||(t[9]=i("div",{class:"text-caption text-center"},"Total",-1)),i("div",Ue,"$ "+_(c.value),1)]),i("div",Ke,[t[10]||(t[10]=i("div",{class:"text-caption text-center"},"Cantidad",-1)),i("div",Me,_(p.value),1)])]),_:1})]),_:1}),o(k,{spaced:"",inset:"",vertical:"",dark:""}),o(L,{rows:a.value.products,columns:S.value.columns,"hide-bottom":"",pagination:S.value.pagination,onRowClick:le},null,8,["rows","columns","pagination"]),o(A,{modelValue:n.value.state,"onUpdate:modelValue":t[0]||(t[0]=r=>n.value.state=r),persistent:"",position:"bottom"},{default:s(()=>[o(Fe,{product:n.value.val,_price_list:u.value.val?u.value.val._price_list:1,edit:n.value.edit,onReset:q,products:a.value.products,rules:O(l).rules,onAddProduct:ue,onDeleteProduct:ce,onEditProduct:de},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),o(A,{modelValue:u.value.state,"onUpdate:modelValue":t[2]||(t[2]=r=>u.value.state=r)},{default:s(()=>[o(V,{style:{width:"700px"}},{default:s(()=>[o(J,{onSubmit:ae},{default:s(()=>[t[11]||(t[11]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),t[12]||(t[12]=i("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),o(g,null,{default:s(()=>[o(k,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[o(j,{autofocus:"",modelValue:u.value.val,"onUpdate:modelValue":t[1]||(t[1]=r=>u.value.val=r),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),u.value.opts.length>0?(w(),h(g,{key:0},{default:s(()=>[o(L,{rows:u.value.opts,columns:B.value.columns,pagination:B.value.pagination,onRowClick:ie},null,8,["rows","columns","pagination"])]),_:1})):Q("",!0),o(z,{align:"right"},{default:s(()=>[I(o(f,{flat:"",label:"Cancelar",color:"primary"},null,512),[[Y]]),o(f,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(A,{modelValue:m.value.state,"onUpdate:modelValue":t[4]||(t[4]=r=>m.value.state=r)},{default:s(()=>[o(V,{style:{width:"700px"}},{default:s(()=>[o(J,{onSubmit:ne},{default:s(()=>[t[13]||(t[13]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),t[14]||(t[14]=i("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),o(g,null,{default:s(()=>[o(k,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[o(j,{autofocus:"",modelValue:m.value.val,"onUpdate:modelValue":t[3]||(t[3]=r=>m.value.val=r),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),m.value.opts.length>0?(w(),h(g,{key:0},{default:s(()=>[o(L,{rows:m.value.opts,columns:P.value.columns,pagination:P.value.pagination,onRowClick:re},null,8,["rows","columns","pagination"])]),_:1})):Q("",!0),o(z,{align:"right"},{default:s(()=>[I(o(f,{flat:"",label:"Cancelar",color:"primary"},null,512),[[Y]]),o(f,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",null,[o(A,{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=r=>y.value=r)},{default:s(()=>[o(De,{total:Number(c.value),paymeths:O(l).methods,client:a.value.client.id,onSendTicket:pe},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),o(_e,{bordered:"",class:"bg-white"},{default:s(()=>[o(V,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[o(he,{ref_key:"productRef",ref:b,class:"col",checkState:!1,onInput:te,onAgregar:ee},null,512),$.value?(w(),h(f,{key:0,color:"primary",flat:"",icon:"east",onClick:t[6]||(t[6]=r=>y.value=!y.value),round:""})):Q("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{ht as default};
