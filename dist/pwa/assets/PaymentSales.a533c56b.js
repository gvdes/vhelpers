import{Q as w,a as C}from"./QSelect.bdb70cce.js";import{Q as k}from"./QSeparator.43e7e763.js";import{r as P,c as x,q as U,p as I,o as r,a as p,w as d,f as t,a4 as v,e as o,Q as f,h as u,g as A,ay as q,az as z,a3 as N}from"./index.10c0a9f8.js";import{Q as E}from"./QInput.21c15279.js";import{a as V,Q as M}from"./QCard.d5b3fec1.js";import{Q as W,a as O}from"./QItemSection.5d73f537.js";import{Q as R}from"./QCheckbox.866de919.js";import{Q as K}from"./QCardActions.f329ae6b.js";import{u as Y}from"./VDB.e4b287f6.js";import{a as G}from"./axios.9ab26c22.js";import{u as H}from"./use-quasar.d9ca1250.js";const J={class:"bg-primary row items-center justify-between q-pa-md text-white"},X={class:"text-right"},Z={class:"fw-bold text-h4"},ee={class:"row text-center items-center"},le={class:"col"},ae={class:"row text-center items-center"},te={class:"col"},oe={class:"col"},se={class:"row flex justify-center"},ie={class:"col flex justify-center"},de={key:0,class:"col"},ne={key:0,class:"row flex justify-center text-center"},re={class:"col"},ue={class:"col"},ce={class:"row flex justify-center"},ve={class:"col flex justify-center"},me={key:0,class:"col"},pe={class:"row"},fe={class:"text-h5"},be={key:0,class:"text-center"},ge={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(b,{emit:L}){Y();const y=H(),c=P({dafpa:!1,vales:!1}),m=b,j=L,F=P({opts:[]}),l=P({PFPA:{id:m.paymeths[1],val:m.total},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),_=x(()=>Number.parseFloat(l.value.SFPA.val)+Number.parseFloat(l.value.PFPA.val)+Number.parseFloat(l.value.VALE.val)-m.total),h=x(()=>{var i,e,a;return _.value>=0&&(((i=l.value.PFPA.id)==null?void 0:i.id)&&l.value.PFPA.val>0||((e=l.value.SFPA.id)==null?void 0:e.id)&&l.value.SFPA.val>0||((a=l.value.VALE.id)==null?void 0:a.id)&&l.value.VALE.val>0)}),g=x(()=>{const i=Object.values(l.value);if(i.some(n=>n.id&&n.id.alias==="EFE"&&n.val>0))return!1;const a=i.some(n=>n.id&&n.id.alias!=="EFE"),s=i.reduce((n,T)=>n+Number(T.val||0),0);return a&&s>m.total}),B=i=>{var e;return i.id==((e=l.value.SFPA.id)==null?void 0:e.id)},D=i=>{var e;return i.id==((e=l.value.PFPA.id)==null?void 0:e.id)},$=async()=>{y.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let e=`http://192.168.10.160:1619/access/public/modify/vales?price=${m.client}`;G.get(e).then(a=>{console.log(a.data),y.loading.hide();let s=a.data.map(n=>({id:{id:5,alias:"[V]",name:"VALE",code:n.CODANT},val:Number(n.IMPANT)}));F.value.opts=s,c.value.vales=!0}).catch(a=>{console.log(a.response.data),y.notify({html:!0,message:a.response.data,color:"negative",position:"bottom"}),y.loading.hide()})},S=i=>{i.key==="Enter"&&h.value&&(i.preventDefault(),Q())},Q=()=>{l.value.conditions.super=g.value,j("sendTicket",l.value),F.value=P({opts:[]}),l.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return U(()=>{window.addEventListener("keydown",S)}),I(()=>{window.removeEventListener("keydown",S)}),(i,e)=>(r(),p(M,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:d(()=>[t("div",J,[e[11]||(e[11]=t("div",null,[t("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),t("div",X,[e[10]||(e[10]=t("div",{class:"fs-dec3"},"Total Actual",-1)),t("div",Z,"$ "+v(b.total),1)])]),o(V,null,{default:d(()=>{var a;return[t("div",ee,[e[12]||(e[12]=t("div",{class:"col"}," Forma de pago: ",-1)),t("div",le,[o(w,{class:"col-3",modelValue:l.value.PFPA.id,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.PFPA.id=s),options:b.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":s=>B(s)},null,8,["modelValue","options","option-disable"])])]),o(k,{spaced:"",inset:"",vertical:"",dark:""}),t("div",ae,[t("div",te,v(((a=l.value.PFPA.id)==null?void 0:a.id)==2?"Efectivo":"Importe Cobrado"),1),t("div",oe,[o(E,{class:"col",modelValue:l.value.PFPA.val,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.PFPA.val=s),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:d(()=>[parseFloat(l.value.PFPA.val)?(r(),p(f,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:e[1]||(e[1]=s=>l.value.PFPA.val=0)})):u("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),o(V,null,{default:d(()=>{var a;return[t("div",se,[t("div",ie,[o(f,{color:"primary",label:"2\xAA Forma de pago",onClick:e[3]||(e[3]=()=>{c.value.dafpa=!c.value.dafpa,l.value.SFPA.val=0,l.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),c.value.dafpa?(r(),A("div",de,[o(w,{class:"col-3",modelValue:l.value.SFPA.id,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.SFPA.id=s),options:b.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":s=>D(s)},null,8,["modelValue","options","option-disable"])])):u("",!0)]),o(k,{spaced:"",inset:"",vertical:"",dark:""}),c.value.dafpa?(r(),A("div",ne,[t("div",re,v(((a=l.value.SFPA.id)==null?void 0:a.id)==2?"Efectivo":"Importe Cobrado"),1),t("div",ue,[o(E,{class:"col",modelValue:l.value.SFPA.val,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.SFPA.val=s),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:d(()=>[parseFloat(l.value.SFPA.val)?(r(),p(f,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:e[5]||(e[5]=s=>l.value.SFPA.val=0)})):u("",!0)]),_:1},8,["modelValue"])])])):u("",!0)]}),_:1}),o(V,null,{default:d(()=>[t("div",ce,[t("div",ve,[o(f,{color:"primary",label:"Cobrar Vale",onClick:$,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),c.value.vales?(r(),A("div",me,[t("div",pe,[o(w,{class:"col",modelValue:l.value.VALE,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.VALE=a),options:F.value.opts,label:"Vale","option-label":a=>`Vale : ${a.id?a.id.code:""}`,dense:"",filled:""},{option:d(a=>[o(W,q(z(a.itemProps)),{default:d(()=>[o(O,null,{default:d(()=>[o(C,null,{default:d(()=>[N(v(a.opt.id.code),1)]),_:2},1024),o(C,{caption:""},{default:d(()=>[N("$ "+v(Number(a.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),o(k,{spaced:"",inset:"",vertical:"",dark:""}),l.value.VALE.id?(r(),p(E,{key:0,modelValue:l.value.VALE.val,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.VALE.val=a),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):u("",!0)])])):u("",!0)])]),_:1}),g.value?(r(),p(V,{key:0,class:"flex justify-end"},{default:d(()=>[o(R,{modelValue:l.value.conditions.createWithdrawal,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.conditions.createWithdrawal=a),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):u("",!0),o(K,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:d(()=>[t("div",null,[e[13]||(e[13]=t("div",{class:"fs-dec3"},"Cambio",-1)),t("div",fe," $ "+v(_.value),1)]),h.value?(r(),A("div",be,[o(f,{color:"primary",icon:"payment",label:"Pagar",onClick:Q})])):u("",!0)]),_:1})]),_:1}))}};export{ge as _};
