import{u as O,r as p,c as q,K as R,o as v,d as k,w as l,e,Y as r,_ as f,a1 as T,h,k as Q,a2 as Y,j as w,Q as z,g as n,f as N,be as J,bf as W,i as j,a0 as L,a as X,b5 as Z,a4 as M,ae as ee,aB as le,a3 as ae}from"./index.4f1e6b8e.js";import{Q as te}from"./QHeader.6fc4c4b2.js";import{Q as A,a as P,d as oe}from"./QSelect.892f55ae.js";import{Q as K}from"./QForm.a86eaa06.js";import{Q as se}from"./QToolbar.42091542.js";import{Q as ne}from"./QPage.8631fb96.js";import{Q as ue,a as ie}from"./QLayout.794374f0.js";import{_ as re}from"./UserToolbar.fa5f165a.js";import{a as de,b as H}from"./axios.5ba2e0bd.js";import{u as pe}from"./use-quasar.cb4b6b35.js";import{Q as me,a as F,b as d}from"./QList.a6fb43f5.js";import"./QResizeObserver.8e6a85ba.js";import"./QScrollObserver.47f50e70.js";import"./QExpansionItem.2b7b0a36.js";import"./QDrawer.4fdf7e95.js";import"./ClosePopup.6c60b3b0.js";import"./auth.e499d1ed.js";const ve={__name:"Ticket",props:{data:{type:Object,default:null}},emits:["openCashDesk"],setup(S,{emit:V}){const m=S,I=O(),$=V,s=p(m.data),u=p(null),b=["6%","8%","16%"],_={"6%":.06,"8%":.08,"16%":.16},y=p({body:null,val:null}),c=p(m.data.total),t=q(()=>{if(u.value&&s.value){let D=_[u.value],a=parseFloat(c.value).toFixed(2);return parseFloat((a*D).toFixed(2))}return 0}),i=q(()=>c.value>m.data.total),U=()=>{$("openCashDesk",{_inc:t.value,_iva:_[u.value],impresora:y.value.val.ip_address,_monto:c.value}),console.log(c.value)};return R(()=>{console.log("El componente ha muerto!!")}),(async()=>{let D=I.session.store.id;console.log(D);try{let a=await de.get(`/cashier/getPrinters/${D}`);a.status==200&&(y.value.body=a.data,console.log("Impresoras listas :)"))}catch(a){console.log(a),$q.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}})(),(D,a)=>(v(),k(z,{style:{"min-width":"400px"},flat:"",bordered:""},{default:l(()=>[e(me,{bordered:""},{default:l(()=>[e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[3]||(a[3]=[r("Ticket")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.ticket),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[4]||(a[4]=[r("Cliente")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.cliente),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[5]||(a[5]=[r("Fecha")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.fecha),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[6]||(a[6]=[r("Total")])),_:1}),e(d,null,{default:l(()=>[r("$ "+f(s.value.total),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[7]||(a[7]=[r("Impresora")])),_:1}),e(d,null,{default:l(()=>[e(A,{dense:"",modelValue:y.value.val,"onUpdate:modelValue":a[0]||(a[0]=o=>y.value.val=o),options:y.value.body,label:"Impresora","option-label":"name",filled:"",autofocus:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(T),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[8]||(a[8]=[r("Monto")])),_:1}),e(d,null,{default:l(()=>[e(h,{dense:"",modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value=o),type:"number",label:"Monto",filled:"",autofocus:"","error-message":"El Monto a facturar es mayor que el total de el ticket :x",error:i.value},null,8,["modelValue","error"])]),_:1})]),_:1}),e(T),y.value.val&&!i.value?(v(),k(F,{key:0,class:"bg-deep-purple-1"},{default:l(()=>[e(d,null,{default:l(()=>a[9]||(a[9]=[r("IVA")])),_:1}),e(d,null,{default:l(()=>[e(A,{dense:"",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value=o),options:b,label:"Seleccione",filled:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})):Q("",!0),t.value&&!i.value?(v(),k(F,{key:1,class:"bg-deep-purple-1"},{default:l(()=>[e(d,null,{default:l(()=>a[10]||(a[10]=[r("Total")])),_:1}),e(d,null,{default:l(()=>[e(P,{class:"fc-bluegrey text-h4 fw-sbold"},{default:l(()=>[r("$ "+f(t.value),1)]),_:1}),e(P,{caption:""},{default:l(()=>[r("$ "+f((parseFloat(s.value.total)+parseFloat(t.value)).toFixed(2)),1)]),_:1})]),_:1})]),_:1})):Q("",!0)]),_:1}),u.value&&!i.value?(v(),k(Y,{key:0,align:"between"},{default:l(()=>[e(w,{color:"primary",label:"Cancelar",flat:"","no-caps":""}),e(w,{color:"primary",label:"Cobrar",onClick:U})]),_:1})):Q("",!0)]),_:1}))}},ce={class:"bg-primary row items-center justify-between q-pa-md text-white"},fe={class:"text-h4"},be={class:"text-right"},ye={class:"fw-bold text-h4"},ge={class:"row items-center"},_e={class:"row"},ke={class:"bg-grey-2 row items-stretch justify-between q-pa-sm"},Ve={class:"text-h5 fw-sbold fc-primary"},xe={class:"text-h6 fs-inc3 fw-bold fc-negative"},Fe={__name:"CashDesk",props:{data:{type:Object,default:null},inc:{type:Number,default:0}},emits:["pay"],setup(S,{emit:V}){const m=[{id:"TBA",desc:"Tarjeta Credito/Debito BBVA (Bancomer)"},{id:"TDB",desc:"Transferencia/Deposito BBVA (Bancomer)"},{id:"TSA",desc:"Tarjeta Credito/Debito Santander"},{id:"TDA",desc:"Transferencia/Deposito Santander"}],I=S,$=V,s=p({EFE:0,DIG:{id:null,val:0}}),u=p(I.data),b=p(I.inc),_=q(()=>(parseFloat(s.value.EFE)+parseFloat(s.value.DIG.val)).toFixed(2)),y=()=>{$("pay",s.value)};return(c,t)=>u.value?(v(),k(z,{key:0},{default:l(()=>[n("div",ce,[n("div",null,[t[5]||(t[5]=n("div",{class:"fs-dec3"},"TICKET",-1)),n("div",fe,f(u.value.ticket),1)]),n("div",be,[t[6]||(t[6]=n("div",{class:"fs-dec3"},"IVA",-1)),n("div",ye,"$ "+f(b.value),1)])]),e(K,{class:"q-pa-none",onSubmit:y},{default:l(()=>[e(N,null,{default:l(()=>[n("div",ge,[t[7]||(t[7]=n("div",{class:"col-3"},"Efectivo",-1)),e(h,{class:"col",modelValue:s.value.EFE,"onUpdate:modelValue":t[0]||(t[0]=i=>s.value.EFE=i),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue"]),parseFloat(s.value.EFE)?(v(),k(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:t[1]||(t[1]=i=>s.value.EFE=0)})):Q("",!0)])]),_:1}),e(N,null,{default:l(()=>[n("div",_e,[e(A,{class:"col-3",modelValue:s.value.DIG.id,"onUpdate:modelValue":t[2]||(t[2]=i=>s.value.DIG.id=i),options:m,label:"Terminal","option-value":"id","emit-value":"","option-label":"id",dense:""},{option:l(i=>[e(F,J(W(i.itemProps)),{default:l(()=>[e(d,null,{default:l(()=>[e(P,{class:"text-bold"},{default:l(()=>[r(f(i.opt.id),1)]),_:2},1024),e(P,{caption:""},{default:l(()=>[r(f(i.opt.desc),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),e(h,{class:"col",modelValue:s.value.DIG.val,"onUpdate:modelValue":t[3]||(t[3]=i=>s.value.DIG.val=i),type:"number",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue"]),parseFloat(s.value.DIG.val)?(v(),k(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:t[4]||(t[4]=i=>{s.value.DIG.val=0,s.value.DIG.id=null})})):Q("",!0)])]),_:1}),e(T),n("div",ke,[n("div",null,[_.value>=b.value?(v(),j(L,{key:0},[t[8]||(t[8]=n("div",{class:"fs-dec1"},"Cambio:",-1)),n("div",Ve,"$ "+f((_.value-b.value).toFixed(2)),1)],64)):(v(),j(L,{key:1},[t[9]||(t[9]=n("div",{class:"fs-dec1"},"Falta:",-1)),n("div",xe,"$ "+f((b.value-_.value).toFixed(2)),1)],64))]),n("div",null,[_.value>=b.value?(v(),k(w,{key:0,color:"positive",icon:"fas fa-dollar-sign",label:"Pagar",type:"submit",class:"full-height"})):Q("",!0)])])]),_:1})]),_:1})):Q("",!0)}};const Qe={key:0,class:"text-right"},$e={class:"row justify-center"},Me={__name:"IvaLayout",setup(S){X();const V=O(),m=pe(),I=V.series,$=p(null),s=p(""),u=p(null),b=p(0),_=p(0),y=p(0),c=p({state:!1}),t=p(null),i=q(()=>$.value&&s.value.length),U=async()=>{u.value=null,b.value=0;let a=$.value,o=s.value,C=`http://${V.session.store.ip_address}/access/public/iva/ticket?serie=${a}&folio=${o}`;H.get(C).then(x=>{u.value=x.data}).catch(x=>{console.log(x);let B=x.response.status,E=x.response.data;console.log(B),console.log(E),m.notify({html:!0,message:E.message,color:"negative",position:"center"})})},G=({_inc:a,_iva:o,impresora:g,_monto:C})=>{console.log(a,o,g,C),t.value=g,b.value=parseFloat(a),_.value=parseFloat(o),y.value=parseFloat(C),c.value.state=!0},D=a=>{console.log("pagando..."),console.log(a);let o=V.session.store.ip_address,g=`${V.session.name} - ${V.session.store.alias}`,C=`http://${o}/access/public/iva/create`,x={modes:a,by:g,ticket:u.value.ticket,iva:_.value,monto:y.value,impresora:t.value};console.log(x),m.loading.show({message:"Imprimiendo..."}),console.log(x),H.post(C,x).then(B=>{console.log(B.data);let E=B.data;m.loading.hide(),c.value.state=!1,u.iva=null,u.value=null,m.notify({html:!0,color:"positive",position:"center",message:`<span class="fs-inc2"> El ticket <b>${E.ticket}</b> fue generado! </span>`}),E.printed||m.notify({html:!0,color:"negative",position:"top",icon:"fas fa-bugs",message:'<span class="fs-inc2"> No se pudo emitir el ticket, la conexion a la impresora no esta disponible! </span>'})}).catch(B=>{console.log(B),m.loading.hide()})};return(a,o)=>(v(),k(ue,{view:"hHh Lpr fFf"},{default:l(()=>[e(te,{class:Z(M(m).dark.isActive?"text-white bg-dark":"text-dark bg-white"),bordered:""},{default:l(()=>[e(re),e(T)]),_:1},8,["class"]),e(ie,null,{default:l(()=>[e(se,{class:"justify-between"},{default:l(()=>[n("div",null,[o[3]||(o[3]=r("Helpers ")),e(ee,{name:"navigate_next",color:"primary"}),o[4]||(o[4]=r()),o[5]||(o[5]=n("span",{class:"text-h6"},"IVA",-1))]),e(w,{color:"primary",icon:"add"},{default:l(()=>[e(oe,null,{default:l(()=>[o[6]||(o[6]=n("div",{class:"q-pa-md text-primary"},"Buscar Folio",-1)),e(T),e(K,{dense:"",onSubmit:U,class:"q-gutter-md q-pa-md"},{default:l(()=>[e(A,{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=g=>$.value=g),options:M(I),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(h,{modelValue:s.value,"onUpdate:modelValue":o[1]||(o[1]=g=>s.value=g),type:"number",label:"Folio"},null,8,["modelValue"]),i.value?(v(),j("div",Qe,[e(w,{type:"submit",color:"primary",icon:"search"})])):Q("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(ne,{class:"",padding:""},{default:l(()=>[n("div",$e,[e(le,{name:"bounce"},{default:l(()=>[u.value?(v(),k(ve,{key:0,data:u.value,onOpenCashDesk:G},null,8,["data"])):Q("",!0)]),_:1})]),e(ae,{modelValue:c.value.state,"onUpdate:modelValue":o[2]||(o[2]=g=>c.value.state=g)},{default:l(()=>[e(Fe,{data:u.value,inc:b.value,onPay:D},null,8,["data","inc"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Me as default};
