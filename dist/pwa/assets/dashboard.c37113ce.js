import{Q as Ye}from"./QDate.b1b2b6f2.js";import{l as ve,b7 as Ae,b8 as je,s as J,ak as He,ax as Ge,am as Je,aA as Ke,c as q,a4 as We,v as Ee,a5 as Xe,r as b,q as Ze,O as et,bo as tt,R as de,bJ as at,bK as lt,be as ot,br as $e,aL as st,o as p,i as S,e,w as t,f as j,g as r,W as g,ab as B,X as te,k as N,d as P,j as Q,_ as T,Z as W,ad as k,h as pe,a1 as se,a0 as Z,ac as it,af as nt,Q as G,$ as ee,Y as K,ae as Ce,a as Me,u as Ie,aa as rt,a_ as dt,J as ut}from"./index.02e98f23.js";import{d as ae}from"./dayjs.min.cbcf888d.js";import"./axios.87cc1b88.js";import{u as ge}from"./Restock.067c1366.js";import{u as be}from"./use-quasar.dc53eb3e.js";import{$sktRestock as Se}from"./socket.168d2ba4.js";import{Q as ie,a as De}from"./QTable.6c1ae328.js";import{Q as ye}from"./QTr.fd11d386.js";import{Q as ke}from"./QTd.aa6e26ad.js";import{Q as ce,a as le,b as V}from"./QList.87ca2251.js";import{b as ct,d as xe,a as L}from"./QSelect.53941b07.js";import{Q as mt}from"./QPage.2e793c9e.js";import{R as O}from"./RestockApi.bbaae04d.js";import{Q as he,a as pt,b as we}from"./QTabPanels.795c9c92.js";import{Q as ft}from"./QTabs.dc3a16b7.js";import{Q as vt}from"./QBadge.ff79e128.js";import{C as me}from"./ClosePopup.5123f35e.js";import{I as Qe}from"./invoices.c84a19d5.js";import"./browser.c61f550a.js";import{_ as Pe}from"./PrinterSelect.d6dae40f.js";import"./use-render-cache.3aae9b27.js";import"./date.4e270c80.js";import"./_commonjsHelpers.88e99c8f.js";import"./QToolbar.8b422708.js";import"./QForm.e9331a52.js";import"./QPopupEdit.9cd56f95.js";import"./QLayout.035d2614.js";import"./QScrollObserver.beba53c5.js";import"./QResizeObserver.04e1b2fd.js";import"./QExpansionItem.3c424fa7.js";import"./QDrawer.eb1e7cb5.js";import"./jspdf.plugin.autotable.81876de4.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";/* empty css                                                       */import"./QLinearProgress.aa0b5254.js";import"./TouchSwipe.d9573c9b.js";import"./QBtnGroup.d473a362.js";const gt='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var bt=ve({name:"QSpinnerGrid",props:Ae,setup(s){const{cSize:_,classes:d}=je(s);return()=>J("svg",{class:d.value,fill:"currentColor",width:_.value,height:_.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:gt})}}),_t=ve({name:"QInnerLoading",props:{...He,...Ge,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(s,{slots:_}){const d=Ee(),f=Je(s,d.proxy.$q),{transitionProps:y,transitionStyle:w}=Ke(s),v=q(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(f.value===!0?" q-inner-loading--dark":"")),i=q(()=>"q-inner-loading__label"+(s.labelClass!==void 0?` ${s.labelClass}`:""));function C(){const c=[J(Xe,{size:s.size,color:s.color})];return s.label!==void 0&&c.push(J("div",{class:i.value,style:s.labelStyle},[s.label])),c}function x(){return s.showing===!0?J("div",{class:v.value,style:w.value},_.default!==void 0?_.default():C()):null}return()=>J(We,y.value,x)}});const yt='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var kt=ve({name:"QSpinnerDots",props:Ae,setup(s){const{cSize:_,classes:d}=je(s);return()=>J("svg",{class:d.value,fill:"currentColor",width:_.value,height:_.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:yt})}});const Ve=XMLHttpRequest,Ne=Ve.prototype.open,xt=["top","right","bottom","left"];let fe=[],oe=0;function ht({p:s,pos:_,active:d,horiz:f,reverse:y,dir:w}){let v=1,i=1;return f===!0?(y===!0&&(v=-1),_==="bottom"&&(i=-1),{transform:`translate3d(${v*(s-100)}%,${d?0:i*-200}%,0)`}):(y===!0&&(i=-1),_==="right"&&(v=-1),{transform:`translate3d(${d?0:w*v*-200}%,${i*(s-100)}%,0)`})}function wt(s,_){return typeof _!="number"&&(s<25?_=Math.random()*3+3:s<65?_=Math.random()*3:s<85?_=Math.random()*2:s<99?_=.6:_=0),ct(s+_,0,100)}function Ct(s){oe++,fe.push(s),!(oe>1)&&(Ve.prototype.open=function(_,d){const f=[],y=()=>{fe.forEach(v=>{(v.hijackFilter.value===null||v.hijackFilter.value(d)===!0)&&(v.start(),f.push(v.stop))})},w=()=>{f.forEach(v=>{v()})};this.addEventListener("loadstart",y,{once:!0}),this.addEventListener("loadend",w,{once:!0}),Ne.apply(this,arguments)})}function St(s){fe=fe.filter(_=>_.start!==s),oe=Math.max(0,oe-1),oe===0&&(Ve.prototype.open=Ne)}var $t=ve({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:s=>xt.includes(s)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(s,{emit:_}){const{proxy:d}=Ee(),f=b(0),y=b(!1),w=b(!0);let v=0,i=null,C;const x=q(()=>`q-loading-bar q-loading-bar--${s.position}`+(s.color!==void 0?` bg-${s.color}`:"")+(w.value===!0?"":" no-transition")),c=q(()=>s.position==="top"||s.position==="bottom"),U=q(()=>c.value===!0?"height":"width"),F=q(()=>{const D=y.value,I=ht({p:f.value,pos:s.position,active:D,horiz:c.value,reverse:d.$q.lang.rtl===!0&&["top","bottom"].includes(s.position)?s.reverse===!1:s.reverse,dir:d.$q.lang.rtl===!0?-1:1});return I[U.value]=s.size,I.opacity=D?1:0,I}),Y=q(()=>y.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":f.value}:{"aria-hidden":"true"});function M(D=300){const I=C;return C=Math.max(0,D)||0,v++,v>1?(I===0&&D>0?E():i!==null&&I>0&&D<=0&&(clearTimeout(i),i=null),v):(i!==null&&clearTimeout(i),_("start"),f.value=0,i=setTimeout(()=>{i=null,w.value=!0,D>0&&E()},y._value===!0?500:1),y._value!==!0&&(y.value=!0,w.value=!1),v)}function h(D){return v>0&&(f.value=wt(f.value,D)),v}function A(){if(v=Math.max(0,v-1),v>0)return v;i!==null&&(clearTimeout(i),i=null),_("stop");const D=()=>{w.value=!0,f.value=100,i=setTimeout(()=>{i=null,y.value=!1},1e3)};return f.value===0?i=setTimeout(D,1):D(),v}function E(){f.value<100&&(i=setTimeout(()=>{i=null,h(),E()},C))}let z;return Ze(()=>{s.skipHijack!==!0&&(z=!0,Ct({start:M,stop:A,hijackFilter:q(()=>s.hijackFilter||null)}))}),et(()=>{i!==null&&clearTimeout(i),z===!0&&St(M)}),Object.assign(d,{start:M,stop:A,increment:h}),()=>J("div",{class:x.value,style:F.value,...Y.value})}});const ue=b(null),qe=tt({isActive:!1},{start:de,stop:de,increment:de,setDefaults:de,install({$q:s,parentApp:_}){if(s.loadingBar=this,this.__installed===!0){s.config.loadingBar!==void 0&&this.setDefaults(s.config.loadingBar);return}const d=b(s.config.loadingBar!==void 0?{...s.config.loadingBar}:{});function f(){qe.isActive=!0}function y(){qe.isActive=!1}const w=at("q-loading-bar");lt({name:"LoadingBar",devtools:{hide:!0},setup:()=>()=>J($t,{...d.value,onStart:f,onStop:y,ref:ue})},_).mount(w),Object.assign(this,{start(v){ue.value.start(v)},stop(){ue.value.stop()},increment(){ue.value.increment.apply(null,arguments)},setDefaults(v){ot(v)===!0&&Object.assign(d.value,v)}})}}),Vt={class:"text-h6"},Dt={class:"q-px-lg text-center"},Qt={class:"text-h6"},Pt={class:"text-right"},qt={class:"text-h6"},At={class:"text-center col"},jt={class:"text-h6"},Et={key:0,class:"text-center col"},Mt={class:"text-h6"},It={class:"col row"},Nt={key:1,class:"col"},Bt={class:"full-width row items-center"},Tt={class:"col text-dark"},Ut={class:"text-h6"},zt={class:"text-bold"},Rt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},Lt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ot={class:"text-bold"},Ft={class:"text-overline text-grey-7"},Yt={key:0},Ht={key:1},Gt={key:0},Jt={key:1},Kt={class:"row"},Wt={key:0,class:"col"},Xt={class:"q-ml-sm text-bold"},Zt={class:"q-ml-sm"},ea={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(s,{emit:_}){const d=be(),f=ge();$e();const y=b([]),w=s,v=b({opts:[],val:[],filter:[]});b({opts:null,val:null,filter:null});const i=b({val:null,state:!1}),C=b(null),x=_,c=b(w.head),U=b(null),F=b(!0),Y=b([]),M=b("supliers"),h=b(null),A=b([]),E=b(!1);b({state:!1}),b({state:!1,key:null});const z=b(null),D=b(!1),I=b({state:!1}),m=b(null),u=b([]),n=b({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,o)=>a+o.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,o)=>a+o.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:l=>l.category.familia.seccion.name,align:"left"},{name:"family",label:"Familia",field:l=>l.category.familia.name,align:"left"},{name:"category",label:"Categoria",field:l=>l.category.name,align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),$=q(()=>A.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));q(()=>h.value&&(h.value.id==2||h.value.id==6)),q(()=>Y.value.find(l=>l.id==h.value.id).pivot),q(()=>z.value.map(l=>l._status).includes(6));const X=async()=>{x("loading"),console.log(c.value.id),F.value=!0;let l=await O.order(c.value.id);console.log(l),A.value=l.data.order.products,Y.value=l.data.order.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),z.value=l.data.order.partition,h.value=l.data.order.status,U.value=l.data.order,m.value=l.data.order.invoice,y.value=Object.values(l.data.ubicaciones).map(a=>({...a,partition:1})),v.value.opts=f.users,F.value=!1,x("loaded")},ne=()=>{I.value.state=!0},re=()=>{D.value=!0},_e=async()=>{d.loading.show({message:"Cambiando Estado"}),console.log("Iniciando surtido"),x("loading"),E.value=!0;let l=3,a={id:c.value.id,state:l};const o=await O.nextState(a);if(o.status==200){E.value=!1,d.notify({message:`Surtido iniciado para el pedido  ${c.value.id}`,icon:"done",position:"center",color:"teal"});let H={ubicaciones:y.value,pedido:c.value.id,status:l,_workpoint_to:c.value.to.id,_workpoint_from:c.value.from.id};console.log(H);let R=await O.createParitions(H);console.log(R),R.fail?(console.log(R),alert(`Error ${R.status}: ${R.data} 2`)):(R.forEach(Fe=>{Se.emit("partitionCreate",Fe)}),d.loading.hide(),X(),x("fresh",U.value),I.value.state=!1)}else console.log(o),alert(`Error ${o.status}: ${o.data} 1`);x("loaded")},Be=async l=>{d.loading.show({message:"..."}),console.log(l);const a=await O.printForSupply({ip:l.ip,port:l._port,order:c.value.id});console.log(a),a.status==200?(a.data?d.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):d.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),d.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Te=async l=>{d.loading.show({message:"..."}),console.log(l.ip),console.log(C.value);const a=await O.printForPartition({ip:l.ip,port:l._port,_partition:C.value,_workpoint_to:c.value._workpoint_to});console.log(a),a.status==200?(a.data?d.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):d.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),d.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ue=async()=>{console.log("Eliminando Pedido"),x("loading");let l=100,a={id:c.value.id,state:l};const o=await O.nextState(a);o.status==200?(D.value=!1,d.notify({message:`Surtido Cancelado para el pedido  ${c.value.id}`,icon:"close",position:"center",color:"negative"}),x("fresh",U.value,!0)):alert(`Error ${o.status}: ${o.data} 1`),x("loaded")},ze=l=>{console.log(l.id),C.value=l.id},Re=async l=>{console.log(l);const a=await O.partitionFresh(l.id);console.log(a),a.status==200&&(a.data.order.requisition.from._type!=1?Qe.invoiceFormat(a.data.order):Qe.transferFormat(a.data.order))},Le=l=>{console.log(l),i.value.state=!0,i.value.val=l},Oe=async()=>{d.loading.show({message:"Eliminando Particion"}),console.log(i.value.val);const l=await O.deletePartition(i.value.val);if(l.fail)console.log(l);else{console.log(l),Se.emit("partitionDelete",i.value.val);let a=z.value.findIndex(o=>o.id==i.value.val.id);z.value.splice(a,1),i.value.state=!1,i.value.val=null,d.notify({message:l.data.message,type:"negative",position:"center"}),d.loading.hide()}};return st(()=>u.value=n.value.columns.map(l=>l.name)),X(),(l,a)=>(p(),S(T,null,[e(G,{class:"full-width"},{default:t(()=>[e(j,{class:"row justify-between"},{default:t(()=>[r("div",null,[a[7]||(a[7]=r("div",{class:"text-overline text-grey-7"},"Sucursal",-1)),r("div",Vt,g(c.value.from.alias),1)]),r("div",Dt,[a[8]||(a[8]=r("div",{class:"text-overline text-grey-7"},"Folio",-1)),r("div",Qt,g(c.value.id),1)]),r("div",Pt,[a[9]||(a[9]=r("div",{class:"text-overline text-grey-7"},"Agente",-1)),r("div",qt,g(c.value.created_by.nick),1)])]),_:1}),e(B),e(j,{class:"row justify-between"},{default:t(()=>[r("div",At,[a[10]||(a[10]=r("div",{class:"text-overline text-grey-7"},"Fecha",-1)),r("div",jt,g(te(ae)(c.value.updated_at).format("YYYY-MM-DD")),1)]),c.value.notes?(p(),S("div",Et,[a[11]||(a[11]=r("div",{class:"text-overline text-grey-7 col"},"Notas",-1)),r("div",Mt,g(c.value.notes),1)])):N("",!0),r("div",It,[h.value&&h.value.id>=2?(p(),P(Q,{key:0,size:"md",class:"col",color:"primary",icon:"print",flat:"",dense:""},{default:t(()=>[e(xe,{class:"",style:{"min-width":"250px"}},{default:t(()=>[e(Pe,{onSelected:Be,partition:!1})]),_:1})]),_:1})):N("",!0),e(B,{spaced:"",inset:"",vertical:"",dark:""}),h.value&&h.value.id==2?(p(),S("div",Nt,[e(Q,{size:"12px",class:"full-width",color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:ne,flat:""}),e(B,{spaced:"",inset:"",vertical:"",dark:""}),e(Q,{size:"12px",class:"full-width",color:"negative",icon:"close",dense:"",label:"Cancelar",onClick:re,flat:""})])):N("",!0)])]),_:1}),e(B),F.value?(p(),P(j,{key:0,class:"text-center"},{default:t(()=>[e(kt,{size:"50px",color:"purple"})]),_:1})):(p(),S(T,{key:1},[e(B),e(ft,{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=o=>M.value=o),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(he,{name:"log",label:"Log"}),e(he,{name:"basket",label:"Productos"}),e(he,{name:"supliers",label:"Particiones"})]),_:1},8,["modelValue"]),e(pt,{modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=o=>M.value=o),animated:""},{default:t(()=>[e(we,{name:"log"},{default:t(()=>[e(ce,null,{default:t(()=>[(p(!0),S(T,null,W(Y.value,o=>(p(),P(le,{key:o.id},{default:t(()=>[e(V,{avatar:""},{default:t(()=>[k(g(o.id),1)]),_:2},1024),e(V,null,{default:t(()=>[k(g(o.name),1)]),_:2},1024),e(V,null,{default:t(()=>[k(g(o.pivot.details.responsable),1)]),_:2},1024),e(V,null,{default:t(()=>[k("de "+g(te(ae)(o.pivot.created_at).format("h:mm a"))+" a "+g(te(ae)(o.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(we,{name:"basket"},{default:t(()=>[A.value.length?(p(),P(ie,{key:0,"row-key":"id",flat:"",rows:A.value,columns:n.value.columns,pagination:n.value.pagination,filter:n.value.filter,"visible-columns":u.value},{top:t(()=>[r("div",Bt,[r("div",Tt,[r("span",Ut,[e(Q,{color:"pink-5",icon:"sync",onClick:X,round:"",dense:"",flat:""}),k(" Productos: "+g(A.value.length),1)]),a[12]||(a[12]=k(", ")),r("span",zt,"Piezas: "+g($.value),1)]),e(pe,{dense:"",modelValue:n.value.filter,"onUpdate:modelValue":a[1]||(a[1]=o=>n.value.filter=o),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"]),e(B,{spaced:"",inset:"",vertical:"",dark:""}),e(Q,{color:"secondary",icon:"fas fa-eye","no-caps":"",flat:""},{default:t(()=>[e(xe,{style:{"min-width":"200px"}},{default:t(()=>[e(ce,null,{default:t(()=>[(p(!0),S(T,null,W(n.value.columns,(o,H)=>Z((p(),P(le,{tag:"label",key:H},{default:t(()=>[e(V,null,{default:t(()=>[e(L,null,{default:t(()=>[k(g(o.label),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[k(g(o.coldesc),1)]),_:2},1024)]),_:2},1024),e(V,{side:"",top:""},{default:t(()=>[e(it,{color:"pink-5",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=R=>u.value=R),val:o.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[nt]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(p(),S("div",Rt,"Nada por aqui"))]),_:1}),e(we,{name:"supliers"},{default:t(()=>[e(ie,{rows:z.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(o=>[r("div",Lt,[e(G,{flat:"",bordered:""},{default:t(()=>[e(j,{class:"text-center"},{default:t(()=>[a[13]||(a[13]=k(" Particion: ")),r("span",Ot,g(o.row.id),1),a[14]||(a[14]=r("br",null,null,-1)),e(B,{spaced:"",inset:"",vertical:"",dark:""}),e(se,{name:"print",color:"pink",size:"sm",onClick:H=>ze(o.row)},{default:t(()=>[e(xe,{class:"",style:{"min-width":"250px"}},{default:t(()=>[e(Pe,{onSelectedPartition:Te,partition:!0})]),_:1})]),_:2},1032,["onClick"]),a[15]||(a[15]=r("br",null,null,-1)),r("div",Ft,[e(vt,{color:"primary","text-color":"white",label:o.row.status.name},null,8,["label"])])]),_:2},1024),e(ee,{align:"right"},{default:t(()=>[e(Q,{color:"red",flat:"",icon:"delete",onClick:H=>Le(o.row),disable:o.row._status!=3},null,8,["onClick","disable"])]),_:2},1024),e(B),e(j,{class:"flex justify-between"},{default:t(()=>[c.value.from._type!=1?(p(),S("div",Yt,a[16]||(a[16]=[r("div",null,"Salida",-1),r("div",null,"Entrada",-1)]))):(p(),S("div",Ht,a[17]||(a[17]=[r("div",null,"Traspaso",-1)]))),a[18]||(a[18]=r("div",null,"Herramientas",-1))]),_:1}),e(B),e(j,{class:"flex justify-between"},{default:t(()=>[c.value.from._type!=1?(p(),S("div",Gt,[r("div",null,g(o.row.invoice),1),r("div",null,g(o.row.invoice_received),1)])):(p(),S("div",Jt,[r("div",null,g(o.row.invoice),1)])),r("div",Kt,[o.row._status>=6?(p(),S("div",Wt,[e(Q,{color:"pink",icon:"list",onClick:H=>Re(o.row),flat:""},null,8,["onClick"])])):N("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(K,{modelValue:I.value.state,"onUpdate:modelValue":a[4]||(a[4]=o=>I.value.state=o),persistent:""},{default:t(()=>[e(G,{style:{width:"400px"}},{default:t(()=>[e(j,{class:"row items-center"},{default:t(()=>[e(ce,null,{default:t(()=>[(p(!0),S(T,null,W(y.value,(o,H)=>(p(),P(le,{key:H},{default:t(()=>[e(V,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md",caption:""},{default:t(()=>a[19]||(a[19]=[k("Ubicaciones")])),_:1}),e(L,null,{default:t(()=>[k(g(o.name),1)]),_:2},1024)]),_:2},1024),e(V,{class:"q-mb-lg"},{default:t(()=>[e(L,{class:"q-mb-md text-center",caption:""},{default:t(()=>a[20]||(a[20]=[k("Productos")])),_:1}),e(L,{class:"text-center"},{default:t(()=>[k(g(o.cantidad),1)]),_:2},1024)]),_:2},1024),e(V,{class:"q-mt-md"},{default:t(()=>[e(L,{class:"text-center",caption:""},{default:t(()=>a[21]||(a[21]=[k("Particiones")])),_:1}),e(L,{class:"q-mb-sm text-center"},{default:t(()=>[e(pe,{modelValue:o.partition,"onUpdate:modelValue":R=>o.partition=R,type:"number",dense:"",filled:"","input-class":"text-center",min:1,error:o.partition==0||o.partition>o.cantidad,"error-message":o.partition>o.cantidad?"No se pueden generar mas particiones que articulos":"la particiones tienen que ser minimo "},null,8,["modelValue","onUpdate:modelValue","error","error-message"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(ee,{align:"right"},{default:t(()=>[Z(e(Q,{flat:"",label:"Cancel",color:"primary"},null,512),[[me]]),e(Q,{flat:"",label:"Continuar",color:"primary",onClick:_e})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=o=>D.value=o),persistent:""},{default:t(()=>[e(G,null,{default:t(()=>[e(j,{class:"row items-center"},{default:t(()=>[e(Ce,{icon:"warning",color:"negative","text-color":"white"}),a[22]||(a[22]=r("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1)),r("div",Xt,g(c.value.id),1)]),_:1}),e(ee,{align:"center"},{default:t(()=>[Z(e(Q,{flat:"",label:"Cancel",color:"positive"},null,512),[[me]]),e(Q,{flat:"",label:"Confirmar",color:"negative",onClick:Ue})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:i.value.state,"onUpdate:modelValue":a[6]||(a[6]=o=>i.value.state=o),persistent:""},{default:t(()=>[e(G,null,{default:t(()=>[e(j,{class:"row items-center"},{default:t(()=>[e(Ce,{icon:"warning",color:"warning","text-color":"red"}),r("span",Zt,"Estas a punto de eliminar la particion "+g(i.value.val.id),1)]),_:1}),e(j,null,{default:t(()=>a[23]||(a[23]=[k(" Estas Segur@ ?? ")])),_:1}),e(ee,{align:"right"},{default:t(()=>[Z(e(Q,{flat:"",icon:"close",color:"positive"},null,512),[[me]]),e(Q,{flat:"",icon:"delete",color:"negative",onClick:Oe})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ta={class:"text-h6"},aa={class:"row q-mt-md"},la={class:"q-ml-sm text-h6"},oa={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(s,{emit:_}){ge();const d=be(),f=b({state:!1,action:null}),y=b({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),w={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},v=_,i=s,C=b(i.rows),x=b(i.name),c=b(i.type),U=q(()=>c.value?w[c.value]:{l:"",c:""}),F=()=>{const h=w[c.value];f.value.action=h,f.value.state=!0},Y=async()=>{d.loading.show({message:"Espera..."});const h=await O.massiveAction({action:c.value});console.log(h),h.status==200?(h.data,f.value.state=!1,f.value.action=null,d.loading.hide(),d.notify({position:"center",color:"positive",icon:"done"}),v("cardResumeActived")):(console.error(h.data),alert(`Error ${h.status}: ${h.data.msg}`))},M=(h,A,E)=>{console.log(h),console.log(A),console.log(E),console.log(c.value)};return(h,A)=>(p(),S(T,null,[e(ie,{"row-key":"ID",rows:C.value,columns:y.value.columns,filter:y.value.filter,onRowClick:M},{top:t(()=>[r("div",ta,g(x.value),1),r("div",aa,[e(Q,{color:U.value.c,icon:"warning",label:U.value.l,onClick:F},null,8,["color","label"]),e(pe,{modelValue:y.value.filter,"onUpdate:modelValue":A[0]||(A[0]=E=>y.value.filter=E),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(K,{modelValue:f.value.state,"onUpdate:modelValue":A[1]||(A[1]=E=>f.value.state=E),persistent:""},{default:t(()=>[e(G,null,{default:t(()=>[e(j,{class:"row items-center"},{default:t(()=>[e(Ce,{icon:"warning",color:f.value.action.c,"text-color":"white"},null,8,["color"]),r("span",la,g(f.value.action.l),1)]),_:1}),e(j,null,{default:t(()=>[k(g(f.value.action.desc),1)]),_:1}),e(ee,{align:"right"},{default:t(()=>[Z(e(Q,{flat:"",label:"cancelar",color:"primary"},null,512),[[me]]),e(Q,{flat:"",label:"continuar",color:"primary",onClick:Y})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},sa={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},ia={class:"text-h6"},na={class:"row q-mb-md items-start justify-around"},ra={class:"text-left"},da={class:"text-h5"},ua={class:"text--2"},ca={class:"full-width row items-center"},ma={class:"col text-h6 text-dark"},pa={__name:"AdminDashboard",props:{dash:{type:Object,default:{}}},emits:["reloadDashboard","freshOrder"],setup(s,{emit:_}){$e(),Me();const d=Ie(),f=ge(),y=be(),w=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],v=_,i=b({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:m=>m.log.length==1?m.log[0].name:m.log[m.log.length-1].name,align:"left",sortable:!0,sort:(m,u,n,$)=>parseInt(n._status)-parseInt($._status),classes:m=>w[m._status?parseInt(m._status)-1:parseInt(m.status.id)-1]},{name:"suplier",label:"Surtidores",field:m=>{var u;return(u=m.partition)==null?void 0:u.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:m=>ae(m.log.find(u=>u.id==m.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:m=>m.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:m=>m.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:m=>m.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:m=>m.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),C=b(!1),x=b({state:!1,title:"",data:null,name:null,type:null}),c=b({state:!1,head:null,block:!0}),U=q(()=>f.ordersSize),F=q(()=>f.ordersok.filter(m=>m._status!=100&&m._workpoint_to==d.session.store.id_viz)),Y=q(()=>f.ordersok.filter(m=>m._status==100)),M=q(()=>f.orderserrors),h=q(()=>f.resume),A=async m=>{console.log(m.row),c.value.head=m.row,c.value.state=!0},E=async m=>{y.loading.show({message:"cargando..."+m});const u=await O.report(m);console.log(u.data),x.value.data=u.data.rows,x.value.name=u.data.name,x.value.type=m,x.value.state=!0,y.loading.hide()},z=()=>{x.value.state=!1,x.state=!1,v("reloadDashboard")},D=(m,u=!1)=>{console.log(m),u&&(c.value.state=!1),v("freshOrder",m)},I=()=>{C.value=!0};return(m,u)=>(p(),P(mt,{padding:"",class:""},{default:t(()=>[M.value.length?(p(),S("div",sa,[u[6]||(u[6]=r("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1)),r("div",ia,g(M.value.map(n=>n.id).join("id")),1),u[7]||(u[7]=r("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1))])):N("",!0),r("div",na,[(p(!0),S(T,null,W(h.value,n=>(p(),P(Q,{stack:"","no-caps":"",class:"q-py-md",key:n.key,onClick:$=>E(n.key),color:n.total==0?"teal-10":"pink-13",disabled:n.total==0},{default:t(()=>[r("div",ra,[r("div",da,g(n.total),1),r("div",ua,g(n.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(ie,{flat:"",bordered:"","row-key":"id",rows:F.value,columns:i.value.columns,filter:i.value.filter,pagination:i.value.pagination},{top:t(()=>[r("div",ca,[r("div",ma,"Pedidos: "+g(U.value),1),e(pe,{dense:"",modelValue:i.value.filter,"onUpdate:modelValue":u[0]||(u[0]=n=>i.value.filter=n),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"]),e(B,{spaced:"",inset:"",vertical:"",dark:""}),r("div",null,[e(se,{name:"archive",size:"md",color:"negative",onClick:I})])])]),header:t(n=>[e(ye,{props:n},{default:t(()=>[e(De,{"auto-width":""}),(p(!0),S(T,null,W(n.cols,$=>(p(),P(De,{key:$.name,props:n},{default:t(()=>[k(g($.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(n=>[e(ye,{props:n},{default:t(()=>[e(ke,{"auto-width":""},{default:t(()=>[n.row?(p(),P(Q,{key:0,size:"sm",dense:"",round:"",flat:"",onClick:$=>n.expand=!n.expand,icon:n.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])):N("",!0)]),_:2},1024),(p(!0),S(T,null,W(n.cols,$=>(p(),P(ke,{key:$.name,props:n,onClick:X=>A(n)},{default:t(()=>[k(g($.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),Z(e(ye,{props:n},{default:t(()=>[e(ke,{colspan:"100%"},{default:t(()=>[e(ce,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(le,null,{default:t(()=>[e(V,null,{default:t(()=>u[8]||(u[8]=[k("ID")])),_:1}),e(V,null,{default:t(()=>u[9]||(u[9]=[k("ESTADO")])),_:1}),e(V,null,{default:t(()=>u[10]||(u[10]=[k("Utima Actividad")])),_:1}),n.row.from._type==2?(p(),P(V,{key:0},{default:t(()=>u[11]||(u[11]=[k("SALIDA")])),_:1})):N("",!0),n.row.from._type==2?(p(),P(V,{key:1},{default:t(()=>u[12]||(u[12]=[k("ENTRADA")])),_:1})):N("",!0),n.row.from._type==1?(p(),P(V,{key:2},{default:t(()=>u[13]||(u[13]=[k("TRASPASO")])),_:1})):N("",!0)]),_:2},1024),(p(!0),S(T,null,W(n.row.partition,($,X)=>(p(),S("div",{key:X},[e(le,null,{default:t(()=>[e(V,null,{default:t(()=>[e(L,{overline:""},{default:t(()=>[k(g($._suplier),1)]),_:2},1024),e(L,{caption:""},{default:t(()=>[k(g($.id),1)]),_:2},1024)]),_:2},1024),e(V,{class:rt(`${w[$.status.id-1]}`)},{default:t(()=>[k(g($.status.name),1)]),_:2},1032,["class"]),e(V,null,{default:t(()=>{var ne,re;return[k(g(te(ae)((re=(ne=$.log)==null?void 0:ne.find(_e=>_e.id==$._status))==null?void 0:re.pivot.updated_at).format("YYYY-MM-DD HH:mm:ss")),1)]}),_:2},1024),n.row.from._type==2?(p(),P(V,{key:0},{default:t(()=>[k(g($.invoice),1)]),_:2},1024)):N("",!0),n.row.from._type==2?(p(),P(V,{key:1},{default:t(()=>[k(g($.invoice_received),1)]),_:2},1024)):N("",!0),n.row.from._type==1?(p(),P(V,{key:2},{default:t(()=>[k(g($.invoice),1)]),_:2},1024)):N("",!0)]),_:2},1024),e(B,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[dt,n.expand]])]),_:1},8,["rows","columns","filter","pagination"]),e(K,{"full-width":"",modelValue:c.value.state,"onUpdate:modelValue":u[3]||(u[3]=n=>c.value.state=n),persistent:c.value.block,"no-esc-dismiss":c.value.block,"no-backdrop-dismiss":c.value.block},{default:t(()=>[e(ea,{head:c.value.head,onLoaded:u[1]||(u[1]=n=>c.value.block=!1),onLoading:u[2]||(u[2]=n=>c.value.block=!0),onFresh:D,onChofiAssigned:D},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(K,{modelValue:x.value.state,"onUpdate:modelValue":u[4]||(u[4]=n=>x.value.state=n)},{default:t(()=>[e(oa,{rows:x.value.data,name:x.value.name,type:x.value.type,onCardResumeActived:z},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(K,{modelValue:C.value,"onUpdate:modelValue":u[5]||(u[5]=n=>C.value=n),"full-width":""},{default:t(()=>[e(G,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(j,{class:"q-pt-none"},{default:t(()=>[e(ie,{flat:"",bordered:"","row-key":"id",rows:Y.value,columns:i.value.columns,pagination:i.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const fa={class:"q-pa-md"},va={class:"q-pb-sm"},ga={key:0},al={__name:"dashboard",setup(s){const _=$e();Me();const d=ge();be(),Ie();const f=b({val:null}),y=b(!1),w=async()=>{d.setTitle("Dashboard"),d.setButtonShow(!0),d.setButtonShowAdd(!1)},v=i=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",i.id),Se.emit("order_refresh",{order:i})};return ut(()=>_.query,()=>{w()}),w(),(i,C)=>(p(),S(T,null,[e(K,{modelValue:y.value,"onUpdate:modelValue":C[2]||(C[2]=x=>y.value=x)},{default:t(()=>[e(G,{class:"my-card"},{default:t(()=>[e(j,null,{default:t(()=>[r("div",fa,[r("div",va,g(f.value.val),1),e(Ye,{modelValue:f.value.val,"onUpdate:modelValue":C[0]||(C[0]=x=>f.value.val=x),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(j,null,{default:t(()=>[e(ee,{align:"right"},{default:t(()=>[e(Q,{flat:"",icon:"close",color:"negative",onClick:C[1]||(C[1]=x=>y.value=!y.value)}),e(Q,{flat:"",icon:"check",color:"positive",onClick:i.buscas},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),te(d).showLoad?(p(),S("div",ga,[e(_t,{showing:te(d).showLoad},{default:t(()=>[e(bt,{size:"5.5em",color:"primary"}),C[3]||(C[3]=k(" Obteniendo Datos... "))]),_:1},8,["showing"])])):(p(),P(pa,{key:1,onReload:w,onFreshOrder:v}))],64))}};export{al as default};
