import{W as te,a as oe,r as f,J as se,X as de,o as c,d as k,w as o,e as t,Q as B,f as x,Y as i,g as s,h as u,Z as ie,j as F,_ as r,i as U,$,a0 as z,k as Q,a1 as _,a2 as O,a3 as P,a4 as j}from"./index.0f414ca4.js";import{Q as I,a as y}from"./QSelect.c7572951.js";import{Q as M,a as N,b as S}from"./QList.a2313392.js";import{Q as ne}from"./QForm.200c1e75.js";import{Q as h}from"./QExpansionItem.916271b9.js";import{Q as ue}from"./QUploader.dcbdf3ca.js";import{Q as re,a as me}from"./QLayout.d0b940a9.js";import{b as A}from"./billingApi.aede4447.js";import{u as pe}from"./BillingStore.a85e1daa.js";import{u as ve}from"./use-quasar.14d0dc13.js";import{d as H}from"./dayjs.min.cbcf888d.js";import"./QCircularProgress.8cd023f2.js";import"./QScrollObserver.a015861c.js";import"./QResizeObserver.c3820490.js";import"./axios.ca582435.js";import"./_commonjsHelpers.88e99c8f.js";const fe={class:"q-gutter-md q-mt-sm"},ce={class:"text-h6 text-bold q-mb-sm"},be={class:"text-h6 text-bold q-mb-md"},xe={key:0},ge={key:1},ye={class:"q-gutter-md q-mt-md"},Ve={class:"row"},Ce={class:"col"},Te={class:"col"},ke={class:"col"},we={class:"row"},Se={class:"col"},De={class:"col"},_e={class:"text-bold"},Fe={class:"text-bold"},Ue={class:"text-bold"},Qe=["href"],Ae={class:"text-bold"},Ee={class:"text-bold"},qe={class:"text-bold"},Re=["href"],Xe={__name:"BillingFormLYT",setup(Be){pe();const n=ve(),W=te(),Z=oe(),E=f(!1),D=f(null),G=f([{id:1,label:"Credito",value:"CRE"},{id:2,label:"Debito",value:"DBT"}]),m=f({client:!1,ticket:!1,data:!0}),V=f({load:!1,show:!0}),w=f({ticket:!1,client:!1}),g=f({state:!1,val:null}),v=f({state:!1,val:null}),q=f([]),R=f([]),a=f({store:null,folio:null,fecha:null,total:"",payments:[],cfdi:"",nombre:"",rfc:"",razonSocial:"",email:"",telefono:"",address:{calle:"",colonia:"",ciudad:"",cp:"",municipio:"",numInt:"",numExt:""}}),J=async d=>{n.loading.show({message:"Obteniendo Datos"});const e=d[0],b=new FormData;b.append("file",e);const l=await A.readCostancy(b);l.fail?n.notify({type:"negative",message:"No se pudieron extraer los datos"}):(console.log(l),a.value.rfc=l.rfc,a.value.razonSocial=l.razonSocial,a.value.address.cp=l.cp,a.value.address.calle=l.calle,a.value.address.colonia=l.colonia,a.value.address.numInt=l.numInt,a.value.address.numExt=l.numExt,a.value.address.municipio=l.municipio,a.value.address.ciudad=l.entFederativa,n.loading.hide(),n.notify({type:"positive",message:"Datos extra\xEDdos correctamente"}))},K=d=>/^([A-ZÃ‘&]{3,4})(\d{6})([A-Z0-9]{3})$/.test(d==null?void 0:d.toUpperCase())||"RFC inv\xE1lido",X=d=>/\S+@\S+\.\S+/.test(d)||"Correo inv\xE1lido",ee=async()=>{if(!a.value.total||!a.value.fecha||!a.value.payments.length)return n.notify({type:"negative",message:"Primero valida el ticket"});if(!a.value.cfdi)return n.notify({type:"negative",message:"Selecciona un uso CFDI"});if(!a.value.nombre||!a.value.email||!a.value.rfc||!a.value.razonSocial||!a.value.address.cp||!a.value.address.calle||!a.value.address.colonia||!a.value.address.ciudad||!a.value.address.municipio)return n.notify({type:"negative",message:"Todos los datos del cliente son obligatorios"});for(let d of a.value.payments)if(["TAR","TBA","TCD","TSA","TSC"].includes(d.payment)&&!d.type_card)return n.notify({type:"negative",message:"Selecciona el tipo de tarjeta para todos los pagos con tarjeta"});le(a.value)},L=()=>{E.value=!0,a.value={store:a.value.store,folio:null,fecha:null,total:"",payments:[],cfdi:a.value.cfdi,nombre:"",rfc:"",razonSocial:"",email:"",telefono:"",address:{calle:"",colonia:"",ciudad:"",cp:"",municipio:"",numInt:"",numExt:""}},m.value={data:!0,ticket:!1,client:!1},w.value={ticket:!1,client:!1},V.value={load:!1,show:!0},D.value&&D.value.resetValidation(),setTimeout(()=>{E.value=!1},300),n.notify({type:"info",message:"Formulario limpiado"})},le=async d=>{n.loading.show({message:"Enviando Formulario"}),console.log(d);const e=d.payments.map(p=>{var Y;const C=((Y=p.type_card)==null?void 0:Y.value)||null;let T=null;switch(p.payment){case"CHE":case"EFE":T=p.payment;break;case"TDB":case"TDS":case"TDA":case"TRA":T="TRA";break;case"TSA":case"TSC":case"TAR":case"TBA":case"TCD":C==="CRE"?T="TDC":C==="DBT"?T="TDD":T="TAR";break;default:T="EFE";break}return{...p,payment:T,type_card:C}}),b={...d,payments:e};console.log(b);const l=await A.sendBilling(b);l.fail?console.log(fail):(console.log(l),g.value.state=!0,g.value.val=l,n.loading.hide(),n.notify({message:"Solicitud Creada",type:"positive",position:"top"}),setTimeout(()=>{g.value.state=!1,L()},1e4))},ae=async()=>{var b,l;V.value.load=!0;let d={workpoint:(b=a.value.store)==null?void 0:b.id,folio:a.value.folio};console.log(d);const e=await A.validTicket(d);e.fail?e.fail.status==403?(console.log(e.fail.response.data),v.value.state=!0,v.value.val=e.fail.response.data):console.log(e):(console.log(e),a.value.total=Number(e.Total),a.value.fecha=H(e.fecha).format("YYYY-MM-DD"),a.value.payments=(l=e.fpas)==null?void 0:l.map(p=>({payment:p.FPALCO,concept:p.CPTLCO,import:p.IMPLCO,type_card:null})),V.value.load=!1,V.value.show=!1,m.value.ticket=!0,w.value.ticket=!0,m.value.client=!0,w.value.client=!0)};return(async()=>{n.loading.show({message:"Cargando...."});const d=await A.index();d.fail?console.log(d.fail):(console.log(d),n.loading.hide(),q.value=d.stores,a.value.store=q.value.find(e=>e.id==W.params.sid),R.value=d.cfdi,a.value.cfdi=R.value.find(e=>e.id==2))})(),se(()=>a.value.payments,async()=>{if(E.value||!D.value)return;await D.value.validate()&&(m.value.data=!1,m.value.ticket=!1,m.value.client=!0,w.value.client=!0)},{deep:!0}),(d,e)=>{const b=de("router-view");return c(),k(re,{view:"hHh Lpr fFf"},{default:o(()=>[t(me,null,{default:o(()=>[t(B,{class:"q-pa-xl q-mx-auto shadow-4",style:{"max-width":"700px","border-radius":"22px"}},{default:o(()=>[t(x,{class:"text-h5 text-primary text-weight-bold text-center q-mb-md"},{default:o(()=>e[22]||(e[22]=[i(" Solicitud de Factura \xB7 Grupo Vizcarra ")])),_:1}),t(x,null,{default:o(()=>[t(h,{modelValue:m.value.data,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value.data=l),label:"Datos de la Compra",icon:"shopping_cart","header-class":"text-h6 text-primary text-weight-bold","expand-separator":""},{default:o(()=>[s("div",fe,[t(I,{modelValue:a.value.store,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.store=l),options:q.value,label:"Sucursal",filled:"",dense:"","option-label":"name",disable:""},null,8,["modelValue","options"]),t(u,{modelValue:a.value.folio,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.folio=l),type:"text",label:"Folio del Ticket",filled:"",dense:"",mask:"#-######",disable:!V.value.show},ie({_:2},[V.value.show?{name:"after",fn:o(()=>[t(F,{dense:"",color:"primary",label:"Validar",onClick:ae,loading:V.value.load,disable:!a.value.folio||!a.value.store||a.value.folio.length<8},null,8,["loading","disable"])]),key:"0"}:void 0]),1032,["modelValue","disable"])]),w.value.ticket?(c(),k(h,{key:0,modelValue:m.value.ticket,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value.ticket=l),icon:"receipt_long",label:"Detalle del Ticket","header-class":"text-h6 text-primary text-weight-bold",class:"q-mt-md"},{default:o(()=>[t(ne,{ref_key:"formTicket",ref:D,class:"q-mt-md"},{default:o(()=>[e[26]||(e[26]=s("div",{class:"text-subtitle1 q-mb-xs"},"Fecha:",-1)),s("div",ce,r(a.value.fecha),1),e[27]||(e[27]=s("div",{class:"text-subtitle1 q-mb-xs"},"Total:",-1)),s("div",be,"$ "+r(a.value.total),1),t(M,{bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[(c(!0),U(z,null,$(a.value.payments,(l,p)=>(c(),k(N,{key:p},{default:o(()=>[t(S,null,{default:o(()=>[t(y,{caption:""},{default:o(()=>e[23]||(e[23]=[i("Forma de Pago")])),_:1}),t(y,{class:"text-bold"},{default:o(()=>[["TAR","TBA","TCD","TSA","TSC"].includes(l.payment)?(c(),U("span",xe,"Tarjeta")):(c(),U("span",ge,r(l.concept),1))]),_:2},1024)]),_:2},1024),t(S,{class:"text-center"},{default:o(()=>[t(y,{caption:""},{default:o(()=>e[24]||(e[24]=[i("Importe")])),_:1}),t(y,{class:"text-bold"},{default:o(()=>[i("$ "+r(Number(l.import)),1)]),_:2},1024)]),_:2},1024),["TAR","TBA","TCD","TSA","TSC"].includes(l.payment)?(c(),k(S,{key:0},{default:o(()=>[t(y,{caption:"",class:"text-center"},{default:o(()=>e[25]||(e[25]=[i("Tipo Tarjeta")])),_:1}),t(I,{modelValue:l.type_card,"onUpdate:modelValue":C=>l.type_card=C,options:G.value,filled:"",dense:"",label:"Selecciona...",class:"q-mt-xs",rules:[C=>!!C||"Selecciona un tipo"]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),_:2},1024)):Q("",!0)]),_:2},1024))),128))]),_:1}),t(I,{filled:"",dense:"",class:"q-mt-md",label:"Uso de CFDI",modelValue:a.value.cfdi,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.cfdi=l),options:R.value,"option-label":"name","emit-value":"","map-options":"",rules:[l=>!!l||"Obligatorio"]},null,8,["modelValue","options","rules"]),t(u,{modelValue:a.value.notes,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.notes=l),type:"textarea",autogrow:"",filled:"",dense:"",label:"Comentarios opcionales",class:"q-mt-md"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue"])):Q("",!0)]),_:1},8,["modelValue"])]),_:1}),t(x,null,{default:o(()=>[w.value.client?(c(),k(h,{key:0,modelValue:m.value.client,"onUpdate:modelValue":e[18]||(e[18]=l=>m.value.client=l),"header-class":"text-h6 text-primary text-weight-bold",label:"Datos del Cliente",icon:"person","expand-separator":""},{default:o(()=>[s("div",ye,[t(ue,{label:"Subir Constancia Fiscal (PDF)",accept:".pdf",onAdded:J,class:"full-width",dense:"","hide-upload-btn":""}),t(u,{filled:"",dense:"",label:"Nombre de Contacto",modelValue:a.value.nombre,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.nombre=l),rules:[l=>!!l||"Obligatorio"]},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Correo Electr\xF3nico",modelValue:a.value.email,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.email=l),rules:[X],type:"email"},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Tel\xE9fono",modelValue:a.value.telefono,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.telefono=l),mask:"##########"},null,8,["modelValue"]),t(u,{filled:"",dense:"",label:"RFC",modelValue:a.value.rfc,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.rfc=l),rules:[K]},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Raz\xF3n Social",modelValue:a.value.razonSocial,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.razonSocial=l),rules:[l=>!!l||"Obligatorio"]},null,8,["modelValue","rules"]),t(u,{filled:"",dense:"",label:"Calle",modelValue:a.value.address.calle,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.address.calle=l)},null,8,["modelValue"]),t(u,{filled:"",dense:"",label:"Colonia",modelValue:a.value.address.colonia,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.address.colonia=l)},null,8,["modelValue"]),s("div",Ve,[s("div",Ce,[t(u,{filled:"",dense:"",label:"Num Ext",modelValue:a.value.address.numExt,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.address.numExt=l)},null,8,["modelValue"])]),t(_,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Te,[t(u,{filled:"",dense:"",label:"Num Int",modelValue:a.value.address.numInt,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.address.numInt=l)},null,8,["modelValue"])]),t(_,{spaced:"",inset:"",vertical:"",dark:""}),s("div",ke,[t(u,{filled:"",dense:"",label:"Municipio",modelValue:a.value.address.municipio,"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.address.municipio=l)},null,8,["modelValue"])])]),s("div",we,[s("div",Se,[t(u,{filled:"",dense:"",label:"Ciudad",modelValue:a.value.address.ciudad,"onUpdate:modelValue":e[16]||(e[16]=l=>a.value.address.ciudad=l)},null,8,["modelValue"])]),t(_,{spaced:"",inset:"",vertical:"",dark:""}),s("div",De,[t(u,{filled:"",dense:"",label:"C.P.",modelValue:a.value.address.cp,"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.address.cp=l),mask:"#####"},null,8,["modelValue"])])])])]),_:1},8,["modelValue"])):Q("",!0)]),_:1}),t(O,{align:"right",class:"q-mt-md"},{default:o(()=>[t(F,{label:"Limpiar",flat:"",color:"primary",onClick:L}),t(F,{label:"Enviar Solicitud",color:"primary",unelevated:"",onClick:ee})]),_:1})]),_:1}),t(P,{modelValue:g.value.state,"onUpdate:modelValue":e[19]||(e[19]=l=>g.value.state=l),persistent:""},{default:o(()=>[t(B,{class:"q-pa-lg",style:{"min-width":"350px"}},{default:o(()=>[t(x,{class:"text-center text-h5 text-primary"},{default:o(()=>e[28]||(e[28]=[i("Solicitud Generada")])),_:1}),t(x,{class:"text-subtitle1"},{default:o(()=>[e[29]||(e[29]=i(" Folio: ")),s("span",_e,r(g.value.val.id),1),e[30]||(e[30]=s("br",null,null,-1)),e[31]||(e[31]=i(" Contacto: ")),s("span",Fe,r(g.value.val.name),1),e[32]||(e[32]=s("br",null,null,-1)),e[33]||(e[33]=i(" Tel\xE9fono: ")),s("span",Ue,r(g.value.val.celphone),1)]),_:1}),t(x,{class:"text-center"},{default:o(()=>[s("a",{class:"text-positive",href:`https://wa.me/5573461022?text=Cual%20es%20el%20estado%20de%20mi%20solicitud?%20Folio:%20${g.value.val.id}`}," Consultar por WhatsApp ",8,Qe)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(P,{modelValue:v.value.state,"onUpdate:modelValue":e[21]||(e[21]=l=>v.value.state=l),persistent:""},{default:o(()=>[t(B,{class:"q-pa-lg",style:{"min-width":"420px","max-width":"760px","border-radius":"12px"}},{default:o(()=>[t(x,{class:"text-h6 text-primary text-weight-bold"},{default:o(()=>[e[34]||(e[34]=i(" Folio Solicitud: ")),s("span",Ae,r(v.value.val.id),1)]),_:1}),t(x,{class:"text-subtitle2"},{default:o(()=>[s("div",null,[e[35]||(e[35]=i("Contacto: ")),s("span",Ee,r(v.value.val.name),1)]),s("div",null,[e[36]||(e[36]=i("Tel\xE9fono: ")),s("span",qe,r(v.value.val.celphone),1)])]),_:1}),t(_),t(x,null,{default:o(()=>[e[39]||(e[39]=s("div",{class:"text-h6 q-mb-sm text-bold"},"Historial de Proceso",-1)),t(M,{bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[!v.value.val.log||!v.value.val.log.length?(c(),k(N,{key:0},{default:o(()=>[t(S,{class:"text-center"},{default:o(()=>e[37]||(e[37]=[i("No hay movimientos registrados")])),_:1})]),_:1})):Q("",!0),(c(!0),U(z,null,$(v.value.val.log,(l,p)=>(c(),k(N,{key:p,class:"row items-center"},{default:o(()=>[t(S,{class:"col"},{default:o(()=>[t(y,{class:"text-bold"},{default:o(()=>[i(r(l.name),1)]),_:2},1024),t(y,{caption:""},{default:o(()=>[i(r(j(H)(l.pivot.created_at).format("YYYY-MM-DD HH:mm")),1)]),_:2},1024)]),_:2},1024),t(S,{class:"col-auto"},{default:o(()=>[t(y,{class:"text-caption"},{default:o(()=>e[38]||(e[38]=[i("Usuario")])),_:1}),t(y,{class:"text-bold"},{default:o(()=>[i(r(l.pivot._user),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(_),t(x,{class:"text-center"},{default:o(()=>[e[40]||(e[40]=s("div",{class:"text-h6 text-primary q-mb-sm"},"\xBFDudas o seguimiento?",-1)),s("a",{class:"text-positive",href:`https://wa.me/5573461022?text=Cual%20es%20el%20estado%20de%20mi%20solicitud?%20Folio:%20${v.value.val.id}`,target:"_blank",rel:"noopener"}," Enviar Whatsapp al soporte ",8,Re)]),_:1}),t(O,{align:"right"},{default:o(()=>[t(F,{flat:"",label:"OK",color:"primary",onClick:e[20]||(e[20]=l=>j(Z).go(0))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(b)]),_:1})]),_:1})}}};export{Xe as default};
