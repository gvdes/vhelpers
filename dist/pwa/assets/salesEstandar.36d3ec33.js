import{Q as Ne}from"./QToolbarTitle.547aa48d.js";import{Q as z,a as se,d as ve}from"./QSelect.ea01bb0c.js";import{Q as Te}from"./QToggle.9bb83614.js";import{d as M,e as G,b as I,a as pe,Q as W}from"./QList.da739209.js";import{a as F,Q as R,p as Qe}from"./axios.0dad148f.js";import{b3 as Ee,u as X,r as V,c as Q,m as ue,o as g,g as L,d as S,w as s,e as l,Q as w,b4 as de,ak as J,b5 as Ie,f as o,a0 as x,h as C,E as Le,an as ie,a as ye,aH as xe,a3 as Be,a2 as Ue,a4 as ne,b7 as qe,t as _e,aF as Re,aG as Oe,n as je,a1 as me,A as Y}from"./index.35a937f8.js";import{Q as O}from"./QInput.64a0db59.js";import{Q as ze}from"./QToolbar.8c75c4f7.js";import{Q as ae}from"./QTable.0c580f6f.js";import{Q as H}from"./QCardActions.6922cece.js";import{Q as fe}from"./QForm.c540e5af.js";import{Q as Ke}from"./QFooter.4eb4eb8d.js";import{Q as Me}from"./QPage.6ae7d420.js";import{C as be}from"./ClosePopup.cf749f5f.js";import{u as Je,c as oe}from"./cashApi.5409449b.js";import"./QExpansionItem.33493ca3.js";import"./QDrawer.f206cfc4.js";import{u as Z}from"./use-quasar.974edd9e.js";import{p as ge}from"./productsApi.4a1d10f8.js";import{Q as We}from"./QSpace.0b95ff1d.js";import{R as j}from"./resoursesOrder.68ae155c.js";import{Q as Ye}from"./QCheckbox.e684fb91.js";import{o as Ge}from"./orderApi.f8659e0d.js";import"./QLinearProgress.63e0a86a.js";import"./QResizeObserver.0638ec8f.js";import"./QScrollObserver.c7ff2002.js";import"./touch.9135741d.js";const He={class:"QuickRegular row items-center"},Xe={class:"row items-center justify-between no-wrap QuickRegular"},Ze={class:"col"},et={class:"text-grey-4 q-pl-md"},tt={class:"text--2 text-grey-5"},lt={class:"text--3"},at={key:0,class:"text--3 text-amber-13"},ot={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]}},emits:["input","similarcodes","agregar"],setup(y,{expose:U,emit:m}){const i=Z(),A=X(),_=y,$=m,e=V({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),p=V(null),h=Q(()=>({autocomplete:e.value.target,limit:_.limit,_workpoint:A.session.store.id_viz,strict:e.read_barcode})),f=Q(()=>n=>_.checkState?_.blockStates.some(c=>c==n.state.id):!1);ue(()=>{e.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let n=JSON.parse(localStorage.getItem("typeiptsearch"));n&&(e.value.iptsearch.type=n.type,e.value.iptsearch.icon=n.icon)});const d=()=>{e.value.read_barcode=!e.value.read_barcode,e.value.target="",localStorage.setItem("barcodereader",e.value.read_barcode)},N=(n,c,v)=>{console.log(h.value),n.trim().length>1&&(e.value.target=n.toUpperCase().trim(),console.log(e.value.target),ge.autocomplete(h.value).then(B=>{console.log(B);let ee=B.data.map(T=>{if(_.checkState)if(_.wkpToVal){let K=T.stocks.find(te=>te._workpoint==_.wkpToVal);T.stateToVal=K?{own:K,state:K.status}:{own:null,state:T.status}}else T.stateToVal={own:!0,state:T.status};else T.stateToVal={own:!0,state:T.status};return T});c(()=>{e.value.options=ee},T=>{T.setOptionIndex(-1),T.moveOptionSelection(1,!0)})}).catch(B=>{console.log(B)}))},E=()=>{switch(e.value.iptsearch.type){case"text":e.value.iptsearch.type="number",e.value.iptsearch.icon="fas fa-font";break;case"number":e.value.iptsearch.type="text",e.value.iptsearch.icon="fas fa-hashtag";break}localStorage.setItem("typeiptsearch",JSON.stringify(e.value.iptsearch))},P=n=>{e.value.target="",$("input",n)},k=()=>{e.value.target.trim().toUpperCase(),e.value.target.length&&(e.value.iptsearch.processing=!0,ge.autocomplete(h.value).then(n=>{let c=n.data;switch(c.length){case 0:let v=e.value.target;i.notify({message:`Sin resultados para <b>${v}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),b();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(c[0]),P(c[0]);break}e.value.target="",e.value.iptsearch.processing=!1}).catch(n=>{console.log(n)}))},b=()=>{console.log("putFocus ejecutada!!"),p.value.focus()};U({focus:()=>{var n,c;return(c=(n=p.value)==null?void 0:n.focus)==null?void 0:c.call(n)}});const r=n=>{$("agregar",n)};return(n,c)=>(g(),L("div",He,[e.value.read_barcode?(g(),S(O,{key:0,ref_key:"iptatc",ref:p,loading:e.value.iptsearch.processing,disable:e.value.iptsearch.processing,modelValue:e.value.target,"onUpdate:modelValue":c[1]||(c[1]=v=>e.value.target=v),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:de(k,["enter"]),autocomplete:"off",autofocus:""},{prepend:s(()=>[l(w,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:c[0]||(c[0]=v=>d())},null,8,["color","icon"])]),_:1},8,["loading","disable","modelValue"])):(g(),S(z,{key:1,dense:"",filled:"",color:"blue-13",class:"text-uppercase col",ref_key:"iptatc",ref:p,"use-input":"","hide-dropdown-icon":"","option-value":"id","option-label":"id","hide-selected":"",behavior:"menu",modelValue:e.value.target,"onUpdate:modelValue":c[3]||(c[3]=v=>e.value.target=v),"input-debounce":400,autofocus:"",options:e.value.options,type:e.value.iptsearch.type,onFilter:N,"popup-content-class":"bg-darkl1"},{"no-option":s(()=>[l(M,null,{default:s(()=>[l(G,{class:"text-grey QuickRegular"},{default:s(()=>c[4]||(c[4]=[J("Nada por aqui...")])),_:1})]),_:1})]),prepend:s(()=>[l(w,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:c[2]||(c[2]=v=>d())},null,8,["color","icon"]),l(w,{type:"button",dense:"",size:"sm",flat:"",onClick:E,icon:e.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:s(v=>[l(M,Ie(v.itemProps,{onClick:B=>r(v.opt),disable:f.value(v.opt.stateToVal)}),{default:s(()=>[l(G,null,{default:s(()=>[o("div",Xe,[o("div",Ze,[o("div",null,[J(x(v.opt.code)+" ",1),o("span",et,x(v.opt.name),1)]),o("div",tt,x(v.opt.description),1),o("div",lt,x(v.opt.stateToVal.state.name),1),v.opt.stateToVal.own?C("",!0):(g(),L("div",at,"Producto en conflicto con status "))]),l(Le,{name:"fas fa-circle",class:ie(["q-pl-md",`bullet-${v.opt.stateToVal.state.id}`]),size:"10px"},null,8,["class"])])]),_:2},1024)]),_:2},1040,["onClick","disable"])]),_:1},8,["modelValue","options","type"]))]))}};var st=Ee(ot,[["__scopeId","data-v-06295034"]]);const it={class:"row"},nt={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},ut={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},dt={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},rt={class:"row"},ct={class:"text-h6 col text-bold text-left"},vt={class:"text-h6 col text-bold text-right"},pt={class:"text-subtitle2 col"},mt={class:"text-center"},ft={class:"q-pa-xs"},bt={class:"row items-center justify-center q-gutter-md"},gt={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(y,{emit:U}){X();const m=Z();ye(),xe();const i=y,A=U,_=Q(()=>!i.product.pivot.amountDelivered||i.product.pivot.amountDelivered<=0),$=Q(()=>i.product.pivot._supply_by==3?i.product.pivot.amountDelivered*i.product.pieces:i.product.pivot._supply_by==2?i.product.pivot.amountDelivered*12:i.product.pivot.amountDelivered),e=Q(()=>i._price_list<=3?[1,2,3,4]:[i._price_list]),p=Q(()=>i._price_list<=3?$.value>=i.product.pieces&&(i.product.pivot._supply_by==1||i.product.pivot._supply_by==2)||i.product.pivot._supply_by==3?4:j.verificarPrecioDocena(i.products,i.product,i.rules)?3:j.verificarPrecioMayoreo(i.products,i.product,i.rules)?2:1:i._price_list),h=()=>{A("reset")},f=async()=>{m.loading.show({message:"Editando Producto"});let E=i.product.prices.find(k=>k.id==p.value).pivot.price,P=$.value*E;i.product.pivot.toDelivered=$.value,i.product.pivot._price_list=p.value,i.product.pivot.price=E,i.product.pivot.total=P,m.loading.hide(),h(),j.actualizarPreciosProductosSales(i.products,i._price_list,i.rules),A("editProduct")},d=async()=>{m.loading.show({message:"Agregando producto"});let E=i.product.prices.find(k=>k.id==p.value).pivot.price,P=$.value*E;i.product.pivot.toDelivered=$.value,i.product.pivot._price_list=p.value,i.product.pivot.price=E,i.product.pivot.total=P,i.product.pivot._product=i.product.id,console.log(i.product),A("addProduct",i.product),m.loading.hide(),j.actualizarPreciosProductosSales(i.products,i._price_list,i.rules)},N=async()=>{m.loading.show({message:"Eliminando Producto"}),A("deleteProduct",i.product),m.loading.hide(),j.actualizarPreciosProductosSales(i.products,i._price_list,i.rules)};return(E,P)=>(g(),S(R,null,{default:s(()=>[l(F,{class:"item-center"},{default:s(()=>[o("div",it,[o("div",nt,x(y.product.category.familia.seccion.name),1),o("div",ut,x(y.product.category.familia.name),1),o("div",dt,x(y.product.category.name),1)])]),_:1}),l(F,{class:"item-center"},{default:s(()=>[o("div",rt,[o("div",ct,x(y.product.code),1),o("div",vt,x(y.product.name),1)]),o("div",pt,x(y.product.description),1)]),_:1}),l(F,{class:"item-center row"},{default:s(()=>[(g(!0),L(Be,null,Ue(y.product.prices.filter(k=>e.value.includes(k.id)),(k,b)=>(g(),L("div",{class:"col text-subtitle2 text-center",key:b},[o("div",{class:ie(k.id==p.value?"text-weight-bold":"text-caption text-strike")},x(k.alias),3),l(I,{spaced:"",inset:"",vertical:"",dark:""}),o("div",{class:ie(k.id==p.value?"text-bold  text-blue-13":"text-caption")},x(k.pivot.price),3),l(I,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),l(F,null,{default:s(()=>[o("div",mt,[o("div",ft,[P[4]||(P[4]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),o("div",bt,[l(w,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:P[0]||(P[0]=k=>y.product.pivot.amountDelivered>1?y.product.pivot.amountDelivered--:"")}),ne(o("input",{type:"number",min:"1","onUpdate:modelValue":P[1]||(P[1]=k=>y.product.pivot.amountDelivered=k),class:"text-center exo",style:{width:"100px","font-size":"3em",border:"none"},autofocus:"",onKeydown:P[2]||(P[2]=de(k=>y.edit?f():d(),["enter"]))},null,544),[[qe,y.product.pivot.amountDelivered]]),l(w,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:P[3]||(P[3]=k=>y.product.pivot.amountDelivered++)})])])])]),_:1}),l(H,null,{default:s(()=>[l(w,{flat:"",icon:"close",onClick:h}),l(We),y.edit?C("",!0):(g(),S(w,{key:0,flat:"",icon:"add",color:"positive",onClick:d,disable:_.value},null,8,["disable"])),y.edit?(g(),S(w,{key:1,flat:"",icon:"delete",color:"negative",onClick:N})):C("",!0),y.edit?(g(),S(w,{key:2,flat:"",icon:"edit",color:"warning",onClick:f,disable:_.value},null,8,["disable"])):C("",!0)]),_:1})]),_:1}))}},yt={class:"bg-primary row items-center justify-between q-pa-md text-white"},xt={class:"text-right"},_t={class:"fw-bold text-h4"},ht={class:"row text-center items-center"},kt={class:"col"},wt={class:"row text-center items-center"},Pt={class:"col"},Vt={class:"col"},At={class:"row flex justify-center"},Ct={class:"col flex justify-center"},$t={key:0,class:"col"},Ft={key:0,class:"row flex justify-center text-center"},St={class:"col"},Dt={class:"col"},Nt={class:"row flex justify-center"},Tt={class:"col flex justify-center"},Qt={key:0,class:"col"},Et={class:"row"},It={class:"text-h5"},Lt={key:0,class:"text-center"},Bt={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(y,{emit:U}){X();const m=Z(),i=V({dafpa:!1,vales:!1}),A=y,_=U,$=V({opts:[]}),e=V({PFPA:{id:A.paymeths[1],val:Math.round(A.total)},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),p=Q(()=>(Number(Number.parseFloat(e.value.SFPA.val)+Number.parseFloat(e.value.PFPA.val))+Number.parseFloat(e.value.VALE.val)-Number.parseFloat(A.total)).toFixed(2)),h=Q(()=>{var b,r,n;return p.value>=0&&(((b=e.value.PFPA.id)==null?void 0:b.id)&&e.value.PFPA.val>0||((r=e.value.SFPA.id)==null?void 0:r.id)&&e.value.SFPA.val>0||((n=e.value.VALE.id)==null?void 0:n.id)&&e.value.VALE.val>0)}),f=Q(()=>{const b=Object.values(e.value);if(b.some(v=>v.id&&v.id.alias==="EFE"&&v.val>0))return!1;const n=b.some(v=>v.id&&v.id.alias!=="EFE"),c=b.reduce((v,B)=>v+Number(B.val||0),0);return n&&c>A.total}),d=b=>{var r;return b.id==((r=e.value.SFPA.id)==null?void 0:r.id)},N=b=>{var r;return b.id==((r=e.value.PFPA.id)==null?void 0:r.id)},E=async()=>{m.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let r=`http://192.168.10.160:1619/access/public/modify/vales?price=${A.client}`;Qe.get(r).then(n=>{console.log(n.data),m.loading.hide();let c=n.data.map(v=>({id:{id:5,alias:"[V]",name:"VALE",code:v.CODANT},val:Number(v.IMPANT)}));$.value.opts=c,i.value.vales=!0}).catch(n=>{console.log(n.response.data),m.notify({html:!0,message:n.response.data,color:"negative",position:"bottom"}),m.loading.hide()})},P=b=>{b.key==="Enter"&&h.value&&(b.preventDefault(),k())},k=()=>{e.value.conditions.super=f.value,e.value.change=p.value,_("sendTicket",e.value),$.value=V({opts:[]}),e.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return ue(()=>{window.addEventListener("keydown",P)}),_e(()=>{window.removeEventListener("keydown",P)}),(b,r)=>(g(),S(R,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:s(()=>[o("div",yt,[r[11]||(r[11]=o("div",null,[o("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),o("div",xt,[r[10]||(r[10]=o("div",{class:"fs-dec3"},"Total Actual",-1)),o("div",_t,"$ "+x(Number(y.total).toFixed(2)),1)])]),l(F,null,{default:s(()=>{var n;return[o("div",ht,[r[12]||(r[12]=o("div",{class:"col"}," Forma de pago: ",-1)),o("div",kt,[l(z,{class:"col-3",modelValue:e.value.PFPA.id,"onUpdate:modelValue":r[0]||(r[0]=c=>e.value.PFPA.id=c),options:y.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":c=>d(c)},null,8,["modelValue","options","option-disable"])])]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),o("div",wt,[o("div",Pt,x(((n=e.value.PFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",Vt,[l(O,{class:"col",modelValue:e.value.PFPA.val,"onUpdate:modelValue":r[2]||(r[2]=c=>e.value.PFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:s(()=>[parseFloat(e.value.PFPA.val)?(g(),S(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:r[1]||(r[1]=c=>e.value.PFPA.val=0)})):C("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),l(F,null,{default:s(()=>{var n;return[o("div",At,[o("div",Ct,[l(w,{color:"primary",label:"2\xAA Forma de pago",onClick:r[3]||(r[3]=()=>{i.value.dafpa=!i.value.dafpa,e.value.SFPA.val=0,e.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),i.value.dafpa?(g(),L("div",$t,[l(z,{class:"col-3",modelValue:e.value.SFPA.id,"onUpdate:modelValue":r[4]||(r[4]=c=>e.value.SFPA.id=c),options:y.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":c=>N(c)},null,8,["modelValue","options","option-disable"])])):C("",!0)]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),i.value.dafpa?(g(),L("div",Ft,[o("div",St,x(((n=e.value.SFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",Dt,[l(O,{class:"col",modelValue:e.value.SFPA.val,"onUpdate:modelValue":r[6]||(r[6]=c=>e.value.SFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:s(()=>[parseFloat(e.value.SFPA.val)?(g(),S(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:r[5]||(r[5]=c=>e.value.SFPA.val=0)})):C("",!0)]),_:1},8,["modelValue"])])])):C("",!0)]}),_:1}),l(F,null,{default:s(()=>[o("div",Nt,[o("div",Tt,[l(w,{color:"primary",label:"Cobrar Vale",onClick:E,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),i.value.vales?(g(),L("div",Qt,[o("div",Et,[l(z,{class:"col",modelValue:e.value.VALE,"onUpdate:modelValue":r[7]||(r[7]=n=>e.value.VALE=n),options:$.value.opts,label:"Vale","option-label":n=>`Vale : ${n.id?n.id.code:""}`,dense:"",filled:""},{option:s(n=>[l(M,Re(Oe(n.itemProps)),{default:s(()=>[l(G,null,{default:s(()=>[l(se,null,{default:s(()=>[J(x(n.opt.id.code),1)]),_:2},1024),l(se,{caption:""},{default:s(()=>[J("$ "+x(Number(n.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),e.value.VALE.id?(g(),S(O,{key:0,modelValue:e.value.VALE.val,"onUpdate:modelValue":r[8]||(r[8]=n=>e.value.VALE.val=n),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):C("",!0)])])):C("",!0)])]),_:1}),f.value?(g(),S(F,{key:0,class:"flex justify-end"},{default:s(()=>[l(Ye,{modelValue:e.value.conditions.createWithdrawal,"onUpdate:modelValue":r[9]||(r[9]=n=>e.value.conditions.createWithdrawal=n),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):C("",!0),l(H,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:s(()=>[o("div",null,[r[13]||(r[13]=o("div",{class:"fs-dec3"},"Cambio",-1)),o("div",It," $ "+x(p.value),1)]),h.value?(g(),L("div",Lt,[l(w,{color:"primary",icon:"payment",label:"Pagar",onClick:k})])):C("",!0)]),_:1})]),_:1}))}},Ut={class:"row items-center justify-between"},qt={class:"col"},Rt={class:"col"},Ot={class:"col"},jt={class:"text-caption text-center"},zt={class:"text-center text-h6"},Kt={key:0,class:"col"},Mt={class:"text-center text-h6 text-caption"},Jt={key:1,class:"col"},Wt={class:"text-center text-h6"},Yt={class:"col"},Gt={class:"text-center text-h6"},Pl={__name:"salesEstandar",setup(y){const U=X(),m=Z();ye(),xe();const i=Je();V(null);const A=V(null),_=V({val:{id:1,label:"Preventa",type:"number"},opts:[{id:1,label:"Preventa",type:"number"},{id:2,label:"Particion",type:"number"},{id:3,label:"Presupuesto",type:"text"},{id:4,label:"Ticket",type:"number"}],valueVal:null}),$=V({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),e=V({name:"IVA",option:!1,optval:[16,8,6],value:0,amount:0}),p=V({val:null,opts:[]}),h=V({val:null,opts:[]}),f=V({state:!1,val:null,edit:!1}),d=V({client:null,dependiente:null,products:[]}),N=V(!1),E=V({columns:[{name:"code",label:"Codigo",field:a=>a.code,align:"left"},{name:"description",label:"Descripcion",field:a=>a.description,align:"left"},{name:"verify",label:"Cantidad",field:a=>a.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:a=>a.pivot.price,align:"center"},{name:"bruto",label:e.option?"Bruto":"Total",field:a=>a.pivot.total,align:"center"},{name:"iva",label:"Total",field:a=>a.pivot.total,align:"center"},{name:"neto",label:"Total",field:a=>a.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),P=V({columns:[{name:"id",label:"Codigo",field:a=>a.id,align:"left"},{name:"Nombre",label:"Descripcion",field:a=>a.name,align:"left"},{name:"Telefono",label:"Pedido",field:a=>a.celphone,align:"center"}],pagination:{rowsPerPage:0}}),k=V({columns:[{name:"id",label:"Codigo",field:a=>a.id,align:"left"},{name:"Nombre",label:"Descripcion",field:a=>a.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),b=Q(()=>Number(d.value.products.reduce((a,t)=>a+t.pivot.total,0)).toFixed(2)),r=Q(()=>d.value.products.reduce((a,t)=>a+Number(t.pivot.toDelivered),0)),n=Q(()=>d.value.products.length>0&&d.value.dependiente&&d.value.client),c=Q(()=>{const a=[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},,{name:"verify",label:"Verificado",field:t=>t.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:t=>t.pivot.price,align:"center"},{name:"bruto",label:e.value.option?"Subtotal":"Total",field:t=>t.pivot.total,format:t=>`$ ${t.toFixed(2)}`,align:"center"}];return e.value.option&&(a.splice(6,0,{name:"iva",label:"IVA",field:t=>t.pivot.total*(e.value.value/100),format:t=>`$ ${t.toFixed(2)}`,align:"center"}),a.push({name:"total",label:"Total c/IVA",field:t=>t.pivot.total*(1+e.value.value/100),format:t=>`$ ${t.toFixed(2)}`,align:"center"})),a}),v=a=>{console.log(a);let t=d.value.products.findIndex(u=>u.id==a.id);t>=0?(f.value.val=d.value.products[t],f.value.state=!0,f.value.edit=!0):(a.pivot=$.value,f.value.val=a,f.value.state=!0,f.value.edit=!1)},B=a=>{console.log(a);let t=d.value.products.findIndex(u=>u.id==a.id);t>=0?(f.value.val=d.value.products[t],f.value.state=!0,f.value.edit=!0):(a.pivot=$.value,f.value.val=a,f.value.state=!0,f.value.edit=!1)},ee=(a,t)=>{console.log(t),f.value.val=t,f.value.edit=!0,f.value.state=!0},T=()=>{console.log("cambio de cliente"),p.value.state=!0},K=async()=>{if(p.value.val){const a=await Ge.getClient(p.value);a.fail?console.log(a):a.length>0?(console.log(a),p.value.opts=a):m.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(a)}else m.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},te=async(a,t)=>{m.loading.show({message:"Recalculando Ticket"}),d.value.client=t,j.actualizarPreciosProductosSales(d.value.products,t._price_list,i.rules),p.value={state:!1,val:null,opts:[]},m.loading.hide()},he=()=>{console.log("cambio de cliente"),h.value.state=!0},ke=async()=>{if(h.value.val){let a={val:h.value.val,sto:U.session.store.id};const t=await oe.getDependiente(a);t.fail?console.log(t):t.length>0?(console.log(t),h.value.opts=t):m.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else m.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},we=(a,t)=>{d.value.dependiente=t,h.value={state:!1,val:null,opts:[]},m.loading.hide()},Pe=a=>{d.value.products.push(a),le(),Y(()=>{var t;(t=A.value)==null||t.focus()})},Ve=()=>{Y(()=>{var a;(a=A.value)==null||a.focus()})},Ae=a=>{let t=d.value.products.findIndex(u=>u.id==a.id);t>=0&&(d.value.products.splice(t,1),le()),Y(()=>{var u;(u=A.value)==null||u.focus()})},Ce=async a=>{m.loading.show({message:"Realizando Ticket"}),d.value.payments=a,d.value.change=a.conditions.super?0:a.change,e.value.option?(d.value.subtotal=d.value.products.reduce((D,q)=>D+q.pivot.total,0),d.value.iva=e.value.value,d.value.total=Number(b.value*Number(1+e.value.value/100).toFixed(2)),d.value.products.forEach(D=>{D.pivot.iva=e.value.value,D.pivot.subtotal=D.pivot.total,D.pivot.total=D.pivot.total*(1+e.value.value/100)})):d.value.total=d.value.products.reduce((D,q)=>D+q.pivot.total,0);let t={order:d.value,cashier:i.cash};console.log(t);const u=await oe.addSaleStandar(t);u.fail?console.log(u):(console.log(u),N.value=!1,d.value={client:null,dependiente:null,products:[]},e.value.value=0,e.value.option=!1,localStorage.removeItem("current_sale"),m.loading.hide())},le=()=>{f.value={state:!1,val:null,edit:!1},$.value={amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},Y(()=>{var a;(a=A.value)==null||a.focus()})},$e=async()=>{switch(console.log(_.value),_.value.val.id){case 1:Fe(_.value);break}},Fe=async a=>{if(console.log(a),a){m.loading.show({message:"Obteniendo Orden"});let t={uid:U.session.credentials.staff.id_va,oid:a.valueVal};const u=await oe.getOrderCash(t);u.fail?u.fail.status==401?(console.log(u),m.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),a.value=null,m.loading.hide()):u.fail.status==404?(console.log(u),m.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),a.value=null,m.loading.hide()):console.log(u):(d.value.dependiente=u.staff,d.value.client=u.client,u.products.forEach(D=>{var ce;console.log(D);const q=d.value.products.find(De=>De.id===D.id),Se=((ce=D.pivot)==null?void 0:ce.units)||0;q?(q.pivot||(q.pivot={units:0}),q.pivot.units+=Se):d.value.products.push({...D})}),_.value.valueVal=null,console.log(u),m.loading.hide())}},re=a=>{a.ctrlKey&&a.key.toLowerCase()==="b"?(a.preventDefault(),p.value.state||(p.value.state=!0)):a.ctrlKey&&a.key.toLowerCase()==="d"?(a.preventDefault(),h.value.state||(h.value.state=!0)):a.altKey&&a.key==="Enter"&&n.value&&(a.preventDefault(),N.value||(N.value=!0))};return je(()=>d.value,a=>{localStorage.setItem("current_sale",JSON.stringify(a))},{deep:!0}),ue(()=>{const a=localStorage.getItem("current_sale");a&&(d.value=JSON.parse(a)),window.addEventListener("keydown",re)}),_e(()=>{window.removeEventListener("keydown",re)}),(a,t)=>(g(),S(Me,null,{default:s(()=>[l(ze,{class:""},{default:s(()=>[l(Ne),l(w,{flat:"",round:"",dense:"",icon:"settings",class:"q-mr-xs"},{default:s(()=>[l(ve,{style:{width:"200px"}},{default:s(()=>[l(R,{class:"my-card"},{default:s(()=>[l(F,null,{default:s(()=>[l(pe,{dense:""},{default:s(()=>[l(M,{class:"q-px-sm q-py-xs column"},{default:s(()=>[o("div",Ut,[l(se,null,{default:s(()=>[J(x(e.value.name),1)]),_:1}),l(Te,{color:"blue",modelValue:e.value.option,"onUpdate:modelValue":[t[0]||(t[0]=u=>e.value.option=u),t[1]||(t[1]=u=>{u?e.value.value=16:e.value.value=0})]},null,8,["modelValue"])]),e.value.option?(g(),S(z,{key:0,modelValue:e.value.value,"onUpdate:modelValue":t[2]||(t[2]=u=>e.value.value=u),options:e.value.optval,label:"Porcentaje",filled:"",dense:"","emit-value":"","map-options":"",class:"q-mt-sm"},null,8,["modelValue","options"])):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(w,{flat:"",round:"",dense:"",icon:"receipt_long"},{default:s(()=>[l(ve,null,{default:s(()=>[l(pe,{style:{"min-width":"100px"}},{default:s(()=>[l(M,null,{default:s(()=>[l(G,null,{default:s(()=>[l(z,{modelValue:_.value.val,"onUpdate:modelValue":t[3]||(t[3]=u=>_.value.val=u),options:_.value.opts,label:"Tipo",filled:"",dense:""},null,8,["modelValue","options"]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),l(O,{modelValue:_.value.valueVal,"onUpdate:modelValue":t[4]||(t[4]=u=>_.value.valueVal=u),type:_.value.val.type,dense:"",filled:"",label:_.value.val.label,onKeyup:de($e,["enter"])},null,8,["modelValue","type","label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(R,{class:"my-card"},{default:s(()=>[l(F,{class:"row"},{default:s(()=>[o("div",qt,[t[12]||(t[12]=o("div",{class:"text-caption text-center"},"Dependiente",-1)),l(w,{class:"full-width",flat:"",label:d.value.dependiente?d.value.dependiente.complete_name:"CTRL+d",onClick:he},null,8,["label"])]),l(I,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Rt,[t[13]||(t[13]=o("div",{class:"text-caption text-center"},"Cliente",-1)),l(w,{class:"full-width",flat:"",label:d.value.client?d.value.client.name:"CTRL+b",onClick:T},null,8,["label"])])]),_:1})]),_:1}),l(I,{spaced:"",inset:"",vertical:"",dark:""}),l(R,{class:"my-card"},{default:s(()=>[l(F,{class:"row"},{default:s(()=>[o("div",Ot,[o("div",jt,x(e.value.option?"SUBTOTAL":"TOTAL"),1),o("div",zt,"$ "+x(b.value),1)]),e.value.option?(g(),L("div",Kt,[t[14]||(t[14]=o("div",{class:"text-caption text-center"}," IVA ",-1)),o("div",Mt,"$ "+x(Number(b.value*Number(e.value.value/100)).toFixed(2)),1)])):C("",!0),e.value.option?(g(),L("div",Jt,[t[15]||(t[15]=o("div",{class:"text-caption text-center"}," TOTAL ",-1)),o("div",Wt,"$ "+x(Number(b.value*Number(1+e.value.value/100)).toFixed(2)),1)])):C("",!0),o("div",Yt,[t[16]||(t[16]=o("div",{class:"text-caption text-center"},"Cantidad",-1)),o("div",Gt,x(r.value),1)])]),_:1})]),_:1}),l(I,{spaced:"",inset:"",vertical:"",dark:""}),l(ae,{rows:d.value.products,columns:c.value,"hide-bottom":"",pagination:E.value.pagination,onRowClick:ee},null,8,["rows","columns","pagination"]),l(W,{modelValue:f.value.state,"onUpdate:modelValue":t[5]||(t[5]=u=>f.value.state=u),persistent:"",position:"bottom"},{default:s(()=>[l(gt,{product:f.value.val,_price_list:p.value.val?p.value.val._price_list:1,edit:f.value.edit,onReset:le,products:d.value.products,rules:me(i).rules,onAddProduct:Pe,onDeleteProduct:Ae,onEditProduct:Ve},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),l(W,{modelValue:p.value.state,"onUpdate:modelValue":t[7]||(t[7]=u=>p.value.state=u)},{default:s(()=>[l(R,{style:{width:"700px"}},{default:s(()=>[l(fe,{onSubmit:K},{default:s(()=>[t[17]||(t[17]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),t[18]||(t[18]=o("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),l(F,null,{default:s(()=>[l(I,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[l(O,{autofocus:"",modelValue:p.value.val,"onUpdate:modelValue":t[6]||(t[6]=u=>p.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),p.value.opts.length>0?(g(),S(F,{key:0},{default:s(()=>[l(ae,{rows:p.value.opts,columns:P.value.columns,pagination:P.value.pagination,onRowClick:te},null,8,["rows","columns","pagination"])]),_:1})):C("",!0),l(H,{align:"right"},{default:s(()=>[ne(l(w,{flat:"",label:"Cancelar",color:"primary"},null,512),[[be]]),l(w,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(W,{modelValue:h.value.state,"onUpdate:modelValue":t[9]||(t[9]=u=>h.value.state=u)},{default:s(()=>[l(R,{style:{width:"700px"}},{default:s(()=>[l(fe,{onSubmit:ke},{default:s(()=>[t[19]||(t[19]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),t[20]||(t[20]=o("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),l(F,null,{default:s(()=>[l(I,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[l(O,{autofocus:"",modelValue:h.value.val,"onUpdate:modelValue":t[8]||(t[8]=u=>h.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),h.value.opts.length>0?(g(),S(F,{key:0},{default:s(()=>[l(ae,{rows:h.value.opts,columns:k.value.columns,pagination:k.value.pagination,onRowClick:we},null,8,["rows","columns","pagination"])]),_:1})):C("",!0),l(H,{align:"right"},{default:s(()=>[ne(l(w,{flat:"",label:"Cancelar",color:"primary"},null,512),[[be]]),l(w,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",null,[l(W,{modelValue:N.value,"onUpdate:modelValue":t[10]||(t[10]=u=>N.value=u)},{default:s(()=>[l(Bt,{total:e.value.option?Number(b.value*Number.parseFloat(1+e.value.value/100)):Number(b.value),paymeths:me(i).methods,client:d.value.client.id,onSendTicket:Ce},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),l(Ke,{bordered:"",class:"bg-white"},{default:s(()=>[l(R,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[l(F,{class:"row"},{default:s(()=>[l(st,{ref_key:"productRef",ref:A,class:"col",checkState:!1,onInput:B,onAgregar:v},null,512),n.value?(g(),S(w,{key:0,color:"primary",flat:"",icon:"east",onClick:t[11]||(t[11]=u=>N.value=!N.value),round:""})):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Pl as default};
