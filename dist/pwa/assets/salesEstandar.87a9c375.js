import{Q as Le}from"./QToolbarTitle.052b9115.js";import{Q as M,a as se,e as ie}from"./QSelect.6d05204b.js";import{_ as Qe,u as Z,r as w,g as Q,o as ee,a as y,c as B,d as t,bB as te,m as T,f as me,Z as fe,h as S,i as u,l as F,k as i,a1 as V,a3 as Te,a2 as Be,b9 as ne,a4 as L,n as x,a5 as G,p as A,Q as O,y as ge,bn as Ue,bo as qe,j as ue,b8 as Ie,w as Oe,a7 as X,a6 as z,aX as re,H as j}from"./index.7b36b598.js";import{a as Y,b as H,Q as de}from"./QList.912e2662.js";import{Q as Re}from"./QToolbar.16507dcd.js";import{Q as K}from"./QTable.7331a546.js";import{Q as ze}from"./QBadge.4fc5bdcb.js";import{Q as je}from"./QTd.bf9b68b7.js";import{Q as ce}from"./QForm.55f39c90.js";import{Q as Ke}from"./QFooter.8f5d5723.js";import{Q as Me}from"./QPage.4fad267d.js";import{C as pe}from"./ClosePopup.8d8b6328.js";import{u as Ge,c as ve}from"./cashApi.05d2bfbe.js";import"./QImg.8ac60bab.js";import{Q as Ze}from"./QSpace.9d6d302e.js";import"./QExpansionItem.404142ee.js";import"./favorites.6a93ba8d.js";import{b as Je}from"./axios.59d61e02.js";import{u as J}from"./use-quasar.d212ba29.js";import{p as We}from"./productsApi.f8619e99.js";import{R as k}from"./resoursesOrder.2136c8da.js";import{o as Xe}from"./orderApi.1eb65bc2.js";import{s as Ye}from"./saleLocalApi.ad103010.js";import"./QLinearProgress.51f9a353.js";import"./QResizeObserver.aad412c0.js";import"./QScrollObserver.b72b88d9.js";const He={class:"QuickRegular row items-center"},et={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]}},emits:["input","similarcodes","agregar"],setup(f,{expose:U,emit:v}){const o=J(),C=Z(),N=f,E=v,a=w({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),m=w(null),_=Q(()=>({autocomplete:a.value.target,limit:N.limit,_workpoint:C.session.store.id_viz,strict:a.value.read_barcode}));ee(()=>{a.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let b=JSON.parse(localStorage.getItem("typeiptsearch"));b&&(a.value.iptsearch.type=b.type,a.value.iptsearch.icon=b.icon)});const g=b=>{a.value.target="",E("input",b)},s=()=>{a.value.target.trim().toUpperCase(),a.value.target.length&&(a.value.iptsearch.processing=!0,console.log(_.value),We.autocomplete(_.value).then(b=>{let d=b.data;switch(Object.keys(d).length){case 0:let c=a.value.target;o.notify({message:`Sin resultados para <b>${c}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),I();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(d),g(d);break}a.value.target="",a.value.iptsearch.processing=!1}).catch(b=>{console.log(b)}))},I=()=>{console.log("putFocus ejecutada!!"),m.value.focus()};return U({focus:()=>{var b,d;return(d=(b=m.value)==null?void 0:b.focus)==null?void 0:d.call(b)}}),(b,d)=>(y(),B("div",He,[t(T,{ref_key:"iptatc",ref:m,loading:a.value.iptsearch.processing,disable:a.value.iptsearch.processing,modelValue:a.value.target,"onUpdate:modelValue":d[0]||(d[0]=c=>a.value.target=c),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:te(s,["enter"]),autocomplete:"off",autofocus:"",label:"Codigo..."},null,8,["loading","disable","modelValue"])]))}};var tt=Qe(et,[["__scopeId","data-v-6dc857d2"]]);const lt={class:"row"},at={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},ot={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},st={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},it={class:"row"},nt={class:"text-h6 col text-bold text-left"},ut={class:"text-h6 col text-bold text-right"},rt={class:"text-subtitle2 col"},dt={class:"text-center"},ct={class:"q-pa-xs"},pt={class:"row items-center justify-center q-gutter-md"},vt={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]},promotion:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(f,{emit:U}){Z();const v=J();me(),fe();const o=f,C=U,N=Q(()=>!o.product.pivot.units||o.product.pivot.units<=0),E=Q(()=>o.product.pivot.units),a=Q(()=>o._price_list<=3?[1,2,3,4]:[o._price_list]),m=Q(()=>o._price_list<=3?k.verificarPrecioCaja(o.products,o.product,o.rules)?4:k.verificarPrecioDocena(o.products,o.product,o.rules)?3:k.verificarPrecioMayoreo(o.products,o.product,o.rules)?2:1:o._price_list),_=()=>{C("reset")},g=async()=>{v.loading.show({message:"Editando Producto"});let b=o.product.prices.find(c=>c.id==m.value).pivot.price,d=E.value*b;o.product.pivot.toDelivered=E.value,o.product.pivot._price_list=m.value,o.product.pivot.price=b,o.product.pivot.total=d,v.loading.hide(),_(),k.aplicarPromociones(o.products,o.promotion),k.actualizarPreciosProductosSales(o.products,o._price_list,o.rules),C("editProduct")},s=async()=>{(!o.product.pivot.units||o.product.pivot.units<1)&&(o.product.pivot.units=1),v.loading.show({message:"Agregando producto"});let b=o.product.prices.find(c=>c.id==m.value).pivot.price,d=E.value*b;o.product.pivot.toDelivered=E.value,o.product.pivot._price_list=m.value,o.product.pivot.price=b,o.product.pivot.total=d,o.product.pivot._product=o.product.id,console.log(o.product),C("addProduct",o.product),v.loading.hide(),k.aplicarPromociones(o.products,o.promotion),k.actualizarPreciosProductosSales(o.products,o._price_list,o.rules)},I=async()=>{v.loading.show({message:"Eliminando Producto"}),C("deleteProduct",o.product),v.loading.hide(),k.aplicarPromociones(o.products,o.promotion),k.actualizarPreciosProductosSales(o.products,o._price_list,o.rules)};return(b,d)=>(y(),S(O,null,{default:u(()=>[t(F,{class:"item-center"},{default:u(()=>[i("div",lt,[i("div",at,V(f.product.category.familia.seccion.name),1),i("div",ot,V(f.product.category.familia.name),1),i("div",st,V(f.product.category.name),1)])]),_:1}),t(F,{class:"item-center"},{default:u(()=>[i("div",it,[i("div",nt,V(f.product.code),1),i("div",ut,V(f.product.name),1)]),i("div",rt,V(f.product.description),1)]),_:1}),t(F,{class:"item-center row"},{default:u(()=>[(y(!0),B(Te,null,Be(f.product.prices.filter(c=>a.value.includes(c.id)),(c,P)=>(y(),B("div",{class:"col text-subtitle2 text-center",key:P},[i("div",{class:ne(c.id==m.value?"text-weight-bold":"text-caption text-strike")},V(c.alias),3),t(L,{spaced:"",inset:"",vertical:"",dark:""}),i("div",{class:ne(c.id==m.value?"text-bold  text-blue-13":"text-caption")},V(c.pivot.price),3),t(L,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),t(F,null,{default:u(()=>[i("div",dt,[i("div",ct,[d[6]||(d[6]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",pt,[t(x,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:d[0]||(d[0]=c=>f.product.pivot.units>1?f.product.pivot.units--:"")}),t(T,{modelValue:f.product.pivot.units,"onUpdate:modelValue":[d[1]||(d[1]=c=>f.product.pivot.units=c),d[4]||(d[4]=c=>{c?c<1?f.product.pivot.units=1:Number.isInteger(c)||(f.product.pivot.units=Math.floor(c)):f.product.pivot.units=1})],modelModifiers:{number:!0},type:"number",outlined:"",min:"1",step:"1","input-class":"text-center text-h3",style:{width:"100px"},autofocus:"",onKeydown:d[2]||(d[2]=te(c=>f.edit?g():s(),["enter"])),onKeypress:d[3]||(d[3]=c=>(c.key==="."||c.key==="-")&&c.preventDefault())},null,8,["modelValue"]),t(x,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:d[5]||(d[5]=c=>f.product.pivot.units++)})])])])]),_:1}),t(G,null,{default:u(()=>[t(x,{flat:"",icon:"close",onClick:_}),t(Ze),f.edit?A("",!0):(y(),S(x,{key:0,flat:"",icon:"add",color:"positive",onClick:s,disable:N.value},null,8,["disable"])),f.edit?(y(),S(x,{key:1,flat:"",icon:"delete",color:"negative",onClick:I})):A("",!0),f.edit?(y(),S(x,{key:2,flat:"",icon:"edit",color:"warning",onClick:g,disable:N.value},null,8,["disable"])):A("",!0)]),_:1})]),_:1}))}},mt={class:"bg-primary row items-center justify-between q-pa-md text-white"},ft={class:"text-right"},gt={class:"fw-bold text-h4"},bt={class:"row text-center items-center"},yt={class:"col"},_t={class:"row text-center items-center"},xt={class:"col"},Pt={class:"col"},ht={class:"row flex justify-center"},wt={class:"col flex justify-center"},kt={key:0,class:"col"},Vt={key:0,class:"row flex justify-center text-center"},At={class:"col"},Ct={class:"col"},Nt={class:"row flex justify-center"},Ft={class:"col flex justify-center"},St={key:0,class:"col"},Et={class:"row"},Dt={class:"text-h5"},$t={key:0,class:"text-center"},Lt={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(f,{emit:U}){Z();const v=J(),o=w({dafpa:!1,vales:!1}),C=f,N=U,E=w({opts:[]}),a=w({PFPA:{id:C.paymeths[1],val:Math.round(C.total)},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),m=Q(()=>(Number(Number.parseFloat(a.value.SFPA.val)+Number.parseFloat(a.value.PFPA.val))+Number.parseFloat(a.value.VALE.val)-Number.parseFloat(C.total)).toFixed(2)),_=Q(()=>{var P,r,p;return m.value>=0&&(((P=a.value.PFPA.id)==null?void 0:P.id)&&a.value.PFPA.val>0||((r=a.value.SFPA.id)==null?void 0:r.id)&&a.value.SFPA.val>0||((p=a.value.VALE.id)==null?void 0:p.id)&&a.value.VALE.val>0)}),g=Q(()=>{const P=Object.values(a.value);if(P.some(D=>D.id&&D.id.alias==="EFE"&&D.val>0))return!1;const p=P.some(D=>D.id&&D.id.alias!=="EFE"),h=P.reduce((D,R)=>D+Number(R.val||0),0);return p&&h>C.total}),s=P=>{var r;return P.id==((r=a.value.SFPA.id)==null?void 0:r.id)},I=P=>{var r;return P.id==((r=a.value.PFPA.id)==null?void 0:r.id)},b=async()=>{v.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let r=`http://192.168.10.160:1619/access/public/modify/vales?price=${C.client}`;Je.get(r).then(p=>{console.log(p.data),v.loading.hide();let h=p.data.map(D=>({id:{id:5,alias:"[V]",name:"VALE",code:D.CODANT},val:Number(D.IMPANT)}));E.value.opts=h,o.value.vales=!0}).catch(p=>{console.log(p.response.data),v.notify({html:!0,message:p.response.data,color:"negative",position:"bottom"}),v.loading.hide()})},d=P=>{P.key==="Enter"&&_.value&&(P.preventDefault(),c())},c=()=>{a.value.conditions.super=g.value,a.value.change=m.value,N("sendTicket",a.value),E.value=w({opts:[]}),a.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return ee(()=>{window.addEventListener("keydown",d)}),ge(()=>{window.removeEventListener("keydown",d)}),(P,r)=>(y(),S(O,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:u(()=>[i("div",mt,[r[11]||(r[11]=i("div",null,[i("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),i("div",ft,[r[10]||(r[10]=i("div",{class:"fs-dec3"},"Total Actual",-1)),i("div",gt,"$ "+V(Number(f.total).toFixed(2)),1)])]),t(F,null,{default:u(()=>{var p;return[i("div",bt,[r[12]||(r[12]=i("div",{class:"col"}," Forma de pago: ",-1)),i("div",yt,[t(M,{class:"col-3",modelValue:a.value.PFPA.id,"onUpdate:modelValue":r[0]||(r[0]=h=>a.value.PFPA.id=h),options:f.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":h=>s(h)},null,8,["modelValue","options","option-disable"])])]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),i("div",_t,[i("div",xt,V(((p=a.value.PFPA.id)==null?void 0:p.id)==2?"Efectivo":"Importe Cobrado"),1),i("div",Pt,[t(T,{class:"col",modelValue:a.value.PFPA.val,"onUpdate:modelValue":r[2]||(r[2]=h=>a.value.PFPA.val=h),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:u(()=>[parseFloat(a.value.PFPA.val)?(y(),S(x,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:r[1]||(r[1]=h=>a.value.PFPA.val=0)})):A("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),t(F,null,{default:u(()=>{var p;return[i("div",ht,[i("div",wt,[t(x,{color:"primary",label:"2\xAA Forma de pago",onClick:r[3]||(r[3]=()=>{o.value.dafpa=!o.value.dafpa,a.value.SFPA.val=0,a.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),o.value.dafpa?(y(),B("div",kt,[t(M,{class:"col-3",modelValue:a.value.SFPA.id,"onUpdate:modelValue":r[4]||(r[4]=h=>a.value.SFPA.id=h),options:f.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":h=>I(h)},null,8,["modelValue","options","option-disable"])])):A("",!0)]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),o.value.dafpa?(y(),B("div",Vt,[i("div",At,V(((p=a.value.SFPA.id)==null?void 0:p.id)==2?"Efectivo":"Importe Cobrado"),1),i("div",Ct,[t(T,{class:"col",modelValue:a.value.SFPA.val,"onUpdate:modelValue":r[6]||(r[6]=h=>a.value.SFPA.val=h),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:u(()=>[parseFloat(a.value.SFPA.val)?(y(),S(x,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:r[5]||(r[5]=h=>a.value.SFPA.val=0)})):A("",!0)]),_:1},8,["modelValue"])])])):A("",!0)]}),_:1}),t(F,null,{default:u(()=>[i("div",Nt,[i("div",Ft,[t(x,{color:"primary",label:"Cobrar Vale",onClick:b,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),o.value.vales?(y(),B("div",St,[i("div",Et,[t(M,{class:"col",modelValue:a.value.VALE,"onUpdate:modelValue":r[7]||(r[7]=p=>a.value.VALE=p),options:E.value.opts,label:"Vale","option-label":p=>`Vale : ${p.id?p.id.code:""}`,dense:"",filled:""},{option:u(p=>[t(Y,Ue(qe(p.itemProps)),{default:u(()=>[t(H,null,{default:u(()=>[t(se,null,{default:u(()=>[ue(V(p.opt.id.code),1)]),_:2},1024),t(se,{caption:""},{default:u(()=>[ue("$ "+V(Number(p.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),a.value.VALE.id?(y(),S(T,{key:0,modelValue:a.value.VALE.val,"onUpdate:modelValue":r[8]||(r[8]=p=>a.value.VALE.val=p),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):A("",!0)])])):A("",!0)])]),_:1}),g.value?(y(),S(F,{key:0,class:"flex justify-end"},{default:u(()=>[t(Ie,{modelValue:a.value.conditions.createWithdrawal,"onUpdate:modelValue":r[9]||(r[9]=p=>a.value.conditions.createWithdrawal=p),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):A("",!0),t(G,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:u(()=>[i("div",null,[r[13]||(r[13]=i("div",{class:"fs-dec3"},"Cambio",-1)),i("div",Dt," $ "+V(m.value),1)]),_.value?(y(),B("div",$t,[t(x,{color:"primary",icon:"payment",label:"Pagar",onClick:c})])):A("",!0)]),_:1})]),_:1}))}},Qt={class:"col"},Tt={class:"col"},Bt={class:"col"},Ut={class:"text-caption text-center"},qt={class:"text-center text-h6"},It={key:0,class:"col"},Ot={class:"text-center text-h6 text-caption"},Rt={key:1,class:"col"},zt={class:"text-center text-h6"},jt={class:"col"},Kt={class:"text-center text-h6"},Mt={class:"row q-ml-sm q-mr-sm"},Gt={key:0,class:"col"},Zt={class:"col"},Pl={__name:"salesEstandar",setup(f){const U=Z(),v=J();me(),fe();const o=Ge();w(null);const C=w(null),N=w({val:{id:1,label:"Preventa",type:"number"},opts:[{id:1,label:"Preventa",type:"number"}],valueVal:null}),E=w({amount:0,amountDelivered:1,price:0,toDelivered:0,total:0,units:1,_price_list:1,_supply_by:1}),a=w({name:"IVA",option:!1,optval:[16,8,6],value:0,amount:0}),m=w({val:null,opts:[]}),_=w({val:null,opts:[]}),g=w({state:!1,val:null,edit:!1}),s=w({client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:U.session.credentials.staff,products:[],observation:null}),I=Q(()=>(s.value.products||[]).filter(e=>e.pivot.toDelivered>0)),b=Q(()=>(s.value.products||[]).filter(e=>!e.pivot.toDelivered)),d=w(!1),c=w({columns:[{name:"code",label:"Codigo",field:e=>e.code,align:"left"},{name:"description",label:"Descripcion",field:e=>e.description,align:"left"},{name:"verify",label:"Cantidad",field:e=>e.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:e=>e.pivot.price,align:"center"},{name:"bruto",label:a.option?"Bruto":"Total",field:e=>e.pivot.total,align:"center"},{name:"iva",label:"Total",field:e=>e.pivot.total,align:"center"},{name:"neto",label:"Total",field:e=>e.pivot.total,align:"center"}],pagination:{rowsPerPage:0},filter:null}),P=w({columns:[{name:"id",label:"Codigo",field:e=>e.id,align:"left"},{name:"Nombre",label:"Descripcion",field:e=>e.name,align:"left"},{name:"Telefono",label:"Pedido",field:e=>e.celphone,align:"center"}],pagination:{rowsPerPage:0}}),r=w({columns:[{name:"id",label:"Codigo",field:e=>e.id,align:"left"},{name:"Nombre",label:"Descripcion",field:e=>e.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),p=Q(()=>Number(s.value.products.reduce((e,l)=>e+l.pivot.total,0)).toFixed(2)),h=Q(()=>s.value.products.reduce((e,l)=>e+Number(l.pivot.toDelivered),0)),D=Q(()=>s.value.products.length>0&&s.value.dependiente&&s.value.client),R=Q(()=>[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},,{name:"verify",label:"Verificado",field:l=>l.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:l=>l.pivot.price,align:"center"},{name:"promo",label:"Oferta",field:l=>Number(l.pivot.promo_amount)>0,align:"center"},{name:"bruto",label:a.value.option?"Subtotal":"Total",field:l=>l.pivot.total,format:l=>`$ ${l.toFixed(2)}`,align:"center"}]),be=e=>{if(console.log(e),e.prices.map(n=>n.pivot.price).includes(0))v.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let n=s.value.products.findIndex($=>$.id==e.id);n>=0?(g.value.val=s.value.products[n],g.value.state=!0,g.value.edit=!0):(e.pivot=E.value,g.value.val=e,g.value.state=!0,g.value.edit=!1)}},ye=e=>{if(console.log(e),e.prices.map(n=>n.pivot.price).includes(0))v.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let n=s.value.products.findIndex($=>$.id==e.id);n>=0?(g.value.val=s.value.products[n],g.value.state=!0,g.value.edit=!0):(e.pivot=E.value,g.value.val=e,g.value.state=!0,g.value.edit=!1)}},le=(e,l)=>{console.log(l),g.value.val=l,g.value.edit=!0,g.value.state=!0},_e=()=>{console.log("cambio de cliente"),m.value.state=!0},xe=async()=>{if(m.value.val){const e=await Xe.getClient(m.value);e.fail?console.log(e):e.length>0?(console.log(e),m.value.opts=e):v.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(e)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},Pe=async(e,l)=>{v.loading.show({message:"Recalculando Ticket"}),s.value.client=l,k.aplicarPromociones(s.value.products,o.promotion),k.actualizarPreciosProductosSales(s.value.products,l._price_list,o.rules),m.value={state:!1,val:null,opts:[]},v.loading.hide()},he=()=>{console.log("cambio de cliente"),_.value.state=!0},we=async()=>{if(_.value.val){let e={val:_.value.val,sto:U.session.store.id};const l=await ve.getDependiente(e);l.fail?console.log(l):l.length>0?(console.log(l),_.value.opts=l):v.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(l)}else v.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},ke=(e,l)=>{s.value.dependiente=l,_.value={state:!1,val:null,opts:[]},v.loading.hide()},Ve=e=>{s.value.products.push(e),k.aplicarPromociones(s.value.products,o.promotion),k.actualizarPreciosProductosSales(s.value.products,s.value.client._price_list,o.rules),W(),j(()=>{var l;(l=C.value)==null||l.focus()})},Ae=()=>{k.aplicarPromociones(s.value.products,o.promotion),k.actualizarPreciosProductosSales(s.value.products,s.value.client._price_list,o.rules),j(()=>{var e;(e=C.value)==null||e.focus()})},Ce=e=>{let l=s.value.products.findIndex(n=>n.id==e.id);l>=0&&(s.value.products.splice(l,1),k.aplicarPromociones(s.value.products,o.promotion),k.actualizarPreciosProductosSales(s.value.products,s.value.client._price_list,o.rules),W()),j(()=>{var n;(n=C.value)==null||n.focus()})},Ne=async e=>{v.loading.show({message:"Realizando Ticket"}),s.value.payments=e,s.value.change=e.conditions.super?0:e.change,a.value.option?(s.value.subtotal=s.value.products.reduce(($,q)=>$+q.pivot.total,0),s.value.iva=a.value.value,s.value.total=Number(p.value*Number(1+a.value.value/100).toFixed(2)),s.value.impuesto=Number(p.value*Number(a.value.value/100)).toFixed(2)):s.value.total=s.value.products.reduce(($,q)=>$+q.pivot.total,0);let l={order:s.value,cashier:o.cash,config:a.value};console.log(l);const n=await Ye.addSale(l);if(console.log(n),n.fail)console.log(n);else{console.log(n),d.value=!1;let $={client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:s.value.dependiente,products:[],observation:null};s.value=$,a.value.value=0,a.value.option=!1,v.loading.hide()}},W=()=>{g.value={state:!1,val:null,edit:!1},E.value={amount:0,amountDelivered:null,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},j(()=>{var e;(e=C.value)==null||e.focus()})},Fe=async()=>{switch(console.log(N.value),N.value.val.id){case 1:Se(N.value);break}},Se=async e=>{if(console.log(e),e){v.loading.show({message:"Obteniendo Orden"});let l={uid:U.session.credentials.staff.id_va,oid:e.valueVal};const n=await ve.getOrderCash(l);n.fail?n.fail.status==401?(console.log(n),v.notify({message:n.fail.response.data,type:"negative",position:"bottom"}),e.value=null,v.loading.hide()):n.fail.status==404?(console.log(n),v.notify({message:n.fail.response.data,type:"negative",position:"bottom"}),e.value=null,v.loading.hide()):console.log(n):(s.value.order=e.valueVal,s.value.dependiente=n.staff,s.value.client=n.client,n.products.forEach($=>{var oe;console.log($);const q=s.value.products.find($e=>$e.id===$.id),De=((oe=$.pivot)==null?void 0:oe.units)||0;q?(q.pivot||(q.pivot={units:0}),q.pivot.units+=De):s.value.products.push({...$})}),k.aplicarPromociones(s.value.products,o.promotion),k.actualizarPreciosProductosSales(s.value.products,s.value.client._price_list,o.rules),N.value.valueVal=null,console.log(n),v.loading.hide())}},Ee=()=>{s.value.products=[]},ae=e=>{e.ctrlKey&&e.key.toLowerCase()==="b"?(e.preventDefault(),m.value.state||(m.value.state=!0)):e.ctrlKey&&e.key.toLowerCase()==="d"?(e.preventDefault(),_.value.state||(_.value.state=!0)):e.altKey&&e.key==="Enter"&&D.value&&(e.preventDefault(),d.value||(d.value=!0))};return Oe(()=>s.value,e=>{localStorage.setItem("current_sale",JSON.stringify(e))},{deep:!0}),ee(()=>{const e=localStorage.getItem("current_sale");e&&(s.value=JSON.parse(e)),window.addEventListener("keydown",ae)}),ge(()=>{window.removeEventListener("keydown",ae)}),(e,l)=>(y(),S(Me,null,{default:u(()=>[t(Re,{class:""},{default:u(()=>[t(Le),t(x,{flat:"",round:"",dense:"",icon:"receipt_long"},{default:u(()=>[t(ie,null,{default:u(()=>[t(de,{style:{"min-width":"100px"}},{default:u(()=>[t(Y,null,{default:u(()=>[t(H,null,{default:u(()=>[t(M,{modelValue:N.value.val,"onUpdate:modelValue":l[0]||(l[0]=n=>N.value.val=n),options:N.value.opts,label:"Tipo",filled:"",dense:""},null,8,["modelValue","options"]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),t(T,{modelValue:N.value.valueVal,"onUpdate:modelValue":l[1]||(l[1]=n=>N.value.valueVal=n),type:N.value.val.type,dense:"",filled:"",label:N.value.val.label,onKeyup:te(Fe,["enter"])},null,8,["modelValue","type","label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(x,{icon:"delete_sweep",onClick:Ee,flat:"",round:"",dense:"",title:"Eliminar Productos"}),t(x,{icon:"notes",flat:"",round:"",dense:"",title:"Agregar Notas"},{default:u(()=>[t(ie,null,{default:u(()=>[t(de,{style:{"min-width":"100px"}},{default:u(()=>[t(Y,null,{default:u(()=>[t(H,null,{default:u(()=>[t(T,{modelValue:s.value.observation,"onUpdate:modelValue":l[2]||(l[2]=n=>s.value.observation=n),type:"text",label:"Observacion"},null,8,["modelValue"])]),_:1})]),_:1}),t(L)]),_:1})]),_:1})]),_:1})]),_:1}),t(O,{class:"my-card q-ml-sm q-mr-sm"},{default:u(()=>[t(F,{class:"row"},{default:u(()=>[i("div",Qt,[l[11]||(l[11]=i("div",{class:"text-caption text-center"},"Dependiente",-1)),t(x,{class:"full-width",flat:"",label:s.value.dependiente?s.value.dependiente.complete_name:"CTRL+d",onClick:he},null,8,["label"])]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),i("div",Tt,[l[12]||(l[12]=i("div",{class:"text-caption text-center"},"Cliente",-1)),t(x,{class:"full-width",flat:"",label:s.value.client?s.value.client.name:"CTRL+b",onClick:_e},null,8,["label"])])]),_:1})]),_:1}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),t(O,{class:"my-card q-ml-sm q-mr-sm"},{default:u(()=>[t(F,{class:"row"},{default:u(()=>[i("div",Bt,[i("div",Ut,V(a.value.option?"SUBTOTAL":"TOTAL"),1),i("div",qt,"$ "+V(p.value),1)]),a.value.option?(y(),B("div",It,[l[13]||(l[13]=i("div",{class:"text-caption text-center"}," IVA ",-1)),i("div",Ot,"$ "+V(Number(p.value*Number(a.value.value/100)).toFixed(2)),1)])):A("",!0),a.value.option?(y(),B("div",Rt,[l[14]||(l[14]=i("div",{class:"text-caption text-center"}," TOTAL ",-1)),i("div",zt,"$ "+V(Number(p.value*Number(1+a.value.value/100)).toFixed(2)),1)])):A("",!0),i("div",jt,[l[15]||(l[15]=i("div",{class:"text-caption text-center"},"Cantidad",-1)),i("div",Kt,V(h.value),1)])]),_:1})]),_:1}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),t(T,{class:"q-ml-md q-mr-md",modelValue:c.value.filter,"onUpdate:modelValue":l[3]||(l[3]=n=>c.value.filter=n),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),i("div",Mt,[b.value.length>0?(y(),B("div",Gt,[t(K,{rows:b.value,columns:R.value,"hide-bottom":"",pagination:c.value.pagination,onRowClick:le,filter:c.value.filter},null,8,["rows","columns","pagination","filter"])])):A("",!0),b.value.length>0?(y(),S(L,{key:1,spaced:"",inset:"",vertical:"",dark:""})):A("",!0),i("div",Zt,[t(K,{rows:I.value,columns:R.value,"hide-bottom":"",pagination:c.value.pagination,onRowClick:le,filter:c.value.filter},{"body-cell-promo":u(n=>[t(je,{align:"center"},{default:u(()=>[n.row.pivot.promo_units>0?(y(),S(ze,{key:0,color:"red",label:"OFERTA "})):A("",!0)]),_:2},1024)]),_:1},8,["rows","columns","pagination","filter"])])]),t(z,{modelValue:g.value.state,"onUpdate:modelValue":l[4]||(l[4]=n=>g.value.state=n),persistent:"",position:"bottom"},{default:u(()=>[t(vt,{product:g.value.val,_price_list:m.value.val?m.value.val._price_list:1,edit:g.value.edit,onReset:W,products:s.value.products,rules:X(o).rules,onAddProduct:Ve,promotion:X(o).promotion,onDeleteProduct:Ce,onEditProduct:Ae},null,8,["product","_price_list","edit","products","rules","promotion"])]),_:1},8,["modelValue"]),t(z,{modelValue:m.value.state,"onUpdate:modelValue":l[6]||(l[6]=n=>m.value.state=n)},{default:u(()=>[t(O,{style:{width:"700px"}},{default:u(()=>[t(ce,{onSubmit:xe},{default:u(()=>[l[16]||(l[16]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),l[17]||(l[17]=i("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),t(F,null,{default:u(()=>[t(L,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[t(T,{autofocus:"",modelValue:m.value.val,"onUpdate:modelValue":l[5]||(l[5]=n=>m.value.val=n),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),m.value.opts.length>0?(y(),S(F,{key:0},{default:u(()=>[t(K,{rows:m.value.opts,columns:P.value.columns,pagination:P.value.pagination,onRowClick:Pe},null,8,["rows","columns","pagination"])]),_:1})):A("",!0),t(G,{align:"right"},{default:u(()=>[re(t(x,{flat:"",label:"Cancelar",color:"primary"},null,512),[[pe]]),t(x,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:_.value.state,"onUpdate:modelValue":l[8]||(l[8]=n=>_.value.state=n)},{default:u(()=>[t(O,{style:{width:"700px"}},{default:u(()=>[t(ce,{onSubmit:we},{default:u(()=>[l[18]||(l[18]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),l[19]||(l[19]=i("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),t(F,null,{default:u(()=>[t(L,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[t(T,{autofocus:"",modelValue:_.value.val,"onUpdate:modelValue":l[7]||(l[7]=n=>_.value.val=n),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),_.value.opts.length>0?(y(),S(F,{key:0},{default:u(()=>[t(K,{rows:_.value.opts,columns:r.value.columns,pagination:r.value.pagination,onRowClick:ke},null,8,["rows","columns","pagination"])]),_:1})):A("",!0),t(G,{align:"right"},{default:u(()=>[re(t(x,{flat:"",label:"Cancelar",color:"primary"},null,512),[[pe]]),t(x,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",null,[t(z,{modelValue:d.value,"onUpdate:modelValue":l[9]||(l[9]=n=>d.value=n)},{default:u(()=>[t(Lt,{total:a.value.option?Number(p.value*Number.parseFloat(1+a.value.value/100)):Number(p.value),paymeths:X(o).methods,client:s.value.client.id,onSendTicket:Ne},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),t(Ke,{bordered:"",class:"bg-white"},{default:u(()=>[t(O,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:u(()=>[t(F,{class:"row"},{default:u(()=>[t(tt,{ref_key:"productRef",ref:C,class:"col",checkState:!1,onInput:ye,onAgregar:be},null,512),D.value?(y(),S(x,{key:0,color:"primary",flat:"",icon:"east",onClick:l[10]||(l[10]=n=>d.value=!d.value),round:""})):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Pl as default};
