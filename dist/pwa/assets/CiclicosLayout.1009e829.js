import{r as S,o as f,i as B,a0 as R,$ as K,e as o,a1 as w,g as p,j as x,W as ce,a as re,u as de,c as ue,w as s,f as z,Y as $,_ as j,a4 as U,h as te,Q as P,d as k,k as h,a2 as Z,aV as be,a3 as fe,q as ye,J as Ce,O as ke,X as we,ae as xe}from"./index.05780af2.js";import{Q as Ve}from"./QHeader.57f5a5e9.js";import{Q as le}from"./QDate.cedbc1ba.js";import{Q as M,d as ne}from"./QSelect.3cfe8482.js";import{Q as he}from"./QToolbar.23f3164d.js";import{Q as Qe}from"./QSpace.e92ea612.js";import{Q as W}from"./QTooltip.3beaec01.js";import{Q as Se}from"./QBar.55d76a5a.js";import{Q as Ue,a as $e}from"./QLayout.5752a4cb.js";import{u as me}from"./use-quasar.8c58ebcf.js";import{d as pe}from"./dayjs.min.cbcf888d.js";import{_ as De}from"./UserToolbar.76586e1b.js";import{C as I}from"./cicsdb.e10b683d.js";import{Q as X,a as se}from"./QTable.75c520e2.js";import{Q as Pe}from"./QExpansionItem.88d53ce4.js";import{Q as ie}from"./QTr.aac61035.js";import{Q as ae}from"./QTd.11568bef.js";import{Q as Ee}from"./QFooter.b9fc435c.js";import{C as ze}from"./ClosePopup.6ace4e34.js";import{P as Be}from"./ProductsAutocomplete.cdd81cce.js";import{c as ge}from"./cyclecountStore.9d5a0b4f.js";import"./axios.dbc32149.js";import{E as _e}from"./exceljs.min.9e24d01d.js";import"./QList.f18c3160.js";import"./QPage.fa21fb6b.js";import"./OrderStore.2ed0fd8f.js";import"./QDrawer.2ceec1d5.js";import{$sktCounters as y}from"./socket.168d2ba4.js";import{r as Ie}from"./reports.6b27dbca.js";import"./QResizeObserver.34af1731.js";import"./use-render-cache.3aae9b27.js";import"./date.d378a12b.js";import"./QScrollObserver.7bc9a7bb.js";import"./_commonjsHelpers.88e99c8f.js";import"./auth.531316f6.js";import"./QLinearProgress.6a044d08.js";/* empty css                                                                         */const Me={class:"text-right"},Ne={__name:"Locations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(c,{emit:C}){const m=c,b=C,r=i=>m.sections.filter(g=>g.root===i),u=S([{options:m.sections.filter(i=>i.root===0),selected:null}]),V=(i,g)=>{const v=i[i.length-1];u.value.splice(g+1);const Q=r(v);Q.length&&u.value.push({options:Q,selected:[]})},D=()=>{const i=u.value.filter(v=>v.selected.length>0),g=i[i.length-1];b("obtProducts",g)};return(i,g)=>(f(),B("div",null,[(f(!0),B(R,null,K(u.value,(v,Q)=>(f(),B("div",{key:Q},[o(M,{class:"col",modelValue:v.selected,"onUpdate:modelValue":[_=>v.selected=_,_=>V(_,Q)],options:v.options,label:`Nivel ${Q+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",multiple:"","use-chips":""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(w,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),p("div",Me,[o(x,{flat:"",icon:"send",disable:!u.value[0].selected,onClick:D},null,8,["disable"])])]))}},Oe={class:"col"},je={class:"text-bold"},Ae={class:"text-bold"},Fe={class:"row"},Le={class:"col"},qe={class:"col"},Te={key:0,class:"row"},Ye={__name:"Create",props:{config:{default:{},type:Object}},emits:["create"],setup(c,{emit:C}){const m=me();ce(),re();const b=de(),r=ge(),u=S(null),V=S(null),D=C,i=c,g=S({team:!1,selectSection:!1}),v=S({columns:[{name:"name",label:"Nombre",field:n=>{var e;return(e=n.staff)==null?void 0:e.complete_name},align:"left"}],filter:null}),Q=S({columns:[{name:"code",label:"Codigo",field:n=>n.code,align:"left"},{name:"description",label:"Descripcion",field:n=>n.description,align:"left"},{name:"locationExh",label:"Exhibicion",field:n=>{var e,t;return(t=(e=n.locations)==null?void 0:e.filter(d=>d.celler._type==2))==null?void 0:t.map(d=>d.path).join("/")},align:"left"},{name:"locationGen",label:"General",field:n=>{var e,t;return(t=(e=n.locations)==null?void 0:e.filter(d=>d.celler._type==1))==null?void 0:t.map(d=>d.path).join("/")},align:"left"}],filter:null}),_=ue(()=>i.config.type.val&&i.config.option.val&&i.config.notes&&i.config.resexh.length>0&&i.config.resgen.length>0&&i.config.products.length>0),A=(n,e)=>{const t=e.toUpperCase();return n.filter(d=>{var H,N;const ee=Object.values(d).some(E=>String(E!=null?E:"").toUpperCase().includes(t)),oe=(N=(H=d.staff)==null?void 0:H.complete_name.toUpperCase().includes(t))!=null?N:!1;return ee||oe})},G=n=>{n.id==1||n.id==2?g.value.selectSection=!0:n.id==4&&(console.log("abrir el de la exportacion"),V.value.click())},F=n=>{console.log(n),i.config.products.findIndex(t=>t.id==n.id)>=0?m.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):i.config.products.push(n)},L=n=>{console.log(n),i.config.products.findIndex(t=>t.id==n.id)>=0?m.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):i.config.products.push(n)},q=async()=>{if(i.config.option.val.id==2){m.loading.show({message:"Obteniendo Datos"});let n={workpoint:b.session.store.id_viz,seccion:i.config.section.map(t=>t.id)};console.log(n);const e=await I.obtProductSLocation(n);e.fail?console.log(e):(console.log(e),i.config.products=e,m.loading.hide())}},T=async n=>{m.loading.show({message:"Obteniendo Productos"});let e={ubicacion:n.selected,workpoint:b.session.store.id_viz,seccion:i.config.section.map(d=>d.id)};console.log(e);const t=await I.obtProductSections(e);t.fail?console.log(t):(console.log(t),i.config.products=t,m.loading.hide())},Y=n=>{console.log(n);let e=i.config.products.findIndex(t=>t.id==n.id);e>=0&&i.config.products.splice(e,1)},a=()=>{_.value?D("create"):(i.config.type.val||m.notify({message:"Falta un tipo",type:"warning",position:"left"}),i.config.option.val||m.notify({message:"Falta una opci\xF3n",type:"warning",position:"left"}),i.config.notes||m.notify({message:"Faltan notas",type:"warning",position:"left"}),i.config.resexh.length===0&&m.notify({message:"Falta Responsable exhibici\xF3n",type:"warning",position:"left"}),i.config.resgen.length===0&&m.notify({message:"Falta Responsable general",type:"warning",position:"left"}),i.config.products.length===0&&m.notify({message:"Debe agregar productos",type:"warning",position:"left"}))},l=()=>{var d;let n=(d=document.getElementById("refCreate"))==null?void 0:d.files[0],e=new _e.Workbook,t={};m.loading.show({message:"Importando Datos"}),e.xlsx.load(n).then(async ee=>{e.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(J,ve){if(ve===1)return;let O=J.value;!O||(t[O]||(t[O]=[]),t[O].includes(location)||t[O].push(location||cantidad))});let N=Object.keys(t).map(J=>({_product:J,_workpoint:b.session.store.id_viz}));console.log(N);const E=await I.addMassiveProductCyclecount(N);E.fail?console.log(E):(console.log(E),i.config.products=E,m.loading.hide())})};return(n,e)=>(f(),B(R,null,[o(P,null,{default:s(()=>[o(z,{class:"row items-center"},{default:s(()=>[p("div",Oe,[e[10]||(e[10]=$(" Creacion: ")),p("span",je,j(U(pe)().format("YYYY-MM-DD")),1),e[11]||(e[11]=$()),e[12]||(e[12]=p("br",null,null,-1)),e[13]||(e[13]=$(" Creador: ")),p("span",Ae,j(U(b).session.credentials.staff.complete_name),1)]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(te,{modelValue:c.config.notes,"onUpdate:modelValue":e[0]||(e[0]=t=>c.config.notes=t),type:"text",label:"Notas"},null,8,["modelValue"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(M,{class:"",modelValue:c.config.type.val,"onUpdate:modelValue":e[1]||(e[1]=t=>c.config.type.val=t),options:c.config.type.opts,label:"Tipo",disable:""},null,8,["modelValue","options"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(M,{class:"col",modelValue:c.config.option.val,"onUpdate:modelValue":[e[2]||(e[2]=t=>c.config.option.val=t),G],options:c.config.option.opts,label:"Seleccion",disable:!!c.config.option.val},null,8,["modelValue","options","disable"])]),_:1})]),_:1}),o(P,{bordered:""},{default:s(()=>[o(z,null,{default:s(()=>[o(Pe,{"expand-separator":"",icon:"fas fa-users",label:"Responsables","header-class":"text-grey-5",modelValue:g.value.team,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value.team=t),caption:`Exh: ${c.config.resexh.length} -- Gen ${c.config.resgen.length}`},{default:s(()=>[o(z,null,{default:s(()=>[o(te,{modelValue:v.value.filter,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value.filter=t),type:"text",label:"Buscar"},null,8,["modelValue"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),p("div",Fe,[p("div",Le,[o(X,{selection:"multiple",selected:c.config.resexh,"onUpdate:selected":e[4]||(e[4]=t=>c.config.resexh=t),title:"Ventas",rows:U(r).users.filter(t=>[8,9].includes(t._rol)),columns:v.value.columns,filter:v.value.filter,"filter-method":A},null,8,["selected","rows","columns","filter"])]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),p("div",qe,[o(X,{selection:"multiple",selected:c.config.resgen,"onUpdate:selected":e[5]||(e[5]=t=>c.config.resgen=t),title:"Almacen",rows:U(r).users.filter(t=>[4,24].includes(t._rol)),columns:v.value.columns,filter:v.value.filter,"filter-method":A},null,8,["selected","rows","columns","filter"])])])]),_:1})]),_:1},8,["modelValue","caption"])]),_:1})]),_:1}),o(w,{spaced:"",inset:"",vertical:"",dark:""}),c.config.option.val?(f(),k(P,{key:0,class:"my-card q-ml-md q-mr-md",bordered:""},{default:s(()=>[c.config.option.val.id==1?(f(),B("div",Te,[o(M,{class:"col",modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value=t),options:U(r).locations,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),u.value?(f(),k(Ne,{key:0,class:"col",sections:u.value.sections,onObtProducts:T},null,8,["sections"])):h("",!0)])):h("",!0)]),_:1})):h("",!0),o(w),c.config.products.length?(f(),k(P,{key:1,class:"my-card",bordered:""},{default:s(()=>[o(z,null,{default:s(()=>[o(X,{rows:c.config.products,columns:Q.value.columns},{header:s(t=>[o(ie,{props:t},{default:s(()=>[(f(!0),B(R,null,K(t.cols,d=>(f(),k(se,{key:d.name,props:t},{default:s(()=>[$(j(d.label),1)]),_:2},1032,["props"]))),128)),c.config.option.val.id==3?(f(),k(se,{key:0,"auto-width":""})):h("",!0)]),_:2},1032,["props"])]),body:s(t=>[o(ie,{props:t},{default:s(()=>[(f(!0),B(R,null,K(t.cols,d=>(f(),k(ae,{key:d.name,props:t},{default:s(()=>[$(j(d.value),1)]),_:2},1032,["props"]))),128)),c.config.option.val.id==3?(f(),k(ae,{key:0,"auto-width":""},{default:s(()=>[o(x,{size:"sm",color:"negative",round:"",dense:"",onClick:d=>Y(t.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)):h("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})):h("",!0),c.config.option.val?(f(),k(Ee,{key:2},{default:s(()=>[c.config.option.val.id==3?(f(),k(P,{key:0,class:"row"},{default:s(()=>[o(Be,{class:"col",checkState:!0,onInput:L,onAgregar:F,with_locations_loc:U(b).session.credentials._rol},null,8,["with_locations_loc"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(x,{color:"primary",icon:"send",onClick:a})]),_:1})):h("",!0),c.config.option.val.id!=3?(f(),k(P,{key:1},{default:s(()=>[o(x,{class:"full-width",color:"primary",label:"Crear Ciclico :p",onClick:a})]),_:1})):h("",!0)]),_:1})):h("",!0),o(fe,{modelValue:g.value.selectSection,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value.selectSection=t),persistent:""},{default:s(()=>[o(P,{style:{"min-width":"350px"}},{default:s(()=>[o(z,null,{default:s(()=>e[14]||(e[14]=[p("div",{class:"text-h6"},"Selecciona una Seccion",-1)])),_:1}),o(z,{class:"q-pt-none"},{default:s(()=>[o(M,{modelValue:c.config.section,"onUpdate:modelValue":e[8]||(e[8]=t=>c.config.section=t),options:U(r).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"])]),_:1}),o(Z,{align:"right",class:"text-primary"},{default:s(()=>[be(o(x,{flat:"",onClick:q,icon:"send"},null,512),[[ze]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),p("input",{type:"file",ref_key:"refCreate",ref:V,id:"refCreate",onInput:l,hidden:"",accept:".xlsx,.xls"},null,544)],64))}},Re={class:"text-h6"},Ge={key:0,class:"row items-center"},zo={__name:"CiclicosLayout",setup(c){S("");const C=me();ce();const m=re(),b=de(),r=ge(),u=S({state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"},{id:4,label:"Importacion"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}),V=S(!0),D=S({from:null,to:null}),i=S({sections:[],date:{from:null,to:null}}),g=async()=>{C.loading.show({message:"Cargado vista..."});let a=pe(new Date).format("YYYY/MM/DD");D.value={from:a,to:a};let l={store:b.session.store.id_viz,suc:b.session.store.id,date:D.value};const n=await I.index(l);n.fail?console.log(n):(console.log(n),r.setCyclecount(n.inventories),r.setUsers(n.colab),r.setSections(n.secciones),r.setLocations(n.locations),C.loading.hide())},v=ue(()=>{const a=i.value.date;return a?typeof a=="string"?a.length>0:a.from&&a.to:!1}),Q=()=>{u.value={state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"},{id:4,label:"Importacion"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}},_=async()=>{console.log(u.value),C.loading.show({message:"Creando Ciclicos"}),u.value._account=b.session.credentials.staff.id_va,u.value._workpoint=b.session.store.id_viz;const a=await I.addCyclecount(u.value);a.fail?console.log(a):(console.log(a),a.success&&(a.data.forEach(l=>r.addCyclecount(l.counter)),C.loading.hide(),Q()))},A=async()=>{C.loading.show({message:"Obteniendo Datos..."});let a={store:b.session.store.id_viz,suc:b.session.store.id,date:D.value};const l=await I.index(a);l.fail?console.log(l):(console.log(l),r.setCyclecount(l.inventories),r.setUsers(l.colab),r.setSections(l.secciones),r.setLocations(l.locations),C.loading.hide())},G=async()=>{C.loading.show({message:"Obteniendo Datos..."});let a={store:b.session.store.id_viz,params:i.value};console.log(a);const l=await I.productCyclecount(a);if(l.fail)console.log(l);else{console.log(l);let n="";const e=i.value.date;typeof e=="string"?n=`PSC_${e.replaceAll("/","_")}`:n=`PSC_${e.from.replaceAll("/","_")}_a_${e.to.replaceAll("/","-")}`;let t={key:n,value:l};Ie.conStockSinContar(t),C.loading.hide()}},F=a=>{console.log(a),C.notify({message:`El usuario ${a.me.names} Se Unio :)`,type:"positive",position:"top"})},L=a=>{console.log(a),r.lock(a.product.id,a)},q=a=>{console.log(a),r.unlock(a.product.id)},T=a=>{console.log(a),r.updateLockedProduct(a.product)},Y=a=>{r.updateCyclecounts(a.counter),C.notify({message:`Termino el conteo ${a.user.me.names}`}),m.push("/ciclicos/counted")};return ye(()=>{g(),y.on("connect",()=>{r.socket_user&&y.emit("index",r.socket_user.profile)}),y.connect(),Ce(()=>r.socket_user.profile,a=>{a&&y.connected&&y.emit("index",a)},{immediate:!0}),y.on("joined",F),y.on("counting",L),y.on("cancelcounting",q),y.on("countingconfirmed",T),y.on("endingCounting",Y)}),ke(()=>{y.off("joined",F),y.off("counting",L),y.off("cancelcounting",q),y.off("countingconfirmed",T),y.off("endingCounting",Y)}),g(),(a,l)=>{const n=we("router-view");return f(),k(Ue,{view:"hHh Lpr fFf"},{default:s(()=>[o(Ve,{class:"bg-grey-3 text-dark",bordered:""},{default:s(()=>[o(De),o(w)]),_:1}),o($e,null,{default:s(()=>[o(he,{class:"justify-between"},{default:s(()=>[p("div",null,[l[7]||(l[7]=p("span",{class:"text-grey"},"Helpers",-1)),l[8]||(l[8]=$()),o(xe,{name:"navigate_next",color:"primary"}),l[9]||(l[9]=$()),p("span",Re,j(U(r).title),1)]),U(r).showBtns?(f(),B("div",Ge,[o(x,{color:"primary",icon:"event",flat:""},{default:s(()=>[o(ne,null,{default:s(()=>[o(P,{class:"my-card"},{default:s(()=>[o(z,null,{default:s(()=>[p("div",null,[l[10]||(l[10]=p("div",{class:"q-pb-sm text-center"},null,-1)),o(le,{modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=e=>D.value=e),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(Z,{vertical:"",align:"center"},{default:s(()=>[o(x,{flat:"",label:"Obtener",color:"positive",onClick:A})]),_:1})]),_:1})]),_:1})]),_:1}),o(x,{color:"primary",icon:"add_shopping_cart",dense:"",flat:""},{default:s(()=>[o(ne,null,{default:s(()=>[l[12]||(l[12]=p("div",{class:"q-pa-md"},"Productos Sin Conteo",-1)),o(w),o(z,null,{default:s(()=>[o(M,{modelValue:i.value.sections,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.sections=e),options:U(r).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":"",dense:""},null,8,["modelValue","options"]),p("div",null,[l[11]||(l[11]=p("div",{class:"q-pb-sm text-center"},null,-1)),o(le,{modelValue:i.value.date,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.date=e),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(Z,{vertical:"",align:"center"},{default:s(()=>[o(x,{flat:"",label:"Obtener",color:"positive",onClick:G,disable:!i.value.sections.length||!v.value},null,8,["disable"])]),_:1})]),_:1})]),_:1}),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(x,{color:"primary",icon:"add",outline:"",onClick:l[3]||(l[3]=e=>u.value.state=!u.value.state)})])):h("",!0)]),_:1}),o(fe,{modelValue:u.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.state=e),persistent:"",maximized:V.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:s(()=>[o(P,null,{default:s(()=>[o(Se,null,{default:s(()=>[l[16]||(l[16]=p("div",{class:"text-center text-h6"},"Nuevo Inventario",-1)),o(Qe),o(x,{dense:"",flat:"",icon:"minimize",onClick:l[4]||(l[4]=e=>V.value=!1),disable:!V.value},{default:s(()=>[V.value?(f(),k(W,{key:0},{default:s(()=>l[13]||(l[13]=[$("Minimize")])),_:1})):h("",!0)]),_:1},8,["disable"]),o(x,{dense:"",flat:"",icon:"crop_square",onClick:l[5]||(l[5]=e=>V.value=!0),disable:V.value},{default:s(()=>[V.value?h("",!0):(f(),k(W,{key:0},{default:s(()=>l[14]||(l[14]=[$("Maximize")])),_:1}))]),_:1},8,["disable"]),o(x,{dense:"",flat:"",icon:"close",onClick:Q},{default:s(()=>[o(W,null,{default:s(()=>l[15]||(l[15]=[$("Close")])),_:1})]),_:1})]),_:1}),o(Ye,{config:u.value,onCreate:_},null,8,["config"])]),_:1})]),_:1},8,["modelValue","maximized"]),o(n)]),_:1})]),_:1})}}};export{zo as default};
