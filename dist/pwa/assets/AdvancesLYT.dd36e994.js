import{b as d,Q as O}from"./QList.fbe92372.js";import{Q as Y}from"./QHeader.5328a33a.js";import{aH as q,a as _,u as F,r as p,c as S,o as j,d as G,w as i,e as a,f,S as W,Q as T,a0 as z,a4 as K}from"./index.de8d81c3.js";import{Q as b,d as X}from"./QSelect.40eb47ae.js";import{Q as Z}from"./QToolbar.3c981c3a.js";import{Q as C}from"./QInput.61d32a9d.js";import{Q as h}from"./QDate.51b55c5d.js";import{Q as ll}from"./QTable.25e4aa49.js";import{Q as el,a as al}from"./QLayout.5bda3682.js";import{Q as N}from"./QCardSection.bdc282f9.js";import{Q as tl}from"./QForm.8798c660.js";import{Q as D}from"./QCard.685d9ac6.js";import{Q as L}from"./QCardActions.2df30c51.js";import{C as ol}from"./ClosePopup.f5853d13.js";import"./auto.32a398b9.js";import{u as sl}from"./use-quasar.608984ce.js";import"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.2941991f.js";import{_ as il}from"./UserToolbar.3a313100.js";import{A as nl}from"./assistApi.53f88aa7.js";import{b as I,a as ul}from"./axios.29bdad68.js";import"./use-key-composition.a00e15d3.js";import"./QResizeObserver.ed45798b.js";import"./use-render-cache.3aae9b27.js";import"./date.46c9318b.js";import"./QLinearProgress.5a8c3ba1.js";import"./QCheckbox.5ec2a4bb.js";import"./use-checkbox.11634e09.js";import"./QScrollObserver.f4fa5630.js";import"./_commonjsHelpers.88e99c8f.js";import"./QExpansionItem.a37d0abd.js";import"./QDrawer.d0ae7c5f.js";import"./auth.ca73d5a9.js";const dl={class:"col"},rl={class:"col"},vl={class:"row"},pl={class:"q-ml-sm"},Wl={__name:"AdvancesLYT",setup(ml){const r=sl();q(),_(),F(),F();const u=p([]),A=p(null),m=p([]),o=p({val:null,state:!1}),v=p({val:null,opts:[]}),s=p({state:!1,val:null,body:null}),n=p({state:!1,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}),g=p([]),E=p(g.value),V=p({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODANT,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJANT,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"OBSERVACION",field:t=>t.OBSANT,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPANT).toFixed(2),align:"center",sortable:!0},{name:"client",label:"CLEINTE",field:t=>t.NOFCLI,align:"left",sortable:!0}]}),R=S(()=>A.value&&!v.value.val?m.value.filter(t=>t.FECHA==A.value):!A.value&&v.value.val?m.value.filter(t=>t.CAJANT==v.value.val.CODTER):A.value&&v.value.val?m.value.filter(t=>t.FECHA==A.value&&t.CAJANT==v.value.val.CODTER):m.value),k=S(()=>{if(o.value){const t=m.value.find(e=>e.CODRET===o.value.val.CODRET);if(!t)return!1;let l={CAJANT:t.CAJANT,CODANT:t.CODANT,OBSANT:t.OBSANT,DESTER:t.DESTER,FECHA:t.FECHA,IMPANT:Number(t.IMPANT).toFixed(2),CLIENTE:{CLIANT:t.CLIANT,NOFCLI:t.NOFCLI}};return JSON.stringify(l)===JSON.stringify(o.value.val)}else return!0}),B=S(()=>!n.value.OBSANT||!n.value.DESTER||!n.value.IMPANT||!n.value.CLIENTE),U=async()=>{r.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const t=await nl.index();t.error||(console.log(t),u.value.opts=t,r.loading.hide())},M=(t,l)=>{o.value.state=!o.value.state,console.log(l);let e={CAJANT:l.CAJANT,CODANT:l.CODANT,OBSANT:l.OBSANT,DESTER:l.DESTER,FECHA:l.FECHA,IMPANT:Number(l.IMPANT).toFixed(2),CLIENTE:{CLIANT:l.CLIANT,NOFCLI:l.NOFCLI}};o.value.val={...e}},P=async()=>{console.log(u.value.val.id);let t=u.value.val.id;console.log(t);try{let l=await ul.get(`/cashier/getPrinters/${t}`);l.status==200&&(s.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),r.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},H=async()=>{console.log(u.value.val.ip_address),r.loading.show({message:"Obteniendo Registros"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/getAdvances`;const e=await I.get(l);e.status!=200?console.log(e):(console.log(e.data),m.value=e.data.anticipos,v.value.opts=e.data.terminal,g.value=e.data.clientes,P(),r.loading.hide())},x=async()=>{console.log(u.value.val.ip_address);let t={print:s.value.val.ip_address,codant:o.value.val.CODANT};console.log(t),r.loading.show({message:"Imprimiendo Anticipo"});let e=`http://${u.value.val.ip_address}/storetools/public/api/reports/printAdvance`;const c=await I.post(e,t);c.status!=200?console.log(c):(console.log(c.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide())},J=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),r.loading.show({message:"Modificando Anticipo"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/modifyAdvances`;const e=await I.post(l,o.value.val);if(e.status!=200)console.log(e);else{console.log(e.data);let c=m.value.findIndex(y=>y.CODANT==e.data.CODANT);c>=0&&(m.value[c]=e.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide()}},Q=(t,l,e)=>{if(t===""){l(()=>{E.value=g.value});return}l(()=>{const c=t.toLowerCase();E.value=g.value.filter(y=>y.NOFCLI.toLowerCase().includes(c))})},$=async()=>{n.value.Print=s.value.val.ip_address,console.log(n.value),r.loading.show({message:"Agregando Anticipo"});let l=`http://${u.value.val.ip_address}/storetools/public/api/reports/addAdvances`;const e=await I.post(l,n.value);e.status!=200?console.log(e):(console.log(e.data),m.value.push(e.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide(),w())},w=()=>{n.value={state:!1,CAJANT:null,CODANT:null,OBSANT:null,DESTER:null,IMPANT:null,CLIENTE:null}};return U(),(t,l)=>(j(),G(el,{view:"hHh Lpr fFf"},{default:i(()=>[a(Y,{class:"bg-grey-3 text-dark",bordered:""},{default:i(()=>[a(il),a(d)]),_:1}),a(al,{class:"q-ml-md"},{default:i(()=>[a(Z,{class:"justify-between row"},{default:i(()=>[f("div",dl,[l[20]||(l[20]=f("span",{class:"text-grey"},"Helpers",-1)),a(W,{name:"navigate_next",color:"primary"}),l[21]||(l[21]=f("span",{class:"text-h6"},"Anticipos Sucursal",-1))]),f("div",rl,[f("div",vl,[l[22]||(l[22]=f("div",{class:"col"},null,-1)),a(b,{class:"col",modelValue:u.value.val,"onUpdate:modelValue":[l[0]||(l[0]=e=>u.value.val=e),H],options:u.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1}),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(ll,{rows:R.value,filter:V.value.filter,columns:V.value.columns,onRowClick:M},{"top-right":i(()=>[a(C,{modelValue:V.value.filter,"onUpdate:modelValue":l[1]||(l[1]=e=>V.value.filter=e),type:"text",label:"Buscar",filled:"",dense:"",disable:!u.value.val},null,8,["modelValue","disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:v.value.val,"onUpdate:modelValue":l[2]||(l[2]=e=>v.value.val=e),options:v.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!u.value.val},null,8,["modelValue","options","disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"event",flat:"",round:"",disable:!u.value.val},{default:i(()=>[a(X,null,{default:i(()=>[a(h,{modelValue:A.value,"onUpdate:modelValue":l[3]||(l[3]=e=>A.value=e),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{color:"primary",icon:"add",flat:"",onClick:l[4]||(l[4]=e=>n.value.state=!n.value.state),disable:!u.value.val},null,8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),a(O,{modelValue:s.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.state=e)},{default:i(()=>[a(D,{class:"my-card"},{default:i(()=>[a(N,null,{default:i(()=>l[23]||(l[23]=[f("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),a(N,null,{default:i(()=>[a(tl,{onSubmit:x,class:"q-gutter-md"},{default:i(()=>[a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),f("div",null,[a(T,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:o.value.state,"onUpdate:modelValue":l[13]||(l[13]=e=>o.value.state=e),persistent:""},{default:i(()=>[a(D,{style:{width:"300px"}},{default:i(()=>[a(N,{class:"text-bold text-center text-h5"},{default:i(()=>[f("span",pl,"Retirada "+z(o.value.val.CODRET),1)]),_:1}),a(N,null,{default:i(()=>[a(C,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.val.FECHA=e),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":l[8]||(l[8]=e=>o.value.val.DESTER=e),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:o.value.val.CLIENTE,"onUpdate:modelValue":l[9]||(l[9]=e=>o.value.val.CLIENTE=e),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:Q},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.OBSANT,"onUpdate:modelValue":l[10]||(l[10]=e=>o.value.val.OBSANT=e),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:o.value.val.IMPANT,"onUpdate:modelValue":l[11]||(l[11]=e=>o.value.val.IMPANT=e),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[12]||(l[12]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(L,{align:"center"},{default:i(()=>[K(a(T,{flat:"",color:"negative",icon:"close"},null,512),[[ol]]),a(T,{flat:"",color:"primary",icon:"print",onClick:x,disable:!k.value||!s.value.val},null,8,["disable"]),a(T,{flat:"",color:"yellow",icon:"edit",disable:k.value||!s.value.val,onClick:J},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:n.value.state,"onUpdate:modelValue":l[19]||(l[19]=e=>n.value.state=e),persistent:""},{default:i(()=>[a(D,{style:{width:"300px"}},{default:i(()=>[a(N,{class:"text-bold text-center text-h5"}),a(N,null,{default:i(()=>[a(b,{modelValue:n.value.DESTER,"onUpdate:modelValue":l[14]||(l[14]=e=>n.value.DESTER=e),options:v.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:n.value.CLIENTE,"onUpdate:modelValue":l[15]||(l[15]=e=>n.value.CLIENTE=e),options:E.value,label:"Cliente",filled:"","option-label":"NOFCLI","use-input":"","input-debounce":"0",onFilter:Q,dense:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:n.value.OBSANT,"onUpdate:modelValue":l[16]||(l[16]=e=>n.value.OBSANT=e),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(C,{modelValue:n.value.IMPANT,"onUpdate:modelValue":l[17]||(l[17]=e=>n.value.IMPANT=e),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(d,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[18]||(l[18]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(L,{align:"center"},{default:i(()=>[a(T,{flat:"",color:"negative",icon:"close",onClick:w}),a(T,{flat:"",color:"positive",icon:"send",disable:B.value||!s.value.val,onClick:$},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Wl as default};
