import{Q as n}from"./QSeparator.4964f7e2.js";import{aE as J,u as _,r as p,c as Q,o as $,a as B,w as s,e as t,f as v,Y as h,Q as E,a5 as Y,a3 as W}from"./index.87019776.js";import{Q as b,d as q}from"./QSelect.78c69149.js";import{Q as L}from"./QToolbar.f416eeca.js";import{Q as j}from"./QHeader.5aa46407.js";import{Q as R}from"./QInput.4d81dd80.js";import{Q as G}from"./QDate.2066c7e9.js";import{Q as z}from"./QTable.8e8f0feb.js";import{Q as K,a as X}from"./QLayout.ad809700.js";import{u as Z,Q as w,a as O}from"./use-quasar.5a9cc122.js";import{Q as ee}from"./QForm.1e1380a7.js";import{Q as A}from"./QDialog.345202cb.js";import{Q as le}from"./QCardActions.ae3ddef4.js";import{C as ae}from"./ClosePopup.a4f27a19.js";import"./AppFullscreen.70f032cd.js";import"./auto.ba62c17c.js";import"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.0b5f0630.js";import{_ as te}from"./UserToolbar.f6a7851a.js";import{A as oe}from"./assistApi.2e43d6ae.js";import{u as P}from"./VDB.a6d8446f.js";import{a as C}from"./axios.9ab26c22.js";import{a as se}from"./axios.ba7b1b0e.js";import"./use-key-composition.74cd455a.js";import"./uid.937d8ee7.js";import"./position-engine.16d19877.js";import"./rtl.276c3f1b.js";import"./QResizeObserver.69c7b548.js";import"./use-render-cache.3aae9b27.js";import"./date.9f434740.js";import"./QList.fbbc1213.js";import"./QLinearProgress.9bc39902.js";import"./QCheckbox.54a48910.js";import"./_commonjsHelpers.88e99c8f.js";const ie={class:"col"},re={class:"col"},ne={class:"row"},ue={class:"q-ml-sm"},qe={__name:"withdrawals",setup(de){const u=Z();J();const x=_(),T=P(),N=P(),r=p([]),f=p(null),m=p([]),o=p({val:null,state:!1}),d=p({val:null,opts:[]}),i=p({state:!1,val:null,body:null}),V=p([]),g=p({filter:"",columns:[{name:"date",label:"FECHA",field:l=>l.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:l=>l.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:l=>l.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:l=>l.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:l=>l.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:l=>l.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:l=>Number(l.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:l=>l.NOFPRO,align:"left",sortable:!0}]}),F=Q(()=>f.value&&!d.value.val?m.value.filter(l=>l.FECHA==f.value):!f.value&&d.value.val?m.value.filter(l=>l.CAJRET==d.value.val.CODTER):f.value&&d.value.val?m.value.filter(l=>l.FECHA==f.value&&l.CAJRET==d.value.val.CODTER):m.value),y=Q(()=>{if(o.value){const l=m.value.find(a=>a.CODRET===o.value.val.CODRET);if(!l)return!1;let e={CAJRET:l.CAJRET,CODRET:l.CODRET,CONRET:l.CONRET,DESTER:l.DESTER,FECHA:l.FECHA,HORA:l.HORA,IMPRET:Number(l.IMPRET).toFixed(2),PROVEEDOR:{PRORET:l.PRORET,NOFPRO:l.NOFPRO}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),I=async()=>{u.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const l=await oe.index();l.error||(console.log(l),r.value.opts=l,u.loading.hide(),H())},k=(l,e)=>{o.value.state=!o.value.state,console.log(e);let a={CAJRET:e.CAJRET,CODRET:e.CODRET,CONRET:e.CONRET,DESTER:e.DESTER,FECHA:e.FECHA,HORA:e.HORA,IMPRET:Number(e.IMPRET).toFixed(2),PROVEEDOR:{PRORET:e.PRORET,NOFPRO:e.NOFPRO}};o.value.val={...a}},H=async()=>{let l=N.session.store.id;console.log(l);try{let e=await se.get(`/cashier/getPrinters/${l}`);e.status==200&&(i.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),u.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},S=async()=>{console.log(r.value.val.ip_address),u.loading.show({message:"Obteniendo Registros"});let e=`http://${r.value.val.ip_address}/storetools/public/api/reports/getWithdrawals`;const a=await C.get(e);a.status!=200?console.log(a):(console.log(a.data),m.value=a.data.cuts,d.value.opts=a.data.terminal,V.value=a.data.proveedores,u.loading.hide())},D=async()=>{console.log(r.value.val.ip_address);let l={print:i.value.val.ip_address,codret:o.value.val.CODRET};console.log(l),u.loading.show({message:"Imprimiendo Retirada"});let a=`http://${r.value.val.ip_address}/storetools/public/api/reports/printWitrawal`;const c=await C.post(a,l);c.status!=200?console.log(c):(console.log(c.data),i.value.val=null,o.value.val=null,o.value.state=!1,u.loading.hide())},M=async()=>{o.value.val.Print=i.value.val.ip_address,console.log(o.value.val),u.loading.show({message:"Modificando Retirada"});let e=`http://${r.value.val.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const a=await C.post(e,o.value.val);if(a.status!=200)console.log(a);else{console.log(a.data);let c=m.value.findIndex(U=>U.CODRET==a.data.CODRET);c>=0&&(m.value[c]=a.data),i.value.val=null,o.value.val=null,o.value.state=!1,u.loading.hide()}};return T.session.rol==="adm"||T.session.rol==="root"?I():(u.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),x.replace("/")),(l,e)=>($(),B(K,{view:"hHh Lpr fFf"},{default:s(()=>[t(j,{class:"bg-grey-3 text-dark",bordered:""},{default:s(()=>[t(te),t(n),t(L,{class:"justify-between row"},{default:s(()=>[v("div",ie,[e[14]||(e[14]=v("span",{class:"text-grey"},"Helpers",-1)),t(h,{name:"navigate_next",color:"primary"}),e[15]||(e[15]=v("span",{class:"text-h6"},"Retiradas de Cajas",-1))]),v("div",re,[v("div",ne,[e[16]||(e[16]=v("div",{class:"col"},null,-1)),t(b,{class:"col",modelValue:r.value.val,"onUpdate:modelValue":[e[0]||(e[0]=a=>r.value.val=a),S],options:r.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),t(X,null,{default:s(()=>[t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(z,{rows:F.value,filter:g.value.filter,columns:g.value.columns,onRowClick:k},{"top-right":s(()=>[t(R,{modelValue:g.value.filter,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value.filter=a),type:"text",label:"Buscar",filled:"",dense:"",disable:!r.value.val},null,8,["modelValue","disable"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(b,{modelValue:d.value.val,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value.val=a),options:d.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!r.value.val},null,8,["modelValue","options","disable"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(E,{color:"primary",icon:"event",flat:"",round:"",disable:!r.value.val},{default:s(()=>[t(q,null,{default:s(()=>[t(G,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),t(A,{modelValue:i.value.state,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.state=a)},{default:s(()=>[t(w,{class:"my-card"},{default:s(()=>[t(O,null,{default:s(()=>e[17]||(e[17]=[v("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),t(O,null,{default:s(()=>[t(ee,{onSubmit:D,class:"q-gutter-md"},{default:s(()=>[t(b,{dense:"","option-label":"name",modelValue:i.value.val,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.val=a),options:i.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),v("div",null,[t(E,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:i.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(A,{modelValue:o.value.state,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.state=a),persistent:""},{default:s(()=>[t(w,{style:{width:"300px"}},{default:s(()=>[t(O,{class:"text-bold text-center text-h5"},{default:s(()=>[v("span",ue,"Retirada "+Y(o.value.val.CODRET),1)]),_:1}),t(O,null,{default:s(()=>[t(R,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.val.FECHA=a),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.HORA,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.val.HORA=a),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.val.DESTER=a),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(b,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.val.PROVEEDOR=a),options:V.value,label:"Proveedor",filled:"","option-label":"NOFPRO"},null,8,["modelValue","options"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.val.CONRET=a),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.val.IMPRET=a),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(b,{dense:"","option-label":"name",modelValue:i.value.val,"onUpdate:modelValue":e[12]||(e[12]=a=>i.value.val=a),options:i.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),t(n,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),t(le,{align:"center"},{default:s(()=>[W(t(E,{flat:"",color:"negative",icon:"close"},null,512),[[ae]]),t(E,{flat:"",color:"primary",icon:"print",onClick:D,disable:!y.value||!i.value.val},null,8,["disable"]),t(E,{flat:"",color:"yellow",icon:"edit",disable:y.value||!i.value.val,onClick:M},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{qe as default};
