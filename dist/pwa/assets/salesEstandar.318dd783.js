import{Q as Ne}from"./QToolbarTitle.9fa707a5.js";import{Q as z,a as oe,d as ce}from"./QSelect.68d4e41a.js";import{Q as Te}from"./QToggle.071973c3.js";import{d as M,e as G,b as E,a as pe,Q as W}from"./QList.b6ed84aa.js";import{a as F,Q as R,p as Qe}from"./axios.429dcbea.js";import{b3 as Ee,u as X,r as V,c as T,m as ne,o as g,g as L,d as S,w as s,e as t,Q as w,b4 as ue,ak as J,b5 as Le,f as o,a0 as x,h as A,E as Ie,an as se,a as ye,aH as xe,a3 as Be,a2 as Ue,a4 as ie,b7 as qe,t as _e,aF as Re,aG as Oe,n as je,a1 as ve,A as Y}from"./index.28fee0d9.js";import{Q as O}from"./QInput.6c984f77.js";import{Q as ze}from"./QToolbar.73b3aff6.js";import{Q as ae}from"./QTable.6c9324b6.js";import{Q as H}from"./QCardActions.e040b047.js";import{Q as me}from"./QForm.e802a08c.js";import{Q as Ke}from"./QFooter.337115ae.js";import{Q as Me}from"./QPage.5b51641a.js";import{C as fe}from"./ClosePopup.87662236.js";import{u as Je,c as be}from"./cashApi.daf9806d.js";import"./QDrawer.e45a8ff2.js";import{u as Z}from"./use-quasar.71af1004.js";import{p as ge}from"./productsApi.9158e6c4.js";import{Q as We}from"./QSpace.d291e49c.js";import{R as j}from"./resoursesOrder.81c13278.js";import{Q as Ye}from"./QCheckbox.18e01e9d.js";import{o as Ge}from"./orderApi.ec421be9.js";import{s as He}from"./saleLocalApi.64a5423a.js";import"./QLinearProgress.e2ee882c.js";import"./QResizeObserver.8235918a.js";import"./QScrollObserver.aab80b50.js";const Xe={class:"QuickRegular row items-center"},Ze={class:"row items-center justify-between no-wrap QuickRegular"},et={class:"col"},tt={class:"text-grey-4 q-pl-md"},lt={class:"text--2 text-grey-5"},at={class:"text--3"},ot={key:0,class:"text--3 text-amber-13"},st={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]}},emits:["input","similarcodes","agregar"],setup(y,{expose:B,emit:m}){const i=Z(),C=X(),_=y,$=m,e=V({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),v=V(null),h=T(()=>({autocomplete:e.value.target,limit:_.limit,_workpoint:C.session.store.id_viz,strict:e.read_barcode})),f=T(()=>n=>_.checkState?_.blockStates.some(c=>c==n.state.id):!1);ne(()=>{e.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let n=JSON.parse(localStorage.getItem("typeiptsearch"));n&&(e.value.iptsearch.type=n.type,e.value.iptsearch.icon=n.icon)});const d=()=>{e.value.read_barcode=!e.value.read_barcode,e.value.target="",localStorage.setItem("barcodereader",e.value.read_barcode)},D=(n,c,p)=>{console.log(h.value),n.trim().length>1&&(e.value.target=n.toUpperCase().trim(),console.log(e.value.target),ge.autocomplete(h.value).then(I=>{console.log(I);let ee=I.data.map(N=>{if(_.checkState)if(_.wkpToVal){let K=N.stocks.find(te=>te._workpoint==_.wkpToVal);N.stateToVal=K?{own:K,state:K.status}:{own:null,state:N.status}}else N.stateToVal={own:!0,state:N.status};else N.stateToVal={own:!0,state:N.status};return N});c(()=>{e.value.options=ee},N=>{N.setOptionIndex(-1),N.moveOptionSelection(1,!0)})}).catch(I=>{console.log(I)}))},Q=()=>{switch(e.value.iptsearch.type){case"text":e.value.iptsearch.type="number",e.value.iptsearch.icon="fas fa-font";break;case"number":e.value.iptsearch.type="text",e.value.iptsearch.icon="fas fa-hashtag";break}localStorage.setItem("typeiptsearch",JSON.stringify(e.value.iptsearch))},P=n=>{e.value.target="",$("input",n)},k=()=>{e.value.target.trim().toUpperCase(),e.value.target.length&&(e.value.iptsearch.processing=!0,ge.autocomplete(h.value).then(n=>{let c=n.data;switch(c.length){case 0:let p=e.value.target;i.notify({message:`Sin resultados para <b>${p}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),b();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(c[0]),P(c[0]);break}e.value.target="",e.value.iptsearch.processing=!1}).catch(n=>{console.log(n)}))},b=()=>{console.log("putFocus ejecutada!!"),v.value.focus()};B({focus:()=>{var n,c;return(c=(n=v.value)==null?void 0:n.focus)==null?void 0:c.call(n)}});const r=n=>{$("agregar",n)};return(n,c)=>(g(),L("div",Xe,[e.value.read_barcode?(g(),S(O,{key:0,ref_key:"iptatc",ref:v,loading:e.value.iptsearch.processing,disable:e.value.iptsearch.processing,modelValue:e.value.target,"onUpdate:modelValue":c[1]||(c[1]=p=>e.value.target=p),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:ue(k,["enter"]),autocomplete:"off",autofocus:""},{prepend:s(()=>[t(w,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:c[0]||(c[0]=p=>d())},null,8,["color","icon"])]),_:1},8,["loading","disable","modelValue"])):(g(),S(z,{key:1,dense:"",filled:"",color:"blue-13",class:"text-uppercase col",ref_key:"iptatc",ref:v,"use-input":"","hide-dropdown-icon":"","option-value":"id","option-label":"id","hide-selected":"",behavior:"menu",modelValue:e.value.target,"onUpdate:modelValue":c[3]||(c[3]=p=>e.value.target=p),"input-debounce":400,autofocus:"",options:e.value.options,type:e.value.iptsearch.type,onFilter:D,"popup-content-class":"bg-darkl1"},{"no-option":s(()=>[t(M,null,{default:s(()=>[t(G,{class:"text-grey QuickRegular"},{default:s(()=>c[4]||(c[4]=[J("Nada por aqui...")])),_:1})]),_:1})]),prepend:s(()=>[t(w,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:c[2]||(c[2]=p=>d())},null,8,["color","icon"]),t(w,{type:"button",dense:"",size:"sm",flat:"",onClick:Q,icon:e.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:s(p=>[t(M,Le(p.itemProps,{onClick:I=>r(p.opt),disable:f.value(p.opt.stateToVal)}),{default:s(()=>[t(G,null,{default:s(()=>[o("div",Ze,[o("div",et,[o("div",null,[J(x(p.opt.code)+" ",1),o("span",tt,x(p.opt.name),1)]),o("div",lt,x(p.opt.description),1),o("div",at,x(p.opt.stateToVal.state.name),1),p.opt.stateToVal.own?A("",!0):(g(),L("div",ot,"Producto en conflicto con status "))]),t(Ie,{name:"fas fa-circle",class:se(["q-pl-md",`bullet-${p.opt.stateToVal.state.id}`]),size:"10px"},null,8,["class"])])]),_:2},1024)]),_:2},1040,["onClick","disable"])]),_:1},8,["modelValue","options","type"]))]))}};var it=Ee(st,[["__scopeId","data-v-06295034"]]);const nt={class:"row"},ut={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},dt={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},rt={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},ct={class:"row"},pt={class:"text-h6 col text-bold text-left"},vt={class:"text-h6 col text-bold text-right"},mt={class:"text-subtitle2 col"},ft={class:"text-center"},bt={class:"q-pa-xs"},gt={class:"row items-center justify-center q-gutter-md"},yt={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(y,{emit:B}){X();const m=Z();ye(),xe();const i=y,C=B,_=T(()=>!i.product.pivot.amountDelivered||i.product.pivot.amountDelivered<=0),$=T(()=>i.product.pivot._supply_by==3?i.product.pivot.amountDelivered*i.product.pieces:i.product.pivot._supply_by==2?i.product.pivot.amountDelivered*12:i.product.pivot.amountDelivered),e=T(()=>i._price_list<=3?[1,2,3,4]:[i._price_list]),v=T(()=>i._price_list<=3?$.value>=i.product.pieces&&(i.product.pivot._supply_by==1||i.product.pivot._supply_by==2)||i.product.pivot._supply_by==3?4:j.verificarPrecioDocena(i.products,i.product,i.rules)?3:j.verificarPrecioMayoreo(i.products,i.product,i.rules)?2:1:i._price_list),h=()=>{C("reset")},f=async()=>{m.loading.show({message:"Editando Producto"});let Q=i.product.prices.find(k=>k.id==v.value).pivot.price,P=$.value*Q;i.product.pivot.toDelivered=$.value,i.product.pivot._price_list=v.value,i.product.pivot.price=Q,i.product.pivot.total=P,m.loading.hide(),h(),j.actualizarPreciosProductosSales(i.products,i._price_list,i.rules),C("editProduct")},d=async()=>{m.loading.show({message:"Agregando producto"});let Q=i.product.prices.find(k=>k.id==v.value).pivot.price,P=$.value*Q;i.product.pivot.toDelivered=$.value,i.product.pivot._price_list=v.value,i.product.pivot.price=Q,i.product.pivot.total=P,i.product.pivot._product=i.product.id,console.log(i.product),C("addProduct",i.product),m.loading.hide(),j.actualizarPreciosProductosSales(i.products,i._price_list,i.rules)},D=async()=>{m.loading.show({message:"Eliminando Producto"}),C("deleteProduct",i.product),m.loading.hide(),j.actualizarPreciosProductosSales(i.products,i._price_list,i.rules)};return(Q,P)=>(g(),S(R,null,{default:s(()=>[t(F,{class:"item-center"},{default:s(()=>[o("div",nt,[o("div",ut,x(y.product.category.familia.seccion.name),1),o("div",dt,x(y.product.category.familia.name),1),o("div",rt,x(y.product.category.name),1)])]),_:1}),t(F,{class:"item-center"},{default:s(()=>[o("div",ct,[o("div",pt,x(y.product.code),1),o("div",vt,x(y.product.name),1)]),o("div",mt,x(y.product.description),1)]),_:1}),t(F,{class:"item-center row"},{default:s(()=>[(g(!0),L(Be,null,Ue(y.product.prices.filter(k=>e.value.includes(k.id)),(k,b)=>(g(),L("div",{class:"col text-subtitle2 text-center",key:b},[o("div",{class:se(k.id==v.value?"text-weight-bold":"text-caption text-strike")},x(k.alias),3),t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",{class:se(k.id==v.value?"text-bold  text-blue-13":"text-caption")},x(k.pivot.price),3),t(E,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),t(F,null,{default:s(()=>[o("div",ft,[o("div",bt,[P[4]||(P[4]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),o("div",gt,[t(w,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:P[0]||(P[0]=k=>y.product.pivot.amountDelivered>1?y.product.pivot.amountDelivered--:"")}),ie(o("input",{type:"number",min:"1","onUpdate:modelValue":P[1]||(P[1]=k=>y.product.pivot.amountDelivered=k),class:"text-center exo",style:{width:"100px","font-size":"3em",border:"none"},autofocus:"",onKeydown:P[2]||(P[2]=ue(k=>y.edit?f():d(),["enter"]))},null,544),[[qe,y.product.pivot.amountDelivered]]),t(w,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:P[3]||(P[3]=k=>y.product.pivot.amountDelivered++)})])])])]),_:1}),t(H,null,{default:s(()=>[t(w,{flat:"",icon:"close",onClick:h}),t(We),y.edit?A("",!0):(g(),S(w,{key:0,flat:"",icon:"add",color:"positive",onClick:d,disable:_.value},null,8,["disable"])),y.edit?(g(),S(w,{key:1,flat:"",icon:"delete",color:"negative",onClick:D})):A("",!0),y.edit?(g(),S(w,{key:2,flat:"",icon:"edit",color:"warning",onClick:f,disable:_.value},null,8,["disable"])):A("",!0)]),_:1})]),_:1}))}},xt={class:"bg-primary row items-center justify-between q-pa-md text-white"},_t={class:"text-right"},ht={class:"fw-bold text-h4"},kt={class:"row text-center items-center"},wt={class:"col"},Pt={class:"row text-center items-center"},Vt={class:"col"},Ct={class:"col"},At={class:"row flex justify-center"},$t={class:"col flex justify-center"},Ft={key:0,class:"col"},St={key:0,class:"row flex justify-center text-center"},Dt={class:"col"},Nt={class:"col"},Tt={class:"row flex justify-center"},Qt={class:"col flex justify-center"},Et={key:0,class:"col"},Lt={class:"row"},It={class:"text-h5"},Bt={key:0,class:"text-center"},Ut={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(y,{emit:B}){X();const m=Z(),i=V({dafpa:!1,vales:!1}),C=y,_=B,$=V({opts:[]}),e=V({PFPA:{id:C.paymeths[1],val:Math.round(C.total)},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),v=T(()=>(Number(Number.parseFloat(e.value.SFPA.val)+Number.parseFloat(e.value.PFPA.val))+Number.parseFloat(e.value.VALE.val)-Number.parseFloat(C.total)).toFixed(2)),h=T(()=>{var b,r,n;return v.value>=0&&(((b=e.value.PFPA.id)==null?void 0:b.id)&&e.value.PFPA.val>0||((r=e.value.SFPA.id)==null?void 0:r.id)&&e.value.SFPA.val>0||((n=e.value.VALE.id)==null?void 0:n.id)&&e.value.VALE.val>0)}),f=T(()=>{const b=Object.values(e.value);if(b.some(p=>p.id&&p.id.alias==="EFE"&&p.val>0))return!1;const n=b.some(p=>p.id&&p.id.alias!=="EFE"),c=b.reduce((p,I)=>p+Number(I.val||0),0);return n&&c>C.total}),d=b=>{var r;return b.id==((r=e.value.SFPA.id)==null?void 0:r.id)},D=b=>{var r;return b.id==((r=e.value.PFPA.id)==null?void 0:r.id)},Q=async()=>{m.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let r=`http://192.168.10.160:1619/access/public/modify/vales?price=${C.client}`;Qe.get(r).then(n=>{console.log(n.data),m.loading.hide();let c=n.data.map(p=>({id:{id:5,alias:"[V]",name:"VALE",code:p.CODANT},val:Number(p.IMPANT)}));$.value.opts=c,i.value.vales=!0}).catch(n=>{console.log(n.response.data),m.notify({html:!0,message:n.response.data,color:"negative",position:"bottom"}),m.loading.hide()})},P=b=>{b.key==="Enter"&&h.value&&(b.preventDefault(),k())},k=()=>{e.value.conditions.super=f.value,e.value.change=v.value,_("sendTicket",e.value),$.value=V({opts:[]}),e.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return ne(()=>{window.addEventListener("keydown",P)}),_e(()=>{window.removeEventListener("keydown",P)}),(b,r)=>(g(),S(R,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:s(()=>[o("div",xt,[r[11]||(r[11]=o("div",null,[o("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),o("div",_t,[r[10]||(r[10]=o("div",{class:"fs-dec3"},"Total Actual",-1)),o("div",ht,"$ "+x(Number(y.total).toFixed(2)),1)])]),t(F,null,{default:s(()=>{var n;return[o("div",kt,[r[12]||(r[12]=o("div",{class:"col"}," Forma de pago: ",-1)),o("div",wt,[t(z,{class:"col-3",modelValue:e.value.PFPA.id,"onUpdate:modelValue":r[0]||(r[0]=c=>e.value.PFPA.id=c),options:y.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":c=>d(c)},null,8,["modelValue","options","option-disable"])])]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Pt,[o("div",Vt,x(((n=e.value.PFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",Ct,[t(O,{class:"col",modelValue:e.value.PFPA.val,"onUpdate:modelValue":r[2]||(r[2]=c=>e.value.PFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:s(()=>[parseFloat(e.value.PFPA.val)?(g(),S(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:r[1]||(r[1]=c=>e.value.PFPA.val=0)})):A("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),t(F,null,{default:s(()=>{var n;return[o("div",At,[o("div",$t,[t(w,{color:"primary",label:"2\xAA Forma de pago",onClick:r[3]||(r[3]=()=>{i.value.dafpa=!i.value.dafpa,e.value.SFPA.val=0,e.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),i.value.dafpa?(g(),L("div",Ft,[t(z,{class:"col-3",modelValue:e.value.SFPA.id,"onUpdate:modelValue":r[4]||(r[4]=c=>e.value.SFPA.id=c),options:y.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":c=>D(c)},null,8,["modelValue","options","option-disable"])])):A("",!0)]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),i.value.dafpa?(g(),L("div",St,[o("div",Dt,x(((n=e.value.SFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",Nt,[t(O,{class:"col",modelValue:e.value.SFPA.val,"onUpdate:modelValue":r[6]||(r[6]=c=>e.value.SFPA.val=c),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:s(()=>[parseFloat(e.value.SFPA.val)?(g(),S(w,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:r[5]||(r[5]=c=>e.value.SFPA.val=0)})):A("",!0)]),_:1},8,["modelValue"])])])):A("",!0)]}),_:1}),t(F,null,{default:s(()=>[o("div",Tt,[o("div",Qt,[t(w,{color:"primary",label:"Cobrar Vale",onClick:Q,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),i.value.vales?(g(),L("div",Et,[o("div",Lt,[t(z,{class:"col",modelValue:e.value.VALE,"onUpdate:modelValue":r[7]||(r[7]=n=>e.value.VALE=n),options:$.value.opts,label:"Vale","option-label":n=>`Vale : ${n.id?n.id.code:""}`,dense:"",filled:""},{option:s(n=>[t(M,Re(Oe(n.itemProps)),{default:s(()=>[t(G,null,{default:s(()=>[t(oe,null,{default:s(()=>[J(x(n.opt.id.code),1)]),_:2},1024),t(oe,{caption:""},{default:s(()=>[J("$ "+x(Number(n.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),e.value.VALE.id?(g(),S(O,{key:0,modelValue:e.value.VALE.val,"onUpdate:modelValue":r[8]||(r[8]=n=>e.value.VALE.val=n),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):A("",!0)])])):A("",!0)])]),_:1}),f.value?(g(),S(F,{key:0,class:"flex justify-end"},{default:s(()=>[t(Ye,{modelValue:e.value.conditions.createWithdrawal,"onUpdate:modelValue":r[9]||(r[9]=n=>e.value.conditions.createWithdrawal=n),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):A("",!0),t(H,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:s(()=>[o("div",null,[r[13]||(r[13]=o("div",{class:"fs-dec3"},"Cambio",-1)),o("div",It," $ "+x(v.value),1)]),h.value?(g(),L("div",Bt,[t(w,{color:"primary",icon:"payment",label:"Pagar",onClick:k})])):A("",!0)]),_:1})]),_:1}))}},qt={class:"row items-center justify-between"},Rt={class:"col"},Ot={class:"col"},jt={class:"col"},zt={class:"text-caption text-center"},Kt={class:"text-center text-h6"},Mt={key:0,class:"col"},Jt={class:"text-center text-h6 text-caption"},Wt={key:1,class:"col"},Yt={class:"text-center text-h6"},Gt={class:"col"},Ht={class:"text-center text-h6"},Pl={__name:"salesEstandar",setup(y){const B=X(),m=Z();ye(),xe();const i=Je();V(null);const C=V(null),_=V({val:{id:1,label:"Preventa",type:"number"},opts:[{id:1,label:"Preventa",type:"number"},{id:2,label:"Particion",type:"number"},{id:3,label:"Presupuesto",type:"text"},{id:4,label:"Ticket",type:"number"}],valueVal:null}),$=V({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),e=V({name:"IVA",option:!1,optval:[16,8,6],value:0,amount:0}),v=V({val:null,opts:[]}),h=V({val:null,opts:[]}),f=V({state:!1,val:null,edit:!1}),d=V({client:null,dependiente:null,products:[]}),D=V(!1),Q=V({columns:[{name:"code",label:"Codigo",field:a=>a.code,align:"left"},{name:"description",label:"Descripcion",field:a=>a.description,align:"left"},{name:"verify",label:"Cantidad",field:a=>a.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:a=>a.pivot.price,align:"center"},{name:"bruto",label:e.option?"Bruto":"Total",field:a=>a.pivot.total,align:"center"},{name:"iva",label:"Total",field:a=>a.pivot.total,align:"center"},{name:"neto",label:"Total",field:a=>a.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),P=V({columns:[{name:"id",label:"Codigo",field:a=>a.id,align:"left"},{name:"Nombre",label:"Descripcion",field:a=>a.name,align:"left"},{name:"Telefono",label:"Pedido",field:a=>a.celphone,align:"center"}],pagination:{rowsPerPage:0}}),k=V({columns:[{name:"id",label:"Codigo",field:a=>a.id,align:"left"},{name:"Nombre",label:"Descripcion",field:a=>a.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),b=T(()=>Number(d.value.products.reduce((a,l)=>a+l.pivot.total,0)).toFixed(2)),r=T(()=>d.value.products.reduce((a,l)=>a+Number(l.pivot.toDelivered),0)),n=T(()=>d.value.products.length>0&&d.value.dependiente&&d.value.client),c=T(()=>[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},,{name:"verify",label:"Verificado",field:l=>l.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:l=>l.pivot.price,align:"center"},{name:"bruto",label:e.value.option?"Subtotal":"Total",field:l=>l.pivot.total,format:l=>`$ ${l.toFixed(2)}`,align:"center"}]),p=a=>{console.log(a);let l=d.value.products.findIndex(u=>u.id==a.id);l>=0?(f.value.val=d.value.products[l],f.value.state=!0,f.value.edit=!0):(a.pivot=$.value,f.value.val=a,f.value.state=!0,f.value.edit=!1)},I=a=>{console.log(a);let l=d.value.products.findIndex(u=>u.id==a.id);l>=0?(f.value.val=d.value.products[l],f.value.state=!0,f.value.edit=!0):(a.pivot=$.value,f.value.val=a,f.value.state=!0,f.value.edit=!1)},ee=(a,l)=>{console.log(l),f.value.val=l,f.value.edit=!0,f.value.state=!0},N=()=>{console.log("cambio de cliente"),v.value.state=!0},K=async()=>{if(v.value.val){const a=await Ge.getClient(v.value);a.fail?console.log(a):a.length>0?(console.log(a),v.value.opts=a):m.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(a)}else m.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},te=async(a,l)=>{m.loading.show({message:"Recalculando Ticket"}),d.value.client=l,j.actualizarPreciosProductosSales(d.value.products,l._price_list,i.rules),v.value={state:!1,val:null,opts:[]},m.loading.hide()},he=()=>{console.log("cambio de cliente"),h.value.state=!0},ke=async()=>{if(h.value.val){let a={val:h.value.val,sto:B.session.store.id};const l=await be.getDependiente(a);l.fail?console.log(l):l.length>0?(console.log(l),h.value.opts=l):m.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(l)}else m.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},we=(a,l)=>{d.value.dependiente=l,h.value={state:!1,val:null,opts:[]},m.loading.hide()},Pe=a=>{d.value.products.push(a),le(),Y(()=>{var l;(l=C.value)==null||l.focus()})},Ve=()=>{Y(()=>{var a;(a=C.value)==null||a.focus()})},Ce=a=>{let l=d.value.products.findIndex(u=>u.id==a.id);l>=0&&(d.value.products.splice(l,1),le()),Y(()=>{var u;(u=C.value)==null||u.focus()})},Ae=async a=>{m.loading.show({message:"Realizando Ticket"}),d.value.payments=a,d.value.change=a.conditions.super?0:a.change,e.value.option?(d.value.subtotal=d.value.products.reduce((U,q)=>U+q.pivot.total,0),d.value.iva=e.value.value,d.value.total=Number(b.value*Number(1+e.value.value/100).toFixed(2)),d.value.impuesto=Number(b.value*Number(e.value.value/100)).toFixed(2)):d.value.total=d.value.products.reduce((U,q)=>U+q.pivot.total,0);let l={order:d.value,cashier:i.cash,config:e.value};console.log(l);const u=await He.addSale(l);console.log(u),u.fail?console.log(u):(console.log(u),D.value=!1,d.value={client:null,dependiente:null,products:[]},e.value.value=0,e.value.option=!1,localStorage.removeItem("current_sale"),m.loading.hide())},le=()=>{f.value={state:!1,val:null,edit:!1},$.value={amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},Y(()=>{var a;(a=C.value)==null||a.focus()})},$e=async()=>{switch(console.log(_.value),_.value.val.id){case 1:Fe(_.value);break}},Fe=async a=>{if(console.log(a),a){m.loading.show({message:"Obteniendo Orden"});let l={uid:B.session.credentials.staff.id_va,oid:a.valueVal};const u=await be.getOrderCash(l);u.fail?u.fail.status==401?(console.log(u),m.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),a.value=null,m.loading.hide()):u.fail.status==404?(console.log(u),m.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),a.value=null,m.loading.hide()):console.log(u):(d.value.order=a.valueVal,d.value.dependiente=u.staff,d.value.client=u.client,u.products.forEach(U=>{var re;console.log(U);const q=d.value.products.find(De=>De.id===U.id),Se=((re=U.pivot)==null?void 0:re.units)||0;q?(q.pivot||(q.pivot={units:0}),q.pivot.units+=Se):d.value.products.push({...U})}),_.value.valueVal=null,console.log(u),m.loading.hide())}},de=a=>{a.ctrlKey&&a.key.toLowerCase()==="b"?(a.preventDefault(),v.value.state||(v.value.state=!0)):a.ctrlKey&&a.key.toLowerCase()==="d"?(a.preventDefault(),h.value.state||(h.value.state=!0)):a.altKey&&a.key==="Enter"&&n.value&&(a.preventDefault(),D.value||(D.value=!0))};return je(()=>d.value,a=>{localStorage.setItem("current_sale",JSON.stringify(a))},{deep:!0}),ne(()=>{const a=localStorage.getItem("current_sale");a&&(d.value=JSON.parse(a)),window.addEventListener("keydown",de)}),_e(()=>{window.removeEventListener("keydown",de)}),(a,l)=>(g(),S(Me,null,{default:s(()=>[t(ze,{class:""},{default:s(()=>[t(Ne),t(w,{flat:"",round:"",dense:"",icon:"settings",class:"q-mr-xs"},{default:s(()=>[t(ce,{style:{width:"200px"}},{default:s(()=>[t(R,{class:"my-card"},{default:s(()=>[t(F,null,{default:s(()=>[t(pe,{dense:""},{default:s(()=>[t(M,{class:"q-px-sm q-py-xs column"},{default:s(()=>[o("div",qt,[t(oe,null,{default:s(()=>[J(x(e.value.name),1)]),_:1}),t(Te,{color:"blue",modelValue:e.value.option,"onUpdate:modelValue":[l[0]||(l[0]=u=>e.value.option=u),l[1]||(l[1]=u=>{u?e.value.value=16:e.value.value=0})]},null,8,["modelValue"])]),e.value.option?(g(),S(z,{key:0,modelValue:e.value.value,"onUpdate:modelValue":l[2]||(l[2]=u=>e.value.value=u),options:e.value.optval,label:"Porcentaje",filled:"",dense:"","emit-value":"","map-options":"",class:"q-mt-sm"},null,8,["modelValue","options"])):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{flat:"",round:"",dense:"",icon:"receipt_long"},{default:s(()=>[t(ce,null,{default:s(()=>[t(pe,{style:{"min-width":"100px"}},{default:s(()=>[t(M,null,{default:s(()=>[t(G,null,{default:s(()=>[t(z,{modelValue:_.value.val,"onUpdate:modelValue":l[3]||(l[3]=u=>_.value.val=u),options:_.value.opts,label:"Tipo",filled:"",dense:""},null,8,["modelValue","options"]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),t(O,{modelValue:_.value.valueVal,"onUpdate:modelValue":l[4]||(l[4]=u=>_.value.valueVal=u),type:_.value.val.type,dense:"",filled:"",label:_.value.val.label,onKeyup:ue($e,["enter"])},null,8,["modelValue","type","label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(R,{class:"my-card"},{default:s(()=>[t(F,{class:"row"},{default:s(()=>[o("div",Rt,[l[12]||(l[12]=o("div",{class:"text-caption text-center"},"Dependiente",-1)),t(w,{class:"full-width",flat:"",label:d.value.dependiente?d.value.dependiente.complete_name:"CTRL+d",onClick:he},null,8,["label"])]),t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Ot,[l[13]||(l[13]=o("div",{class:"text-caption text-center"},"Cliente",-1)),t(w,{class:"full-width",flat:"",label:d.value.client?d.value.client.name:"CTRL+b",onClick:N},null,8,["label"])])]),_:1})]),_:1}),t(E,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{class:"my-card"},{default:s(()=>[t(F,{class:"row"},{default:s(()=>[o("div",jt,[o("div",zt,x(e.value.option?"SUBTOTAL":"TOTAL"),1),o("div",Kt,"$ "+x(b.value),1)]),e.value.option?(g(),L("div",Mt,[l[14]||(l[14]=o("div",{class:"text-caption text-center"}," IVA ",-1)),o("div",Jt,"$ "+x(Number(b.value*Number(e.value.value/100)).toFixed(2)),1)])):A("",!0),e.value.option?(g(),L("div",Wt,[l[15]||(l[15]=o("div",{class:"text-caption text-center"}," TOTAL ",-1)),o("div",Yt,"$ "+x(Number(b.value*Number(1+e.value.value/100)).toFixed(2)),1)])):A("",!0),o("div",Gt,[l[16]||(l[16]=o("div",{class:"text-caption text-center"},"Cantidad",-1)),o("div",Ht,x(r.value),1)])]),_:1})]),_:1}),t(E,{spaced:"",inset:"",vertical:"",dark:""}),t(ae,{rows:d.value.products,columns:c.value,"hide-bottom":"",pagination:Q.value.pagination,onRowClick:ee},null,8,["rows","columns","pagination"]),t(W,{modelValue:f.value.state,"onUpdate:modelValue":l[5]||(l[5]=u=>f.value.state=u),persistent:"",position:"bottom"},{default:s(()=>[t(yt,{product:f.value.val,_price_list:v.value.val?v.value.val._price_list:1,edit:f.value.edit,onReset:le,products:d.value.products,rules:ve(i).rules,onAddProduct:Pe,onDeleteProduct:Ce,onEditProduct:Ve},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),t(W,{modelValue:v.value.state,"onUpdate:modelValue":l[7]||(l[7]=u=>v.value.state=u)},{default:s(()=>[t(R,{style:{width:"700px"}},{default:s(()=>[t(me,{onSubmit:K},{default:s(()=>[l[17]||(l[17]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),l[18]||(l[18]=o("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),t(F,null,{default:s(()=>[t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[t(O,{autofocus:"",modelValue:v.value.val,"onUpdate:modelValue":l[6]||(l[6]=u=>v.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),v.value.opts.length>0?(g(),S(F,{key:0},{default:s(()=>[t(ae,{rows:v.value.opts,columns:P.value.columns,pagination:P.value.pagination,onRowClick:te},null,8,["rows","columns","pagination"])]),_:1})):A("",!0),t(H,{align:"right"},{default:s(()=>[ie(t(w,{flat:"",label:"Cancelar",color:"primary"},null,512),[[fe]]),t(w,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(W,{modelValue:h.value.state,"onUpdate:modelValue":l[9]||(l[9]=u=>h.value.state=u)},{default:s(()=>[t(R,{style:{width:"700px"}},{default:s(()=>[t(me,{onSubmit:ke},{default:s(()=>[l[19]||(l[19]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),l[20]||(l[20]=o("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),t(F,null,{default:s(()=>[t(E,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[t(O,{autofocus:"",modelValue:h.value.val,"onUpdate:modelValue":l[8]||(l[8]=u=>h.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),h.value.opts.length>0?(g(),S(F,{key:0},{default:s(()=>[t(ae,{rows:h.value.opts,columns:k.value.columns,pagination:k.value.pagination,onRowClick:we},null,8,["rows","columns","pagination"])]),_:1})):A("",!0),t(H,{align:"right"},{default:s(()=>[ie(t(w,{flat:"",label:"Cancelar",color:"primary"},null,512),[[fe]]),t(w,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",null,[t(W,{modelValue:D.value,"onUpdate:modelValue":l[10]||(l[10]=u=>D.value=u)},{default:s(()=>[t(Ut,{total:e.value.option?Number(b.value*Number.parseFloat(1+e.value.value/100)):Number(b.value),paymeths:ve(i).methods,client:d.value.client.id,onSendTicket:Ae},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),t(Ke,{bordered:"",class:"bg-white"},{default:s(()=>[t(R,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[t(F,{class:"row"},{default:s(()=>[t(it,{ref_key:"productRef",ref:C,class:"col",checkState:!1,onInput:I,onAgregar:p},null,512),n.value?(g(),S(w,{key:0,color:"primary",flat:"",icon:"east",onClick:l[11]||(l[11]=u=>D.value=!D.value),round:""})):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Pl as default};
