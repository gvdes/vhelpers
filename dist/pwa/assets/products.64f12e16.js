import{Q as _e}from"./QRadio.3dc8e50b.js";import{Q as de}from"./QCheckbox.2d866e24.js";import{Q as ye}from"./QToggle.3603bbd5.js";import{i as ke,aL as xe,c as D,j as Y,t as we,r as x,o as m,g as h,a3 as J,a2 as K,e as t,f as i,Q as _,u as he,l as Ve,p as Ce,m as Qe,d as A,w as a,h as I,ak as B,S as Pe,a0 as b,al as Se,a4 as se}from"./index.7d932cec.js";import{i as Fe,j as qe}from"./use-key-composition.bad2484f.js";import{b as L,a as X,d as Z,e as M,Q as ee}from"./QList.15d88b4b.js";import{Q as F}from"./QCardSection.2da9fba7.js";import{Q as oe,a as z,q as Ne}from"./QSelect.33ba93ff.js";import{Q as H}from"./QCard.c43496fd.js";import{Q as De}from"./QInput.28f4ef28.js";import{Q as te}from"./QCardActions.445dad37.js";import{Q as Ie}from"./QBtnGroup.3ba9c29b.js";import{Q as Le}from"./QPageSticky.0dce0fee.js";import{Q as Oe}from"./QTable.9e3cb568.js";import{Q as Ae}from"./QPage.2cb9f7ca.js";import{C as ne}from"./ClosePopup.301c4581.js";import"./QDrawer.5edbfa29.js";import"./axios.a94c162f.js";import{u as Be}from"./use-quasar.bf32b052.js";import{P as Ee,d as Ue}from"./ProductsAutocomplete.06373ba0.js";import{_ as $e}from"./OptionsLabels.1e04d62e.js";import{l as ie}from"./locationsApi.b3a2ba64.js";import{E as Te}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.239143fa.js";import"./dayjs.min.cbcf888d.js";import"./QLinearProgress.25afea2b.js";import"./QResizeObserver.a1a82b13.js";import"./QScrollObserver.b4f5e060.js";/* empty css                                                                         */import"./QImg.fac1f23c.js";import"./labels.e735572a.js";import"./_commonjsHelpers.88e99c8f.js";const re={radio:_e,checkbox:de,toggle:ye},ze=Object.keys(re);function le(s,Q){if(typeof s=="function")return s;const u=s!==void 0?s:Q;return d=>d[u]}var Re=ke({name:"QOptionGroup",props:{...Fe,modelValue:{required:!0},options:{type:Array,validator:s=>s.every(xe),default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],name:String,type:{type:String,default:"radio",validator:s=>ze.includes(s)},color:String,keepColor:Boolean,dense:Boolean,size:String,leftLabel:Boolean,inline:Boolean,disable:Boolean},emits:["update:modelValue"],setup(s,{emit:Q,slots:u}){const{proxy:{$q:d}}=we(),P=Array.isArray(s.modelValue);s.type==="radio"?P===!0&&console.error("q-option-group: model should not be array"):P===!1&&console.error("q-option-group: model should be array in your case");const k=qe(s,d),q=D(()=>re[s.type]),V=D(()=>le(s.optionValue,"value")),f=D(()=>le(s.optionLabel,"label")),y=D(()=>le(s.optionDisable,"disable")),g=D(()=>s.options.map(n=>({val:V.value(n),name:n.name===void 0?s.name:n.name,disable:s.disable||y.value(n),leftLabel:n.leftLabel===void 0?s.leftLabel:n.leftLabel,color:n.color===void 0?s.color:n.color,checkedIcon:n.checkedIcon,uncheckedIcon:n.uncheckedIcon,dark:n.dark===void 0?k.value:n.dark,size:n.size===void 0?s.size:n.size,dense:s.dense,keepColor:n.keepColor===void 0?s.keepColor:n.keepColor}))),w=D(()=>"q-option-group q-gutter-x-sm"+(s.inline===!0?" q-option-group--inline":"")),S=D(()=>{const n={role:"group"};return s.type==="radio"&&(n.role="radiogroup",s.disable===!0&&(n["aria-disabled"]="true")),n});function c(n){Q("update:modelValue",n)}return()=>Y("div",{class:w.value,...S.value},s.options.map((n,E)=>{const R=u["label-"+E]!==void 0?()=>u["label-"+E](n):u.label!==void 0?()=>u.label(n):void 0;return Y("div",[Y(q.value,{label:R===void 0?f.value(n):null,modelValue:s.modelValue,"onUpdate:modelValue":c,...g.value[E]},R)])}))}});const je={class:"text-right"},Ge={__name:"selectsLocations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(s,{emit:Q}){const u=s,d=Q,P=f=>u.sections.filter(y=>y.root===f),k=x([{options:u.sections.filter(f=>f.root===0),selected:null}]),q=(f,y)=>{k.value.splice(y+1);const g=P(f);g.length&&k.value.push({options:g,selected:null})},V=()=>{const f=k.value.filter(g=>g.selected!==null),y=f[f.length-1];d("obtProducts",y)};return(f,y)=>(m(),h("div",null,[(m(!0),h(J,null,K(k.value,(g,w)=>(m(),h("div",{key:w},[t(oe,{modelValue:g.selected,"onUpdate:modelValue":[S=>g.selected=S,S=>q(S,w)],options:g.options,label:`Nivel ${w+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(L,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),i("div",je,[t(_,{flat:"",icon:"send",disable:!k.value[0].selected,onClick:V},null,8,["disable"])])]))}},Me={class:"text-center"},He={class:"row text-center"},Je={key:0,class:"col"},Ke={class:"row"},We={class:"row"},Ye={key:0,class:"col"},Xe={key:1,class:"col"},Ze={key:0,class:"row"},et={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},tt={class:"text-h5 text-bold text-center"},lt={class:"text-subtitle2 text-bold text-center"},ot={class:"text-subtitle2 text-bold text-center"},at={class:"text-subtitle2 text-bold text-center"},st={class:"text-subtitle2 text-bold text-center"},nt={class:"row"},it={class:"text-center"},dt={class:"text-center"},rt={class:"text-bold q-pb-sm text-center"},ut={class:"row q-pt-xs"},ct={class:"text-negative"},Mt={__name:"products",setup(s){const Q=he(),u=Be(),d=x([]),P=x([]),k=x(null),q=x(!1),V=x({val:{id:1,label:"Productos"},opts:[{id:1,label:"Productos"},{id:2,label:"Ubicacion"}]}),f=x({filter:"",pagination:{rowsPerPage:9}}),y=x({state:!1}),g=x({state:!1}),w=x({val:[0,1,2,4],opts:[{label:"Menudeo",value:1},{label:"Mayoreo",value:2},{label:"Docena",value:3},{label:"Caja",value:4}]}),S=x(null),c=x({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[]}),n=o=>{let l=[],e=[],r=new Object;return o.products.map(p=>E(p.prices)?l.push(p):e.push(p)),console.log(o),r.notFound=l,r.add=e,r},E=o=>{let l=!0;return o.map((e,r)=>{l=e.pivot.price==0}),l},R=o=>{console.log(o);let l=d.value.findIndex(e=>e.id==o.id);if(console.log(l),l>=0)d.value[l]._copies++;else{let e=j(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,d.value.push(o),console.log(o)}},ue=o=>{console.log(o);let l=d.value.findIndex(e=>e.id==o.id);if(console.log(l),l>=0)d.value[l]._copies++;else{let e=j(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,d.value.push(o),console.log(o)}},ce=o=>{let l=d.value.findIndex(e=>e.id==o.id);d.value.splice(l,1)},pe=()=>{d.value=[],y.value.state=!1},ve=()=>{S.value.click()},me=async()=>{let o=document.getElementById("inputFile").files[0],l=new Te.Workbook,e=[],r=[],p=0;l.xlsx.load(o).then(v=>{if(l.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(N,O){N.value&&e.push(N.value)}),r=e.filter((N,O,T)=>T.indexOf(N)==O),e.length){let N={codes:e,_workpoint:Q.session.store.id_viz};console.log(N),u.loading.show({message:"Procesando archivo, espera.."}),Ue.getMassive(N).then(O=>{let T=O.data,W=0,G=n(T);if(T.fails.notFound.map(C=>c.value.wndNotExist.push(C)),c.value.wndGetRows=G.add.length,c.value.state=!c.value.state,c.value.wndGetAdded=G.add,c.value.wndNoDataFound=G.notFound,c.value.wndNoDataFound.length>0){let C=c.value.wndNoDataFound.length;c.value.message=C<=1?"El producto no contiene precios.":"Los productos no contienen precios."}G.add.map(C=>{let ae=j(C.prices,C.pieces);C._copies=1,C.type=ae.type,C.usedPrices=ae.prices,d.value.push(C),W++}),W&&!T.fails.notFound.length&&r.length==e.length?u.notify({message:`Etiquetas generadas: ${W}`,color:"positive",icon:"done",timeout:1e3}):(p=e.length-r.length,c.value.messageRepeat=p<=1?`${p} producto se repitio. Favor de validar su documento antes de subirlo.`:`${p} productos se repitieron. Favor de validar su documento antes de subirlo.`),console.log(c.value),u.loading.hide()}).catch(O=>{console.log(O),u.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else u.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},j=(o,l)=>{let e=[...o];e.sort((v,U)=>v.pivot._type-U.pivot._type),console.log(e);const r=e.find(v=>v.pivot._type==4),p=e.find(v=>v.pivot._type==1);if(r.pivot.price==p.pivot.price){let v={id:0,alias:"OFERTA",name:"Oferta",pivot:{price:e[0].pivot.price},used:!0};return console.log("oferta"),{type:"off",prices:[v]}}else return console.log("estandar"),{type:"std",prices:e}},fe=o=>{switch(o){case"off":return"orange-9";case"std":return"green-9"}},ge=async()=>{if(V.value.val.id==2){u.loading.show({message:"Obteniendo Secciones"});const o=await ie.index(Q.session.store.id_viz);o.fail?console.log(o):(console.log(o),P.value=o),u.loading.hide()}},be=async o=>{u.loading.show({message:"Obteniendo Productos"});let l={section:o.selected,workpoint:Q.session.store.id_viz,update:q.value};const e=await ie.obtProductSections(l);if(e.fail)console.log(e);else{console.log(e);let r={products:e};r.products.length>0?(n(r).add.map(v=>{let U=d.value.findIndex($=>$.id==v.id);if(U>=0)d.value[U]._copies++;else{let $=j(v.prices,v.pieces);v._copies=1,v.type=$.type,v.usedPrices=$.prices,d.value.push(v)}}),u.loading.hide()):(u.loading.hide(),u.notify({message:"No Hay Articulos Ubicados x(",type:"negative",position:"center",icon:"mood_bad"}))}};return Ve(()=>d.value,o=>{localStorage.setItem("applabels",JSON.stringify(o))},{deep:!0}),Ce(()=>{const o=localStorage.getItem("applabels");o&&(d.value=JSON.parse(o))}),Qe(()=>{}),(o,l)=>(m(),A(Ae,{padding:""},{default:a(()=>[t(H,{class:"my-card"},{default:a(()=>[t(F,null,{default:a(()=>[i("div",Me,[l[10]||(l[10]=i("div",{class:"text-bold"},"Selecciona los Precios",-1)),t(Re,{options:w.value.opts,type:"toggle",modelValue:w.value.val,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value.val=e),inline:""},null,8,["options","modelValue"])]),i("div",He,[t(_,{class:"col",outline:"",color:"primary",icon:"upload_file",title:"Subir Etiquetas",onClick:ve}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),d.value.length>0?(m(),h("div",Je,[i("div",Ke,[t(_,{class:"col",outline:"",color:"primary",icon:"delete",title:"Eliminar Etiquetas",onClick:l[1]||(l[1]=e=>y.value.state=!y.value.state)}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),t(_,{class:"col",outline:"",color:"primary",icon:"download",title:"Descargar Etquetas",onClick:l[2]||(l[2]=e=>g.value.state=!g.value.state)})])])):I("",!0)]),i("input",{type:"file",ref_key:"inputFile",ref:S,id:"inputFile",onInput:me,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}),t(F,null,{default:a(()=>[i("div",We,[t(oe,{style:{width:"80px"},modelValue:V.value.val,"onUpdate:modelValue":[l[3]||(l[3]=e=>V.value.val=e),ge],options:V.value.opts,filled:"",dense:"","hide-dropdown-icon":""},null,8,["modelValue","options"]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),V.value.val.id==1?(m(),h("div",Ye,[t(Ee,{onInput:R,onAgregar:ue,with_prices:""})])):I("",!0),V.value.val.id==2?(m(),h("div",Xe,[P.value.length>0?(m(),h("div",Ze,[t(X,{dense:""},{default:a(()=>[t(Z,null,{default:a(()=>[t(M,null,{default:a(()=>[t(z,{caption:""},{default:a(()=>l[11]||(l[11]=[B("ACT HOY")])),_:1}),t(z,{class:"flex flex-center"},{default:a(()=>[t(de,{dense:"",modelValue:q.value,"onUpdate:modelValue":l[4]||(l[4]=e=>q.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(oe,{class:"col",modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=e=>k.value=e),options:P.value,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),k.value?(m(),A(Ge,{key:0,sections:k.value.sections,onObtProducts:be},null,8,["sections"])):I("",!0)])):I("",!0)])):I("",!0)])]),_:1})]),_:1}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),t(Oe,{rows:d.value,"row-key":"name",grid:"",filter:f.value.filter,pagination:f.value.pagination,"no-data-label":"''"},{"top-right":a(()=>[t(De,{borderless:"",dense:"",debounce:"300",modelValue:f.value.filter,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value.filter=e),placeholder:"Buscar"},{append:a(()=>[t(Pe,{name:"search"})]),_:1},8,["modelValue"])]),item:a(e=>[i("div",et,[t(H,{class:"my-card"},{default:a(()=>[t(F,null,{default:a(()=>{var r;return[t(Ne,{size:"sm",class:"fixed-right absolute-right text-bold text-white text-uppercase",color:fe(e.row.type)},{default:a(()=>[B(b(e.row.type),1)]),_:2},1032,["color"]),i("div",tt,b(e.row.code),1),i("div",lt,b(e.row.name),1),i("div",ot,b(e.row.label),1),i("div",at,"Longitud: "+b(e.row.large),1),i("div",st,"Ubicacion: "+b((r=e.row.locations)==null?void 0:r.map(p=>p.path).join("/")),1),t(L,{spaced:"",inset:"",vertical:"",dark:""}),i("div",nt,[(m(!0),h(J,null,K(e.row.usedPrices.filter(p=>w.value.val.includes(p.id)),(p,v)=>(m(),h("div",{class:"col items-start",key:v},[i("div",it,b(p.alias),1),i("div",dt,b(p.pivot.price),1)]))),128))])]}),_:2},1024),t(te,{align:"center"},{default:a(()=>[t(_,{flat:"",icon:"delete",color:"negative",onClick:r=>ce(e.row)},null,8,["onClick"]),t(_,{flat:"",icon:"add",onClick:r=>e.row._copies++},null,8,["onClick"]),i("div",null,[l[12]||(l[12]=i("div",{class:"text-caption text--2"},"copias",-1)),i("div",rt,b(e.row._copies),1)]),t(_,{flat:"",icon:"remove",onClick:r=>e.row._copies<=1?"":e.row._copies--},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),bottom:a(e=>[t(Le,{position:"bottom",class:"full-width",offset:[0,18]},{default:a(()=>[i("div",ut,[t(Ie,{rounded:"",flat:"",color:"primary"},{default:a(()=>[e.pagesNumber>2?(m(),A(_,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):I("",!0),t(_,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),t(_,{flat:"",disable:"","no-caps":""},{default:a(()=>[B(b(e.pagination.page)+" / "+b(e.pagesNumber),1)]),_:2},1024),t(_,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(m(),A(_,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):I("",!0)]),_:2},1024)])]),_:2},1024)]),"no-data":a(()=>l[13]||(l[13]=[])),_:1},8,["rows","filter","pagination"]),t(ee,{modelValue:y.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>y.value.state=e),persistent:""},{default:a(()=>[t(H,null,{default:a(()=>[t(F,{class:"row items-center"},{default:a(()=>[t(Se,{icon:"warning",color:"white","text-color":"negative"}),l[14]||(l[14]=i("div",{class:"q-ml-sm"},"Se eliminaran todos los articulos de la lista ",-1))]),_:1}),t(F,null,{default:a(()=>l[15]||(l[15]=[i("div",{class:"q-ml-sm"},"Deseas Continuar?",-1)])),_:1}),t(te,{align:"right"},{default:a(()=>[se(t(_,{flat:"",label:"No",color:"positive"},null,512),[[ne]]),t(_,{flat:"",label:"Si",color:"negative",onClick:pe})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ee,{modelValue:g.value.state,"onUpdate:modelValue":l[8]||(l[8]=e=>g.value.state=e),persistent:""},{default:a(()=>[t($e,{products:d.value,prices:w.value},null,8,["products","prices"])]),_:1},8,["modelValue"]),t(ee,{modelValue:c.value.state,"onUpdate:modelValue":l[9]||(l[9]=e=>c.value.state=e)},{default:a(()=>[t(H,{class:"my-card",style:{width:"70%"}},{default:a(()=>[t(F,{class:"items-center"},{default:a(()=>[l[16]||(l[16]=i("div",{class:"text-center text-bold"},"Repetidos",-1)),i("div",ct,b(c.value.messageRepeat),1)]),_:1}),t(F,null,{default:a(()=>[l[17]||(l[17]=i("div",{class:"text-center"},"Productos Sin Precio",-1)),t(X,null,{default:a(()=>[(m(!0),h(J,null,K(c.value.wndNoDataFound,(e,r)=>(m(),A(Z,{key:r},{default:a(()=>[t(M,null,{default:a(()=>[t(z,{overline:""},{default:a(()=>[B(b(e.code),1)]),_:2},1024)]),_:2},1024),t(M,null,{default:a(()=>[t(z,{caption:""},{default:a(()=>[B(b(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(F,null,{default:a(()=>[l[18]||(l[18]=i("div",{class:"text-center"},"Productos Sin Existencia",-1)),t(X,null,{default:a(()=>[(m(!0),h(J,null,K(c.value.wndNotExist,(e,r)=>(m(),A(Z,{key:r},{default:a(()=>[t(M,null,{default:a(()=>[t(z,{overline:""},{default:a(()=>[B(b(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(te,{align:"right"},{default:a(()=>[se(t(_,{flat:"",label:"OK",color:"primary"},null,512),[[ne]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Mt as default};
