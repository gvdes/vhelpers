import{Q as C}from"./QInput.19b54fce.js";import{u as D,Q as w,a as c}from"./use-quasar.b322a08d.js";import{Q as P}from"./QForm.8852c237.js";import{Q as $,c as B}from"./QSeparator.7d993a8e.js";import{r as m,m as F,t as A,a1 as b,o as g,a as x,w as s,h as y,e as o,f as i,a0 as v,Q as N,T as E}from"./index.5a98b8ac.js";import{Q as L}from"./QPage.a5a8df48.js";import{u as O}from"./VDB.27c8cfe6.js";import{u as z,c as U}from"./cashApi.d0b77714.js";import{_ as j}from"./PaymentSales.d9a12b6f.js";import{o as Q}from"./orderApi.b837fb26.js";import"./axios.0d2bd0f9.js";import"./QSelect.b7699ea8.js";import"./QCheckbox.303554ee.js";import"./QCardActions.f867ca51.js";const q={class:"row justify-center"},K={class:"col text-right"},R={class:"col text-right"},I={class:"col text-right"},M={class:"col text-right"},Y={class:"col text-right"},re={__name:"salesTpv",setup(Z){const _=O(),d=D(),f=z(),r=m(!1),u=m(null),t=m(null),k=m([]),V=async()=>{if(u.value){d.loading.show({message:"Obteniendo Orden"});let a={uid:_.session.credentials.staff.id_va,oid:u.value};const e=await Q.getOrderCash(a);e.fail?e.fail.status==401?(console.log(e),d.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),u.value=null,d.loading.hide()):e.fail.status==404?(console.log(e),d.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),u.value=null,d.loading.hide()):console.log(e):(t.value=e,console.log(e),d.loading.hide())}},S=async a=>{d.loading.show({message:"Realizando Ticket"}),t.value.payments=a,t.value.change=a.conditions.super?0:Number.parseFloat(a.SFPA.val)+Number.parseFloat(a.PFPA.val)+Number.parseFloat(a.VALE.val)-t.value.products.reduce((n,p)=>n+p.pivot.total,0),t.value.total=t.value.products.reduce((n,p)=>n+p.pivot.total,0);let e={order:t.value,cashier:f.cash};console.log(e);const l=await U.addSale(e);l.fail?console.log(l):(console.log(l),r.value=!1,u.value=null,k.value=[],T())},T=async()=>{let a={uid:_.session.credentials.staff.id_va,oid:t.value.id};console.log(a);const e=await Q.nextStateFinish(a);e.fail?console.log(e):(console.log(e),t.value=null,d.loading.hide())},h=a=>{a.altKey&&a.key==="Enter"&&t.value&&(a.preventDefault(),r.value||(r.value=!0))};return F(()=>{window.addEventListener("keydown",h)}),A(()=>{window.removeEventListener("keydown",h)}),(a,e)=>b(f).cash?(g(),x(L,{key:0,padding:""},{default:s(()=>[t.value?y("",!0):(g(),x(w,{key:0},{default:s(()=>[o(P,{onSubmit:V,class:"q-gutter-md"},{default:s(()=>[o(c,null,{default:s(()=>[o(C,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),type:"text",label:"Escanea",filled:"",dense:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),o($,{spaced:"",inset:"",vertical:"",dark:""}),i("div",q,[o(E,{name:"bounce"},{default:s(()=>[t.value?(g(),x(w,{key:0,class:"my-card",style:{"min-width":"600px"}},{default:s(()=>[o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[3]||(e[3]=i("div",{class:"col text-left"},"Cliente:",-1)),i("div",K,v(t.value.client.name),1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[4]||(e[4]=i("div",{class:"col text-left"},"Dependiente:",-1)),i("div",R,v(`${t.value.created_by.names} ${t.value.created_by.surname_pat}
              ${t.value.created_by.surname_mat} `),1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[5]||(e[5]=i("div",{class:"col text-left"},"Orden: ",-1)),i("div",I,v(t.value.id),1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[6]||(e[6]=i("div",{class:"col text-left"}," Productos: ",-1)),i("div",M,v(t.value.products.length)+" ART",1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[7]||(e[7]=i("div",{class:"col text-left"}," Piezas: ",-1)),i("div",Y,v(t.value.products.reduce((l,n)=>l+n.pivot.toDelivered,0))+" PZS",1)]),_:1}),o(c,{class:"text-bold text-h4 row bg-primary text-white"},{default:s(()=>[e[8]||(e[8]=i("div",{class:"col text-left"}," Total a Pagar: ",-1)),o(N,{class:"flex justify-right text-h5 bg-white text-primary",size:"xl",label:`$ ${t.value.products.reduce((l,n)=>l+n.pivot.total,0)}`,onClick:e[1]||(e[1]=l=>r.value=!r.value)},null,8,["label"])]),_:1})]),_:1})):y("",!0)]),_:1})]),i("div",null,[o(B,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value=l)},{default:s(()=>[o(j,{total:t.value.products.reduce((l,n)=>l+n.pivot.total,0),paymeths:b(f).methods,client:t.value._client,onSendTicket:S},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])])]),_:1})):y("",!0)}};export{re as default};
