import{Q as n}from"./QSeparator.68606440.js";import{r as p,c as w,o as U,a as J,w as s,aD as $,u as B,e as t,i as v,Y,f as C,Q as E,a4 as W,a2 as q}from"./index.f68de896.js";import{Q as b,d as L}from"./QSelect.60328ded.js";import{Q as j}from"./QToolbar.cebb0962.js";import{Q as G}from"./QHeader.9375d62f.js";import{Q as R}from"./QInput.8fc211e8.js";import{Q as z}from"./QDate.f851f49f.js";import{Q as K}from"./QTable.c5b48065.js";import{Q as X,a as Z}from"./QLayout.963a8d90.js";import{u as ee,Q as A,a as O}from"./use-quasar.fc1f08e3.js";import{Q as le}from"./QForm.e5ee9964.js";import{Q as P}from"./QDialog.73fa79d9.js";import{Q as ae}from"./QCardActions.207fc408.js";import{C as te}from"./ClosePopup.c5886aa9.js";import"./AppFullscreen.fb82a6c5.js";import"./auto.c5e70433.js";import"./dayjs.min.25545ff6.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.a61a0ef4.js";import{_ as oe}from"./UserToolbar.a5a0531e.js";import{A as se}from"./assistApi.3df7fe01.js";import{u as x}from"./VDB.09f52309.js";import{a as T}from"./axios.f1f32898.js";import{a as ie}from"./axios.30672b3a.js";import"./use-key-composition.a9540fcf.js";import"./uid.42677368.js";import"./position-engine.65af5f3b.js";import"./rtl.b51694b1.js";import"./QResizeObserver.acd16613.js";import"./use-cache.b0833c75.js";import"./date.a525674a.js";import"./QList.9878e934.js";import"./QLinearProgress.25b21625.js";import"./QCheckbox.dcf93fdb.js";import"./_commonjsHelpers.88e99c8f.js";const re={class:"col"},ne=v("span",{class:"text-grey"},"Helpers",-1),de=v("span",{class:"text-h6"},"Retiradas de Cajas",-1),ue={class:"col"},ve={class:"row"},me=v("div",{class:"col"},null,-1),pe=v("div",{class:"text-h6 text-center"},"Impresora",-1),fe={class:"q-ml-sm"},Ke={__name:"withdrawals",setup(ce){const d=ee();$();const N=B(),V=x(),_=x(),r=p([]),f=p(null),m=p([]),o=p({val:null,state:!1}),u=p({val:null,opts:[]}),i=p({state:!1,val:null,body:null}),y=p([]),g=p({filter:"",columns:[{name:"date",label:"FECHA",field:l=>l.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:l=>l.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:l=>l.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:l=>l.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:l=>l.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:l=>l.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:l=>Number(l.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:l=>l.NOFPRO,align:"left",sortable:!0}]}),F=w(()=>f.value&&!u.value.val?m.value.filter(l=>l.FECHA==f.value):!f.value&&u.value.val?m.value.filter(l=>l.CAJRET==u.value.val.CODTER):f.value&&u.value.val?m.value.filter(l=>l.FECHA==f.value&&l.CAJRET==u.value.val.CODTER):m.value),D=w(()=>{if(o.value){const l=m.value.find(a=>a.CODRET===o.value.val.CODRET);if(!l)return!1;let e={CAJRET:l.CAJRET,CODRET:l.CODRET,CONRET:l.CONRET,DESTER:l.DESTER,FECHA:l.FECHA,HORA:l.HORA,IMPRET:Number(l.IMPRET).toFixed(2),PROVEEDOR:{PRORET:l.PRORET,NOFPRO:l.NOFPRO}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),I=async()=>{d.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const l=await se.index();l.error||(console.log(l),r.value.opts=l,d.loading.hide(),H())},k=(l,e)=>{o.value.state=!o.value.state,console.log(e);let a={CAJRET:e.CAJRET,CODRET:e.CODRET,CONRET:e.CONRET,DESTER:e.DESTER,FECHA:e.FECHA,HORA:e.HORA,IMPRET:Number(e.IMPRET).toFixed(2),PROVEEDOR:{PRORET:e.PRORET,NOFPRO:e.NOFPRO}};o.value.val={...a}},H=async()=>{let l=_.session.store.id;console.log(l);try{let e=await ie.get(`/cashier/getPrinters/${l}`);e.status==200&&(i.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),d.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},h=async()=>{console.log(r.value.val.ip_address),d.loading.show({message:"Obteniendo Registros"});let e=`http://${r.value.val.ip_address}/storetools/public/api/reports/getWithdrawals`;const a=await T.get(e);a.status!=200?console.log(a):(console.log(a.data),m.value=a.data.cuts,u.value.opts=a.data.terminal,y.value=a.data.proveedores,d.loading.hide())},Q=async()=>{console.log(r.value.val.ip_address);let l={print:i.value.val.ip_address,codret:o.value.val.CODRET};console.log(l),d.loading.show({message:"Imprimiendo Retirada"});let a=`http://${r.value.val.ip_address}/storetools/public/api/reports/printWitrawal`;const c=await T.post(a,l);c.status!=200?console.log(c):(console.log(c.data),i.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide())},S=async()=>{o.value.val.Print=i.value.val.ip_address,console.log(o.value.val),d.loading.show({message:"Modificando Retirada"});let e=`http://${r.value.val.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const a=await T.post(e,o.value.val);if(a.status!=200)console.log(a);else{console.log(a.data);let c=m.value.findIndex(M=>M.CODRET==a.data.CODRET);c>=0&&(m.value[c]=a.data),i.value.val=null,o.value.val=null,o.value.state=!1,d.loading.hide()}};return V.session.rol==="adm"||V.session.rol==="root"?I():(d.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),N.replace("/")),(l,e)=>(U(),J(X,{view:"hHh Lpr fFf"},{default:s(()=>[t(G,{class:"bg-grey-3 text-dark",bordered:""},{default:s(()=>[t(oe),t(n),t(j,{class:"justify-between row"},{default:s(()=>[v("div",re,[ne,t(Y,{name:"navigate_next",color:"primary"}),de]),v("div",ue,[v("div",ve,[me,t(b,{class:"col",modelValue:r.value.val,"onUpdate:modelValue":[e[0]||(e[0]=a=>r.value.val=a),h],options:r.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),t(Z,null,{default:s(()=>[t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(K,{rows:C(F),filter:g.value.filter,columns:g.value.columns,onRowClick:k},{"top-right":s(()=>[t(R,{modelValue:g.value.filter,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value.filter=a),type:"text",label:"Buscar",filled:"",dense:"",disable:!r.value.val},null,8,["modelValue","disable"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(b,{modelValue:u.value.val,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.val=a),options:u.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!r.value.val},null,8,["modelValue","options","disable"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(E,{color:"primary",icon:"event",flat:"",round:"",disable:!r.value.val},{default:s(()=>[t(L,null,{default:s(()=>[t(z,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),t(P,{modelValue:i.value.state,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.state=a)},{default:s(()=>[t(A,{class:"my-card"},{default:s(()=>[t(O,null,{default:s(()=>[pe]),_:1}),t(O,null,{default:s(()=>[t(le,{onSubmit:Q,class:"q-gutter-md"},{default:s(()=>[t(b,{dense:"","option-label":"name",modelValue:i.value.val,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.val=a),options:i.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),v("div",null,[t(E,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:i.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(P,{modelValue:o.value.state,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.state=a),persistent:""},{default:s(()=>[t(A,{style:{width:"300px"}},{default:s(()=>[t(O,{class:"text-bold text-center text-h5"},{default:s(()=>[v("span",fe,"Retirada "+W(o.value.val.CODRET),1)]),_:1}),t(O,null,{default:s(()=>[t(R,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.val.FECHA=a),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.HORA,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.val.HORA=a),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.val.DESTER=a),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(b,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.val.PROVEEDOR=a),options:y.value,label:"Proveedor",filled:"","option-label":"NOFPRO"},null,8,["modelValue","options"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.val.CONRET=a),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.val.IMPRET=a),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),t(n,{spaced:"",inset:"",vertical:"",dark:""}),t(b,{dense:"","option-label":"name",modelValue:i.value.val,"onUpdate:modelValue":e[12]||(e[12]=a=>i.value.val=a),options:i.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),t(n,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),t(ae,{align:"center"},{default:s(()=>[q(t(E,{flat:"",color:"negative",icon:"close"},null,512),[[te]]),t(E,{flat:"",color:"primary",icon:"print",onClick:Q,disable:!C(D)||!i.value.val},null,8,["disable"]),t(E,{flat:"",color:"yellow",icon:"edit",disable:C(D)||!i.value.val,onClick:S},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ke as default};
