import{a as g,Q as y}from"./QCard.8fb4f9b5.js";import{Q as P}from"./QSeparator.d085a7d5.js";import{Q as D,a as v}from"./QItemSection.b320ee72.js";import{Q as E}from"./QList.c1754208.js";import{r as x,c as T,o as u,a as p,w as s,h as V,u as U,aD as L,e as t,i,a4 as r,f as I,a3 as f,g as j,a0 as z,a1 as G,Q as c,a2 as w,b2 as J,a6 as K}from"./index.6b919260.js";import{Q as k}from"./QCardActions.657489ad.js";import{Q as R}from"./QDialog.426be046.js";import{Q as W}from"./QFooter.c5afea2c.js";import{Q as X}from"./QPage.8dbc82ef.js";import{C as Z}from"./ClosePopup.b39444cf.js";import{u as ee}from"./VDB.67686440.js";import{u as te}from"./use-quasar.cf091104.js";import"./jspdf.plugin.autotable.e02077b2.js";import{r as h}from"./refundsApi.3835e941.js";import"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{p as oe}from"./Refund.ba7848ca.js";import{d as ae}from"./dayjs.min.25545ff6.js";import{P as le}from"./ProductsAutocomplete.55872a51.js";import"./QResizeObserver.dbdd5c11.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.76bdd693.js";import"./axios.f1f32898.js";import"./QInput.915469e0.js";import"./use-key-composition.abdd2bcc.js";import"./uid.42677368.js";import"./QSelect.8ec1d6fa.js";import"./position-engine.a0970efb.js";import"./rtl.b51694b1.js";/* empty css                                                                         */const se={class:"text-center"},ie=i("div",{class:"text-caption"},"ID",-1),ne={class:"text-bold"},de={class:"col text-center"},re=i("div",{class:"text-caption"},"REFERENCIA",-1),ce={class:"text-bold"},ue={class:"col text-center"},ve=i("div",{class:"text-caption"},"DESTINO",-1),pe={class:"text-bold"},fe={class:"col text-center"},me=i("div",{class:"text-caption"},"CREADO",-1),_e={class:"text-bold"},ge={class:"col text-center"},xe=i("div",{class:"text-caption"},"FECHA",-1),he={class:"text-bold"},be={class:"text-center text-h4"},ye={class:"text-center text-h6 text-grey-14"},Ce={class:"text-center"},we={class:"q-pa-xs"},ke=i("div",{class:"text-bold text-h6"},"Cantidad:",-1),Qe={class:"row"},Pe={class:"col column q-py-md"},De=i("span",{class:"text text-h6"},"Estas Seguro de terminar la devolucion no se podra editar",-1),it={__name:"viewRefund",setup(Ee){const C=U(),m=L(),_=ee(),n=te();x([]),x([]);const d=x(null),b=x(!1),o=x({state:!1,val:null}),S=T(()=>{var e;return((e=d.value)==null?void 0:e.bodie.filter(l=>{var a;return l.product==((a=o.value.val)==null?void 0:a.product)}).length)>0}),A=async()=>{n.loading.show({message:"Obteniendo Datos"});let e=_.session.store.id,l=m.params.rid;console.log(l);const a=await h.getRefund(e,l);a.error?console.log(a):a.status.id==1?(console.log(a),n.loading.hide(),d.value=a):(n.notify({message:"Ya no se puede modificar la devolucion",type:"negative",position:"top"}),C.replace("/refunds"))},$=e=>{console.log(e)},B=e=>{let l=d.value.bodie.findIndex(a=>a.product==e.code);console.log(l),l>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(o.value.val={product:e.code,description:e.description,price:e.cost,to_delivered:1},o.value.state=!0,console.log(e))},Q=()=>{o.value={val:null,state:!1}},N=async()=>{n.loading.show({message:"Insertando Producto"}),o.value.val._refund=m.params.rid,console.log(o.value.val);const e=await h.addProduct(o.value.val);e.fail?console.log(e):(console.log(e),d.value.bodie.push(o.value.val),o.value={val:null,state:!1},n.loading.hide())},F=async()=>{n.loading.show({message:"Creando Devolucion"});const e=await h.endRefund({id:m.params.rid});e.fail?console.log(e):(console.log(e),n.notify({message:`Se creo la devolucion ${e.fs_id} Correctamente`,type:"positive",position:"center"}),C.push("/refunds"),M(e)),n.loading.hide()},Y=async()=>{n.loading.show({message:"Editando Producto"}),console.log(o.value.val),o.value.val._refund=m.params.rid;const e=await h.editProduct(o.value.val);if(e.fail)console.log(e);else{console.log(e);let l=d.value.bodie.findIndex(a=>a.product==o.value.val.product);l>=0&&(d.value.bodie[l].to_delivered=o.value.val.to_delivered,n.notify({type:"positive",position:"center"}),o.value={val:null,state:!1},n.loading.hide())}},q=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(o.value.val),o.value.val._refund=m.params.rid;const e=await h.deleteProduct(o.value.val);if(e.fail)console.log(e);else{console.log(e);let l=d.value.bodie.findIndex(a=>a.product==o.value.val.product);l>=0&&(d.value.bodie.splice(l,1),n.notify({type:"positive",position:"center"}),o.value={val:null,state:!1},n.loading.hide())}},H=e=>{o.value.state=!0,o.value.val=e},M=e=>{console.log(e),oe.refund(e)};return _.session.rol=="aux"||_.session.rol=="gen"||_.session.rol=="aud"||_.session.rol=="root"?A():(n.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),C.replace("/")),(e,l)=>d.value?(u(),p(X,{key:0,padding:""},{default:s(()=>[t(y,{class:"my-card"},{default:s(()=>[t(g,{class:"row"},{default:s(()=>[i("div",se,[ie,i("div",ne,r(d.value.id),1)]),i("div",de,[re,i("div",ce,r(d.value.reference),1)]),i("div",ue,[ve,i("div",pe,r(d.value.storeto.name),1)]),i("div",fe,[me,i("div",_e,r(d.value.createdby.complete_name),1)]),i("div",ge,[xe,i("div",he,r(I(ae)(d.value.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:1})]),_:1}),t(P,{spaced:"",inset:"",vertical:"",dark:""}),t(E,{bordered:""},{default:s(()=>[t(D,null,{default:s(()=>[t(v,null,{default:s(()=>[f(" Producto ")]),_:1}),t(v,null,{default:s(()=>[f(" Descripcion ")]),_:1}),t(v,{class:"text-center"},{default:s(()=>[f(" Cantidad ")]),_:1})]),_:1})]),_:1}),(u(!0),j(G,null,z(d.value.bodie,(a,O)=>(u(),p(E,{bordered:"",key:O},{default:s(()=>[w((u(),p(D,{clickable:"",onClick:Ve=>H(a)},{default:s(()=>[t(v,null,{default:s(()=>[f(r(a.product),1)]),_:2},1024),t(v,null,{default:s(()=>[f(r(a.description),1)]),_:2},1024),t(v,{class:"text-center"},{default:s(()=>[f(r(a.to_delivered),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[K]]),t(P)]),_:2},1024))),128)),t(R,{modelValue:o.value.state,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.state=a),persistent:"",position:"bottom"},{default:s(()=>[t(y,{style:{width:"300","max-width":"40vw"}},{default:s(()=>[t(g,null,{default:s(()=>[i("div",be,r(o.value.val.product),1),i("div",ye,r(o.value.val.description),1)]),_:1}),t(g,null,{default:s(()=>[i("div",Ce,[i("div",we,[ke,i("div",Qe,[t(c,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:l[0]||(l[0]=a=>o.value.val.to_delivered>1?o.value.val.to_delivered--:"")}),i("div",Pe,[w(i("input",{type:"number",min:"1","onUpdate:modelValue":l[1]||(l[1]=a=>o.value.val.to_delivered=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[J,o.value.val.to_delivered]])]),t(c,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:l[2]||(l[2]=a=>o.value.val.to_delivered++)})])])])]),_:1}),I(S)?(u(),p(k,{key:1,align:"center"},{default:s(()=>[t(c,{flat:"",icon:"close",color:"red-10",onClick:Q}),t(c,{flat:"",label:"Eliminar",color:"negative",onClick:q}),t(c,{flat:"",label:"Editar",color:"blue-10",onClick:Y})]),_:1})):(u(),p(k,{key:0,align:"center"},{default:s(()=>[t(c,{flat:"",label:"Cancelar",color:"negative",onClick:Q}),t(c,{flat:"",label:"Agregar",color:"positive",onClick:N})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=a=>b.value=a),persistent:""},{default:s(()=>[t(y,null,{default:s(()=>[t(g,{class:"row items-center"},{default:s(()=>[De]),_:1}),t(k,{align:"right"},{default:s(()=>[w(t(c,{flat:"",icon:"close",color:"negative"},null,512),[[Z]]),t(c,{flat:"",icon:"check",color:"positive",onClick:F})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(W,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:s(()=>[t(y,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[t(g,{class:"row"},{default:s(()=>[t(le,{class:"col",checkState:!1,onInput:$,onAgregar:B}),d.value.bodie.length>0?(u(),p(c,{key:0,color:"primary",flat:"",icon:"east",onClick:l[5]||(l[5]=a=>b.value=!b.value),round:""})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0)}};export{it as default};
