import{Q as oe}from"./QHeader.299cd9cd.js";import{V as v,X as te,aI as ae,a as le,u as se,r as S,c as M,p as ie,n as re,m as ne,a$ as de,o as C,d as k,w as u,e as a,a1 as Q,f as h,a0 as Y,Q as w,h as x,al as ue,ak as E}from"./index.a870245a.js";import{b as z,Q as I}from"./QList.d78e7ab0.js";import{Q as pe}from"./QToolbar.42fe075a.js";import{Q as me,a as ce}from"./QLayout.5edb7f5c.js";import{Q as fe}from"./QDate.91346956.js";import{Q as _}from"./QCardSection.91064c30.js";import{Q as j}from"./QCardActions.39598358.js";import{Q as H}from"./QCard.e9b66d19.js";import{Q as T}from"./QSelect.8deb40ca.js";import{Q as J}from"./QInput.fd99f261.js";import{_ as ve}from"./UserToolbar.858c5092.js";import{u as K}from"./Restock.45055c6b.js";import{d as ge}from"./dayjs.min.cbcf888d.js";import{R as V}from"./RestockApi.bb7236fe.js";import{u as ye}from"./use-quasar.f7e2bae4.js";import{$sktRestock as i}from"./socket.05630e21.js";import"./QResizeObserver.a16ed928.js";import"./use-key-composition.cb7b2501.js";import"./QScrollObserver.26750571.js";import"./use-render-cache.3aae9b27.js";import"./date.5e5e1eab.js";import"./QDrawer.fcce590c.js";import"./use-checkbox.cc0344f2.js";import"./QExpansionItem.1badb8bf.js";import"./ClosePopup.5155137b.js";import"./auth.e3d2dc4e.js";import"./axios.a3d47f46.js";import"./QForm.bcdcc936.js";import"./QRadio.220c822a.js";import"./QTd.1434aea2.js";import"./QPopupEdit.8bd07edc.js";import"./QTr.a66384ef.js";import"./QTable.a6272314.js";import"./QLinearProgress.e1500b90.js";import"./QCheckbox.9bd5e2a2.js";import"./QPage.c4e74ae1.js";import"./jspdf.plugin.autotable.d17988fc.js";import"./_commonjsHelpers.88e99c8f.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */function be(m,r=document.body){if(typeof m!="string")throw new TypeError("Expected a string as propName");if(!(r instanceof Element))throw new TypeError("Expected a DOM element");return getComputedStyle(r).getPropertyValue(`--q-${m}`).trim()||null}let q;function we(){return v.is.winphone?"msapplication-navbutton-color":v.is.safari?"apple-mobile-web-app-status-bar-style":"theme-color"}function _e(m){const r=document.getElementsByTagName("META");for(const g in r)if(r[g].name===m)return r[g]}function he(m){q===void 0&&(q=we());let r=_e(q);const g=r===void 0;g&&(r=document.createElement("meta"),r.setAttribute("name",q)),r.setAttribute("content",m),g&&document.head.appendChild(r)}v.is.mobile===!0&&(v.is.nativeMobile===!0||v.is.winphone===!0||v.is.safari===!0||v.is.webkit===!0||v.is.vivaldi===!0)||te;const Ve={class:"text-bold"},Ce={class:"row"},ke={class:"col row"},Pe={class:"q-pa-md"},go={__name:"distributeLYT",setup(m){const r=K();ae();const g=le(),s=K(),y=ye(),n=se(),b=S(!1),t=S({state:!1,folio:null,notes:null,types:{val:{id:1,label:"Manual"},opts:[{id:1,label:"Manual"},{id:3,label:"Venta"},{id:4,label:"Preventa"}]},suply_by:{val:null,opts:[]},warehouse:{val:{id:"GEN",label:"General"},opts:[{id:"GEN",label:"General"},{id:"EMP",label:"Empaques"}]}}),f=S({val:{from:null,to:null}}),X={profile:{me:{id:n.session.credentials.staff.id_va,nick:n.session.credentials.nick,picture:"",names:n.session.credentials.staff.complete_name,surname_pat:"",surname_mat:"",change_password:!1,_rol:1},workpoint:n.session.store},workpoint:n.session.store},P=M(()=>y.platform.is.mobile),U=M(()=>{var e;return t.value.types.val.id==3&&((e=t.value.folio)==null?void 0:e.length)!=8?!0:t.value.types.val.id==4&&!t.value.folio}),W=M(()=>{var e;return t.value.types.val.id==3&&((e=t.value.folio)==null?void 0:e.length)!=8?"reduerda ingresar 0":t.value.types.val.id==4&&!t.value.folio?"debe de tener minimo un caracter":""}),D=async()=>{s.setShowLoad(!0),y.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let e=ge(new Date).format("YYYY/MM/DD");f.value.val={from:e,to:e};const o=await V.index({date:f.value.val,storeTo:n.session.store.id_viz});o.fail?console.log(o):(console.log(o),s.fillOrders(o.orders),s.fillResume(o.resume),s.fillPrinters(o.printers),s.fillPartitions(o.partitions),s.setShowLoad(!1),s.setCedis(o.cedis),t.value.suply_by.opts=o.cedis,t.value.suply_by.val=o.cedis[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),y.loading.hide())},Z=async()=>{b.value=!1,y.loading.show({message:"Obteniendo Datos"});const e=await V.index({date:f.value.val,storeTo:n.session.store.id_viz});console.log(e),s.fillOrders(e.orders),s.fillPartitions(e.partitions),console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),y.loading.hide()},ee=async()=>{y.loading.show({message:"Creando Pedido"}),t.value.workpointFrom=n.session.store.id_viz,t.value.created_by=n.session.credentials.staff.id_va,console.log(t.value);const e=await V.newRequisition(t.value);e.fail?console.log(e):(console.log(e),y.loading.hide(),i.emit("creating",{order:e.requisition}),t.value={state:!1,folio:null,notes:null,types:{val:{id:1,label:"Manual"},opts:[{id:1,label:"Manual"},{id:3,label:"Venta"},{id:4,label:"Preventa"}]},suply_by:{val:s.cedis[0],opts:s.cedis},warehouse:{val:{id:"GEN",label:"General"},opts:[{id:"GEN",label:"General"},{id:"EMP",label:"Empaques"}]}},g.push(`/distribute/dashboardStore/${e.requisition.id}`))},O=async e=>{if(console.log(e),e.order.requisition.to.id===n.session.store.id_viz||e.order.requisition.from.id===n.session.store.id_viz){e.order,console.log("Partition refresh!!",e);let o=e.order,p=e.order.id;s.addOrUpdatePartition(p,o),console.log(o),console.log(p);let l=s.ordersdb.find(d=>d.id==o._requisition).partition;console.log(l);let c=l.findIndex(d=>d.id==o.id);c>=0&&l.splice(c,1,o)}},R=e=>{console.log(`%c${e.user.me.nick} de ${e.from.alias} se ha unido a Restock (UID: ${e.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},$=async e=>{if(console.log(e),e.order.to.id===n.session.store.id_viz||e.order.from.id===n.session.store.id_viz){let o=e.order;console.log(e.order.to.id);let p=await V.orderFresh(o.id),l=p.data.order,c=p.data.oid;s.addOrUpdate(c,l)}},B=async e=>{if(console.log(e),e.requisition.to.id===n.session.store.id_viz||e.requisition.from.id===n.session.store.id_viz){console.log(e.requisition.to.id);let o=e,p=e.id;s.addOrUpdatePartition(p,o)}},N=async e=>{console.log(e);let o=e.id,p=e._requisition;s.deleteParition(o),s.deleteParitionOrder(o,p)},F=e=>{console.log(e),s.orderUpdate(e)},G=async e=>{if(e.order.to.id===n.session.store.id_viz){let o=e.order,p=e.state,l=await V.orderFresh(o.id),c=l.data.order,d=l.data.oid;s.addOrUpdate(d,c),p.id==2}},L=e=>{s.setStatusPartition(e)},A=async e=>{var o;if(console.log(e),((o=e.order)==null?void 0:o.to.id)===n.session.store.id_viz||e.order.from.id===n.session.store.id_viz){console.log("REFRESHING BY SKT!!",e);let p=e.order,l=await V.orderFresh(p.id);console.log(l);let c=l.data.order;console.log(c.partition);let d=l.data.oid;s.addOrUpdate(d,c)}};return ie(async()=>{i.connect(),i.emit("joinat",X),i.on("joineddashreq",R),i.on("creating",$),i.on("order_update",F),i.on("order_changestate",G),i.on("order_refresh",A),i.on("orderpartition_refresh",O),i.on("sktPartitionCreate",B),i.on("sktPartitionDelete",N),i.on("ChangeStatus",L),await re(),window.layoutReady=!0,await D(),window.dispatchEvent(new Event("layout-ready"))}),ne(()=>{i.off("joineddashreq",R),i.off("creating",$),i.off("order_update",F),i.off("order_changestate",G),i.off("order_refresh",A),i.off("orderpartition_refresh",O),i.off("sktPartitionCreate",B),i.off("sktPartitionDelete",N),i.off("ChangeStatus",L)}),(e,o)=>{const p=de("router-view");return C(),k(me,{view:"hHh Lpr fFf"},{default:u(()=>[a(oe,{class:"transparent",bordered:""},{default:u(()=>[a(ve)]),_:1}),a(ce,null,{default:u(()=>[Q(s).showLYT?(C(),k(pe,{key:0,class:"row justify-between items-center"},{default:u(()=>[h("div",Ve,Y(Q(r).title),1),h("div",null,Y(f.value.val&&f.value.val.from?`Del ${f.value.val.from} a ${f.value.val.to}`:f.value.val),1),h("div",Ce,[a(w,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:D}),h("div",ke,[Q(r).showButton?(C(),k(w,{key:0,class:"col",color:"primary",icon:"event",onClick:o[0]||(o[0]=l=>b.value=!b.value),flat:"",round:""})):x("",!0),a(z,{spaced:"",inset:"",vertical:"",dark:""}),Q(r).showButtonAdd?(C(),k(w,{key:1,class:"col",color:"primary",icon:"add",onClick:o[1]||(o[1]=l=>t.value.state=!t.value.state)})):x("",!0)])])]),_:1})):x("",!0),a(p)]),_:1}),a(I,{modelValue:b.value,"onUpdate:modelValue":o[4]||(o[4]=l=>b.value=l)},{default:u(()=>[a(H,{class:"my-card"},{default:u(()=>[a(_,null,{default:u(()=>[h("div",Pe,[o[12]||(o[12]=h("div",{class:"q-pb-sm text-center"},null,-1)),a(fe,{modelValue:f.value.val,"onUpdate:modelValue":o[2]||(o[2]=l=>f.value.val=l),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),a(_,null,{default:u(()=>[a(j,{align:"right"},{default:u(()=>[a(w,{flat:"",icon:"close",color:"negative",onClick:o[3]||(o[3]=l=>b.value=!b.value)}),a(w,{flat:"",icon:"check",color:"positive",onClick:Z})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(I,{modelValue:t.value.state,"onUpdate:modelValue":o[11]||(o[11]=l=>t.value.state=l)},{default:u(()=>[a(H,{class:"my-card",style:{width:"400px","max-width":"50vw"}},{default:u(()=>{var l,c;return[a(_,{class:"text-center text-bold text-h6"},{default:u(()=>o[13]||(o[13]=[ue(" Nuevo Pedido ")])),_:1}),a(_,{class:E(P.value?"":"row")},{default:u(()=>[a(T,{class:E(P.value?"":"col"),modelValue:t.value.suply_by.val,"onUpdate:modelValue":o[5]||(o[5]=d=>t.value.suply_by.val=d),options:t.value.suply_by.opts,label:"Cedis",filled:"","option-label":"alias",dense:""},null,8,["class","modelValue","options"]),a(z,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{class:E(P.value?"":"col"),modelValue:t.value.warehouse.val,"onUpdate:modelValue":o[6]||(o[6]=d=>t.value.warehouse.val=d),options:t.value.warehouse.opts,label:"Almacen",filled:"",dense:""},null,8,["class","modelValue","options"]),a(z,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{class:E(P.value?"":"col"),modelValue:t.value.types.val,"onUpdate:modelValue":o[7]||(o[7]=d=>t.value.types.val=d),options:t.value.types.opts,label:"Tipo",filled:"",dense:""},null,8,["class","modelValue","options"])]),_:1},8,["class"]),((c=(l=t.value.types)==null?void 0:l.val)==null?void 0:c.id)!=1?(C(),k(_,{key:0},{default:u(()=>[a(J,{modelValue:t.value.folio,"onUpdate:modelValue":o[8]||(o[8]=d=>t.value.folio=d),type:t.value.types.val.id==3?"text":"number",label:t.value.types.val.id==3?"Ticket":"Folio",mask:t.value.types.val.id==3?"#-######":"",filled:"",dense:"",error:U.value,"error-message":W.value},null,8,["modelValue","type","label","mask","error","error-message"])]),_:1})):x("",!0),a(_,null,{default:u(()=>[a(J,{modelValue:t.value.notes,"onUpdate:modelValue":o[9]||(o[9]=d=>t.value.notes=d),type:"text",label:"Notas",filled:"",dense:""},null,8,["modelValue"])]),_:1}),a(_,null,{default:u(()=>[a(j,{align:"right"},{default:u(()=>[a(w,{flat:"",icon:"close",color:"negative",onClick:o[10]||(o[10]=d=>t.value.state=!t.value.state)}),a(w,{flat:"",icon:"check",color:"positive",onClick:ee,disable:U.value},null,8,["disable"])]),_:1})]),_:1})]}),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{go as default};
