import{b as p,a as fe,d as be,e as N,Q as I}from"./QList.9744d304.js";import{Q as ge}from"./QHeader.f01ac61f.js";import{u as ye,r as y,c as h,o as f,d as A,w as t,e,f as s,ak as v,S as K,Q as b,a1 as Y,g as x,h as B,U as xe,a0 as r,a4 as G,aA as ke,aI as _e,al as H,a2 as F,a3 as $}from"./index.36b6f3f3.js";import{d as Ve,Q as M,a as V}from"./QSelect.b2e0eed3.js";import{Q as L}from"./QInput.5ac6a47a.js";import{Q as j}from"./QForm.453f3ede.js";import{Q as Ce}from"./QToolbar.048e4980.js";import{Q as d}from"./QCardSection.2a5053ab.js";import{Q as g}from"./QCard.c09bae66.js";import{Q as W}from"./QSpace.d241da2f.js";import{Q as P}from"./QCardActions.66eaa095.js";import{Q as Z}from"./QTable.35c88d33.js";import{a as we}from"./QExpansionItem.e32c1b0b.js";import{Q as Qe}from"./QPage.48c14d2e.js";import{Q as he}from"./QFooter.11b46858.js";import{Q as Pe,a as Se}from"./QLayout.9cb4e2c1.js";import{C as Te}from"./ClosePopup.0f2a9450.js";import{_ as Ie}from"./UserToolbar.1f2bdf84.js";import{a as Ue,b as ee}from"./axios.01f1ad8b.js";import{u as qe}from"./use-quasar.21781a3f.js";/* empty css                                                                         */import"./use-key-composition.61edd40b.js";import"./QResizeObserver.d3e712c7.js";import"./QLinearProgress.7e0c973d.js";import"./QCheckbox.da1fe95a.js";import"./use-checkbox.3d699876.js";import"./QScrollObserver.83400ae8.js";import"./QDrawer.7b8d4b06.js";import"./auth.7cbb5b77.js";const De={key:0,class:"text-right"},Ne={key:0},Be={class:"row"},Fe={class:"justify-center"},$e={class:"text-center text-bold"},Me={class:"row justify-between"},Re={class:"text-left"},Ee={class:"text--3"},Ae={class:"text-h6"},He={class:"text-right"},Le={class:"text--2"},je={class:"row"},Oe={class:"text-center col"},Xe={class:"text-center col"},ze={class:"text-center col"},Je={class:"text-h6"},Ql={__name:"TckVerifyLYT",setup(Ke){const U=ye(),m=qe(),le=U.series,S=y(null),C=y(null),T=y(""),c=y({state:!1,val:null,body:null}),R=y({state:!1}),n=y({state:!1,body:[],head:null}),u=y({state:!1,val:null}),q=y(!1),E=y([]),k=y({pagination:{rowsPerPage:0},visibleColumns:["code","description"],visibleColumnstwo:["code","description","checkout","diferencia"],columns:[{name:"code",label:"Codigo",field:o=>o.codigo,required:!0,align:"left",sortable:!0},{name:"barcode",label:"CB",field:o=>o.cb,align:"left",sortable:!0},{name:"shortcode",label:"Corto",field:o=>o.corto,align:"center",sortable:!0},{name:"description",label:"Descripcion",field:o=>o.descripcion,align:"left",sortable:!0},{name:"checkout",label:"Validado",field:o=>o.checkout,align:"center",sortable:!0},{name:"diferencia",label:"Diferencia",field:o=>o.diferencia,align:"center",sortable:!0}]}),te=h(()=>S.value&&T.value.length),w=h(()=>n.value.body.filter(o=>o.validate==0)),_=h(()=>n.value.body.filter(o=>o.validate==1)),Q=h(()=>{var o;return(o=n.value.body)==null?void 0:o.filter(l=>l.diferencia!=0)}),O=h(()=>_.value.length>0&&Q.value.length==0&&w.value.length==0),X=h(()=>_.value.length>0&&Q.value.length>0&&w.value.length==0),ae=async()=>{m.loading.show({message:"Se esta obteniendo el ticket"});let o={serie:S.value,folio:T.value},a=`http://${U.session.store.ip_address}/access/public/modify/getTck`;ee.post(a,o).then(i=>{console.log(i.data),n.value.head=i.data.ticket,n.value.body=i.data.product,n.value.state=!0,m.loading.hide()}).catch(i=>{console.log(i.response.data),m.notify({html:!0,message:i.response.data,color:"negative",position:"center"}),m.loading.hide()})},oe=()=>{let o=u.value.val,l=n.value.body.findIndex(a=>a.codigo==o.codigo);l>=0?(n.value.body[l].checkout=o.conteo*o.pxc,n.value.body[l].validate=1,n.value.body[l].diferencia=o.checkout-o.cantidad,n.value.body[l].diferencia!=0?(console.log("Hay diferencia se bloquea productos sin revisar para que se analice el producto revisado ?"),m.notify({message:"El producto esta mal contado",type:"negative",icon:"sentiment_dissatisfied",position:"top"})):m.notify({message:"El producto esta bien contado",type:"positive",icon:"mood",position:"top"}),u.value.val=null,u.value.state=!1):m.notify({message:"No se encuentra el articulo"})},z=(o,l)=>{console.log(l),u.value.state=!0,u.value.val=l},se=()=>{console.log("conteo terminado"),S.value=null,C.value="",T.value="",n.value={state:!1,body:[],head:null},u.value={state:!1,val:null}},ne=()=>{console.log("Terminado Incompleto"),R.value.state=!0},ie=()=>{Q.value.forEach(o=>{let l=n.value.body.findIndex(a=>a.codigo==o.codigo);l>=0&&(n.value.body[l].checkout=0,n.value.body[l].diferencia=0,n.value.body[l].conteo=0,n.value.body[l].validate=0)})},de=(o,l,a)=>{l(()=>{const i=o.toUpperCase();E.value=n.value.body.filter(D=>{const ve=D.variants.some(pe=>pe.cb.toUpperCase().indexOf(i)>-1),me=D.codigo.toUpperCase().indexOf(i)>-1||D.cb.toUpperCase().indexOf(i)>-1||D.corto.toUpperCase().indexOf(i)>-1;return ve||me}),console.log(E.value)})},ue=()=>{let o=n.value.body.filter(l=>l==C.value);u.value.state=!0,u.value.val=o[0],C.value=""},re=o=>{C.value=o,console.log(C.value)},J=async()=>{let o=U.session.store.id;try{let l=await Ue.get(`/cashier/getPrinters/${o}`);l.status==200&&(c.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),m.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},ce=async()=>{m.loading.show({message:"Imprimiendo Diferencias"});let o={printer:c.value.val.ip_address,data:n.value,invalid:w.value,valid:_.value,diff:Q.value},a=`http://${U.session.store.ip_address}/access/public/modify/PrintDiff`;ee.post(a,o).then(i=>{console.log(i.data),i.data==1&&(m.notify({message:"Impresion Correcta",type:"positive",position:"center"}),c.value.state=!1,c.value.val=null),m.loading.hide()}).catch(i=>{console.log(i.response.data),m.notify({html:!0,message:i.response.data,color:"negative",position:"center"}),m.loading.hide()})};return J(),J(),(o,l)=>(f(),A(Pe,{view:"hHh Lpr fFf"},{default:t(()=>[e(ge,{class:"transparent text-dark",bordered:""},{default:t(()=>[e(Ie),e(p)]),_:1}),e(Se,null,{default:t(()=>[e(Qe,{class:"bg-grey-3",padding:""},{default:t(()=>[e(Ce,{class:"justify-between"},{default:t(()=>[s("div",null,[l[16]||(l[16]=v("Helpers ")),e(K,{name:"navigate_next",color:"primary"}),l[17]||(l[17]=v()),l[18]||(l[18]=s("span",{class:"text-h6"},"TICKETS",-1))]),e(b,{color:"primary",icon:"add"},{default:t(()=>[e(Ve,null,{default:t(()=>[l[19]||(l[19]=s("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Folio",-1)),e(p),e(j,{dense:"",onSubmit:ae,class:"q-gutter-md q-pa-md"},{default:t(()=>[e(M,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=a=>S.value=a),options:Y(le),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(L,{modelValue:T.value,"onUpdate:modelValue":l[1]||(l[1]=a=>T.value=a),type:"number",label:"Folio"},null,8,["modelValue"]),te.value?(f(),x("div",De,[e(b,{type:"submit",color:"primary",icon:"search"})])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n.value.state?(f(),x("div",Ne,[s("div",null,[e(xe,{name:"bounce"},{default:t(()=>[e(g,null,{default:t(()=>[e(d,null,{default:t(()=>[e(fe,null,{default:t(()=>[e(be,null,{default:t(()=>[e(N,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[20]||(l[20]=[v("Fecha:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.fecha),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(N,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[21]||(l[21]=[v("Ticket:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.ticket),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(N,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[22]||(l[22]=[v("Cliente:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.cliente),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(N,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[23]||(l[23]=[v("Total:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.total),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),e(p,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Be,[e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[24]||(l[24]=[s("div",{class:"text-center"},"X Validar",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(w.value.length),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[25]||(l[25]=[s("div",{class:"text-center"},"Validados",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(_.value.length),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[26]||(l[26]=[s("div",{class:"text-center"},"Dif",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(n.value.body.reduce((a,i)=>a+Number(i.diferencia),0)),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[27]||(l[27]=[s("div",{class:"text-center"},"Cajas",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(n.value.body.reduce((a,i)=>a+Number(i.conteo),0)),1)]),_:1})]),_:1})]),e(p,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Fe,[e(g,{class:"my-card"},{default:t(()=>[e(P,null,{default:t(()=>[l[28]||(l[28]=s("div",null," Productos Revisados",-1)),e(p,{spaced:"",inset:"",vertical:"",dark:""}),s("div",$e,r(_.value.length),1),e(W),e(b,{color:"grey",round:"",flat:"",dense:"",icon:q.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:l[2]||(l[2]=a=>q.value=!q.value)},null,8,["icon"])]),_:1}),e(we,null,{default:t(()=>[G(s("div",null,[e(p),e(d,{class:"text-subtitle2"},{default:t(()=>[e(d,null,{default:t(()=>[e(Z,{flat:"",rows:_.value,columns:k.value.columns,"visible-columns":k.value.visibleColumnstwo,"no-data-label":"No hay datos :(",pagination:k.value.pagination,onRowClick:z,"hide-bottom":""},null,8,["rows","columns","visible-columns","pagination"])]),_:1})]),_:1})],512),[[ke,q.value]])]),_:1})]),_:1}),e(g,{class:"my-card"},{default:t(()=>[e(d,null,{default:t(()=>[e(Z,{flat:"",title:"Productos Sin Revisar",rows:w.value,columns:k.value.columns,"visible-columns":k.value.visibleColumns,"no-data-label":"No hay datos :(",pagination:k.value.pagination,onRowClick:z,"hide-bottom":""},{top:t(()=>[l[29]||(l[29]=s("div",null," Productos Sin Revisar",-1)),e(W),e(M,{modelValue:k.value.visibleColumns,"onUpdate:modelValue":l[3]||(l[3]=a=>k.value.visibleColumns=a),multiple:"",outlined:"",dense:"","options-dense":"","display-value":Y(m).lang.table.columns,"emit-value":"","map-options":"",options:k.value.columns,"option-value":"name","options-cover":"",style:{"min-width":"150px"}},null,8,["modelValue","display-value","options"])]),_:1},8,["rows","columns","visible-columns","pagination"])]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""})])])):B("",!0),e(I,{modelValue:u.value.state,"onUpdate:modelValue":l[6]||(l[6]=a=>u.value.state=a),persistent:"",position:"bottom"},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"bg-grey-3"},{default:t(()=>[s("div",Me,[s("div",Re,[s("div",Ee,"CCO: "+r(u.value.val.corto),1),s("div",Ae,r(u.value.val.codigo),1)]),s("div",He,[l[30]||(l[30]=s("div",{class:"text-bold"},"CAJAS",-1)),s("div",Le,r(Math.round(u.value.val.cantidad/u.value.val.pxc)),1)])])]),_:1}),e(p),e(d,null,{default:t(()=>[v(r(u.value.val.descripcion),1)]),_:1}),e(j,{onSubmit:_e(oe,["prevent"])},{default:t(()=>[e(d,null,{default:t(()=>[s("div",je,[s("div",Oe,[l[31]||(l[31]=s("div",null,"Cajas",-1)),e(L,{dense:"",borderless:"",modelValue:u.value.val.conteo,"onUpdate:modelValue":l[4]||(l[4]=a=>u.value.val.conteo=a),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter",autofocus:""},null,8,["modelValue"])]),s("div",Xe,[l[32]||(l[32]=s("div",null,"PXC",-1)),e(L,{dense:"",borderless:"",modelValue:u.value.val.pxc,"onUpdate:modelValue":l[5]||(l[5]=a=>u.value.val.pxc=a),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter"},null,8,["modelValue"])]),s("div",ze,[l[33]||(l[33]=s("div",null,"Conteo",-1)),s("div",Je,r(u.value.val.conteo*u.value.val.pxc),1)])])]),_:1}),e(b,{color:"green-5",type:"submit",square:"",icon:"done_all","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:O.value,"onUpdate:modelValue":l[8]||(l[8]=a=>O.value=a),persistent:""},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"row items-center"},{default:t(()=>[e(H,{icon:"mood",color:"positive","text-color":"white"}),l[34]||(l[34]=s("span",{class:"q-ml-sm"},"Productos validados correctamente",-1))]),_:1}),e(d,{class:"row"},{default:t(()=>[e(P,{class:"col"},{default:t(()=>[e(b,{flat:"",icon:"print",color:"primary",onClick:l[7]||(l[7]=a=>c.value.state=!c.value.state)})]),_:1}),e(P,null,{default:t(()=>[e(b,{flat:"",label:"TERMINAR",color:"positive",onClick:se})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:X.value,"onUpdate:modelValue":l[10]||(l[10]=a=>X.value=a),persistent:""},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"row items-center"},{default:t(()=>[e(H,{icon:"sentiment_dissatisfied",color:"negative","text-color":"white"}),l[35]||(l[35]=s("span",{class:"q-ml-sm"},"Hay productos Con diferencia",-1))]),_:1}),e(d,null,{default:t(()=>[(f(!0),x($,null,F(Q.value,(a,i)=>(f(),x("div",null,r(a.codigo),1))),256))]),_:1}),e(d,{class:"row"},{default:t(()=>[e(P,{class:"col"},{default:t(()=>[e(b,{flat:"",icon:"print",color:"primary",onClick:l[9]||(l[9]=a=>c.value.state=!c.value.state)})]),_:1}),e(P,null,{default:t(()=>[e(b,{flat:"",label:"Regresar",color:"negative",onClick:ie})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:c.value.state,"onUpdate:modelValue":l[12]||(l[12]=a=>c.value.state=a)},{default:t(()=>[e(g,{class:"my-card"},{default:t(()=>[e(d,null,{default:t(()=>l[36]||(l[36]=[s("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),e(d,null,{default:t(()=>[e(j,{onSubmit:ce,class:"q-gutter-md"},{default:t(()=>[e(M,{dense:"","option-label":"name",modelValue:c.value.val,"onUpdate:modelValue":l[11]||(l[11]=a=>c.value.val=a),options:c.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),s("div",null,[e(b,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"}})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:R.value.state,"onUpdate:modelValue":l[14]||(l[14]=a=>R.value.state=a),persistent:""},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"row items-center"},{default:t(()=>[e(H,{icon:"warning",color:"warning","text-color":"black"}),l[37]||(l[37]=s("span",{class:"q-ml-sm"},"Hay Productos que no estan validados",-1))]),_:1}),e(d,null,{default:t(()=>[l[38]||(l[38]=s("div",{class:"text-bold"}," Productos No Validados ",-1)),(f(!0),x($,null,F(w.value,(a,i)=>(f(),x("div",{key:i},r(a.codigo),1))),128))]),_:1}),e(d,null,{default:t(()=>[l[39]||(l[39]=s("div",{class:"text-bold"}," Productos Con Diferencia ",-1)),(f(!0),x($,null,F(Q.value,(a,i)=>(f(),x("div",{key:i},r(a.codigo),1))),128))]),_:1}),e(d,null,{default:t(()=>[l[40]||(l[40]=s("div",{class:"text-bold"}," Productos Validados ",-1)),(f(!0),x($,null,F(_.value,(a,i)=>(f(),x("div",{key:i},r(a.codigo),1))),128))]),_:1}),e(P,{align:"right"},{default:t(()=>[e(b,{flat:"",color:"primary",icon:"print",onClick:l[13]||(l[13]=a=>c.value.state=!c.value.state)}),G(e(b,{flat:"",label:"Continuar",color:"primary"},null,512),[[Te]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),n.value.state?(f(),A(he,{key:0,reveal:"",elevated:"",bordered:"",class:"row"},{default:t(()=>[e(M,{class:"col",modelValue:C.value,"onUpdate:modelValue":[l[15]||(l[15]=a=>C.value=a),ue],options:E.value,filled:"","option-label":"codigo","use-input":"","fill-input":"","hide-selected":"","input-class":"text-white","input-debounce":"0",onFilter:de,onInputValue:re,dense:""},{before:t(()=>[e(K,{name:"fas fa-barcode",color:"white"})]),_:1},8,["modelValue","options"]),_.value.length>0?(f(),A(b,{key:0,color:"white","text-color":"primary",size:"sm",label:"Terminar",onClick:ne})):B("",!0)]),_:1})):B("",!0)]),_:1})]),_:1}))}};export{Ql as default};
