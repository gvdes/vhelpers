import{b as v,a as q,d as b,e as u}from"./QList.3a4c80c6.js";import{Q as V}from"./QCardSection.ea3ea6ae.js";import{u as R,a as E,aH as I,c as P,l as M,p as O,o as f,d as k,w as d,e,f as s,a0 as a,g as z,a3 as T,a2 as $,an as S,Q as x,a4 as F,b9 as L,ak as n,h as w}from"./index.3d27d392.js";import{Q as H}from"./QSelect.24284ad2.js";import{Q as G}from"./QInput.a304711a.js";import{Q as J}from"./QSpace.adbf19a6.js";import{Q as K}from"./QCardActions.13024e38.js";import{Q as W}from"./QCard.81ef4faa.js";import{u as X}from"./use-quasar.16e47760.js";import{o as C}from"./orderApi.0bf12524.js";import{R as g}from"./resoursesOrder.f85e8635.js";const Y={class:"row"},Z={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},tt={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},et={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},ot={class:"row"},it={class:"text-h6 col text-bold text-left"},lt={class:"text-h6 col text-bold text-right"},dt={class:"text-subtitle2 col"},st={class:"item-center row"},at={class:"row items-end"},rt={class:"text-center"},ct={class:"col q-pa-xs"},ut={class:"col column q-py-md"},nt={class:"col q-pa-xs"},wt={__name:"productView",props:{product:{type:Object,default:{}},order:{type:Object,default:{}},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]},units:{type:Array,default:[]},unit:{type:Object,default:{}}},emits:["reset","addProduct","deleteProduct"],setup(i,{emit:B}){R();const m=X();E(),I();const t=i,Q=B,_=P(()=>!t.product.pivot.amount||t.product.pivot.amount<=0),c=P(()=>t.product.pivot._supply_by==3?t.product.pivot.amount*t.product.pieces:t.product.pivot._supply_by==2?t.product.pivot.amount*12:t.product.pivot.amount),D=()=>{t.product.pivot._supply_by=t.product.units.id},A=P(()=>t.order.client._price_list<=3?[1,2,3,4]:[t.order.client._price_list]),p=P(()=>t.order.client._price_list<=3?c.value>=t.product.pieces&&(t.product.pivot._supply_by==1||t.product.pivot._supply_by==2)||t.product.pivot._supply_by==3?4:g.verificarPrecioDocena(t.products,t.product,t.rules)?3:g.verificarPrecioMayoreo(t.products,t.product,t.rules)?2:1:t.order.client._price_list),h=()=>{Q("reset")},N=async()=>{m.loading.show({message:"Editando Producto"});let r=t.product.prices.find(y=>y.id==p.value).pivot.price,o=c.value*r;t.product.pivot.toDelivered=c.value,t.product.pivot._price_list=p.value,t.product.pivot.price=r,t.product.pivot.total=o,console.log(t.product.pivot);const l=await C.editProduct(t.product.pivot);l.fail?console.log(l):(m.loading.hide(),h(),g.actualizarPreciosProductos(t.products,t.order,t.rules))},U=async()=>{m.loading.show({message:"Agregando producto"});let r=t.product.prices.find(y=>y.id==p.value).pivot.price,o=c.value*r;t.product.pivot.toDelivered=c.value,t.product.pivot._price_list=p.value,t.product.pivot.price=r,t.product.pivot.total=o,t.product.pivot._product=t.product.id,t.product.pivot._order=t.order.id,console.log(t.product.pivot);const l=await C.addProduct(t.product.pivot);l.fail?console.log(l):(Q("addProduct",t.product),m.loading.hide(),g.actualizarPreciosProductos(t.products,t.order,t.rules))},j=async()=>{m.loading.show({message:"Eliminando Producto"});const r=await C.deleteProduct(t.product.pivot);r.fail?console.log(r):(Q("deleteProduct",t.product),m.loading.hide(),g.actualizarPreciosProductos(t.products,t.order,t.rules))};return M(c,r=>{t.product.pivot.units=r},t.product.units),O(()=>{!t.product.pivot._supply_by&&t.units.length&&(t.product.pivot._supply_by=t.product.units),t.product.pivot.amount||(t.product.pivot.amount=1),t.product.pivot.units=c.value}),(r,o)=>(f(),k(W,null,{default:d(()=>[e(V,{class:"item-center"},{default:d(()=>[s("div",Y,[s("div",Z,a(i.product.category.familia.seccion.name),1),s("div",tt,a(i.product.category.familia.name),1),s("div",et,a(i.product.category.name),1)]),s("div",ot,[s("div",it,a(i.product.code),1),s("div",lt,a(i.product.name),1)]),s("div",dt,a(i.product.description),1),s("div",st,[(f(!0),z(T,null,$(i.product.prices.filter(l=>A.value.includes(l.id)),(l,y)=>(f(),z("div",{class:"col text-subtitle2 text-center",key:y},[s("div",{class:S(l.id==p.value?"text-weight-bold":"text-caption text-strike")},a(l.alias),3),e(v,{spaced:"",inset:"",vertical:"",dark:""}),s("div",{class:S(l.id==p.value?"text-bold  text-blue-13":"text-caption")},a(l.pivot.price),3),e(v,{spaced:"",inset:"",vertical:"",dark:""})]))),128))])]),_:1}),e(V,null,{default:d(()=>[s("div",at,[s("div",rt,[s("div",ct,[o[5]||(o[5]=s("div",{class:"text-bold text-h6"},"Cantidad:",-1)),e(x,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:o[0]||(o[0]=l=>i.product.pivot.amount++)}),e(v,{spaced:"",inset:"",vertical:"",dark:""}),s("div",ut,[F(s("input",{type:"number",min:"1","onUpdate:modelValue":o[1]||(o[1]=l=>i.product.pivot.amount=l),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[L,i.product.pivot.amount]])]),e(v,{spaced:"",inset:"",vertical:"",dark:""}),e(x,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:o[2]||(o[2]=l=>i.product.pivot.amount>1?i.product.pivot.amount--:"")})])]),e(v,{spaced:"",inset:"",vertical:"",dark:""}),s("div",nt,[e(H,{dense:"",filled:"",modelValue:i.product.units,"onUpdate:modelValue":[o[3]||(o[3]=l=>i.product.units=l),D],options:i.units,label:"Surtir por","option-label":"name"},null,8,["modelValue","options"]),e(v,{spaced:"",inset:"",vertical:"",dark:""}),e(G,{dense:"",filled:"",modelValue:i.product.pivot.comments,"onUpdate:modelValue":o[4]||(o[4]=l=>i.product.pivot.comments=l),type:"text",label:"Notas"},null,8,["modelValue"]),e(v,{spaced:"",inset:"",vertical:"",dark:""}),e(q,{dense:""},{default:d(()=>[e(b,{class:"bg-grey-11"},{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>o[6]||(o[6]=[n("P x C")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[n(a(i.product.pieces)+" pzs",1)]),_:1})]),_:1}),e(b,null,{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>o[7]||(o[7]=[n("Cajas")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[n(a(Number(c.value/i.product.pieces).toFixed(1)),1)]),_:1})]),_:1}),e(b,{class:"bg-grey-11"},{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>o[8]||(o[8]=[n("Unidades")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[n(a(c.value)+" pzs",1)]),_:1})]),_:1}),e(b,null,{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>o[9]||(o[9]=[n("Precio")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[n(a(i.product.prices.find(l=>l.id==p.value).pivot.price),1)]),_:1})]),_:1}),e(b,null,{default:d(()=>[e(u,{class:"text-left text-caption"},{default:d(()=>o[10]||(o[10]=[n("Total")])),_:1}),e(u,{class:"text-bold text-center"},{default:d(()=>[n(a(i.product.prices.find(l=>l.id==p.value).pivot.price*c.value),1)]),_:1})]),_:1})]),_:1})])])]),_:1}),e(K,null,{default:d(()=>[e(x,{flat:"",icon:"close",onClick:h}),e(J),i.edit?w("",!0):(f(),k(x,{key:0,flat:"",icon:"add",color:"positive",onClick:U,disable:_.value},null,8,["disable"])),i.edit?(f(),k(x,{key:1,flat:"",icon:"delete",color:"negative",onClick:j})):w("",!0),i.edit?(f(),k(x,{key:2,flat:"",icon:"edit",color:"warning",onClick:N,disable:_.value},null,8,["disable"])):w("",!0)]),_:1})]),_:1}))}};export{wt as _};
