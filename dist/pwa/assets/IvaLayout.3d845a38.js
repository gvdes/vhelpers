import{Q as B}from"./QSeparator.42e5f052.js";import{r as d,c as q,T as R,o as _,a as V,w as a,e,a3 as n,a4 as y,f as v,h as D,Q as C,i as l,ax as Y,ay as J,g as G,a1 as L,Y as W,_ as X}from"./index.7b071212.js";import{a as F,b as u,Q as P,c as U,d as Z}from"./QSelect.8e8447fb.js";import{Q as j}from"./QInput.7c14ca12.js";import{Q as O}from"./QForm.910e5650.js";import{Q as ee}from"./QToolbar.0197d4aa.js";import{Q as ae}from"./QHeader.3a714634.js";import{Q as te}from"./QDialog.70f0be3d.js";import{Q as le}from"./QPage.bad46146.js";import{Q as oe,a as se}from"./QLayout.54e0ba06.js";import{u as z}from"./VDB.b93500f3.js";import{_ as ne}from"./UserToolbar.6eebe2f1.js";import{a as M}from"./axios.f1f32898.js";import{Q as K,a as H,u as ue}from"./use-quasar.f8bd681a.js";import{Q as ie}from"./QList.a1077a8c.js";import{Q as re}from"./QCardActions.1c329128.js";import{a as de}from"./axios.ae0a941c.js";import"./use-key-composition.45c5bd4a.js";import"./uid.42677368.js";import"./position-engine.bddc6fa4.js";import"./rtl.b51694b1.js";import"./QResizeObserver.7d1b613f.js";import"./ClosePopup.e9e8b96c.js";const ce={__name:"Ticket",props:{data:{type:Object,default:null}},emits:["openCashDesk"],setup(S,{emit:Q}){const m=S,T=z(),t=d(m.data),c=d(null),i=["6%","8%","16%"],b={"6%":.06,"8%":.08,"16%":.16},g=d({body:null,val:null}),k=d(m.data.total),o=q(()=>{if(c.value&&t.value){let $=b[c.value],r=parseFloat(k.value).toFixed(2);return parseFloat((r*$).toFixed(2))}return 0}),s=q(()=>k.value>m.data.total),A=()=>{Q("openCashDesk",{_inc:o.value,_iva:b[c.value],impresora:g.value.val.ip_address,_monto:k.value}),console.log(k.value)};return R(()=>{console.log("El componente ha muerto!!")}),(async()=>{let $=T.session.store.id;console.log($);try{let r=await de.get(`/cashier/getPrinters/${$}`);r.status==200&&(g.value.body=r.data,console.log("Impresoras listas :)"))}catch(r){console.log(r),$q.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}})(),($,r)=>(_(),V(K,{style:{"min-width":"400px"},flat:"",bordered:""},{default:a(()=>[e(ie,{bordered:""},{default:a(()=>[e(F,null,{default:a(()=>[e(u,null,{default:a(()=>[n("Ticket")]),_:1}),e(u,null,{default:a(()=>[n(y(t.value.ticket),1)]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(u,null,{default:a(()=>[n("Cliente")]),_:1}),e(u,null,{default:a(()=>[n(y(t.value.cliente),1)]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(u,null,{default:a(()=>[n("Fecha")]),_:1}),e(u,null,{default:a(()=>[n(y(t.value.fecha),1)]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(u,null,{default:a(()=>[n("Total")]),_:1}),e(u,null,{default:a(()=>[n("$ "+y(t.value.total),1)]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(u,null,{default:a(()=>[n("Impresora")]),_:1}),e(u,null,{default:a(()=>[e(P,{dense:"",modelValue:g.value.val,"onUpdate:modelValue":r[0]||(r[0]=p=>g.value.val=p),options:g.value.body,label:"Impresora","option-label":"name",filled:"",autofocus:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(B),e(F,null,{default:a(()=>[e(u,null,{default:a(()=>[n("Monto")]),_:1}),e(u,null,{default:a(()=>[e(j,{dense:"",modelValue:k.value,"onUpdate:modelValue":r[1]||(r[1]=p=>k.value=p),type:"number",label:"Monto",filled:"",autofocus:"","error-message":"El Monto a facturar es mayor que el total de el ticket :x",error:v(s)},null,8,["modelValue","error"])]),_:1})]),_:1}),e(B),g.value.val&&!v(s)?(_(),V(F,{key:0,class:"bg-deep-purple-1"},{default:a(()=>[e(u,null,{default:a(()=>[n("IVA")]),_:1}),e(u,null,{default:a(()=>[e(P,{dense:"",modelValue:c.value,"onUpdate:modelValue":r[2]||(r[2]=p=>c.value=p),options:i,label:"Seleccione",filled:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})):D("",!0),v(o)&&!v(s)?(_(),V(F,{key:1,class:"bg-deep-purple-1"},{default:a(()=>[e(u,null,{default:a(()=>[n("Total")]),_:1}),e(u,null,{default:a(()=>[e(U,{class:"fc-bluegrey text-h4 fw-sbold"},{default:a(()=>[n("$ "+y(v(o)),1)]),_:1}),e(U,{caption:""},{default:a(()=>[n("$ "+y((parseFloat(t.value.total)+parseFloat(v(o))).toFixed(2)),1)]),_:1})]),_:1})]),_:1})):D("",!0)]),_:1}),c.value&&!v(s)?(_(),V(re,{key:0,align:"between"},{default:a(()=>[e(C,{color:"primary",label:"Cancelar",flat:"","no-caps":""}),e(C,{color:"primary",label:"Cobrar",onClick:A})]),_:1})):D("",!0)]),_:1}))}},pe={class:"bg-primary row items-center justify-between q-pa-md text-white"},me=l("div",{class:"fs-dec3"},"TICKET",-1),fe={class:"text-h4"},ve={class:"text-right"},_e=l("div",{class:"fs-dec3"},"IVA",-1),ye={class:"fw-bold text-h4"},be={class:"row items-center"},ge=l("div",{class:"col-3"},"Efectivo",-1),he={class:"row"},ke={class:"bg-grey-2 row items-stretch justify-between q-pa-sm"},Ve=l("div",{class:"fs-dec1"},"Cambio:",-1),Qe={class:"text-h5 fw-sbold fc-primary"},xe=l("div",{class:"fs-dec1"},"Falta:",-1),Fe={class:"text-h6 fs-inc3 fw-bold fc-negative"},De={__name:"CashDesk",props:{data:{type:Object,default:null},inc:{type:Number,default:0}},emits:["pay"],setup(S,{emit:Q}){const m=S,T=[{id:"TBA",desc:"Tarjeta Credito/Debito BBVA (Bancomer)"},{id:"TDB",desc:"Transferencia/Deposito BBVA (Bancomer)"},{id:"TSA",desc:"Tarjeta Credito/Debito Santander"},{id:"TDA",desc:"Transferencia/Deposito Santander"},{id:"TSC",desc:"Tarjeta Credito/Debito Scotiabank"},{id:"TDS",desc:"Transferencia/Deposito Scotiabank"}],t=d({EFE:0,DIG:{id:null,val:0}}),c=d(m.data),i=d(m.inc),b=q(()=>(parseFloat(t.value.EFE)+parseFloat(t.value.DIG.val)).toFixed(2)),g=()=>{Q("pay",t.value)};return(k,o)=>c.value?(_(),V(K,{key:0},{default:a(()=>[l("div",pe,[l("div",null,[me,l("div",fe,y(c.value.ticket),1)]),l("div",ve,[_e,l("div",ye,"$ "+y(i.value),1)])]),e(O,{class:"q-pa-none",onSubmit:g},{default:a(()=>[e(H,null,{default:a(()=>[l("div",be,[ge,e(j,{class:"col",modelValue:t.value.EFE,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.EFE=s),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue","min"]),parseFloat(t.value.EFE)?(_(),V(C,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:o[1]||(o[1]=s=>t.value.EFE=0)})):D("",!0)])]),_:1}),e(H,null,{default:a(()=>[l("div",he,[e(P,{class:"col-3",modelValue:t.value.DIG.id,"onUpdate:modelValue":o[2]||(o[2]=s=>t.value.DIG.id=s),options:T,label:"Terminal","option-value":"id","emit-value":"","option-label":"id",dense:""},{option:a(s=>[e(F,Y(J(s.itemProps)),{default:a(()=>[e(u,null,{default:a(()=>[e(U,{class:"text-bold"},{default:a(()=>[n(y(s.opt.id),1)]),_:2},1024),e(U,{caption:""},{default:a(()=>[n(y(s.opt.desc),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),e(j,{class:"col",modelValue:t.value.DIG.val,"onUpdate:modelValue":o[3]||(o[3]=s=>t.value.DIG.val=s),type:"number",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue","min"]),parseFloat(t.value.DIG.val)?(_(),V(C,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:o[4]||(o[4]=s=>{t.value.DIG.val=0,t.value.DIG.id=null})})):D("",!0)])]),_:1}),e(B),l("div",ke,[l("div",null,[v(b)>=i.value?(_(),G(L,{key:0},[Ve,l("div",Qe,"$ "+y((v(b)-i.value).toFixed(2)),1)],64)):(_(),G(L,{key:1},[xe,l("div",Fe,"$ "+y((i.value-v(b)).toFixed(2)),1)],64))]),l("div",null,[v(b)>=i.value?(_(),V(C,{key:0,color:"positive",icon:"fas fa-dollar-sign",label:"Pagar",type:"submit",class:"full-height"})):D("",!0)])])]),_:1})]),_:1})):D("",!0)}};const $e=l("span",{class:"text-h6"},"IVA",-1),Ce=l("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Folio",-1),Ie={key:0,class:"text-right"},we={class:"row justify-center"},ea={__name:"IvaLayout",setup(S){const Q=z(),m=ue(),T=Q.series,t=d(null),c=d(""),i=d(null),b=d(0),g=d(0),k=d(0),o=d({state:!1}),s=d(null),A=q(()=>t.value&&c.value.length),N=async()=>{i.value=null,b.value=0;let p=t.value,f=c.value,I=`http://${Q.session.store.ip}/access/public/iva/ticket?serie=${p}&folio=${f}`;M.get(I).then(x=>{i.value=x.data}).catch(x=>{console.log(x);let w=x.response.status,E=x.response.data;console.log(w),console.log(E),m.notify({html:!0,message:E.message,color:"negative",position:"center"})})},$=({_inc:p,_iva:f,impresora:h,_monto:I})=>{console.log(p,f,h,I),s.value=h,b.value=parseFloat(p),g.value=parseFloat(f),k.value=parseFloat(I),o.value.state=!0},r=p=>{console.log("pagando..."),console.log(p);let f=Q.session.store.ip,h=`${Q.session.name} - ${Q.session.store.alias}`,I=`http://${f}/access/public/iva/create`,x={modes:p,by:h,ticket:i.value.ticket,iva:g.value,monto:k.value,impresora:s.value};console.log(x),m.loading.show({message:"Imprimiendo..."}),console.log(x),M.post(I,x).then(w=>{console.log(w.data);let E=w.data;m.loading.hide(),o.value.state=!1,i.iva=null,i.value=null,m.notify({html:!0,color:"positive",position:"center",message:`<span class="fs-inc2"> El ticket <b>${E.ticket}</b> fue generado! </span>`}),E.printed||m.notify({html:!0,color:"negative",position:"top",icon:"fas fa-bugs",message:'<span class="fs-inc2"> No se pudo emitir el ticket, la conexion a la impresora no esta disponible! </span>'})}).catch(w=>{console.log(w),m.loading.hide()})};return(p,f)=>(_(),V(oe,{view:"hHh Lpr fFf"},{default:a(()=>[e(ae,{class:"transparent text-dark",bordered:""},{default:a(()=>[e(ne),e(B),e(ee,{class:"justify-between"},{default:a(()=>[l("div",null,[n("Helpers "),e(W,{name:"navigate_next",color:"primary"}),n(),$e]),e(C,{color:"primary",icon:"add"},{default:a(()=>[e(Z,null,{default:a(()=>[Ce,e(B),e(O,{dense:"",onSubmit:N,class:"q-gutter-md q-pa-md"},{default:a(()=>[e(P,{modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=h=>t.value=h),options:v(T),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(j,{modelValue:c.value,"onUpdate:modelValue":f[1]||(f[1]=h=>c.value=h),type:"number",label:"Folio"},null,8,["modelValue"]),v(A)?(_(),G("div",Ie,[e(C,{type:"submit",color:"primary",icon:"search"})])):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(se,null,{default:a(()=>[e(le,{class:"bg-grey-3",padding:""},{default:a(()=>[l("div",we,[e(X,{name:"bounce"},{default:a(()=>[i.value?(_(),V(ce,{key:0,data:i.value,onOpenCashDesk:$},null,8,["data"])):D("",!0)]),_:1})]),e(te,{modelValue:o.value.state,"onUpdate:modelValue":f[2]||(f[2]=h=>o.value.state=h)},{default:a(()=>[e(De,{data:i.value,inc:b.value,onPay:r},null,8,["data","inc"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{ea as default};
