import{u as ge,r as d,c as W,l as be,o as r,d as N,w as n,e as o,Q as m,h as U,g as b,a3 as he,a2 as ke,f as T,ak as z,a0 as we,a4 as q}from"./index.bc0eb9a1.js";import{b as Q,Q as G}from"./QList.a19bb87f.js";import{Q as D}from"./QSelect.a03eb59e.js";import{Q as h}from"./axios.2c32c9c8.js";import{Q as $}from"./QCard.dad79872.js";import{Q as F}from"./QTable.8c42464b.js";import{Q as H}from"./QCardActions.1ac661af.js";import{Q as Ce}from"./QPage.d5bf47de.js";import{C as J}from"./ClosePopup.6672bf91.js";import"./QDrawer.b1ecc906.js";import{u as ye}from"./use-quasar.01540b96.js";import{u as Ve}from"./warehousStore.3102428c.js";import"./QInput.57e297bb.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.9a34191b.js";import{E as ee}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as B}from"./locationsApi.c165008c.js";import"./QLinearProgress.86f77f0e.js";import"./QCheckbox.5c38f179.js";import"./QResizeObserver.04982bfd.js";import"./QScrollObserver.b6de992b.js";import"./_commonjsHelpers.88e99c8f.js";const xe={key:0},_e={key:1},Ee={key:0},Se={key:0,class:"row"},Ue={key:1},Qe={key:0},De={class:"text-left"},Ae={key:2},tl={__name:"massive",setup(Be){const O=ge(),p=ye();Ve().setTitle("Acciones Masivas");const M=d([]),t=d({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),I=d(null),K=d(null),X=d(null),le=d([]),A=d([]),ae=d(0),L=d(null),V=d({val:[],status:!1}),x=d({val:[],status:!1}),k=d({val:null,types:[{id:1,label:"CREAR"},{id:2,label:"ELIMINAR"}]}),_=d({val:null,opts:[{id:1,label:"CATEGORIAS"},{id:2,label:"UBICACION"},{id:3,label:"EXCEL"}]}),w=d({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),Y=d({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"locations",label:"Ubicacion",field:l=>l.locations.map(e=>e.path).join("/"),align:"left"}]}),oe=W(()=>t.value.all.filter(l=>l.deep==0)),te=W(()=>t.value.seccion.val.length>0?t.value.all.filter(l=>l.deep==1&&t.value.seccion.val.map(e=>e.id).includes(l.root)):t.value.all.filter(l=>l.deep==1)),se=W(()=>{if(t.value.seccion.val.length>0&&t.value.familias.val.length==0){let l=t.value.all.filter(e=>e.deep==1&&t.value.seccion.val.map(a=>a.id).includes(e.root)).map(e=>e.id);return t.value.all.filter(e=>e.deep==2&&l.includes(e.root))}else return t.value.familias.val.length>0?t.value.all.filter(l=>l.deep==2&&t.value.familias.val.map(e=>e.id).includes(l.root)):t.value.all.filter(l=>l.deep==2)}),ie=async()=>{p.loading.show({message:"Obteniendo Secciones"});const l=await B.getInit(O.session.store.id);l.fail?console.log(l):(console.log(l),M.value=l.celler,t.value.all=l.categories),p.loading.hide()},ne=()=>{const l=I.value.sections||[];ae.value=Math.max(...l.map(e=>e.deep)),A.value=[{options:l.filter(e=>e.root===0),selected:null}],le.value=A.value[0].options},Z=l=>{var e;return((e=I.value.sections)==null?void 0:e.filter(a=>a.root===l))||[]},ue=(l,e)=>{A.value.splice(e+1);const a=Z(l);a.length>0&&A.value.push({options:a,selected:null})},ce=async()=>{p.loading.show({message:"Obeniendo Productos"});let l={workpoint:O.session.store.id_viz,section:L.value.selected};const e=await B.obtProduct(l);e.fail?console.log(e):(console.log(e),V.value.status=!0,V.value.val=e,p.loading.hide())},de=async()=>{p.loading.show({message:"Eliminando Ubicaciones"});let l={products:V.value.val.map(a=>a.id),section:L.value.selected};console.log(l);const e=await B.deleteSectionProducts(l);e.fail?console.log(e):(console.log(e),V.value={val:[],status:!1},p.loading.hide())},re=async()=>{var a,u,c;p.loading.show({message:"El reporte puede tardar unos minutos"});let l={workpoint:O.session.store.id_viz,sections:(a=t.value.seccion.val)==null?void 0:a.map(i=>i.id),familys:(u=t.value.familias.val)==null?void 0:u.map(i=>i.id),categories:(c=t.value.categories.val)==null?void 0:c.map(i=>i.id)};console.log(l);const e=await B.obtProductCategories(l);e.fail?console.log(e):(p.loading.hide(),console.log(e),x.value.status=!0,x.value.val=e)},pe=async()=>{p.loading.show({message:"Eliminando Ubicaciones"});let l={products:x.value.val.map(a=>({product:a.id,locations:a.locations.map(u=>u.id)}))};const e=await B.deleteCategoriesLocations(l);e.fail?console.log(e):(console.log(e),console.log(e),x.value={val:[],status:!1},p.loading.hide())},ve=()=>{let l=document.getElementById("refCreate").files[0],e=new ee.Workbook,a={};p.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async u=>{let c=e.worksheets[0],i=c.getColumn("A");c.getColumn("B"),i.eachCell({includeEmpty:!0},function(E,R){if(R===1)return;let C=E.value,P=c.getCell(`B${R}`).value;!C||(a[C]||(a[C]=[]),a[C].includes(P)||a[C].push(P||cantidad))});let f=Object.keys(a).map(E=>({_product:E,_location:a[E],_workpoint:O.session.store.id_viz}));const v=await B.addMassiveLocation(f);v.fail?console.log(v):(console.log(v),w.value.state=!0,w.value.val=v,p.loading.hide())})},me=()=>{},fe=async()=>{const l=new ee.Workbook;M.value.forEach((c,i)=>{var P;const f=l.addWorksheet(`${c.name}_${i}`),v=c.sections||[],E=Math.max(...v.map(s=>s.deep||1)),R=[];for(let s=0;s<=E;s++)R.push(`NOMBRE_${s}`,`PATH_${s}`,`ID_${s}`);f.addRow(R);const C=(s,S)=>{const g=Array(E*3).fill("");for(let y=0;y<S.length;y++)g[y]=S[y];g[s.deep*3]=s.name,g[s.deep*3+1]=s.path,g[s.deep*3+2]=s.id,f.addRow(g),v.filter(y=>y.root===s.id).forEach(y=>C(y,g))};v.filter(s=>s.deep===0).forEach(s=>C(s,[s.name,s.path,s.path])),(P=f.columns)==null||P.forEach(s=>{let S=0;s.eachCell({includeEmpty:!0},g=>{const j=g.value?g.value.toString().length:10;j>S&&(S=j)}),s.width=S<10?10:S})});const e=await l.xlsx.writeBuffer(),a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=document.createElement("a");u.href=URL.createObjectURL(a),u.download="almacenes.xlsx",document.body.appendChild(u),u.click(),document.body.removeChild(u)};return ie(),be(A,l=>{const e=l.filter(a=>a.selected!==null);if(e.length){const a=e[e.length-1];Z(a.selected),L.value=a}},{deep:!0}),(l,e)=>(r(),N(Ce,{padding:""},{default:n(()=>[o($,{class:"my-card"},{default:n(()=>[o(h,{class:"row"},{default:n(()=>{var a,u;return[o(m,{icon:"download",flat:"",onClick:fe,title:"descargar Estructura"}),o(Q,{spaced:"",inset:"",vertical:"",dark:""}),o(D,{dense:"",class:"col",modelValue:k.value.val,"onUpdate:modelValue":e[0]||(e[0]=c=>k.value.val=c),options:k.value.types,label:"Tipo",filled:""},null,8,["modelValue","options"]),((a=k.value.val)==null?void 0:a.id)==2?(r(),N(Q,{key:0,spaced:"",inset:"",vertical:"",dark:""})):U("",!0),((u=k.value.val)==null?void 0:u.id)==2?(r(),N(D,{key:1,dense:"",class:"col",modelValue:_.value.val,"onUpdate:modelValue":e[1]||(e[1]=c=>_.value.val=c),options:_.value.opts,label:"MEDIO",filled:""},null,8,["modelValue","options"])):U("",!0)]}),_:1}),k.value.val?(r(),N(h,{key:0},{default:n(()=>{var a,u,c;return[k.value.val.id==1?(r(),b("div",xe,[o(m,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[2]||(e[2]=()=>K.value.click())})])):k.value.val.id==2?(r(),b("div",_e,[_.value.val?(r(),b("div",Ee,[((a=_.value.val)==null?void 0:a.id)==1?(r(),b("div",Se,[o(D,{class:"col",modelValue:t.value.seccion.val,"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.seccion.val=i),options:oe.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(Q,{spaced:"",inset:"",vertical:"",dark:""}),o(D,{class:"col",modelValue:t.value.familias.val,"onUpdate:modelValue":e[4]||(e[4]=i=>t.value.familias.val=i),options:te.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:t.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(Q,{spaced:"",inset:"",vertical:"",dark:""}),o(D,{class:"col",modelValue:t.value.categories.val,"onUpdate:modelValue":e[5]||(e[5]=i=>t.value.categories.val=i),options:se.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:t.value.seccion.val.length==0||t.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(Q,{spaced:"",inset:"",vertical:"",dark:""}),o(m,{color:"primary",label:t.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:re},null,8,["label"])])):((u=_.value.val)==null?void 0:u.id)==2?(r(),b("div",Ue,[M.value.length>0?(r(),b("div",Qe,[o(D,{modelValue:I.value,"onUpdate:modelValue":[e[6]||(e[6]=i=>I.value=i),ne],options:M.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),o(Q,{spaced:"",inset:"",vertical:"",dark:""}),(r(!0),b(he,null,ke(A.value,(i,f)=>(r(),b("div",{key:f},[T("div",null,[o(D,{modelValue:i.selected,"onUpdate:modelValue":[v=>i.selected=v,v=>ue(v,f)],options:i.options,label:`Nivel ${f+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(Q,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):U("",!0),T("div",De,[o(m,{icon:"delete",flat:"",onClick:ce,disable:!I.value},null,8,["disable"])])])):((c=_.value.val)==null?void 0:c.id)==3?(r(),b("div",Ae,[o(m,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[7]||(e[7]=()=>X.value.click())})])):U("",!0)])):U("",!0)])):U("",!0)]}),_:1})):U("",!0)]),_:1}),o(G,{modelValue:V.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>V.value.status=a),persistent:""},{default:n(()=>[o($,null,{default:n(()=>[o(h,{class:"row items-center"},{default:n(()=>[z(" Vaciar Seccion "+we(L.value.options.find(a=>a.id==L.value.selected).name),1)]),_:1}),o(h,null,{default:n(()=>[o(F,{title:"Productos",rows:V.value.val,columns:Y.value.columns},null,8,["rows","columns"])]),_:1}),o(H,{align:"right"},{default:n(()=>[q(o(m,{flat:"",label:"Cancel",color:"primary"},null,512),[[J]]),o(m,{flat:"",label:"Vaciar Seccion",color:"negative",onClick:de})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(G,{modelValue:x.value.status,"onUpdate:modelValue":e[9]||(e[9]=a=>x.value.status=a),persistent:""},{default:n(()=>[o($,null,{default:n(()=>[o(h,{class:"row items-center"},{default:n(()=>e[11]||(e[11]=[z(" Eliminar Ubicaciones de los Articulos ")])),_:1}),o(h,null,{default:n(()=>[o(F,{title:"Productos",rows:x.value.val,columns:Y.value.columns},null,8,["rows","columns"])]),_:1}),o(H,{align:"right"},{default:n(()=>[q(o(m,{flat:"",label:"Cancel",color:"primary"},null,512),[[J]]),o(m,{flat:"",label:"Eliminar Ubicacion",color:"negative",onClick:pe})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(G,{modelValue:w.value.state,"onUpdate:modelValue":e[10]||(e[10]=a=>w.value.state=a),persistent:""},{default:n(()=>[o($,null,{default:n(()=>[o(h,{class:"text-bold text-center text-h6"},{default:n(()=>e[12]||(e[12]=[z(" Resultados de Importacion ")])),_:1}),o(h,null,{default:n(()=>[o(F,{rows:w.value.val.goals,columns:w.value.table.columns},null,8,["rows","columns"])]),_:1}),o(h,null,{default:n(()=>[o(F,{rows:w.value.val.fails,columns:w.value.table.columns},null,8,["rows","columns"])]),_:1}),o(H,{align:"right"},{default:n(()=>[q(o(m,{flat:"",label:"OK",color:"primary"},null,512),[[J]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),T("input",{type:"file",ref_key:"refCreate",ref:K,id:"refCreate",onInput:ve,hidden:"",accept:".xlsx,.xls"},null,544),T("input",{type:"file",ref_key:"refDelete",ref:X,id:"refDelete",onInput:me,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}))}};export{tl as default};
