import{W as wt}from"./checkLavelsLYT.e10f78d1.js";import"./QList.e0cc3bc3.js";import"./index.09af7193.js";import"./axios.ddc1a609.js";import"./QHeader.051893e2.js";import"./QResizeObserver.883f0a4a.js";import"./QPage.a87fed57.js";import"./QLayout.0acbcd18.js";import"./QScrollObserver.72b9aff9.js";import"./UserToolbar.cf12ae57.js";import"./QSelect.e052bac6.js";import"./QDrawer.3bf2178f.js";import"./QCardActions.696a6efd.js";import"./ClosePopup.3b988c0d.js";import"./auth.6053ff60.js";import"./use-quasar.c0b86ba4.js";import"./QInput.18df3448.js";/* empty css                                                                         */import"./exceljs.min.9e24d01d.js";import"./_commonjsHelpers.88e99c8f.js";import"./browser.eff7c919.js";import"./jspdf.plugin.autotable.fe42230b.js";import"./dayjs.min.cbcf888d.js";/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.4.21
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */var He,se,ue;typeof SuppressedError=="function"&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(He||(He={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(se||(se={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12",e[e.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(ue||(ue={}));const Ce=typeof self=="undefined",je=(()=>{if(!Ce&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let i=e.indexOf("#");i!=-1&&(e=e.substring(0,i))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),Tt=e=>{if(e==null&&(e="./"),!Ce){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},Re=e=>typeof e=="number"&&!Number.isNaN(e),ft=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),yt=e=>!!ft(e)&&e.bytes instanceof Uint8Array&&!!Re(e.width)&&!(e.width<=0)&&!!Re(e.height)&&!(e.height<=0)&&!!Re(e.stride)&&!(e.stride<=0)&&"format"in e&&!("tag"in e&&!Ft(e.tag)),Ft=e=>!!ft(e)&&!!Re(e.imageId)&&"type"in e;async function We(e,t){return await new Promise((i,s)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType=t,r.send(),r.onloadend=async()=>{r.status<200||r.status>=300?s(e+" "+r.status):i(r.response)},r.onerror=()=>{s(new Error("Network Error: "+r.statusText))}})}const _e=(e,t)=>{let i=e.split("."),s=t.split(".");for(let r=0;r<i.length&&r<s.length;++r){let n=i[r],a=s[r];if(n===a)continue;let o=parseInt(i[r]),E=parseInt(s[r]);return o===E||Number.isNaN(o)&&Number.isNaN(E)?n<a?-1:1:o<E||Number.isNaN(o)&&Number.isInteger(E)?-1:1}return i.length===s.length?0:i.length<s.length?-1:1},Te=(e,t)=>{const i={};for(let s in t){const r=s;let n=e[r];n&&typeof n!="string"&&n.path&&(n=n.path),e.rootDirectory&&!e.rootDirectory.endsWith("/")&&(e.rootDirectory=e.rootDirectory+"/"),n===void 0?e.rootDirectory?n=`${e.rootDirectory}${Ut[r]}@${t[r].version}/dist/`:(n=t[r].path,n||(n=t[r])):n.startsWith("@engineRootDirectory/")&&(n=n.replace("@engineRootDirectory/",e.rootDirectory)),i[r]=Tt(n)}return i},Ut={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcpd:"dynamsoft-code-parser",dlrData:"dynamsoft-label-recognizer-data",dce:"dynamsoft-camera-enhancer"},Ye=e=>e&&typeof e=="object"&&typeof e.then=="function";class ye extends Promise{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let i;this._task=t,Ye(t)?i=t:typeof t=="function"&&(i=new Promise(t)),i&&(async()=>{try{const s=await i;t===this._task&&this.resolve(s)}catch(s){t===this._task&&this.reject(s)}})()}get isEmpty(){return this._task==null}constructor(t){let i,s;super((r,n)=>{i=r,s=n}),this._s="pending",this.resolve=r=>{this.isPending&&(Ye(r)?this.task=r:(this._s="fulfilled",i(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",s(r))},this.task=t}}let ne,X,le,fe,P;typeof navigator!="undefined"&&(ne=navigator,X=ne.userAgent,le=ne.platform,fe=ne.mediaDevices),function(){if(!Ce){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:ne.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:le,search:"Win"},Mac:{str:le},Linux:{str:le}};let i="unknownBrowser",s=0,r="unknownOS";for(let n in e){const a=e[n]||{};let o=a.str||X,E=a.search||n,I=a.verStr||X,l=a.verSearch||n;if(l instanceof Array||(l=[l]),o.indexOf(E)!=-1){i=n;for(let f of l){let S=I.indexOf(f);if(S!=-1){s=parseFloat(I.substring(S+f.length+1));break}}break}}for(let n in t){const a=t[n]||{};let o=a.str||X,E=a.search||n;if(o.indexOf(E)!=-1){r=n;break}}r=="Linux"&&X.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),P={browser:i,version:s,OS:r}}Ce&&(P={browser:"ssr",version:0,OS:"ssr"})}();const Pt=typeof WebAssembly!="undefined"&&X&&!(/Safari/.test(X)&&!/Chrome/.test(X)&&/\(.+\s11_2_([2-6]).*\)/.test(X)),kt=typeof Worker!="undefined",gt=!(!fe||!fe.getUserMedia),bt=async()=>{let e=!1;if(gt)try{(await fe.getUserMedia({video:!0})).getTracks().forEach(t=>{t.stop()}),e=!0}catch{}return e};P.browser==="Chrome"&&P.version>66||P.browser==="Safari"&&P.version>13||P.browser==="OPR"&&P.version>43||P.browser==="Edge"&&P.version;const Z={},Be=async e=>{let t=typeof e=="string"?[e]:e,i=[];for(let s of t)i.push(Z[s]=Z[s]||new ye);await Promise.all(i)},Fe=async(e,t)=>{let i,s=typeof e=="string"?[e]:e,r=[];for(let n of s){let a;r.push(a=Z[n]=Z[n]||new ye(i=i||t())),a.isEmpty&&(a.task=i=i||t())}await Promise.all(r)};let u,ht=0;const A=()=>ht++,C={};let $;const Gt=e=>{$=e,u&&u.postMessage({type:"setBLog",body:{value:!!e}})};let Ue=!1;const Vt=e=>{Ue=e,u&&u.postMessage({type:"setBDebug",body:{value:!!e}})},q={},k={},m={std:{version:"1.4.10",path:Tt(je+"../../dynamsoft-capture-vision-std@1.4.10/dist/")},core:{version:"3.4.21",path:je}},ie={dip:{wasm:!0}},we={},Y=async e=>{let t;e instanceof Array||(e=e?[e]:[]);let i=Z.core;t=!i||i.isEmpty;let s=new Map;const r=o=>{if((o=o.toLowerCase())=="std"||o=="core")return;if(!ie[o])throw Error("The '"+o+"' module cannot be found.");let E=ie[o].deps;if(E!=null&&E.length)for(let l of E)r(l);let I=Z[o];s.has(o)||s.set(o,!I||I.isEmpty)};for(let o of e)r(o);let n=[];t&&n.push("core"),n.push(...s.keys());const a=[...s.entries()].filter(o=>!o[1]).map(o=>o[0]);await Fe(n,async()=>{const o=[...s.entries()].filter(R=>R[1]).map(R=>R[0]);await Be(a);const E=Te(we,m),I={};for(let R of o)I[R]=ie[R];const l={engineResourcePaths:E,autoResources:I,names:o};let f=new ye;if(t){l.needLoadCore=!0;let R=E.core+B._workerName;R.startsWith(location.origin)||(R=await fetch(R).then(_=>_.blob()).then(_=>URL.createObjectURL(_))),u=new Worker(R),u.onerror=_=>{let g=new Error(_.message);f.reject(g)},u.addEventListener("message",_=>{let g=_.data?_.data:_,D=g.type,O=g.id,U=g.body;switch(D){case"log":$&&$(g.message);break;case"task":try{C[O](U),delete C[O]}catch(N){throw delete C[O],N}break;case"event":try{C[O](U)}catch(N){throw N}break;default:console.log(_)}}),l.bLog=!!$,l.bd=Ue,l.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await Be("core");let S=ht++;C[S]=R=>{if(R.success)Object.assign(q,R.versions),JSON.stringify(R.versions)!=="{}"&&(B._versions=R.versions),f.resolve(void 0);else{const _=Error(R.message);R.stack&&(_.stack=R.stack),f.reject(_)}},u.postMessage({type:"loadWasm",body:l,id:S}),await f})};class B{static get engineResourcePaths(){return we}static set engineResourcePaths(t){Object.assign(we,t)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return $}static set _onLog(t){Gt(t)}static get _bDebug(){return Ue}static set _bDebug(t){Vt(t)}static isModuleLoaded(t){return t=(t=t||"core").toLowerCase(),!!Z[t]&&Z[t].isFulfilled}static async loadWasm(t){return await Y(t)}static async detectEnvironment(){return await(async()=>({wasm:Pt,worker:kt,getUserMedia:gt,camera:await bt(),browser:P.browser,version:P.version,OS:P.OS}))()}static async getModuleVersion(){return await new Promise((t,i)=>{let s=A();C[s]=async r=>{if(r.success)return t(r.versions);{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,i(n)}},u.postMessage({type:"getModuleVersion",id:s})})}static getVersion(){const t=q.core&&q.core.worker,i=q.core&&q.core.wasm;return`3.4.21(Worker: ${t||"Not Loaded"}, Wasm: ${i||"Not Loaded"})`}static enableLogging(){B._onLog=console.log}static disableLogging(){B._onLog=null}static async cfd(t){return await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i();{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cfd",id:r,body:{count:t}})})}}var p,Xe,Ze,ze,Qe,$e,Je,Ke;B._bSupportDce4Module=-1,B._bSupportIRTModule=-1,B._versions=null,B._workerName="core.worker.js",B.browserInfo=P,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(p||(p={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(Xe||(Xe={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",e[e.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",e[e.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",e[e.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",e[e.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",e[e.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",e[e.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",e[e.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",e[e.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",e[e.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",e[e.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",e[e.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",e[e.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",e[e.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",e[e.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",e[e.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",e[e.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",e[e.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",e[e.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",e[e.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",e[e.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",e[e.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",e[e.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",e[e.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",e[e.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",e[e.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",e[e.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",e[e.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",e[e.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",e[e.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",e[e.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",e[e.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID",e[e.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",e[e.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",e[e.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",e[e.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",e[e.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(Ze||(Ze={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV"}(ze||(ze={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV"}(Qe||(Qe={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}($e||($e={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(Je||(Je={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(Ke||(Ke={}));BigInt(0),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(1<<17),BigInt(1<<18),BigInt(1<<19),BigInt(1<<20),BigInt(1<<21),BigInt(1<<22),BigInt(1<<23),BigInt(1<<24),BigInt(1<<25),BigInt(1<<26),BigInt(1<<27),BigInt(1<<28),BigInt("0xFFFFFFFFFFFFFFFF");var qe,et;(function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"})(qe||(qe={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(et||(et={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.4.22"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/capture-vision-router/capture-vision-router-module.html
 */function c(e,t,i,s){if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?s:i==="a"?s.call(e):s?s.value:t.get(e)}function w(e,t,i,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(e,i):r?r.value=i:t.set(e,i),i}const tt=e=>e&&typeof e=="object"&&typeof e.then=="function";class Ee extends Promise{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){this._task=t;let i;tt(t)?i=t:typeof t=="function"&&(i=new Promise(t)),i&&(async()=>{try{const s=await i;t===this._task&&this.resolve(s)}catch(s){t===this._task&&this.reject(s)}})()}get isEmpty(){return this._task==null}constructor(t){let i,s;const r=(n,a)=>{i=n,s=a};super(r),this._s="pending",this.resolve=n=>{this.isPending&&(tt(n)?this.task=n:(this._s="fulfilled",i(n)))},this.reject=n=>{this.isPending&&(this._s="rejected",s(n))},this.task=t}}class xt{constructor(t){this._cvr=t}async getMaxBufferedItems(){return await new Promise((t,i)=>{let s=A();C[s]=async r=>{if(r.success)return t(r.count);{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,i(n)}},u.postMessage({type:"cvr_getMaxBufferedItems",id:s,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(t){return await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i();{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_setMaxBufferedItems",id:r,instanceID:this._cvr._instanceID,body:{count:t}})})}async getBufferedCharacterItemSet(){return await new Promise((t,i)=>{let s=A();C[s]=async r=>{if(r.success)return t(r.itemSet);{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,i(n)}},u.postMessage({type:"cvr_getBufferedCharacterItemSet",id:s,instanceID:this._cvr._instanceID})})}}var Ht={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const st=e=>{for(let t in e._irrRegistryState)e._irrRegistryState[t]=!1;for(let t of e._intermediateResultReceiverSet){if(t.isDce||t.isFilter){e._irrRegistryState.onTaskResultsReceivedForDce=!0;continue}for(let i in t)e._irrRegistryState[i]||(e._irrRegistryState[i]=!!t[i])}};class jt{constructor(t){this._irrRegistryState=Ht,this._intermediateResultReceiverSet=new Set,this._cvr=t}async addResultReceiver(t){if(typeof t!="object")throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(t),st(this);let i=-1,s={};if(!t.isDce&&!t.isFilter){if(!t._observedResultUnitTypes||!t._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");i=t._observedResultUnitTypes,t._observedTaskMap.forEach((r,n)=>{s[n]=r}),t._observedTaskMap.clear()}return await new Promise((r,n)=>{let a=A();C[a]=async o=>{if(o.success)return r();{let E=new Error(o.message);return E.stack=o.stack+`
`+E.stack,n(E)}},u.postMessage({type:"cvr_setIrrRegistry",id:a,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:i.toString(),observedTaskMap:s}})})}async removeResultReceiver(t){return this._intermediateResultReceiverSet.delete(t),st(this),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i();{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_setIrrRegistry",id:r,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr._dsImage}}const Dt=typeof self=="undefined",Pe=(()=>{if(!Dt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let i=e.indexOf("#");i!=-1&&(e=e.substring(0,i))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),At=e=>{if(e==null&&(e="./"),!Dt){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var Ne;m.cvr={version:"2.4.22",path:Pe};ie.cvr={js:!0,wasm:!0,deps:["license","dip"]};k.cvr={};const Oe="1.4.10";typeof m.std!="string"&&_e(m.std.version,Oe)<0&&(m.std={version:Oe,path:At(Pe+`../../dynamsoft-capture-vision-std@${Oe}/dist/`)});const Se="2.4.20";(!m.dip||typeof m.dip!="string"&&_e(m.dip.version,Se)<0)&&(m.dip={version:Se,path:At(Pe+`../../dynamsoft-image-processing@${Se}/dist/`)});`${(Ne=q.cvr)===null||Ne===void 0?void 0:Ne.worker}`;var ge;(function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"})(ge||(ge={}));BigInt(0),BigInt(1),BigInt(1<<1),BigInt(1<<2),BigInt(1<<3),BigInt(1<<4),BigInt(1<<5),BigInt(1<<6),BigInt(1<<7),BigInt(1<<8),BigInt(1<<9),BigInt(1<<10),BigInt(1<<11),BigInt(1<<12),BigInt(1<<13),BigInt(1<<14),BigInt(1<<15),BigInt(1<<16),BigInt(1<<17),BigInt(1<<18),BigInt(1<<19),BigInt(1<<20),BigInt(1<<21),BigInt(1<<22),BigInt(1<<23),BigInt(1<<24),BigInt(1<<25),BigInt(1<<26),BigInt(1<<27),BigInt(1<<28),BigInt("0xFFFFFFFFFFFFFFFF");function Wt(e){const t={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return e.items.forEach(i=>{i.type===p.CRIT_BARCODE?t.barcodeResultItems.push(i):i.type===p.CRIT_TEXT_LINE?t.textLineResultItems.push(i):i.type===p.CRIT_DETECTED_QUAD?t.detectedQuadResultItems.push(i):i.type===p.CRIT_NORMALIZED_IMAGE?t.normalizedImageResultItems.push(i):i.type===p.CRIT_PARSED_RESULT&&t.parsedResultItems.push(i)}),t}function Lt(e,t){if(e&&e.location){const i=e.location.points;for(let s of i)s.x=s.x/t,s.y=s.y/t;Lt(e.referencedItem,t)}}function M(e){if(e.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}var d,W,G,F,ee,b,z,j,V,Q,te,ce;const it={onTaskResultsReceived:()=>{},isFilter:!0};class T{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(B.browserInfo.OS)?2048:4096,this._instanceID=void 0,this._dsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,d.set(this,null),W.set(this,null),G.set(this,null),F.set(this,null),ee.set(this,null),b.set(this,new Set),z.set(this,new Set),j.set(this,new Set),V.set(this,0),Q.set(this,!1),te.set(this,!1),ce.set(this,!1),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return c(this,ce,"f")}static async createInstance(){if(!k.license)throw Error("Module `license` is not existed.");await k.license.dynamsoft(),await Y(["cvr"]);const t=new T,i=new Ee;let s=A();return C[s]=async r=>{var n;if(r.success)t._instanceID=r.instanceID,t._currentSettings=JSON.parse(r.outputSettings),`${(n=q.cvr)===null||n===void 0?void 0:n.worker}${r.version}`,w(t,te,!0,"f"),w(t,F,t.getIntermediateResultManager(),"f"),w(t,te,!1,"f"),i.resolve(t);else{const a=Error(r.message);r.stack&&(a.stack=r.stack),i.reject(a)}},u.postMessage({type:"cvr_createInstance",id:s}),i}async _singleFrameModeCallback(t){for(let n of c(this,b,"f"))this._isOutputOriginalImage&&n.onOriginalImageResultReceived&&n.onOriginalImageResultReceived({imageData:t});const i={bytes:new Uint8Array(t.bytes),width:t.width,height:t.height,stride:t.stride,format:t.format,tag:t.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const s=await this.capture(i,this._templateName);s.originalImageTag=t.tag;for(let n of c(this,b,"f"))n.isDce&&n.onCapturedResultReceived(s,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const r={originalImageHashId:s.originalImageHashId,originalImageTag:s.originalImageTag,errorCode:s.errorCode,errorString:s.errorString};for(let n of c(this,b,"f"))if(n.onDecodedBarcodesReceived&&s.barcodeResultItems&&n.onDecodedBarcodesReceived(Object.assign(Object.assign({},r),{barcodeResultItems:s.barcodeResultItems})),n.onRecognizedTextLinesReceived&&s.textLineResultItems&&n.onRecognizedTextLinesReceived(Object.assign(Object.assign({},r),{textLineResultItems:s.textLineResultItems})),n.onDetectedQuadsReceived&&s.detectedQuadResultItems&&n.onDetectedQuadsReceived(Object.assign(Object.assign({},r),{detectedQuadResultItems:s.detectedQuadResultItems})),n.onNormalizedImagesReceived&&s.normalizedImageResultItems&&n.onNormalizedImagesReceived(Object.assign(Object.assign({},r),{normalizedImageResultItems:s.normalizedImageResultItems})),n.onParsedResultsReceived&&s.parsedResultItems&&n.onParsedResultsReceived(Object.assign(Object.assign({},r),{parsedResultItems:s.parsedResultItems})),n.onCapturedResultReceived&&!n.isDce){if(this._isOutputOriginalImage){const a=s.items.findIndex(o=>o.type===1);a!==-1&&(s.items[a].imageData=t)}n.onCapturedResultReceived(s)}}setInput(t){if(M(this),!t){w(this,d,null,"f");return}if(w(this,d,t,"f"),t.isCameraEnhancer){c(this,F,"f")&&(c(this,d,"f")._intermediateResultReceiver.isDce=!0,c(this,F,"f").addResultReceiver(c(this,d,"f")._intermediateResultReceiver));const i=c(this,d,"f").getCameraView();if(i){const s=i._capturedResultReceiver;s.isDce=!0,c(this,b,"f").add(s)}}}getInput(){return c(this,d,"f")}addImageSourceStateListener(t){if(M(this),typeof t!="object")return console.warn("Invalid ISA state listener.");!t||!Object.keys(t)||c(this,z,"f").add(t)}removeImageSourceStateListener(t){return M(this),c(this,z,"f").delete(t)}addResultReceiver(t){if(M(this),typeof t!="object")throw new Error("Invalid receiver.");!t||!Object.keys(t).length||(c(this,b,"f").add(t),this._setCrrRegistry())}removeResultReceiver(t){M(this),c(this,b,"f").delete(t),this._setCrrRegistry()}async _setCrrRegistry(){const t={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let r of c(this,b,"f"))r.isDce||(t.onCapturedResultReceived=!!r.onCapturedResultReceived,t.onDecodedBarcodesReceived=!!r.onDecodedBarcodesReceived,t.onRecognizedTextLinesReceived=!!r.onRecognizedTextLinesReceived,t.onDetectedQuadsReceived=!!r.onDetectedQuadsReceived,t.onNormalizedImagesReceived=!!r.onNormalizedImagesReceived,t.onParsedResultsReceived=!!r.onParsedResultsReceived);const i=new Ee;let s=A();return C[s]=async r=>{if(r.success)i.resolve();else{let n=new Error(r.message);n.stack=r.stack+`
`+n.stack,i.reject()}},u.postMessage({type:"cvr_setCrrRegistry",id:s,instanceID:this._instanceID,body:{receiver:JSON.stringify(t)}}),i}async addResultFilter(t){if(M(this),!t||typeof t!="object"||!Object.keys(t).length)return console.warn("Invalid filter.");c(this,j,"f").add(t),t._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(t){M(this),c(this,j,"f").delete(t),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(c(this,F,"f").removeResultReceiver(it),c(this,j,"f").size===0){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const t={[p.CRIT_BARCODE]:!1,[p.CRIT_TEXT_LINE]:!1,[p.CRIT_DETECTED_QUAD]:!1,[p.CRIT_NORMALIZED_IMAGE]:!1},i={[p.CRIT_BARCODE]:!1,[p.CRIT_TEXT_LINE]:!1,[p.CRIT_DETECTED_QUAD]:!1,[p.CRIT_NORMALIZED_IMAGE]:!1};await rt(this,t),await nt(this,i);return}for(let t of c(this,j,"f"))this._isOpenBarcodeVerify=t.isResultCrossVerificationEnabled(p.CRIT_BARCODE),this._isOpenLabelVerify=t.isResultCrossVerificationEnabled(p.CRIT_TEXT_LINE),this._isOpenDetectVerify=t.isResultCrossVerificationEnabled(p.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=t.isResultCrossVerificationEnabled(p.CRIT_NORMALIZED_IMAGE),t.isLatestOverlappingEnabled(p.CRIT_BARCODE)&&([...c(this,F,"f")._intermediateResultReceiverSet.values()].find(s=>s.isFilter)||c(this,F,"f").addResultReceiver(it)),await rt(this,t.verificationEnabled),await nt(this,t.duplicateFilterEnabled),await Yt(this,t.duplicateForgetTime)}async startCapturing(t){var i,s;if(M(this),!this._isPauseScan)return;if(!c(this,d,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");t||(t=this._currentSettings.CaptureVisionTemplates[0].Name);const r=await this.containsTask(t);await Y(r);for(let a of c(this,j,"f"))await this.addResultFilter(a);if(r.includes("dlr")&&!(!((i=k.dlr)===null||i===void 0)&&i.bLoadConfusableCharsData)){const a=Te(B.engineResourcePaths,m);await((s=k.dlr)===null||s===void 0?void 0:s.loadRecognitionData("ConfusableChars",a.dlr))}if(c(this,d,"f").isCameraEnhancer&&(r.includes("ddn")?c(this,d,"f").setPixelFormat(ue.IPF_ABGR_8888):c(this,d,"f").setPixelFormat(ue.IPF_GRAYSCALED)),c(this,d,"f").singleFrameMode!==void 0&&c(this,d,"f").singleFrameMode!=="disabled"){this._templateName=t,c(this,d,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind);return}return c(this,d,"f").getColourChannelUsageType()===se.CCUT_AUTO&&c(this,d,"f").setColourChannelUsageType(r.includes("ddn")?se.CCUT_FULL_CHANNEL:se.CCUT_Y_CHANNEL_ONLY),c(this,G,"f")&&c(this,G,"f").isPending?c(this,G,"f"):(w(this,G,new Ee((a,o)=>{if(this.disposed)return;let E=A();C[E]=async I=>{if(!(!c(this,G,"f")||c(this,G,"f").isFulfilled))if(I.success)this._isPauseScan=!1,this._isOutputOriginalImage=I.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{this._minImageCaptureInterval!==-1&&c(this,d,"f").startFetching(),this._loopReadVideo(t),a()},0);else{let l=new Error(I.message);return l.stack=I.stack+`
`+l.stack,o(l)}},u.postMessage({type:"cvr_startCapturing",id:E,instanceID:this._instanceID,body:{templateName:t}})}),"f"),await c(this,G,"f"))}stopCapturing(){if(M(this),!!c(this,d,"f")){if(c(this,d,"f").isCameraEnhancer&&c(this,d,"f").singleFrameMode!==void 0&&c(this,d,"f").singleFrameMode!=="disabled"){c(this,d,"f").off("singleFrameAcquired",this._singleFrameModeCallbackBind);return}Xt(this),c(this,d,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,w(this,G,null,"f"),c(this,d,"f").setColourChannelUsageType(se.CCUT_AUTO)}}async containsTask(t){return M(this),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i(JSON.parse(n.tasks));{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_containsTask",id:r,instanceID:this._instanceID,body:{templateName:t}})})}async _loopReadVideo(t){if(this.disposed||this._isPauseScan)return;if(w(this,Q,!0,"f"),c(this,d,"f").isBufferEmpty()){if(c(this,d,"f").hasNextImageToFetch())for(let s of c(this,z,"f"))s.onImageSourceStateReceived&&s.onImageSourceStateReceived(ge.ISS_BUFFER_EMPTY);else if(!c(this,d,"f").hasNextImageToFetch())for(let s of c(this,z,"f"))s.onImageSourceStateReceived&&s.onImageSourceStateReceived(ge.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||c(this,d,"f").isBufferEmpty())try{c(this,d,"f").isBufferEmpty()&&T._onLog&&T._onLog("buffer is empty so fetch image"),T._onLog&&T._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=c(this,d,"f").fetchImage(),T._onLog&&T._onLog(`DCE: finish fetching a frame: ${Date.now()}`),c(this,d,"f").setImageFetchInterval(this._averageTime)}catch{this._reRunCurrnetFunc(t);return}else if(c(this,d,"f").setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=c(this,d,"f").getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200){this._reRunCurrnetFunc(t);return}if(!this._dsImage){this._reRunCurrnetFunc(t);return}for(let s of c(this,b,"f"))this._isOutputOriginalImage&&s.onOriginalImageResultReceived&&s.onOriginalImageResultReceived({imageData:this._dsImage});const i=Date.now();this._captureDsimage(this._dsImage,t).then(async s=>{if(T._onLog&&T._onLog(`no js handle time: ${Date.now()-i}`),this._isPauseScan){this._reRunCurrnetFunc(t);return}s.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;const r={originalImageHashId:s.originalImageHashId,originalImageTag:s.originalImageTag,errorCode:s.errorCode,errorString:s.errorString};for(let a of c(this,b,"f")){if(a.isDce){const o=Date.now();if(a.onCapturedResultReceived(s,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify}),T._onLog){const E=Date.now()-o;E>10&&T._onLog(`draw result time: ${E}`)}}a.onDecodedBarcodesReceived&&s.barcodeResultItems&&a.onDecodedBarcodesReceived(Object.assign(Object.assign({},r),{barcodeResultItems:s.barcodeResultItems.filter(o=>!o.isFilter)})),a.onRecognizedTextLinesReceived&&s.textLineResultItems&&a.onRecognizedTextLinesReceived(Object.assign(Object.assign({},r),{textLineResultItems:s.textLineResultItems.filter(o=>!o.isFilter)})),a.onDetectedQuadsReceived&&s.detectedQuadResultItems&&a.onDetectedQuadsReceived(Object.assign(Object.assign({},r),{detectedQuadResultItems:s.detectedQuadResultItems.filter(o=>!o.isFilter)})),a.onNormalizedImagesReceived&&s.normalizedImageResultItems&&a.onNormalizedImagesReceived(Object.assign(Object.assign({},r),{normalizedImageResultItems:s.normalizedImageResultItems.filter(o=>!o.isFilter)})),a.onParsedResultsReceived&&s.parsedResultItems&&a.onParsedResultsReceived(Object.assign(Object.assign({},r),{parsedResultItems:s.parsedResultItems.filter(o=>!o.isFilter)})),a.onCapturedResultReceived&&!a.isDce&&(s.items=s.items.filter(o=>!o.isFilter),s.barcodeResultItems&&(s.barcodeResultItems=s.barcodeResultItems.filter(o=>!o.isFilter)),s.textLineResultItems&&(s.textLineResultItems=s.textLineResultItems.filter(o=>!o.isFilter)),s.detectedQuadResultItems&&(s.detectedQuadResultItems=s.detectedQuadResultItems.filter(o=>!o.isFilter)),s.normalizedImageResultItems&&(s.normalizedImageResultItems=s.normalizedImageResultItems.filter(o=>!o.isFilter)),s.parsedResultItems&&(s.parsedResultItems=s.parsedResultItems.filter(o=>!o.isFilter)),a.onCapturedResultReceived(s))}const n=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-i),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,T._onLog&&(T._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),T._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),T._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),T._onLog(`averageTime: ${this._averageTime}`))),T._onLog){const a=Date.now()-n;a>10&&T._onLog(`fetch image calculate time: ${a}`)}T._onLog&&T._onLog(`time finish decode: ${Date.now()}`),T._onLog&&T._onLog(`main time: ${Date.now()-i}`),T._onLog&&T._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,0))}).catch(s=>{c(this,d,"f").stopFetching(),s.errorCode&&s.errorCode===0&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{c(this,d,"f").startFetching(),this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,1e3))),s.message!=="platform error"&&setTimeout(()=>{throw s},0)})}_reRunCurrnetFunc(t){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},0)}async capture(t,i){var s,r;M(this),i||(i=this._currentSettings.CaptureVisionTemplates[0].Name);const n=await this.containsTask(i);if(await Y(n),n.includes("dlr")&&!(!((s=k.dlr)===null||s===void 0)&&s.bLoadConfusableCharsData)){const o=Te(B.engineResourcePaths,m);await((r=k.dlr)===null||r===void 0?void 0:r.loadRecognitionData("ConfusableChars",o.dlr))}let a;if(w(this,Q,!1,"f"),yt(t))a=await this._captureDsimage(t,i);else if(typeof t=="string")t.substring(0,11)=="data:image/"?a=await this._captureBase64(t,i):a=await this._captureUrl(t,i);else if(t instanceof Blob)a=await this._captureBlob(t,i);else if(t instanceof HTMLImageElement)a=await this._captureImage(t,i);else if(t instanceof HTMLCanvasElement)a=await this._captureCanvas(t,i);else if(t instanceof HTMLVideoElement)a=await this._captureVideo(t,i);else throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");return a}async _captureDsimage(t,i){return await this._captureInWorker(t,i)}async _captureUrl(t,i){let s=await We(t,"blob");return await this._captureBlob(s,i)}async _captureBase64(t,i){t=t.substring(t.indexOf(",")+1);let s=atob(t),r=s.length,n=new Uint8Array(r);for(;r--;)n[r]=s.charCodeAt(r);return await this._captureBlob(new Blob([n]),i)}async _captureBlob(t,i){const s=async function(o){return await new Promise((E,I)=>{let l=URL.createObjectURL(o),f=new Image;f.src=l,f.onload=()=>{URL.revokeObjectURL(f.dbrObjUrl),E(f)},f.onerror=S=>{I(new Error("Can't convert blob to image : "+(S instanceof Event?S.type:S)))}})};let r=null,n=null;if(typeof createImageBitmap!="undefined")try{r=await createImageBitmap(t)}catch{}r||(n=await s(t));let a=await this._captureImage(r||n,i);return r&&r.close(),a}async _captureImage(t,i){let s=t instanceof HTMLImageElement?t.naturalWidth:t.width,r=t instanceof HTMLImageElement?t.naturalHeight:t.height,n=Math.max(s,r),a,o;n>this.maxCvsSideLength?(w(this,V,this.maxCvsSideLength/n,"f"),a=Math.round(s*c(this,V,"f")),o=Math.round(r*c(this,V,"f"))):(a=s,o=r),c(this,W,"f")||w(this,W,document.createElement("canvas"),"f");const E=c(this,W,"f");return(E.width!==a||E.height!==o)&&(E.width=a,E.height=o),E.ctx2d||(E.ctx2d=E.getContext("2d",{willReadFrequently:!0})),E.ctx2d.drawImage(t,0,0,s,r,0,0,a,o),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),await this._captureCanvas(E,i)}async _captureCanvas(t,i){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";if([t.width,t.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const s=t.ctx2d||t.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(s.getImageData(0,0,t.width,t.height).data),width:t.width,height:t.height,stride:t.width*4,format:10};return await this._captureInWorker(n,i)}async _captureVideo(t,i){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";let s=t.videoWidth,r=t.videoHeight,n=Math.max(s,r),a,o;n>this.maxCvsSideLength?(w(this,V,this.maxCvsSideLength/n,"f"),a=Math.round(s*c(this,V,"f")),o=Math.round(r*c(this,V,"f"))):(a=s,o=r),c(this,W,"f")||w(this,W,document.createElement("canvas"),"f");const E=c(this,W,"f");return(E.width!==a||E.height!==o)&&(E.width=a,E.height=o),E.ctx2d||(E.ctx2d=E.getContext("2d",{willReadFrequently:!0})),E.ctx2d.drawImage(t,0,0,s,r,0,0,a,o),await this._captureCanvas(E,i)}async _captureInWorker(t,i){const{bytes:s,width:r,height:n,stride:a,format:o}=t;let E=A();const I=new Ee;return C[E]=async l=>{var f,S;if(l.success){const R=Date.now();T._onLog&&(T._onLog(`get result time from worker: ${R}`),T._onLog(`worker to main time consume: ${R-l.workerReturnMsgTime}`));try{const _=l.captureResult;if(_.errorCode!==0){let D=new Error(_.errorString);return D.errorCode=_.errorCode,I.reject(D)}t.bytes=l.bytes;for(let D of _.items)c(this,V,"f")!==0&&Lt(D,c(this,V,"f")),D.type===p.CRIT_ORIGINAL_IMAGE?D.imageData=t:D.type===p.CRIT_NORMALIZED_IMAGE?(f=k.ddn)===null||f===void 0||f.handleNormalizedImageResultItem(D):D.type===p.CRIT_PARSED_RESULT&&((S=k.dcp)===null||S===void 0||S.handleParsedResultItem(D));if(c(this,Q,"f"))for(let D of c(this,j,"f"))D.onDecodedBarcodesReceived(_),D.onRecognizedTextLinesReceived(_),D.onDetectedQuadsReceived(_),D.onNormalizedImagesReceived(_);const g=Wt(_);if(g.barcodeResultItems.length&&(_.barcodeResultItems=g.barcodeResultItems),g.textLineResultItems.length&&(_.textLineResultItems=g.textLineResultItems),g.detectedQuadResultItems.length&&(_.detectedQuadResultItems=g.detectedQuadResultItems),g.normalizedImageResultItems.length&&(_.normalizedImageResultItems=g.normalizedImageResultItems),g.parsedResultItems.length&&(_.parsedResultItems=g.parsedResultItems),!this._isPauseScan||!c(this,Q,"f")){const D=_.intermediateResult;if(D){let O=0;for(let U of c(this,F,"f")._intermediateResultReceiverSet){O++;for(let N of D){if(N.info.callbackName==="onTaskResultsReceived"){for(let y of N.intermediateResultUnits)y.originalImageTag=t.tag?t.tag:null;U[N.info.callbackName]&&U[N.info.callbackName]({intermediateResultUnits:N.intermediateResultUnits},N.info)}else U[N.info.callbackName]&&U[N.info.callbackName](N.result,N.info);O===c(this,F,"f")._intermediateResultReceiverSet.size&&delete N.info.callbackName}}}}return _&&_.hasOwnProperty("intermediateResult")&&delete _.intermediateResult,w(this,V,0,"f"),I.resolve(_)}catch(_){return I.reject(_)}}else{let R=new Error(l.message);return R.stack=l.stack+`
`+R.stack,I.reject(R)}},T._onLog&&T._onLog(`send buffer to worker: ${Date.now()}`),u.postMessage({type:"cvr_capture",id:E,instanceID:this._instanceID,body:{bytes:s,width:r,height:n,stride:a,format:o,templateName:i||"",isScanner:c(this,Q,"f")}},[s.buffer]),I}async initSettings(t){return M(this),!t||!["string","object"].includes(typeof t)?console.error("Invalid template."):(typeof t=="string"?(t.startsWith("{")||(t=await We(t,"text")),this._currentSettings=JSON.parse(t)):typeof t=="object"&&(this._currentSettings=t,t=JSON.stringify(t)),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success){const a=JSON.parse(n.response);if(a.exception!==0){let I=new Error(a.description?a.description:"Init Settings Failed.");return I.errorCode=a.exception,s(I)}let o=[],E=JSON.parse(t).CaptureVisionTemplates;for(let I=0;I<E.length;I++){let l=await this.containsTask(E[I].Name);o=o.concat(l)}return await Y([...new Set(o)]),this._isOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,i(a)}else{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_initSettings",id:r,instanceID:this._instanceID,body:{settings:t}})}))}async outputSettings(t){return M(this),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success){const a=JSON.parse(n.settings);if(a.errorCode!==0){let o=new Error(a.errorString);return o.errorCode=a.errorCode,s(o)}return delete a.errorCode,delete a.errorString,i(a)}else{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_outputSettings",id:r,instanceID:this._instanceID,body:{templateName:t||"*"}})})}async outputSettingsToFile(t,i,s){const r=await this.outputSettings(t),n=new Blob([JSON.stringify(r,null,2,function(a,o){return o instanceof Array?JSON.stringify(o):o},2)],{type:"application/json"});if(s){const a=document.createElement("a");a.href=URL.createObjectURL(n),i.endsWith(".json")&&(i=i.replace(".json","")),a.download=`${i}.json`,a.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(a.href)},500)},a.click()}return n}async getSimplifiedSettings(t){M(this),t||(t=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.containsTask(t);return await Y(i),await new Promise((s,r)=>{let n=A();C[n]=async a=>{if(a.success){const o=JSON.parse(a.settings,(E,I)=>E==="barcodeFormatIds"?BigInt(I):I);if(o.minImageCaptureInterval=this._minImageCaptureInterval,o.code!==0){let E=new Error(o.codeString);return E.errorCode=o.errorCode,r(E)}return delete o.code,delete o.codeString,s(o)}else{let o=new Error(a.message);return o.stack=a.stack+`
`+o.stack,r(o)}},u.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:t}})})}async updateSettings(t,i){M(this);const s=await this.containsTask(t);return await Y(s),await new Promise((r,n)=>{let a=A();C[a]=async o=>{if(o.success){const E=JSON.parse(o.response);if(i.minImageCaptureInterval&&i.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=i.minImageCaptureInterval),this._isOutputOriginalImage=o.isOutputOriginalImage,E.exception!==0){let I=new Error(E.description?E.description:"Update Settings Failed.");return I.errorCode=E.exception,n(I)}return this._currentSettings=await this.outputSettings("*"),r(E)}else{let E=new Error(o.message);return E.stack=o.stack+`
`+E.stack,n(E)}},u.postMessage({type:"cvr_updateSettings",id:a,instanceID:this._instanceID,body:{settings:i,templateName:t}})})}async resetSettings(){return M(this),await new Promise((t,i)=>{let s=A();C[s]=async r=>{if(r.success){const n=JSON.parse(r.response);if(n.exception!==0){let a=new Error(n.description?n.description:"Reset Settings Failed.");return a.errorCode=n.exception,i(a)}return this._currentSettings=await this.outputSettings("*"),t(n)}else{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,i(n)}},u.postMessage({type:"cvr_resetSettings",id:s,instanceID:this._instanceID})})}getBufferedItemsManager(){return c(this,ee,"f")||w(this,ee,new xt(this),"f"),c(this,ee,"f")}getIntermediateResultManager(){if(M(this),!c(this,te,"f")&&B.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return c(this,F,"f")||w(this,F,new jt(this),"f"),c(this,F,"f")}async parseRequiredResources(t){return M(this),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i(JSON.parse(n.resources));{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_parseRequiredResources",id:r,instanceID:this._instanceID,body:{templateName:t}})})}async dispose(){M(this),c(this,G,"f")&&this.stopCapturing(),w(this,d,null,"f"),c(this,b,"f").clear(),c(this,z,"f").clear(),c(this,j,"f").clear(),c(this,F,"f")._intermediateResultReceiverSet.clear(),w(this,ce,!0,"f");let t=A();C[t]=i=>{if(!i.success){let s=new Error(i.message);throw s.stack=i.stack+`
`+s.stack,s}},u.postMessage({type:"cvr_dispose",id:t,instanceID:this._instanceID})}_getInternalData(){return{isa:c(this,d,"f"),promiseStartScan:c(this,G,"f"),intermediateResultManager:c(this,F,"f"),bufferdItemsManager:c(this,ee,"f"),resultReceiverSet:c(this,b,"f"),isaStateListenerSet:c(this,z,"f"),resultFilterSet:c(this,j,"f"),compressRate:c(this,V,"f"),canvas:c(this,W,"f"),isScanner:c(this,Q,"f"),innerUseTag:c(this,te,"f"),isDestroyed:c(this,ce,"f")}}async _getWasmFilterState(){return await new Promise((t,i)=>{let s=A();C[s]=async r=>{if(r.success){const n=JSON.parse(r.response);return t(n)}else{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,i(n)}},u.postMessage({type:"cvr_getWasmFilterState",id:s,instanceID:this._instanceID})})}}d=new WeakMap,W=new WeakMap,G=new WeakMap,F=new WeakMap,ee=new WeakMap,b=new WeakMap,z=new WeakMap,j=new WeakMap,V=new WeakMap,Q=new WeakMap,te=new WeakMap,ce=new WeakMap;async function rt(e,t){return M(e),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i(n.result);{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_enableResultCrossVerification",id:r,instanceID:e._instanceID,body:{verificationEnabled:t}})})}async function nt(e,t){return M(e),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i(n.result);{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_enableResultDeduplication",id:r,instanceID:e._instanceID,body:{duplicateFilterEnabled:t}})})}async function Yt(e,t){return M(e),await new Promise((i,s)=>{let r=A();C[r]=async n=>{if(n.success)return i(n.result);{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,s(a)}},u.postMessage({type:"cvr_setDuplicateForgetTime",id:r,instanceID:e._instanceID,body:{duplicateForgetTime:t}})})}async function Xt(e){let t=A();const i=new Ee;return C[t]=async s=>{if(s.success)return i.resolve();{let r=new Error(s.message);return r.stack=s.stack+`
`+r.stack,i.reject(r)}},u.postMessage({type:"cvr_clearVerifyList",id:t,instanceID:e._instanceID}),i}var at;(function(e){e.PT_DEFAULT="Default",e.PT_READ_BARCODES="ReadBarcodes_Default",e.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",e.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",e.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",e.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",e.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",e.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",e.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",e.PT_READ_SINGLE_BARCODE="ReadBarcodes_Balanced",e.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",e.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",e.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",e.PT_RECOGNIZE_LETTERS="RecognizeLetters",e.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",e.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",e.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"})(at||(at={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft License JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.4.21
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DL JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/license/license-module.html
 */const J=typeof self=="undefined",ot=J?{}:self,Nt=(()=>{if(!J&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let i=e.indexOf("#");i!=-1&&(e=e.substring(0,i))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),Zt=e=>{if(e==null&&(e="./"),!J){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},Et=e=>e&&typeof e=="object"&&typeof e.then=="function";class ke extends Promise{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let i;this._task=t,Et(t)?i=t:typeof t=="function"&&(i=new Promise(t)),i&&(async()=>{try{const s=await i;t===this._task&&this.resolve(s)}catch(s){t===this._task&&this.reject(s)}})()}get isEmpty(){return this._task==null}constructor(t){let i,s;super((r,n)=>{i=r,s=n}),this._s="pending",this.resolve=r=>{this.isPending&&(Et(r)?this.task=r:(this._s="fulfilled",i(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",s(r))},this.task=t}}const he=" is not allowed to change after `createInstance` or `loadWasm` is called.",zt=!J&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",ct=(e,t)=>{const i=e;if(i._license!==t){if(!i._pLoad.isEmpty)throw new Error("`license`"+he);i._license=t}};!J&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Ot=e=>{if(e==null)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!J){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e},_t=(e,t)=>{t=Ot(t);const i=e;if(i._licenseServer!==t){if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+he);i._licenseServer=t}},It=(e,t)=>{t=t||"";const i=e;if(i._deviceFriendlyName!==t){if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+he);i._deviceFriendlyName=t}};let ae,oe,de,me,H;typeof navigator!="undefined"&&(ae=navigator,oe=ae.userAgent,de=ae.platform,me=ae.mediaDevices),function(){if(!J){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:ae.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:de,search:"Win"},Mac:{str:de},Linux:{str:de}};let i="unknownBrowser",s=0,r="unknownOS";for(let n in e){const a=e[n]||{};let o=a.str||oe,E=a.search||n,I=a.verStr||oe,l=a.verSearch||n;if(l instanceof Array||(l=[l]),o.indexOf(E)!=-1){i=n;for(let f of l){let S=I.indexOf(f);if(S!=-1){s=parseFloat(I.substring(S+f.length+1));break}}break}}for(let n in t){const a=t[n]||{};let o=a.str||oe,E=a.search||n;if(o.indexOf(E)!=-1){r=n;break}}r=="Linux"&&oe.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),H={browser:i,version:s,OS:r}}J&&(H={browser:"ssr",version:0,OS:"ssr"})}(),me&&me.getUserMedia,H.browser==="Chrome"&&H.version>66||H.browser==="Safari"&&H.version>13||H.browser==="OPR"&&H.version>43||H.browser==="Edge"&&H.version;const St=()=>(Y("license"),Fe("dynamsoft_inited",async()=>{let{lt:e,l:t,ls:i,sp:s,rmk:r,cv:n}=((E,I=!1)=>{const l=E;if(l._pLoad.isEmpty){let f,S,R,_=l._license||"",g=JSON.parse(JSON.stringify(l._licenseServer)),D=l._sessionPassword,O=0;if(_.startsWith("t")||_.startsWith("f"))O=0;else if(_.length===0||_.startsWith("P")||_.startsWith("L")||_.startsWith("Y")||_.startsWith("A"))O=1;else{O=2;const U=_.indexOf(":");U!=-1&&(_=_.substring(U+1));const N=_.indexOf("?");if(N!=-1&&(S=_.substring(N+1),_=_.substring(0,N)),_.startsWith("DLC2"))O=0;else{if(_.startsWith("DLS2")){let y;try{let x=_.substring(4);x=atob(x),y=JSON.parse(x)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(_=y.handshakeCode?y.handshakeCode:y.organizationID?y.organizationID:"",typeof _=="number"&&(_=JSON.stringify(_)),g.length===0){let x=[];y.mainServerURL&&(x[0]=y.mainServerURL),y.standbyServerURL&&(x[1]=y.standbyServerURL),g=Ot(x)}!D&&y.sessionPassword&&(D=y.sessionPassword),f=y.remark}_&&_!=="200001"&&!_.startsWith("200001-")||(O=1)}}if(O&&(I||(ot.crypto||(R="Please upgrade your browser to support online key."),ot.crypto.subtle||(R="Require https to use online key in this browser."))),R){if(O!==1)throw new Error(R);O=0,console.warn(R),l._lastErrorCode=-1,l._lastErrorString=R}return O===1&&(_="",console.warn("Applying for a public trial license ...")),{lt:O,l:_,ls:g,sp:D,rmk:f,cv:S}}throw new Error("Can't preprocess license again"+he)})(L),a=new ke;L._pLoad.task=a,(async()=>{try{await L._pLoad}catch{}})();let o=A();C[o]=E=>{if(E.message&&L._onAuthMessage){let f=L._onAuthMessage(E.message);f!=null&&(E.message=f)}let I,l=!1;if(e===1&&(l=!0),E.success?($&&$("init license success"),E.message&&console.warn(E.message),B._bSupportIRTModule=E.bSupportIRTModule,B._bSupportDce4Module=E.bSupportDce4Module,L.bPassValidation=!0,[0,-10076].includes(E.initLicenseInfo.errorCode)?[-10076].includes(E.initLicenseInfo.errorCode)&&console.warn(E.initLicenseInfo.errorString):a.reject(new Error(E.initLicenseInfo.errorString))):(I=Error(E.message),E.stack&&(I.stack=E.stack),E.ltsErrorCode&&(I.ltsErrorCode=E.ltsErrorCode),l||E.ltsErrorCode==111&&E.message.toLowerCase().indexOf("trial license")!=-1&&(l=!0)),l){const f=Te(B.engineResourcePaths,m);(async(S,R,_)=>{if(!S._bNeverShowDialog)try{let g=await fetch(S.engineResourcePath+"dls.license.dialog.html");if(!g.ok)throw Error("Get license dialog fail. Network Error: "+g.statusText);let D=await g.text();if(!D.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let O=document.createElement("div");O.innerHTML=D;let U=[];for(let h=0;h<O.childElementCount;++h){let v=O.children[h];v instanceof HTMLStyleElement&&(U.push(v),document.head.append(v))}let N=O.childElementCount==1?O.children[0]:O;N.remove();let y,x,Ge,Ve,xe,re=[N],Mt=N.children;for(let h of Mt)re.push(h);for(let h=0;h<re.length;++h)for(let v of re[h].children)re.push(v);for(let h of re)if(!y&&h.classList.contains("dls-license-mask"))y=h,h.addEventListener("click",v=>{if(h==v.target){N.remove();for(let K of U)K.remove()}});else if(!x&&h.classList.contains("dls-license-icon-close"))x=h,h.addEventListener("click",()=>{N.remove();for(let v of U)v.remove()});else if(!Ge&&h.classList.contains("dls-license-icon-error"))Ge=h,R!="error"&&h.remove();else if(!Ve&&h.classList.contains("dls-license-icon-warn"))Ve=h,R!="warn"&&h.remove();else if(!xe&&h.classList.contains("dls-license-msg-content")){xe=h;let v=_;for(;v;){let K=v.indexOf("["),De=v.indexOf("]",K),Ae=v.indexOf("(",De),Le=v.indexOf(")",Ae);if(K==-1||De==-1||Ae==-1||Le==-1){h.appendChild(new Text(v));break}K>0&&h.appendChild(new Text(v.substring(0,K)));let Ie=document.createElement("a"),vt=v.substring(K+1,De);Ie.innerText=vt;let Bt=v.substring(Ae+1,Le);Ie.setAttribute("href",Bt),Ie.setAttribute("target","_blank"),h.appendChild(Ie),v=v.substring(Le+1)}}document.body.appendChild(N)}catch(g){S._onLog&&S._onLog(g.message||g)}})({_bNeverShowDialog:L._bNeverShowDialog,engineResourcePath:f.license,_onLog:$},E.success?"warn":"error",E.message)}E.success?a.resolve(void 0):a.reject(I)},await Be("core"),u.postMessage({type:"license_dynamsoft",body:{v:"3.4.21",brtk:!!e,bptk:e===1,l:t,os:H,fn:L.deviceFriendlyName,ls:i,sp:s,rmk:r,cv:n},id:o}),L.bCallInitLicense=!0,await a}));let lt;k.license={},k.license.dynamsoft=St,k.license.getAR=async()=>{{let e=Z.dynamsoft_inited;e&&e.isRejected&&await e}return u?new Promise((e,t)=>{let i=A();C[i]=async s=>{if(s.success){delete s.success;{let r=L.license;r&&(r.startsWith("t")||r.startsWith("f"))&&(s.pk=r)}if(Object.keys(s).length){if(s.lem){let r=Error(s.lem);r.ltsErrorCode=s.lec,delete s.lem,delete s.lec,s.ae=r}e(s)}else e(null)}else{let r=Error(s.message);s.stack&&(r.stack=s.stack),t(r)}},u.postMessage({type:"license_getAR",id:i})}):null};class L{static setLicenseServer(t){_t(L,t)}static get license(){return this._license}static set license(t){ct(L,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){_t(L,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){It(L,t)}static initLicense(t,i){if(ct(L,t),L.bCallInitLicense=!0,typeof i=="boolean"&&i||typeof i=="object"&&i.executeNow)return St()}static setDeviceFriendlyName(t){It(L,t)}static getDeviceFriendlyName(){return L._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await Fe("dynamsoft_uuid",async()=>{await Y();let t=new ke,i=A();C[i]=s=>{if(s.success)t.resolve(s.uuid);else{const r=Error(s.message);s.stack&&(r.stack=s.stack),t.reject(r)}},u.postMessage({type:"license_getDeviceUUID",id:i}),lt=await t}),lt))()}}L._pLoad=new ke,L.bPassValidation=!1,L.bCallInitLicense=!1,L._license=zt,L._licenseServer=[],L._deviceFriendlyName="",m.license={version:"3.4.21",path:Nt},ie.license={wasm:!0,js:!0},k.license.LicenseManager=L;const pe="1.4.10";typeof m.std!="string"&&_e(m.std.version,pe)<0&&(m.std={version:pe,path:Zt(Nt+`../../dynamsoft-capture-vision-std@${pe}/dist/`)});/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.4.20
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const mt=typeof self=="undefined",be=(()=>{if(!mt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let i=e.indexOf("#");i!=-1&&(e=e.substring(0,i))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),pt=e=>{if(e==null&&(e="./"),!mt){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};m.dbr={version:"10.4.20",path:be},ie.dbr={js:!1,wasm:!0,deps:["license","dip"]},k.dbr={};const Me="1.4.10";typeof m.std!="string"&&_e(m.std.version,Me)<0&&(m.std={version:Me,path:pt(be+`../../dynamsoft-capture-vision-std@${Me}/dist/`)});const ve="2.4.20";(!m.dip||typeof m.dip!="string"&&_e(m.dip.version,ve)<0)&&(m.dip={version:ve,path:pt(be+`../../dynamsoft-image-processing@${ve}/dist/`)});BigInt(0),BigInt("0xFFFFFFFEFFFFFFFF"),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552);var dt,Rt,ut,Ct;(function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(dt||(dt={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Rt||(Rt={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP"}(ut||(ut={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP"}(Ct||(Ct={}));class fs extends wt{constructor(){super(...arguments),this.engineResourcePaths={rootDirectory:"https://cdn.jsdelivr.net/npm/"}}async initLicense(t){try{await L.initLicense(t.license)}catch(i){throw console.log(i),i}return{success:!0}}decodeBitmap(t){throw new Error("Method not implemented.")}async initialize(){try{B.engineResourcePaths.rootDirectory=this.engineResourcePaths.rootDirectory,await B.loadWasm(["cvr","dbr"]),this.cvr=await T.createInstance()}catch(t){throw t}return{success:!0}}async setEngineResourcePaths(t){this.engineResourcePaths=t.paths}async initRuntimeSettingsFromString(t){if(this.cvr)await this.cvr.initSettings(t.template);else throw new Error("DBR not initialized.")}async decode(t){var i;let s=[];if(this.cvr)if(this.cvr){let r=(i=t.template)!==null&&i!==void 0?i:"ReadBarcodes_Balance",n=await this.cvr.capture(t.source,r),a=[];for(let o=0;o<n.items.length;o++){const E=n.items[o];a.push(E)}for(let o=0;o<a.length;o++){const E=a[o],I={barcodeText:E.text,barcodeFormat:E.formatString,barcodeBytesBase64:this.arrayBufferToBase64(E.bytes),x1:E.location.points[0].x,y1:E.location.points[0].y,x2:E.location.points[1].x,y2:E.location.points[1].y,x3:E.location.points[2].x,y3:E.location.points[2].y,x4:E.location.points[3].x,y4:E.location.points[3].y};s.push(I)}}else throw new Error("DBR not initialized.");return{results:s}}arrayBufferToBase64(t){for(var i="",s=t.byteLength,r=0;r<s;r++)i+=String.fromCharCode(t[r]);return window.btoa(i)}}export{fs as DBRWeb};
