import{Q as C}from"./QTable.f0e964fd.js";import{Q as x}from"./QCard.3248d843.js";import{Q as P}from"./QList.b9334b06.js";import{Q as B}from"./QPage.c4c89dc0.js";import{r as m,c,o as _,g as z,d as w,w as r,e as s,f as d,a0 as g,a1 as $,Q as W,al as h,h as O,a3 as G,aW as J,a as X,u as q}from"./index.722c96ba.js";import{u as H}from"./use-quasar.70cae317.js";import{d as A}from"./dayjs.min.cbcf888d.js";import"./QSelect.c275295e.js";import"./QDrawer.66399704.js";import"./QExpansionItem.73a1f451.js";import{Q as F}from"./QCardSection.2772bee0.js";import"./QCardActions.acc2993a.js";import"./ClosePopup.fcc85c1b.js";import"./axios.511d92c0.js";import{c as K}from"./cyclecountStore.48807628.js";import{Q as R,a as Z,b as Y}from"./QTabPanels.30f400dd.js";import{Q as ee}from"./QTabs.620e0066.js";import{C as le}from"./cicsdb.8c4d4ddf.js";import{E as ae}from"./exceljs.min.9e24d01d.js";import{f as te}from"./FileSaver.min.89adfc30.js";import"./use-key-composition.4dbf594e.js";import"./QLinearProgress.9441f2d2.js";import"./QCheckbox.ddce8d62.js";import"./use-checkbox.eaa0af27.js";import"./_commonjsHelpers.88e99c8f.js";import"./format.8ac60962.js";import"./QResizeObserver.36318aa8.js";import"./QScrollObserver.1037fb2d.js";import"./TouchSwipe.ae12c1ce.js";import"./use-render-cache.3aae9b27.js";const oe={class:"row justify-between"},se={class:"text-h6"},ne={class:"text-subtitle2"},ie={class:"text-subtitle2"},re={class:"text-subtitle2"},de={class:"text-white"},ue={__name:"Viewer",props:{folio:[String,Number],store:[String,Number]},emits:["errorsearch"],setup(N,{emit:Q}){const p=H(),u=N,b=u.folio,y=u.store,a=m(null),t=m(null),i=m("body"),f=m(null),I=m({cols:[{name:"id",field:"id",label:"ID",align:"left"},{name:"lcode",field:"code",label:"Codigo"},{name:"scode",field:"name",label:"Codigo C."},{name:"descr",field:"description",label:"Articulo",align:"left",classes:"fs-dec4"},{name:"sai",field:l=>l.pivot.stock,label:"SAI",align:"center"},{name:"counteds",field:l=>l.pivot.stock_acc,label:"UC",align:"center"},{name:"sat",field:l=>{var e;return(e=l.pivot.stock_end)!=null?e:"--"},label:"SAT",align:"center"},{name:"ufus",field:l=>l.pivot.stock_acc-l.pivot.stock,label:"UF/US",align:"center"},{name:"locs",field:l=>l.locations.map(e=>e.path).join(", "),label:"Ubicacion (es)",align:"left"},{name:"gen",field:l=>{var e;return(e=l.stocks[0])==null?void 0:e.pivot.gen},label:"GEN",align:"left"},{name:"exh",field:l=>{var e;return(e=l.stocks[0])==null?void 0:e.pivot.exh},label:"EXH",align:"left"},{name:"fdt",field:l=>{var e;return(e=l.stocks[0])==null?void 0:e.pivot.fdt},label:"FDT",align:"left"}],columnsLog:[{name:"id",field:"id",label:"ID",align:"left"},{name:"name",field:"name",label:"Nombre",align:"left"},{name:"responsable",field:l=>l.details.responsable,label:"Responsable",align:"left"},{name:"fecha",field:"created_at",label:"Fecha",align:"left"}]}),k=c(()=>a.value?a.value.created_by:null),j=c(()=>a.value?a.value.log:[]),S=c(()=>a.value&&a.value.responsables&&a.value.responsables.length?a.value.responsables.map(l=>l.nick).join(","):""),V=c(()=>a.value&&a.value.products&&a.value.products.length?a.value.products:[]),D=c(()=>a.value?a.value.status.name:"");c(()=>""),c(()=>""),(async()=>{p.loading.show({message:"Obteniendo Informacion"});const l=await le.find(b,y);console.log(l),l.fail?t.value=l.fail:a.value=l.inventory,p.loading.hide()})();const M=l=>{let e=`INV_${a.value.id}_${a.value.workpoint.alias}.xlsx`;console.log(e);let v=new ae.Workbook,o=v.addWorksheet("Sheet1");o.columns=[{header:"ID",key:"id"},{header:"Codigo",key:"lcode"},{header:"Codigo C.",key:"scode"},{header:"Articulo",key:"description"},{header:"SAI",key:"sai"},{header:"UC",key:"uc"},{header:"SAT",key:"sat"},{header:"UF/US",key:"ufus"},{header:"Ubicacion(es)",key:"locs"},{header:"GEN",key:"gen"},{header:"EXH",key:"exh"},{header:"FDT",key:"fdt"}],V.value.forEach(n=>{var T,E,U;o.addRow({id:n.id,lcode:n.code,scode:n.name,description:n.description,sai:parseInt(n.pivot.stock),uc:parseInt(n.pivot.stock_acc),sat:parseInt(n.pivot.stock_end),ufus:parseInt(n.pivot.stock_acc)-parseInt(n.pivot.stock),locs:n.locations.map(L=>L.path).join(", "),gen:(T=n.stocks[0])==null?void 0:T.pivot.gen,exh:(E=n.stocks[0])==null?void 0:E.pivot.exh,fdt:(U=n.stocks[0])==null?void 0:U.pivot.fdt})}),o.getCell("N2").value="Folio:",o.getCell("O2").value=a.value.id,o.getCell("N3").value="Sucursal:",o.getCell("O3").value=a.value.workpoint.name,o.getCell("N4").value="Estado:",o.getCell("O4").value=D.value,o.getCell("N5").value="Creado por:",o.getCell("O5").value=k.value?k.value.names:"",o.getCell("N6").value="Realizado por:",o.getCell("O6").value=S.value,o.getCell("N7").value="Inicio:",o.getCell("O7").value="",o.getCell("N8").value="Termino:",o.getCell("O8").value="",v.xlsx.writeBuffer().then(n=>te(new Blob([n],{type:"application/octet-stream"}),e))};return(l,e)=>(_(),z(G,null,[a.value?(_(),w(x,{key:0,class:"my-card"},{default:r(()=>[s(F,null,{default:r(()=>[d("div",oe,[d("div",se,"Inventario "+g($(b)),1),d("div",null,[s(W,{color:"primary",label:"descargar",onClick:M})])]),d("div",ne,[e[2]||(e[2]=h("Creado por: ")),d("b",null,g(k.value?k.value.names:"Nobody"),1)]),d("div",ie,[e[3]||(e[3]=h("Realizado por: ")),d("b",null,g(S.value),1)]),d("div",re,[e[4]||(e[4]=h("Estado: ")),d("b",null,g(D.value),1)])]),_:1}),s(ee,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=v=>i.value=v)},{default:r(()=>[s(R,{name:"log",label:"Log"}),s(R,{name:"body",label:"Resumen"})]),_:1},8,["modelValue"]),s(Z,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=v=>i.value=v),animated:""},{default:r(()=>[s(Y,{name:"log"},{default:r(()=>[e[5]||(e[5]=d("div",{class:"text-h6"},"Log",-1)),s(C,{rows:j.value,columns:I.value.columnsLog},null,8,["rows","columns"])]),_:1}),s(Y,{name:"body"},{default:r(()=>[s(C,{flat:"",rows:V.value,columns:I.value.cols,"row-key":"name",ref_key:"rowsproducts",ref:f},null,8,["rows","columns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):O("",!0),t.value?(_(),w(x,{key:1,class:"bg-negative"},{default:r(()=>[s(F,null,{default:r(()=>[d("pre",de,g(t.value),1)]),_:1})]),_:1})):O("",!0)],64))}},je={__name:"reports",setup(N){m(""),H(),J(),X();const Q=q(),p=K();p.settitle("Ciclicos"),p.setshowBtns(!0);const u=m({state:!1,data:null}),b=c(()=>p.cyclecounts),y=m({cols:[{name:"id",field:"id",label:"Folio"},{name:"started",field:t=>A(t.created_at).format("YYYY/MM/DD HH:mm:ss"),label:"Creacion",align:"center"},{name:"status",field:t=>t.status.name,label:"Estado",align:"center"},{name:"ended",field:t=>{let i=t.log.find(f=>f.id==3);return i?A(i.pivot.created_at).format("YYYY/MM/DD HH:mm:ss"):"--"},align:"center",label:"Termino"},{name:"models",field:"products_count",label:"Modelos"},{name:"type",field:t=>t.type.name,label:"Tipo"},{name:"pressition",field:t=>`${t.precision}%`,label:"Precision"},{name:"warehouse",field:t=>t.settings?JSON.parse(t.settings).warehouse.name:"---",label:"Almacen"}]}),a=async(t,i,f)=>{u.value.folio=i.id,u.value.state=!0};return(t,i)=>(_(),w(B,{padding:""},{default:r(()=>[s(B,{padding:""},{default:r(()=>[s(x,{class:"my-card",flat:""},{default:r(()=>[s(C,{title:"Inventarios",rows:b.value,columns:y.value.cols,"row-key":"id",onRowClick:a},null,8,["rows","columns"])]),_:1}),s(P,{modelValue:u.value.state,"onUpdate:modelValue":i[0]||(i[0]=f=>u.value.state=f),"full-width":""},{default:r(()=>[s(ue,{folio:u.value.folio,store:$(Q).session.store.id_viz},null,8,["folio","store"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}};export{je as default};
