import{u as L,r as x,c as O,o as v,d as D,w as d,g as t,_ as n,a4 as U,i as S,e as s,j as _,k as T,Y as E,Q as w,f as F,a1 as m,a0 as N,$ as B,b5 as z,a2 as R,aV as M,h as q,a3 as j}from"./index.221caa3e.js";import{Q as H}from"./QToolbarTitle.baea0538.js";import{Q as J}from"./QDate.929773bd.js";import{q as G,d as K}from"./QSelect.a5e41645.js";import{Q as W}from"./QToolbar.36905a19.js";import{Q as P}from"./QTable.958e2803.js";import{Q as X}from"./QExpansionItem.80d01a08.js";import{Q as Z}from"./QList.3f60b836.js";import{Q as ee}from"./QPage.74a09cbe.js";import"./QDrawer.b431f3e9.js";import{C as te}from"./ClosePopup.00caced2.js";import{v as le}from"./axios.7cf70621.js";import{u as Y}from"./use-quasar.ba838ac0.js";import{b as h}from"./billingApi.389e3280.js";import{u as I}from"./BillingStore.bebdbc80.js";import"./jspdf.plugin.autotable.2c427a54.js";import"./exceljs.min.9e24d01d.js";import"./reports.5b9afd87.js";import"./JsBarcode.cb858474.js";import"./browser.125a354e.js";import{d as $}from"./dayjs.min.cbcf888d.js";import"./use-render-cache.3aae9b27.js";import"./date.2e409679.js";import"./QLinearProgress.f0c22688.js";import"./QResizeObserver.5ced3230.js";import"./QScrollObserver.1d0c900e.js";import"./_commonjsHelpers.88e99c8f.js";const ae={class:"row justify-between items-center q-mb-lg"},se={class:"text-caption text-grey-6"},oe={key:0},ie={class:"row q-col-gutter-md q-mb-lg"},ne={class:"col-12 col-md-4"},de={class:"text-h6 text-weight-medium"},re={class:"col-12 col-md-4"},ce={class:"text-h6 text-weight-medium"},ue={class:"col-12 col-md-4"},me={class:"text-h6 text-weight-medium"},ve={class:"row q-col-gutter-md"},fe={class:"col-12 col-sm-6"},ge={class:"text-body1"},pe={class:"col-12 col-sm-6"},be={class:"text-body1"},xe={class:"col-12 col-sm-6"},_e={class:"text-body1"},ye={class:"col-12 col-sm-6"},we={class:"text-body1"},he={class:"row q-col-gutter-md"},ke={class:"col"},Ce={class:"text-body1"},Se={class:"col"},De={class:"text-body1"},Ae={class:"text-caption text-grey-7"},Qe={class:"text-body1"},Te={class:"text-caption"},Fe={class:"col"},$e={class:"col-12"},Ve={class:"text-body1"},qe={class:"col-12"},Le={class:"text-body1"},Ee={__name:"viewBilling",props:{id:{default:null,type:Number}},emits:["nextState"],setup(V,{emit:k}){L(),I();const b=Y(),l=x(null),f=[{name:"ARTLFA",label:"C\xF3digo",field:"ARTLFA",align:"left"},{name:"DESLFA",label:"Descripci\xF3n",field:"DESLFA",align:"left"},{name:"CANLFA",label:"Cantidad",field:"CANLFA",align:"center"},{name:"PRELFA",label:"Precio",field:"PRELFA",align:"right"},{name:"TOTLFA",label:"Total",field:"TOTLFA",align:"right"},{name:"UNIDAD",label:"UNIDAD",field:i=>i.sat.unidad,align:"right"},{name:"CLAVE",label:"CLAVE",field:i=>i.sat.clave,align:"right"}],c=O(()=>{try{const i=JSON.parse(l.value.address);return`${i.calle} ${i.numExt} ${i.numInt?"Int. "+i.numInt:""}, ${i.colonia}, ${i.ciudad}, ${i.municipio}, CP ${i.cp}`}catch{return""}}),r=V,y=k,u=async()=>{b.loading.show({message:"Obteniendo Datos"});let i={id:r.id};const e=await h.getBilling(i);e.fail?console.log(e):(console.log(e),b.loading.hide(),l.value=e)},C=i=>{let e=null;switch(i){case"EFE":e="01";break;case"TDD":e="28";break;case"TDC":e="04";break;case"TRA":e="03";break;case"CHE":e="11";break;default:e="01";break}return e},A=()=>{if(l.value._state==1){if(!l.value.nclient)return b.notify({title:"Cliente sin registro",type:"negative",position:"center",message:"El cliente no cuenta con n\xFAmero de registro"});const i=l.value.ticketSuc.products.filter(e=>{var a,o;return!((a=e.sat)!=null&&a.clave)||!((o=e.sat)!=null&&o.unidad)});if(i.length>0){const e=i.map(a=>`\u2022 ${a.DESLFA} (${a.ARTLFA})`).join("<br>");return b.notify({message:`Los siguientes productos no tienen clave o unidad SAT:<br><br>${e}`,html:!0,type:"negative",position:"center"})}l.value.payments.forEach(e=>{e.sat=C(e.payment)}),y("nextState",l.value)}else l.value._state==2?y("nextState",l.value):l.value._state==3||(l.value._state==4?console.log("este ya se acabo"):l.value._state==5&&y("nextState"))},Q=async()=>{window.open(`${le}/Constances/${l.value.id}/${l.value.constancia}`,"_blank")};return u(),(i,e)=>l.value?(v(),D(w,{key:0,class:"q-pa-lg"},{default:d(()=>[t("div",ae,[t("div",null,[e[0]||(e[0]=t("div",{class:"text-h5 text-weight-bold"},"Factura / Solicitud",-1)),t("div",se," Creado el: "+n(U($)(l.value.created_at).format("DD MMM YYYY - HH:mm")),1)]),l.value.constancia?(v(),S("div",oe,[s(_,{color:"primary",icon:"download",label:"Descargar Constancia",onClick:Q})])):T("",!0),s(G,{size:"md",color:"primary","text-color":"white"},{default:d(()=>[E(n(l.value.status.name),1)]),_:1})]),t("div",ie,[t("div",ne,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:d(()=>[e[1]||(e[1]=t("div",{class:"text-grey-7 text-caption"},"Ticket",-1)),t("div",de,n(l.value.ticket),1)]),_:1})]),t("div",re,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:d(()=>[e[2]||(e[2]=t("div",{class:"text-grey-7 text-caption"},"Total",-1)),t("div",ce,"$ "+n(l.value.total),1)]),_:1})]),t("div",ue,[s(w,{flat:"",bordered:"",class:"q-pa-md"},{default:d(()=>[e[3]||(e[3]=t("div",{class:"text-grey-7 text-caption"},"Sucursal",-1)),t("div",me,n(l.value.store.name),1)]),_:1})])]),s(F,null,{default:d(()=>[e[13]||(e[13]=t("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos de Contacto",-1)),t("div",ve,[t("div",fe,[e[4]||(e[4]=t("div",{class:"text-caption text-grey-7"},"Nombre",-1)),t("div",ge,n(l.value.name),1)]),t("div",pe,[e[5]||(e[5]=t("div",{class:"text-caption text-grey-7"},"Email",-1)),t("div",be,n(l.value.email),1)]),t("div",xe,[e[6]||(e[6]=t("div",{class:"text-caption text-grey-7"},"Tel\xE9fono",-1)),t("div",_e,n(l.value.celphone),1)]),t("div",ye,[e[7]||(e[7]=t("div",{class:"text-caption text-grey-7"},"Notas",-1)),t("div",we,n(l.value.notes),1)])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(m),s(m,{spaced:"",inset:"",vertical:"",dark:""}),e[14]||(e[14]=t("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos Fiscales",-1)),t("div",he,[t("div",ke,[e[8]||(e[8]=t("div",{class:"text-caption text-grey-7"},"RFC",-1)),t("div",Ce,n(l.value.rfc),1)]),t("div",Se,[e[9]||(e[9]=t("div",{class:"text-caption text-grey-7"},"Raz\xF3n Social",-1)),t("div",De,n(l.value.razon_social),1)]),(v(!0),S(N,null,B(l.value.payments,a=>(v(),S("div",{key:a.id,class:"col"},[t("div",Ae,n(a.payment),1),t("div",Qe,"$ "+n(a.import),1),t("div",Te,n(C(a.payment)),1)]))),128)),t("div",Fe,[e[10]||(e[10]=t("div",{class:"text-caption text-grey-7"},"Numero Registro",-1)),t("div",{class:z(["text-body1",l.value.nclient?"":"text-red"])},n(l.value.nclient?l.value.nclient:"Sin Registro"),3)]),t("div",$e,[e[11]||(e[11]=t("div",{class:"text-caption text-grey-7"},"Direcci\xF3n",-1)),t("div",Ve,n(c.value),1)]),t("div",qe,[e[12]||(e[12]=t("div",{class:"text-caption text-grey-7"},"Regimen",-1)),t("div",Le,n(`${JSON.parse(l.value.regimen).clave}`)+" - "+n(`${JSON.parse(l.value.regimen).descripcion}`),1)])])]),_:1}),s(F,null,{default:d(()=>[e[15]||(e[15]=t("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Productos",-1)),s(P,{flat:"",bordered:"",dense:"",rows:l.value.ticketSuc.products,columns:f,"row-key":"ARTLFA",class:"q-mb-xl"},null,8,["rows"])]),_:1}),s(R,{align:"right"},{default:d(()=>[l.value._state!=4?(v(),D(_,{key:0,color:"primary",label:l.value._state==1?"Continuar":"Terminar",onClick:A},null,8,["label"])):T("",!0),M(s(_,{color:"negative",flat:"",label:"Cancelar"},null,512),[[te]])]),_:1})]),_:1})):T("",!0)}},Ne={class:"row full-width items-center justify-between q-py-sm"},ct={__name:"Billers",setup(V){const k=L(),b=I(),l=Y();b.setShowToolbar(!0);const f=x({from:null,to:null}),c=x({state:!1,data:null}),r=x([]),y=x({opts:[{id:1,label:"Solicitado",class:"bg-red-10 "},{id:2,label:"Proceso",class:"bg-yellow-10 "},{id:4,label:"Creado",class:"bg-green-10"}]}),u=x({columns:[{name:"date",label:"Creado",field:e=>$(e.creeated_at).format("YYYY-MM-DD HH:mm:ss"),align:"left"},{name:"id",label:"Solicitud",field:e=>e.id,align:"left"},{name:"store",label:"Sucursal",field:e=>e.store.name,align:"left"},{name:"ticket",label:"Ticket",field:e=>e.ticket,align:"left"},{name:"contact",label:"Contacto",field:e=>e.name,align:"left"},{name:"email",label:"Correo",field:e=>e.email,align:"left"},{name:"celphone",label:"Telefono",field:e=>e.celphone,align:"left"},{name:"razonSocial",label:"Razon Social",field:e=>e.razon_social,align:"left"},{name:"Status",label:"Estado",field:e=>e.status.name,align:"left"},{name:"Usuario",label:"Usuario",field:e=>e.logs.find(a=>a._state==e._state).user.nick,align:"left"},{name:"factura",label:"Factura",field:e=>e.invoice,align:"left"}],filter:null,paginate:{rowsPerPage:15}}),C=async()=>{l.loading.show({message:"Obteniendo Datos"});let e=$(new Date).format("YYYY/MM/DD");f.value={from:e,to:e};const a=await h.getBillings({date:f.value});a.fail?console.log(a):(console.log(a),l.loading.hide(),r.value=a)},A=async()=>{l.loading.show({message:"Obteniendo Datos"});const e=await h.getBillings({date:f.value});e.fail?console.log(e):(console.log(e),l.loading.hide(),r.value=e)},Q=async(e,a,o)=>{c.value.folio=a.id,c.value.state=!0},i=async e=>{if(console.log(e),e._state==1){l.loading.show({message:"Creando Factura"});let a={billing:e,user:k.session.credentials.id};const o=await h.crearFacturaInterna(a);if(o.fail)console.log(o);else{l.loading.hide(),console.log(o);let g=r.value.findIndex(p=>p.id==o.id);g>=0&&(r.value.splice(g,1,o),c.value={state:!1,data:null})}}else if(e._state==2){l.loading.show({message:"Cambiando Status"});let a={billing:e,user:k.session.credentials.id};const o=await h.finishState(a);if(o.fail)console.log(o);else{l.loading.hide(),console.log(o);let g=r.value.findIndex(p=>p.id==o.id);g>=0&&(r.value.splice(g,1,o),c.value={state:!1,data:null})}}};return C(),(e,a)=>(v(),D(ee,{padding:""},{default:d(()=>[s(W,null,{default:d(()=>[s(_,{flat:"",round:"",dense:"",icon:"receipt_long"}),s(H,null,{default:d(()=>a[4]||(a[4]=[E(" Solicitudes De Facturas ")])),_:1}),s(_,{flat:"",round:"",dense:"",icon:"event"},{default:d(()=>[s(K,null,{default:d(()=>[s(w,{class:"my-card"},{default:d(()=>[s(F,null,{default:d(()=>[t("div",null,[a[5]||(a[5]=t("div",{class:"q-pb-sm text-center"},null,-1)),s(J,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=o=>f.value=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),s(R,{vertical:"",align:"center"},{default:d(()=>[s(_,{flat:"",label:"Obtener",color:"positive",onClick:A})]),_:1})]),_:1})]),_:1})]),_:1}),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(q,{modelValue:u.value.filter,"onUpdate:modelValue":a[1]||(a[1]=o=>u.value.filter=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(q,{modelValue:u.value.filter,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value.filter=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])]),_:1}),s(m,{spaced:"",inset:"",vertical:"",dark:""}),(v(!0),S(N,null,B(y.value.opts,(o,g)=>(v(),D(Z,{bordered:"",key:g},{default:d(()=>[s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(X,{"expand-separator":"","default-opened":"","header-class":o.class},{header:d(()=>[t("div",Ne,[t("div",null,n(o.label.toUpperCase())+" - "+n(r.value.filter(p=>p._state==o.id).length),1)])]),default:d(()=>[s(m),s(P,{rows:r.value.filter(p=>p._state==o.id),columns:u.value.columns,pagination:u.value.paginate,filter:u.value.filter,onRowClick:Q},null,8,["rows","columns","pagination","filter"])]),_:2},1032,["header-class"]),s(m,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024))),128)),s(j,{modelValue:c.value.state,"onUpdate:modelValue":a[3]||(a[3]=o=>c.value.state=o),"full-width":""},{default:d(()=>[s(Ee,{id:c.value.folio,onNextState:i},null,8,["id"])]),_:1},8,["modelValue"])]),_:1}))}};export{ct as default};
