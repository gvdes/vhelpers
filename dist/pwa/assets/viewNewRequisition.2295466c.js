import{u as se,a as ie,aI as ne,r as y,c as E,o as f,d as _,w as i,h as x,f as o,e as s,a1 as de,Q as r,a0 as n,S as ue,ak as re,al as v,a4 as U,b9 as ce}from"./index.1026e154.js";import{b as m,a as ve,d as F,e as w,Q as A}from"./QList.b00bb26a.js";import{Q as j}from"./QInput.8fc10693.js";import{b as pe,Q as me}from"./QTable.a3d6084d.js";import{Q as fe}from"./QBanner.408cea7d.js";import{Q as S}from"./QCard.f4a98112.js";import{Q as _e}from"./QBtnGroup.efdf6ce9.js";import{Q as xe}from"./QPageSticky.074a4d6a.js";import{Q}from"./QCardSection.def53aa8.js";import{Q as ge}from"./QSelect.176610e8.js";import{Q as ke}from"./QSpace.a40eb9c8.js";import{Q as M}from"./QCardActions.81d7d66c.js";import{Q as be}from"./QFooter.45d5e6f3.js";import{Q as ye}from"./QPage.79b8b315.js";import{C as we}from"./ClosePopup.7ba64d8e.js";import"./QDrawer.d48f979f.js";import"./QExpansionItem.0fb7d334.js";import"./axios.31eaf86d.js";import{u as he}from"./use-quasar.c0ab2370.js";import{P as Ce}from"./ProductsAutocomplete.16feeb0c.js";import{E as Qe}from"./exceljs.min.9e24d01d.js";import{u as qe}from"./Restock.e9e43a74.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.6bab273d.js";import"./JsBarcode.cb858474.js";import"./dayjs.min.cbcf888d.js";import{$sktRestock as Pe}from"./socket.05630e21.js";import"./QForm.881edb78.js";import"./QBadge.21957807.js";import{R as h}from"./RestockApi.cf2bc879.js";import"./QToolbar.fa08f914.js";import"./use-key-composition.50452a46.js";import"./QLinearProgress.2cdae955.js";import"./QCheckbox.4147742f.js";import"./use-checkbox.ac7306fa.js";import"./QResizeObserver.a799a20c.js";import"./QScrollObserver.5fe9a1d6.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";import"./QRadio.c8167a0f.js";import"./QTd.1e64e4ce.js";import"./QPopupEdit.c2250604.js";import"./QTr.bc06e6e6.js";import"./QLayout.4a68eaaf.js";/* empty css                                                       */const Se={class:"row items-stretch justify-between bg-primary text-white"},Ve={class:"row items-center col divlcient"},Ie={class:"q-pa-sm col text-center"},ze={class:"text-uppercase"},Fe={class:"q-pa-sm col text-center"},Ne={class:"text-bold"},Re={class:"q-pa-sm col text-center"},Be={class:"text-bold"},De={class:"row items-center justify-between q-mt-sm"},$e={class:"row text-center"},Ee={class:"q-px-md"},Ue={class:"text-bold"},Ae={class:"q-px-md"},je={class:"text-bold"},Me={class:"q-px-md"},Te={class:"text-bold"},Oe={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3"},Le={class:"row items-center q-pt-md"},Ke={class:"col q-px-md"},Ge={class:"text-bold"},Je={class:"text--2"},We={class:"col q-px-md"},Ye={class:"text-center"},He={class:"text--2"},Xe={class:"text-weight-bold"},Ze={class:"row q-pt-xs"},et={class:"row"},tt={class:"text-h6 col text-bold text-left"},lt={class:"text-h6 col text-bold text-right"},ot={class:"text-subtitle2 col"},at={class:"row items-end"},st={class:"text-center"},it={class:"col q-pa-xs"},nt={class:"col column q-py-md"},dt={class:"col q-pa-xs"},ut={class:"text-bold text-red"},rt={class:"row q-ml-sm"},ol={__name:"viewNewRequisition",setup(ct){const T=se(),u=he(),O=qe(),N=ie(),V=ne(),d=y(null),C=y([]),l=y({state:!1,val:null,edit:!1}),k=y({state:!1,notfound:[],added:[]}),R=y(null),q=y({pagination:{rowsPerPage:16},filter:""}),c=y({_requisition:V.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null}),L=E(()=>{let a=l.value.val.pivot._supply_by==3?l.value.val.pivot.amount*l.value.val.pieces:l.value.val.pivot._supply_by==2?l.value.val.pivot.amount*12:l.value.val.pivot.amount;return l.value.val.pivot.units=a,a}),K=E(()=>{let a=l.value.val.pivot._supply_by==3?l.value.val.pivot.stock/l.value.val.pieces:l.value.val.pivot._supply_by==2?l.value.val.pivot.stock/12:l.value.val.pivot.stock;return l.value.val.pivot.units=a,a}),B=a=>a.pivot._supply_by==3?a.pivot.stock/a.pieces:a.pivot._supply_by==2?a.pivot.stock/12:a.pivot.stock,G=a=>{console.log(a),l.value.val=a,l.value.state=!0,l.value.edit=!0},J=a=>{console.log(a);let t=d.value.products.findIndex(e=>e.id==a.id);console.log(t),t>=0?(l.value.val=d.value.products[t],l.value.state=!0,l.value.edit=!0):(l.value.edit=!1,l.value.val=a,c.value._product=ops.id,c.value._supply_by=ops._unit,c.value.ipack=ops.pieces,c.value.cost=ops.prices.find(e=>e.id==7).pivot.price,c.value.stock=ops.stocks.find(e=>e.id==d.value.to.id).pivot.stock,l.value.val.pivot=c.value,l.value.state=!0)},W=a=>{console.log(a);let t=d.value.products.findIndex(e=>e.id==a.id);console.log(t),t>=0?(l.value.val=d.value.products[t],console.log(l.value.val),l.value.state=!0,l.value.edit=!0):(l.value.val=a,c.value._product=a.id,c.value._supply_by=a._unit,c.value.ipack=a.pieces,c.value.cost=a.prices.find(e=>e.id==7).pivot.price,c.value.stock=a.stocks.find(e=>e.id==d.value.to.id).pivot.stock,l.value.val.pivot=c.value,l.value.edit=!1,l.value.state=!0)},Y=async()=>{O.setShowLYT(!1),u.loading.show({message:"Obteniendo Pedido"});let a={workpoint:T.session.store.id_viz,folio:V.params.rid};const t=await h.getRequired(a);t.fail?console.log(t):(u.loading.hide(),console.log(t),d.value=t.order,C.value=t.units)},H=async()=>{u.loading.show({message:"Insertando Producto"}),l.value.val.pivot.total=l.value.val.pivot.units*l.value.val.pivot.cost;const a=await h.addProductRequired(l.value.val.pivot);a.fail?console.log(a):(console.log(a),u.loading.hide(),d.value.products.push(a),I())},X=async()=>{u.loading.show({message:"Editando Producto"}),l.value.val.pivot.total=l.value.val.pivot.units*l.value.val.pivot.cost;const a=await h.addProductRequired(l.value.val.pivot);if(a.fail)console.log(a);else{console.log(a),u.loading.hide();let t=d.value.products.findIndex(e=>e.id==l.value.val.id);d.value.products.splice(t,1,a),I()}},Z=async()=>{u.loading.show({message:"Eliminando Producto"});const a=await h.deleteProductRequired(l.value.val.pivot);if(a.fail)console.log(a);else{console.log(a),u.loading.hide();let t=d.value.products.findIndex(e=>e.id==l.value.val.id);d.value.products.splice(t,1),I()}},ee=()=>{R.value.click()},te=async()=>{let a=document.getElementById("inputFile").files[0],t=new Qe.Workbook,e={};t.xlsx.load(a).then(async p=>{let z=t.worksheets[0],oe=z.getColumn("A");z.getColumn("B"),oe.eachCell({includeEmpty:!0},function(b,g){if(g===1)return;let P=b.value,ae=z.getCell(`B${g}`),$=parseFloat(ae.value);P&&(e[P]?e[P]+=$:e[P]=$)});let D=Object.keys(e).map(b=>({codigo:b,cantidad:e[b]}));if(D.length){let b={codes:D,_requisition:d.value.id};u.loading.show({message:"Procesando archivo, espera.."}),console.log(b);const g=await h.addMassiveProducts(b);g.fail?console.log(g):(console.log(g),d.value.products=g.products,k.value.state=!0,k.value.added=g.products,k.value.notfound=g.notFound,u.loading.hide())}else u.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},le=async()=>{u.loading.show({message:"Enviando Pedido"});const a=await h.nextStep({id:d.value.id});console.log(a),a.status==200?(console.log(a),u.notify({message:"Pedido Enviado :)",type:"positive",position:"center"}),N.push("/distribute/dashboardStore"),Pe.emit("order_refresh",{order:a.data.requisition}),u.loading.hide()):alert("Problema con el envio de el pedido ")},I=()=>{c.value={_requisition:V.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null},l.value={state:!1,val:null,edit:!1}};return Y(),(a,t)=>d.value?(f(),_(ye,{key:0,padding:""},{default:i(()=>[o("div",Se,[s(r,{onClick:t[0]||(t[0]=()=>de(N).push("/distribute/dashboardStore")),flat:"",icon:"close",color:"white"}),o("div",Ve,[o("div",Ie,[t[9]||(t[9]=o("div",{class:"text--2"},"Destino:",-1)),o("div",ze,n(d.value.to.alias),1)]),o("div",Fe,[t[10]||(t[10]=o("div",{class:"text--2"},"Folio:",-1)),o("div",Ne,n(d.value.id),1)]),o("div",Re,[t[11]||(t[11]=o("div",{class:"text--2"},"Almacen:",-1)),o("div",Be,n(d.value._warehouse),1)])])]),o("div",De,[o("div",$e,[o("div",Ee,[t[12]||(t[12]=o("div",{class:"text--2"},"Modelos",-1)),o("span",Ue,n(d.value.products.length),1)]),o("div",Ae,[t[13]||(t[13]=o("div",{class:"text--2"},"Unidades",-1)),o("span",je,n(d.value.products.reduce((e,p)=>e+Number(p.pivot.units),0)),1)]),o("div",Me,[t[14]||(t[14]=o("div",{class:"text--2"},"Cajas",-1)),o("span",Te,n(d.value.products.reduce((e,p)=>e+Number(Number(p.pivot.units)/Number(p.pieces)),0)),1)])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(j,{dense:"",debounce:"300",modelValue:q.value.filter,"onUpdate:modelValue":t[1]||(t[1]=e=>q.value.filter=e),placeholder:"Buscar",class:"col-auto",outlined:""},{append:i(()=>[s(ue,{name:"search"})]),_:1},8,["modelValue"])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(me,{grid:"",flat:"",dark:"","row-key":"id",rows:d.value.products,filter:q.value.filter,pagination:q.value.pagination},{item:i(e=>[o("div",Oe,[s(S,{class:"q-mb-sm q-mr-sm",onClick:p=>G(e.row)},{default:i(()=>[o("div",Le,[o("div",Ke,[o("div",Ge,n(e.row.code),1),o("div",null,n(e.row.name),1),o("div",Je,n(e.row.description),1)])]),o("div",We,[s(pe,{flat:"",class:""},{default:i(()=>[o("thead",null,[o("tr",null,[o("th",null,"Sol. ("+n(C.value.find(p=>p.id==e.row.pivot._supply_by).name)+")",1),t[15]||(t[15]=o("th",null,"pzs / caj",-1)),o("th",null,"Disp. ("+n(C.value.find(p=>p.id==e.row.pivot._supply_by).name)+")",1)])]),o("tbody",null,[o("tr",Ye,[o("td",null,n(e.row.pivot.amount),1),o("td",null,n(e.row.pieces),1),o("td",null,[o("span",{class:re(B(e.row)>=1?"text-green-10":"text-pink-10")},n(Math.round(B(e.row))),3)])])])]),_:2},1024)]),e.row.pivot.comments||e.row.pivot._supply_by?(f(),_(fe,{key:0,rounded:"",class:""},{default:i(()=>[o("span",He,[t[16]||(t[16]=v(" Se surtira la cantidad de ")),o("span",Xe,n(e.row.pivot.units)+"pz",1),v(" correspondiente a la unidad de "+n(C.value.find(p=>p.id==e.row.pivot._supply_by).name)+" ",1),s(m,{dark:""}),v(" Notas: "+n(e.row.pivot.comments),1)])]),_:2},1024)):x("",!0)]),_:2},1032,["onClick"])])]),bottom:i(e=>[s(xe,{position:"bottom",class:"full-width",offset:[0,18]},{default:i(()=>[o("div",Ze,[s(_e,{rounded:"",class:""},{default:i(()=>[e.pagesNumber>2?(f(),_(r,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):x("",!0),s(r,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),s(r,{flat:"",disable:"","no-caps":""},{default:i(()=>[v(n(e.pagination.page)+" / "+n(e.pagesNumber),1)]),_:2},1024),s(r,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(f(),_(r,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):x("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","filter","pagination"]),s(A,{modelValue:l.value.state,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.state=e),position:"bottom"},{default:i(()=>[l.value.val?(f(),_(S,{key:0},{default:i(()=>[s(Q,{class:"item-center"},{default:i(()=>[o("div",et,[o("div",tt,n(l.value.val.code),1),t[17]||(t[17]=o("div",{class:"text-subtitle2 col text-bold text-center"},null,-1)),o("div",lt,n(l.value.val.name),1)]),o("div",ot,n(l.value.val.description),1)]),_:1}),s(Q,null,{default:i(()=>[o("div",at,[o("div",st,[o("div",it,[t[18]||(t[18]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),s(r,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:t[2]||(t[2]=e=>l.value.val.pivot.amount++)}),s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",nt,[U(o("input",{type:"number",min:"1","onUpdate:modelValue":t[3]||(t[3]=e=>l.value.val.pivot.amount=e),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[ce,l.value.val.pivot.amount]])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(r,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:t[4]||(t[4]=e=>l.value.val.pivot.amount>1?l.value.val.pivot.amount--:"")})])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",dt,[s(ge,{dense:"",filled:"",modelValue:l.value.val.units,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.val.units=e),options:C.value,label:"Surtir por","option-label":"name",disable:""},null,8,["modelValue","options"]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(j,{dense:"",filled:"",modelValue:l.value.val.pivot.comments,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.val.pivot.comments=e),type:"text",label:"Notas"},null,8,["modelValue"]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(ve,null,{default:i(()=>[s(F,{class:"bg-grey-11"},{default:i(()=>[s(w,{class:"text-left text-caption text-bold"},{default:i(()=>[v("STOCK "+n(l.value.val.stocks.find(e=>e.id==d.value.to.id).alias),1)]),_:1}),s(w,{class:"text-bold text-center"},{default:i(()=>[v(n(K.value)+" "+n(l.value.val.units.id==3?"Cjs":l.value.val.units.id==2?"Dcns":"Pzs"),1)]),_:1})]),_:1}),s(F,{class:"bg-grey-11"},{default:i(()=>[s(w,{class:"text-left text-caption"},{default:i(()=>t[19]||(t[19]=[v("P x C")])),_:1}),s(w,{class:"text-bold text-center"},{default:i(()=>[v(n(l.value.val.pieces)+" pzs",1)]),_:1})]),_:1}),s(F,null,{default:i(()=>[s(w,{class:"text-left text-caption"},{default:i(()=>t[20]||(t[20]=[v("Unidades")])),_:1}),s(w,{class:"text-bold text-center"},{default:i(()=>[v(n(L.value)+" pzs",1)]),_:1})]),_:1})]),_:1})])])]),_:1}),s(M,null,{default:i(()=>[s(ke),l.value.edit?x("",!0):(f(),_(r,{key:0,flat:"",icon:"add",color:"positive",onClick:H})),l.value.edit?(f(),_(r,{key:1,flat:"",icon:"delete",color:"negative",onClick:Z})):x("",!0),l.value.edit?(f(),_(r,{key:2,flat:"",icon:"edit",color:"warning",onClick:X})):x("",!0)]),_:1})]),_:1})):x("",!0)]),_:1},8,["modelValue"]),s(A,{modelValue:k.value.state,"onUpdate:modelValue":t[8]||(t[8]=e=>k.value.state=e),persistent:""},{default:i(()=>[s(S,null,{default:i(()=>[s(Q,{class:"text-center text-h5 text-bold"},{default:i(()=>t[21]||(t[21]=[v(" Resultados de Importacion ")])),_:1}),s(Q,{class:"text-centet text-h6 text-bold"},{default:i(()=>[v(" Correctos: "+n(k.value.added.length),1)]),_:1}),s(Q,null,{default:i(()=>[t[22]||(t[22]=v(" Modelos sin Coincidencia: ")),o("span",ut,n(k.value.notfound),1)]),_:1}),s(M,{align:"right"},{default:i(()=>[U(s(r,{flat:"",label:"OK",color:"primary"},null,512),[[we]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d.value._status==1?(f(),_(be,{key:0,reveal:"",elevated:"",bordered:""},{default:i(()=>[s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",rt,[o("div",null,[s(r,{icon:"upload",flat:"",onClick:ee})]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(S,{class:"col"},{default:i(()=>[s(Ce,{checkState:!1,onInput:J,with_prices_Invoice:"",with_stock_cedis:d.value.to.id,onAgregar:W,with_locations:""},null,8,["with_stock_cedis"])]),_:1}),s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[d.value.products.length>0?(f(),_(r,{key:0,flat:"",icon:"send",onClick:le})):x("",!0)])]),s(m,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})):x("",!0),o("input",{type:"file",ref_key:"inputFile",ref:R,id:"inputFile",onInput:te,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1})):x("",!0)}};export{ol as default};
