import{Q as R}from"./QSeparator.c32f99e7.js";import{r as y,c as L,o as X,a as Y,w as s,e as t,i as C,a3 as f,Y as U,Q as k,f as $,a4 as h,a$ as J,a2 as T}from"./index.6ca8bdb6.js";import{Q as G}from"./QToolbar.59460f7b.js";import{Q as Z}from"./QHeader.a0575ebc.js";import{u as ee,Q as z,a as N}from"./use-quasar.3e498049.js";import{Q as E}from"./QSelect.395da8b8.js";import{Q as oe}from"./QForm.d87d89b6.js";import{Q as D}from"./QDialog.c6d07cd7.js";import{Q as F}from"./QInput.506a347f.js";import{Q as ae,a as g}from"./QTr.402a8358.js";import{Q as te}from"./QTable.2ff07595.js";import{Q as le}from"./QCardActions.05396ed7.js";import{Q as se}from"./QPage.2a842a94.js";import{Q as ie,a as re}from"./QLayout.e251f6e7.js";import{C as j}from"./ClosePopup.869c6593.js";import{u as ne}from"./VDB.44bde70e.js";import{_ as ue}from"./UserToolbar.49278376.js";import{v as Q,a as ce}from"./axios.ae0a941c.js";import"./jspdf.plugin.autotable.6d44d31e.js";import{E as de}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import"./QResizeObserver.ebcc1e20.js";import"./use-key-composition.3eebbe0d.js";import"./uid.42677368.js";import"./position-engine.a6ab6a25.js";import"./rtl.b51694b1.js";import"./QList.572daafa.js";import"./QLinearProgress.d6cb8637.js";import"./QCheckbox.352ac619.js";import"./axios.f1f32898.js";import"./_commonjsHelpers.88e99c8f.js";var V={getSeccion(d){return Q.get(`/resources/getSeccion/${d}`).then(i=>i.data).catch(i=>({fail:i}))},getProductsCompare(d,i){return Q.post(`/resources/getProductReport/${d}`,i).then(u=>u.data).catch(u=>({fail:u}))},getProductsCompareLocation(d,i){return Q.post(`/resources/getProductReportLocations/${d}`,i).then(u=>u.data).catch(u=>({fail:u}))},create(d){return Q.post("/resources/create",d).then(i=>i.data).catch(i=>({fail:i}))},preview(d){return Q.post("/resources/preview",d).then(i=>i.data).catch(i=>({fail:i}))}};const me=C("span",{class:"text-h6"},"Resurtido",-1),pe=C("div",{class:"text-h6 text-center"},"Impresora",-1),fe={class:"row"},ve=C("div",{class:"text-h6"},"Agrega una nota",-1),Ke={__name:"RequisitionLYT",setup(d){const i=ne(),u=ee(),B=y({status:!1}),m=y({val:null,opts:[]}),p=y({val:[],opts:[]}),b=y([]),_=y(null),c=y({state:!1,val:null,body:[]}),v=y({val:null,opts:[]}),S=y({columns:[{name:"codigo",label:"Codigo",align:"left",sortable:!0,field:e=>e.code},{name:"description",label:"Descripcion",align:"left",sortable:!0,field:e=>e.description},{name:"Familia",label:"Familia",align:"left",sortable:!0,field:e=>e.categories.familia.name},{name:"Categoria",label:"Categoria",align:"left",sortable:!0,field:e=>e.categories.name},{name:"pieces",label:"PXC",align:"center",sortable:!0,field:e=>e.pieces},{name:"cedis",label:"Cedis",align:"center",sortable:!0,field:e=>e.cedis},{name:"texcoco",label:"Texcoco",align:"center",sortable:!0,field:e=>e.texcoco},{name:"Sucursal",label:`${i.session.store.name}`,align:"center",sortable:!0,field:e=>e.sucursal},{name:"action",align:"center"}],filter:""}),x=L(()=>b.value.map(e=>{let o=Math.round(Number(e.stocks.filter(n=>n.id==1).map(n=>n.pivot.stock))/Number(e.pieces)),r=Math.round(Number(e.stocks.filter(n=>n.id==2).map(n=>n.pivot.stock))/Number(e.pieces)),l=Number(e.stocks.filter(n=>n.id==i.session.store.id_viz).map(n=>n.pivot.stock)),a=Math.round(Number(e.stocks.filter(n=>n.id==i.session.store.id_viz).map(n=>n.pivot.stock))*100/Number(e.pieces));return{id:e.id,name:e.name,code:e.code,cost:e.cost,description:e.description,categories:e.categories,pieces:e.pieces,cedis:o,texcoco:r,sucursal:l,percentage:a}}).filter(e=>e.cedis+e.texcoco>0&&e.percentage<=20)),P=L(()=>p.value.val.length>0?x.value.filter(e=>p.value.val.includes(e.categories.name)):x.value),q=async()=>{let e=i.session.store.id_viz;u.loading.show({message:"Obteniendo secciones"});const o=await V.getSeccion(e);o.fail?console.log(o):(console.log(o),m.value.opts=o.families,v.value.opts=o.locations?o.locations[0].sections:null,u.loading.hide()),console.log(o)},I=async()=>{if(m.value.val){u.loading.show({message:"Obteniendo Reporte"}),console.log(m.value.val.map(l=>l.id));let e=i.session.store.id_viz,o=m.value.val.map(l=>l.id);const r=await V.getProductsCompare(e,{data:o});r.fail?console.log(r):(u.loading.hide(),console.log(r),b.value=r,b.value.forEach(l=>{const a=l.categories.name;a&&!p.value.opts.includes(a)&&p.value.opts.push(a)}))}},O=async()=>{if(v.value.val){console.log(v.value.val),u.loading.show({message:"Obteniendo Reporte"}),console.log(v.value.val.map(l=>l.id));let e=i.session.store.id_viz,o=v.value.val.map(l=>l.id);const r=await V.getProductsCompareLocation(e,{data:o});console.log(r),r.fail?console.log(r):(u.loading.hide(),console.log(r),b.value=r,b.value.forEach(l=>{const a=l.categories.name;a&&!p.value.opts.includes(a)&&p.value.opts.push(a)}))}},A=async()=>{u.loading.show({message:"Creando Pedido"});let e={workpoint_from:i.session.store.id_viz,workpoint_to:1,products:P.value,notes:_.value,id_userviz:i.session.id,type:2};console.log(e);const o=await V.create(e);o.fail?console.log(o):(console.log(o),u.notify({message:`Se creo el pedido ${o.order.id}`,type:"positive",position:"center"}),b.value=[],_.value=[],m.value.val=null,p.value.val=[],u.loading.hide())},H=e=>{console.log(e);let o=b.value.findIndex(r=>r.id===e.id);console.log(o),o>=0&&b.value.splice(o,1)},M=async()=>{console.log("aqui imprimo");let e={products:P.value,from:i.session.store,ip_address:c.value.val.ip_address};const o=await V.preview(e);o.fail?console.log(o):(console.log(o),u.notify({message:"Impresion Correcta",type:"positive",position:"center"}),c.value.val=null,c.value.state=!1)},K=async()=>{const e=new de.Workbook,o=e.addWorksheet("Resurtido");console.log(),o.addTable({name:"Resurtido",ref:"A1",headerRow:!0,totalsRow:!1,style:{showRowStripes:!0},columns:[{name:"Codigo",filterButton:!0},{name:"Descripcion",filterButton:!0},{name:"Seccion",filterButton:!0},{name:"Familia",filterButton:!0},{name:"Categoria",filterButton:!0},{name:"PXC",filterButton:!0},{name:"Cedis",filterButton:!0},{name:"Texcoco",filterButton:!0},{name:"Sucursal",filterButton:!0},{name:"Porcentaje",filterButton:!0}],rows:P.value.map(l=>[l.code,l.description,l.categories.familia.seccion.name,l.categories.familia.name,l.categories.name,l.pieces,l.cedis,l.texcoco,l.sucursal,l.percentage])}),o.columns.forEach(l=>{let a=0;l.eachCell({includeEmpty:!0},n=>{const w=n.value?n.value.toString().length:10;w>a&&(a=w)}),l.width=a<10?10:a}),(async()=>{const l=await e.xlsx.writeBuffer(),a=new Blob([l],{type:"application/octet-stream"}),n=URL.createObjectURL(a),w=document.createElement("a");w.href=n,w.download="Resurtido.xlsx",document.body.appendChild(w),w.click(),document.body.removeChild(w)})()},W=async()=>{let e=i.session.store.id;console.log(e);try{let o=await ce.get(`/cashier/getPrinters/${e}`);o.status==200&&(c.value.body=o.data,console.log(o),c.value.state=!0)}catch(o){console.log(o),u.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}};return q(),(e,o)=>(X(),Y(ie,{view:"hHh Lpr fFf"},{default:s(()=>[t(Z,{class:"transparent text-dark",bordered:""},{default:s(()=>[t(ue),t(R),t(G,{class:"justify-between"},{default:s(()=>[C("div",null,[f("Helpers "),t(U,{name:"navigate_next",color:"primary"}),f(),me])]),_:1})]),_:1}),t(D,{modelValue:c.value.state,"onUpdate:modelValue":o[1]||(o[1]=r=>c.value.state=r)},{default:s(()=>[t(z,{class:"my-card"},{default:s(()=>[t(N,null,{default:s(()=>[pe]),_:1}),t(N,null,{default:s(()=>[t(oe,{onSubmit:M,class:"q-gutter-md"},{default:s(()=>[t(E,{dense:"","option-label":"name",modelValue:c.value.val,"onUpdate:modelValue":o[0]||(o[0]=r=>c.value.val=r),options:c.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),C("div",null,[t(k,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:c.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(re,null,{default:s(()=>[t(se,{padding:""},{default:s(()=>{var r,l;return[C("div",fe,[t(E,{class:"col",modelValue:v.value.val,"onUpdate:modelValue":o[2]||(o[2]=a=>v.value.val=a),options:v.value.opts,label:"Ubicacion","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:O,disable:((r=m.value.val)==null?void 0:r.length)>0},null,8,["modelValue","options","disable"]),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(E,{class:"col",modelValue:m.value.val,"onUpdate:modelValue":o[3]||(o[3]=a=>m.value.val=a),options:m.value.opts,label:"Familia","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:I,disable:((l=v.value.val)==null?void 0:l.length)>0},null,8,["modelValue","options","disable"]),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(E,{class:"col",modelValue:p.value.val,"onUpdate:modelValue":o[4]||(o[4]=a=>p.value.val=a),options:p.value.opts,label:"Categoria",filled:"",disable:!m.value.val,multiple:"","use-chips":""},null,8,["modelValue","options","disable"])]),t(R,{spaced:"",inset:"",vertical:"",dark:""}),t(te,{rows:$(P),columns:S.value.columns,separator:"cell",filter:S.value.filter},{"top-right":s(()=>[t(F,{borderless:"",dense:"",debounce:"300",modelValue:S.value.filter,"onUpdate:modelValue":o[5]||(o[5]=a=>S.value.filter=a),placeholder:"Buscar"},{append:s(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"]),t(k,{color:"primary","icon-right":"send",flat:"",onClick:o[6]||(o[6]=a=>B.value.state=!B.value.state),disable:$(x).length==0},null,8,["disable"]),t(k,{color:"primary",icon:"print",flat:"",onClick:W,disable:$(x).length==0},null,8,["disable"]),t(k,{color:"primary",icon:"download",flat:"",onClick:K,disable:$(x).length==0},null,8,["disable"])]),body:s(a=>[t(ae,{props:a},{default:s(()=>[t(g,{key:"codigo",props:a},{default:s(()=>[f(h(a.row.code),1)]),_:2},1032,["props"]),t(g,{key:"description",props:a},{default:s(()=>[f(h(a.row.description),1)]),_:2},1032,["props"]),t(g,{key:"Familia",props:a},{default:s(()=>[f(h(a.row.categories.familia.name),1)]),_:2},1032,["props"]),t(g,{key:"Categoria",props:a},{default:s(()=>[f(h(a.row.categories.name),1)]),_:2},1032,["props"]),t(g,{key:"pieces",props:a},{default:s(()=>[f(h(a.row.pieces),1)]),_:2},1032,["props"]),t(g,{key:"cedis",props:a},{default:s(()=>[f(h(a.row.cedis),1)]),_:2},1032,["props"]),t(g,{key:"texcoco",props:a},{default:s(()=>[f(h(a.row.texcoco),1)]),_:2},1032,["props"]),t(g,{key:"Sucursal",props:a},{default:s(()=>[f(h(a.row.sucursal),1)]),_:2},1032,["props"]),t(g,{key:"action",props:a},{default:s(()=>[t(k,{color:"negative",icon:"delete",onClick:n=>H(a.row),flat:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),t(D,{modelValue:B.value.state,"onUpdate:modelValue":o[10]||(o[10]=a=>B.value.state=a),persistent:""},{default:s(()=>[t(z,{style:{"min-width":"350px"}},{default:s(()=>[t(N,null,{default:s(()=>[ve]),_:1}),t(N,{class:"q-pt-none"},{default:s(()=>[t(F,{dense:"",modelValue:_.value,"onUpdate:modelValue":o[7]||(o[7]=a=>_.value=a),autofocus:"",onKeyup:o[8]||(o[8]=J(a=>e.prompt=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(le,{align:"right",class:"text-primary"},{default:s(()=>[T(t(k,{flat:"",label:"Cancelar",onClick:o[9]||(o[9]=a=>_.value=null)},null,512),[[j]]),T(t(k,{flat:"",label:"Enviar Pedido",onClick:A},null,512),[[j]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1})]),_:1})]),_:1}))}};export{Ke as default};
