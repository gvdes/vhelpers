import{u as X,r as Q,g as A,a as i,h as p,i as a,d as e,a4 as T,k as f,j as u,ah as Z,n as x,a7 as z,m as h,c as w,p as b,aE as Y,Q as D,bw as G,l as I,a1 as c,a2 as J,a3 as K,a5 as S,a6 as W,b5 as ee,aX as L,bk as le,aj as ae}from"./index.12f3892e.js";import{Q as te}from"./QHeader.c41c9533.js";import{c as se,Q as O}from"./QSelect.f2b7a151.js";import{Q as oe}from"./QForm.315f2be3.js";import{Q as ue}from"./QToolbar.89e174eb.js";import{Q as U,a as E,b as r}from"./QList.76900103.js";import{Q as re}from"./QPage.1de9ccfc.js";import{Q as ne,a as ie}from"./QLayout.111ce811.js";import{C as de}from"./ClosePopup.9250a65c.js";import{_ as me}from"./UserToolbar.367e914b.js";import{a as ve,b as P}from"./axios.087c86e4.js";import{u as pe}from"./use-quasar.ad7bddfa.js";import"./QResizeObserver.eaf763c1.js";import"./QScrollObserver.00fad532.js";import"./QImg.60cba884.js";import"./QSpace.56cadeb4.js";import"./QExpansionItem.c6479fcd.js";import"./CandyBus.73965bf9.js";import"./auth.9cdf3e31.js";const fe={key:0,class:"text-right"},ce={class:"row justify-center"},be={class:"text-bold text-h5"},Pe={__name:"ValeLYT",setup(ye){const g=X(),m=pe(),R=g.series,k=Q(null),C=Q(""),n=Q({state:!1,body:null}),d=Q({state:!1,val:null,body:null}),V=Q(""),v=Q([]),$=A(()=>k.value&&C.value.length),B=A(()=>V.value?n.value.body.product.filter(o=>o.ARTICULO.includes(V.value)):n.value.body.product),y=A(()=>m.platform.is.mobile),F=A(()=>v.value.length>0?v.value.every(o=>Number(o.change)>0)&&v.value.every(o=>Number(o.change)<=Number(o.CANTIDAD)):!1),N=async()=>{let o=g.session.store.id;console.log(o);try{let l=await ve.get(`/cashier/getPrinters/${o}`);l.status==200&&(d.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),m.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},q=async()=>{m.loading.show({message:"Obteniendo Ticket"}),n.value.body=null;let o={type:"Modificacion",serie:k.value,folio:C.value},t=`http://${g.session.store.ip_address}/access/public/modify/newmod`;P.post(t,o).then(s=>{console.log(s),n.value.state=!0,n.value.body=s.data,m.loading.hide()}).catch(s=>{console.log(s.response.data.message),m.notify({html:!0,message:s.response.data.message,color:"negative",position:"center"})})},j=()=>{d.value.state=!0},H=()=>{m.loading.show({message:"Obteniendo Ticket"}),v.value.map(s=>s._chantot=s.change*s.PRECIO);let o={ticket:n.value.body.ticket,products:v.value,print:d.value.val,created:`${g.session.name} - ${g.session.store.alias}`},t=`http://${g.session.store.ip_address}/access/public/modify/createVal`;P.post(t,o).then(s=>{console.log(s),s.data.mmsg&&(m.notify({message:`devolucion ${s.data.devolucion}`,type:"positive",position:"center"}),m.notify({message:`vale ${s.data.vale}`,type:"positive",position:"center"})),k.value=null,C.value="",n.value={state:!1,body:null},d.value={state:!1,val:null,body:null},V.value="",v.value=[],m.loading.hide()}).catch(s=>{console.log(s),m.notify({html:!0,message:s,color:"negative",position:"center"})}),console.log(o)},M=()=>{k.value=null,C.value="",n.value={state:!1,body:null},d.value={state:!1,val:null,body:null},V.value="",v.value=[]};return N(),N(),(o,l)=>(i(),p(ne,{view:"hHh Lpr fFf"},{default:a(()=>[e(te,{class:"transparent text-dark",bordered:""},{default:a(()=>[e(me),e(T)]),_:1}),e(ie,{class:""},{default:a(()=>[e(re,{class:"",padding:""},{default:a(()=>[e(ue,{class:"justify-between"},{default:a(()=>[f("div",null,[l[6]||(l[6]=u("Helpers ")),e(Z,{name:"navigate_next",color:"primary"}),l[7]||(l[7]=u()),l[8]||(l[8]=f("span",{class:"text-h6"},"VALES",-1))]),e(x,{color:"primary",icon:"add"},{default:a(()=>[e(se,null,{default:a(()=>[l[9]||(l[9]=f("div",{class:"q-pa-md text-primary"},"Buscar Folio",-1)),e(T),e(oe,{dense:"",onSubmit:q,class:"q-gutter-md q-pa-md"},{default:a(()=>[e(O,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=t=>k.value=t),options:z(R),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(h,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=t=>C.value=t),type:"number",label:"Folio"},null,8,["modelValue"]),$.value?(i(),w("div",fe,[e(x,{type:"submit",color:"primary",icon:"search"})])):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),f("div",ce,[e(Y,{name:"bounce"},{default:a(()=>[n.value.state?(i(),p(D,{key:0,flat:"",bordered:"",style:G(`width: ${y.value?"100%;":"70%;"}`)},{default:a(()=>[e(I,null,{default:a(()=>[f("div",be,"Ticket: "+c(n.value.body.ticket.ticket),1),f("div",null,"N\xBA Cliente: "+c(n.value.body.ticket.codcli),1),f("div",null,"Cliente: "+c(n.value.body.ticket.cliente),1),f("div",null,"Fecha: "+c(n.value.body.ticket.fecha),1)]),_:1}),e(I,{class:"text-center text-bold"},{default:a(()=>l[10]||(l[10]=[u(" Selecciona los productos que se creara el vale ")])),_:1}),e(I,null,{default:a(()=>[e(h,{modelValue:V.value,"onUpdate:modelValue":l[2]||(l[2]=t=>V.value=t),type:"text",label:"Buscar",filled:""},null,8,["modelValue"])]),_:1}),e(I,null,{default:a(()=>[e(U,{bordered:""},{default:a(()=>[e(E,{dense:""},{default:a(()=>[e(r,null,{default:a(()=>l[11]||(l[11]=[u("ARTICULO")])),_:1}),y.value?b("",!0):(i(),p(r,{key:0,class:"text-left"},{default:a(()=>l[12]||(l[12]=[u("DESCRIPCION")])),_:1})),e(r,{class:"text-right"},{default:a(()=>l[13]||(l[13]=[u("CANTIDAD")])),_:1}),y.value?b("",!0):(i(),p(r,{key:1,class:"text-right"},{default:a(()=>l[14]||(l[14]=[u("PRECIO")])),_:1})),y.value?b("",!0):(i(),p(r,{key:2,class:"text-right"},{default:a(()=>l[15]||(l[15]=[u("TOTAL")])),_:1})),e(r,null,{default:a(()=>l[16]||(l[16]=[u(" SELECT ")])),_:1}),e(r,null,{default:a(()=>l[17]||(l[17]=[u(" PIEZAS A DEV")])),_:1}),e(T,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),e(T,{spaced:"",inset:"",vertical:"",dark:""}),(i(!0),w(K,null,J(B.value,(t,s)=>(i(),p(U,{bordered:"",key:s},{default:a(()=>[L((i(),p(E,{dense:"",tag:"label"},{default:a(()=>[e(r,null,{default:a(()=>[u(c(t.ARTICULO),1)]),_:2},1024),y.value?b("",!0):(i(),p(r,{key:0,class:"text-left"},{default:a(()=>[u(c(t.DESCRIPCION),1)]),_:2},1024)),e(r,{class:"text-right"},{default:a(()=>[u(c(Number(t.CANTIDAD).toFixed(2)),1)]),_:2},1024),y.value?b("",!0):(i(),p(r,{key:1,class:"text-right"},{default:a(()=>[u(c(Number(t.PRECIO).toFixed(2)),1)]),_:2},1024)),y.value?b("",!0):(i(),p(r,{key:2,class:"text-right"},{default:a(()=>[u(c(Number(t.TOTAL).toFixed(2)),1)]),_:2},1024)),e(r,null,{default:a(()=>[e(le,{modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=_=>v.value=_),val:t},null,8,["modelValue","val"])]),_:2},1024),e(r,null,{default:a(()=>[e(h,{modelValue:t.change,"onUpdate:modelValue":_=>t.change=_,type:"number",label:"PZ",outlined:"",error:t.change>Number(t.CANTIDAD),"error-message":"es mayor que la cantidad X(",disable:!v.value.some(_=>_.ARTICULO===t.ARTICULO)},null,8,["modelValue","onUpdate:modelValue","error","disable"])]),_:2},1024),e(T,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024)),[[ae]])]),_:2},1024))),128))]),_:1}),f("div",null,[e(S,{align:"between"},{default:a(()=>[e(x,{flat:"",icon:"cancel",onClick:M}),e(x,{flat:"",icon:"arrow_forward",disable:!F.value,onClick:j},null,8,["disable"])]),_:1})])]),_:1},8,["style"])):b("",!0)]),_:1})]),e(W,{modelValue:d.value.state,"onUpdate:modelValue":l[5]||(l[5]=t=>d.value.state=t),persistent:""},{default:a(()=>[e(D,null,{default:a(()=>[e(I,{class:"row items-center"},{default:a(()=>[e(ee,{icon:"print",color:"primary","text-color":"white"}),l[18]||(l[18]=f("span",{class:"q-ml-sm"},"Selecciona Impresora",-1))]),_:1}),e(I,null,{default:a(()=>[e(O,{modelValue:d.value.val,"onUpdate:modelValue":l[4]||(l[4]=t=>d.value.val=t),options:d.value.body,label:"Impresora","option-label":"name",filled:""},null,8,["modelValue","options"])]),_:1}),e(S,{align:"right"},{default:a(()=>[L(e(x,{flat:"",label:"Cancel",color:"negative"},null,512),[[de]]),e(x,{flat:"",label:"Continuar",color:"positive",onClick:H,disable:!d.value.val},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Pe as default};
