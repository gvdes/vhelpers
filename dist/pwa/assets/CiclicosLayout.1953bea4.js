import{Q as Y,c as X}from"./QSeparator.cc594f43.js";import{Q as K}from"./QHeader.3e0dec74.js";import{r as w,c as h,o as S,g as I,d as R,w as u,e as n,f,a0 as L,a1 as z,Q as T,a6 as U,a3 as F,a4 as Z,h as j,aH as ee,a as te,u as oe,m as ae,S as le,aI as se}from"./index.a996e2bc.js";import{Q as ne,d as re}from"./QSelect.a465bb99.js";import{Q as ie}from"./QInput.b8856860.js";import{Q as de}from"./QForm.5fd700d5.js";import{Q as ue}from"./QToolbar.b4409ba4.js";import{Q as P}from"./QTable.241b3670.js";import{a as H,Q as A}from"./QCard.9a36efc8.js";import{Q as ce}from"./QPage.6de0c99c.js";import{Q as me,a as fe}from"./QLayout.97815216.js";import{v as O,u as pe}from"./axios.13708793.js";import{d as V}from"./dayjs.min.cbcf888d.js";import{_ as ve}from"./UserToolbar.ee052bf2.js";import{Q as N,a as ge,b as q}from"./QTabPanels.de40a9f8.js";import{Q as be}from"./QTabs.f1d3205b.js";import{E as ye}from"./exceljs.min.9e24d01d.js";import{c as D}from"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.08146584.js";import"./QList.425ee15a.js";import"./QLinearProgress.80ba80eb.js";import"./QCheckbox.27d249eb.js";import"./QScrollObserver.1d28df49.js";import"./QExpansionItem.6ddeb7ab.js";import"./QDrawer.69ec4bec.js";import"./touch.9135741d.js";import"./QCardActions.25ca6b75.js";import"./ClosePopup.4a561a41.js";import"./auth.7d524c30.js";import"./use-render-cache.3aae9b27.js";var W={index({dateranges:C,view:k,store:v}){let b=k.id;return C.to,C.from,O.get(`/ciclicos?v=${b}&store=${v}`).then(_=>_.data).catch(_=>({fail:_}))},find(C,k){return O.get(`/ciclicos/${C}?store=${k}`).then(v=>v.data).catch(v=>({fail:v}))}},G={exports:{}};(function(C,k){(function(v,b){b()})(D,function(){function v(a,e){return typeof e=="undefined"?e={autoBom:!1}:typeof e!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function b(a,e,m){var l=new XMLHttpRequest;l.open("GET",a),l.responseType="blob",l.onload=function(){x(l.response,e,m)},l.onerror=function(){console.error("could not download file")},l.send()}function _(a){var e=new XMLHttpRequest;e.open("HEAD",a,!1);try{e.send()}catch{}return 200<=e.status&&299>=e.status}function s(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(e)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof D=="object"&&D.global===D?D:void 0,g=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),x=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!g?function(a,e,m){var l=d.URL||d.webkitURL,c=document.createElement("a");e=e||a.name||"download",c.download=e,c.rel="noopener",typeof a=="string"?(c.href=a,c.origin===location.origin?s(c):_(c.href)?b(a,e,m):s(c,c.target="_blank")):(c.href=l.createObjectURL(a),setTimeout(function(){l.revokeObjectURL(c.href)},4e4),setTimeout(function(){s(c)},0))}:"msSaveOrOpenBlob"in navigator?function(a,e,m){if(e=e||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(v(a,m),e);else if(_(a))b(a,e,m);else{var l=document.createElement("a");l.href=a,l.target="_blank",setTimeout(function(){s(l)})}}:function(a,e,m,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof a=="string")return b(a,e,m);var c=a.type==="application/octet-stream",M=/constructor/i.test(d.HTMLElement)||d.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||c&&M||g)&&typeof FileReader!="undefined"){var Q=new FileReader;Q.onloadend=function(){var p=Q.result;p=E?p:p.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=p:location=p,l=null},Q.readAsDataURL(a)}else{var i=d.URL||d.webkitURL,r=i.createObjectURL(a);l?l.location=r:location.href=r,l=null,setTimeout(function(){i.revokeObjectURL(r)},4e4)}});d.saveAs=x.saveAs=x,C.exports=x})})(G);var we=G.exports;const ke={class:"row justify-between"},he={class:"text-h6"},_e={class:"text-subtitle2"},xe={class:"text-subtitle2"},Ce={class:"text-subtitle2"},Qe={class:"text-white"},Se={__name:"Viewer",props:{folio:[String,Number],store:[String,Number]},emits:["errorsearch"],setup(C,{emit:k}){const v=C,b=v.folio,_=v.store,s=w(null),d=w(null),g=w("body"),x=w(null),a=w({cols:[{name:"id",field:"id",label:"ID",align:"left"},{name:"lcode",field:"code",label:"Codigo"},{name:"scode",field:"name",label:"Codigo C."},{name:"descr",field:"description",label:"Articulo",align:"left",classes:"fs-dec4"},{name:"sai",field:i=>i.ordered.stocks,label:"SAI",align:"center"},{name:"counteds",field:i=>i.ordered.stocks_acc,label:"UC",align:"center"},{name:"sat",field:i=>{var r;return(r=i.ordered.stocks_end)!=null?r:"--"},label:"SAT",align:"center"},{name:"ufus",field:i=>i.ordered.stocks_acc-i.ordered.stocks,label:"UF/US",align:"center"},{name:"locs",field:i=>i.locations.map(r=>r.path).join(", "),label:"Ubicacion (es)",align:"left"}]}),e=h(()=>s.value?s.value.created_by:null),m=h(()=>s.value?s.value.log:[]),l=h(()=>s.value&&s.value.responsables&&s.value.responsables.length?s.value.responsables.map(i=>i.nick).join(","):""),c=h(()=>s.value&&s.value.products&&s.value.products.length?s.value.products:[]),M=h(()=>s.value?s.value.status.name:"");h(()=>""),h(()=>""),(async()=>{const i=await W.find(b,_);console.log(i),i.fail?d.value=i.fail:s.value=i.inventory})();const Q=i=>{let r=`INV_${s.value.id}_${s.value.workpoint.alias}.xlsx`;console.log(r);let p=new ye.Workbook,t=p.addWorksheet("Sheet1");t.columns=[{header:"ID",key:"id"},{header:"Codigo",key:"lcode"},{header:"Codigo C.",key:"scode"},{header:"Articulo",key:"description"},{header:"SAI",key:"sai"},{header:"UC",key:"uc"},{header:"SAT",key:"sat"},{header:"UF/US",key:"ufus"},{header:"Ubicacion(es)",key:"locs"}],c.value.forEach(o=>{t.addRow({id:o.id,lcode:o.code,scode:o.name,description:o.description,sai:parseInt(o.ordered.stocks),uc:parseInt(o.ordered.stocks_acc),sat:parseInt(o.ordered.stocks_end),ufus:parseInt(o.ordered.stocks_acc)-parseInt(o.ordered.stocks),locs:o.locations.map(y=>y.path).join(", ")})}),t.getCell("L2").value="Folio:",t.getCell("M2").value=s.value.id,t.getCell("L3").value="Sucursal:",t.getCell("M3").value=s.value.workpoint.name,t.getCell("L4").value="Estado:",t.getCell("M4").value=M.value,t.getCell("L5").value="Creado por:",t.getCell("M5").value=e.value?e.value.names:"",t.getCell("L6").value="Realizado por:",t.getCell("M6").value=l.value,t.getCell("L7").value="Inicio:",t.getCell("M7").value="",t.getCell("L8").value="Termino:",t.getCell("M8").value="",p.xlsx.writeBuffer().then(o=>we(new Blob([o],{type:"application/octet-stream"}),r))};return(i,r)=>(S(),I(F,null,[s.value?(S(),R(A,{key:0,class:"my-card"},{default:u(()=>[n(H,null,{default:u(()=>[f("div",ke,[f("div",he,"Inventario "+L(z(b)),1),f("div",null,[n(T,{color:"primary",label:"descargar",onClick:Q})])]),f("div",_e,[r[2]||(r[2]=U("Creado por: ")),f("b",null,L(e.value?e.value.names:"Nobody"),1)]),f("div",xe,[r[3]||(r[3]=U("Realizado por: ")),f("b",null,L(l.value),1)]),f("div",Ce,[r[4]||(r[4]=U("Estado: ")),f("b",null,L(M.value),1)])]),_:1}),n(be,{modelValue:g.value,"onUpdate:modelValue":r[0]||(r[0]=p=>g.value=p)},{default:u(()=>[n(N,{name:"log",label:"Log"}),n(N,{name:"body",label:"Resumen"})]),_:1},8,["modelValue"]),n(ge,{modelValue:g.value,"onUpdate:modelValue":r[1]||(r[1]=p=>g.value=p),animated:""},{default:u(()=>[n(q,{name:"log"},{default:u(()=>[r[5]||(r[5]=f("div",{class:"text-h6"},"Log",-1)),(S(!0),I(F,null,Z(m.value,(p,t)=>(S(),I("div",{key:t},[f("pre",null,L(p),1)]))),128))]),_:1}),n(q,{name:"body"},{default:u(()=>[n(P,{flat:"",rows:c.value,columns:a.value.cols,"row-key":"name",ref_key:"rowsproducts",ref:x},null,8,["rows","columns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):j("",!0),d.value?(S(),R(A,{key:1,class:"bg-negative"},{default:u(()=>[n(H,null,{default:u(()=>[f("pre",Qe,L(d.value),1)]),_:1})]),_:1})):j("",!0)],64))}},Me={class:"row items-center"},Le={key:0,class:"text-right"},st={__name:"CiclicosLayout",setup(C){const k=w(""),v=pe(),b=ee(),_=te(),s=oe(),d=w({state:!1,data:null}),g=w(null),x=w([]),a=w({cols:[{name:"id",field:"id",label:"Folio"},{name:"started",field:t=>V(t.created_at).format("YYYY/MM/DD HH:mm:ss"),label:"Creacion",align:"center"},{name:"status",field:t=>t.status.name,label:"Estado",align:"center"},{name:"ended",field:t=>{let o=t.log.find(y=>y.id==3);return o?V(o.pivot.created_at).format("YYYY/MM/DD HH:mm:ss"):"--"},align:"center",label:"Termino"},{name:"models",field:"products_count",label:"Modelos"},{name:"type",field:t=>t.type.name,label:"Tipo"},{name:"warehouse",field:t=>t.settings?t.settings.warehouse.name:"---",label:"Almacen"}]}),e=w([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"c",label:"otra ...",disable:!0}]),m=w({from:V(Date.now()).startOf("day"),to:V(Date.now()).endOf("day")}),l=h(()=>x.value.map(t=>(t.settings=JSON.parse(t.settings),t))),c=h(()=>k.value&&k.value.length),M=h(()=>m.value.from.format("YYYY/MM/DD")),E=h(()=>m.value.to.format("YYYY/MM/DD")),Q=()=>{console.log("searching folio"),d.value.folio=k.value,d.value.state=!0},i=async(t,o,y)=>{d.value.folio=o.id,d.value.state=!0},r=async()=>{var B;console.log(s.session),v.loading.show({message:"Cargado vista..."});let t=(B=b.query.v)!=null?B:"day",o=e.value.findIndex(J=>J.id==t),y=o>=0?o:0;console.log(y),g.value=e.value[y],m.value.from=V(Date.now()).startOf(g.value.id);const $=await W.index({dateranges:m,view:g.value,store:s.session.store.id_viz});console.log($),x.value=$.inventories,v.loading.hide()},p=()=>{_.push(`/ciclicos?v=${g.value.id}`)};return r(),ae(()=>b.query,()=>{r()}),(t,o)=>(S(),R(me,{view:"hHh Lpr fFf"},{default:u(()=>[n(K,{class:"bg-grey-3 text-dark",bordered:""},{default:u(()=>[n(ve),n(Y)]),_:1}),n(fe,null,{default:u(()=>[n(ue,{class:"justify-between"},{default:u(()=>[f("div",null,[o[3]||(o[3]=f("span",{class:"text-grey"},"Helpers",-1)),o[4]||(o[4]=U()),n(le,{name:"navigate_next",color:"primary"}),o[5]||(o[5]=U()),o[6]||(o[6]=f("span",{class:"text-h6"},"Ciclicos",-1))]),f("div",Me,[n(ne,{modelValue:g.value,"onUpdate:modelValue":[o[0]||(o[0]=y=>g.value=y),p],options:e.value,label:"Vista",autofocus:"",borderless:""},{prepend:u(()=>[n(T,{dense:"",flat:"",color:"primary",icon:"autorenew",onClick:se(r,["stop"])})]),_:1},8,["modelValue","options"]),n(T,{color:"primary",icon:"search",dense:"",flat:""},{default:u(()=>[n(re,null,{default:u(()=>[o[7]||(o[7]=f("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Inventario",-1)),n(Y),n(de,{dense:"",onSubmit:Q,class:"q-gutter-md q-pa-md"},{default:u(()=>[n(ie,{modelValue:k.value,"onUpdate:modelValue":o[1]||(o[1]=y=>k.value=y),type:"number",label:"Folio",autofocus:""},null,8,["modelValue"]),c.value?(S(),I("div",Le,[n(T,{type:"submit",color:"primary",icon:"search"})])):j("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),n(ce,{padding:""},{default:u(()=>[n(A,{class:"my-card",flat:""},{default:u(()=>[n(P,{title:`Inventarios del ${M.value} al ${E.value} [ ${x.value.length} ]`,rows:l.value,columns:a.value.cols,"row-key":"id",onRowClick:i},null,8,["title","rows","columns"])]),_:1}),n(X,{modelValue:d.value.state,"onUpdate:modelValue":o[2]||(o[2]=y=>d.value.state=y),"full-width":""},{default:u(()=>[n(Se,{folio:d.value.folio,store:z(s).session.store.id_viz},null,8,["folio","store"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{st as default};
