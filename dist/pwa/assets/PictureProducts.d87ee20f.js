import{Q as x}from"./QCardSection.5ead0201.js";import{b as y,a as z,Q as X,d as F,e as C}from"./QList.d698dd2f.js";import{Q as k}from"./QImg.9acf9e35.js";import{Q as G}from"./QUploader.2e9fad2b.js";import{u as H,r as w,l as J,o,d,w as t,f as r,e,g,ak as _,a0 as u,a1 as P,h as p,Q as j,U as K,a2 as D,a3 as A,a4 as W}from"./index.7940d7a9.js";import{Q as S}from"./QCardActions.605bacb9.js";import{Q as E}from"./QCard.1fd4176a.js";import{a as $}from"./QSelect.ec2f88bb.js";import{Q as Y}from"./QFooter.4c24cac0.js";import{Q as Z}from"./QPage.108bd070.js";import{C as ee}from"./ClosePopup.0874ff3d.js";import"./exceljs.min.9e24d01d.js";import{u as te}from"./use-quasar.3f4be582.js";import"./dayjs.min.cbcf888d.js";import{p as U}from"./productsApi.1199629b.js";import{u as ae}from"./ProductsStore.fa21179c.js";import{P as le}from"./ProductsAutocomplete.5aff1226.js";import{v as I}from"./axios.2da5c7d0.js";import"./use-key-composition.3a761bb2.js";import"./QResizeObserver.811c5f67.js";import"./_commonjsHelpers.88e99c8f.js";import"./QInput.26c66994.js";/* empty css                                                                         */const se={class:"row justify-center"},oe={key:0},re={class:"col"},ie={class:"text-bold"},ne={class:"col"},ue={class:"text-bold"},de={key:0,class:"col-6 flex flex-center"},ce={key:1,class:"col-6 flex flex-center"},ve={key:1},pe={class:"col-6 q-pa-sm flex flex--column justify-between"},me={class:"text-center text-bold text-red-10"},fe={class:"col"},ge={class:"text-bold"},_e={key:0,class:"col"},he={class:"text-bold"},xe={class:"text-green text-subtitle2 q-mb-sm"},ye={class:"text-negative text-subtitle2 q-mb-sm"},be={class:"row q-ml-sm"},Ge={__name:"PictureProducts",setup(ke){const h=te();H(),ae().setTitle("Imagenes Productos");const b=w(null),f=w(null),i=w({state:!1,result:{state:!1,val:null}}),a=w({state:!1,val:null}),Q=w(null),V=()=>{i.value.state=!0,Q.value.click()},B=()=>{b.value.pickFiles()},q=()=>{b.value&&b.value.reset(),f.value=null,a.value.state=!1},L=async()=>{var n;h.loading.show({message:"Subiendo Imagenes"});const l=(n=Q.value)==null?void 0:n.files;if(!(l!=null&&l.length)){console.warn("No se seleccion\xF3 ning\xFAn archivo."),i.value.state=!1;return}const s=Array.from(l).map(v=>{const[M]=v.name.split(".");return{code:M,file:v}});console.log(s);const m=new FormData;s.forEach(v=>{m.append("codes[]",v.code),m.append("files[]",v.file)});const c=await U.massiveUpdateImg(m);c.fail?console.log(c):(console.log(c),Q.value=null,i.value.result.state=!0,i.value.result.val=c,h.notify({message:`\u2705 ${c.actualizados.length} actualizadas, \u26A0\uFE0F ${c.error.length} con error`,type:"info"}),h.loading.hide())},N=l=>{f.value=URL.createObjectURL(l[0]),a.value.val.imgcoverExist=l[0]},R=l=>{console.log(l),a.value.state=!0,a.value.val=l},T=l=>{console.log(l),a.value.state=!0,a.value.val=l},O=async()=>{h.loading.show({message:"Actualizando Imagen"});const l=new FormData;l.append("id",a.value.val.id),l.append("code",a.value.val.code),l.append("picture",a.value.val.imgcoverExist);const s=await U.updateImgProduct(l);s.fail?console.log(s):(console.log(s),b.value.reset(),f.value=null,a.value.val.imgcoverExist=null,a.value.val.imgcover=s.image,h.notify({message:s.mssg,type:"positive",position:"bottom"}),h.loading.hide())};return J(()=>i.value.result.state,l=>{l||(i.value.result.val={actualizados:[],error:[]},i.value.state=!1)}),(l,s)=>(o(),d(Z,{padding:""},{default:t(()=>[r("div",se,[e(K,{name:"bounce"},{default:t(()=>[a.value.state?(o(),g("div",oe,[e(E,{flat:"",bordered:""},{default:t(()=>[e(x,{class:"text-center row"},{default:t(()=>[r("div",re,[s[1]||(s[1]=_(" Codigo: ")),r("span",ie,u(a.value.val.code),1)]),r("div",ne,[s[2]||(s[2]=_(" CCO: ")),r("span",ue,u(a.value.val.name),1)])]),_:1}),e(y),e(x,{class:"row items-stretch"},{default:t(()=>[a.value.val.imgcover?(o(),g("div",de,[e(k,{src:`${P(I)}/Products/${a.value.val.id}/${a.value.val.imgcover}`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1},null,8,["src"])])):(o(),g("div",ce,[f.value==null?(o(),d(k,{key:0,src:`${P(I)}/Products/sinpicture.png`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1,onClick:B},null,8,["src"])):p("",!0),e(G,{ref_key:"uploader",ref:b,accept:".jpg, .png, .jpeg",onAdded:N,"hide-upload-btn":"",style:{display:"none"},"field-name":"file"},null,512),f.value?(o(),g("div",ve,[(o(),d(k,{src:f.value,key:f.value,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%",width:"200px","object-fit":"contain"},ratio:1},null,8,["src"]))])):p("",!0)])),r("div",pe,[r("div",me,u(a.value.val.description),1)])]),_:1}),e(y),e(x,{class:"text-center row"},{default:t(()=>[r("div",fe,[s[3]||(s[3]=_(" Piezas X Caja: ")),r("span",ge,u(a.value.val.pieces),1)]),a.value.val.large?(o(),g("div",_e,[s[4]||(s[4]=_(" MED: ")),r("span",he,u(a.value.val.large),1)])):p("",!0)]),_:1}),e(S,{align:"right"},{default:t(()=>[e(j,{flat:"",label:"Cancel",color:"negative",onClick:q}),e(j,{flat:"",label:"Enviar",color:"positive",disable:!a.value.val.imgcoverExist,onClick:O},null,8,["disable"])]),_:1})]),_:1})])):p("",!0)]),_:1})]),e(X,{modelValue:i.value.result.state,"onUpdate:modelValue":s[0]||(s[0]=m=>i.value.result.state=m),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(E,{style:{"min-width":"400px","max-height":"80vh"}},{default:t(()=>{var m,c;return[e(x,{class:"text-center text-bold text-primary"},{default:t(()=>s[5]||(s[5]=[_(" Resultados de la carga masiva ")])),_:1}),(m=i.value.result.val.actualizados)!=null&&m.length?(o(),d(x,{key:0},{default:t(()=>[r("div",xe,"Actualizados correctamente ("+u(i.value.result.val.actualizados.length)+")",1),e(z,{bordered:"",separator:""},{default:t(()=>[(o(!0),g(A,null,D(i.value.result.val.actualizados,(n,v)=>(o(),d(F,{key:"ok-"+v},{default:t(()=>[e(C,null,{default:t(()=>[e($,null,{default:t(()=>[r("b",null,u(n.Codigo),1)]),_:2},1024),e($,{caption:""},{default:t(()=>[_(u(n.mssg),1)]),_:2},1024)]),_:2},1024),n.image?(o(),d(C,{key:0,side:""},{default:t(()=>[e(k,{src:`${P(I)}/Products/${n.id}/${n.image}`,alt:n.Codigo,style:{width:"50px",height:"50px","border-radius":"8px","object-fit":"cover"}},null,8,["src","alt"])]),_:2},1024)):p("",!0)]),_:2},1024))),128))]),_:1})]),_:1})):p("",!0),(c=i.value.result.val.error)!=null&&c.length?(o(),d(x,{key:1},{default:t(()=>[r("div",ye,"Errores ("+u(i.value.result.val.error.length)+")",1),e(z,{bordered:"",separator:""},{default:t(()=>[(o(!0),g(A,null,D(i.value.result.val.error,(n,v)=>(o(),d(F,{key:"err-"+v},{default:t(()=>[e(C,null,{default:t(()=>[e($,null,{default:t(()=>[r("b",null,u(n.Codigo||"\u2014"),1)]),_:2},1024),e($,{caption:""},{default:t(()=>[_(u(n.mssg),1)]),_:2},1024)]),_:2},1024),n.image?(o(),d(C,{key:0,side:""},{default:t(()=>[e(k,{src:`${P(I)}/Products/${n.id}/${n.image}`,alt:n.Codigo,style:{width:"50px",height:"50px","border-radius":"8px","object-fit":"cover"}},null,8,["src","alt"])]),_:2},1024)):p("",!0)]),_:2},1024))),128))]),_:1})]),_:1})):p("",!0),e(S,{align:"right"},{default:t(()=>[W(e(j,{flat:"",label:"Cerrar",color:"primary"},null,512),[[ee]])]),_:1})]}),_:1})]),_:1},8,["modelValue"]),e(Y,{reveal:"",elevated:"",bordered:""},{default:t(()=>[e(y,{spaced:"",inset:"",vertical:"",dark:""}),r("div",be,[r("div",null,[e(j,{icon:"upload",flat:"",onClick:V})]),e(y,{spaced:"",inset:"",vertical:"",dark:""}),i.value.state?p("",!0):(o(),d(E,{key:0,class:"col"},{default:t(()=>[e(le,{checkState:!1,onInput:R,onAgregar:T})]),_:1})),e(y,{spaced:"",inset:"",vertical:"",dark:""})]),e(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),r("input",{type:"file",ref_key:"inputFile",ref:Q,id:"inputFile",onInput:L,hidden:"",accept:".jpg, .jpeg, .png",multiple:""},null,544)]),_:1}))}};export{Ge as default};
