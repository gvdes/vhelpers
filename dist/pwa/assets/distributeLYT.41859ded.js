import{Q as oe}from"./QHeader.3acd3ae6.js";import{aq as v,T as te,Z as ae,f as le,u as se,r as Q,g as M,o as ie,H as re,y as ne,$ as de,a as V,h as k,i as u,d as a,a7 as x,k as h,a1 as Y,n as w,p as E,a4 as T,Q as j,l as _,a5 as H,a6 as I,j as ue,b9 as q,m as J}from"./index.25d37601.js";import{Q as pe}from"./QToolbar.fb6a9a3f.js";import{Q as ce,a as me}from"./QLayout.20eaf7b4.js";import{Q as fe}from"./QDate.62b91a67.js";import{Q as z}from"./QSelect.9632a195.js";import{_ as ve}from"./UserToolbar.70252932.js";import{u as K}from"./Restock.ed52e562.js";import{d as ge}from"./dayjs.min.cbcf888d.js";import{R as C}from"./RestockApi.82246b72.js";import{u as ye}from"./use-quasar.809b100b.js";import{$sktRestock as i}from"./socket.168d2ba4.js";import"./QResizeObserver.85655e73.js";import"./QScrollObserver.f27f38c4.js";import"./use-render-cache.3aae9b27.js";import"./date.1d401d9c.js";import"./QList.62fcb72d.js";import"./QImg.32782878.js";import"./QSpace.8e2a566e.js";import"./QExpansionItem.f68b6227.js";import"./favorites.e6e13ebd.js";import"./ClosePopup.8f64db21.js";import"./auth.9034e752.js";import"./axios.100554f1.js";import"./QForm.102a238c.js";import"./QTd.d3a70be8.js";import"./QPopupEdit.33f85097.js";import"./QTr.81b3ee70.js";import"./QTable.9c4d57a7.js";import"./QLinearProgress.24b0b54f.js";import"./QPage.59bbb72f.js";import"./jspdf.plugin.autotable.d63fb1cd.js";import"./_commonjsHelpers.88e99c8f.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */function be(c,r=document.body){if(typeof c!="string")throw new TypeError("Expected a string as propName");if(!(r instanceof Element))throw new TypeError("Expected a DOM element");return getComputedStyle(r).getPropertyValue(`--q-${c}`).trim()||null}let S;function we(){return v.is.winphone?"msapplication-navbutton-color":v.is.safari?"apple-mobile-web-app-status-bar-style":"theme-color"}function _e(c){const r=document.getElementsByTagName("META");for(const g in r)if(r[g].name===c)return r[g]}function he(c){S===void 0&&(S=we());let r=_e(S);const g=r===void 0;g&&(r=document.createElement("meta"),r.setAttribute("name",S)),r.setAttribute("content",c),g&&document.head.appendChild(r)}v.is.mobile===!0&&(v.is.nativeMobile===!0||v.is.winphone===!0||v.is.safari===!0||v.is.webkit===!0||v.is.vivaldi===!0)||te;const Ce={class:"text-bold"},Ve={class:"row"},ke={class:"col row"},Pe={class:"q-pa-md"},uo={__name:"distributeLYT",setup(c){const r=K();ae();const g=le(),s=K(),y=ye(),n=se(),b=Q(!1),t=Q({state:!1,folio:null,notes:null,types:{val:{id:1,label:"Manual"},opts:[{id:1,label:"Manual"},{id:3,label:"Venta"},{id:4,label:"Preventa"}]},suply_by:{val:null,opts:[]},warehouse:{val:{id:"GEN",label:"General"},opts:[{id:"GEN",label:"General"},{id:"EMP",label:"Empaques"}]}}),f=Q({val:{from:null,to:null}}),Z={profile:{me:{id:n.session.credentials.staff.id_va,nick:n.session.credentials.nick,picture:"",names:n.session.credentials.staff.complete_name,surname_pat:"",surname_mat:"",change_password:!1,_rol:1},workpoint:n.session.store},workpoint:n.session.store},P=M(()=>y.platform.is.mobile),U=M(()=>{var e;return t.value.types.val.id==3&&((e=t.value.folio)==null?void 0:e.length)!=8?!0:t.value.types.val.id==4&&!t.value.folio}),W=M(()=>{var e;return t.value.types.val.id==3&&((e=t.value.folio)==null?void 0:e.length)!=8?"reduerda ingresar 0":t.value.types.val.id==4&&!t.value.folio?"debe de tener minimo un caracter":""}),D=async()=>{s.setShowLoad(!0),y.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let e=ge(new Date).format("YYYY/MM/DD");f.value.val={from:e,to:e};const o=await C.index({date:f.value.val,storeTo:n.session.store.id_viz});o.fail?console.log(o):(console.log(o),s.fillOrders(o.orders),s.fillResume(o.resume),s.fillPrinters(o.printers),s.fillPartitions(o.partitions),s.setShowLoad(!1),s.setCedis(o.cedis),t.value.suply_by.opts=o.cedis,t.value.suply_by.val=o.cedis[0],console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),y.loading.hide())},X=async()=>{b.value=!1,y.loading.show({message:"Obteniendo Datos"});const e=await C.index({date:f.value.val,storeTo:n.session.store.id_viz});console.log(e),s.fillOrders(e.orders),s.fillPartitions(e.partitions),console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),y.loading.hide()},ee=async()=>{y.loading.show({message:"Creando Pedido"}),t.value.workpointFrom=n.session.store.id_viz,t.value.created_by=n.session.credentials.staff.id_va,console.log(t.value);const e=await C.newRequisition(t.value);e.fail?console.log(e):(console.log(e),y.loading.hide(),i.emit("creating",{order:e.requisition}),t.value={state:!1,folio:null,notes:null,types:{val:{id:1,label:"Manual"},opts:[{id:1,label:"Manual"},{id:3,label:"Venta"},{id:4,label:"Preventa"}]},suply_by:{val:s.cedis[0],opts:s.cedis},warehouse:{val:{id:"GEN",label:"General"},opts:[{id:"GEN",label:"General"},{id:"EMP",label:"Empaques"}]}},g.push(`/distribute/dashboardStore/${e.requisition.id}`))},O=async e=>{if(console.log(e),e.order.requisition.to.id===n.session.store.id_viz||e.order.requisition.from.id===n.session.store.id_viz){e.order,console.log("Partition refresh!!",e);let o=e.order,p=e.order.id;s.addOrUpdatePartition(p,o),console.log(o),console.log(p);let l=s.ordersdb.find(d=>d.id==o._requisition).partition;console.log(l);let m=l.findIndex(d=>d.id==o.id);m>=0&&l.splice(m,1,o)}},R=e=>{console.log(`%c${e.user.me.nick} de ${e.from.alias} se ha unido a Restock (UID: ${e.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},$=async e=>{if(console.log(e),e.order.to.id===n.session.store.id_viz||e.order.from.id===n.session.store.id_viz){let o=e.order;console.log(e.order.to.id);let p=await C.orderFresh(o.id),l=p.data.order,m=p.data.oid;s.addOrUpdate(m,l)}},B=async e=>{if(console.log(e),e.requisition.to.id===n.session.store.id_viz||e.requisition.from.id===n.session.store.id_viz){console.log(e.requisition.to.id);let o=e,p=e.id;s.addOrUpdatePartition(p,o)}},N=async e=>{console.log(e);let o=e.id,p=e._requisition;s.deleteParition(o),s.deleteParitionOrder(o,p)},F=e=>{console.log(e),s.orderUpdate(e)},G=async e=>{if(e.order.to.id===n.session.store.id_viz){let o=e.order,p=e.state,l=await C.orderFresh(o.id),m=l.data.order,d=l.data.oid;s.addOrUpdate(d,m),p.id==2}},L=e=>{s.setStatusPartition(e)},A=async e=>{var o;if(console.log(e),((o=e.order)==null?void 0:o.to.id)===n.session.store.id_viz||e.order.from.id===n.session.store.id_viz){console.log("REFRESHING BY SKT!!",e);let p=e.order,l=await C.orderFresh(p.id);console.log(l);let m=l.data.order;console.log(m.partition);let d=l.data.oid;s.addOrUpdate(d,m)}};return ie(async()=>{i.connect(),i.emit("joinat",Z),i.on("joineddashreq",R),i.on("creating",$),i.on("order_update",F),i.on("order_changestate",G),i.on("order_refresh",A),i.on("orderpartition_refresh",O),i.on("sktPartitionCreate",B),i.on("sktPartitionDelete",N),i.on("ChangeStatus",L),await re(),window.layoutReady=!0,await D(),window.dispatchEvent(new Event("layout-ready"))}),ne(()=>{i.off("joineddashreq",R),i.off("creating",$),i.off("order_update",F),i.off("order_changestate",G),i.off("order_refresh",A),i.off("orderpartition_refresh",O),i.off("sktPartitionCreate",B),i.off("sktPartitionDelete",N),i.off("ChangeStatus",L)}),(e,o)=>{const p=de("router-view");return V(),k(ce,{view:"hHh Lpr fFf"},{default:u(()=>[a(oe,{class:"transparent",bordered:""},{default:u(()=>[a(ve)]),_:1}),a(me,null,{default:u(()=>[x(s).showLYT?(V(),k(pe,{key:0,class:"row justify-between items-center"},{default:u(()=>[h("div",Ce,Y(x(r).title),1),h("div",null,Y(f.value.val&&f.value.val.from?`Del ${f.value.val.from} a ${f.value.val.to}`:f.value.val),1),h("div",Ve,[a(w,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:D}),h("div",ke,[x(r).showButton?(V(),k(w,{key:0,class:"col",color:"primary",icon:"event",onClick:o[0]||(o[0]=l=>b.value=!b.value),flat:"",round:""})):E("",!0),a(T,{spaced:"",inset:"",vertical:"",dark:""}),x(r).showButtonAdd?(V(),k(w,{key:1,class:"col",color:"primary",icon:"add",onClick:o[1]||(o[1]=l=>t.value.state=!t.value.state)})):E("",!0)])])]),_:1})):E("",!0),a(p)]),_:1}),a(I,{modelValue:b.value,"onUpdate:modelValue":o[4]||(o[4]=l=>b.value=l)},{default:u(()=>[a(j,{class:"my-card"},{default:u(()=>[a(_,null,{default:u(()=>[h("div",Pe,[o[12]||(o[12]=h("div",{class:"q-pb-sm text-center"},null,-1)),a(fe,{modelValue:f.value.val,"onUpdate:modelValue":o[2]||(o[2]=l=>f.value.val=l),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),a(_,null,{default:u(()=>[a(H,{align:"right"},{default:u(()=>[a(w,{flat:"",icon:"close",color:"negative",onClick:o[3]||(o[3]=l=>b.value=!b.value)}),a(w,{flat:"",icon:"check",color:"positive",onClick:X})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(I,{modelValue:t.value.state,"onUpdate:modelValue":o[11]||(o[11]=l=>t.value.state=l)},{default:u(()=>[a(j,{class:"my-card",style:{width:"400px","max-width":"50vw"}},{default:u(()=>{var l,m;return[a(_,{class:"text-center text-bold text-h6"},{default:u(()=>o[13]||(o[13]=[ue(" Nuevo Pedido ")])),_:1}),a(_,{class:q(P.value?"":"row")},{default:u(()=>[a(z,{class:q(P.value?"":"col"),modelValue:t.value.suply_by.val,"onUpdate:modelValue":o[5]||(o[5]=d=>t.value.suply_by.val=d),options:t.value.suply_by.opts,label:"Cedis",filled:"","option-label":"alias",dense:""},null,8,["class","modelValue","options"]),a(T,{spaced:"",inset:"",vertical:"",dark:""}),a(z,{class:q(P.value?"":"col"),modelValue:t.value.warehouse.val,"onUpdate:modelValue":o[6]||(o[6]=d=>t.value.warehouse.val=d),options:t.value.warehouse.opts,label:"Almacen",filled:"",dense:""},null,8,["class","modelValue","options"]),a(T,{spaced:"",inset:"",vertical:"",dark:""}),a(z,{class:q(P.value?"":"col"),modelValue:t.value.types.val,"onUpdate:modelValue":o[7]||(o[7]=d=>t.value.types.val=d),options:t.value.types.opts,label:"Tipo",filled:"",dense:""},null,8,["class","modelValue","options"])]),_:1},8,["class"]),((m=(l=t.value.types)==null?void 0:l.val)==null?void 0:m.id)!=1?(V(),k(_,{key:0},{default:u(()=>[a(J,{modelValue:t.value.folio,"onUpdate:modelValue":o[8]||(o[8]=d=>t.value.folio=d),type:t.value.types.val.id==3?"text":"number",label:t.value.types.val.id==3?"Ticket":"Folio",mask:t.value.types.val.id==3?"#-######":"",filled:"",dense:"",error:U.value,"error-message":W.value},null,8,["modelValue","type","label","mask","error","error-message"])]),_:1})):E("",!0),a(_,null,{default:u(()=>[a(J,{modelValue:t.value.notes,"onUpdate:modelValue":o[9]||(o[9]=d=>t.value.notes=d),type:"text",label:"Notas",filled:"",dense:""},null,8,["modelValue"])]),_:1}),a(_,null,{default:u(()=>[a(H,{align:"right"},{default:u(()=>[a(w,{flat:"",icon:"close",color:"negative",onClick:o[10]||(o[10]=d=>t.value.state=!t.value.state)}),a(w,{flat:"",icon:"check",color:"positive",onClick:ee,disable:U.value},null,8,["disable"])]),_:1})]),_:1})]}),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{uo as default};
