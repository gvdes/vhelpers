import{Q as P,a as v}from"./QSelect.cbeeb7c7.js";import{b as h,a as J,d as K,e as Q}from"./QList.357bdae8.js";import{Q as x}from"./QCardSection.00fbc919.js";import{Q as N}from"./QCard.2a654ec9.js";import{Q as E}from"./QTd.c00cd811.js";import{u as Y,r as f,c as I,l as Z,o as m,d as w,w as o,f as n,e as t,g as y,a3 as z,a2 as D,h as S,an as L,a0 as c,ak as p,Q as M}from"./index.0fdaff4d.js";import{Q as ee}from"./QTr.bd3a1d24.js";import{Q as te}from"./QTable.8cf7a817.js";import{Q as le}from"./QPage.64195f4d.js";import"./QDrawer.e40ea7c6.js";import"./QCardActions.bc87cb95.js";import"./ClosePopup.315b6bfc.js";import"./axios.7d24dc86.js";import{u as oe}from"./use-quasar.3538a447.js";import{u as ae}from"./warehousStore.f4141388.js";import{P as se}from"./ProductsAutocomplete.ef85c16b.js";import"./jspdf.plugin.autotable.224ed27d.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as U}from"./locationsApi.7233a122.js";import"./use-key-composition.b41d6ff8.js";import"./QLinearProgress.883b4630.js";import"./QCheckbox.1d3959e7.js";import"./QResizeObserver.cdf99542.js";import"./QScrollObserver.dcb03ea8.js";import"./QInput.fe7dff6e.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const ie={key:0},ne={key:0},ce={class:"row"},de={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},re={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},ue={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},me={class:"row"},pe={class:"text-h6 col text-bold text-left"},ve={class:"text-h6 col text-bold text-right"},fe={class:"text-subtitle2 col"},Ge={__name:"products",setup(ge){const b=Y(),r=oe();ae().setTitle("Ubicaciones Productos");const V=f([]),k=f(null),O=f([]),g=f([]),$=f(0),a=f(null),_=f(null),B=f({columns:[{name:"name",label:"NOMBRE",field:l=>l.name,align:"left"},{name:"alias",label:"ALIAS",field:l=>l.alias,align:"left"},{name:"path",label:"PATH",field:l=>l.path,align:"left"}],paginate:{rowsPerPage:0}}),A=I(()=>r.platform.is.mobile),F=I(()=>{var l,e;return(e=(l=a.value)==null?void 0:l.locations)==null?void 0:e.find(s=>{var d;return s.id==((d=_.value)==null?void 0:d.selected)})}),H=async()=>{r.loading.show({message:"Obteniendo Secciones"});const l=await U.index(b.session.store.id_viz);l.fail?console.log(l):V.value=l,r.loading.hide()},R=()=>{const l=k.value.sections||[];$.value=Math.max(...l.map(e=>e.deep)),g.value=[{options:l.filter(e=>e.root===0),selected:null}],O.value=g.value[0].options},T=l=>{var e;return((e=k.value.sections)==null?void 0:e.filter(s=>s.root===l))||[]},j=(l,e)=>{g.value.splice(e+1);const s=T(l);s.length>0&&g.value.push({options:s,selected:null})},q=l=>{a.value=l,console.log(l)},G=l=>{a.value=l,console.log(l)},W=async()=>{console.log(b.session),r.loading.show({message:"Agregando Ubicacion"}),console.log(_.value);let l={id_viz:b.session.credentials.staff.id_va,_location:_.value.selected,_product:a.value.id};const e=await U.addLocations(l);if(e.fail)console.log(e);else{console.log(e);const s=g.value.filter(d=>d.selected!==null);if(s.length){const i=s[s.length-1].options.find(u=>u.id===_.value.selected);a.value.locations.push(i)}r.notify({message:"Ubicacion Agregada",type:"positive",position:"bottom"}),r.loading.hide()}},X=async l=>{console.log(b.session),r.loading.show({message:"Eliminando Ubicacion"});let e={id_viz:b.session.credentials.staff.id_va,_location:l,_product:a.value.id};console.log(e);const s=await U.addLocations(e);if(s.fail)console.log(s);else{console.log(s),r.notify({message:"Ubicacion Eliminada",type:"positive",position:"bottom"});let d=a.value.locations.findIndex(i=>i.id==l);a.value.locations.splice(d,1),r.loading.hide()}};return H(),Z(g,l=>{const e=l.filter(s=>s.selected!==null);if(e.length){const s=e[e.length-1];T(s.selected),_.value=s}},{deep:!0}),(l,e)=>(m(),w(le,{padding:""},{default:o(()=>{var s,d;return[n("div",{class:L(A.value?"":"row")},[t(N,{class:L(A.value?"my-card":"col my-card")},{default:o(()=>[t(x,null,{default:o(()=>[V.value.length>0?(m(),y("div",ie,[t(P,{modelValue:k.value,"onUpdate:modelValue":[e[0]||(e[0]=i=>k.value=i),R],options:V.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(h,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),y(z,null,D(g.value,(i,u)=>(m(),y("div",{key:u},[n("div",null,[t(P,{modelValue:i.selected,"onUpdate:modelValue":[C=>i.selected=C,C=>j(C,u)],options:i.options,label:`Nivel ${u+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(h,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):S("",!0)]),_:1})]),_:1},8,["class"]),t(h,{spaced:"",inset:"",vertical:"",dark:""}),t(N,{class:L(A.value?"my-card":"col my-card")},{default:o(()=>[t(x,null,{default:o(()=>[t(se,{onInput:q,onAgregar:G,with_locations:""})]),_:1}),a.value?(m(),y("div",ne,[t(x,{class:"item-center"},{default:o(()=>[n("div",ce,[n("div",de,c(a.value.category.familia.seccion.name),1),n("div",re,c(a.value.category.familia.name),1),n("div",ue,c(a.value.category.name),1)])]),_:1}),t(x,{class:"item-center"},{default:o(()=>[n("div",me,[n("div",pe,c(a.value.code),1),n("div",ve,c(a.value.name),1)]),n("div",fe,c(a.value.description),1),n("div",null,[t(J,null,{default:o(()=>[t(K,null,{default:o(()=>[t(Q,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[1]||(e[1]=[p("GEN")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.gen),1)]),_:1})]),_:1}),t(Q,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[2]||(e[2]=[p("EXH")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.exh),1)]),_:1})]),_:1}),t(Q,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[3]||(e[3]=[p("FDT")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.fdt),1)]),_:1})]),_:1}),t(Q,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[4]||(e[4]=[p("TRA")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.in_transit),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),a.value.locations.length>0?(m(),w(x,{key:0},{default:o(()=>[e[5]||(e[5]=n("div",{class:"text-center text-bold text-h6"},"Ubicaciones",-1)),t(h,{spaced:"",inset:"",vertical:"",dark:""}),t(te,{rows:a.value.locations,columns:B.value.columns,pagination:B.value.paginate,"hide-bottom":"","hide-header":""},{body:o(i=>[t(ee,{props:i},{default:o(()=>[(m(!0),y(z,null,D(i.cols,u=>(m(),w(E,{key:u.name,props:i},{default:o(()=>[p(c(u.value),1)]),_:2},1032,["props"]))),128)),t(E,{"auto-width":""},{default:o(()=>[t(M,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:u=>X(i.row.id),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])]),_:1})):S("",!0)])):S("",!0)]),_:1},8,["class"])],2),t(h,{spaced:"",inset:"",vertical:"",dark:""}),((s=_.value)==null?void 0:s.selected)&&((d=a.value)==null?void 0:d.id)&&!F.value?(m(),w(N,{key:0,class:"my-card"},{default:o(()=>[t(x,null,{default:o(()=>[t(M,{color:"primary",icon:"add_link",onClick:W})]),_:1})]),_:1})):S("",!0)]}),_:1}))}};export{Ge as default};
