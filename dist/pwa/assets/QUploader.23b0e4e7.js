import{a8 as pe,j as ue,a9 as me,c as m,k as i,ab as ge,m as Y,r as x,z as oe,D as ne,$ as _e,C as he,E as be,p as Fe,v as ye,aS as Se,y as qe,aI as ke,Z as te,aT as xe,Y as ze,Q as ae,aH as we}from"./index.ca4f0490.js";import{g as Ue,i as le}from"./QSelect.cb84ae0e.js";import{c as Ce,d as Be}from"./use-quasar.aeafbd6e.js";const Ee={...pe,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},X=50,ie=2*X,se=ie*Math.PI,Pe=Math.round(se*1e3)/1e3;var Re=ue({name:"QCircularProgress",props:{...Ee,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:v}){const{proxy:{$q:a}}=Y(),_=me(e),n=m(()=>{const F=(a.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(a.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-F}deg)`:`rotate3d(0, 0, 1, ${F-90}deg)`}}),h=m(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),b=m(()=>ie/(1-e.thickness/2)),P=m(()=>`${b.value/2} ${b.value/2} ${b.value} ${b.value}`),B=m(()=>Ue(e.value,e.min,e.max)),z=m(()=>se*(1-(B.value-e.min)/(e.max-e.min))),C=m(()=>e.thickness/2*b.value);function E({thickness:F,offset:t,color:u,cls:g,rounded:w}){return i("circle",{class:"q-circular-progress__"+g+(u!==void 0?` text-${u}`:""),style:h.value,fill:"transparent",stroke:"currentColor","stroke-width":F,"stroke-dasharray":Pe,"stroke-dashoffset":t,"stroke-linecap":w,cx:b.value,cy:b.value,r:X})}return()=>{const F=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&F.push(i("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:X-C.value/2,cx:b.value,cy:b.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&F.push(E({cls:"track",thickness:C.value,offset:0,color:e.trackColor})),F.push(E({cls:"circle",thickness:C.value,offset:z.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const t=[i("svg",{class:"q-circular-progress__svg",style:n.value,viewBox:P.value,"aria-hidden":"true"},F)];return e.showValue===!0&&t.push(i("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},v.default!==void 0?v.default():[i("div",B.value)])),i("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:_.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:B.value},ge(v.internal,t))}}});function Q(e,v,a,_){const n=[];return e.forEach(h=>{_(h)===!0?n.push(h):v.push({failedPropValidation:a,file:h})}),n}function W(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ne(e)}const je={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Le=["rejected"];function Ne({editable:e,dnd:v,getFileInput:a,addFilesToQueue:_}){const{props:n,emit:h,proxy:b}=Y(),P=x(null),B=m(()=>n.accept!==void 0?n.accept.split(",").map(r=>(r=r.trim(),r==="*"?"*/":(r.endsWith("/*")&&(r=r.slice(0,r.length-1)),r.toUpperCase()))):null),z=m(()=>parseInt(n.maxFiles,10)),C=m(()=>parseInt(n.maxTotalSize,10));function E(r){if(e.value)if(r!==Object(r)&&(r={target:null}),r.target!==null&&r.target.matches('input[type="file"]')===!0)r.clientX===0&&r.clientY===0&&oe(r);else{const q=a();q&&q!==r.target&&q.click(r)}}function F(r){e.value&&r&&_(null,r)}function t(r,q,N,$){let o=Array.from(q||r.target.files);const y=[],U=()=>{y.length>0&&h("rejected",y)};if(n.accept!==void 0&&B.value.indexOf("*/")===-1&&(o=Q(o,y,"accept",c=>B.value.some(p=>c.type.toUpperCase().startsWith(p)||c.name.toUpperCase().endsWith(p))),o.length===0))return U();if(n.maxFileSize!==void 0){const c=parseInt(n.maxFileSize,10);if(o=Q(o,y,"max-file-size",p=>p.size<=c),o.length===0)return U()}if(n.multiple!==!0&&o.length>0&&(o=[o[0]]),o.forEach(c=>{c.__key=c.webkitRelativePath+c.lastModified+c.name+c.size}),$===!0){const c=N.map(p=>p.__key);o=Q(o,y,"duplicate",p=>c.includes(p.__key)===!1)}if(o.length===0)return U();if(n.maxTotalSize!==void 0){let c=$===!0?N.reduce((p,D)=>p+D.size,0):0;if(o=Q(o,y,"max-total-size",p=>(c+=p.size,c<=C.value)),o.length===0)return U()}if(typeof n.filter=="function"){const c=n.filter(o);o=Q(o,y,"filter",p=>c.includes(p))}if(n.maxFiles!==void 0){let c=$===!0?N.length:0;if(o=Q(o,y,"max-files",()=>(c++,c<=z.value)),o.length===0)return U()}if(U(),o.length>0)return o}function u(r){W(r),v.value!==!0&&(v.value=!0)}function g(r){ne(r),(r.relatedTarget!==null||_e.is.safari!==!0?r.relatedTarget!==P.value:document.elementsFromPoint(r.clientX,r.clientY).includes(P.value)===!1)===!0&&(v.value=!1)}function w(r){W(r);const q=r.dataTransfer.files;q.length>0&&_(null,q),v.value=!1}function f(r){if(v.value===!0)return i("div",{ref:P,class:`q-${r}__dnd absolute-full`,onDragenter:W,onDragover:W,onDragleave:g,onDrop:w})}return Object.assign(b,{pickFiles:E,addFiles:F}),{pickFiles:E,addFiles:F,onDragover:u,onDragleave:g,processFiles:t,getDndNode:f,maxFilesNumber:z,maxTotalSizeNumber:C}}function re(e){return(e*100).toFixed(2)+"%"}const $e={...Ce,...je,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},de=[...Le,"start","finish","added","removed"];function De(e){const v=Y(),{props:a,slots:_,emit:n,proxy:h}=v,{$q:b}=h,P=Be(a,b);function B(l,d,S){if(l.__status=d,d==="idle"){l.__uploaded=0,l.__progress=0,l.__sizeLabel=le(l.size),l.__progressLabel="0.00%";return}if(d==="failed"){h.$forceUpdate();return}l.__uploaded=d==="uploaded"?l.size:S,l.__progress=d==="uploaded"?1:Math.min(.9999,l.__uploaded/l.size),l.__progressLabel=re(l.__progress),h.$forceUpdate()}const z=m(()=>a.disable!==!0&&a.readonly!==!0),C=x(!1),E=x(null),F=x(null),t={files:x([]),queuedFiles:x([]),uploadedFiles:x([]),uploadedSize:x(0),updateFileStatus:B,isAlive:()=>he(v)===!1},{pickFiles:u,addFiles:g,onDragover:w,onDragleave:f,processFiles:r,getDndNode:q,maxFilesNumber:N,maxTotalSizeNumber:$}=Ne({editable:z,dnd:C,getFileInput:Z,addFilesToQueue:J});Object.assign(t,e({props:a,slots:_,emit:n,helpers:t})),t.isBusy===void 0&&(t.isBusy=x(!1));const o=x(0),y=m(()=>o.value===0?0:t.uploadedSize.value/o.value),U=m(()=>re(y.value)),c=m(()=>le(o.value)),p=m(()=>z.value===!0&&t.isUploading.value!==!0&&(a.multiple===!0||t.queuedFiles.value.length===0)&&(a.maxFiles===void 0||t.files.value.length<N.value)&&(a.maxTotalSize===void 0||o.value<$.value)),D=m(()=>z.value===!0&&t.isBusy.value!==!0&&t.isUploading.value!==!0&&t.queuedFiles.value.length>0);be(xe,V);const s=m(()=>"q-uploader column no-wrap"+(P.value===!0?" q-uploader--dark q-dark":"")+(a.bordered===!0?" q-uploader--bordered":"")+(a.square===!0?" q-uploader--square no-border-radius":"")+(a.flat===!0?" q-uploader--flat no-shadow":"")+(a.disable===!0?" disabled q-uploader--disable":"")+(C.value===!0?" q-uploader--dnd":"")),O=m(()=>"q-uploader__header"+(a.color!==void 0?` bg-${a.color}`:"")+(a.textColor!==void 0?` text-${a.textColor}`:""));Fe(t.isUploading,(l,d)=>{d===!1&&l===!0?n("start"):d===!0&&l===!1&&n("finish")});function I(){a.disable===!1&&(t.abort(),t.uploadedSize.value=0,o.value=0,K(),t.files.value=[],t.queuedFiles.value=[],t.uploadedFiles.value=[])}function A(){a.disable===!1&&H(["uploaded"],()=>{t.uploadedFiles.value=[]})}function R(){H(["idle","failed"],({size:l})=>{o.value-=l,t.queuedFiles.value=[]})}function H(l,d){if(a.disable===!0)return;const S={files:[],size:0},j=t.files.value.filter(k=>l.indexOf(k.__status)===-1?!0:(S.size+=k.size,S.files.push(k),k.__img!==void 0&&window.URL.revokeObjectURL(k.__img.src),!1));S.files.length>0&&(t.files.value=j,d(S),n("removed",S.files))}function G(l){a.disable||(l.__status==="uploaded"?t.uploadedFiles.value=t.uploadedFiles.value.filter(d=>d.__key!==l.__key):l.__status==="uploading"?l.__abort():o.value-=l.size,t.files.value=t.files.value.filter(d=>d.__key!==l.__key?!0:(d.__img!==void 0&&window.URL.revokeObjectURL(d.__img.src),!1)),t.queuedFiles.value=t.queuedFiles.value.filter(d=>d.__key!==l.__key),n("removed",[l]))}function K(){t.files.value.forEach(l=>{l.__img!==void 0&&window.URL.revokeObjectURL(l.__img.src)})}function Z(){return F.value||E.value.getElementsByClassName("q-uploader__input")[0]}function J(l,d){const S=r(l,d,t.files.value,!0),j=Z();j!=null&&(j.value=""),S!==void 0&&(S.forEach(k=>{if(t.updateFileStatus(k,"idle"),o.value+=k.size,a.noThumbnails!==!0&&k.type.toUpperCase().startsWith("IMAGE")){const ee=new Image;ee.src=window.URL.createObjectURL(k),k.__img=ee}}),t.files.value=t.files.value.concat(S),t.queuedFiles.value=t.queuedFiles.value.concat(S),n("added",S),a.autoUpload===!0&&t.upload())}function ce(){D.value===!0&&t.upload()}function M(l,d,S){if(l===!0){const j={type:"a",key:d,icon:b.iconSet.uploader[d],flat:!0,dense:!0};let k;return d==="add"?(j.onClick=u,k=V):j.onClick=S,i(ae,j,k)}}function V(){return i("input",{ref:F,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:a.accept,multiple:a.multiple===!0?"multiple":void 0,capture:a.capture,onMousedown:oe,onClick:u,onChange:J})}function ve(){return _.header!==void 0?_.header(T):[i("div",{class:"q-uploader__header-content column"},[i("div",{class:"flex flex-center no-wrap q-gutter-xs"},[M(t.queuedFiles.value.length>0,"removeQueue",R),M(t.uploadedFiles.value.length>0,"removeUploaded",A),t.isUploading.value===!0?i(te,{class:"q-uploader__spinner"}):null,i("div",{class:"col column justify-center"},[a.label!==void 0?i("div",{class:"q-uploader__title"},[a.label]):null,i("div",{class:"q-uploader__subtitle"},[c.value+" / "+U.value])]),M(p.value,"add"),M(a.hideUploadBtn===!1&&D.value===!0,"upload",t.upload),M(t.isUploading.value,"clear",t.abort)])])]}function fe(){return _.list!==void 0?_.list(T):t.files.value.map(l=>i("div",{key:l.__key,class:"q-uploader__file relative-position"+(a.noThumbnails!==!0&&l.__img!==void 0?" q-uploader__file--img":"")+(l.__status==="failed"?" q-uploader__file--failed":l.__status==="uploaded"?" q-uploader__file--uploaded":""),style:a.noThumbnails!==!0&&l.__img!==void 0?{backgroundImage:'url("'+l.__img.src+'")'}:null},[i("div",{class:"q-uploader__file-header row flex-center no-wrap"},[l.__status==="failed"?i(ze,{class:"q-uploader__file-status",name:b.iconSet.type.negative,color:"negative"}):null,i("div",{class:"q-uploader__file-header-content col"},[i("div",{class:"q-uploader__title"},[l.name]),i("div",{class:"q-uploader__subtitle row items-center no-wrap"},[l.__sizeLabel+" / "+l.__progressLabel])]),l.__status==="uploading"?i(Re,{value:l.__progress,min:0,max:1,indeterminate:l.__progress===0}):i(ae,{round:!0,dense:!0,flat:!0,icon:b.iconSet.uploader[l.__status==="uploaded"?"done":"clear"],onClick:()=>{G(l)}})])]))}ye(()=>{t.isUploading.value===!0&&t.abort(),t.files.value.length>0&&K()});const T={};for(const l in t)Se(t[l])===!0?qe(T,l,()=>t[l].value):T[l]=t[l];return Object.assign(T,{upload:ce,reset:I,removeUploadedFiles:A,removeQueuedFiles:R,removeFile:G,pickFiles:u,addFiles:g}),ke(T,{canAddFiles:()=>p.value,canUpload:()=>D.value,uploadSizeLabel:()=>c.value,uploadProgressLabel:()=>U.value}),Object.assign(h,T),()=>{const l=[i("div",{class:O.value},ve()),i("div",{class:"q-uploader__list scroll"},fe()),q("uploader")];t.isBusy.value===!0&&l.push(i("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[i(te)]));const d={ref:E,class:s.value};return p.value===!0&&Object.assign(d,{onDragover:w,onDragleave:f}),i("div",d,l)}}const Oe=()=>!0;function Te(e){const v={};return e.forEach(a=>{v[a]=Oe}),v}const Ie=Te(de);var Ae=({name:e,props:v,emits:a,injectPlugin:_})=>ue({name:e,props:{...$e,...v},emits:we(a)===!0?{...Ie,...a}:[...de,...a],setup(){return De(_)}});function L(e){return typeof e=="function"?e:()=>e}const Qe={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Me=["factoryFailed","uploaded","failed","uploading"];function We({props:e,emit:v,helpers:a}){const _=x([]),n=x([]),h=x(0),b=m(()=>({url:L(e.url),method:L(e.method),headers:L(e.headers),formFields:L(e.formFields),fieldName:L(e.fieldName),withCredentials:L(e.withCredentials),sendRaw:L(e.sendRaw),batch:L(e.batch)})),P=m(()=>h.value>0),B=m(()=>n.value.length>0);let z;function C(){_.value.forEach(u=>{u.abort()}),n.value.length>0&&(z=!0)}function E(){const u=a.queuedFiles.value.slice(0);a.queuedFiles.value=[],b.value.batch(u)?F(u):u.forEach(g=>{F([g])})}function F(u){if(h.value++,typeof e.factory!="function"){t(u,{});return}const g=e.factory(u);if(!g)v("factoryFailed",new Error("QUploader: factory() does not return properly"),u),h.value--;else if(typeof g.catch=="function"&&typeof g.then=="function"){n.value.push(g);const w=f=>{a.isAlive()===!0&&(n.value=n.value.filter(r=>r!==g),n.value.length===0&&(z=!1),a.queuedFiles.value=a.queuedFiles.value.concat(u),u.forEach(r=>{a.updateFileStatus(r,"failed")}),v("factoryFailed",f,u),h.value--)};g.then(f=>{z===!0?w(new Error("Aborted")):a.isAlive()===!0&&(n.value=n.value.filter(r=>r!==g),t(u,f))}).catch(w)}else t(u,g||{})}function t(u,g){const w=new FormData,f=new XMLHttpRequest,r=(s,O)=>g[s]!==void 0?L(g[s])(O):b.value[s](O),q=r("url",u);if(!q){console.error("q-uploader: invalid or no URL specified"),h.value--;return}const N=r("formFields",u);N!==void 0&&N.forEach(s=>{w.append(s.name,s.value)});let $=0,o=0,y=0,U=0,c;f.upload.addEventListener("progress",s=>{if(c===!0)return;const O=Math.min(U,s.loaded);a.uploadedSize.value+=O-y,y=O;let I=y-o;for(let A=$;I>0&&A<u.length;A++){const R=u[A];if(I>R.size)I-=R.size,$++,o+=R.size,a.updateFileStatus(R,"uploading",R.size);else{a.updateFileStatus(R,"uploading",I);return}}},!1),f.onreadystatechange=()=>{f.readyState<4||(f.status&&f.status<400?(a.uploadedFiles.value=a.uploadedFiles.value.concat(u),u.forEach(s=>{a.updateFileStatus(s,"uploaded")}),v("uploaded",{files:u,xhr:f})):(c=!0,a.uploadedSize.value-=y,a.queuedFiles.value=a.queuedFiles.value.concat(u),u.forEach(s=>{a.updateFileStatus(s,"failed")}),v("failed",{files:u,xhr:f})),h.value--,_.value=_.value.filter(s=>s!==f))},f.open(r("method",u),q),r("withCredentials",u)===!0&&(f.withCredentials=!0);const p=r("headers",u);p!==void 0&&p.forEach(s=>{f.setRequestHeader(s.name,s.value)});const D=r("sendRaw",u);u.forEach(s=>{a.updateFileStatus(s,"uploading",0),D!==!0&&w.append(r("fieldName",s),s,s.name),s.xhr=f,s.__abort=()=>{f.abort()},U+=s.size}),v("uploading",{files:u,xhr:f}),_.value.push(f),D===!0?f.send(new Blob(u)):f.send(w)}return{isUploading:P,isBusy:B,abort:C,upload:E}}var He={name:"QUploader",props:Qe,emits:Me,injectPlugin:We},Ke=Ae(He);export{Ke as Q};
