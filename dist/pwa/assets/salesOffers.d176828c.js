import{Q as v}from"./QSeparator.1c524e3d.js";import{r as x,c as R,o as u,a as _,w as i,e as l,i as s,a3 as p,Y as Z,a4 as b,h as c,a2 as w,Q as m,b2 as ee,g as I,f as q}from"./index.f230f022.js";import{Q as le}from"./QToolbar.27077d41.js";import{Q as ae}from"./QHeader.7126e984.js";import{Q as te}from"./QTable.3191f054.js";import{u as oe,Q,a as E}from"./use-quasar.e39b8eab.js";import{Q as se}from"./QPage.e6a2a5a9.js";import{Q as ie,a as ne}from"./QLayout.5338a477.js";import{Q as D,a as P,b as V}from"./QSelect.c1eea1d3.js";import{Q as T}from"./QInput.55e7d485.js";import{Q as de}from"./QList.e86be665.js";import{Q as re}from"./QCardActions.399bf6db.js";import{Q as S}from"./QDialog.4e21d602.js";import{Q as ue}from"./QForm.e982d13c.js";import{Q as ce}from"./QFooter.9355fc38.js";import{C as F}from"./ClosePopup.f972e7f6.js";import{u as ve}from"./VDB.62c6e2ff.js";import{_ as pe}from"./UserToolbar.7a022b79.js";import{a as B}from"./axios.f1f32898.js";import{P as me}from"./ProductsAutocomplete.ea306dc5.js";import{a as fe}from"./axios.30672b3a.js";import"./QResizeObserver.f839cf65.js";import"./QLinearProgress.89563db7.js";import"./QCheckbox.baf50a2a.js";import"./use-key-composition.951681c7.js";import"./uid.42677368.js";import"./position-engine.b4a3ff3c.js";import"./rtl.b51694b1.js";/* empty css                                                                         */const be=s("span",{class:"text-h6"},"Cobro Ofertas",-1),ge={class:"text-bold"},_e={class:"row text-h6"},ye={class:"col"},xe={class:"text-bold"},Ee={class:"col"},ke={class:"text-bold"},Ce={class:"row items-end"},Ve={class:"text-center"},he={class:"col q-pa-xs"},we=s("div",{class:"text-bold text-h6"},"Cantidad:",-1),De={class:"col column q-py-md"},Ie={class:"col q-pa-xs"},Qe={class:"row"},Te={class:"col"},Fe={key:1,class:"col"},Ae=s("div",{class:"bg-primary q-pa-md text-white text-center"},[s("div",{class:"fw-bold text-h6"},"Cobro del documento")],-1),Pe={class:"row text-center items-center"},Se=s("div",{class:"col"}," Forma de pago: ",-1),Ge={class:"col"},Ne={class:"row text-center items-center"},Ue=s("div",{class:"col"}," Total a pagar: ",-1),$e={class:"col text-h5 text-bold bg-grey-3"},Oe={class:"row text-center items-center"},Re={class:"col"},qe={class:"col"},Be={class:"row flex justify-center"},je={class:"col flex justify-center"},ze={key:0,class:"col"},Le={key:0,class:"row flex justify-center text-center"},He={class:"col"},Me={class:"col"},Je=s("div",{class:"fs-dec3"},"Cambio",-1),Ye={class:"text-h5"},Ke={key:0,class:"text-center"},We=s("div",{class:"text-h6 text-center"},"Selecciona Caja e Impresora",-1),Xe={class:"row"},Ql={__name:"salesOffers",setup(Ze){const C=ve(),h=oe(),f=x({state:!1,val:null,body:null}),k=x({val:null,opts:[]}),G=x({val:null,opts:[]}),t=x({val:null,state:!1}),y=x({state:!1,dafpa:!1}),n=x({EFE:{id:null,val:0},DIG:{id:null,val:0}}),N=[{id:"EFE",desc:"CONTADO EFECTIVO"},{id:"TBA",desc:"TARJETA C/D BANCOMER"},{id:"TSA",desc:"TARJETA C/D SANTANDER"},{id:"TDB",desc:"TRA/DEP BANCOMER"},{id:"TDA",desc:"TRA/DEP Santander"},{id:"TDS",desc:"TRA/DEP Scotiabank"},{id:"C30",desc:"CREDITO"}],r=x([]),U=x({columns:[{name:"code",label:"ARICULO",field:o=>o.code,align:"left"},{name:"description",label:"DESCRIPCION",field:o=>o.description,align:"left"},{name:"amount",label:"CANTIDAD",field:o=>o.amount,align:"center"},{name:"price",label:"PRECIO",field:o=>{var e;return(e=o.price)==null?void 0:e.pivot.price},align:"center"},{name:"total",label:"TOTAL",field:o=>{var e;return o.amount*((e=o.price)==null?void 0:e.pivot.price)},align:"center"}],pagination:{rowsPerPage:0},filter:""}),j=R(()=>{var o,e;return A.value>=0&&(((o=n.value.EFE.id)==null?void 0:o.id)&&n.value.EFE.val>0||((e=n.value.DIG.id)==null?void 0:e.id)&&n.value.DIG.val>0)}),A=R(()=>Number.parseFloat(n.value.DIG.val)+Number.parseFloat(n.value.EFE.val)-r.value.reduce((o,e)=>{var a;return o+e.amount*((a=e.price)==null?void 0:a.pivot.price)},0)),z=async()=>{h.loading.show({message:"Obteniendo Cajas"});let o=C.session.store.ip;console.log(C.session);let e=`http://${o}/access/public/reports/getTerminal`;const a=await B.get(e);a.status!=200?console.log(a):(console.log(a),k.value.opts=a.data,h.loading.hide())},L=o=>{console.log(o)},H=o=>{console.log(o);let e=r.value.findIndex(a=>a.id==o.id);console.log(e),e>=0?(h.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}),t.value.state=!0,t.value.val=r.value[e],t.value.val.edit=!0):(t.value.state=!0,o.amount=1,o.notes="",o.edit=!1,t.value.val=o)},M=(o,e)=>{let a=r.value.findIndex(d=>d.id==e.id);console.log(a),a>=0&&(t.value.state=!0,t.value.val=r.value[a],t.value.val.edit=!0)},$=()=>{let o=r.value.findIndex(e=>e.id==t.value.val.id);o>=0?r.value.splice(o,1,t.value.val):(console.log(t.value.val),r.value.push(t.value.val))},J=()=>{let o=r.value.findIndex(e=>e.id==t.value.val.id);o>=0&&r.value.splice(o,1)},Y=async()=>{let o=C.session.store.id;console.log(o);try{let e=await fe.get(`/cashier/getPrinters/${o}`);e.status==200&&(f.value.body=e.data,console.log("Impresoras listas :)"),y.value.state=!0)}catch(e){console.log(e),h.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},K=o=>{var e;return o.id==((e=n.value.DIG.id)==null?void 0:e.id)},W=o=>{var e;return o.id==((e=n.value.EFE.id)==null?void 0:e.id)},X=async()=>{let e=`http://${C.session.store.ip}/access/public/modify/createTicket`,d={by:`${C.session.name} - ${C.session.store.alias}`,modes:n.value,colab:G.value.val,terminal:k.value.val,impresoras:f.value.val,productos:r.value,cambio:A.value};const g=await B.post(e,d);g.status!=200?console.log(g):(console.log(g.data),f.value={state:!1,val:null,body:null},k.value={val:null,opts:[]},G.value={val:null,opts:[]},t.value={val:null,state:!1},y.value={state:!1,dafpa:!1},n.value={EFE:{id:null,val:0},DIG:{id:null,val:0}},r.value=[],h.notify({message:g.data.mssg,type:"positive",position:"center"}))};return z(),(o,e)=>(u(),_(ie,{view:"hHh Lpr fFf"},{default:i(()=>[l(ae,{class:"transparent text-dark",bordered:""},{default:i(()=>[l(pe),l(v),l(le,{class:"justify-between"},{default:i(()=>[s("div",null,[p("Helpers "),l(Z,{name:"navigate_next",color:"primary"}),p(),be]),s("div",null,[p("Total $"),s("span",ge,b(r.value.reduce((a,d)=>{var g;return a+d.amount*((g=d.price)==null?void 0:g.pivot.price)},0)),1)])]),_:1})]),_:1}),l(ne,null,{default:i(()=>[l(se,{class:"bg-grey-3",padding:""},{default:i(()=>[l(Q,{class:"my-card"},{default:i(()=>[r.value.length>0?(u(),_(E,{key:0},{default:i(()=>[l(te,{"hide-bottom":"",rows:r.value,"row-key":"id",columns:U.value.columns,pagination:U.value.pagination,onRowClick:M},null,8,["rows","columns","pagination"])]),_:1})):c("",!0)]),_:1})]),_:1})]),_:1}),l(S,{modelValue:t.value.state,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.state=a),persistent:"",position:"bottom"},{default:i(()=>[l(Q,null,{default:i(()=>[l(E,{class:"bg-grey-4"},{default:i(()=>[s("div",_e,[s("div",ye,[p("Codigo: "),s("span",xe,b(t.value.val.code),1)]),s("div",Ee,[p("Cco: "),s("span",ke,b(t.value.val.name),1)]),s("div",null,[t.value.val.edit==!0?w((u(),_(m,{key:0,color:"negative",icon:"delete",onClick:J,flat:"",size:"sm"},null,512)),[[F]]):c("",!0)])]),p(" "+b(t.value.val.description),1)]),_:1}),l(E,null,{default:i(()=>[s("div",Ce,[s("div",Ve,[s("div",he,[we,l(m,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:e[0]||(e[0]=a=>t.value.val.amount++)}),l(v,{spaced:"",inset:"",vertical:"",dark:""}),s("div",De,[w(s("input",{type:"number",min:"1","onUpdate:modelValue":e[1]||(e[1]=a=>t.value.val.amount=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[ee,t.value.val.amount]])]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),l(m,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:e[2]||(e[2]=a=>t.value.val.amount>1?t.value.val.amount--:""),disable:t.value.val.amount<=1},null,8,["disable"])])]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Ie,[s("div",Qe,[s("div",Te,[l(D,{modelValue:t.value.val.price,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.val.price=a),options:t.value.val.prices,label:"Precios",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])]),t.value.val.price?(u(),_(v,{key:0,spaced:"",inset:"",vertical:"",dark:""})):c("",!0),t.value.val.price?(u(),I("div",Fe,[l(T,{modelValue:t.value.val.price.pivot.price,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.val.price.pivot.price=a),type:"number",label:"Precio",filled:"",dense:"",error:t.value.val.price.pivot.price<=t.value.val.cost,"error-message":"El importe tiene que ser mayor que el costo"},null,8,["modelValue","error"])])):c("",!0)]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),l(T,{dense:"",filled:"",modelValue:t.value.val.notes,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.val.notes=a),type:"text",label:"Notas",error:t.value.val.notes.length<=0,"error-message":"Campo Obligatorio"},null,8,["modelValue","error"]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),l(de,null,{default:i(()=>[l(P,{class:"bg-grey-11"},{default:i(()=>[l(V,{class:"text-left text-caption"},{default:i(()=>[p("P x C")]),_:1}),l(V,{class:"text-bold text-center"},{default:i(()=>[p(b(t.value.pieces)+" pzs",1)]),_:1})]),_:1}),l(P,null,{default:i(()=>[l(V,{class:"text-left text-caption"},{default:i(()=>[p("Unidades")]),_:1}),l(V,{class:"text-bold text-center"},{default:i(()=>[p(b(t.value.val.amount)+" pzs",1)]),_:1})]),_:1}),l(P,{class:"bg-grey-11"},{default:i(()=>[l(V,{class:"text-left text-caption text-bold"},{default:i(()=>[p("Total")]),_:1}),l(V,{class:"text-bold text-center"},{default:i(()=>{var a;return[p("$ "+b(t.value.val.price?t.value.val.amount*((a=t.value.val.price)==null?void 0:a.pivot.price):0),1)]}),_:1})]),_:1})]),_:1})])])]),_:1}),l(re,{align:"center"},{default:i(()=>{var a;return[w(l(m,{flat:"",icon:"close",color:"negative"},null,512),[[F]]),t.value.val.edit==!0?w((u(),_(m,{key:0,flat:"",icon:"edit",color:"warning",onClick:$},null,512)),[[F]]):c("",!0),t.value.val.edit==!1?w((u(),_(m,{key:1,flat:"",icon:"check",color:"positive",onClick:$,disable:((a=t.value.val.price)==null?void 0:a.pivot.price)<=t.value.val.cost||t.value.val.notes.length<=0},null,8,["disable"])),[[F]]):c("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),l(S,{modelValue:y.value.state,"onUpdate:modelValue":e[15]||(e[15]=a=>y.value.state=a)},{default:i(()=>[l(Q,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:i(()=>[Ae,l(E,null,{default:i(()=>{var a;return[s("div",Pe,[Se,s("div",Ge,[l(D,{class:"col-3",modelValue:n.value.EFE.id,"onUpdate:modelValue":e[7]||(e[7]=d=>n.value.EFE.id=d),options:N,"option-value":"id","option-label":"desc",dense:"",filled:"",label:"Forma de pago","option-disable":d=>K(d)},null,8,["modelValue","option-disable"])])]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Ne,[Ue,s("div",$e,b(r.value.reduce((d,g)=>{var O;return d+g.amount*((O=g.price)==null?void 0:O.pivot.price)},0)),1)]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Oe,[s("div",Re,b(((a=n.value.EFE.id)==null?void 0:a.id)=="EFE"?"Efectivo":"Importe Cobrado"),1),s("div",qe,[l(T,{class:"col",modelValue:n.value.EFE.val,"onUpdate:modelValue":e[9]||(e[9]=d=>n.value.EFE.val=d),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(n.value.EFE.val)?(u(),_(m,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:e[8]||(e[8]=d=>n.value.EFE.val=0)})):c("",!0)]),_:1},8,["modelValue","min"])])])]}),_:1}),l(E,null,{default:i(()=>{var a;return[s("div",Be,[s("div",je,[l(m,{color:"primary",label:"2\xAA Forma de pago",onClick:e[10]||(e[10]=()=>{y.value.dafpa=!y.value.dafpa,n.value.DIG.val=0,n.value.DIG.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),y.value.dafpa?(u(),I("div",ze,[l(D,{class:"col-3",modelValue:n.value.DIG.id,"onUpdate:modelValue":e[11]||(e[11]=d=>n.value.DIG.id=d),options:N,label:"Forma Pago","option-value":"id","option-label":"desc",dense:"",filled:"","option-disable":d=>W(d)},null,8,["modelValue","option-disable"])])):c("",!0)]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),y.value.dafpa?(u(),I("div",Le,[s("div",He,b(((a=n.value.DIG.id)==null?void 0:a.id)=="EFE"?"Efectivo":"Importe Cobrado"),1),s("div",Me,[l(T,{class:"col",modelValue:n.value.DIG.val,"onUpdate:modelValue":e[13]||(e[13]=d=>n.value.DIG.val=d),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(n.value.DIG.val)?(u(),_(m,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:e[12]||(e[12]=d=>n.value.DIG.val=0)})):c("",!0)]),_:1},8,["modelValue","min"])])])):c("",!0)]}),_:1}),l(E,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:i(()=>[s("div",null,[Je,s("div",Ye," $ "+b(q(A)),1)]),q(j)?(u(),I("div",Ke,[l(m,{color:"primary",icon:"payment",label:"Pagar",onClick:e[14]||(e[14]=a=>f.value.state=!f.value.state)})])):c("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(S,{modelValue:f.value.state,"onUpdate:modelValue":e[18]||(e[18]=a=>f.value.state=a)},{default:i(()=>[l(Q,{class:"my-card"},{default:i(()=>[l(E,null,{default:i(()=>[We]),_:1}),l(E,null,{default:i(()=>[l(ue,{onSubmit:X,class:"q-gutter-md"},{default:i(()=>[l(D,{dense:"",modelValue:k.value.val,"onUpdate:modelValue":e[16]||(e[16]=a=>k.value.val=a),options:k.value.opts,label:"Caja",filled:"","option-label":"DESTER"},null,8,["modelValue","options"]),l(v,{spaced:"",inset:"",vertical:"",dark:""}),l(D,{dense:"","option-label":"name",modelValue:f.value.val,"onUpdate:modelValue":e[17]||(e[17]=a=>f.value.val=a),options:f.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),s("div",null,[l(m,{label:"Enviar",type:"submit",color:"primary",class:"full-width",disable:f.value.val==null||k.value.val==null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ce,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:i(()=>[s("div",Xe,[l(me,{checkState:!1,onInput:L,with_prices:"",onAgregar:H,class:"col"}),r.value.length>0?(u(),_(v,{key:0,spaced:"",inset:"",vertical:"",dark:""})):c("",!0),r.value.length>0?(u(),_(m,{key:1,color:"primary",icon:"send",onClick:Y,flat:""})):c("",!0)])]),_:1})]),_:1}))}};export{Ql as default};
