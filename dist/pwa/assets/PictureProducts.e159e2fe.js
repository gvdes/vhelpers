import{u as M,r as k,w as G,a as o,h as c,i as t,k as r,d as e,c as g,Q as I,l as x,j as _,a1 as u,a4 as y,a7 as Q,p,a5 as z,n as P,aE as H,a2 as F,a3 as D,aX as J,a6 as K}from"./index.1921fa04.js";import{Q as w}from"./QImg.1d442e0b.js";import{Q as W}from"./QUploader.af76b27c.js";import{a as j}from"./QSelect.638f00a7.js";import{Q as A,a as S,b as $}from"./QList.6a7cc3c7.js";import{Q as Y}from"./QFooter.728d6bb2.js";import{Q as Z}from"./QPage.7ee4e822.js";import{C as ee}from"./ClosePopup.17837eb9.js";import"./exceljs.min.9e24d01d.js";import{u as te}from"./use-quasar.73c732a8.js";import"./dayjs.min.cbcf888d.js";import{p as V}from"./productsApi.25364309.js";import{u as ae}from"./ProductsStore.386e3e66.js";import{P as le}from"./ProductsAutocomplete.1bd93088.js";import{v as E}from"./axios.bf079879.js";import"./QCircularProgress.b77669bb.js";import"./QResizeObserver.56de7862.js";import"./_commonjsHelpers.88e99c8f.js";/* empty css                                                                         */const se={class:"row justify-center"},oe={key:0},re={class:"col"},ie={class:"text-bold"},ne={class:"col"},ue={class:"text-bold"},ce={key:0,class:"col-6 flex flex-center"},de={key:1,class:"col-6 flex flex-center"},ve={key:1},pe={class:"col-6 q-pa-sm flex flex--column justify-between"},me={class:"text-center text-bold text-red-10"},fe={class:"col"},ge={class:"text-bold"},_e={key:0,class:"col"},he={class:"text-bold"},xe={class:"text-green text-subtitle2 q-mb-sm"},ye={class:"text-negative text-subtitle2 q-mb-sm"},be={class:"row q-ml-sm"},Te={__name:"PictureProducts",setup(ke){const h=te();M(),ae().setTitle("Imagenes Productos");const b=k(null),f=k(null),i=k({state:!1,result:{state:!1,val:null}}),a=k({state:!1,val:null}),C=k(null),U=()=>{i.value.state=!0,C.value.click()},B=()=>{b.value.pickFiles()},q=()=>{b.value&&b.value.reset(),f.value=null,a.value.state=!1},L=async()=>{var n;h.loading.show({message:"Subiendo Imagenes"});const l=(n=C.value)==null?void 0:n.files;if(!(l!=null&&l.length)){console.warn("No se seleccion\xF3 ning\xFAn archivo."),i.value.state=!1;return}const s=Array.from(l).map(v=>{const[X]=v.name.split(".");return{code:X,file:v}});console.log(s);const m=new FormData;s.forEach(v=>{m.append("codes[]",v.code),m.append("files[]",v.file)});const d=await V.massiveUpdateImg(m);d.fail?console.log(d):(console.log(d),C.value=null,i.value.result.state=!0,i.value.result.val=d,h.notify({message:`\u2705 ${d.actualizados.length} actualizadas, \u26A0\uFE0F ${d.error.length} con error`,type:"info"}),h.loading.hide())},N=l=>{f.value=URL.createObjectURL(l[0]),a.value.val.imgcoverExist=l[0]},R=l=>{console.log(l),a.value.state=!0,a.value.val=l},T=l=>{console.log(l),a.value.state=!0,a.value.val=l},O=async()=>{h.loading.show({message:"Actualizando Imagen"});const l=new FormData;l.append("id",a.value.val.id),l.append("code",a.value.val.code),l.append("picture",a.value.val.imgcoverExist);const s=await V.updateImgProduct(l);s.fail?console.log(s):(console.log(s),b.value.reset(),f.value=null,a.value.val.imgcoverExist=null,a.value.val.imgcover=s.image,h.notify({message:s.mssg,type:"positive",position:"bottom"}),h.loading.hide())};return G(()=>i.value.result.state,l=>{l||(i.value.result.val={actualizados:[],error:[]},i.value.state=!1)}),(l,s)=>(o(),c(Z,{padding:""},{default:t(()=>[r("div",se,[e(H,{name:"bounce"},{default:t(()=>[a.value.state?(o(),g("div",oe,[e(I,{flat:"",bordered:""},{default:t(()=>[e(x,{class:"text-center row"},{default:t(()=>[r("div",re,[s[1]||(s[1]=_(" Codigo: ")),r("span",ie,u(a.value.val.code),1)]),r("div",ne,[s[2]||(s[2]=_(" CCO: ")),r("span",ue,u(a.value.val.name),1)])]),_:1}),e(y),e(x,{class:"row items-stretch"},{default:t(()=>[a.value.val.imgcover?(o(),g("div",ce,[e(w,{src:`${Q(E)}/Products/${a.value.val.id}/${a.value.val.imgcover}`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1},null,8,["src"])])):(o(),g("div",de,[f.value==null?(o(),c(w,{key:0,src:`${Q(E)}/Products/sinpicture.png`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1,onClick:B},null,8,["src"])):p("",!0),e(W,{ref_key:"uploader",ref:b,accept:".jpg, .png, .jpeg",onAdded:N,"hide-upload-btn":"",style:{display:"none"},"field-name":"file"},null,512),f.value?(o(),g("div",ve,[(o(),c(w,{src:f.value,key:f.value,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%",width:"200px","object-fit":"contain"},ratio:1},null,8,["src"]))])):p("",!0)])),r("div",pe,[r("div",me,u(a.value.val.description),1)])]),_:1}),e(y),e(x,{class:"text-center row"},{default:t(()=>[r("div",fe,[s[3]||(s[3]=_(" Piezas X Caja: ")),r("span",ge,u(a.value.val.pieces),1)]),a.value.val.large?(o(),g("div",_e,[s[4]||(s[4]=_(" MED: ")),r("span",he,u(a.value.val.large),1)])):p("",!0)]),_:1}),e(z,{align:"right"},{default:t(()=>[e(P,{flat:"",label:"Cancel",color:"negative",onClick:q}),e(P,{flat:"",label:"Enviar",color:"positive",disable:!a.value.val.imgcoverExist,onClick:O},null,8,["disable"])]),_:1})]),_:1})])):p("",!0)]),_:1})]),e(K,{modelValue:i.value.result.state,"onUpdate:modelValue":s[0]||(s[0]=m=>i.value.result.state=m),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(I,{style:{"min-width":"400px","max-height":"80vh"}},{default:t(()=>{var m,d;return[e(x,{class:"text-center text-bold text-primary"},{default:t(()=>s[5]||(s[5]=[_(" Resultados de la carga masiva ")])),_:1}),(m=i.value.result.val.actualizados)!=null&&m.length?(o(),c(x,{key:0},{default:t(()=>[r("div",xe,"Actualizados correctamente ("+u(i.value.result.val.actualizados.length)+")",1),e(A,{bordered:"",separator:""},{default:t(()=>[(o(!0),g(D,null,F(i.value.result.val.actualizados,(n,v)=>(o(),c(S,{key:"ok-"+v},{default:t(()=>[e($,null,{default:t(()=>[e(j,null,{default:t(()=>[r("b",null,u(n.Codigo),1)]),_:2},1024),e(j,{caption:""},{default:t(()=>[_(u(n.mssg),1)]),_:2},1024)]),_:2},1024),n.image?(o(),c($,{key:0,side:""},{default:t(()=>[e(w,{src:`${Q(E)}/Products/${n.id}/${n.image}`,alt:n.Codigo,style:{width:"50px",height:"50px","border-radius":"8px","object-fit":"cover"}},null,8,["src","alt"])]),_:2},1024)):p("",!0)]),_:2},1024))),128))]),_:1})]),_:1})):p("",!0),(d=i.value.result.val.error)!=null&&d.length?(o(),c(x,{key:1},{default:t(()=>[r("div",ye,"Errores ("+u(i.value.result.val.error.length)+")",1),e(A,{bordered:"",separator:""},{default:t(()=>[(o(!0),g(D,null,F(i.value.result.val.error,(n,v)=>(o(),c(S,{key:"err-"+v},{default:t(()=>[e($,null,{default:t(()=>[e(j,null,{default:t(()=>[r("b",null,u(n.Codigo||"\u2014"),1)]),_:2},1024),e(j,{caption:""},{default:t(()=>[_(u(n.mssg),1)]),_:2},1024)]),_:2},1024),n.image?(o(),c($,{key:0,side:""},{default:t(()=>[e(w,{src:`${Q(E)}/Products/${n.id}/${n.image}`,alt:n.Codigo,style:{width:"50px",height:"50px","border-radius":"8px","object-fit":"cover"}},null,8,["src","alt"])]),_:2},1024)):p("",!0)]),_:2},1024))),128))]),_:1})]),_:1})):p("",!0),e(z,{align:"right"},{default:t(()=>[J(e(P,{flat:"",label:"Cerrar",color:"primary"},null,512),[[ee]])]),_:1})]}),_:1})]),_:1},8,["modelValue"]),e(Y,{reveal:"",elevated:"",bordered:""},{default:t(()=>[e(y,{spaced:"",inset:"",vertical:"",dark:""}),r("div",be,[r("div",null,[e(P,{icon:"upload",flat:"",onClick:U})]),e(y,{spaced:"",inset:"",vertical:"",dark:""}),i.value.state?p("",!0):(o(),c(I,{key:0,class:"col"},{default:t(()=>[e(le,{checkState:!1,onInput:R,onAgregar:T})]),_:1})),e(y,{spaced:"",inset:"",vertical:"",dark:""})]),e(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),r("input",{type:"file",ref_key:"inputFile",ref:C,id:"inputFile",onInput:L,hidden:"",accept:".jpg, .jpeg, .png",multiple:""},null,544)]),_:1}))}};export{Te as default};
