import{b as _,a as B,d as x,e as m,Q as $}from"./QList.ad92ec23.js";import{Q as j}from"./QHeader.041f94f5.js";import{aW as L,a as P,u as M,r as y,c as U,aX as q,o as C,d as E,w as t,e,f as d,S,Q as v,a0 as b,al as f,a4 as T,aE as H,g as D,a3 as K,a2 as N,h as O,a1 as W,an as J}from"./index.c2f5f4e3.js";import{Q as z}from"./QToolbar.d547e887.js";import{Q as X}from"./QInput.d5f95cb2.js";import{a as G}from"./QSelect.2047fd6e.js";import{a as Z}from"./QExpansionItem.e926aa81.js";import{Q as ee}from"./QTable.41d37387.js";import{Q as ae}from"./QDate.32a37b48.js";import{Q as R}from"./QCardSection.fed8a97e.js";import{Q as oe}from"./QCardActions.d49ddb1a.js";import{Q as te}from"./QCard.7cc3dc50.js";import{Q as le,a as se}from"./QLayout.99a64f83.js";import"./auto.deb582f4.js";import{u as re}from"./use-quasar.39f9e42d.js";import{d as Q}from"./dayjs.min.cbcf888d.js";import{E as ne}from"./exceljs.min.9e24d01d.js";import{E as ie,a as de}from"./jspdf.plugin.autotable.e12e60e4.js";import{_ as ce}from"./UserToolbar.0659b2f7.js";import{A as ue}from"./assistApi.f38523ed.js";import{b as me}from"./axios.ea4a1dc9.js";import"./use-key-composition.a7b75bd7.js";import"./QResizeObserver.121c3205.js";import"./QLinearProgress.789a8ffd.js";import"./QCheckbox.d16d5612.js";import"./use-checkbox.7e1bd460.js";import"./use-render-cache.3aae9b27.js";import"./date.72c537d0.js";import"./QScrollObserver.e23a7fbb.js";import"./_commonjsHelpers.88e99c8f.js";import"./QDrawer.0e1edfa0.js";import"./ClosePopup.8bd06445.js";import"./auth.4421878e.js";const fe={class:"row"},pe={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition"},ge={class:"text-bold"},ve={class:"text-overline"},we={key:0,class:""},be={class:"q-pa-md"},ea={__name:"OpneBoxesLYT",setup(he){const c=re();L(),P(),M();const u=y(!1),w=y(null),p=y([]),h=y({pagination:{rowsPerPage:0},filter:""});U(()=>c.platform.is.mobile);const V=async()=>{c.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const r=await ue.index();if(r.error)console.log(r);else{console.log(r),p.value=r;let a=new Date,s=Q(a).format("YYYY/MM/DD");w.value=s,console.log(s),k(p.value,w.value).finally(()=>{c.loading.hide()})}},k=async(r,a)=>{console.log(a);const s=r.map((o,l)=>new Promise((i,n)=>{setTimeout(()=>{o.sale=null;let I=`http://${o.ip_address}/access/public/reports/OpenCash`;me.post(I,{filt:a}).then(g=>{o.sales=g.data||null,console.log(g.data),console.log(`Sucursal ${o.name} procesada con \xE9xito.`),i({success:!0,data:g.data})}).catch(g=>{console.log(`Error en sucursal ${o.name}: ${g.message}`),o.sales=[],c.notify({message:`Sucursal ${o.name} no tiene conexion`,type:"negative",position:"center"}),i({success:!1,error:g.message})})},l*1e3)}));try{await Promise.all(s)}catch(o){console.error("Error en alguna de las solicitudes:",o)}};V();const Y=()=>{u.value=!1,c.loading.show({message:"Obteniendo Datos"}),k(p.value,w.value).finally(()=>{c.loading.hide()})},A=()=>new Promise((r,a)=>{try{let s=[];p.value.forEach((l,i)=>{s.push([{content:l.name,colSpan:3,styles:{halign:"center",fillColor:[173,216,230],fontStyle:"bold"}}]),l.sales.forEach(n=>{s.push([Q(n.FECFAC).format("YYYY-MM-DD"),n.DESTER,n.TICKETS])})});const o=new ie({format:"letter"});de(o,{head:[["Fecha","Caja","Tickets"]],body:s}),o.save("Reporte de Cajas"),r()}catch(s){a(s)}}),F=()=>{c.loading.show({message:"Importando Ticket"});const r=new ne.Workbook,a=r.addWorksheet("Comparativo");a.columns=[{header:"Fecha",key:"FECFAC",width:20},{header:"Destino",key:"DESTER",width:30},{header:"Tickets",key:"TICKETS",width:10}],p.value.forEach(o=>{const l=a.addRow([o.name]);l.font={bold:!0},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ADD8E6"}},l.alignment={horizontal:"center"},o.sales.forEach(i=>{a.addRow(i)}),a.addRow([])}),(async()=>{const o=await r.xlsx.writeBuffer(),l=new Blob([o],{type:"application/octet-stream"}),i=URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.download="ReporteCajas.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)})(),c.loading.hide()};return(r,a)=>{const s=q("router-view");return C(),E(le,{view:"hHh Lpr fFf"},{default:t(()=>[e(se,null,{default:t(()=>[e(j,{class:"bg-grey-3 text-dark",bordered:""},{default:t(()=>[e(ce),e(_)]),_:1}),e(z,{class:"justify-between"},{default:t(()=>[d("div",null,[a[5]||(a[5]=d("span",{class:"text-grey"},"Helpers",-1)),e(S,{name:"navigate_next",color:"primary"}),a[6]||(a[6]=d("span",{class:"text-h6"},"Cajas Abiertas",-1))]),d("div",fe,[e(v,{color:"primary",icon:"event",onClick:a[0]||(a[0]=o=>u.value=!u.value),flat:"",round:""}),e(v,{color:"primary",icon:"download",onClick:A,flat:"",round:""}),e(v,{color:"primary",icon:"calculate",onClick:F,flat:"",round:""})])]),_:1}),e(ee,{title:"Sucursales",rows:p.value,"hide-header":"",pagination:h.value.pagination,filter:h.value.filter},{"top-right":t(()=>[e(X,{borderless:"",dense:"",debounce:"300",modelValue:h.value.filter,"onUpdate:modelValue":a[1]||(a[1]=o=>h.value.filter=o),placeholder:"Buscar"},{append:t(()=>[e(S,{name:"search"})]),_:1},8,["modelValue"])]),body:t(o=>[d("div",pe,[e(B,{bordered:"",dense:""},{default:t(()=>[e(x,null,{default:t(()=>[e(m,null,{default:t(()=>[e(G,{class:"flex justify-between"},{default:t(()=>{var l;return[d("div",ge,b(o.row.name),1),d("div",ve,[f(b((l=o.row.sales)==null?void 0:l.length)+" ",1),e(v,{color:"grey",flat:"",dense:"",icon:o.expand?"keyboard_arrow_up":"keyboard_arrow_down",onClick:i=>o.expand=!o.expand},null,8,["icon","onClick"])])]}),_:2},1024)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>[o.row.sales?T((C(),D("div",we,[e(_),e(x,{class:"text-center"},{default:t(()=>[e(m,null,{default:t(()=>a[7]||(a[7]=[f(" FECHA ")])),_:1}),e(m,null,{default:t(()=>a[8]||(a[8]=[f(" CAJA ")])),_:1}),e(m,null,{default:t(()=>a[9]||(a[9]=[f(" TICKETS ")])),_:1})]),_:1}),(C(!0),D(K,null,N(o.row.sales,(l,i)=>T((C(),E(x,{class:"text-center",dense:"",clickable:""},{default:t(()=>[e(m,null,{default:t(()=>[f(b(W(Q)(l.FECFAC).format("YYYY-MM-DD")),1)]),_:2},1024),e(m,null,{default:t(()=>[f(b(l.DESTER),1)]),_:2},1024),e(m,null,{default:t(()=>[f(b(l.TICKETS),1)]),_:2},1024)]),_:2},1024)),[[J]])),256))],512)),[[H,o.expand]]):O("",!0)]),_:2},1024)]),_:2},1024),e(_,{spaced:"",inset:"",vertical:"",dark:""})])]),_:1},8,["rows","pagination","filter"]),e($,{modelValue:u.value,"onUpdate:modelValue":a[4]||(a[4]=o=>u.value=o)},{default:t(()=>[e(te,{class:"my-card"},{default:t(()=>[e(R,null,{default:t(()=>[d("div",be,[a[10]||(a[10]=d("div",{class:"q-pb-sm"},null,-1)),e(ae,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=o=>w.value=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(R,null,{default:t(()=>[e(oe,{align:"right"},{default:t(()=>[e(v,{flat:"",icon:"close",color:"negative",onClick:a[3]||(a[3]=o=>u.value=!u.value)}),e(v,{flat:"",icon:"check",color:"positive",onClick:Y})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(s)]),_:1})]),_:1})}}};export{ea as default};
