import{Q as he}from"./QRadio.1c5f09dd.js";import{Q as de}from"./QCheckbox.4d9ed756.js";import{Q as ke}from"./QToggle.068ac46d.js";import{i as ue,aL as we,c as C,j as R,t as ce,D as Ve,E as X,F as Ce,k as Qe,r as F,o as y,g as $,a3 as K,a2 as Y,e as t,f as u,Q as V,u as Pe,l as Se,p as Fe,m as $e,d as A,w as s,h as D,ak as B,S as qe,a0 as w,al as Oe,a4 as ne}from"./index.5cd8bf7f.js";import{i as Ne,j as De}from"./use-key-composition.28d192d9.js";import{b as L,a as Z,d as ee,e as H,Q as te}from"./QList.d00c8370.js";import{Q as O}from"./QCardSection.8133d3e1.js";import{Q as ae,a as z,q as Le}from"./QSelect.9a88dcc4.js";import{Q as J}from"./QCard.cc9a043d.js";import{Q as Ie}from"./QInput.05b060b5.js";import{Q as le}from"./QCardActions.7f616b43.js";import{Q as Ae}from"./QBtnGroup.f738d57b.js";import{Q as Be}from"./QTable.d9f133cd.js";import{Q as Ee}from"./QPage.795082c6.js";import{C as ie}from"./ClosePopup.f274f120.js";import"./QDrawer.a1d39b14.js";import"./axios.f821ef00.js";import{u as Ue}from"./use-quasar.3c11604f.js";import{P as Te,d as ze}from"./ProductsAutocomplete.a28bf747.js";import{_ as Re}from"./OptionsLabels.d49a6111.js";import{l as re}from"./locationsApi.56a5b32d.js";import{E as je}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.d3cdd287.js";import"./dayjs.min.cbcf888d.js";import"./QLinearProgress.6e950e52.js";import"./QResizeObserver.4adcbba6.js";import"./QScrollObserver.ae5844cd.js";/* empty css                                                                         */import"./QImg.40abdea9.js";import"./labels.2930c1ba.js";import"./_commonjsHelpers.88e99c8f.js";const pe={radio:he,checkbox:de,toggle:ke},Ge=Object.keys(pe);function oe(a,x){if(typeof a=="function")return a;const i=a!==void 0?a:x;return r=>r[i]}var Me=ue({name:"QOptionGroup",props:{...Ne,modelValue:{required:!0},options:{type:Array,validator:a=>a.every(we),default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],name:String,type:{type:String,default:"radio",validator:a=>Ge.includes(a)},color:String,keepColor:Boolean,dense:Boolean,size:String,leftLabel:Boolean,inline:Boolean,disable:Boolean},emits:["update:modelValue"],setup(a,{emit:x,slots:i}){const{proxy:{$q:r}}=ce(),Q=Array.isArray(a.modelValue);a.type==="radio"?Q===!0&&console.error("q-option-group: model should not be array"):Q===!1&&console.error("q-option-group: model should be array in your case");const g=De(a,r),P=C(()=>pe[a.type]),h=C(()=>oe(a.optionValue,"value")),v=C(()=>oe(a.optionLabel,"label")),_=C(()=>oe(a.optionDisable,"disable")),b=C(()=>a.options.map(n=>({val:h.value(n),name:n.name===void 0?a.name:n.name,disable:a.disable||_.value(n),leftLabel:n.leftLabel===void 0?a.leftLabel:n.leftLabel,color:n.color===void 0?a.color:n.color,checkedIcon:n.checkedIcon,uncheckedIcon:n.uncheckedIcon,dark:n.dark===void 0?g.value:n.dark,size:n.size===void 0?a.size:n.size,dense:a.dense,keepColor:n.keepColor===void 0?a.keepColor:n.keepColor}))),d=C(()=>"q-option-group q-gutter-x-sm"+(a.inline===!0?" q-option-group--inline":"")),k=C(()=>{const n={role:"group"};return a.type==="radio"&&(n.role="radiogroup",a.disable===!0&&(n["aria-disabled"]="true")),n});function c(n){x("update:modelValue",n)}return()=>R("div",{class:d.value,...k.value},a.options.map((n,S)=>{const j=i["label-"+S]!==void 0?()=>i["label-"+S](n):i.label!==void 0?()=>i.label(n):void 0;return R("div",[R(P.value,{label:j===void 0?v.value(n):null,modelValue:a.modelValue,"onUpdate:modelValue":c,...b.value[S]},j)])}))}});const He={position:{type:String,default:"bottom-right",validator:a=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(a)},offset:{type:Array,validator:a=>a.length===2},expand:Boolean};function Je(){const{props:a,proxy:{$q:x}}=ce(),i=Ve(Ce,X);if(i===X)return console.error("QPageSticky needs to be child of QLayout"),X;const r=C(()=>{const d=a.position;return{top:d.indexOf("top")!==-1,right:d.indexOf("right")!==-1,bottom:d.indexOf("bottom")!==-1,left:d.indexOf("left")!==-1,vertical:d==="top"||d==="bottom",horizontal:d==="left"||d==="right"}}),Q=C(()=>i.header.offset),g=C(()=>i.right.offset),P=C(()=>i.footer.offset),h=C(()=>i.left.offset),v=C(()=>{let d=0,k=0;const c=r.value,n=x.lang.rtl===!0?-1:1;c.top===!0&&Q.value!==0?k=`${Q.value}px`:c.bottom===!0&&P.value!==0&&(k=`${-P.value}px`),c.left===!0&&h.value!==0?d=`${n*h.value}px`:c.right===!0&&g.value!==0&&(d=`${-n*g.value}px`);const S={transform:`translate(${d}, ${k})`};return a.offset&&(S.margin=`${a.offset[1]}px ${a.offset[0]}px`),c.vertical===!0?(h.value!==0&&(S[x.lang.rtl===!0?"right":"left"]=`${h.value}px`),g.value!==0&&(S[x.lang.rtl===!0?"left":"right"]=`${g.value}px`)):c.horizontal===!0&&(Q.value!==0&&(S.top=`${Q.value}px`),P.value!==0&&(S.bottom=`${P.value}px`)),S}),_=C(()=>`q-page-sticky row flex-center fixed-${a.position} q-page-sticky--${a.expand===!0?"expand":"shrink"}`);function b(d){const k=Qe(d.default);return R("div",{class:_.value,style:v.value},a.expand===!0?k:[R("div",k)])}return{$layout:i,getStickyContent:b}}var Ke=ue({name:"QPageSticky",props:He,setup(a,{slots:x}){const{getStickyContent:i}=Je();return()=>i(x)}});const Ye={class:"text-right"},We={__name:"selectsLocations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(a,{emit:x}){const i=a,r=x,Q=v=>i.sections.filter(_=>_.root===v),g=F([{options:i.sections.filter(v=>v.root===0),selected:null}]),P=(v,_)=>{g.value.splice(_+1);const b=Q(v);b.length&&g.value.push({options:b,selected:null})},h=()=>{const v=g.value.filter(b=>b.selected!==null),_=v[v.length-1];r("obtProducts",_)};return(v,_)=>(y(),$("div",null,[(y(!0),$(K,null,Y(g.value,(b,d)=>(y(),$("div",{key:d},[t(ae,{modelValue:b.selected,"onUpdate:modelValue":[k=>b.selected=k,k=>P(k,d)],options:b.options,label:`Nivel ${d+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(L,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),u("div",Ye,[t(V,{flat:"",icon:"send",disable:!g.value[0].selected,onClick:h},null,8,["disable"])])]))}},Xe={class:"text-center"},Ze={class:"row text-center"},et={key:0,class:"col"},tt={class:"row"},lt={class:"row"},ot={key:0,class:"col"},at={key:1,class:"col"},st={key:0,class:"row"},nt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},it={class:"text-h5 text-bold text-center"},rt={class:"text-subtitle2 text-bold text-center"},dt={class:"text-subtitle2 text-bold text-center"},ut={class:"text-subtitle2 text-bold text-center"},ct={class:"text-subtitle2 text-bold text-center"},pt={class:"row"},vt={class:"text-center"},ft={class:"text-center"},mt={class:"text-bold q-pb-sm text-center"},gt={class:"row q-pt-xs"},bt={class:"text-negative"},Wt={__name:"products",setup(a){const x=Pe(),i=Ue(),r=F([]),Q=F([]),g=F(null),P=F(!1),h=F({val:{id:1,label:"Productos"},opts:[{id:1,label:"Productos"},{id:2,label:"Ubicacion"}]}),v=F({filter:"",pagination:{rowsPerPage:9}}),_=F({state:!1}),b=F({state:!1}),d=F({val:[0,1,2,4],opts:[{label:"Menudeo",value:1},{label:"Mayoreo",value:2},{label:"Docena",value:3},{label:"Caja",value:4}]}),k=F(null),c=F({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[]}),n=o=>{let l=[],e=[],p=new Object;return o.products.map(f=>S(f.prices)?l.push(f):e.push(f)),console.log(o),p.notFound=l,p.add=e,p},S=o=>{let l=!0;return o.map((e,p)=>{l=e.pivot.price==0}),l},j=o=>{console.log(o);let l=r.value.findIndex(e=>e.id==o.id);if(console.log(l),l>=0)r.value[l]._copies++;else{let e=G(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,r.value.push(o),console.log(o)}},ve=o=>{console.log(o);let l=r.value.findIndex(e=>e.id==o.id);if(console.log(l),l>=0)r.value[l]._copies++;else{let e=G(o.prices,o.pieces);o._copies=1,o.type=e.type,o.usedPrices=e.prices,o._copies=1,r.value.push(o),console.log(o)}},fe=o=>{let l=r.value.findIndex(e=>e.id==o.id);r.value.splice(l,1)},me=()=>{r.value=[],_.value.state=!1},ge=()=>{k.value.click()},be=async()=>{let o=document.getElementById("inputFile").files[0],l=new je.Workbook,e=[],p=[],f=0;l.xlsx.load(o).then(m=>{if(l.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(N,I){N.value&&e.push(N.value)}),p=e.filter((N,I,T)=>T.indexOf(N)==I),e.length){let N={codes:e,_workpoint:x.session.store.id_viz};console.log(N),i.loading.show({message:"Procesando archivo, espera.."}),ze.getMassive(N).then(I=>{let T=I.data,W=0,M=n(T);if(T.fails.notFound.map(q=>c.value.wndNotExist.push(q)),c.value.wndGetRows=M.add.length,c.value.state=!c.value.state,c.value.wndGetAdded=M.add,c.value.wndNoDataFound=M.notFound,c.value.wndNoDataFound.length>0){let q=c.value.wndNoDataFound.length;c.value.message=q<=1?"El producto no contiene precios.":"Los productos no contienen precios."}M.add.map(q=>{let se=G(q.prices,q.pieces);q._copies=1,q.type=se.type,q.usedPrices=se.prices,r.value.push(q),W++}),W&&!T.fails.notFound.length&&p.length==e.length?i.notify({message:`Etiquetas generadas: ${W}`,color:"positive",icon:"done",timeout:1e3}):(f=e.length-p.length,c.value.messageRepeat=f<=1?`${f} producto se repitio. Favor de validar su documento antes de subirlo.`:`${f} productos se repitieron. Favor de validar su documento antes de subirlo.`),console.log(c.value),i.loading.hide()}).catch(I=>{console.log(I),i.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else i.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},G=(o,l)=>{let e=[...o];e.sort((m,E)=>m.pivot._type-E.pivot._type),console.log(e);const p=e.find(m=>m.pivot._type==4),f=e.find(m=>m.pivot._type==1);if(p.pivot.price==f.pivot.price){let m={id:0,alias:"OFERTA",name:"Oferta",pivot:{price:e[0].pivot.price},used:!0};return console.log("oferta"),{type:"off",prices:[m]}}else return console.log("estandar"),{type:"std",prices:e}},ye=o=>{switch(o){case"off":return"orange-9";case"std":return"green-9"}},_e=async()=>{if(h.value.val.id==2){i.loading.show({message:"Obteniendo Secciones"});const o=await re.index(x.session.store.id_viz);o.fail?console.log(o):(console.log(o),Q.value=o),i.loading.hide()}},xe=async o=>{i.loading.show({message:"Obteniendo Productos"});let l={section:o.selected,workpoint:x.session.store.id_viz,update:P.value};const e=await re.obtProductSections(l);if(e.fail)console.log(e);else{console.log(e);let p={products:e};p.products.length>0?(n(p).add.map(m=>{let E=r.value.findIndex(U=>U.id==m.id);if(E>=0)r.value[E]._copies++;else{let U=G(m.prices,m.pieces);m._copies=1,m.type=U.type,m.usedPrices=U.prices,r.value.push(m)}}),i.loading.hide()):(i.loading.hide(),i.notify({message:"No Hay Articulos Ubicados x(",type:"negative",position:"center",icon:"mood_bad"}))}};return Se(()=>r.value,o=>{localStorage.setItem("applabels",JSON.stringify(o))},{deep:!0}),Fe(()=>{const o=localStorage.getItem("applabels");o&&(r.value=JSON.parse(o))}),$e(()=>{}),(o,l)=>(y(),A(Ee,{padding:""},{default:s(()=>[t(J,{class:"my-card"},{default:s(()=>[t(O,null,{default:s(()=>[u("div",Xe,[l[10]||(l[10]=u("div",{class:"text-bold"},"Selecciona los Precios",-1)),t(Me,{options:d.value.opts,type:"toggle",modelValue:d.value.val,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value.val=e),inline:""},null,8,["options","modelValue"])]),u("div",Ze,[t(V,{class:"col",outline:"",color:"primary",icon:"upload_file",title:"Subir Etiquetas",onClick:ge}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),r.value.length>0?(y(),$("div",et,[u("div",tt,[t(V,{class:"col",outline:"",color:"primary",icon:"delete",title:"Eliminar Etiquetas",onClick:l[1]||(l[1]=e=>_.value.state=!_.value.state)}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),t(V,{class:"col",outline:"",color:"primary",icon:"download",title:"Descargar Etquetas",onClick:l[2]||(l[2]=e=>b.value.state=!b.value.state)})])])):D("",!0)]),u("input",{type:"file",ref_key:"inputFile",ref:k,id:"inputFile",onInput:be,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}),t(O,null,{default:s(()=>[u("div",lt,[t(ae,{style:{width:"80px"},modelValue:h.value.val,"onUpdate:modelValue":[l[3]||(l[3]=e=>h.value.val=e),_e],options:h.value.opts,filled:"",dense:"","hide-dropdown-icon":""},null,8,["modelValue","options"]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),h.value.val.id==1?(y(),$("div",ot,[t(Te,{onInput:j,onAgregar:ve,with_prices:""})])):D("",!0),h.value.val.id==2?(y(),$("div",at,[Q.value.length>0?(y(),$("div",st,[t(Z,{dense:""},{default:s(()=>[t(ee,null,{default:s(()=>[t(H,null,{default:s(()=>[t(z,{caption:""},{default:s(()=>l[11]||(l[11]=[B("ACT HOY")])),_:1}),t(z,{class:"flex flex-center"},{default:s(()=>[t(de,{dense:"",modelValue:P.value,"onUpdate:modelValue":l[4]||(l[4]=e=>P.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ae,{class:"col",modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=e=>g.value=e),options:Q.value,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),t(L,{spaced:"",inset:"",vertical:"",dark:""}),g.value?(y(),A(We,{key:0,sections:g.value.sections,onObtProducts:xe},null,8,["sections"])):D("",!0)])):D("",!0)])):D("",!0)])]),_:1})]),_:1}),t(L,{spaced:"",inset:"",vertical:"",dark:""}),t(Be,{rows:r.value,"row-key":"name",grid:"",filter:v.value.filter,pagination:v.value.pagination,"no-data-label":"''"},{"top-right":s(()=>[t(Ie,{borderless:"",dense:"",debounce:"300",modelValue:v.value.filter,"onUpdate:modelValue":l[6]||(l[6]=e=>v.value.filter=e),placeholder:"Buscar"},{append:s(()=>[t(qe,{name:"search"})]),_:1},8,["modelValue"])]),item:s(e=>[u("div",nt,[t(J,{class:"my-card"},{default:s(()=>[t(O,null,{default:s(()=>{var p;return[t(Le,{size:"sm",class:"fixed-right absolute-right text-bold text-white text-uppercase",color:ye(e.row.type)},{default:s(()=>[B(w(e.row.type),1)]),_:2},1032,["color"]),u("div",it,w(e.row.code),1),u("div",rt,w(e.row.name),1),u("div",dt,w(e.row.label),1),u("div",ut,"Longitud: "+w(e.row.large),1),u("div",ct,"Ubicacion: "+w((p=e.row.locations)==null?void 0:p.map(f=>f.path).join("/")),1),t(L,{spaced:"",inset:"",vertical:"",dark:""}),u("div",pt,[(y(!0),$(K,null,Y(e.row.usedPrices.filter(f=>d.value.val.includes(f.id)),(f,m)=>(y(),$("div",{class:"col items-start",key:m},[u("div",vt,w(f.alias),1),u("div",ft,w(f.pivot.price),1)]))),128))])]}),_:2},1024),t(le,{align:"center"},{default:s(()=>[t(V,{flat:"",icon:"delete",color:"negative",onClick:p=>fe(e.row)},null,8,["onClick"]),t(V,{flat:"",icon:"add",onClick:p=>e.row._copies++},null,8,["onClick"]),u("div",null,[l[12]||(l[12]=u("div",{class:"text-caption text--2"},"copias",-1)),u("div",mt,w(e.row._copies),1)]),t(V,{flat:"",icon:"remove",onClick:p=>e.row._copies<=1?"":e.row._copies--},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),bottom:s(e=>[t(Ke,{position:"bottom",class:"full-width",offset:[0,18]},{default:s(()=>[u("div",gt,[t(Ae,{rounded:"",flat:"",color:"primary"},{default:s(()=>[e.pagesNumber>2?(y(),A(V,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):D("",!0),t(V,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),t(V,{flat:"",disable:"","no-caps":""},{default:s(()=>[B(w(e.pagination.page)+" / "+w(e.pagesNumber),1)]),_:2},1024),t(V,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(y(),A(V,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):D("",!0)]),_:2},1024)])]),_:2},1024)]),"no-data":s(()=>l[13]||(l[13]=[])),_:1},8,["rows","filter","pagination"]),t(te,{modelValue:_.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>_.value.state=e),persistent:""},{default:s(()=>[t(J,null,{default:s(()=>[t(O,{class:"row items-center"},{default:s(()=>[t(Oe,{icon:"warning",color:"white","text-color":"negative"}),l[14]||(l[14]=u("div",{class:"q-ml-sm"},"Se eliminaran todos los articulos de la lista ",-1))]),_:1}),t(O,null,{default:s(()=>l[15]||(l[15]=[u("div",{class:"q-ml-sm"},"Deseas Continuar?",-1)])),_:1}),t(le,{align:"right"},{default:s(()=>[ne(t(V,{flat:"",label:"No",color:"positive"},null,512),[[ie]]),t(V,{flat:"",label:"Si",color:"negative",onClick:me})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:b.value.state,"onUpdate:modelValue":l[8]||(l[8]=e=>b.value.state=e),persistent:""},{default:s(()=>[t(Re,{products:r.value,prices:d.value},null,8,["products","prices"])]),_:1},8,["modelValue"]),t(te,{modelValue:c.value.state,"onUpdate:modelValue":l[9]||(l[9]=e=>c.value.state=e)},{default:s(()=>[t(J,{class:"my-card",style:{width:"70%"}},{default:s(()=>[t(O,{class:"items-center"},{default:s(()=>[l[16]||(l[16]=u("div",{class:"text-center text-bold"},"Repetidos",-1)),u("div",bt,w(c.value.messageRepeat),1)]),_:1}),t(O,null,{default:s(()=>[l[17]||(l[17]=u("div",{class:"text-center"},"Productos Sin Precio",-1)),t(Z,null,{default:s(()=>[(y(!0),$(K,null,Y(c.value.wndNoDataFound,(e,p)=>(y(),A(ee,{key:p},{default:s(()=>[t(H,null,{default:s(()=>[t(z,{overline:""},{default:s(()=>[B(w(e.code),1)]),_:2},1024)]),_:2},1024),t(H,null,{default:s(()=>[t(z,{caption:""},{default:s(()=>[B(w(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(O,null,{default:s(()=>[l[18]||(l[18]=u("div",{class:"text-center"},"Productos Sin Existencia",-1)),t(Z,null,{default:s(()=>[(y(!0),$(K,null,Y(c.value.wndNotExist,(e,p)=>(y(),A(ee,{key:p},{default:s(()=>[t(H,null,{default:s(()=>[t(z,{overline:""},{default:s(()=>[B(w(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(le,{align:"right"},{default:s(()=>[ne(t(V,{flat:"",label:"OK",color:"primary"},null,512),[[ie]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Wt as default};
