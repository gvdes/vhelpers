import{f as we,u as ye,r as k,g as _,a as B,h as re,i as s,d as t,a4 as w,Q as xe,l as Ne,k as E,j as L,ah as C,n as M,c as Ce,a2 as he,a3 as Qe,a0 as O,bc as R,m as Ve,aX as De,a1 as _e,bb as Me,aj as Se}from"./index.8c0f41e3.js";import{Q as Ye}from"./QHeader.eea29f6c.js";import{Q as Be}from"./QToolbarTitle.a0d87e17.js";import{e as ce,Q as F,a as Ee}from"./QSelect.ca1146ab.js";import{Q as Le,a as Oe,b as de}from"./QList.b4c12bd4.js";import{Q as Re}from"./QDate.be635bef.js";import{Q as ue}from"./QToolbar.a3b2da48.js";import{Q as Fe}from"./QTable.70b43c91.js";import{Q as Te}from"./QPage.89b7850a.js";import{Q as Ue,a as je}from"./QLayout.c82cf49d.js";import{u as Ae}from"./use-quasar.2bb2ef5c.js";import{r as me}from"./reportApi.1f8b672f.js";import{E as Xe}from"./exceljs.min.9e24d01d.js";import{d as y}from"./dayjs.min.cbcf888d.js";import{c as Ie}from"./_commonjsHelpers.88e99c8f.js";import{_ as Pe}from"./UserToolbar.9b57cd43.js";import"./QExpansionItem.22b5f00b.js";import"./jspdf.plugin.autotable.68970819.js";import"./axios.c9f3d0b6.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./ClosePopup.b46b6957.js";import"./QResizeObserver.f7d7dc26.js";import"./use-render-cache.3aae9b27.js";import"./date.5c802095.js";import"./QLinearProgress.044f3768.js";import"./QScrollObserver.1f4160ab.js";import"./QImg.912bbcad.js";import"./QSpace.70ea1c72.js";import"./favorites.9ebca4c8.js";import"./auth.7fb029c1.js";var pe={exports:{}};(function(T,U){(function(u,p){T.exports=p()})(Ie,function(){var u="week",p="year";return function(h,x,f){var g=x.prototype;g.week=function(o){if(o===void 0&&(o=null),o!==null)return this.add(7*(o-this.week()),"day");var m=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var N=f(this).startOf(p).add(1,p).date(m),S=f(this).endOf(u);if(N.isBefore(S))return 1}var Y=f(this).startOf(p).date(m).startOf(u).subtract(1,"millisecond"),Q=this.diff(Y,u,!0);return Q<0?f(this).startOf("week").week():Math.ceil(Q)},g.weeks=function(o){return o===void 0&&(o=null),this.week(o)}}})})(pe);var $e=pe.exports;const Ca={__name:"reportsAudLYT",setup(T){y.extend($e),we();const U=ye(),u=Ae(),p=new Date,h=k(y(p).format("YYYY/MM/DD")),x=k([{id:1,label:"PERSONALIZADA",active:!0},{id:2,label:"DIA",active:!1},{id:3,label:"SEMANA",active:!1},{id:4,label:"MES",active:!1}]),f=k(y(p).format("YYYY/MM/DD")),g=k([]),o=k({seccion:null,familia:null,categoria:null}),m=k([]),N=k({columns:[{name:"code",label:"Codigo",field:a=>a.code,align:"left"},{name:"description",label:"Descripcion",field:a=>a.description,align:"left"},{name:"cb",label:"CB",field:a=>a.barcode,align:"left"},{name:"section",label:"Seccion",field:a=>a.category.familia.seccion.name,align:"left"},{name:"family",label:"Familia",field:a=>a.category.familia.name,align:"left"},{name:"category",label:"Categoria",field:a=>a.category.name,align:"left"},{name:"provider",label:"Proveedor",field:a=>a.providers.name,align:"left"},{name:"pxc",label:"PXC",field:a=>a.pieces,align:"center"},{name:"ultll",label:"Ultima_LL",field:a=>{var e,l;return a.purchases.length?y((l=a.purchases)==null?void 0:l.reduce((n,v)=>new Date(v.created_at)>new Date(n)?v.created_at:n,(e=a.purchases[0])==null?void 0:e.created_at)).format("YYYY/MM/DD"):null},align:"left"},{name:"purchase",label:"Compras",field:a=>a.purchases.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0),align:"center"},{name:"purchasexc",label:"Compras X C",field:a=>Number(Number(a.purchases.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0))/Number(a.pieces)).toFixed(2),align:"center"},{name:"sales",label:"Ventas",field:a=>Number(a.sales.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0)),align:"center"},{name:"salesxc",label:"Ventas X C",field:a=>Number(Number(a.sales.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0))/Number(a.pieces)).toFixed(2),align:"center"},{name:"stock",label:"Stock",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.stock},align:"center"},{name:"stockxc",label:"Stock X C",field:a=>{var e,l;return Number(Number((l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.stock)/Number(a.pieces)).toFixed(2)},align:"center"},{name:"min",label:"Minimo",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.min},align:"center"},{name:"max",label:"Maximo",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.max},align:"center"},{name:"in_transit",label:"En Transito",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.in_transit},align:"center"},{name:"centro",label:"Centro",field:a=>{var e;return(e=a.prices.find(l=>l.id==6).pivot)==null?void 0:e.price},align:"center"},{name:"especial",label:"Especial",field:a=>{var e;return(e=a.prices.find(l=>l.id==5).pivot)==null?void 0:e.price},align:"center"},{name:"caja",label:"Caja",field:a=>{var e;return(e=a.prices.find(l=>l.id==4).pivot)==null?void 0:e.price},align:"center"},{name:"docena",label:"Docena",field:a=>{var e;return(e=a.prices.find(l=>l.id==3).pivot)==null?void 0:e.price},align:"center"},{name:"mayoreo",label:"Mayoreo",field:a=>{var e;return(e=a.prices.find(l=>l.id==2).pivot)==null?void 0:e.price},align:"center"},{name:"menudeo",label:"Menudeo",field:a=>{var e;return(e=a.prices.find(l=>l.id==1).pivot)==null?void 0:e.price},align:"center"}],filter:null}),S=_(()=>x.value.filter(a=>a.active).length>0),Y=_(()=>g.value.filter(a=>a.deep==0)),Q=_(()=>{let a=g.value.filter(e=>e.deep==1);return o.value.seccion?a.filter(e=>e.root==o.value.seccion.id):a}),fe=_(()=>{let a=g.value.filter(e=>e.deep==2);return o.value.familia?a.filter(e=>e.root==o.value.familia.id):a}),ve=async()=>{u.loading.show({message:"Obteniendo Categorias"});const a=await me.init();a.fail?console.log(a):(g.value=a,u.loading.hide())},be=async()=>{u.loading.show({message:"Obteniendo Datos"});let a,e=x.value.find(v=>v.active);switch(e.id){case 1:a=f.value;break;case 2:a=h.value;break;case 3:a=y(h.value).week();break;case 4:a=y(h.value).month()+1;break}let l={workpoint:U.session.store,time:e,range:a,filters:o.value};console.log(l);const n=await me.obtReport(l);n.fail?console.log(n):(console.log(n),m.value=n,u.loading.hide())},ge=()=>{m.value=[],o.value.familia=null,o.value.categoria=null},ke=()=>{const a=new Xe.Workbook,e=a.addWorksheet("Reporte");let l=m.value.map(i=>{var V,D,b,A,X,I,P,$,q,H,W,G,J,Z,z,K,ee,ae,le,te,ie,oe,ne,se;return{Codigo:i.code,Descripcion:i.description,CB:i.barcode,Seccion:i.category.familia.seccion.name,Familia:i.category.familia.name,Categoria:i.category.name,Proveedor:i.providers.name,PXC:i.pieces,Ultima_LL:i.purchases.length?y((D=i.purchases)==null?void 0:D.reduce((r,d)=>new Date(d.created_at)>new Date(r)?d.created_at:r,(V=i.purchases[0])==null?void 0:V.created_at)).format("YYYY/MM/DD"):null,Compras:i.purchases.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0),"Compras X C":Number(Number(Number(i.purchases.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0))/Number(i.pieces)).toFixed(2)),Ventas:Number(i.sales.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0)),"Ventas X C":Number(Number(Number(i.sales.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0))/Number(i.pieces)).toFixed(2)),Stock:(A=(b=i.stocks[0])==null?void 0:b.pivot)==null?void 0:A.stock,"Stock X C":Number(Number(Number((I=(X=i.stocks[0])==null?void 0:X.pivot)==null?void 0:I.stock)/Number(i.pieces)).toFixed(2)),Minimo:($=(P=i.stocks[0])==null?void 0:P.pivot)==null?void 0:$.min,Maximo:(H=(q=i.stocks[0])==null?void 0:q.pivot)==null?void 0:H.max,"En Transito":(G=(W=i.stocks[0])==null?void 0:W.pivot)==null?void 0:G.in_transit,Centro:(Z=(J=i.prices.find(r=>r.id==6))==null?void 0:J.pivot)==null?void 0:Z.price,Especial:(K=(z=i.prices.find(r=>r.id==5))==null?void 0:z.pivot)==null?void 0:K.price,Caja:(ae=(ee=i.prices.find(r=>r.id==4))==null?void 0:ee.pivot)==null?void 0:ae.price,Docena:(te=(le=i.prices.find(r=>r.id==3))==null?void 0:le.pivot)==null?void 0:te.price,Mayoreo:(oe=(ie=i.prices.find(r=>r.id==2))==null?void 0:ie.pivot)==null?void 0:oe.price,Menudeo:(se=(ne=i.prices.find(r=>r.id==1))==null?void 0:ne.pivot)==null?void 0:se.price}});const n=Object.keys(l[0]).map(i=>({name:i,filterButton:!0})),v=l.map(i=>Object.values(i));e.addTable({name:"Reporte",ref:"A1",headerRow:!0,style:{showRowStripes:!0},columns:n,rows:v}),(async()=>{const i=await a.xlsx.writeBuffer(),V=new Blob([i],{type:"application/octet-stream"}),D=URL.createObjectURL(V),b=document.createElement("a");b.href=D,b.download="Reporte.xlsx",document.body.appendChild(b),b.click(),document.body.removeChild(b)})()};return ve(),(a,e)=>(B(),re(Ue,{view:"hHh Lpr fFf"},{default:s(()=>[t(Ye,{class:"transparent text-dark",bordered:""},{default:s(()=>[t(Pe),t(w),t(w)]),_:1}),t(w,{spaced:"",inset:"",vertical:"",dark:""}),t(je,{class:"q-ml-sm"},{default:s(()=>[t(Te,{padding:""},{default:s(()=>[t(xe,{class:"my-card"},{default:s(()=>[t(Ne,null,{default:s(()=>[t(ue,null,{default:s(()=>{var l;return[t(Be,null,{default:s(()=>[E("div",null,[e[8]||(e[8]=E("span",{class:"text-grey"},"Helpers",-1)),e[9]||(e[9]=L()),t(C,{name:"navigate_next",color:"primary"}),e[10]||(e[10]=L()),e[11]||(e[11]=E("span",{class:"text-h6"},"Reportes Auditoria",-1))])]),_:1}),t(M,{flat:"",round:"",dense:"",icon:"apps",class:"q-mr-xs"},{default:s(()=>[t(ce,null,{default:s(()=>[t(Le,{style:{"min-width":"100px"}},{default:s(()=>[(B(!0),Ce(Qe,null,he(x.value,(n,v)=>De((B(),re(Oe,{tag:"label",key:v},{default:s(()=>[t(de,null,{default:s(()=>[t(Ee,null,{default:s(()=>[L(_e(n.label),1)]),_:2},1024)]),_:2},1024),t(de,{side:"",top:""},{default:s(()=>[t(Me,{color:"primary",modelValue:n.active,"onUpdate:modelValue":j=>n.active=j,val:"friend",disable:S.value&&!n.active},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)]),_:2},1024)),[[Se]])),128))]),_:1})]),_:1})]),_:1}),t(M,{flat:"",round:"",dense:"",icon:"event",disable:((l=x.value.find(n=>n.active))==null?void 0:l.id)!=1},{default:s(()=>[t(ce,null,{default:s(()=>[t(Re,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),range:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"])]}),_:1}),t(w,{spaced:"",inset:"",vertical:"",dark:""}),t(ue,{class:"row"},{default:s(()=>[t(F,{class:"col",modelValue:o.value.seccion,"onUpdate:modelValue":[e[2]||(e[2]=l=>o.value.seccion=l),ge],options:Y.value,label:"Seccion","option-label":"name",filled:"",dense:""},O({_:2},[o.value.seccion?{name:"append",fn:s(()=>[t(C,{name:"cancel",onClick:e[1]||(e[1]=R(()=>{o.value.familia=null,o.value.categoria=null,o.value.seccion=null},["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),t(w,{spaced:"",inset:"",vertical:"",dark:""}),t(F,{class:"col",modelValue:o.value.familia,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.familia=l),options:Q.value,label:"Familia","option-label":"name",filled:"",dense:"",disable:!o.value.seccion},O({_:2},[o.value.familia?{name:"append",fn:s(()=>[t(C,{name:"cancel",onClick:e[3]||(e[3]=R(()=>{o.value.familia=null,o.value.categoria=null},["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","disable"]),t(w,{spaced:"",inset:"",vertical:"",dark:""}),t(F,{class:"col",modelValue:o.value.categoria,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.categoria=l),options:fe.value,label:"Categoria","option-label":"name",filled:"",dense:"",disable:!o.value.familia},O({_:2},[o.value.categoria?{name:"append",fn:s(()=>[t(C,{name:"cancel",onClick:e[5]||(e[5]=R(()=>{o.value.categoria=null},["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","disable"]),t(w,{spaced:"",inset:"",vertical:"",dark:""}),t(M,{color:"primary",icon:"send",flat:"",disabled:!o.value.seccion,onClick:be},null,8,["disabled"])]),_:1})]),_:1})]),_:1}),t(Fe,{rows:m.value,columns:N.value.columns},{"top-right":s(()=>[t(Ve,{borderless:"",dense:"",debounce:"300",modelValue:N.value.filter,"onUpdate:modelValue":e[7]||(e[7]=l=>N.value.filter=l),placeholder:"Buscar",disable:m.value.length<=0},{append:s(()=>[t(C,{name:"search"})]),_:1},8,["modelValue","disable"]),t(M,{color:"primary",icon:"download",onClick:ke,flat:"",disable:m.value.length<=0},null,8,["disable"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})]),_:1}))}};export{Ca as default};
