import{u as q,r as m,c as N,o as D,g as S,e,w as i,f as s,a4 as f,Y as A,b2 as L,aF as W,Q as g,ak as B,aZ as X,a3 as M,a2 as O,a1 as j,a as T,h as E,a_ as F}from"./index.67a640b2.js";import{Q as V,a as u}from"./QCard.2c95468d.js";import{Q as d}from"./QSeparator.b027facf.js";import{Q as H}from"./QSlideTransition.b534ef26.js";import{Q as h}from"./QPage.106b16cd.js";import{Q as z}from"./QInput.eaf520dc.js";import{Q as I,b as ee}from"./QSelect.ac130176.js";import{Q as G}from"./QCardActions.f475abf2.js";import{Q as Z}from"./QDialog.ad0e7109.js";import{u as J}from"./VDB.eadc3fa0.js";import{u as K}from"./use-quasar.31354ddd.js";import"./jspdf.plugin.autotable.3c340728.js";import{r as U}from"./refundsApi.5721e871.js";import"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{d as Q}from"./dayjs.min.cbcf888d.js";import{Q as te}from"./QDate.f0b65ce9.js";import{Q as se}from"./QTable.5e4d05d3.js";import{C as le}from"./ClosePopup.fac9cab7.js";import{p as oe}from"./Refund.69d17895.js";import"./use-key-composition.e7fb6cca.js";import"./uid.937d8ee7.js";import"./QItemSection.33ef75db.js";import"./position-engine.e583fba4.js";import"./rtl.276c3f1b.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.128a942b.js";import"./axios.9ab26c22.js";import"./use-render-cache.3aae9b27.js";import"./date.1fa00baa.js";import"./QList.4db9fc0c.js";import"./QLinearProgress.3f392f7b.js";import"./QCheckbox.ce32a4c4.js";const ae={class:"text-bold text-centerz"},ie={class:"row"},ne=["onClick"],re={class:"col"},de={class:"text-bold"},ue={class:"col"},ce={class:"text-bold"},ve={class:"col"},fe={class:"text-bold"},me={class:"col"},pe={class:"text-bold"},_e={class:"col"},ye={class:"text-bold"},xe={class:"col"},be={class:"text-bold"},ge={class:"text-bold"},we={class:"text-bold"},Ve={class:"col"},ke={class:"text-bold"},De={class:"col"},Qe={class:"text-caption"},Ce={class:"text-bold"},P={__name:"ViewRefunds",props:{refunds:{type:Array,default:[]},status:{type:Array,default:[]}},setup(C){const k=q(),r=J(),p=K(),c=m(null),v=m(null),_=m({state:!1,val:null}),x=C,b=m({columns:[{name:"id",label:"ID",field:t=>t.id},{name:"reference",label:"REFERENCIA",field:t=>t.reference},{name:"destiny",label:"DESTINO",field:t=>t.storefrom.name},{name:"origin",label:"ORIGEN",field:t=>t.storeto.name},{name:"createby",label:"CREADO POR",field:t=>t.createdby.complete_name},{name:"date",label:"FECHA",field:t=>Q(t.created_at).format("DD-MM-YYYY HH:mm:ss")},{name:"status",label:"Estado",field:t=>t.status}],filter:""}),w=N(()=>c.value&&!v.value?x.refunds.filter(t=>t.status.id==c.value.id):!c.value&&v.value?x.refunds.filter(t=>Q(t.created_at).format("YYYY/MM/DD")==v.value):c.value&&v.value?x.refunds.filter(t=>Q(t.created_at).format("YYYY/MM/DD")==v.value&&t.status.id==c.value.id):x.refunds),n=t=>{switch(t){case 1:return"red";case 2:return"yellow";case 3:return"blue";case 4:return"green"}},$=t=>{t.status.id==1&&t.storefrom.id==r.session.store.id?(console.log("terminar el que se esta creando"),k.push(`/refunds/${t.id}`)):t.status.id==1&&t.storeto.id==r.session.store.id?p.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storefrom.id==r.session.store.id?p.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storeto.id==r.session.store.id?(console.log("se va a recibir"),_.value.state=!0,_.value.val=t):t.status.id==4&&p.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"})},R=async t=>{p.loading.show({message:"Cambiando Estado"});let a={id:t.id,uid:r.session.id};const l=await U.nexState(a);l.fail?console.log(l):(k.push(`/refunds/verified/${t.id}`),p.loading.hide())},Y=t=>{console.log(t),oe.refund(t)};return(t,a)=>(D(),S(j,null,[e(se,{rows:w.value,grid:"",columns:b.value.columns,filter:b.value.filter},{"top-left":i(()=>[s("div",ae,f(v.value),1)]),"top-right":i(()=>[s("div",ie,[e(z,{class:"col",filled:"",dense:"",modelValue:b.value.filter,"onUpdate:modelValue":a[0]||(a[0]=l=>b.value.filter=l),placeholder:"Buscar"},{append:i(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{class:"col",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),options:C.status,label:"Estado",dense:"",filled:"","option-label":"name"},L({_:2},[c.value?{name:"append",fn:i(()=>[e(A,{name:"cancel",onClick:a[1]||(a[1]=W(l=>c.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{color:"primary",flat:"",icon:"event"},{default:i(()=>[e(ee,null,{default:i(()=>[e(te,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=l=>v.value=l),landscape:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})])]),item:i(l=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:o=>$(l.row)},[e(V,{bordered:"",class:"text-center my-card"},{default:i(()=>[e(u,{class:"row",dense:""},{default:i(()=>[s("div",re,[a[6]||(a[6]=s("div",{class:"text-caption"},"ID",-1)),s("div",de,f(l.row.id),1)]),e(d,{vertical:""}),s("div",ue,[a[7]||(a[7]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",ce,f(l.row.reference),1)]),e(d,{vertical:""}),s("div",ve,[a[8]||(a[8]=s("div",{class:"text-caption"},"Referencia",-1)),s("div",fe,f(B(Q)(l.row.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:2},1024),e(d),e(u,{class:"row"},{default:i(()=>[s("div",me,[a[9]||(a[9]=s("div",{class:"text-caption"},"Origen",-1)),s("div",pe,f(l.row.storefrom.name),1)]),e(d,{vertical:""}),s("div",_e,[a[10]||(a[10]=s("div",{class:"text-caption"},"Destino",-1)),s("div",ye,f(l.row.storeto.name),1)])]),_:2},1024),e(d),e(u,{class:"row"},{default:i(()=>[s("div",xe,[a[11]||(a[11]=s("div",{class:"text-caption"},"Tipo",-1)),s("div",be,f(l.row.type.name),1)]),e(d,{vertical:""}),s("div",{class:X(`col bg-${n(l.row.status.id)}`)},[a[12]||(a[12]=s("div",{class:"text-caption"},"Estado",-1)),s("div",ge,f(l.row.status.name),1)],2)]),_:2},1024),e(d),e(u,null,{default:i(()=>[a[13]||(a[13]=s("div",{class:"text-caption"},"Creado Por",-1)),s("div",we,f(l.row.createdby.complete_name),1)]),_:2},1024),e(u,{class:"row",onClick:o=>Y(l.row)},{default:i(()=>[s("div",Ve,[a[14]||(a[14]=s("div",{class:"text-caption"},"Devolucion",-1)),s("div",ke,f(l.row.fs_id),1)]),e(d,{vertical:""}),s("div",De,[s("div",Qe,f(l.row._type==1?"ABONO":"ENTRADA"),1),s("div",Ce,f(l.row._type==1?l.row.season_ticket:l.row.entry),1)])]),_:2},1032,["onClick"])]),_:2},1024)],8,ne)]),_:1},8,["rows","columns","filter"]),e(Z,{modelValue:_.value.state,"onUpdate:modelValue":a[5]||(a[5]=l=>_.value.state=l),persistent:""},{default:i(()=>[e(V,null,{default:i(()=>[e(u,{class:"text-center text-bold text-h5"},{default:i(()=>a[15]||(a[15]=[M(" Quires recepcionar la devolucion ? ")])),_:1}),e(G,{align:"right"},{default:i(()=>[O(e(g,{flat:"",label:"Cancelar",color:"negative"},null,512),[[le]]),e(g,{flat:"",label:"Recibir",color:"positive",onClick:a[4]||(a[4]=l=>R(_.value.val))})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},$e={class:"row justify-between"},Re={class:"row"},Ye={key:0},Ee={class:"row"},Ne={class:"row"},ct={__name:"Index",setup(C){const k=q(),r=J(),p=K(),c=m([]),v=m([]),_=m([]),x=m(null),b=m(!1),w=m(!1),n=m({state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:r.session.store.id,store_to:null,_created_by:r.session.id}),$=N(()=>n.value.type?n.value.type.id==1?_.value.filter(l=>l._type==1):_.value.filter(l=>l._type==2):_.value),R=N(()=>!(n.value.reference&&n.value.type&&n.value.provider)),Y=async()=>{p.loading.show({message:"Obteniendo Datos",type:"positive",position:"center"});let l=r.session.store.id;const o=await U.index(l);o.error?console.log(o):(console.log(o),c.value=o.types,_.value=o.provider,x.value=o.refunds,v.value=o.status,p.loading.hide())},t=async()=>{n.value={state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:r.session.store.id,store_to:null,_created_by:r.session.id}},a=async()=>{n.value.store_to=n.value.provider._store,console.log(n.value);const l=await U.addRefund(n.value);l.error?console.log(l):(console.log(l),p.notify({message:"Se creo correctamente la devolucion",type:"positive",position:"center"}),k.push(`/refunds/${l.id}`))};return r.session.rol=="aux"||r.session.rol=="gen"||r.session.rol=="aud"||r.session.rol=="root"||r.session.rol=="ref"?Y():(p.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),k.replace("/")),(l,o)=>(D(),S(j,null,[e(h,{padding:""},{default:i(()=>[e(V,null,{default:i(()=>[e(u,null,{default:i(()=>[s("div",$e,[s("div",null,[o[8]||(o[8]=M("Helpers ")),e(A,{name:"navigate_next",color:"primary"}),o[9]||(o[9]=M()),o[10]||(o[10]=s("span",{class:"text-h6"},"Devoluciones ",-1))]),s("div",Re,[B(r).session.store.id!=1?(D(),T(g,{key:0,color:"primary",icon:"add",flat:"",onClick:o[0]||(o[0]=y=>n.value.state=!n.value.state)})):E("",!0)])])]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),x.value?(D(),S("div",Ye,[e(V,{class:"my-card"},{default:i(()=>[e(u,{class:"text-center text-bold text-h6"},{default:i(()=>[s("div",Ee,[o[11]||(o[11]=s("div",{class:"col"},"Destino",-1)),e(g,{color:"grey",round:"",flat:"",dense:"",icon:b.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[1]||(o[1]=y=>b.value=!b.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:i(()=>[e(H,null,{default:i(()=>[O(s("div",null,[e(P,{refunds:x.value.to,status:v.value},null,8,["refunds","status"])],512),[[F,b.value]])]),_:1})]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),B(r).session.store.id!=1?(D(),T(V,{key:0,class:"my-card"},{default:i(()=>[e(u,{class:"text-center text-bold text-h6"},{default:i(()=>[s("div",Ne,[o[12]||(o[12]=s("div",{class:"col"},"Origen",-1)),e(g,{color:"grey",round:"",flat:"",dense:"",icon:w.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[2]||(o[2]=y=>w.value=!w.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:i(()=>[e(H,null,{default:i(()=>[O(s("div",null,[e(P,{refunds:x.value.from,status:v.value},null,8,["refunds","status"])],512),[[F,w.value]])]),_:1})]),_:1})]),_:1})):E("",!0)])):E("",!0)]),_:1}),e(Z,{modelValue:n.value.state,"onUpdate:modelValue":o[7]||(o[7]=y=>n.value.state=y),persistent:""},{default:i(()=>[e(V,null,{default:i(()=>[e(u,null,{default:i(()=>o[13]||(o[13]=[s("span",{class:"text-center text-h6 text-bold"},"Nueva Devolucion",-1)])),_:1}),e(u,null,{default:i(()=>[e(z,{modelValue:n.value.reference,"onUpdate:modelValue":o[3]||(o[3]=y=>n.value.reference=y),type:"text",label:"Referencia",filled:"",dense:""},null,8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{modelValue:n.value.type,"onUpdate:modelValue":[o[4]||(o[4]=y=>n.value.type=y),o[5]||(o[5]=()=>n.value.provider=null)],options:c.value,label:"Tipo",filled:"",dense:"","option-label":"name"},null,8,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{modelValue:n.value.provider,"onUpdate:modelValue":o[6]||(o[6]=y=>n.value.provider=y),options:$.value,label:"Destino",filled:"",dense:"",disable:n.value.type==null,"option-label":"name"},null,8,["modelValue","options","disable"]),e(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(G,{align:"right"},{default:i(()=>[e(g,{flat:"",label:"Cancel",color:"primary",onClick:t}),e(g,{flat:"",label:"Enviar",color:"primary",onClick:a,disable:R.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ct as default};
