import{Q as T}from"./QInput.1622385a.js";import{Q as w,a as c}from"./QCard.7eb7d094.js";import{Q as D}from"./QForm.a4b8484e.js";import{Q as P}from"./QSeparator.9ed28fa7.js";import{r as v,q as $,p as B,ak as b,o as g,a as x,w as s,h as _,e as o,f as i,a4 as m,Q as F,_ as A}from"./index.b92dd970.js";import{Q as N}from"./QDialog.d832f787.js";import{Q as E}from"./QPage.6b3d4261.js";import{u as L}from"./VDB.40e0e52b.js";import{u as O,c as q}from"./cashApi.f9ab100c.js";import{_ as z}from"./PaymentSales.60e77bd7.js";import{u as U}from"./use-quasar.03dae121.js";import{o as Q}from"./orderApi.2c82d5dd.js";import"./use-key-composition.3d5c685a.js";import"./uid.937d8ee7.js";import"./axios.ba7b1b0e.js";import"./axios.9ab26c22.js";import"./QSelect.aba570a7.js";import"./QItemSection.78b45b77.js";import"./position-engine.ef70afb5.js";import"./rtl.276c3f1b.js";import"./QCheckbox.54ac594f.js";import"./QCardActions.acb6c307.js";const j={class:"row justify-center"},K={class:"col text-right"},R={class:"col text-right"},I={class:"col text-right"},M={class:"col text-right"},Y={class:"col text-right"},xe={__name:"salesTpv",setup(Z){const y=L(),r=U(),p=O(),d=v(!1),u=v(null),t=v(null),k=v([]),V=async()=>{if(u.value){r.loading.show({message:"Obteniendo Orden"});let a={uid:y.session.credentials.staff.id_va,oid:u.value};const e=await Q.getOrderCash(a);e.fail?e.fail.status==401?(console.log(e),r.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),u.value=null,r.loading.hide()):e.fail.status==404?(console.log(e),r.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),u.value=null,r.loading.hide()):console.log(e):(t.value=e,console.log(e),r.loading.hide())}},S=async a=>{r.loading.show({message:"Realizando Ticket"}),t.value.payments=a,t.value.change=a.conditions.super?0:Number.parseFloat(a.SFPA.val)+Number.parseFloat(a.PFPA.val)+Number.parseFloat(a.VALE.val)-t.value.products.reduce((n,f)=>n+f.pivot.total,0),t.value.total=t.value.products.reduce((n,f)=>n+f.pivot.total,0);let e={order:t.value,cashier:p.cash};console.log(e);const l=await q.addSale(e);l.fail?console.log(l):(console.log(l),d.value=!1,u.value=null,k.value=[],C())},C=async()=>{let a={uid:y.session.credentials.staff.id_va,oid:t.value.id};console.log(a);const e=await Q.nextStateFinish(a);e.fail?console.log(e):(console.log(e),t.value=null,r.loading.hide())},h=a=>{a.altKey&&a.key==="Enter"&&t.value&&(a.preventDefault(),d.value||(d.value=!0))};return $(()=>{window.addEventListener("keydown",h)}),B(()=>{window.removeEventListener("keydown",h)}),(a,e)=>b(p).cash?(g(),x(E,{key:0,padding:""},{default:s(()=>[t.value?_("",!0):(g(),x(w,{key:0},{default:s(()=>[o(D,{onSubmit:V,class:"q-gutter-md"},{default:s(()=>[o(c,null,{default:s(()=>[o(T,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),type:"text",label:"Escanea",filled:"",dense:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),o(P,{spaced:"",inset:"",vertical:"",dark:""}),i("div",j,[o(A,{name:"bounce"},{default:s(()=>[t.value?(g(),x(w,{key:0,class:"my-card",style:{"min-width":"600px"}},{default:s(()=>[o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[3]||(e[3]=i("div",{class:"col text-left"},"Cliente:",-1)),i("div",K,m(t.value.client.name),1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[4]||(e[4]=i("div",{class:"col text-left"},"Dependiente:",-1)),i("div",R,m(`${t.value.created_by.names} ${t.value.created_by.surname_pat}
              ${t.value.created_by.surname_mat} `),1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[5]||(e[5]=i("div",{class:"col text-left"},"Orden: ",-1)),i("div",I,m(t.value.id),1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[6]||(e[6]=i("div",{class:"col text-left"}," Productos: ",-1)),i("div",M,m(t.value.products.length)+" ART",1)]),_:1}),o(c,{class:"text-bold text-h6 row"},{default:s(()=>[e[7]||(e[7]=i("div",{class:"col text-left"}," Piezas: ",-1)),i("div",Y,m(t.value.products.reduce((l,n)=>l+n.pivot.toDelivered,0))+" PZS",1)]),_:1}),o(c,{class:"text-bold text-h4 row bg-primary text-white"},{default:s(()=>[e[8]||(e[8]=i("div",{class:"col text-left"}," Total a Pagar: ",-1)),o(F,{class:"flex justify-right text-h5 bg-white text-primary",size:"xl",label:`$ ${t.value.products.reduce((l,n)=>l+n.pivot.total,0)}`,onClick:e[1]||(e[1]=l=>d.value=!d.value)},null,8,["label"])]),_:1})]),_:1})):_("",!0)]),_:1})]),i("div",null,[o(N,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value=l)},{default:s(()=>[o(z,{total:t.value.products.reduce((l,n)=>l+n.pivot.total,0),paymeths:b(p).methods,client:t.value._client,onSendTicket:S},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])])]),_:1})):_("",!0)}};export{xe as default};
