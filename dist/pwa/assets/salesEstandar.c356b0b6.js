import{Q as Le}from"./QToolbarTitle.fdaad759.js";import{Q as R,a as ee,e as Y}from"./QSelect.9d7be3ea.js";import{_ as Qe,u as J,r as V,g as L,o as ae,a as y,c as T,d as e,bB as oe,m as Q,f as me,Z as fe,h as F,i,l as N,k as o,a1 as w,a3 as Te,a2 as Be,b9 as ue,a4 as $,n as _,a5 as Z,p as k,Q as U,y as ge,bn as qe,bo as Ue,j as te,b8 as Ie,w as Oe,bb as Re,a7 as de,a6 as z,aX as re,H as K}from"./index.a1c295c1.js";import{a as G,b as le,Q as H}from"./QList.48a27591.js";import{Q as je}from"./QToolbar.0a659155.js";import{Q as M}from"./QTable.6dbea056.js";import{Q as ce}from"./QForm.ddbae44f.js";import{Q as ze}from"./QFooter.eb8841dc.js";import{Q as Ke}from"./QPage.280a2f20.js";import{C as ve}from"./ClosePopup.e501f1d3.js";import{u as Me,c as pe}from"./cashApi.2f24febc.js";import"./QImg.485359ae.js";import{Q as Ge}from"./QSpace.abbec46a.js";import"./QExpansionItem.2f8e3b0c.js";import"./favorites.6b442dd7.js";import{b as Ze}from"./axios.9730f76f.js";import{u as W}from"./use-quasar.1aaac9b4.js";import{p as Je}from"./productsApi.ef761c9f.js";import{R as O}from"./resoursesOrder.b13b257e.js";import{o as We}from"./orderApi.986122ba.js";import{s as Xe}from"./saleLocalApi.3d995020.js";import"./QLinearProgress.8ae38f31.js";import"./QResizeObserver.73aad3aa.js";import"./QScrollObserver.061a8790.js";const Ye={class:"QuickRegular row items-center"},He={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]}},emits:["input","similarcodes","agregar"],setup(f,{expose:B,emit:p}){const n=W(),A=J(),C=f,E=p,a=V({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),m=V(null),x=L(()=>({autocomplete:a.value.target,limit:C.limit,_workpoint:A.session.store.id_viz,strict:a.value.read_barcode}));ae(()=>{a.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let b=JSON.parse(localStorage.getItem("typeiptsearch"));b&&(a.value.iptsearch.type=b.type,a.value.iptsearch.icon=b.icon)});const g=b=>{a.value.target="",E("input",b)},u=()=>{a.value.target.trim().toUpperCase(),a.value.target.length&&(a.value.iptsearch.processing=!0,console.log(x.value),Je.autocomplete(x.value).then(b=>{let r=b.data;switch(Object.keys(r).length){case 0:let c=a.value.target;n.notify({message:`Sin resultados para <b>${c}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),I();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(r),g(r);break}a.value.target="",a.value.iptsearch.processing=!1}).catch(b=>{console.log(b)}))},I=()=>{console.log("putFocus ejecutada!!"),m.value.focus()};return B({focus:()=>{var b,r;return(r=(b=m.value)==null?void 0:b.focus)==null?void 0:r.call(b)}}),(b,r)=>(y(),T("div",Ye,[e(Q,{ref_key:"iptatc",ref:m,loading:a.value.iptsearch.processing,disable:a.value.iptsearch.processing,modelValue:a.value.target,"onUpdate:modelValue":r[0]||(r[0]=c=>a.value.target=c),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:oe(u,["enter"]),autocomplete:"off",autofocus:"",label:"Codigo..."},null,8,["loading","disable","modelValue"])]))}};var et=Qe(He,[["__scopeId","data-v-6dc857d2"]]);const tt={class:"row"},lt={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},at={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},ot={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},st={class:"row"},it={class:"text-h6 col text-bold text-left"},nt={class:"text-h6 col text-bold text-right"},ut={class:"text-subtitle2 col"},dt={class:"text-center"},rt={class:"q-pa-xs"},ct={class:"row items-center justify-center q-gutter-md"},vt={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(f,{emit:B}){J();const p=W();me(),fe();const n=f,A=B,C=L(()=>!n.product.pivot.units||n.product.pivot.units<=0),E=L(()=>n.product.pivot.units),a=L(()=>n._price_list<=3?[1,2,3,4]:[n._price_list]),m=L(()=>n._price_list<=3?O.verificarPrecioCaja(n.products,n.product,n.rules)?4:O.verificarPrecioDocena(n.products,n.product,n.rules)?3:O.verificarPrecioMayoreo(n.products,n.product,n.rules)?2:1:n._price_list),x=()=>{A("reset")},g=async()=>{p.loading.show({message:"Editando Producto"});let b=n.product.prices.find(c=>c.id==m.value).pivot.price,r=E.value*b;n.product.pivot.toDelivered=E.value,n.product.pivot._price_list=m.value,n.product.pivot.price=b,n.product.pivot.total=r,p.loading.hide(),x(),O.actualizarPreciosProductosSales(n.products,n._price_list,n.rules),A("editProduct")},u=async()=>{(!n.product.pivot.units||n.product.pivot.units<1)&&(n.product.pivot.units=1),p.loading.show({message:"Agregando producto"});let b=n.product.prices.find(c=>c.id==m.value).pivot.price,r=E.value*b;n.product.pivot.toDelivered=E.value,n.product.pivot._price_list=m.value,n.product.pivot.price=b,n.product.pivot.total=r,n.product.pivot._product=n.product.id,console.log(n.product),A("addProduct",n.product),p.loading.hide(),O.actualizarPreciosProductosSales(n.products,n._price_list,n.rules)},I=async()=>{p.loading.show({message:"Eliminando Producto"}),A("deleteProduct",n.product),p.loading.hide(),O.actualizarPreciosProductosSales(n.products,n._price_list,n.rules)};return(b,r)=>(y(),F(U,null,{default:i(()=>[e(N,{class:"item-center"},{default:i(()=>[o("div",tt,[o("div",lt,w(f.product.category.familia.seccion.name),1),o("div",at,w(f.product.category.familia.name),1),o("div",ot,w(f.product.category.name),1)])]),_:1}),e(N,{class:"item-center"},{default:i(()=>[o("div",st,[o("div",it,w(f.product.code),1),o("div",nt,w(f.product.name),1)]),o("div",ut,w(f.product.description),1)]),_:1}),e(N,{class:"item-center row"},{default:i(()=>[(y(!0),T(Te,null,Be(f.product.prices.filter(c=>a.value.includes(c.id)),(c,P)=>(y(),T("div",{class:"col text-subtitle2 text-center",key:P},[o("div",{class:ue(c.id==m.value?"text-weight-bold":"text-caption text-strike")},w(c.alias),3),e($,{spaced:"",inset:"",vertical:"",dark:""}),o("div",{class:ue(c.id==m.value?"text-bold  text-blue-13":"text-caption")},w(c.pivot.price),3),e($,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),e(N,null,{default:i(()=>[o("div",dt,[o("div",rt,[r[6]||(r[6]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),o("div",ct,[e(_,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:r[0]||(r[0]=c=>f.product.pivot.units>1?f.product.pivot.units--:"")}),e(Q,{modelValue:f.product.pivot.units,"onUpdate:modelValue":[r[1]||(r[1]=c=>f.product.pivot.units=c),r[4]||(r[4]=c=>{c?c<1?f.product.pivot.units=1:Number.isInteger(c)||(f.product.pivot.units=Math.floor(c)):f.product.pivot.units=1})],modelModifiers:{number:!0},type:"number",outlined:"",min:"1",step:"1","input-class":"text-center text-h3",style:{width:"100px"},autofocus:"",onKeydown:r[2]||(r[2]=oe(c=>f.edit?g():u(),["enter"])),onKeypress:r[3]||(r[3]=c=>(c.key==="."||c.key==="-")&&c.preventDefault())},null,8,["modelValue"]),e(_,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:r[5]||(r[5]=c=>f.product.pivot.units++)})])])])]),_:1}),e(Z,null,{default:i(()=>[e(_,{flat:"",icon:"close",onClick:x}),e(Ge),f.edit?k("",!0):(y(),F(_,{key:0,flat:"",icon:"add",color:"positive",onClick:u,disable:C.value},null,8,["disable"])),f.edit?(y(),F(_,{key:1,flat:"",icon:"delete",color:"negative",onClick:I})):k("",!0),f.edit?(y(),F(_,{key:2,flat:"",icon:"edit",color:"warning",onClick:g,disable:C.value},null,8,["disable"])):k("",!0)]),_:1})]),_:1}))}},pt={class:"bg-primary row items-center justify-between q-pa-md text-white"},mt={class:"text-right"},ft={class:"fw-bold text-h4"},gt={class:"row text-center items-center"},bt={class:"col"},yt={class:"row text-center items-center"},xt={class:"col"},_t={class:"col"},Pt={class:"row flex justify-center"},wt={class:"col flex justify-center"},ht={key:0,class:"col"},Vt={key:0,class:"row flex justify-center text-center"},kt={class:"col"},At={class:"col"},Ct={class:"row flex justify-center"},Nt={class:"col flex justify-center"},Ft={key:0,class:"col"},Et={class:"row"},St={class:"text-h5"},Dt={key:0,class:"text-center"},$t={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(f,{emit:B}){J();const p=W(),n=V({dafpa:!1,vales:!1}),A=f,C=B,E=V({opts:[]}),a=V({PFPA:{id:A.paymeths[1],val:Math.round(A.total)},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),m=L(()=>(Number(Number.parseFloat(a.value.SFPA.val)+Number.parseFloat(a.value.PFPA.val))+Number.parseFloat(a.value.VALE.val)-Number.parseFloat(A.total)).toFixed(2)),x=L(()=>{var P,d,v;return m.value>=0&&(((P=a.value.PFPA.id)==null?void 0:P.id)&&a.value.PFPA.val>0||((d=a.value.SFPA.id)==null?void 0:d.id)&&a.value.SFPA.val>0||((v=a.value.VALE.id)==null?void 0:v.id)&&a.value.VALE.val>0)}),g=L(()=>{const P=Object.values(a.value);if(P.some(S=>S.id&&S.id.alias==="EFE"&&S.val>0))return!1;const v=P.some(S=>S.id&&S.id.alias!=="EFE"),h=P.reduce((S,j)=>S+Number(j.val||0),0);return v&&h>A.total}),u=P=>{var d;return P.id==((d=a.value.SFPA.id)==null?void 0:d.id)},I=P=>{var d;return P.id==((d=a.value.PFPA.id)==null?void 0:d.id)},b=async()=>{p.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let d=`http://192.168.10.160:1619/access/public/modify/vales?price=${A.client}`;Ze.get(d).then(v=>{console.log(v.data),p.loading.hide();let h=v.data.map(S=>({id:{id:5,alias:"[V]",name:"VALE",code:S.CODANT},val:Number(S.IMPANT)}));E.value.opts=h,n.value.vales=!0}).catch(v=>{console.log(v.response.data),p.notify({html:!0,message:v.response.data,color:"negative",position:"bottom"}),p.loading.hide()})},r=P=>{P.key==="Enter"&&x.value&&(P.preventDefault(),c())},c=()=>{a.value.conditions.super=g.value,a.value.change=m.value,C("sendTicket",a.value),E.value=V({opts:[]}),a.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return ae(()=>{window.addEventListener("keydown",r)}),ge(()=>{window.removeEventListener("keydown",r)}),(P,d)=>(y(),F(U,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:i(()=>[o("div",pt,[d[11]||(d[11]=o("div",null,[o("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),o("div",mt,[d[10]||(d[10]=o("div",{class:"fs-dec3"},"Total Actual",-1)),o("div",ft,"$ "+w(Number(f.total).toFixed(2)),1)])]),e(N,null,{default:i(()=>{var v;return[o("div",gt,[d[12]||(d[12]=o("div",{class:"col"}," Forma de pago: ",-1)),o("div",bt,[e(R,{class:"col-3",modelValue:a.value.PFPA.id,"onUpdate:modelValue":d[0]||(d[0]=h=>a.value.PFPA.id=h),options:f.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":h=>u(h)},null,8,["modelValue","options","option-disable"])])]),e($,{spaced:"",inset:"",vertical:"",dark:""}),o("div",yt,[o("div",xt,w(((v=a.value.PFPA.id)==null?void 0:v.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",_t,[e(Q,{class:"col",modelValue:a.value.PFPA.val,"onUpdate:modelValue":d[2]||(d[2]=h=>a.value.PFPA.val=h),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(a.value.PFPA.val)?(y(),F(_,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:d[1]||(d[1]=h=>a.value.PFPA.val=0)})):k("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),e(N,null,{default:i(()=>{var v;return[o("div",Pt,[o("div",wt,[e(_,{color:"primary",label:"2\xAA Forma de pago",onClick:d[3]||(d[3]=()=>{n.value.dafpa=!n.value.dafpa,a.value.SFPA.val=0,a.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),n.value.dafpa?(y(),T("div",ht,[e(R,{class:"col-3",modelValue:a.value.SFPA.id,"onUpdate:modelValue":d[4]||(d[4]=h=>a.value.SFPA.id=h),options:f.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":h=>I(h)},null,8,["modelValue","options","option-disable"])])):k("",!0)]),e($,{spaced:"",inset:"",vertical:"",dark:""}),n.value.dafpa?(y(),T("div",Vt,[o("div",kt,w(((v=a.value.SFPA.id)==null?void 0:v.id)==2?"Efectivo":"Importe Cobrado"),1),o("div",At,[e(Q,{class:"col",modelValue:a.value.SFPA.val,"onUpdate:modelValue":d[6]||(d[6]=h=>a.value.SFPA.val=h),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(a.value.SFPA.val)?(y(),F(_,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:d[5]||(d[5]=h=>a.value.SFPA.val=0)})):k("",!0)]),_:1},8,["modelValue"])])])):k("",!0)]}),_:1}),e(N,null,{default:i(()=>[o("div",Ct,[o("div",Nt,[e(_,{color:"primary",label:"Cobrar Vale",onClick:b,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),n.value.vales?(y(),T("div",Ft,[o("div",Et,[e(R,{class:"col",modelValue:a.value.VALE,"onUpdate:modelValue":d[7]||(d[7]=v=>a.value.VALE=v),options:E.value.opts,label:"Vale","option-label":v=>`Vale : ${v.id?v.id.code:""}`,dense:"",filled:""},{option:i(v=>[e(G,qe(Ue(v.itemProps)),{default:i(()=>[e(le,null,{default:i(()=>[e(ee,null,{default:i(()=>[te(w(v.opt.id.code),1)]),_:2},1024),e(ee,{caption:""},{default:i(()=>[te("$ "+w(Number(v.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),e($,{spaced:"",inset:"",vertical:"",dark:""}),a.value.VALE.id?(y(),F(Q,{key:0,modelValue:a.value.VALE.val,"onUpdate:modelValue":d[8]||(d[8]=v=>a.value.VALE.val=v),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):k("",!0)])])):k("",!0)])]),_:1}),g.value?(y(),F(N,{key:0,class:"flex justify-end"},{default:i(()=>[e(Ie,{modelValue:a.value.conditions.createWithdrawal,"onUpdate:modelValue":d[9]||(d[9]=v=>a.value.conditions.createWithdrawal=v),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):k("",!0),e(Z,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:i(()=>[o("div",null,[d[13]||(d[13]=o("div",{class:"fs-dec3"},"Cambio",-1)),o("div",St," $ "+w(m.value),1)]),x.value?(y(),T("div",Dt,[e(_,{color:"primary",icon:"payment",label:"Pagar",onClick:c})])):k("",!0)]),_:1})]),_:1}))}},Lt={class:"row items-center justify-between"},Qt={class:"col"},Tt={class:"col"},Bt={class:"col"},qt={class:"text-caption text-center"},Ut={class:"text-center text-h6"},It={key:0,class:"col"},Ot={class:"text-center text-h6 text-caption"},Rt={key:1,class:"col"},jt={class:"text-center text-h6"},zt={class:"col"},Kt={class:"text-center text-h6"},Mt={class:"row q-ml-sm q-mr-sm"},Gt={key:0,class:"col"},Zt={class:"col"},xl={__name:"salesEstandar",setup(f){const B=J(),p=W();me(),fe();const n=Me();V(null);const A=V(null),C=V({val:{id:1,label:"Preventa",type:"number"},opts:[{id:1,label:"Preventa",type:"number"}],valueVal:null}),E=V({amount:0,amountDelivered:1,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),a=V({name:"IVA",option:!1,optval:[16,8,6],value:0,amount:0}),m=V({val:null,opts:[]}),x=V({val:null,opts:[]}),g=V({state:!1,val:null,edit:!1}),u=V({client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:B.session.credentials.staff,products:[],observation:null}),I=L(()=>(u.value.products||[]).filter(t=>t.pivot.toDelivered>0)),b=L(()=>(u.value.products||[]).filter(t=>!t.pivot.toDelivered)),r=V(!1),c=V({columns:[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},{name:"verify",label:"Cantidad",field:t=>t.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:t=>t.pivot.price,align:"center"},{name:"bruto",label:a.option?"Bruto":"Total",field:t=>t.pivot.total,align:"center"},{name:"iva",label:"Total",field:t=>t.pivot.total,align:"center"},{name:"neto",label:"Total",field:t=>t.pivot.total,align:"center"}],pagination:{rowsPerPage:0},filter:null}),P=V({columns:[{name:"id",label:"Codigo",field:t=>t.id,align:"left"},{name:"Nombre",label:"Descripcion",field:t=>t.name,align:"left"},{name:"Telefono",label:"Pedido",field:t=>t.celphone,align:"center"}],pagination:{rowsPerPage:0}}),d=V({columns:[{name:"id",label:"Codigo",field:t=>t.id,align:"left"},{name:"Nombre",label:"Descripcion",field:t=>t.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),v=L(()=>Number(u.value.products.reduce((t,l)=>t+l.pivot.total,0)).toFixed(2)),h=L(()=>u.value.products.reduce((t,l)=>t+Number(l.pivot.toDelivered),0)),S=L(()=>u.value.products.length>0&&u.value.dependiente&&u.value.client),j=L(()=>[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},,{name:"verify",label:"Verificado",field:l=>l.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:l=>l.pivot.price,align:"center"},{name:"bruto",label:a.value.option?"Subtotal":"Total",field:l=>l.pivot.total,format:l=>`$ ${l.toFixed(2)}`,align:"center"}]),be=t=>{if(console.log(t),t.prices.map(s=>s.pivot.price).includes(0))p.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let s=u.value.products.findIndex(D=>D.id==t.id);s>=0?(g.value.val=u.value.products[s],g.value.state=!0,g.value.edit=!0):(t.pivot=E.value,g.value.val=t,g.value.state=!0,g.value.edit=!1)}},ye=t=>{if(console.log(t),t.prices.map(s=>s.pivot.price).includes(0))p.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let s=u.value.products.findIndex(D=>D.id==t.id);s>=0?(g.value.val=u.value.products[s],g.value.state=!0,g.value.edit=!0):(t.pivot=E.value,g.value.val=t,g.value.state=!0,g.value.edit=!1)}},se=(t,l)=>{console.log(l),g.value.val=l,g.value.edit=!0,g.value.state=!0},xe=()=>{console.log("cambio de cliente"),m.value.state=!0},_e=async()=>{if(m.value.val){const t=await We.getClient(m.value);t.fail?console.log(t):t.length>0?(console.log(t),m.value.opts=t):p.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else p.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},Pe=async(t,l)=>{p.loading.show({message:"Recalculando Ticket"}),u.value.client=l,O.actualizarPreciosProductosSales(u.value.products,l._price_list,n.rules),m.value={state:!1,val:null,opts:[]},p.loading.hide()},we=()=>{console.log("cambio de cliente"),x.value.state=!0},he=async()=>{if(x.value.val){let t={val:x.value.val,sto:B.session.store.id};const l=await pe.getDependiente(t);l.fail?console.log(l):l.length>0?(console.log(l),x.value.opts=l):p.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(l)}else p.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},Ve=(t,l)=>{u.value.dependiente=l,x.value={state:!1,val:null,opts:[]},p.loading.hide()},ke=t=>{u.value.products.push(t),X(),K(()=>{var l;(l=A.value)==null||l.focus()})},Ae=()=>{K(()=>{var t;(t=A.value)==null||t.focus()})},Ce=t=>{let l=u.value.products.findIndex(s=>s.id==t.id);l>=0&&(u.value.products.splice(l,1),X()),K(()=>{var s;(s=A.value)==null||s.focus()})},Ne=async t=>{p.loading.show({message:"Realizando Ticket"}),u.value.payments=t,u.value.change=t.conditions.super?0:t.change,a.value.option?(u.value.subtotal=u.value.products.reduce((D,q)=>D+q.pivot.total,0),u.value.iva=a.value.value,u.value.total=Number(v.value*Number(1+a.value.value/100).toFixed(2)),u.value.impuesto=Number(v.value*Number(a.value.value/100)).toFixed(2)):u.value.total=u.value.products.reduce((D,q)=>D+q.pivot.total,0);let l={order:u.value,cashier:n.cash,config:a.value};console.log(l);const s=await Xe.addSale(l);if(console.log(s),s.fail)console.log(s);else{console.log(s),r.value=!1;let D={client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:u.value.dependiente,products:[],observation:null};u.value=D,a.value.value=0,a.value.option=!1,p.loading.hide()}},X=()=>{g.value={state:!1,val:null,edit:!1},E.value={amount:0,amountDelivered:null,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},K(()=>{var t;(t=A.value)==null||t.focus()})},Fe=async()=>{switch(console.log(C.value),C.value.val.id){case 1:Ee(C.value);break}},Ee=async t=>{if(console.log(t),t){p.loading.show({message:"Obteniendo Orden"});let l={uid:B.session.credentials.staff.id_va,oid:t.valueVal};const s=await pe.getOrderCash(l);s.fail?s.fail.status==401?(console.log(s),p.notify({message:s.fail.response.data,type:"negative",position:"bottom"}),t.value=null,p.loading.hide()):s.fail.status==404?(console.log(s),p.notify({message:s.fail.response.data,type:"negative",position:"bottom"}),t.value=null,p.loading.hide()):console.log(s):(u.value.order=t.valueVal,u.value.dependiente=s.staff,u.value.client=s.client,s.products.forEach(D=>{var ne;console.log(D);const q=u.value.products.find($e=>$e.id===D.id),De=((ne=D.pivot)==null?void 0:ne.units)||0;q?(q.pivot||(q.pivot={units:0}),q.pivot.units+=De):u.value.products.push({...D})}),C.value.valueVal=null,console.log(s),p.loading.hide())}},Se=()=>{u.value.products=[]},ie=t=>{t.ctrlKey&&t.key.toLowerCase()==="b"?(t.preventDefault(),m.value.state||(m.value.state=!0)):t.ctrlKey&&t.key.toLowerCase()==="d"?(t.preventDefault(),x.value.state||(x.value.state=!0)):t.altKey&&t.key==="Enter"&&S.value&&(t.preventDefault(),r.value||(r.value=!0))};return Oe(()=>u.value,t=>{localStorage.setItem("current_sale",JSON.stringify(t))},{deep:!0}),ae(()=>{const t=localStorage.getItem("current_sale");t&&(u.value=JSON.parse(t)),window.addEventListener("keydown",ie)}),ge(()=>{window.removeEventListener("keydown",ie)}),(t,l)=>(y(),F(Ke,null,{default:i(()=>[e(je,{class:""},{default:i(()=>[e(Le),e(_,{flat:"",round:"",dense:"",icon:"settings",class:"q-mr-xs"},{default:i(()=>[e(Y,{style:{width:"200px"}},{default:i(()=>[e(U,{class:"my-card"},{default:i(()=>[e(N,null,{default:i(()=>[e(H,{dense:""},{default:i(()=>[e(G,{class:"q-px-sm q-py-xs column"},{default:i(()=>[o("div",Lt,[e(ee,null,{default:i(()=>[te(w(a.value.name),1)]),_:1}),e(Re,{color:"blue",modelValue:a.value.option,"onUpdate:modelValue":[l[0]||(l[0]=s=>a.value.option=s),l[1]||(l[1]=s=>{s?a.value.value=16:a.value.value=0})]},null,8,["modelValue"])]),a.value.option?(y(),F(R,{key:0,modelValue:a.value.value,"onUpdate:modelValue":l[2]||(l[2]=s=>a.value.value=s),options:a.value.optval,label:"Porcentaje",filled:"",dense:"","emit-value":"","map-options":"",class:"q-mt-sm"},null,8,["modelValue","options"])):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{flat:"",round:"",dense:"",icon:"receipt_long"},{default:i(()=>[e(Y,null,{default:i(()=>[e(H,{style:{"min-width":"100px"}},{default:i(()=>[e(G,null,{default:i(()=>[e(le,null,{default:i(()=>[e(R,{modelValue:C.value.val,"onUpdate:modelValue":l[3]||(l[3]=s=>C.value.val=s),options:C.value.opts,label:"Tipo",filled:"",dense:""},null,8,["modelValue","options"]),e($,{spaced:"",inset:"",vertical:"",dark:""}),e(Q,{modelValue:C.value.valueVal,"onUpdate:modelValue":l[4]||(l[4]=s=>C.value.valueVal=s),type:C.value.val.type,dense:"",filled:"",label:C.value.val.label,onKeyup:oe(Fe,["enter"])},null,8,["modelValue","type","label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{icon:"delete_sweep",onClick:Se,flat:"",round:"",dense:"",title:"Eliminar Productos"}),e(_,{icon:"notes",flat:"",round:"",dense:"",title:"Agregar Notas"},{default:i(()=>[e(Y,null,{default:i(()=>[e(H,{style:{"min-width":"100px"}},{default:i(()=>[e(G,null,{default:i(()=>[e(le,null,{default:i(()=>[e(Q,{modelValue:u.value.observation,"onUpdate:modelValue":l[5]||(l[5]=s=>u.value.observation=s),type:"text",label:"Observacion"},null,8,["modelValue"])]),_:1})]),_:1}),e($)]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{class:"my-card q-ml-sm q-mr-sm"},{default:i(()=>[e(N,{class:"row"},{default:i(()=>[o("div",Qt,[l[14]||(l[14]=o("div",{class:"text-caption text-center"},"Dependiente",-1)),e(_,{class:"full-width",flat:"",label:u.value.dependiente?u.value.dependiente.complete_name:"CTRL+d",onClick:we},null,8,["label"])]),e($,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Tt,[l[15]||(l[15]=o("div",{class:"text-caption text-center"},"Cliente",-1)),e(_,{class:"full-width",flat:"",label:u.value.client?u.value.client.name:"CTRL+b",onClick:xe},null,8,["label"])])]),_:1})]),_:1}),e($,{spaced:"",inset:"",vertical:"",dark:""}),e(U,{class:"my-card q-ml-sm q-mr-sm"},{default:i(()=>[e(N,{class:"row"},{default:i(()=>[o("div",Bt,[o("div",qt,w(a.value.option?"SUBTOTAL":"TOTAL"),1),o("div",Ut,"$ "+w(v.value),1)]),a.value.option?(y(),T("div",It,[l[16]||(l[16]=o("div",{class:"text-caption text-center"}," IVA ",-1)),o("div",Ot,"$ "+w(Number(v.value*Number(a.value.value/100)).toFixed(2)),1)])):k("",!0),a.value.option?(y(),T("div",Rt,[l[17]||(l[17]=o("div",{class:"text-caption text-center"}," TOTAL ",-1)),o("div",jt,"$ "+w(Number(v.value*Number(1+a.value.value/100)).toFixed(2)),1)])):k("",!0),o("div",zt,[l[18]||(l[18]=o("div",{class:"text-caption text-center"},"Cantidad",-1)),o("div",Kt,w(h.value),1)])]),_:1})]),_:1}),e($,{spaced:"",inset:"",vertical:"",dark:""}),e(Q,{class:"q-ml-md q-mr-md",modelValue:c.value.filter,"onUpdate:modelValue":l[6]||(l[6]=s=>c.value.filter=s),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),e($,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Mt,[b.value.length>0?(y(),T("div",Gt,[e(M,{rows:b.value,columns:j.value,"hide-bottom":"",pagination:c.value.pagination,onRowClick:se,filter:c.value.filter},null,8,["rows","columns","pagination","filter"])])):k("",!0),b.value.length>0?(y(),F($,{key:1,spaced:"",inset:"",vertical:"",dark:""})):k("",!0),o("div",Zt,[e(M,{rows:I.value,columns:j.value,"hide-bottom":"",pagination:c.value.pagination,onRowClick:se,filter:c.value.filter},null,8,["rows","columns","pagination","filter"])])]),e(z,{modelValue:g.value.state,"onUpdate:modelValue":l[7]||(l[7]=s=>g.value.state=s),persistent:"",position:"bottom"},{default:i(()=>[e(vt,{product:g.value.val,_price_list:m.value.val?m.value.val._price_list:1,edit:g.value.edit,onReset:X,products:u.value.products,rules:de(n).rules,onAddProduct:ke,onDeleteProduct:Ce,onEditProduct:Ae},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),e(z,{modelValue:m.value.state,"onUpdate:modelValue":l[9]||(l[9]=s=>m.value.state=s)},{default:i(()=>[e(U,{style:{width:"700px"}},{default:i(()=>[e(ce,{onSubmit:_e},{default:i(()=>[l[19]||(l[19]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),l[20]||(l[20]=o("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),e(N,null,{default:i(()=>[e($,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[e(Q,{autofocus:"",modelValue:m.value.val,"onUpdate:modelValue":l[8]||(l[8]=s=>m.value.val=s),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),m.value.opts.length>0?(y(),F(N,{key:0},{default:i(()=>[e(M,{rows:m.value.opts,columns:P.value.columns,pagination:P.value.pagination,onRowClick:Pe},null,8,["rows","columns","pagination"])]),_:1})):k("",!0),e(Z,{align:"right"},{default:i(()=>[re(e(_,{flat:"",label:"Cancelar",color:"primary"},null,512),[[ve]]),e(_,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:x.value.state,"onUpdate:modelValue":l[11]||(l[11]=s=>x.value.state=s)},{default:i(()=>[e(U,{style:{width:"700px"}},{default:i(()=>[e(ce,{onSubmit:he},{default:i(()=>[l[21]||(l[21]=o("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),l[22]||(l[22]=o("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),e(N,null,{default:i(()=>[e($,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[e(Q,{autofocus:"",modelValue:x.value.val,"onUpdate:modelValue":l[10]||(l[10]=s=>x.value.val=s),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),x.value.opts.length>0?(y(),F(N,{key:0},{default:i(()=>[e(M,{rows:x.value.opts,columns:d.value.columns,pagination:d.value.pagination,onRowClick:Ve},null,8,["rows","columns","pagination"])]),_:1})):k("",!0),e(Z,{align:"right"},{default:i(()=>[re(e(_,{flat:"",label:"Cancelar",color:"primary"},null,512),[[ve]]),e(_,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",null,[e(z,{modelValue:r.value,"onUpdate:modelValue":l[12]||(l[12]=s=>r.value=s)},{default:i(()=>[e($t,{total:a.value.option?Number(v.value*Number.parseFloat(1+a.value.value/100)):Number(v.value),paymeths:de(n).methods,client:u.value.client.id,onSendTicket:Ne},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),e(ze,{bordered:"",class:"bg-white"},{default:i(()=>[e(U,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:i(()=>[e(N,{class:"row"},{default:i(()=>[e(et,{ref_key:"productRef",ref:A,class:"col",checkState:!1,onInput:ye,onAgregar:be},null,512),S.value?(y(),F(_,{key:0,color:"primary",flat:"",icon:"east",onClick:l[13]||(l[13]=s=>r.value=!r.value),round:""})):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{xl as default};
