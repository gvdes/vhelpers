import{Q as le}from"./QSelect.a03eb59e.js";import{b as k,Q as ae}from"./QList.a19bb87f.js";import{u as me,r as f,l as ve,o as u,d as w,w as s,e as t,g as b,a3 as S,a2 as _,f as D,Q as V,h as U,ak as C,a0 as x,a4 as L,aA as pe}from"./index.bc0eb9a1.js";import{Q}from"./QTd.43d3ae3e.js";import{Q as M}from"./QTr.aab41a5e.js";import{Q as T}from"./QTable.8c42464b.js";import{Q as v}from"./axios.2c32c9c8.js";import{Q as O}from"./QCard.dad79872.js";import{Q as z}from"./QInput.57e297bb.js";import{Q as te}from"./QRadio.28a3f102.js";import{Q as oe}from"./QCardActions.1ac661af.js";import{Q as fe}from"./QPage.d5bf47de.js";import{C as se}from"./ClosePopup.6672bf91.js";import"./QDrawer.b1ecc906.js";import{u as ge}from"./use-quasar.01540b96.js";import{u as be}from"./warehousStore.3102428c.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.9a34191b.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as R}from"./locationsApi.c165008c.js";import"./QLinearProgress.86f77f0e.js";import"./QCheckbox.5c38f179.js";import"./QResizeObserver.04982bfd.js";import"./QScrollObserver.b6de992b.js";import"./_commonjsHelpers.88e99c8f.js";const Ve={key:0,class:"row"},he={class:"row"},we={class:"text-right row"},Ce={class:"text-bold"},Xe={__name:"locations",setup(ye){const j=me(),g=ge();be().setTitle("Ubicaciones Estructura");const $=f([]),r=f(null),a=f({state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]}),d=f({state:!1,val:null}),y=f([]),c=f([]),F=f(0),P=f({columns:[{name:"id",label:"ID",field:o=>o.id,align:"center"},{name:"name",label:"NOMBRE",field:o=>o.name,align:"left"},{name:"alias",label:"ALIAS",field:o=>o.alias,align:"left"},{name:"path",label:"PATH",field:o=>o.path,align:"left"}]}),ne=async()=>{g.loading.show({message:"Obteniendo Secciones"});const o=await R.index(j.session.store.id);o.fail?console.log(o):$.value=o,g.loading.hide()},q=()=>{const o=r.value.sections||[];F.value=Math.max(...o.map(l=>l.deep)),c.value=[{options:o.filter(l=>l.root===0),selected:null}],y.value=c.value[0].options},N=o=>{var l;return((l=r.value.sections)==null?void 0:l.filter(e=>e.root===o))||[]},ue=(o,l)=>{c.value.splice(l+1);const e=N(o);e.length>0&&c.value.push({options:e,selected:null})},ie=()=>{const o=c.value.filter(l=>l.selected!==null);if(!o.length)console.log("crear una raiz"),a.value.state=!0,a.value.val=r.value,a.value.type=!0;else{console.log("crear hijos");const l=o[o.length-1],e=l.selected,n=l.options.find(m=>m.id===e);a.value.state=!0,a.value.val=n,a.value.type=!1}},re=async()=>{g.loading.show({message:"Enviando Datos"}),a.value.defaultView.forEach(e=>{e.root=a.value.type?0:a.value.val.id,e.deep=a.value.type?0:Number(a.value.val.deep)+1,e._celler=a.value.type?a.value.val.id:a.value.val._celler,e.details={create:j.session.credentials.nick}}),console.log(a.value);let o={sections:a.value.defaultView};const l=await R.insertSection(o);l.fail?console.log(l):(console.log(l),l.forEach(n=>{console.log(n),a.value.type?y.value.push(n):r.value.sections.push(n)}),g.notify({message:"Secciones Creadas",type:"positive",position:"bottom"}),g.loading.hide(),a.value={state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]})},H=o=>{const l=N(o.id);return{...o,pivot:l.map(e=>H(e))}},de=o=>{let l=H(o);console.log(l),d.value.state=!0,d.value.val=l},ce=async()=>{g.loading.show({message:"eliminando Seccion"}),console.log(d.value.val),console.log(r.value);const o=await R.deleteSection(d.value.val);o.fail?console.log(o):(console.log(o),r.value.sections=r.value.sections.filter(l=>!o.ids.includes(l.id)),q(),d.value={state:!1,val:null},g.loading.hide())};return ne(),ve(()=>[c.value.map(o=>o.selected),a.value.create.name,a.value.create.alias,a.value.create.elementos,a.value.secuence],([o,l,e,n,m])=>{var W,G,J,K,X,Y;const E=c.value.filter(h=>h.selected!==null);if(E.length){const h=E[E.length-1],I=N(h.selected);y.value=I}else y.value=((W=c.value[0])==null?void 0:W.options)||[];if(!l||!e){a.value.defaultView=[];return}const A=[];if(m){const h=(i,p)=>i.replace(/\d+$/,"").trim()===p.trim(),I=N((G=a.value.val)==null?void 0:G.id).filter(i=>h(i.name,l)&&h(i.alias,e));let B=0;I.forEach(i=>{const p=parseInt(i.name.replace(l,"").trim()),Z=parseInt(i.alias.replace(e,"").trim()),ee=Math.max(isNaN(p)?0:p,isNaN(Z)?0:Z);ee>B&&(B=ee)});for(let i=1;i<=(Number(n)||1);i++){const p=B+i;A.push({name:`${l} ${p}`,alias:`${e}${p}`,path:`${((J=a.value.val)==null?void 0:J.path)||""}${(K=a.value.val)!=null&&K.path?"-":""}${e}${p}`})}}else A.push({name:l,alias:e,path:`${((X=a.value.val)==null?void 0:X.path)||""}${(Y=a.value.val)!=null&&Y.path?"-":""} ${e}`});a.value.defaultView=A},{deep:!0}),(o,l)=>(u(),w(fe,{padding:""},{default:s(()=>[t(O,{class:"my-card"},{default:s(()=>[t(v,null,{default:s(()=>[$.value.length>0?(u(),b("div",Ve,[t(le,{class:"col",modelValue:r.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>r.value=e),q],options:$.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(k,{spaced:"",inset:"",vertical:"",dark:""}),(u(!0),b(S,null,_(c.value,(e,n)=>(u(),b("div",{key:n,class:"col"},[D("div",he,[t(le,{class:"col",modelValue:e.selected,"onUpdate:modelValue":[m=>e.selected=m,m=>ue(m,n)],options:e.options,label:`Nivel ${n+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",disable:n==F.value},null,8,["modelValue","onUpdate:modelValue","options","label","disable"]),t(k,{spaced:"",inset:"",vertical:"",dark:""})])]))),128)),D("div",we,[t(V,{icon:"add",flat:"",onClick:ie,disable:!r.value},null,8,["disable"])])])):U("",!0),t(k,{spaced:"",inset:"",vertical:"",dark:""}),t(T,{rows:y.value,columns:P.value.columns},{body:s(e=>[t(M,{props:e},{default:s(()=>[(u(!0),b(S,null,_(e.cols,n=>(u(),w(Q,{key:n.name,props:e},{default:s(()=>[C(x(n.value),1)]),_:2},1032,["props"]))),128)),t(Q,{"auto-width":""},{default:s(()=>[t(V,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:n=>de(e.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),t(ae,{modelValue:a.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.state=e),persistent:""},{default:s(()=>[t(O,null,{default:s(()=>[t(v,{class:"text-center"},{default:s(()=>[l[8]||(l[8]=C(" NUEVA SECCION EN ALMACEN ")),D("span",Ce,x(a.value.val.name.toUpperCase()),1)]),_:1}),t(v,{class:"row"},{default:s(()=>[t(z,{class:"col",modelValue:a.value.create.name,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.create.name=e),type:"text",label:"Name",filled:"",dense:""},null,8,["modelValue"]),t(k,{spaced:"",inset:"",vertical:"",dark:""}),t(z,{class:"col",modelValue:a.value.create.alias,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.create.alias=e),type:"text",label:"Alias",filled:"",dense:""},null,8,["modelValue"]),t(k,{spaced:"",inset:"",vertical:"",dark:""}),a.value.secuence?(u(),w(z,{key:0,class:"col",modelValue:a.value.create.elementos,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.create.elementos=e),type:"Number",label:"Elementos",filled:"",dense:""},null,8,["modelValue"])):U("",!0)]),_:1}),t(v,null,{default:s(()=>[t(te,{modelValue:a.value.secuence,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.secuence=e),val:!1,label:"No Usar Secuencia"},null,8,["modelValue"]),t(te,{modelValue:a.value.secuence,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.secuence=e),val:!0,label:"Usar Secuencia"},null,8,["modelValue"])]),_:1}),a.value.create.name&&a.value.create.alias?(u(),w(v,{key:0},{default:s(()=>[t(T,{rows:a.value.defaultView},null,8,["rows"])]),_:1})):U("",!0),t(oe,{align:"right"},{default:s(()=>[L(t(V,{flat:"",label:"Cancelar",color:"negative"},null,512),[[se]]),t(V,{flat:"",label:"Crear",color:"positive",onClick:re,disable:!a.value.create.name||!a.value.create.alias},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ae,{modelValue:d.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>d.value.state=e),persistent:""},{default:s(()=>[t(O,null,{default:s(()=>[t(v,{class:"text-center text-bold text-h5"},{default:s(()=>l[9]||(l[9]=[C(" ELIMINAR SECCION ? ")])),_:1}),t(v,{class:"text-center text-bold text-h6"},{default:s(()=>[C(x(d.value.val.name),1)]),_:1}),t(v,{class:"text-left text-bold"},{default:s(()=>l[10]||(l[10]=[C(" Recuerda que se eliminaran tambien todos los hijos de la seccion ")])),_:1}),t(v,null,{default:s(()=>[t(T,{rows:d.value.val.pivot,columns:P.value.columns},{body:s(e=>[t(M,{props:e},{default:s(()=>[(u(!0),b(S,null,_(e.cols,n=>(u(),w(Q,{key:n.name,props:e},{default:s(()=>[C(x(n.value),1)]),_:2},1032,["props"]))),128)),e.row.pivot.length>0?(u(),w(Q,{key:0,"auto-width":""},{default:s(()=>[t(V,{size:"sm",color:"accent",round:"",dense:"",onClick:n=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024)):U("",!0)]),_:2},1032,["props"]),L(t(M,{props:e},{default:s(()=>[t(Q,{colspan:"100%"},{default:s(()=>[(u(!0),b(S,null,_(e.row.pivot,(n,m)=>(u(),b("div",{class:"text-left",key:m},x(n.name),1))),128))]),_:2},1024)]),_:2},1032,["props"]),[[pe,e.expand]])]),_:1},8,["rows","columns"])]),_:1}),t(oe,{align:"right"},{default:s(()=>[L(t(V,{flat:"",label:"Cancelar"},null,512),[[se]]),t(V,{flat:"",label:"Eliminar",color:"negative",onClick:ce})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Xe as default};
