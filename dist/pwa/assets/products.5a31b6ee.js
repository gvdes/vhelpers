import{Q as T,a as _}from"./QSelect.67045144.js";import{b,a as J,d as K,e as N}from"./QList.d72f5b4a.js";import{Q as x}from"./QCardSection.38f8c080.js";import{Q as A}from"./QCard.95a4d469.js";import{Q as E}from"./QTd.cb4a2d42.js";import{u as Y,r as p,c as I,l as Z,o as m,d as Q,w as o,f as n,e as l,g as y,a3 as z,a2 as D,h as w,an as L,a0 as d,ak as f,Q as M}from"./index.384925f7.js";import{Q as ee}from"./QTr.2bfc3468.js";import{Q as te}from"./QTable.2b8f0a04.js";import{Q as le}from"./QPage.cf9194a7.js";import"./QDrawer.ab6b2875.js";import"./QCardActions.b66e71e1.js";import"./ClosePopup.1a712208.js";import"./axios.17e30a83.js";import{u as oe}from"./use-quasar.6f820b66.js";import{u as ae}from"./warehousStore.1b1db17d.js";import{P as se}from"./ProductsAutocomplete.e5842288.js";import"./jspdf.plugin.autotable.15133b50.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as U}from"./locationsApi.325c3e3d.js";import"./QLinearProgress.18b37313.js";import"./QCheckbox.7b1d3fab.js";import"./QResizeObserver.b797df0d.js";import"./QScrollObserver.d0a43316.js";import"./QInput.166e1d4d.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const ie={key:0},ne={key:0},ce={class:"row"},de={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},re={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},ue={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},me={class:"row"},pe={class:"text-h6 col text-bold text-left"},ve={class:"text-h6 col text-bold text-right"},fe={class:"text-subtitle2 col"},Ge={__name:"products",setup(ge){const h=Y(),r=oe();ae().setTitle("Ubicaciones Productos");const S=p([]),k=p(null),O=p([]),v=p([]),$=p(0),s=p(null),g=p(null),B=p({columns:[{name:"name",label:"NOMBRE",field:e=>e.name,align:"left"},{name:"alias",label:"ALIAS",field:e=>e.alias,align:"left"},{name:"path",label:"PATH",field:e=>e.path,align:"left"}],paginate:{rowsPerPage:0}}),V=I(()=>r.platform.is.mobile),F=I(()=>{var e,t;return(t=(e=s.value)==null?void 0:e.locations)==null?void 0:t.find(a=>{var c;return a.id==((c=g.value)==null?void 0:c.selected)})}),H=async()=>{r.loading.show({message:"Obteniendo Secciones"});const e=await U.index(h.session.store.id_viz);e.fail?console.log(e):S.value=e,r.loading.hide()},j=()=>{const e=k.value.sections||[];$.value=Math.max(...e.map(t=>t.deep)),v.value=[{options:e.filter(t=>t.root===0),selected:null}],O.value=v.value[0].options},P=e=>{var t;return((t=k.value.sections)==null?void 0:t.filter(a=>a.root===e))||[]},q=(e,t)=>{v.value.splice(t+1);const a=P(e);a.length>0&&v.value.push({options:a,selected:null})},G=e=>{s.value=e,console.log(e)},R=e=>{s.value=e,console.log(e)},W=async()=>{console.log(h.session),r.loading.show({message:"Agregando Ubicacion"}),console.log(g.value);let e={id_viz:h.session.credentials.staff.id_va,_location:g.value.selected,_product:s.value.id};const t=await U.addLocations(e);if(t.fail)console.log(t);else{console.log(t);const a=v.value.filter(c=>c.selected!==null);if(a.length){const i=a[a.length-1].options.find(u=>u.id===g.value.selected);s.value.locations.push(i)}r.notify({message:"Ubicacion Agregada",type:"positive",position:"bottom"}),r.loading.hide()}},X=async e=>{console.log(h.session),r.loading.show({message:"Eliminando Ubicacion"});let t={id_viz:h.session.credentials.staff.id_va,_location:e,_product:s.value.id};console.log(t);const a=await U.addLocations(t);if(a.fail)console.log(a);else{console.log(a),r.notify({message:"Ubicacion Eliminada",type:"positive",position:"bottom"});let c=s.value.locations.findIndex(i=>i.id==e);s.value.locations.splice(c,1),r.loading.hide()}};return H(),Z(v,e=>{const t=e.filter(a=>a.selected!==null);if(t.length){const a=t[t.length-1];P(a.selected),g.value=a}},{deep:!0}),(e,t)=>(m(),Q(le,{padding:""},{default:o(()=>{var a,c;return[n("div",{class:L(V.value?"":"row")},[l(A,{class:L(V.value?"my-card":"col my-card")},{default:o(()=>[l(x,null,{default:o(()=>[S.value.length>0?(m(),y("div",ie,[l(T,{modelValue:k.value,"onUpdate:modelValue":[t[0]||(t[0]=i=>k.value=i),j],options:S.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),l(b,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),y(z,null,D(v.value,(i,u)=>(m(),y("div",{key:u},[n("div",null,[l(T,{modelValue:i.selected,"onUpdate:modelValue":[C=>i.selected=C,C=>q(C,u)],options:i.options,label:`Nivel ${u+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),l(b,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):w("",!0)]),_:1})]),_:1},8,["class"]),l(b,{spaced:"",inset:"",vertical:"",dark:""}),l(A,{class:L(V.value?"my-card":"col my-card")},{default:o(()=>[l(x,null,{default:o(()=>[l(se,{onInput:G,onAgregar:R,with_locations:""})]),_:1}),s.value?(m(),y("div",ne,[l(x,{class:"item-center"},{default:o(()=>[n("div",ce,[n("div",de,d(s.value.categories.familia.seccion.name),1),n("div",re,d(s.value.categories.familia.name),1),n("div",ue,d(s.value.categories.name),1)])]),_:1}),l(x,{class:"item-center"},{default:o(()=>[n("div",me,[n("div",pe,d(s.value.code),1),n("div",ve,d(s.value.name),1)]),n("div",fe,d(s.value.description),1),n("div",null,[l(J,null,{default:o(()=>[l(K,null,{default:o(()=>[l(N,null,{default:o(()=>[l(_,{class:"text-caption text-center"},{default:o(()=>t[1]||(t[1]=[f("GEN")])),_:1}),l(_,{class:"text-center"},{default:o(()=>[f(d(s.value.stocks[0].pivot.gen),1)]),_:1})]),_:1}),l(N,null,{default:o(()=>[l(_,{class:"text-caption text-center"},{default:o(()=>t[2]||(t[2]=[f("EXH")])),_:1}),l(_,{class:"text-center"},{default:o(()=>[f(d(s.value.stocks[0].pivot.exh),1)]),_:1})]),_:1}),l(N,null,{default:o(()=>[l(_,{class:"text-caption text-center"},{default:o(()=>t[3]||(t[3]=[f("FDT")])),_:1}),l(_,{class:"text-center"},{default:o(()=>[f(d(s.value.stocks[0].pivot.fdt),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),s.value.locations.length>0?(m(),Q(x,{key:0},{default:o(()=>[t[4]||(t[4]=n("div",{class:"text-center text-bold text-h6"},"Ubicaciones",-1)),l(b,{spaced:"",inset:"",vertical:"",dark:""}),l(te,{rows:s.value.locations,columns:B.value.columns,pagination:B.value.paginate,"hide-bottom":"","hide-header":""},{body:o(i=>[l(ee,{props:i},{default:o(()=>[(m(!0),y(z,null,D(i.cols,u=>(m(),Q(E,{key:u.name,props:i},{default:o(()=>[f(d(u.value),1)]),_:2},1032,["props"]))),128)),l(E,{"auto-width":""},{default:o(()=>[l(M,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:u=>X(i.row.id),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])]),_:1})):w("",!0)])):w("",!0)]),_:1},8,["class"])],2),l(b,{spaced:"",inset:"",vertical:"",dark:""}),((a=g.value)==null?void 0:a.selected)&&((c=s.value)==null?void 0:c.id)&&!F.value?(m(),Q(A,{key:0,class:"my-card"},{default:o(()=>[l(x,null,{default:o(()=>[l(M,{color:"primary",icon:"add_link",onClick:W})]),_:1})]),_:1})):w("",!0)]}),_:1}))}};export{Ge as default};
