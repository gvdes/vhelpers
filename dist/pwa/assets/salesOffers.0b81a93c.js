import{b as c,a as Z,d as U,e as _,Q as G}from"./QList.78073681.js";import{Q as ee}from"./QHeader.039728b2.js";import{u as le,r as k,c as R,o as u,d as g,w as i,e as l,f as s,al as f,S as ae,a0 as x,h as v,a4 as Q,Q as p,b9 as te,g as F,ak as oe,a1 as se}from"./index.15258eea.js";import{Q as ie}from"./QToolbar.bf90d64f.js";import{Q as ne}from"./QTable.ab1e9866.js";import{Q as E}from"./QCardSection.cb404fcd.js";import{Q as T}from"./QCard.45379e61.js";import{Q as de}from"./QPage.1bdc2fdd.js";import{Q as re,a as ue}from"./QLayout.bef2ecb9.js";import{Q as I}from"./QInput.420ec09a.js";import{Q as D}from"./QSelect.3caae765.js";import{Q as ve}from"./QCardActions.355243a7.js";import{Q as ce}from"./QForm.e93d8b97.js";import{Q as pe}from"./QFooter.b5d4bc55.js";import{C as A}from"./ClosePopup.27b476e6.js";import{_ as me}from"./UserToolbar.4182efc4.js";import{b as q,a as fe}from"./axios.7c1eeb6c.js";import{P as be}from"./ProductsAutocomplete.1b3cef1d.js";import{u as ge}from"./use-quasar.377ab6bd.js";import"./use-key-composition.a5729965.js";import"./QResizeObserver.6b28efca.js";import"./QLinearProgress.a2aac955.js";import"./QCheckbox.762a1a90.js";import"./use-checkbox.a8f46836.js";import"./QScrollObserver.a45d46ae.js";import"./QDrawer.3c2b0d14.js";import"./QExpansionItem.b3a1fab8.js";import"./auth.f370d621.js";/* empty css                                                                         */const xe={class:"text-bold"},ye={class:"row text-h6"},ke={class:"col"},Ee={class:"text-bold"},Ce={class:"col"},Ve={class:"text-bold"},we={class:"row items-end"},_e={class:"text-center"},Qe={class:"col q-pa-xs"},Ie={class:"col column q-py-md"},De={class:"col q-pa-xs"},Fe={class:"row"},Te={class:"col"},Ae={key:1,class:"col"},Pe={class:"row text-center items-center"},Ue={class:"col"},Ge={class:"row text-center items-center"},Ne={class:"col text-h5 text-bold bg-grey-3"},Se={class:"row text-center items-center"},$e={class:"col"},Oe={class:"col"},Re={class:"row flex justify-center"},qe={class:"col flex justify-center"},Be={key:0,class:"col"},je={key:0,class:"row flex justify-center text-center"},ze={class:"col"},he={class:"col"},Le={class:"text-h5"},He={key:0,class:"text-center"},Me={class:"row"},wl={__name:"salesOffers",setup(Je){const w=le(),C=ge(),m=k({state:!1,val:null,body:null}),V=k({val:null,opts:[]}),N=k({val:null,opts:[]}),t=k({val:null,state:!1}),y=k({state:!1,dafpa:!1}),n=k({EFE:{id:null,val:0},DIG:{id:null,val:0}}),S=[{id:"EFE",desc:"CONTADO EFECTIVO"},{id:"TBA",desc:"TARJETA C/D BANCOMER"},{id:"TSA",desc:"TARJETA C/D SANTANDER"},{id:"TDB",desc:"TRA/DEP BANCOMER"},{id:"C30",desc:"CREDITO"}],r=k([]),$=k({columns:[{name:"code",label:"ARICULO",field:o=>o.code,align:"left"},{name:"description",label:"DESCRIPCION",field:o=>o.description,align:"left"},{name:"amount",label:"CANTIDAD",field:o=>o.amount,align:"center"},{name:"price",label:"PRECIO",field:o=>{var e;return(e=o.price)==null?void 0:e.pivot.price},align:"center"},{name:"total",label:"TOTAL",field:o=>{var e;return o.amount*((e=o.price)==null?void 0:e.pivot.price)},align:"center"}],pagination:{rowsPerPage:0},filter:""}),B=R(()=>{var o,e;return P.value>=0&&(((o=n.value.EFE.id)==null?void 0:o.id)&&n.value.EFE.val>0||((e=n.value.DIG.id)==null?void 0:e.id)&&n.value.DIG.val>0)}),P=R(()=>Number.parseFloat(n.value.DIG.val)+Number.parseFloat(n.value.EFE.val)-r.value.reduce((o,e)=>{var a;return o+e.amount*((a=e.price)==null?void 0:a.pivot.price)},0)),j=async()=>{C.loading.show({message:"Obteniendo Cajas"});let o=w.session.store.ip_address;console.log(w.session);let e=`http://${o}/access/public/reports/getTerminal`;const a=await q.get(e);a.status!=200?console.log(a):(console.log(a),V.value.opts=a.data,C.loading.hide())},z=o=>{console.log(o)},h=o=>{console.log(o);let e=r.value.findIndex(a=>a.id==o.id);console.log(e),t.value.state=!0,o.amount=1,o.notes="",o.edit=!1,t.value.val=o},L=(o,e,a)=>{console.log(e),console.log(a);let d=a;console.log(d),d>=0&&(t.value.state=!0,t.value.val=r.value[d],t.value.val.edit=!0,t.value.index=d)},H=()=>{console.log(t.value.val),r.value.push(t.value.val)},M=()=>{let o=t.value.index;r.value.splice(o,1,t.value.val)},J=()=>{let o=r.value.findIndex(e=>e.id==t.value.val.id);o>=0&&r.value.splice(o,1)},K=async()=>{let o=w.session.store.id;console.log(o);try{let e=await fe.get(`/cashier/getPrinters/${o}`);e.status==200&&(m.value.body=e.data,console.log("Impresoras listas :)"),y.value.state=!0)}catch(e){console.log(e),C.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},W=o=>{var e;return o.id==((e=n.value.DIG.id)==null?void 0:e.id)},X=o=>{var e;return o.id==((e=n.value.EFE.id)==null?void 0:e.id)},Y=async()=>{C.loading.show({message:"Realizando Ticket"});let e=`http://${w.session.store.ip_address}/access/public/modify/createTicket`,d={by:`${w.session.name} - ${w.session.store.alias}`,modes:n.value,colab:N.value.val,terminal:V.value.val,impresoras:m.value.val,productos:r.value,cambio:P.value};const b=await q.post(e,d);b.status!=200?console.log(b):(console.log(b.data),m.value={state:!1},V.value={val:null},N.value={val:null},t.value={val:null,state:!1},y.value={state:!1,dafpa:!1},n.value={EFE:{id:null,val:0},DIG:{id:null,val:0}},r.value=[],C.notify({message:b.data.mssg,type:"positive",position:"center"}),C.loading.hide())};return j(),(o,e)=>(u(),g(re,{view:"hHh Lpr fFf"},{default:i(()=>[l(ee,{class:"transparent",bordered:""},{default:i(()=>[l(me),l(c)]),_:1}),l(ue,null,{default:i(()=>[l(ie,{class:"justify-between"},{default:i(()=>[s("div",null,[e[20]||(e[20]=f("Helpers ")),l(ae,{name:"navigate_next",color:"primary"}),e[21]||(e[21]=f()),e[22]||(e[22]=s("span",{class:"text-h6"},"Cobro Ofertas",-1))]),s("div",null,[e[23]||(e[23]=f("Total $")),s("span",xe,x(r.value.reduce((a,d)=>{var b;return a+d.amount*((b=d.price)==null?void 0:b.pivot.price)},0)),1)])]),_:1}),l(de,{class:"",padding:""},{default:i(()=>[l(T,{class:"my-card"},{default:i(()=>[r.value.length>0?(u(),g(E,{key:0},{default:i(()=>[l(ne,{"hide-bottom":"",rows:r.value,"row-key":"id",columns:$.value.columns,pagination:$.value.pagination,onRowClick:L},null,8,["rows","columns","pagination"])]),_:1})):v("",!0)]),_:1})]),_:1})]),_:1}),l(G,{modelValue:t.value.state,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.state=a),persistent:"",position:"bottom"},{default:i(()=>[l(T,null,{default:i(()=>[l(E,{class:""},{default:i(()=>[s("div",ye,[s("div",ke,[e[24]||(e[24]=f("Codigo: ")),s("span",Ee,x(t.value.val.code),1)]),s("div",Ce,[e[25]||(e[25]=f("Cco: ")),s("span",Ve,x(t.value.val.name),1)]),s("div",null,[t.value.val.edit==!0?Q((u(),g(p,{key:0,color:"negative",icon:"delete",onClick:J,flat:"",size:"sm"},null,512)),[[A]]):v("",!0)])]),l(I,{modelValue:t.value.val.description,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.val.description=a),type:"text",label:"description"},null,8,["modelValue"])]),_:1}),l(E,null,{default:i(()=>[s("div",we,[s("div",_e,[s("div",Qe,[e[26]||(e[26]=s("div",{class:"text-bold text-h6"},"Cantidad:",-1)),l(p,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:e[1]||(e[1]=a=>t.value.val.amount++)}),l(c,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Ie,[Q(s("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=a=>t.value.val.amount=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[te,t.value.val.amount]])]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),l(p,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:e[3]||(e[3]=a=>t.value.val.amount>1?t.value.val.amount--:""),disable:t.value.val.amount<=1},null,8,["disable"])])]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),s("div",De,[s("div",Fe,[s("div",Te,[l(D,{modelValue:t.value.val.price,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.val.price=a),options:t.value.val.prices,label:"Precios",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])]),t.value.val.price?(u(),g(c,{key:0,spaced:"",inset:"",vertical:"",dark:""})):v("",!0),t.value.val.price?(u(),F("div",Ae,[l(I,{modelValue:t.value.val.price.pivot.price,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.val.price.pivot.price=a),type:"number",label:"Precio",filled:"",dense:"",error:t.value.val.price.pivot.price<=0,"error-message":"El importe tiene que ser mayor que  0"},null,8,["modelValue","error"])])):v("",!0)]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),l(I,{dense:"",filled:"",modelValue:t.value.val.notes,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.val.notes=a),type:"text",label:"Notas",error:t.value.val.notes.length<=0,"error-message":"Campo Obligatorio"},null,8,["modelValue","error"]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),l(Z,null,{default:i(()=>[l(U,{class:""},{default:i(()=>[l(_,{class:"text-left text-caption"},{default:i(()=>e[27]||(e[27]=[f("P x C")])),_:1}),l(_,{class:"text-bold text-center"},{default:i(()=>[f(x(t.value.pieces)+" pzs",1)]),_:1})]),_:1}),l(U,null,{default:i(()=>[l(_,{class:"text-left text-caption"},{default:i(()=>e[28]||(e[28]=[f("Unidades")])),_:1}),l(_,{class:"text-bold text-center"},{default:i(()=>[f(x(t.value.val.amount)+" pzs",1)]),_:1})]),_:1}),l(U,{class:""},{default:i(()=>[l(_,{class:"text-left text-caption text-bold"},{default:i(()=>e[29]||(e[29]=[f("Total")])),_:1}),l(_,{class:"text-bold text-center"},{default:i(()=>{var a;return[f("$ "+x(t.value.val.price?t.value.val.amount*((a=t.value.val.price)==null?void 0:a.pivot.price):0),1)]}),_:1})]),_:1})]),_:1})])])]),_:1}),l(ve,{align:"center"},{default:i(()=>{var a;return[Q(l(p,{flat:"",icon:"close",color:"negative"},null,512),[[A]]),t.value.val.edit==!0?Q((u(),g(p,{key:0,flat:"",icon:"edit",color:"warning",onClick:M},null,512)),[[A]]):v("",!0),t.value.val.edit==!1?Q((u(),g(p,{key:1,flat:"",icon:"check",color:"positive",onClick:H,disable:((a=t.value.val.price)==null?void 0:a.pivot.price)<=0||t.value.val.notes.length<=0},null,8,["disable"])),[[A]]):v("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),l(G,{modelValue:y.value.state,"onUpdate:modelValue":e[16]||(e[16]=a=>y.value.state=a)},{default:i(()=>[l(T,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:i(()=>[e[33]||(e[33]=s("div",{class:"bg-primary q-pa-md text-white text-center"},[s("div",{class:"fw-bold text-h6"},"Cobro del documento")],-1)),l(E,null,{default:i(()=>{var a;return[s("div",Pe,[e[30]||(e[30]=s("div",{class:"col"}," Forma de pago: ",-1)),s("div",Ue,[l(D,{class:"col-3",modelValue:n.value.EFE.id,"onUpdate:modelValue":e[8]||(e[8]=d=>n.value.EFE.id=d),options:S,"option-value":"id","option-label":"desc",dense:"",filled:"",label:"Forma de pago","option-disable":d=>W(d)},null,8,["modelValue","option-disable"])])]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Ge,[e[31]||(e[31]=s("div",{class:"col"}," Total a pagar: ",-1)),s("div",Ne,x(r.value.reduce((d,b)=>{var O;return d+b.amount*((O=b.price)==null?void 0:O.pivot.price)},0)),1)]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Se,[s("div",$e,x(((a=n.value.EFE.id)==null?void 0:a.id)=="EFE"?"Efectivo":"Importe Cobrado"),1),s("div",Oe,[l(I,{class:"col",modelValue:n.value.EFE.val,"onUpdate:modelValue":e[10]||(e[10]=d=>n.value.EFE.val=d),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(n.value.EFE.val)?(u(),g(p,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:e[9]||(e[9]=d=>n.value.EFE.val=0)})):v("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),l(E,null,{default:i(()=>{var a;return[s("div",Re,[s("div",qe,[l(p,{color:"primary",label:"2\xAA Forma de pago",onClick:e[11]||(e[11]=()=>{y.value.dafpa=!y.value.dafpa,n.value.DIG.val=0,n.value.DIG.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),y.value.dafpa?(u(),F("div",Be,[l(D,{class:"col-3",modelValue:n.value.DIG.id,"onUpdate:modelValue":e[12]||(e[12]=d=>n.value.DIG.id=d),options:S,label:"Forma Pago","option-value":"id","option-label":"desc",dense:"",filled:"","option-disable":d=>X(d)},null,8,["modelValue","option-disable"])])):v("",!0)]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),y.value.dafpa?(u(),F("div",je,[s("div",ze,x(((a=n.value.DIG.id)==null?void 0:a.id)=="EFE"?"Efectivo":"Importe Cobrado"),1),s("div",he,[l(I,{class:"col",modelValue:n.value.DIG.val,"onUpdate:modelValue":e[14]||(e[14]=d=>n.value.DIG.val=d),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:i(()=>[parseFloat(n.value.DIG.val)?(u(),g(p,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:e[13]||(e[13]=d=>n.value.DIG.val=0)})):v("",!0)]),_:1},8,["modelValue"])])])):v("",!0)]}),_:1}),l(E,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:i(()=>[s("div",null,[e[32]||(e[32]=s("div",{class:"fs-dec3"},"Cambio",-1)),s("div",Le," $ "+x(P.value),1)]),B.value?(u(),F("div",He,[l(p,{color:"primary",icon:"payment",label:"Pagar",onClick:e[15]||(e[15]=a=>m.value.state=!m.value.state)})])):v("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(G,{modelValue:m.value.state,"onUpdate:modelValue":e[19]||(e[19]=a=>m.value.state=a)},{default:i(()=>[l(T,{class:"my-card"},{default:i(()=>[l(E,null,{default:i(()=>e[34]||(e[34]=[s("div",{class:"text-h6 text-center"},"Selecciona Caja e Impresora",-1)])),_:1}),l(E,null,{default:i(()=>[l(ce,{onSubmit:Y,class:"q-gutter-md"},{default:i(()=>[l(D,{dense:"",modelValue:V.value.val,"onUpdate:modelValue":e[17]||(e[17]=a=>V.value.val=a),options:V.value.opts,label:"Caja",filled:"","option-label":"DESTER"},null,8,["modelValue","options"]),l(c,{spaced:"",inset:"",vertical:"",dark:""}),l(D,{dense:"","option-label":"name",modelValue:m.value.val,"onUpdate:modelValue":e[18]||(e[18]=a=>m.value.val=a),options:m.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),s("div",null,[l(p,{label:"Enviar",type:"submit",color:"primary",class:"full-width",disable:m.value.val==null||V.value.val==null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(pe,{reveal:"",elevated:"",bordered:"",class:oe(se(C).dark.isActive?"text-white bg-dark":"text-dark bg-white")},{default:i(()=>[s("div",Me,[l(be,{checkState:!1,onInput:z,with_prices:"",onAgregar:h,class:"col"}),r.value.length>0?(u(),g(c,{key:0,spaced:"",inset:"",vertical:"",dark:""})):v("",!0),r.value.length>0?(u(),g(p,{key:1,color:"",icon:"send",onClick:K,flat:""})):v("",!0)])]),_:1},8,["class"])]),_:1}))}};export{wl as default};
