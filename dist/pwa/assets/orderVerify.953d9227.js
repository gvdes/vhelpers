import{u as ae,d as le,Y as oe,r as f,e as se,o as ie,x as ne,a as k,f as P,g as s,n as h,h as a,k as m,j as i,a0 as b,m as v,a6 as de,a3 as g,Q as w,a5 as V,l as T,a4 as Q,aW as B,i as U}from"./index.02fec612.js";import{Q as q}from"./QTable.b77f1771.js";import{Q as E}from"./QForm.bc0f6903.js";import{Q as re}from"./QFooter.167098cd.js";import{Q as ue}from"./QPage.13b45709.js";import{C as N}from"./ClosePopup.b90a3e10.js";import"./axios.a188c3a3.js";import{u as ce}from"./use-quasar.5cb75810.js";import{P as ve}from"./ProductsAutocomplete.7dac1e1e.js";import{_ as pe}from"./productView.9a7ed5ef.js";import{d as fe}from"./dayjs.min.cbcf888d.js";import{R as Y}from"./resoursesOrder.f6ec382b.js";import{o as y}from"./orderApi.da2e4f6a.js";import"./QList.ec23182b.js";import"./QSelect.4e4b152c.js";import"./QLinearProgress.33c83220.js";import"./QResizeObserver.a576a0e4.js";/* empty css                                                                         */import"./QSpace.a3b46a6e.js";import"./_commonjsHelpers.88e99c8f.js";const me={class:"col"},ge={class:"text-center text-h6"},ye={class:"col"},xe={class:"col"},be={class:"text-center text-h6"},we={class:"col"},Ce={class:"text-center text-h6"},_e={class:"col"},Ve={class:"text-center text-h6"},De={class:"col"},ke={class:"text-center text-h6"},ze={__name:"orderVerify",setup(Pe){const $=ae(),u=ce(),S=le(),j=oe(),l=f(null),c=f({state:!1,val:null}),C=f(!1),r=f({state:!1,val:null,opts:[]}),n=f({state:!1,val:null,edit:!1}),A=f({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),_=f([]),I=f({columns:[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},{name:"amount",label:"Pedido",field:t=>t.pivot.units,align:"center"},{name:"verify",label:"Verificado",field:t=>t.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:t=>t.pivot.price,align:"center"},{name:"total",label:"Total",field:t=>t.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),O=f({columns:[{name:"id",label:"Codigo",field:t=>t.id,align:"left"},{name:"Nombre",label:"Descripcion",field:t=>t.name,align:"left"},{name:"Telefono",label:"Pedido",field:t=>t.celphone,align:"center"}],pagination:{rowsPerPage:0}}),F=se(()=>l.value.products.every(t=>t.pivot.amountDelivered||t.pivot.amountDelivered>0)),L=async()=>{let t=j.params.ord;const e=await y.getOrderVerify(t);e.fail?e.fail.status==401?(u.notify({message:e.fail.response.data,position:"center",type:"negative"}),S.push("/verifyOrder")):console.log(e):(console.log(e),l.value=e.order,_.value=e.rules)},K=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0?(n.value.val=l.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=A.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},M=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0?(n.value.val=l.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=A.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},z=(t,e)=>{console.log(e),n.value.val=e,n.value.edit=!0,n.value.state=!0},D=()=>{n.value={state:!1,val:null,edit:!1}},W=t=>{l.value.products.push(t),D()},G=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0&&(l.value.products.splice(e,1),D())},H=async()=>{if(r.value.val){const t=await y.getClient(r.value);t.fail?console.log(t):t.length>0?(console.log(t),r.value.opts=t):u.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else u.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},J=async(t,e)=>{u.loading.show({message:"Recalculando Ticket"});let o={order:l.value.id,client:e.id};const d=await y.changeClientOrder(o);d.fail?console.log(d):(l.value.client=e,Y.actualizarPreciosProductos(l.value.products,l.value,_.value),r.value={state:!1,val:null,opts:[]},u.loading.hide())},X=()=>{console.log("cambio de cliente"),r.value.state=!0},R=t=>{t.ctrlKey&&t.key.toLowerCase()==="b"?(t.preventDefault(),r.value.state||(r.value.state=!0)):t.ctrlKey&&t.key.toLowerCase()==="p"&&(t.preventDefault(),c.value.state||(c.value.state=!0))},Z=async()=>{u.loading.show({message:"Terminando Verificacion"});let t={uid:$.session.credentials.staff.id_va,oid:l.value.id};const e=await y.nextState(t);e.fail?console.log(e):(console.log(e),u.notify({message:"El pedido ya esta en Caja",position:"center",type:"positive",icon:"check"}),u.loading.hide(),S.push("/verifyOrder"))},ee=async()=>{if(c.value.val){let t={uid:$.session.credentials.staff.id_va,oid:l.value.id};const e=await y.getOrderAdd(c.value.val,t);console.log(e),e.fail?e.fail.status==401?u.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):e.fail.status==404?u.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):console.log(e):e?(console.log(e),te(l.value.products,e.products).then(o=>l.value.products=o),Y.actualizarPreciosProductos(l.value.products,l.value,_.value),c.value={state:!1,val:null}):u.notify({message:"No hay ningun pedido con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"})}else u.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},te=async(t,e)=>{const o=[...t];for(const d of e){const x=o.find(p=>p.id===d.id);if(x){x.pivot.units+=d.pivot.units,x.pivot.toDelivered=0,x.pivot.amountDelivered=0;const p=await y.editProduct(x.pivot);console.log(x),p.fail?console.log("Edit failed:",p):console.log("Edited:",p)}else{d.pivot._order=l.value.id,d.pivot.toDelivered=0,d.pivot.amountDelivered=0;const p=await y.addProduct(d.pivot);p.fail?console.log("Add failed:",p):(console.log("Added:",p),o.push(d))}}return o};return ie(()=>{L(),window.addEventListener("keydown",R)}),ne(()=>{window.removeEventListener("keydown",R)}),(t,e)=>l.value?(k(),P(ue,{key:0,padding:""},{default:s(()=>[a(w,{class:"my-card"},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[i("div",me,[e[8]||(e[8]=i("div",{class:"text-caption text-center"},"Dependiente",-1)),i("div",ge,b(`${l.value.created_by.names} ${l.value.created_by.surname_pat}
            ${l.value.created_by.surname_mat}`),1)]),i("div",ye,[e[9]||(e[9]=i("div",{class:"text-caption text-center"},"Cliente",-1)),a(v,{class:"full-width",flat:"",label:l.value.client.name,onClick:X},null,8,["label"])]),i("div",xe,[e[10]||(e[10]=i("div",{class:"text-caption text-center"},"Fecha",-1)),i("div",be,b(de(fe)(l.value.created_at).format("YYYY-MM-DD")),1)]),a(v,{color:"primary",flat:""}),a(g,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(w,{class:"my-card"},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[i("div",we,[e[11]||(e[11]=i("div",{class:"text-caption text-center"},"Orden",-1)),i("div",Ce,b(l.value.id),1)]),i("div",_e,[e[12]||(e[12]=i("div",{class:"text-caption text-center"},"Total",-1)),i("div",Ve,"$ "+b(Number(l.value.products.reduce((o,d)=>o+d.pivot.total,0)).toFixed(2)),1)]),i("div",De,[e[13]||(e[13]=i("div",{class:"text-caption text-center"},"Cantidad",-1)),i("div",ke,b(l.value.products.reduce((o,d)=>o+Number(d.pivot.toDelivered),0)),1)]),a(v,{color:"primary",flat:"",icon:"add",onClick:e[0]||(e[0]=o=>c.value.state=!c.value.state)}),a(g,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(q,{rows:l.value.products,columns:I.value.columns,"hide-bottom":"",pagination:I.value.pagination,onRowClick:z},null,8,["rows","columns","pagination"]),a(V,{modelValue:n.value.state,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.state=o),persistent:"",position:"bottom"},{default:s(()=>[a(pe,{product:n.value.val,order:l.value,edit:n.value.edit,onReset:D,products:l.value.products,rules:_.value,onAddProduct:W,onDeleteProduct:G},null,8,["product","order","edit","products","rules"])]),_:1},8,["modelValue"]),a(V,{modelValue:r.value.state,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.state=o),persistent:""},{default:s(()=>[a(w,{style:{width:"700px"}},{default:s(()=>[a(E,{onSubmit:H},{default:s(()=>[e[14]||(e[14]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),e[15]||(e[15]=i("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),a(m,null,{default:s(()=>[a(g,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[a(T,{autofocus:"",modelValue:r.value.val,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.val=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),r.value.opts.length>0?(k(),P(m,{key:0},{default:s(()=>[a(q,{rows:r.value.opts,columns:O.value.columns,pagination:O.value.pagination,onRowClick:J},null,8,["rows","columns","pagination"])]),_:1})):h("",!0),a(Q,{align:"right"},{default:s(()=>[B(a(v,{flat:"",label:"Cancelar",color:"primary"},null,512),[[N]]),a(v,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=o=>C.value=o),persistent:""},{default:s(()=>[a(w,null,{default:s(()=>[a(m,{class:"text-center text-bold text-h6"},{default:s(()=>[U(" Orden "+b(l.value.id),1)]),_:1}),a(m,null,{default:s(()=>e[16]||(e[16]=[U(" El pedido se ira directo a caja, "),i("span",{class:"text-bold"}," Deseas Continuar?",-1)])),_:1}),a(Q,{align:"right"},{default:s(()=>[B(a(v,{flat:"",icon:"close",color:"negative"},null,512),[[N]]),a(v,{flat:"",icon:"send",color:"positive",onClick:Z})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:c.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>c.value.state=o),persistent:""},{default:s(()=>[a(w,{style:{width:"300px"}},{default:s(()=>[a(E,{onSubmit:ee},{default:s(()=>[e[17]||(e[17]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Comanda",-1)),e[18]||(e[18]=i("div",{class:"text-center text-bold text-caption"},"Busca ID de commanda",-1)),a(m,null,{default:s(()=>[a(g,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[a(T,{autofocus:"",modelValue:c.value.val,"onUpdate:modelValue":e[5]||(e[5]=o=>c.value.val=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),a(Q,{align:"right"},{default:s(()=>[B(a(v,{flat:"",label:"Cancel",color:"primary"},null,512),[[N]]),a(v,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(re,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:s(()=>[a(w,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[a(ve,{class:"col",checkState:!1,onInput:M,onAgregar:K}),F.value?(k(),P(v,{key:0,color:"primary",flat:"",icon:"east",onClick:e[7]||(e[7]=o=>C.value=!C.value),round:""})):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0)}};export{ze as default};
