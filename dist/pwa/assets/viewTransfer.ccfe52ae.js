import{r as A,c as pe,o as S,a as V,w as a,h as Y,u as ve,aD as me,e as t,Q as h,f as H,i,a4 as p,a3 as d,Y as j,g as ge,a0 as _e,a1 as he,a2 as q,b2 as xe,a6 as ye}from"./index.fb938f2d.js";import{Q as we}from"./QToolbar.ce92ecb8.js";import{Q as N}from"./QSeparator.d7a1acf1.js";import{Q as be}from"./QHeader.e7281639.js";import{Q as I,a as v}from"./QItemSection.ccc67a48.js";import{Q as O}from"./QList.fd465fa0.js";import{u as Ce,Q as R,a as Q}from"./use-quasar.47d7c654.js";import{Q as X}from"./QCardActions.3386c344.js";import{Q as U}from"./QDialog.e88631d3.js";import{Q as Pe}from"./QFooter.b16289bc.js";import{Q as ke}from"./QPage.0ee33b16.js";import{u as Ee}from"./VDB.9e4279b1.js";import{d as Fe}from"./dayjs.min.25545ff6.js";import{E as Ae,a as W}from"./jspdf.plugin.autotable.fa95ebeb.js";import{t as k}from"./transferApi.16ddce87.js";import{E as J}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{P as Se,d as Ie}from"./ProductsAutocomplete.de195f58.js";import"./QResizeObserver.68b8daf6.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.30672b3a.js";import"./axios.f1f32898.js";import"./QInput.f2297e08.js";import"./use-key-composition.58e43a74.js";import"./uid.42677368.js";import"./QSelect.6f1f7054.js";import"./position-engine.073b6f90.js";import"./rtl.b51694b1.js";/* empty css                                                                         */const Qe={class:"row items-center"},De={class:"col"},Te={class:"col"},Ve={class:"text-h6"},Ne={class:"text-center text-bold"},Oe={class:"text-center text-bold row"},Re={class:"col"},$e={class:"col"},Ue={class:"col"},Be={class:"text-center text-h4"},Me={class:"text-center text-h6 text-grey-14"},ze={class:"text-center"},Ge={class:"q-pa-xs"},Le=i("div",{class:"text-bold text-h6"},"Cantidad:",-1),Ye={class:"row"},He={class:"col column q-py-md"},Ct={__name:"viewTransfer",setup(je){const $=ve(),E=me(),F=Ee(),r=Ce(),m=A(null),n=A({val:null,state:!1}),g=A([]),y=A({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),x=A({state:!1,encontrados:[],faltantes:[],products:null}),B=A(null),M=A(null),Z=pe(()=>{var s;return((s=g.value)==null?void 0:s.filter(e=>{var o;return e.product==((o=n.value.val)==null?void 0:o.product)}).length)>0}),K=async()=>{const s=E.params.oid,e=await k.getTransfer(s);e.fail?console.log(e):(console.log(e),F.session.rol=="aud"||(F.session.rol=="aux"||F.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||F.session.rol=="alm"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(m.value=e,g.value=e.bodie,console.log(m.value)):($.push("/transfers"),r.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},ee=s=>{console.log(s)},te=s=>{let e=g.value.findIndex(o=>o.product==s.code);console.log(e),e>=0?r.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(n.value.val={product:s.code,description:s.description,amount:1},n.value.state=!0,console.log(s))},ae=async()=>{r.loading.show({message:"Insertando Producto"}),console.log(n.value.val),n.value.val._transfer=E.params.oid;const s=await k.addProduct(n.value.val);s.fail?console.log(s):(console.log(s),g.value.push(n.value.val),n.value={val:null,state:!1},r.loading.hide())},le=async()=>{r.loading.show({message:"Editando Producto"}),console.log(n.value.val),n.value.val._transfer=E.params.oid;const s=await k.editProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value[e].amount=n.value.val.amount,r.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},r.loading.hide())}},oe=async()=>{r.loading.show({message:"Eliminando Producto"}),console.log(n.value.val),n.value.val._transfer=E.params.oid;const s=await k.removeProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value.splice(e,1),r.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},r.loading.hide())}},se=s=>{n.value.state=!0,n.value.val=s},z=()=>{n.value={val:null,state:!1}},ne=async()=>{r.loading.show({message:"Terminando Traspaso"});let s={user:F.session.name,traspaso:m.value,products:g.value};const e=await k.endTransfer(s);e.fail?console.log(e):(r.notify({message:e,position:"center",type:"positive"}),console.log(e),r.loading.hide(),$.push("/transfers"))},ie=()=>{B.value.click()},re=async()=>{let s=document.getElementById("inputFile").files[0],e=new J.Workbook,o=[],l={};e.xlsx.load(s).then(D=>{let w=e.worksheets[0],b=w.getColumn("A");w.getColumn("B"),b.eachCell({includeEmpty:!0},function(_,f){let C=_.value,P=w.getCell(`B${f}`),T=parseFloat(P.value);l[C]?l[C]+=T:l[C]=T});let u=Object.keys(l).map(_=>({codigo:_,cantidad:l[_]}));if(u.forEach(_=>o.push(_.codigo)),o.length){let _={codes:o,_workpoint:F.session.store.id_viz};r.loading.show({message:"Procesando archivo, espera.."}),Ie.getMassive(_).then(f=>{let C=f.data;C.fails.notFound.map(c=>y.value.wndNotExist.push(c)),C.fails.repeat.map(c=>y.value.repeat.push(c));let P=f.data.products;y.value.wndGetRows=P.length,y.value.state=!y.value.state,console.log(P);let T=P.map(c=>{let L=u.find(fe=>fe.codigo===c.code);return{product:c.code,description:c.description,amount:L?L.cantidad:0,_transfer:E.params.oid}});G(T),r.loading.hide()}).catch(f=>{console.log(f),r.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},de=()=>{M.value.click()},ce=async()=>{let s=document.getElementById("inputFilePreventa").files[0],e=new J.Workbook,o=[];e.xlsx.load(s).then(async l=>{let w=e.worksheets[0].getColumn("A");if(r.loading.show({message:"Procesando archivo, espera.."}),w.eachCell({includeEmpty:!0},function(b,u){b.value&&o.push(b.value)}),o.length){let b={codes:o,_workpoint:F.session.store.id_viz};console.log(b);const u=await k.transferPreventa(b);if(u.fail)alert(u);else{x.value.encontrados=u.Encontrados,x.value.faltantes=u.Faltantes,x.value.products=u.products.length,x.value.state=!x.value.state,u.products.forEach(f=>f._transfer=E.params.oid);let _=u.products;console.log(_),G(_),r.loading.hide()}}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},G=async s=>{const e=await k.addProductMasive(s);e.fail?console.log(e):(console.log(e),s.map(o=>{g.value.push(o)}),r.loading.hide())},ue=async()=>{const s=E.params.oid,e=await k.getTransfer(s);if(console.log(e),e.error)console.error("No se logro imprimir la factura");else{const l=new Ae({format:"letter"});let D=[];const w=e.bodie.map(u=>Object.values([u.product,u.description,u.amount]));console.log(typeof e.code_fs);const b=Math.ceil(w.length/20);for(var o=0;o<w.length;o+=20)D.push(w.slice(o,o+20));console.log(D);for(let u=0;u<2;u++){let _="ORIGINAL";u>0&&(_="COPIA",l.addPage()),D.forEach(function(f,C){C>0&&l.addPage();let P=0;for(let c=0;c<f.length;c++)f[c][0]=f[c][0],f[c][1]=f[c][1],f[c][2]=parseFloat(f[c][2]),P+=parseFloat(f[c][2]);for(let c=0;c<f.length;c++);l.setFontSize(25),l.setFont("helvetica","bold"),l.text("GRUPO VIZCARRA",105,10,"center"),l.setFontSize(8),l.setFontSize(12),l.text(_,185,10,"left"),l.text("LLUVIA LIGTH SA DE CV",10,25,"left"),l.setFontSize(8),l.text(e.created_by,10,30,"left"),l.text(e.notes,10,35,"left"),l.text("DELEG, CUAUHTEMOC CDMX",10,40,"left"),l.text("DOCUMENTO",10,55,"left"),l.text("TRASPASO",10,60,"left"),l.text("NUMERO",32,55,"left"),l.text(String(e.code_fs),32,60,"left"),l.text("PAGINA",54,55,"left"),l.text(`${C+1} de ${b}`,54,60,"left"),l.text("FECHA",76,55,"left");const T=Fe(e.created_at).format("YYYY-MM-DD");l.text(T,76,60,"left"),W(l,{startX:10,startY:65,theme:"plain",styles:{cellPadding:1,fontSize:12,halign:"center"},head:[["Almacen de Origen","Almacen de Destino"]],body:[[`(${e.origin.alias}) ${e.origin.name}`,`(${e.destiny.alias}) ${e.destiny.name}`]]}),W(l,{startX:10,startY:80,theme:"striped",styles:{cellPadding:.6,fontSize:8,halign:"center"},head:[["ARTICULO","DESCRIPCION","CANTIDAD"]],body:f,columnStyles:{0:{fontStyle:"bold",halign:"left"},1:{fontStyle:"bold",halign:"left"},4:{halign:"center"}}}),l.setFontSize(11),l.text("TOTAL UNIDDADES:",150,200,"left"),l.text(P.toString(),190,200,"left"),l.text("Firma Almacen Origen",12,224),l.text("Firma Almacen Destino",82,224),l.text("Firma Chofer",152,224),l.rect(10,220,60,40),l.rect(80,220,60,40),l.rect(150,220,60,40)})}l.save(`Traspaso${e.code_fs}`)}};return K(),(s,e)=>m.value?(S(),V(ke,{key:0,padding:""},{default:a(()=>[t(be,{reveal:"",bordered:"",class:"bg-white text-black"},{default:a(()=>[t(we,{class:"justify-between"},{default:a(()=>[t(h,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=o=>H($).push("/transfers")),round:""}),i("div",null,p(m.value.store.name),1),i("div",Qe,[i("div",De,p(m.value.origin.name),1),d(),t(j,{name:"arrow_forward",class:"col"}),i("div",Te,p(m.value.destiny.name),1)]),i("div",null,p(m.value.created_by),1),i("div",null,[d("Traspaso "),t(j,{name:"navigate_next",color:"primary"}),d(),i("span",Ve,p(m.value.code_fs),1)])]),_:1}),t(N),i("div",Ne,p(m.value.notes),1),t(N),i("div",Oe,[i("div",Re,[t(h,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:ie})]),i("div",$e,[t(h,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:de})]),i("div",Ue,[t(h,{color:"primary",icon:"picture_as_pdf",label:"PDF",flat:"",onClick:ue})]),i("input",{type:"file",ref_key:"inputFile",ref:B,id:"inputFile",onInput:re,hidden:"",accept:".xlsx,.xls"},null,544),i("input",{type:"file",ref_key:"inputFilePreventa",ref:M,id:"inputFilePreventa",onInput:ce,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(O,{bordered:""},{default:a(()=>[t(I,null,{default:a(()=>[t(v,null,{default:a(()=>[d(" Producto ")]),_:1}),t(v,null,{default:a(()=>[d(" Descripcion ")]),_:1}),t(v,{class:"text-center"},{default:a(()=>[d(" Cantidad ")]),_:1})]),_:1})]),_:1}),(S(!0),ge(he,null,_e(g.value,(o,l)=>(S(),V(O,{bordered:"",key:l},{default:a(()=>[q((S(),V(I,{clickable:"",onClick:D=>se(o)},{default:a(()=>[t(v,null,{default:a(()=>[d(p(o.product),1)]),_:2},1024),t(v,null,{default:a(()=>[d(p(o.description),1)]),_:2},1024),t(v,{class:"text-center"},{default:a(()=>[d(p(o.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[ye]]),t(N)]),_:2},1024))),128)),t(U,{modelValue:n.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.state=o),persistent:"",position:"bottom"},{default:a(()=>[t(R,{style:{width:"300","max-width":"40vw"}},{default:a(()=>[t(Q,null,{default:a(()=>[i("div",Be,p(n.value.val.product),1),i("div",Me,p(n.value.val.description),1)]),_:1}),t(Q,null,{default:a(()=>[i("div",ze,[i("div",Ge,[Le,i("div",Ye,[t(h,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=o=>n.value.val.amount>1?n.value.val.amount--:"")}),i("div",He,[q(i("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=o=>n.value.val.amount=o),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[xe,n.value.val.amount]])]),t(h,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=o=>n.value.val.amount++)})])])])]),_:1}),H(Z)?(S(),V(X,{key:1,align:"center"},{default:a(()=>[t(h,{flat:"",icon:"close",color:"red-10",onClick:z}),t(h,{flat:"",label:"Eliminar",color:"negative",onClick:oe}),t(h,{flat:"",label:"Editar",color:"blue-10",onClick:le})]),_:1})):(S(),V(X,{key:0,align:"center"},{default:a(()=>[t(h,{flat:"",label:"Cancelar",color:"negative",onClick:z}),t(h,{flat:"",label:"Agregar",color:"positive",onClick:ae})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:y.value.state,"onUpdate:modelValue":e[5]||(e[5]=o=>y.value.state=o)},{default:a(()=>[t(R,null,{default:a(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:a(()=>[d(" Resultados de la importacion :O ")]),_:1}),t(Q,null,{default:a(()=>[t(O,{bordered:""},{default:a(()=>[t(I,null,{default:a(()=>[t(v,null,{default:a(()=>[d("Productos Encontrados")]),_:1}),t(v,null,{default:a(()=>[d(p(y.value.wndGetRows),1)]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(v,null,{default:a(()=>[d("Productos Sin Datos")]),_:1}),t(v,null,{default:a(()=>[d(p(y.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:x.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>x.value.state=o)},{default:a(()=>[t(R,null,{default:a(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:a(()=>[d(" Resultados de la importacion :O ")]),_:1}),t(Q,null,{default:a(()=>[t(O,{bordered:""},{default:a(()=>[t(I,null,{default:a(()=>[t(v,null,{default:a(()=>[d("Pedidos Encontrados")]),_:1}),t(v,null,{default:a(()=>[d(p(x.value.encontrados),1)]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(v,null,{default:a(()=>[d("Pedidos Sin Encontrar")]),_:1}),t(v,null,{default:a(()=>[d(p(x.value.faltantes),1)]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(v,null,{default:a(()=>[d("Productos Encontrados")]),_:1}),t(v,null,{default:a(()=>[d(p(x.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Pe,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:a(()=>[t(R,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:a(()=>[t(Q,{class:"row"},{default:a(()=>[t(Se,{class:"col",checkState:!1,onInput:ee,onAgregar:te}),g.value.length>0?(S(),V(h,{key:0,color:"primary",flat:"",icon:"east",onClick:ne,round:""})):Y("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0)}};export{Ct as default};
