import{d as T,e as O,b as _}from"./QList.ea207491.js";import{u as F,r as h,c as K,o as u,g as x,e,w as t,d as b,al as W,ak as w,b5 as j,I as L,f as o,Q as E,a0 as d,h as g,a1 as H,n as X,a as Y,aH as Z,T as ee,a2 as te,a3 as ae}from"./index.02363dd9.js";import{Q as oe}from"./QToolbar.66faaed8.js";import{Q as se}from"./QHeader.c5fde4f2.js";import{Q as y}from"./QCardSection.ba258aa3.js";import{Q as B}from"./QTd.447f1952.js";import{Q as le}from"./QTr.6693e008.js";import{Q as re}from"./QTable.5d2b8c60.js";import{Q as $}from"./QCard.924173f6.js";import{Q as ie}from"./QFooter.948e9fd4.js";import{Q as ne}from"./QPage.b40fc5ef.js";import{Q as ce,a as de}from"./QLayout.617a1a1e.js";import{Q as ue}from"./QBadge.52ecca5b.js";import{Q as R}from"./QSelect.76925e98.js";import{Q as me}from"./QInput.be783095.js";import{Q as pe}from"./QForm.ef8f153f.js";import{Q as fe}from"./QCardActions.521b46cf.js";import{p as S}from"./productsApi.76607872.js";import{u as U}from"./use-quasar.639e9c5b.js";import{H as ve}from"./html5-qrcode-scanner.64619f17.js";import{_ as _e}from"./UserToolbar.02af40e0.js";import"./QResizeObserver.81e3a39f.js";import"./QLinearProgress.dfee73cb.js";import"./QCheckbox.8a9e6af7.js";import"./QScrollObserver.f92299f2.js";import"./axios.b4ec7ca6.js";import"./_commonjsHelpers.88e99c8f.js";import"./QDrawer.3973601c.js";import"./ClosePopup.7036e7b4.js";import"./auth.f0d456d4.js";const ge={class:"QuickRegular row items-center text-black"},he={class:"col"},xe={key:0},be={class:"row items-center justify-between no-wrap QuickRegular"},ye={class:"col"},we={class:"text-grey-4 q-pl-md"},Qe={class:"text--2 text-grey-5"},ke={key:1},Ce={key:2,class:"flex flex-center q-pa-md"},Se={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},with_locations:{default:null,type:Boolean},with_image:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},with_prices_Invoice:{default:null,type:Boolean},with_stock:{default:null,type:Boolean}},emits:["input","similarcodes","agregar"],setup(I,{emit:Q}){U();const i=F(),v=I,P=Q;let m=null;const f=h(!1),l=h(!1),n=h({val:{id:1,label:"Autocomplete",icon:"keyboard"},opts:[{id:1,label:"Autocomplete",icon:"keyboard"},{id:2,label:"barcode",icon:"fas fa-barcode"},{id:3,label:"qr_code",icon:"qr_code"}]}),a=h({buscar:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),k=K(()=>({search:a.value.buscar,with_locations:v.with_locations,with_stock:v.with_stock,with_prices:v.with_prices,limit:v.limit,_workpoint:i.session.store.id_viz,rol:i.session.credentials.rol})),z=()=>{switch(a.value.iptsearch.type){case"text":a.value.iptsearch.type="number",a.value.iptsearch.icon="fas fa-font";break;case"number":a.value.iptsearch.type="text",a.value.iptsearch.icon="fas fa-hashtag";break}},M=async(c,r,s)=>{let p=c.trim().toUpperCase();if(p.length>=3){a.value.buscar=p,console.log(k.value);const C=await S.autoCompleteProduct(k.value);if(C.fail)console.log(C);else{console.log(C);let G=C;r(()=>{a.value.options=G},N=>{N.setOptionIndex(-1),N.moveOptionSelection(1,!0)})}}},D=async()=>{if(a.value.buscar.trim().toUpperCase(),a.value.buscar.length){const c=await S.exactSearch(k.value);c.fail?console.log(c):(console.log(c),V(c))}},A=async()=>{if(m){console.log("La c\xE1mara ya est\xE1 activa");return}f.value=!0,X(()=>{m=new ve("reader");const c={fps:10,qrbox:r=>{const p=Math.floor(r*.8);return{width:p,height:p}}};m.start({facingMode:"environment"},c,async r=>{if(!l.value){l.value=!0;try{const s=JSON.parse(r);if(console.log(s),s.modelo){a.value.buscar=s.modelo;const p=await S.scanSearch(k.value);p.fail?console.log(p):(console.log(p),q(),V(p))}}catch{console.log("QR inv\xE1lido: "+r)}finally{l.value=!1}}}).catch(r=>console.log("Error al iniciar c\xE1mara: "+r.message)),console.log("C\xE1mara iniciada")})},q=()=>{if(!m){console.log("La c\xE1mara no estaba activa");return}m.stop().then(()=>{m.clear(),m=null,f.value=!1,console.log("C\xE1mara detenida")}).catch(c=>console.log("Error al detener c\xE1mara: "+c.message))},V=c=>{a.value.buscar="",P("input",c)},J=(c,r)=>{c.id==3?A():q()};return(c,r)=>(u(),x("div",ge,[e(R,{modelValue:n.value.val,"onUpdate:modelValue":[r[0]||(r[0]=s=>n.value.val=s),J],class:"flex items-center justify-center","options-dense":"",options:n.value.opts,filled:"",style:{width:"60px"},"hide-dropdown-icon":""},{selected:t(()=>[n.value.val?(u(),b(W,{key:0,size:"xl","text-color":"primary",class:"text-left flex items-left justify-left",icon:n.value.val.icon},null,8,["icon"])):(u(),b(ue,{key:1},{default:t(()=>r[3]||(r[3]=[w("*no hay :{*")])),_:1}))]),option:t(s=>[e(T,j(s.itemProps,{class:"flex items-center justify-center"}),{default:t(()=>[e(O,{avatar:"",class:"text-center"},{default:t(()=>[e(L,{name:s.opt.icon},null,8,["name"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"]),o("div",he,[n.value.val.id==1?(u(),x("div",xe,[e(R,{modelValue:a.value.buscar,"onUpdate:modelValue":r[1]||(r[1]=s=>a.value.buscar=s),"hide-selected":"",behavior:"menu",options:a.value.options,filled:"","hide-dropdown-icon":"","use-input":"",class:"text-uppercase","input-class":"text-h6 text-bold",onFilter:M,"input-debounce":400,autofocus:""},{prepend:t(()=>[e(E,{size:"md",flat:"",padding:"none",onClick:z,icon:a.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:t(s=>[e(T,j(s.itemProps,{onClick:p=>V(s.opt)}),{default:t(()=>[e(O,null,{default:t(()=>[o("div",be,[o("div",ye,[o("div",null,[w(d(s.opt.code)+" ",1),o("span",we,d(s.opt.name),1)]),o("div",Qe,d(s.opt.description),1)])])]),_:2},1024)]),_:2},1040,["onClick"])]),_:1},8,["modelValue","options"])])):g("",!0),n.value.val.id==2?(u(),x("div",ke,[e(pe,{onSubmit:D,class:"q-gutter-md"},{default:t(()=>[e(me,{modelValue:a.value.buscar,"onUpdate:modelValue":r[2]||(r[2]=s=>a.value.buscar=s),type:"text",filled:"",class:"text-uppercase","input-class":"text-h6 text-bold",autofocus:""},null,8,["modelValue"])]),_:1})])):g("",!0),n.value.val.id==3?(u(),x("div",Ce,[e($,{class:"camera-card"},{default:t(()=>[H(m)?g("",!0):(u(),b(y,{key:0,class:"flex flex-center"},{default:t(()=>r[4]||(r[4]=[o("div",{id:"reader",class:"qr-reader"},null,-1)])),_:1})),H(m)?g("",!0):(u(),b(fe,{key:1},{default:t(()=>[e(E,{color:"primary",flat:"",icon:"refresh",label:"Buscar",onClick:A})]),_:1}))]),_:1})])):g("",!0)])]))}};const Pe={class:"col"},Ve={class:"row justify-center"},Be={class:"row"},$e={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},Ie={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},Ae={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},qe={class:"row"},Ne={class:"text-h6 col text-bold text-left"},Te={class:"col text-bold text-center"},Oe={class:"text-h6 col text-bold text-right"},je={class:"text-subtitle2 col"},Ee={class:"text-weight-bold"},He={class:"text-bold text-blue-13"},Re={class:"row q-ml-sm"},gt={__name:"getProduct",setup(I){F();const Q=U();Y(),Z();const i=h(null),v=h({columns:[{name:"anio",label:"A\xD1O",field:"year",align:"center"},{name:"sales",label:"COMPRAS",field:"compras",align:"center"},{name:"purchases",label:"VENTAS",field:"ventas",align:"center"}]}),P=f=>{console.log(f),m(f.id)},m=async f=>{Q.loading.show({message:"Obteniendo Datos"}),i.value=null,console.log(f);const l=await S.getProduct(f);l.fail?console.log(l):(Q.loading.hide(),console.log(l),l.prices.push({id:8,alias:"COS",pivot:{price:l.cost}}),l.prices.sort((n,a)=>a.id-n.id),i.value=l)};return(f,l)=>(u(),b(ce,{view:"hHh Lpr fFf"},{default:t(()=>[e(se,{class:"bg-grey-3 text-dark",bordered:""},{default:t(()=>[e(_e),e(_),e(oe,{class:"justify-between row"},{default:t(()=>[o("div",Pe,[l[0]||(l[0]=o("span",{class:"text-grey"},"Helpers",-1)),e(L,{name:"navigate_next",color:"primary"}),l[1]||(l[1]=o("span",{class:"text-h6"},"Informaci\xF3n Producto",-1))])]),_:1})]),_:1}),e(de,null,{default:t(()=>[e(ne,{padding:""},{default:t(()=>[o("div",Ve,[e(ee,{name:"bounce"},{default:t(()=>[i.value?(u(),b($,{key:0,class:"my-card"},{default:t(()=>[e(y,{class:"item-center"},{default:t(()=>[o("div",Be,[o("div",$e,d(i.value.category.familia.seccion.name),1),o("div",Ie,d(i.value.category.familia.name),1),o("div",Ae,d(i.value.category.name),1)])]),_:1}),e(y,{class:"item-center"},{default:t(()=>[o("div",qe,[o("div",Ne,d(i.value.code),1),o("div",Te,[l[2]||(l[2]=o("div",{class:"text-caption"},"Stock",-1)),o("div",null,d(i.value.total_stock),1)]),o("div",Oe,d(i.value.name),1)]),o("div",je,d(i.value.description),1)]),_:1}),e(y,{class:"item-center row"},{default:t(()=>[(u(!0),x(ae,null,te(i.value.prices,(n,a)=>(u(),x("div",{class:"col text-subtitle2 text-center",key:a},[o("div",Ee,d(n.alias),1),e(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",He,d(n.pivot.price),1),e(_,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),e(y,null,{default:t(()=>[e(re,{rows:i.value.details,hideBottom:"",columns:v.value.columns,pagination:{rowsPerPage:0}},{"bottom-row":t(()=>[e(le,{class:"text-bold bg-yellow-12"},{default:t(()=>[e(B,{class:"text-center"},{default:t(()=>l[3]||(l[3]=[w(" Total ")])),_:1}),e(B,{class:"text-center"},{default:t(()=>[w(d(i.value.details.reduce((n,a)=>n+Number(a.compras),0)),1)]),_:1}),e(B,{class:"text-center"},{default:t(()=>[w(d(i.value.details.reduce((n,a)=>n+Number(a.ventas),0)),1)]),_:1})]),_:1})]),_:1},8,["rows","columns"])]),_:1})]),_:1})):g("",!0)]),_:1})]),e(ie,{reveal:"",elevated:"",bordered:""},{default:t(()=>[e(_,{spaced:"",inset:"",vertical:"",dark:""}),o("div",Re,[e($,{class:"col"},{default:t(()=>[e(Se,{checkState:!1,onInput:P,with_prices_Invoice:"",with_stock:"",with_locations:""})]),_:1}),e(_,{spaced:"",inset:"",vertical:"",dark:""})]),e(_,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{gt as default};
