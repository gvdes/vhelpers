import{l as be,ak as ye,am as Ce,c as ee,s as ke,t as we,v as xe,r as S,o as m,i as q,_ as R,Z,e as o,ab as w,g as p,j as x,br as ce,a as de,u as ue,w as s,f as E,ad as $,W as O,X as U,h as le,Q as P,d as k,k as h,$ as K,a0 as Ve,Y as fe,q as he,J as Qe,O as Se,bs as Ue,a1 as $e}from"./index.dd686a55.js";import{Q as De}from"./QHeader.b4c0db3c.js";import{Q as ne}from"./QDate.314de5ab.js";import{Q as _,d as se}from"./QSelect.2d5192a4.js";import{Q as Pe}from"./QToolbar.928fb148.js";import{Q as Be}from"./QSpace.dd333464.js";import{Q as W}from"./QTooltip.ca3a93f4.js";import{Q as Ee,a as qe}from"./QLayout.baaf34f7.js";import{u as me}from"./use-quasar.e03d6c21.js";import{d as pe}from"./dayjs.min.cbcf888d.js";import{_ as ze}from"./UserToolbar.da8f9841.js";import{C as I}from"./cicsdb.834233b1.js";import{Q as X,a as ie}from"./QTable.c61bdc8e.js";import{Q as Ie}from"./QExpansionItem.0221bb27.js";import{Q as ae}from"./QTr.76e3166b.js";import{Q as re}from"./QTd.7781ffaf.js";import{Q as _e}from"./QFooter.48bc036b.js";import{C as Me}from"./ClosePopup.e406de66.js";import{P as Ne}from"./ProductsAutocomplete.fa4132e9.js";import{c as ge}from"./cyclecountStore.7c2b6c1f.js";import"./axios.b899aa11.js";import{E as Oe}from"./exceljs.min.9e24d01d.js";import"./QList.f45618d9.js";import"./QPage.a81cb91b.js";import"./OrderStore.6ff7ac97.js";import"./QDrawer.cafc259d.js";import{$sktCounters as C}from"./socket.168d2ba4.js";import{r as je}from"./reports.6445cc7c.js";import"./QResizeObserver.721f2004.js";import"./use-render-cache.3aae9b27.js";import"./date.a00cfe2d.js";import"./QScrollObserver.301e4a23.js";import"./_commonjsHelpers.88e99c8f.js";import"./auth.1a8a73b2.js";import"./QLinearProgress.9a913c44.js";/* empty css                                                                         */var Ae=be({name:"QBar",props:{...ye,dense:Boolean},setup(r,{slots:v}){const{proxy:{$q:u}}=xe(),g=Ce(r,u),c=ee(()=>`q-bar row no-wrap items-center q-bar--${r.dense===!0?"dense":"standard"}  q-bar--${g.value===!0?"dark":"light"}`);return()=>ke("div",{class:c.value,role:"toolbar"},we(v.default))}});const Fe={class:"text-right"},Le={__name:"Locations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(r,{emit:v}){const u=r,g=v,c=i=>u.sections.filter(b=>b.root===i),f=S([{options:u.sections.filter(i=>i.root===0),selected:null}]),V=(i,b)=>{const y=i[i.length-1];f.value.splice(b+1);const Q=c(y);Q.length&&f.value.push({options:Q,selected:[]})},D=()=>{const i=f.value.filter(y=>y.selected.length>0),b=i[i.length-1];g("obtProducts",b)};return(i,b)=>(m(),q("div",null,[(m(!0),q(R,null,Z(f.value,(y,Q)=>(m(),q("div",{key:Q},[o(_,{class:"col",modelValue:y.selected,"onUpdate:modelValue":[z=>y.selected=z,z=>V(z,Q)],options:y.options,label:`Nivel ${Q+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",multiple:"","use-chips":""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(w,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),p("div",Fe,[o(x,{flat:"",icon:"send",disable:!f.value[0].selected,onClick:D},null,8,["disable"])])]))}},Te={class:"col"},Ye={class:"text-bold"},Re={class:"text-bold"},Ge={class:"row"},He={class:"col"},Je={class:"col"},We={key:0,class:"row"},Xe={__name:"Create",props:{config:{default:{},type:Object}},emits:["create"],setup(r,{emit:v}){const u=me();ce(),de();const g=ue(),c=ge(),f=S(null),V=S(null),D=v,i=r,b=S({team:!1,selectSection:!1}),y=S({columns:[{name:"name",label:"Nombre",field:n=>{var e;return(e=n.staff)==null?void 0:e.complete_name},align:"left"}],filter:null}),Q=S({columns:[{name:"code",label:"Codigo",field:n=>n.code,align:"left"},{name:"description",label:"Descripcion",field:n=>n.description,align:"left"},{name:"locationExh",label:"Exhibicion",field:n=>{var e,t;return(t=(e=n.locations)==null?void 0:e.filter(d=>d.celler._type==2))==null?void 0:t.map(d=>d.path).join("/")},align:"left"},{name:"locationGen",label:"General",field:n=>{var e,t;return(t=(e=n.locations)==null?void 0:e.filter(d=>d.celler._type==1))==null?void 0:t.map(d=>d.path).join("/")},align:"left"}],filter:null}),z=ee(()=>i.config.type.val&&i.config.option.val&&i.config.notes&&i.config.resexh.length>0&&i.config.resgen.length>0&&i.config.products.length>0),j=(n,e)=>{const t=e.toUpperCase();return n.filter(d=>{var H,M;const oe=Object.values(d).some(B=>String(B!=null?B:"").toUpperCase().includes(t)),te=(M=(H=d.staff)==null?void 0:H.complete_name.toUpperCase().includes(t))!=null?M:!1;return oe||te})},G=n=>{n.id==1||n.id==2?b.value.selectSection=!0:n.id==4&&(console.log("abrir el de la exportacion"),V.value.click())},A=n=>{console.log(n),i.config.products.findIndex(t=>t.id==n.id)>=0?u.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):i.config.products.push(n)},F=n=>{console.log(n),i.config.products.findIndex(t=>t.id==n.id)>=0?u.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):i.config.products.push(n)},L=async()=>{if(i.config.option.val.id==2){u.loading.show({message:"Obteniendo Datos"});let n={workpoint:g.session.store.id_viz,seccion:i.config.section.map(t=>t.id)};console.log(n);const e=await I.obtProductSLocation(n);e.fail?console.log(e):(console.log(e),i.config.products=e,u.loading.hide())}},T=async n=>{u.loading.show({message:"Obteniendo Productos"});let e={ubicacion:n.selected,workpoint:g.session.store.id_viz,seccion:i.config.section.map(d=>d.id)};console.log(e);const t=await I.obtProductSections(e);t.fail?console.log(t):(console.log(t),i.config.products=t,u.loading.hide())},Y=n=>{console.log(n);let e=i.config.products.findIndex(t=>t.id==n.id);e>=0&&i.config.products.splice(e,1)},a=()=>{z.value?D("create"):(i.config.type.val||u.notify({message:"Falta un tipo",type:"warning",position:"left"}),i.config.option.val||u.notify({message:"Falta una opci\xF3n",type:"warning",position:"left"}),i.config.notes||u.notify({message:"Faltan notas",type:"warning",position:"left"}),i.config.resexh.length===0&&u.notify({message:"Falta Responsable exhibici\xF3n",type:"warning",position:"left"}),i.config.resgen.length===0&&u.notify({message:"Falta Responsable general",type:"warning",position:"left"}),i.config.products.length===0&&u.notify({message:"Debe agregar productos",type:"warning",position:"left"}))},l=()=>{var d;let n=(d=document.getElementById("refCreate"))==null?void 0:d.files[0],e=new Oe.Workbook,t={};u.loading.show({message:"Importando Datos"}),e.xlsx.load(n).then(async oe=>{e.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(J,ve){if(ve===1)return;let N=J.value;!N||(t[N]||(t[N]=[]),t[N].includes(location)||t[N].push(location||cantidad))});let M=Object.keys(t).map(J=>({_product:J,_workpoint:g.session.store.id_viz}));console.log(M);const B=await I.addMassiveProductCyclecount(M);B.fail?console.log(B):(console.log(B),i.config.products=B,u.loading.hide())})};return(n,e)=>(m(),q(R,null,[o(P,null,{default:s(()=>[o(E,{class:"row items-center"},{default:s(()=>[p("div",Te,[e[10]||(e[10]=$(" Creacion: ")),p("span",Ye,O(U(pe)().format("YYYY-MM-DD")),1),e[11]||(e[11]=$()),e[12]||(e[12]=p("br",null,null,-1)),e[13]||(e[13]=$(" Creador: ")),p("span",Re,O(U(g).session.credentials.staff.complete_name),1)]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(le,{modelValue:r.config.notes,"onUpdate:modelValue":e[0]||(e[0]=t=>r.config.notes=t),type:"text",label:"Notas"},null,8,["modelValue"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(_,{class:"",modelValue:r.config.type.val,"onUpdate:modelValue":e[1]||(e[1]=t=>r.config.type.val=t),options:r.config.type.opts,label:"Tipo",disable:""},null,8,["modelValue","options"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(_,{class:"col",modelValue:r.config.option.val,"onUpdate:modelValue":[e[2]||(e[2]=t=>r.config.option.val=t),G],options:r.config.option.opts,label:"Seleccion",disable:!!r.config.option.val},null,8,["modelValue","options","disable"])]),_:1})]),_:1}),o(P,{bordered:""},{default:s(()=>[o(E,null,{default:s(()=>[o(Ie,{"expand-separator":"",icon:"fas fa-users",label:"Responsables","header-class":"text-grey-5",modelValue:b.value.team,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value.team=t),caption:`Exh: ${r.config.resexh.length} -- Gen ${r.config.resgen.length}`},{default:s(()=>[o(E,null,{default:s(()=>[o(le,{modelValue:y.value.filter,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value.filter=t),type:"text",label:"Buscar"},null,8,["modelValue"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),p("div",Ge,[p("div",He,[o(X,{selection:"multiple",selected:r.config.resexh,"onUpdate:selected":e[4]||(e[4]=t=>r.config.resexh=t),title:"Ventas",rows:U(c).users.filter(t=>[8,9].includes(t._rol)),columns:y.value.columns,filter:y.value.filter,"filter-method":j},null,8,["selected","rows","columns","filter"])]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),p("div",Je,[o(X,{selection:"multiple",selected:r.config.resgen,"onUpdate:selected":e[5]||(e[5]=t=>r.config.resgen=t),title:"Almacen",rows:U(c).users.filter(t=>[4,24].includes(t._rol)),columns:y.value.columns,filter:y.value.filter,"filter-method":j},null,8,["selected","rows","columns","filter"])])])]),_:1})]),_:1},8,["modelValue","caption"])]),_:1})]),_:1}),o(w,{spaced:"",inset:"",vertical:"",dark:""}),r.config.option.val?(m(),k(P,{key:0,class:"my-card q-ml-md q-mr-md",bordered:""},{default:s(()=>[r.config.option.val.id==1?(m(),q("div",We,[o(_,{class:"col",modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=t=>f.value=t),options:U(c).locations,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),f.value?(m(),k(Le,{key:0,class:"col",sections:f.value.sections,onObtProducts:T},null,8,["sections"])):h("",!0)])):h("",!0)]),_:1})):h("",!0),o(w),r.config.products.length?(m(),k(P,{key:1,class:"my-card",bordered:""},{default:s(()=>[o(E,null,{default:s(()=>[o(X,{rows:r.config.products,columns:Q.value.columns},{header:s(t=>[o(ae,{props:t},{default:s(()=>[(m(!0),q(R,null,Z(t.cols,d=>(m(),k(ie,{key:d.name,props:t},{default:s(()=>[$(O(d.label),1)]),_:2},1032,["props"]))),128)),r.config.option.val.id==3?(m(),k(ie,{key:0,"auto-width":""})):h("",!0)]),_:2},1032,["props"])]),body:s(t=>[o(ae,{props:t},{default:s(()=>[(m(!0),q(R,null,Z(t.cols,d=>(m(),k(re,{key:d.name,props:t},{default:s(()=>[$(O(d.value),1)]),_:2},1032,["props"]))),128)),r.config.option.val.id==3?(m(),k(re,{key:0,"auto-width":""},{default:s(()=>[o(x,{size:"sm",color:"negative",round:"",dense:"",onClick:d=>Y(t.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)):h("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})):h("",!0),r.config.option.val?(m(),k(_e,{key:2},{default:s(()=>[r.config.option.val.id==3?(m(),k(P,{key:0,class:"row"},{default:s(()=>[o(Ne,{class:"col",checkState:!0,onInput:F,onAgregar:A,with_locations_loc:U(g).session.credentials._rol},null,8,["with_locations_loc"]),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(x,{color:"primary",icon:"send",onClick:a})]),_:1})):h("",!0),r.config.option.val.id!=3?(m(),k(P,{key:1},{default:s(()=>[o(x,{class:"full-width",color:"primary",label:"Crear Ciclico :p",onClick:a})]),_:1})):h("",!0)]),_:1})):h("",!0),o(fe,{modelValue:b.value.selectSection,"onUpdate:modelValue":e[9]||(e[9]=t=>b.value.selectSection=t),persistent:""},{default:s(()=>[o(P,{style:{"min-width":"350px"}},{default:s(()=>[o(E,null,{default:s(()=>e[14]||(e[14]=[p("div",{class:"text-h6"},"Selecciona una Seccion",-1)])),_:1}),o(E,{class:"q-pt-none"},{default:s(()=>[o(_,{modelValue:r.config.section,"onUpdate:modelValue":e[8]||(e[8]=t=>r.config.section=t),options:U(c).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"])]),_:1}),o(K,{align:"right",class:"text-primary"},{default:s(()=>[Ve(o(x,{flat:"",onClick:L,icon:"send"},null,512),[[Me]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),p("input",{type:"file",ref_key:"refCreate",ref:V,id:"refCreate",onInput:l,hidden:"",accept:".xlsx,.xls"},null,544)],64))}},Ze={class:"text-h6"},Ke={key:0,class:"row items-center"},Mo={__name:"CiclicosLayout",setup(r){S("");const v=me();ce();const u=de(),g=ue(),c=ge(),f=S({state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"},{id:4,label:"Importacion"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}),V=S(!0),D=S({from:null,to:null}),i=S({sections:[],date:{from:null,to:null}}),b=async()=>{v.loading.show({message:"Cargado vista..."});let a=pe(new Date).format("YYYY/MM/DD");D.value={from:a,to:a};let l={store:g.session.store.id_viz,suc:g.session.store.id,date:D.value};const n=await I.index(l);n.fail?console.log(n):(console.log(n),c.setCyclecount(n.inventories),c.setUsers(n.colab),c.setSections(n.secciones),c.setLocations(n.locations),v.loading.hide())},y=ee(()=>{const a=i.value.date;return a?typeof a=="string"?a.length>0:a.from&&a.to:!1}),Q=()=>{f.value={state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"},{id:4,label:"Importacion"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}},z=async()=>{console.log(f.value),v.loading.show({message:"Creando Ciclicos"}),f.value._account=g.session.credentials.staff.id_va,f.value._workpoint=g.session.store.id_viz;const a=await I.addCyclecount(f.value);a.fail?console.log(a):(console.log(a),a.success&&(a.data.forEach(l=>c.addCyclecount(l.counter)),v.loading.hide(),Q()))},j=async()=>{v.loading.show({message:"Obteniendo Datos..."});let a={store:g.session.store.id_viz,suc:g.session.store.id,date:D.value};const l=await I.index(a);l.fail?console.log(l):(console.log(l),c.setCyclecount(l.inventories),c.setUsers(l.colab),c.setSections(l.secciones),c.setLocations(l.locations),v.loading.hide())},G=async()=>{v.loading.show({message:"Obteniendo Datos..."});let a={store:g.session.store.id_viz,params:i.value};console.log(a);const l=await I.productCyclecount(a);if(l.fail)console.log(l);else{console.log(l);let n="";const e=i.value.date;typeof e=="string"?n=`PSC_${e.replaceAll("/","_")}`:n=`PSC_${e.from.replaceAll("/","_")}_a_${e.to.replaceAll("/","-")}`;let t={key:n,value:l};je.conStockSinContar(t),v.loading.hide()}},A=a=>{console.log(a),v.notify({message:`El usuario ${a.me.names} Se Unio :)`,type:"positive",position:"top"})},F=a=>{console.log(a),c.lock(a.product.id,a)},L=a=>{console.log(a),c.unlock(a.product.id)},T=a=>{console.log(a),c.updateLockedProduct(a.product)},Y=a=>{c.updateCyclecounts(a.counter),v.notify({message:`Termino el conteo ${a.user.me.names}`}),u.push("/ciclicos/counted")};return he(()=>{b(),C.on("connect",()=>{c.socket_user&&C.emit("index",c.socket_user.profile)}),C.connect(),Qe(()=>c.socket_user.profile,a=>{a&&C.connected&&C.emit("index",a)},{immediate:!0}),C.on("joined",A),C.on("counting",F),C.on("cancelcounting",L),C.on("countingconfirmed",T),C.on("endingCounting",Y)}),Se(()=>{C.off("joined",A),C.off("counting",F),C.off("cancelcounting",L),C.off("countingconfirmed",T),C.off("endingCounting",Y)}),b(),(a,l)=>{const n=Ue("router-view");return m(),k(Ee,{view:"hHh Lpr fFf"},{default:s(()=>[o(De,{class:"bg-grey-3 text-dark",bordered:""},{default:s(()=>[o(ze),o(w)]),_:1}),o(qe,null,{default:s(()=>[o(Pe,{class:"justify-between"},{default:s(()=>[p("div",null,[l[7]||(l[7]=p("span",{class:"text-grey"},"Helpers",-1)),l[8]||(l[8]=$()),o($e,{name:"navigate_next",color:"primary"}),l[9]||(l[9]=$()),p("span",Ze,O(U(c).title),1)]),U(c).showBtns?(m(),q("div",Ke,[o(x,{color:"primary",icon:"event",flat:""},{default:s(()=>[o(se,null,{default:s(()=>[o(P,{class:"my-card"},{default:s(()=>[o(E,null,{default:s(()=>[p("div",null,[l[10]||(l[10]=p("div",{class:"q-pb-sm text-center"},null,-1)),o(ne,{modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=e=>D.value=e),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(K,{vertical:"",align:"center"},{default:s(()=>[o(x,{flat:"",label:"Obtener",color:"positive",onClick:j})]),_:1})]),_:1})]),_:1})]),_:1}),o(x,{color:"primary",icon:"add_shopping_cart",dense:"",flat:""},{default:s(()=>[o(se,null,{default:s(()=>[l[12]||(l[12]=p("div",{class:"q-pa-md"},"Productos Sin Conteo",-1)),o(w),o(E,null,{default:s(()=>[o(_,{modelValue:i.value.sections,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.sections=e),options:U(c).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":"",dense:""},null,8,["modelValue","options"]),p("div",null,[l[11]||(l[11]=p("div",{class:"q-pb-sm text-center"},null,-1)),o(ne,{modelValue:i.value.date,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.date=e),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(K,{vertical:"",align:"center"},{default:s(()=>[o(x,{flat:"",label:"Obtener",color:"positive",onClick:G,disable:!i.value.sections.length||!y.value},null,8,["disable"])]),_:1})]),_:1})]),_:1}),o(w,{spaced:"",inset:"",vertical:"",dark:""}),o(x,{color:"primary",icon:"add",outline:"",onClick:l[3]||(l[3]=e=>f.value.state=!f.value.state)})])):h("",!0)]),_:1}),o(fe,{modelValue:f.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value.state=e),persistent:"",maximized:V.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:s(()=>[o(P,null,{default:s(()=>[o(Ae,null,{default:s(()=>[l[16]||(l[16]=p("div",{class:"text-center text-h6"},"Nuevo Inventario",-1)),o(Be),o(x,{dense:"",flat:"",icon:"minimize",onClick:l[4]||(l[4]=e=>V.value=!1),disable:!V.value},{default:s(()=>[V.value?(m(),k(W,{key:0},{default:s(()=>l[13]||(l[13]=[$("Minimize")])),_:1})):h("",!0)]),_:1},8,["disable"]),o(x,{dense:"",flat:"",icon:"crop_square",onClick:l[5]||(l[5]=e=>V.value=!0),disable:V.value},{default:s(()=>[V.value?h("",!0):(m(),k(W,{key:0},{default:s(()=>l[14]||(l[14]=[$("Maximize")])),_:1}))]),_:1},8,["disable"]),o(x,{dense:"",flat:"",icon:"close",onClick:Q},{default:s(()=>[o(W,null,{default:s(()=>l[15]||(l[15]=[$("Close")])),_:1})]),_:1})]),_:1}),o(Xe,{config:f.value,onCreate:z},null,8,["config"])]),_:1})]),_:1},8,["modelValue","maximized"]),o(n)]),_:1})]),_:1})}}};export{Mo as default};
