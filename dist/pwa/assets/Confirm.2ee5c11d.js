import{Q as N}from"./QSpace.a4997056.js";import{r as f,c as z,o as h,a as Q,w as s,e as o,b1 as $,Y as V,aE as E,Q as y,i,a4 as r,a5 as M,f as j,a3 as P}from"./index.d6535de1.js";import{Q as C}from"./QSelect.6babb7a7.js";import{Q as k}from"./QSeparator.970ad44f.js";import{Q as W}from"./QInput.ae6dc5c4.js";import{Q as J,a as c}from"./QTr.ae457c7e.js";import{d as S,Q as G}from"./deposits.3eabd268.js";import{Q as H}from"./QTable.de8ccdc4.js";import{Q as U,a as x}from"./QCard.eab9b540.js";import{Q as B}from"./QDialog.5e34c3f3.js";import{Q as K}from"./QDate.502a4650.js";import{Q as X}from"./QCardActions.60a5f8a8.js";import{Q as Z}from"./QPage.4498dc94.js";import{u as ee}from"./VDB.6b3d0108.js";import"./ClosePopup.1d106147.js";import{u as te}from"./use-quasar.505fcb9f.js";import{d as oe}from"./dayjs.min.25545ff6.js";import"./jspdf.plugin.autotable.c08a6e5a.js";import{E as le}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{$socket as w}from"./socket.bffa0769.js";import"./use-key-composition.3e547522.js";import"./uid.42677368.js";import"./QItemSection.db0401dc.js";import"./position-engine.3b6f86a4.js";import"./rtl.b51694b1.js";import"./axios.d0e8637f.js";import"./axios.f1f32898.js";import"./QList.bed8137d.js";import"./QLinearProgress.79a1d568.js";import"./QCheckbox.c4301fab.js";import"./use-cache.b0833c75.js";import"./date.90c38258.js";import"./_commonjsHelpers.88e99c8f.js";const ae=i("div",{class:"col-2 q-table__title q-mr-xl"},"Depositos",-1),se={class:"text-bold text-left"},ie={class:"text-bold text-center"},ne={class:"text-bold text-center"},re={class:"text-bold text-center"},de={class:"text-bold text-center"},ce={class:"text-bold text-left"},ue={class:"text-bold text-center"},me={class:"text-bold text-center"},pe={class:"text-bold text-left"},ve=["src"],fe={class:"text-h6"},ge={class:"text-subtitle2"},be={class:"q-pa-md"},_e=i("div",{class:"q-pb-sm"},null,-1),et={__name:"Confirm",setup(ye){const T=ee(),u=te();w.connect(),w.on("List",e=>{console.log(e),m.value.push(e)}),w.on("ChangeTicket",e=>{let l=m.value.findIndex(t=>t.id==e.id);l>=0&&(m.value[l].ticket=e.ticket,u.notify({message:`El deposito de $ ${e.import} se agrego el ticket ${e.ticket}`,type:"positive",position:"center"}))});const p=f({state:!1,val:null}),n=f({val:{id:1,name:"Pendiente"},opts:[]}),A=["yellow-11","green-11","red-11"],v=f(!1),g=f(null),d=f({val:null,opts:[]}),m=f([]),b=f({columns:[{name:"id",label:"Id",align:"center",field:e=>e.id},{name:"created",label:"Creado por",align:"center",field:e=>e.send_by},{name:"store",label:"Sucursal",align:"center",field:e=>e.store.name},{name:"origin",label:"Origen",align:"center",field:e=>e.origin},{name:"destiny",label:"Destino",align:"center",field:e=>e.destiny},{name:"concept",label:"Concepto",align:"left",field:e=>e.concept},{name:"reference",label:"Referencia / Folio",align:"center",field:e=>e.refernce},{name:"amount",label:"Importe",align:"center",field:e=>e.amount},{name:"status",label:"Estado",align:"left",field:e=>e.status.name},{name:"ticket",label:"Ticket",align:"center",field:e=>e.ticket},{name:"picture",label:"Foto",align:"center",field:e=>e.picture}],filter:""}),D=z(()=>d.value.val&&n.value.val?m.value.filter(e=>e._store==d.value.val.id&&e._status==n.value.val.id):d.value.val&&!n.value.val?m.value.filter(e=>e._store==d.value.val.id):!d.value.val&&n.value.val?m.value.filter(e=>e._status==n.value.val.id):m.value),F=async()=>{let e=new Date,l=oe(e).format("YYYY/MM/DD");g.value=l,console.log(l),u.loading.show({message:"Obteniendo Datos"}),u.loading.show({message:"Obteniendo Datos"});const t=await S.getForm({filt:g.value});t.fail?console.log(t):(console.log(t),u.loading.hide(),m.value=t.deposit,n.value.opts=t.status,d.value.opts=t.stores)},I=e=>{p.value.val=e,p.value.state=!0},q=async e=>{u.loading.show({message:"Cambiando estado"});let l={id:e.id,status:e.status.id};console.log(l);const t=await S.changeStatus(l);console.log(t),t.fail?console.log(t):(u.loading.hide(),e._status=e.status.id,w.emit("ChangeStatus",t),u.notify({message:"Se cambio de estado",type:"positive"}))},O=async()=>{console.log(g.value),u.loading.show({message:"Obteniendo Datos"});const e=await S.getForm({filt:g.value});e.fail?console.log(e):(console.log(e),u.loading.hide(),m.value=e.deposit,v.value=!1)},R=async()=>{const e=new le.Workbook,l=e.addWorksheet("Comparativo");l.addRow(b.value.columns.map(a=>a.label)),D.value.forEach(async a=>{l.addRow([a.id,a.send_by,a.store.name,a.origin,a.destiny,a.concept,a.refernce,a.amount,a.status.name,a.ticket,`http://192.168.10.160:1920/Assist/public/storage/${a.picture}`])}),(async()=>{const a=await e.xlsx.writeBuffer(),Y=new Blob([a],{type:"application/octet-stream"}),L=URL.createObjectURL(Y),_=document.createElement("a");_.href=L,_.download=`Comparativo${T.session.store.alias}.xlsx`,document.body.appendChild(_),_.click(),document.body.removeChild(_)})()};return F(),(e,l)=>(h(),Q(Z,{padding:""},{default:s(()=>[o(H,{title:"Depositos",rows:j(D),"row-key":"id","rows-per-page-options":[0],separator:"cell",columns:b.value.columns,filter:b.value.filter},{top:s(t=>[ae,o(N),o(C,{modelValue:d.value.val,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.val=a),options:d.value.opts,label:"Sucursal","option-label":"name",filled:"",style:{width:"200px"}},$({_:2},[d.value.val?{name:"append",fn:s(()=>[o(V,{name:"cancel",onClick:l[0]||(l[0]=E(a=>d.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),o(k,{spaced:"",inset:"",vertical:""}),o(C,{modelValue:n.value.val,"onUpdate:modelValue":l[3]||(l[3]=a=>n.value.val=a),options:n.value.opts,label:"Estado","option-label":"name",filled:"",style:{width:"200px"}},$({_:2},[n.value.val?{name:"append",fn:s(()=>[o(V,{name:"cancel",onClick:l[2]||(l[2]=E(a=>n.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),o(k,{spaced:"",inset:"",vertical:""}),o(y,{color:"primary",icon:"event",onClick:l[4]||(l[4]=a=>v.value=!v.value),flat:"",round:""}),o(k,{spaced:"",inset:"",vertical:""}),o(y,{color:"primary",icon:"download",onClick:R,flat:"",round:""}),o(k,{spaced:"",inset:"",vertical:""}),o(W,{borderless:"",dense:"",debounce:"300",modelValue:b.value.filter,"onUpdate:modelValue":l[5]||(l[5]=a=>b.value.filter=a),placeholder:"Search"},{append:s(()=>[o(V,{name:"search"})]),_:1},8,["modelValue"])]),body:s(t=>[o(J,{props:t},{default:s(()=>[o(c,{key:"id",props:t},{default:s(()=>[i("div",se,r(t.row.id),1)]),_:2},1032,["props"]),o(c,{key:"created",props:t},{default:s(()=>[i("div",ie,r(t.row.send_by),1)]),_:2},1032,["props"]),o(c,{key:"store",props:t},{default:s(()=>[i("div",ne,r(t.row.store.name),1)]),_:2},1032,["props"]),o(c,{key:"origin",props:t},{default:s(()=>[i("div",re,r(t.row.origin),1)]),_:2},1032,["props"]),o(c,{key:"destiny",props:t},{default:s(()=>[i("div",de,r(t.row.destiny),1)]),_:2},1032,["props"]),o(c,{key:"concept",props:t},{default:s(()=>[i("div",ce,r(t.row.concept),1)]),_:2},1032,["props"]),o(c,{key:"reference",props:t},{default:s(()=>[i("div",ue,r(t.row.refernce),1)]),_:2},1032,["props"]),o(c,{key:"amount",props:t},{default:s(()=>[i("div",me,"$ "+r(Number(t.row.import).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),_:2},1032,["props"]),o(c,{key:"status",props:t},{default:s(()=>[o(C,{"bg-color":A[t.row.status.id-1],modelValue:t.row.status,"onUpdate:modelValue":[a=>t.row.status=a,a=>q(t.row)],options:n.value.opts,label:"Estado",filled:"","option-label":"name",dense:""},null,8,["bg-color","modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"]),o(c,{key:"ticket",props:t},{default:s(()=>[i("div",pe,r(t.row.ticket),1)]),_:2},1032,["props"]),o(c,{key:"picture",props:t,onClick:a=>I(t.row)},{default:s(()=>[t.row.picture!=null?(h(),Q(G,{key:0,src:`http://192.168.10.160:1920/Assist/public/storage/${t.row.picture}`,ratio:1.7,"spinner-color":"primary","spinner-size":"20px",style:{width:"100px"}},null,8,["src","ratio"])):(h(),Q(M,{key:1,rounded:"",size:"100px","font-size":"52px",color:"white","text-color":"primary",icon:"close"}))]),_:2},1032,["props","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),o(B,{modelValue:p.value.state,"onUpdate:modelValue":l[6]||(l[6]=t=>p.value.state=t)},{default:s(()=>[o(U,{class:"my-card"},{default:s(()=>[i("img",{src:`http://192.168.10.160:1920/Assist/public/storage/${p.value.val.picture}`},null,8,ve),o(x,null,{default:s(()=>[i("div",fe,"Creado: "+r(p.value.val.send_by),1),i("div",ge,"Estado: "+r(p.value.val.status.name),1)]),_:1}),o(x,null,{default:s(()=>[P(r(p.value.val.concept),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(B,{modelValue:v.value,"onUpdate:modelValue":l[9]||(l[9]=t=>v.value=t)},{default:s(()=>[o(U,{class:"my-card"},{default:s(()=>[o(x,null,{default:s(()=>[i("div",be,[_e,o(K,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=t=>g.value=t),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(x,null,{default:s(()=>[o(X,{align:"right"},{default:s(()=>[o(y,{flat:"",icon:"close",color:"negative",onClick:l[8]||(l[8]=t=>v.value=!v.value)}),o(y,{flat:"",icon:"check",color:"positive",onClick:O})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{et as default};
