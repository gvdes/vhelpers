import{a as z,d as F,e as d,b as B,Q as K}from"./QList.6eadd021.js";import{Q as J}from"./QHeader.dcdccaf7.js";import{u as H,r as p,c as q,S as W,o as m,d as V,w as l,e,ak as r,a0 as f,h as x,Q as I,f as n,aF as X,aG as Y,g as h,a3 as N,a as Z,I as ee,a1 as le,T as ae}from"./index.41673bde.js";import{Q as G,a as P,d as te}from"./QSelect.4caaa115.js";import{Q as U}from"./QInput.af481172.js";import{Q as O}from"./QForm.ad984b89.js";import{Q as oe}from"./QToolbar.624c85e5.js";import{Q as se}from"./QPage.00d8b7d4.js";import{Q as ne,a as ue}from"./QLayout.ac4e7fc0.js";import{_ as ie}from"./UserToolbar.8f82f530.js";import{a as re,b as L}from"./axios.71442fda.js";import{u as de}from"./use-quasar.e6a885ef.js";import{Q as pe}from"./QCardActions.0176ae37.js";import{Q as R}from"./QCard.2b05cd0d.js";import{Q as M}from"./QCardSection.3c63fbe4.js";import"./QResizeObserver.ec80bccb.js";import"./QScrollObserver.2d1295a1.js";import"./QDrawer.81ecd829.js";import"./ClosePopup.4fc62d02.js";import"./auth.5a938a17.js";const me={__name:"Ticket",props:{data:{type:Object,default:null}},emits:["openCashDesk"],setup(S,{emit:_}){const v=S,w=H(),$=_,s=p(v.data),u=p(null),y=["6%","8%","16%"],k={"6%":.06,"8%":.08,"16%":.16},b=p({body:null,val:null}),c=p(v.data.total),t=q(()=>{if(u.value&&s.value){let D=k[u.value],a=parseFloat(c.value).toFixed(2);return parseFloat((a*D).toFixed(2))}return 0}),i=q(()=>c.value>v.data.total),A=()=>{$("openCashDesk",{_inc:t.value,_iva:k[u.value],impresora:b.value.val.ip_address,_monto:c.value}),console.log(c.value)};return W(()=>{console.log("El componente ha muerto!!")}),(async()=>{let D=w.session.store.id;console.log(D);try{let a=await re.get(`/cashier/getPrinters/${D}`);a.status==200&&(b.value.body=a.data,console.log("Impresoras listas :)"))}catch(a){console.log(a),$q.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}})(),(D,a)=>(m(),V(R,{style:{"min-width":"400px"},flat:"",bordered:""},{default:l(()=>[e(z,{bordered:""},{default:l(()=>[e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[3]||(a[3]=[r("Ticket")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.ticket),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[4]||(a[4]=[r("Cliente")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.cliente),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[5]||(a[5]=[r("Fecha")])),_:1}),e(d,null,{default:l(()=>[r(f(s.value.fecha),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[6]||(a[6]=[r("Total")])),_:1}),e(d,null,{default:l(()=>[r("$ "+f(s.value.total),1)]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[7]||(a[7]=[r("Impresora")])),_:1}),e(d,null,{default:l(()=>[e(G,{dense:"",modelValue:b.value.val,"onUpdate:modelValue":a[0]||(a[0]=o=>b.value.val=o),options:b.value.body,label:"Impresora","option-label":"name",filled:"",autofocus:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(B),e(F,null,{default:l(()=>[e(d,null,{default:l(()=>a[8]||(a[8]=[r("Monto")])),_:1}),e(d,null,{default:l(()=>[e(U,{dense:"",modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value=o),type:"number",label:"Monto",filled:"",autofocus:"","error-message":"El Monto a facturar es mayor que el total de el ticket :x",error:i.value},null,8,["modelValue","error"])]),_:1})]),_:1}),e(B),b.value.val&&!i.value?(m(),V(F,{key:0,class:"bg-deep-purple-1"},{default:l(()=>[e(d,null,{default:l(()=>a[9]||(a[9]=[r("IVA")])),_:1}),e(d,null,{default:l(()=>[e(G,{dense:"",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value=o),options:y,label:"Seleccione",filled:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})):x("",!0),t.value&&!i.value?(m(),V(F,{key:1,class:"bg-deep-purple-1"},{default:l(()=>[e(d,null,{default:l(()=>a[10]||(a[10]=[r("Total")])),_:1}),e(d,null,{default:l(()=>[e(P,{class:"fc-bluegrey text-h4 fw-sbold"},{default:l(()=>[r("$ "+f(t.value),1)]),_:1}),e(P,{caption:""},{default:l(()=>[r("$ "+f((parseFloat(s.value.total)+parseFloat(t.value)).toFixed(2)),1)]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1}),u.value&&!i.value?(m(),V(pe,{key:0,align:"between"},{default:l(()=>[e(I,{color:"primary",label:"Cancelar",flat:"","no-caps":""}),e(I,{color:"primary",label:"Cobrar",onClick:A})]),_:1})):x("",!0)]),_:1}))}},ve={class:"bg-primary row items-center justify-between q-pa-md text-white"},ce={class:"text-h4"},fe={class:"text-right"},ye={class:"fw-bold text-h4"},be={class:"row items-center"},ge={class:"row"},_e={class:"bg-grey-2 row items-stretch justify-between q-pa-sm"},ke={class:"text-h5 fw-sbold fc-primary"},Ve={class:"text-h6 fs-inc3 fw-bold fc-negative"},Qe={__name:"CashDesk",props:{data:{type:Object,default:null},inc:{type:Number,default:0}},emits:["pay"],setup(S,{emit:_}){const v=[{id:"TBA",desc:"Tarjeta Credito/Debito BBVA (Bancomer)"},{id:"TDB",desc:"Transferencia/Deposito BBVA (Bancomer)"},{id:"TSA",desc:"Tarjeta Credito/Debito Santander"},{id:"TDA",desc:"Transferencia/Deposito Santander"}],w=S,$=_,s=p({EFE:0,DIG:{id:null,val:0}}),u=p(w.data),y=p(w.inc),k=q(()=>(parseFloat(s.value.EFE)+parseFloat(s.value.DIG.val)).toFixed(2)),b=()=>{$("pay",s.value)};return(c,t)=>u.value?(m(),V(R,{key:0},{default:l(()=>[n("div",ve,[n("div",null,[t[5]||(t[5]=n("div",{class:"fs-dec3"},"TICKET",-1)),n("div",ce,f(u.value.ticket),1)]),n("div",fe,[t[6]||(t[6]=n("div",{class:"fs-dec3"},"IVA",-1)),n("div",ye,"$ "+f(y.value),1)])]),e(O,{class:"q-pa-none",onSubmit:b},{default:l(()=>[e(M,null,{default:l(()=>[n("div",be,[t[7]||(t[7]=n("div",{class:"col-3"},"Efectivo",-1)),e(U,{class:"col",modelValue:s.value.EFE,"onUpdate:modelValue":t[0]||(t[0]=i=>s.value.EFE=i),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue"]),parseFloat(s.value.EFE)?(m(),V(I,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:t[1]||(t[1]=i=>s.value.EFE=0)})):x("",!0)])]),_:1}),e(M,null,{default:l(()=>[n("div",ge,[e(G,{class:"col-3",modelValue:s.value.DIG.id,"onUpdate:modelValue":t[2]||(t[2]=i=>s.value.DIG.id=i),options:v,label:"Terminal","option-value":"id","emit-value":"","option-label":"id",dense:""},{option:l(i=>[e(F,X(Y(i.itemProps)),{default:l(()=>[e(d,null,{default:l(()=>[e(P,{class:"text-bold"},{default:l(()=>[r(f(i.opt.id),1)]),_:2},1024),e(P,{caption:""},{default:l(()=>[r(f(i.opt.desc),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),e(U,{class:"col",modelValue:s.value.DIG.val,"onUpdate:modelValue":t[3]||(t[3]=i=>s.value.DIG.val=i),type:"number",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue"]),parseFloat(s.value.DIG.val)?(m(),V(I,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:t[4]||(t[4]=i=>{s.value.DIG.val=0,s.value.DIG.id=null})})):x("",!0)])]),_:1}),e(B),n("div",_e,[n("div",null,[k.value>=y.value?(m(),h(N,{key:0},[t[8]||(t[8]=n("div",{class:"fs-dec1"},"Cambio:",-1)),n("div",ke,"$ "+f((k.value-y.value).toFixed(2)),1)],64)):(m(),h(N,{key:1},[t[9]||(t[9]=n("div",{class:"fs-dec1"},"Falta:",-1)),n("div",Ve,"$ "+f((y.value-k.value).toFixed(2)),1)],64))]),n("div",null,[k.value>=y.value?(m(),V(I,{key:0,color:"positive",icon:"fas fa-dollar-sign",label:"Pagar",type:"submit",class:"full-height"})):x("",!0)])])]),_:1})]),_:1})):x("",!0)}};const Fe={key:0,class:"text-right"},xe={class:"row justify-center"},Oe={__name:"IvaLayout",setup(S){Z();const _=H(),v=de(),w=_.series,$=p(null),s=p(""),u=p(null),y=p(0),k=p(0),b=p(0),c=p({state:!1}),t=p(null),i=q(()=>$.value&&s.value.length),A=async()=>{u.value=null,y.value=0;let a=$.value,o=s.value,C=`http://${_.session.store.ip_address}/access/public/iva/ticket?serie=${a}&folio=${o}`;L.get(C).then(Q=>{u.value=Q.data}).catch(Q=>{console.log(Q);let T=Q.response.status,E=Q.response.data;console.log(T),console.log(E),v.notify({html:!0,message:E.message,color:"negative",position:"center"})})},j=({_inc:a,_iva:o,impresora:g,_monto:C})=>{console.log(a,o,g,C),t.value=g,y.value=parseFloat(a),k.value=parseFloat(o),b.value=parseFloat(C),c.value.state=!0},D=a=>{console.log("pagando..."),console.log(a);let o=_.session.store.ip_address,g=`${_.session.name} - ${_.session.store.alias}`,C=`http://${o}/access/public/iva/create`,Q={modes:a,by:g,ticket:u.value.ticket,iva:k.value,monto:b.value,impresora:t.value};console.log(Q),v.loading.show({message:"Imprimiendo..."}),console.log(Q),L.post(C,Q).then(T=>{console.log(T.data);let E=T.data;v.loading.hide(),c.value.state=!1,u.iva=null,u.value=null,v.notify({html:!0,color:"positive",position:"center",message:`<span class="fs-inc2"> El ticket <b>${E.ticket}</b> fue generado! </span>`}),E.printed||v.notify({html:!0,color:"negative",position:"top",icon:"fas fa-bugs",message:'<span class="fs-inc2"> No se pudo emitir el ticket, la conexion a la impresora no esta disponible! </span>'})}).catch(T=>{console.log(T),v.loading.hide()})};return console.log(_.session),(a,o)=>(m(),V(ne,{view:"hHh Lpr fFf"},{default:l(()=>[e(J,{class:"transparent text-dark",bordered:""},{default:l(()=>[e(ie),e(B)]),_:1}),e(ue,null,{default:l(()=>[e(oe,{class:"justify-between"},{default:l(()=>[n("div",null,[o[3]||(o[3]=r("Helpers ")),e(ee,{name:"navigate_next",color:"primary"}),o[4]||(o[4]=r()),o[5]||(o[5]=n("span",{class:"text-h6"},"IVA",-1))]),e(I,{color:"primary",icon:"add"},{default:l(()=>[e(te,null,{default:l(()=>[o[6]||(o[6]=n("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Folio",-1)),e(B),e(O,{dense:"",onSubmit:A,class:"q-gutter-md q-pa-md"},{default:l(()=>[e(G,{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=g=>$.value=g),options:le(w),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(U,{modelValue:s.value,"onUpdate:modelValue":o[1]||(o[1]=g=>s.value=g),type:"number",label:"Folio"},null,8,["modelValue"]),i.value?(m(),h("div",Fe,[e(I,{type:"submit",color:"primary",icon:"search"})])):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(se,{class:"bg-grey-3",padding:""},{default:l(()=>[n("div",xe,[e(ae,{name:"bounce"},{default:l(()=>[u.value?(m(),V(me,{key:0,data:u.value,onOpenCashDesk:j},null,8,["data"])):x("",!0)]),_:1})]),e(K,{modelValue:c.value.state,"onUpdate:modelValue":o[2]||(o[2]=g=>c.value.state=g)},{default:l(()=>[e(Qe,{data:u.value,inc:y.value,onPay:D},null,8,["data","inc"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Oe as default};
