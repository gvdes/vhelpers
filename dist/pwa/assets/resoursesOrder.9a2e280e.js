import"./axios.f612a82c.js";const v=(s,o,l)=>{const p=o.category.familia.seccion.id,e=l.find(i=>i._category==p).rules;let n=0,t=0,a=0;if(!e)return!1;let c=s.filter(i=>i.id===o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),f=s.filter(i=>i.category.familia.id===o.category.familia.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),r=s.filter(i=>i.category.familia.seccion.id===o.category.familia.seccion.id&&i.id!==o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0);s.findIndex(i=>i.id==o.id)>=0?(n=c,t=f,a=r):(n=c+Number(o.pivot.units),t=f+Number(o.pivot.units),a=r+Number(o.pivot.units));for(const i of e)if(i._type===2&&(i.sameModel==1&&n>=i.min&&(!i.max||n<=i.max)||i.sameModel==0&&t>=i.min&&(!i.max||t<=i.max)||i.sameModel==0&&a>=i.min&&(!i.max||t<=i.max)&&i.family==0))return!0;return!1},d=(s,o,l)=>{const p=o.category.familia.seccion.id,e=l.find(i=>i._category==p).rules;let n=0,t=0,a=0;if(!e)return!1;let c=s.filter(i=>i.id===o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),f=s.filter(i=>i.category.familia.id===o.category.familia.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),r=s.filter(i=>i.category.familia.seccion.id===o.category.familia.seccion.id&&i.id!==o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0);s.findIndex(i=>i.id==o.id)>=0?(n=c,t=f,a=r):(n=c+Number(o.pivot.units),t=f+Number(o.pivot.units),a=r+Number(o.pivot.units));for(const i of e)if(i._type===3&&(i.sameModel==1&&n>=i.min&&(!i.max||n<=i.max)||i.sameModel==0&&t>=i.min&&(!i.max||t<=i.max)||i.sameModel==0&&a>=i.min&&(!i.max||t<=i.max)&&i.family==0))return!0;return!1},_=(s,o)=>{let l=0;return l=s.filter(e=>e.id===o.id).reduce((e,n)=>e+Number(u(n.pivot,n.pieces)),0)+Number(o.pivot.units),l>=o.pieces},b=async(s,o,l)=>{const p=[];for(const e of s){const n=e.pivot._supply_by==3?e.pivot.amount*e.pieces:e.pivot._supply_by==2?e.pivot.amount*12:e.pivot.amount;let t=0;o.client._price_list<=3?_(s,e)?t=4:d(s,e,l)?t=3:v(s,e,l)?t=2:t=1:t=o.client._price_list;const a=e.prices.find(c=>c.id==t);if(a){const c=e.pivot.price,f=e.pivot._price_list,r=a.pivot.price;(c!==r||f!==t)&&(e.pivot._price_list=t,e.pivot.price=r,e.pivot.total=n*r,p.push({_order:e.pivot._order,_product:e.id,_price_list:t,price:r,total:n*r}))}}},g=async(s,o,l)=>{const p=[];for(const e of s){const n=e.pivot.units;let t=0;o<=3?_(s,e)?t=4:d(s,e,l)?t=3:v(s,e,l)?t=2:t=1:t=o;const a=e.prices.find(c=>c.id==t);if(a){const c=e.pivot.price,f=e.pivot._price_list,r=a.pivot.price;(c!==r||f!==t)&&(e.pivot._price_list=t,e.pivot.price=r,e.pivot.total=n*r,p.push({_product:e.id,_price_list:t,price:r,total:n*r}))}}},u=(s,o)=>s.units,x=(s,o)=>{o.forEach(l=>{l.type==="NXM"&&N(s,l)})},N=(s,o)=>{const l=o.products.map(a=>a._product),p=s.filter(a=>l.includes(a.id));if(!p.length)return;p.forEach(a=>{const c=Number(a.pivot.units),f=Number(a.pivot.price);a.pivot.subtotal=c*f,a.pivot.promo_units=0,a.pivot.promo_discount=0,a.pivot.total=a.pivot.subtotal});const e=p.reduce((a,c)=>a+Number(c.pivot.units),0),n=Math.floor(e/2);if(n<=0)return;let t=n;for(const a of p){if(t<=0)break;const c=Number(a.pivot.units),f=Number(a.pivot.price),r=Math.min(c,t);r<=0||(a.pivot.promo_units+=r,a.pivot.promo_discount+=r*f,a.pivot.total-=r*f,t-=r)}};var M={verificarPrecioMayoreo:v,verificarPrecioDocena:d,actualizarPreciosProductos:b,actualizarPreciosProductosSales:g,verificarPrecioCaja:_,aplicarPromociones:x};export{M as R};
