import{Q as c}from"./QSeparator.f19208f7.js";import{u as K,r as d,c as E,o as z,a as G,w as n,e as s,f as l,Y as W,a4 as k,Q}from"./index.9cf7fb9e.js";import{Q as I}from"./QSelect.859920db.js";import{Q as V}from"./QInput.e8458224.js";import{Q as X}from"./QToolbar.7b3a5a12.js";import{Q as Z}from"./QHeader.8f50453d.js";import{Q as j,a as g}from"./QCard.1c6a3157.js";import{Q as ee}from"./QForm.f310f39b.js";import{Q as T}from"./QTable.3e76276b.js";import{Q as ae}from"./QPage.caa9a50a.js";import{Q as te,a as oe}from"./QLayout.216f35e3.js";import{u as se}from"./VDB.5867faa7.js";import{_ as le}from"./UserToolbar.83636b22.js";import{a as B}from"./axios.9ab26c22.js";import{A as ne}from"./assistApi.03ca0edf.js";import{e as R}from"./export-file.041709e1.js";import{u as ie}from"./use-quasar.5114d4be.js";import{d as re}from"./date.d8023204.js";import"./jspdf.plugin.autotable.be22ab82.js";import"./use-key-composition.9614fe34.js";import"./uid.937d8ee7.js";import"./QItemSection.51dbcc51.js";import"./position-engine.684f0f60.js";import"./QDialog.cec9fbcd.js";import"./rtl.276c3f1b.js";import"./QResizeObserver.36851ef8.js";import"./QList.205ba94c.js";import"./QLinearProgress.d72d5f5a.js";import"./QCheckbox.6e22adef.js";import"./QCardActions.bb335274.js";import"./ClosePopup.95b7067a.js";import"./axios.ba7b1b0e.js";import"./_commonjsHelpers.88e99c8f.js";const ce={class:"row"},ue={class:"q-mb-lg row"},de={class:"text-center text-h6"},me={class:"text-center text-h6"},pe={class:"text-center text-h6"},ve={class:"row"},fe={class:"col"},be={class:"row"},ge={class:"row"},he={class:"col"},Ce={class:"row"},_e={class:"col"},xe={class:"row"},Ae={class:"col"},oa={__name:"cardStores",setup(Ee){const S=se(),i=ie(),D=K(),h=d(null),r=d([]),y=d([]),w=d(null),u=d({val:"SELECCIONA CAJA",opts:[]}),m=d({val:"SELECCIONA SUCURSAL",opts:[]}),_=d([{name:"bauchers",label:"Baucher",field:a=>a}]),v=d([{name:"terminal",label:"Caja",align:"left",field:a=>a.TERMINAL},{name:"ticket",label:"Ticket",field:a=>a.TICKET},{name:"total",label:"Total",field:a=>a.TARJETAS},{name:"fecha",label:"Fecha",field:a=>a.FECHA},{name:"hora",label:"Hora",field:a=>a.HORA},{name:"cliente",label:"Cliente",align:"left",field:a=>a.CLIENTE}]),f=E(()=>u.value.val?y.value.filter(a=>a.TERMINAL==u.value.val.DESTER):[]),N=E(()=>{if(r.value.length>0){let a=[...r.value];return f.value.filter(o=>{const e=a.indexOf(o.TARJETAS);return e!==-1?(a.splice(e,1),!0):!1})}else return[]}),x=E(()=>{if(r.value.length>0){let a=[...r.value];return f.value.filter(o=>{const e=a.indexOf(o.TARJETAS);return e!==-1?(a.splice(e,1),!1):!0})}else return f.value}),A=E(()=>{let a=[...f.value];return r.value.filter(o=>{const e=a.findIndex(t=>t.TARJETAS===o);return e!==-1?(a.splice(e,1),!1):!0})}),$=()=>{if(h.value){r.value.unshift(h.value),h.value=null;const a=M(A.value,x.value);a.length>0?(i.notify({message:`Se encontr\xF3 una coincidencia: Combinaci\xF3n: ${a[0].combinacion.map(o=>o).join(" + ")} = ${a[0].monto}, Ticket: ${a[0].ticket}`,type:"positive",position:"center"}),r.value.unshift(a[0].monto),a[0].combinacion.forEach(o=>{const e=r.value.findIndex(t=>t==o);e!==-1&&r.value.splice(e,1)})):console.log("No se encontraron coincidencias.")}},L=async()=>{const a=re.formatDate(new Date,"YYYY-MM-DD");console.log("Recibiendo Datos :)"),i.loading.show({message:"Obteniendo datos"}),S.session.store.ip_address;const o=ne.index();console.log(o),o.then(e=>{console.log(e),w.value=a,m.value.opts=e,i.loading.hide()})},F=async a=>{console.log(a.ip_address),i.loading.show({message:"Obteniendo datos"});let o=`http://${a.ip_address}/access/public/reports/getCashCard`;B.get(o).then(e=>{console.log(e),u.value.val="SELECCIONA CAJA",y.value=e.data.formaspagos,u.value.opts=e.data.terminales,i.loading.hide()}).catch(e=>console.log(e))},O=async a=>{console.log(a),i.loading.show({message:"Obteniendo datos"});let o=`http://${m.value.val.ip_address}/access/public/reports/getCashCard/${a}`;B.get(o).then(e=>{console.log(e),u.value.val="SELECCIONA CAJA",y.value=e.data.formaspagos,u.value.opts=e.data.terminales,i.loading.hide()}).catch(e=>console.log(e))},J=()=>{const a=[_.value.map(e=>b(e.label))].concat(A.value.map(e=>_.value.map(t=>b(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);R("SobrantesBauchers.csv",a,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},U=()=>{const a=[v.value.map(e=>b(e.label))].concat(x.value.map(e=>v.value.map(t=>b(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);R("BucherFaltantes.csv",a,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},H=()=>{const a=[v.value.map(e=>b(e.label))].concat(N.value.map(e=>v.value.map(t=>b(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);R("BauchersEncontrados.csv",a,"text/csv")!==!0?i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):i.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},b=(a,o,e)=>{let t=o!==void 0?o(a,e):a;return t=t==null?"":String(t),t=t.split('"').join('""'),/^\d{1,2}-\d{4}$/.test(t)&&(t=`'${t}`),`"${t}"`},M=(a,o)=>{const e=P(a),t=[];return e.forEach(p=>{const Y=p.reduce((C,q)=>Number(C)+Number(q),0);o.forEach(C=>{C.TARJETAS==Y&&t.push({combinacion:p,ticket:C.TICKET,monto:C.TARJETAS})})}),t},P=a=>{const o=[];for(let e=0;e<1<<a.length;e++){const t=[];for(let p=0;p<a.length;p++)e&1<<p&&t.push(a[p]);t.length>0&&o.push(t)}return o};return S.session.rol=="root"||S.session.rol=="adm"?L():(i.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),D.replace("/")),(a,o)=>(z(),G(te,{view:"hHh Lpr fFf"},{default:n(()=>[s(oe,null,{default:n(()=>[s(ae,{padding:""},{default:n(()=>[s(Z,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[s(le),s(c),s(X,{class:"justify-between"},{default:n(()=>[l("div",null,[o[4]||(o[4]=l("span",{class:"text-grey"},"Helpers",-1)),s(W,{name:"navigate_next",color:"primary"}),o[5]||(o[5]=l("span",{class:"text-h6"},"Tarjetas",-1))]),l("div",ce,[s(I,{modelValue:m.value.val,"onUpdate:modelValue":[o[0]||(o[0]=e=>m.value.val=e),F],options:m.value.opts,"option-label":"name",label:"Sucursal",outlined:"",dense:""},null,8,["modelValue","options"]),s(c,{spaced:"",inset:"",vertical:"",dark:""}),s(I,{modelValue:u.value.val,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value.val=e),options:u.value.opts,"option-label":"DESTER",label:"Caja",outlined:"",dense:""},null,8,["modelValue","options"]),s(c,{spaced:"",inset:"",vertical:"",dark:""}),s(V,{modelValue:w.value,"onUpdate:modelValue":[o[2]||(o[2]=e=>w.value=e),O],type:"date",outlined:"",dense:"",disable:m.value.val==null||m.value.val=="SELECCIONA SUCURSAL"},null,8,["modelValue","disable"])])]),_:1})]),_:1}),l("div",ue,[s(j,{class:"my-card col",bordered:""},{default:n(()=>[s(g,null,{default:n(()=>o[6]||(o[6]=[l("div",{class:"text-h6"},"Bauchers",-1)])),_:1}),s(g,null,{default:n(()=>[l("div",de,"$ "+k(r.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0)),1)]),_:1})]),_:1}),s(c,{spaced:"",inset:"",vertical:"",dark:""}),s(j,{class:"my-card col"},{default:n(()=>[s(g,null,{default:n(()=>o[7]||(o[7]=[l("div",{class:"text-h6"},"Cobros",-1)])),_:1}),s(g,null,{default:n(()=>[l("div",me,"$ "+k(f.value.reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0)),1)]),_:1})]),_:1}),s(c,{spaced:"",inset:"",vertical:"",dark:""}),s(j,{class:"my-card col"},{default:n(()=>[s(g,null,{default:n(()=>o[8]||(o[8]=[l("div",{class:"text-h6"},"Diferencia",-1)])),_:1}),s(g,null,{default:n(()=>[l("div",pe,"$ "+k(Number(Number(r.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0))-Number(f.value.reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0))).toFixed(2)),1)]),_:1})]),_:1})]),s(ee,{onSubmit:$,class:"q-gutter-md"},{default:n(()=>[s(V,{modelValue:h.value,"onUpdate:modelValue":o[3]||(o[3]=e=>h.value=e),type:"number",label:"IMPORTE",outlined:"",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md",disable:u.value.val=="SELECCIONA CAJA"},null,8,["modelValue","disable"])]),_:1}),s(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",ve,[l("div",null,[s(T,{title:"LISTA",rows:r.value,"row-key":"name",columns:_.value,pagination:{rowsPerPage:9},"hide-bottom":""},null,8,["rows","columns"])]),s(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",fe,[l("div",be,[s(T,{title:"Bauchers Faltantes",rows:A.value,"row-key":"name",class:"col",columns:_.value},{"top-right":n(()=>[l("div",ge,[s(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",he,[s(Q,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:J,disable:!(A.value.length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"]),s(c,{spaced:"",inset:"",vertical:"",dark:""}),s(T,{title:"Cobros Faltantes",rows:x.value,"row-key":"name",class:"col",columns:v.value},{"top-right":n(()=>[l("div",Ce,[s(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",_e,[s(Q,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:U,disable:!(x.value.length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])]),s(c,{spaced:"",inset:"",vertical:"",dark:""}),s(T,{title:"Cobros Encontrados",rows:N.value,"row-key":"name",columns:v.value},{"top-right":n(()=>[l("div",xe,[s(c,{spaced:"",inset:"",vertical:"",dark:""}),l("div",Ae,[s(Q,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:H,disable:!(N.value.length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])])])]),_:1})]),_:1})]),_:1}))}};export{oa as default};
