import{u as U,a as j,aH as z,r as _,c as L,o as c,g as C,d as m,w as r,h as f,e as i,a3 as I,Q as p,a1 as M,f as o,a0 as v,ak as G,a2 as H}from"./index.6242511a.js";import{Q as J}from"./QToolbarTitle.fbf8825e.js";import{Q as K}from"./QToolbar.d90d6ef1.js";import{Q as W,b as y}from"./QList.f10a5338.js";import{Q as X}from"./QTable.031306a0.js";import{u as Y,Q as V,a as w}from"./axios.242721f9.js";import{Q as Z}from"./QFooter.ca07b677.js";import{Q as ee}from"./QPage.3c21426a.js";import{Q as te}from"./QSelect.6694b842.js";import{Q as S}from"./QInput.baa77641.js";import{Q as ae}from"./QSpace.b594bbd6.js";import{Q as le}from"./QCardActions.e1cd74d0.js";import"./QExpansionItem.fb5d9553.js";import"./QDrawer.11f7dfc8.js";import"./ClosePopup.baeca0d1.js";import{P as oe}from"./ProductsAutocomplete.fca2fe3c.js";import{I as ie}from"./invoices.e366a138.js";import"./dayjs.min.cbcf888d.js";import"./jspdf.plugin.autotable.510ee181.js";import{$sktRestock as N}from"./socket.3fae67a0.js";import{i as g}from"./invoicesApi.93fcdb93.js";import"./QForm.44ba3208.js";import"./Restock.be0d0dd1.js";import"./QBtnGroup.c784cba6.js";import"./QLinearProgress.28496a54.js";import"./QCheckbox.b8897045.js";import"./QResizeObserver.664cd27c.js";import"./QScrollObserver.42717317.js";import"./touch.9135741d.js";/* empty css                                                                         */import"./browser.eff7c919.js";import"./_commonjsHelpers.88e99c8f.js";const se={class:"col"},ne={class:"col"},de={class:"col text-right"},ue={class:"row q-ml-sm"},re={class:"row justify-between"},ve={class:"text-left"},ce={class:"text--3"},pe={class:"text-h6"},me={class:"text-right"},fe={class:"text-bold"},_e={class:"text--2"},ge={class:"text-center"},he={class:"text-h6"},ke={class:"text-h6"},ye={class:"text--2"},be={class:"row items-start justify-between"},xe={class:"text-center col text-primary"},we={class:"text-center col"},Qe={class:"text-center col"},Ce={class:"text-center col"},Pe={class:"text-bold"},st={__name:"viewInvoice",setup(De){U();const s=Y(),h=j(),b=z(),d=_(null),u=_([]),n=_({val:{id:1,label:"Pieza"},opts:[{id:1,label:"Pieza"},{id:2,label:"Docena"},{id:3,label:"Caja"}]}),e=_({state:!1,val:null,edit:!1}),P=_({toDelivered:1,_supply_by:1,units:1,cost:0,total:0,comments:"",stock:0,ipack:0}),D=_({pagination:{rowsPerPage:0},columns:[{name:"code",label:"CODIGO",field:a=>a.code,align:"left"},{name:"description",label:"DESCRIPCION",field:a=>a.description,align:"left"},{name:"amount_delivered",label:"CANTIDAD",field:a=>a.pivot.units,align:"center"}]}),k=L(()=>{var a,t;return((a=n.value.val)==null?void 0:a.id)==3?e.value.val.pivot.toDelivered*e.value.val.pivot.ipack:((t=n.value.val)==null?void 0:t.id)==2?e.value.val.pivot.toDelivered*12:e.value.val.pivot.toDelivered}),q=async()=>{s.loading.show({message:"Obeteniendo Datos"});const a=await g.getInvoice(b.params.inv);a.fail?a.fail.status==401?(h.push("/distribute/invoice"),s.notify({message:"La factura ya se realizo",type:"negative",position:"center"}),s.loading.hide()):(a.fail.status=404)?(h.push("/distribute/invoice"),s.notify({message:"No existe la Factura",type:"negative",position:"center"}),s.loading.hide()):console.log(a):(console.log(a),d.value=a,u.value=a.products,s.loading.hide())},F=a=>{console.log(a);let t=u.value.findIndex(l=>l.id==a.id);console.log(t),t>=0?(e.value.val=u.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(l=>l.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=a,e.value.val.pivot=P.value,e.value.val.pivot.ipack=a.pieces,e.value.state=!0)},A=a=>{console.log(a);let t=u.value.findIndex(l=>l.id==a.id);console.log(t),t>=0?(e.value.val=u.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(l=>l.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=a,e.value.val.pivot=P.value,e.value.val.pivot.ipack=a.pieces,e.value.state=!0)},B=async()=>{s.loading.show({message:"Creando Factura"}),console.log(d.value);const a=await g.changestate(d.value);a.fail?console.log(a):(console.log(a),N.emit("order_refresh",{order:a.requisitiion}),N.emit("orderpartition_refresh",{order:a.partition}),ie.invoiceFormat(a.partition),T(a.partition))},T=async a=>{const t=await g.addInvoiceFS(a);t.fail?t.fail.status==503?(s.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide()):console.log(t):(s.notify({message:`Salida Creada ${t}`,type:"positive",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide())},x=()=>{e.value={state:!1,val:null,edit:!1}},$=async()=>{s.loading.show({message:"Insertando Producto"});let a={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(l=>l.id==1).pivot.gen,amount:0,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};const t=await g.addProduct(a);t.fail?console.log(t):(s.loading.hide(),u.value.push(t)),x()},E=async()=>{s.loading.show({message:"Eliminando Producto"}),console.log(e.value);let a={_requisition:b.params.inv,_product:e.value.val.id};console.log(a);const t=await g.deleteProduct(a);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let l=u.value.findIndex(Q=>Q.id==a._product);u.value.splice(l,1)}x()},O=async()=>{s.loading.show({message:"Editando Producto"}),console.log(e.value);let a={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(l=>l.id==1).pivot.gen,amount:0,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};console.log(a);const t=await g.editProduct(a);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let l=u.value.findIndex(Q=>Q.id==a.id);console.log(e.value.val),u.value.splice(l,1,t)}x()},R=(a,t)=>{console.log(t),e.value.val=t,n.value.val=n.value.opts.find(l=>l.id==t.pivot._supply_by),e.value.state=!0,e.value.edit=!0};return q(),(a,t)=>(c(),C(I,null,[d.value?(c(),m(ee,{key:0,padding:""},{default:r(()=>[i(K,{class:"bg-primary text-white"},{default:r(()=>[i(p,{flat:"",round:"",dense:"",icon:"arrow_back ",onClick:t[0]||(t[0]=l=>M(h).push("/distribute/invoice"))}),i(J,{class:"row"},{default:r(()=>[o("div",se,"Origen : "+v(d.value.to.name),1),o("div",ne,"Destino : "+v(d.value.from.name),1),o("div",de,v(d.value.created_by.nick),1)]),_:1}),i(p,{flat:"",round:"",dense:"",icon:"download",class:"q-mr-xs"}),i(p,{flat:"",round:"",dense:"",icon:"upload"})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),u.value.length>0?(c(),m(X,{key:0,rows:u.value,"hide-bottom":"",columns:D.value.columns,pagination:D.value.pagination,onRowClick:R},null,8,["rows","columns","pagination"])):f("",!0),i(Z,{reveal:"",elevated:"",bordered:""},{default:r(()=>[i(y,{spaced:"",inset:"",vertical:"",dark:""}),o("div",ue,[i(V,{class:"col"},{default:r(()=>[i(oe,{checkState:!1,onInput:F,with_prices_Invoice:"",with_stock:"",onAgregar:A,with_locations:""})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[u.value.length>0?(c(),m(p,{key:0,flat:"",icon:"send",onClick:B})):f("",!0)])]),i(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})):f("",!0),i(W,{modelValue:e.value.state,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.state=l),position:"bottom"},{default:r(()=>[e.value.val?(c(),m(V,{key:0},{default:r(()=>[i(w,{class:"bg-grey-3"},{default:r(()=>[o("div",re,[o("div",ve,[o("div",ce,"ID: "+v(e.value.val.id),1),o("div",pe,v(e.value.val.code),1)]),o("div",me,[o("div",fe,v(e.value.val.name),1),o("div",_e,v(e.value.val.barcode),1)])])]),_:1}),i(y),i(w,null,{default:r(()=>[G(v(e.value.val.description),1)]),_:1}),i(w,{class:"row justify-around items-center"},{default:r(()=>[o("div",ge,[o("div",he,v(e.value.val.pieces),1),t[5]||(t[5]=o("div",{class:"text--2"},"PxC",-1))]),(c(!0),C(I,null,H(e.value.val.stocks,l=>(c(),C("div",{key:l.id,class:"text-center"},[o("div",ke,v(l.pivot.gen),1),o("div",ye,v(l.alias),1)]))),128))]),_:1}),i(w,null,{default:r(()=>[o("div",be,[o("div",xe,[i(te,{modelValue:n.value.val,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value.val=l),options:n.value.opts,label:"Unidad Medida",filled:"",dense:""},null,8,["modelValue","options"])]),o("div",we,[t[6]||(t[6]=o("div",null,"Conteo",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.toDelivered,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.val.pivot.toDelivered=l),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter"},null,8,["modelValue"])]),o("div",Qe,[t[7]||(t[7]=o("div",null,"PxC",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.ipack,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.val.pivot.ipack=l),type:"number","input-class":"text-h6 text-center",disable:n.value.val.id!=3},null,8,["modelValue","disable"])]),o("div",Ce,[t[8]||(t[8]=o("div",null,"Piezas",-1)),o("div",Pe,v(k.value),1)])])]),_:1}),i(le,null,{default:r(()=>[i(p,{flat:"",icon:"close",onClick:x}),i(ae),e.value.edit?f("",!0):(c(),m(p,{key:0,flat:"",icon:"add",color:"positive",onClick:$})),e.value.edit?(c(),m(p,{key:1,flat:"",icon:"delete",color:"negative",onClick:E})):f("",!0),e.value.edit?(c(),m(p,{key:2,flat:"",icon:"edit",color:"warning",onClick:O})):f("",!0)]),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"])],64))}};export{st as default};
