import{u as be,r as c,c as J,l as he,o as v,d as j,w as i,e as o,Q as f,h as Q,g as w,a3 as ke,a2 as we,f as F,ak as z,a0 as ye,a4 as W}from"./index.7940d7a9.js";import{b as A,Q as K}from"./QList.d698dd2f.js";import{Q as I}from"./QSelect.ec2f88bb.js";import{Q as g}from"./QCardSection.5ead0201.js";import{Q as N}from"./QCard.1fd4176a.js";import{Q as T}from"./QTable.36b49c08.js";import{Q as q}from"./QCardActions.605bacb9.js";import{Q as Ce}from"./QPage.108bd070.js";import{C as G}from"./ClosePopup.0874ff3d.js";import"./QExpansionItem.30807882.js";import"./QDrawer.816c00ca.js";import"./axios.2da5c7d0.js";import{u as Ve}from"./use-quasar.3f4be582.js";import{u as xe}from"./warehousStore.6f953ce2.js";import"./QInput.26c66994.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.3c72f598.js";import{E as X}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as B}from"./locationsApi.a339606a.js";import"./use-key-composition.3a761bb2.js";import"./QLinearProgress.e1332b2e.js";import"./QCheckbox.a2f0dc2f.js";import"./use-checkbox.f572dcdd.js";import"./QResizeObserver.811c5f67.js";import"./QScrollObserver.428e5390.js";import"./_commonjsHelpers.88e99c8f.js";const _e={key:0},Ee={key:1},Se={key:0},Ue={key:0,class:"row"},De={key:1},Qe={key:0},Ae={class:"text-left"},Ie={key:2},dl={__name:"massive",setup(Be){const R=be(),r=Ve();xe().setTitle("Acciones Masivas");const $=c([]),t=c({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),O=c(null),Y=c(null),Z=c(null),ae=c([]),L=c([]),oe=c(0),P=c(null),E=c({val:[],status:!1}),S=c({val:[],status:!1}),y=c({val:null,types:[{id:1,label:"CREAR"},{id:2,label:"ELIMINAR"}]}),U=c({val:null,opts:[{id:1,label:"CATEGORIAS"},{id:2,label:"UBICACION"},{id:3,label:"EXCEL"}]}),C=c({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),M=c({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),ee=c({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"locations",label:"Ubicacion",field:l=>l.locations.map(e=>e.path).join("/"),align:"left"}]}),te=J(()=>t.value.all.filter(l=>l.deep==0)),se=J(()=>t.value.seccion.val.length>0?t.value.all.filter(l=>l.deep==1&&t.value.seccion.val.map(e=>e.id).includes(l.root)):t.value.all.filter(l=>l.deep==1)),ie=J(()=>{if(t.value.seccion.val.length>0&&t.value.familias.val.length==0){let l=t.value.all.filter(e=>e.deep==1&&t.value.seccion.val.map(a=>a.id).includes(e.root)).map(e=>e.id);return t.value.all.filter(e=>e.deep==2&&l.includes(e.root))}else return t.value.familias.val.length>0?t.value.all.filter(l=>l.deep==2&&t.value.familias.val.map(e=>e.id).includes(l.root)):t.value.all.filter(l=>l.deep==2)}),ne=async()=>{r.loading.show({message:"Obteniendo Secciones"});const l=await B.getInit(R.session.store.id_viz);l.fail?console.log(l):(console.log(l),$.value=l.celler,t.value.all=l.categories),r.loading.hide()},ue=()=>{const l=O.value.sections||[];oe.value=Math.max(...l.map(e=>e.deep)),L.value=[{options:l.filter(e=>e.root===0),selected:null}],ae.value=L.value[0].options},le=l=>{var e;return((e=O.value.sections)==null?void 0:e.filter(a=>a.root===l))||[]},de=(l,e)=>{L.value.splice(e+1);const a=le(l);a.length>0&&L.value.push({options:a,selected:null})},ce=async()=>{r.loading.show({message:"Obeniendo Productos"});let l={workpoint:R.session.store.id_viz,section:P.value.selected};const e=await B.obtProduct(l);e.fail?console.log(e):(console.log(e),E.value.status=!0,E.value.val=e,r.loading.hide())},re=async()=>{r.loading.show({message:"Eliminando Ubicaciones"});let l={products:E.value.val.map(a=>a.id),section:P.value.selected};console.log(l);const e=await B.deleteSectionProducts(l);e.fail?console.log(e):(console.log(e),E.value={val:[],status:!1},r.loading.hide())},pe=async()=>{var a,u,p;r.loading.show({message:"El reporte puede tardar unos minutos"});let l={workpoint:R.session.store.id_viz,sections:(a=t.value.seccion.val)==null?void 0:a.map(n=>n.id),familys:(u=t.value.familias.val)==null?void 0:u.map(n=>n.id),categories:(p=t.value.categories.val)==null?void 0:p.map(n=>n.id)};console.log(l);const e=await B.obtProductCategories(l);e.fail?console.log(e):(r.loading.hide(),console.log(e),S.value.status=!0,S.value.val=e)},me=async()=>{r.loading.show({message:"Eliminando Ubicaciones"});let l={products:S.value.val.map(a=>({product:a.id,locations:a.locations.map(u=>u.id)}))};const e=await B.deleteCategoriesLocations(l);e.fail?console.log(e):(console.log(e),console.log(e),S.value={val:[],status:!1},r.loading.hide())},ve=()=>{var u;let l=(u=document.getElementById("refCreate"))==null?void 0:u.files[0],e=new X.Workbook,a={};r.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async p=>{let n=e.worksheets[0],b=n.getColumn("A");n.getColumn("B"),b.eachCell({includeEmpty:!0},function(h,V){if(V===1)return;let x=h.value,s=n.getCell(`B${V}`).value;!x||(a[x]||(a[x]=[]),a[x].includes(s)||a[x].push(s||cantidad))});let m=Object.keys(a).map(h=>({_product:h,_location:a[h],_workpoint:R.session.store.id_viz}));console.log(m);const d=await B.addMassiveLocation(m);d.fail?console.log(d):(console.log(d),C.value.state=!0,C.value.val=d,r.loading.hide())})},fe=()=>{var u;let l=(u=document.getElementById("refDelete"))==null?void 0:u.files[0],e=new X.Workbook,a={};r.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async p=>{e.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(d,h){if(h===1)return;let V=d.value;!V||(a[V]=!0)});let m=Object.keys(a).map(d=>({_product:d,_workpoint:R.session.store.id_viz}));if(console.log(m),m.length){const d=await B.deleteMassiveLocation(m);d.fail?console.log(d):(console.log(d),M.value.state=!0,M.value.val=d,r.loading.hide())}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ge=async()=>{const l=new X.Workbook;$.value.forEach((p,n)=>{var x;const b=l.addWorksheet(`${p.name}_${n}`),m=p.sections||[],d=Math.max(...m.map(s=>s.deep||1)),h=[];for(let s=0;s<=d;s++)h.push(`NOMBRE_${s}`,`PATH_${s}`,`ID_${s}`);b.addRow(h);const V=(s,D)=>{const k=Array(d*3).fill("");for(let _=0;_<D.length;_++)k[_]=D[_];k[s.deep*3]=s.name,k[s.deep*3+1]=s.path,k[s.deep*3+2]=s.id,b.addRow(k),m.filter(_=>_.root===s.id).forEach(_=>V(_,k))};m.filter(s=>s.deep===0).forEach(s=>V(s,[s.name,s.path,s.path])),(x=b.columns)==null||x.forEach(s=>{let D=0;s.eachCell({includeEmpty:!0},k=>{const H=k.value?k.value.toString().length:10;H>D&&(D=H)}),s.width=D<10?10:D})});const e=await l.xlsx.writeBuffer(),a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=document.createElement("a");u.href=URL.createObjectURL(a),u.download="almacenes.xlsx",document.body.appendChild(u),u.click(),document.body.removeChild(u)};return ne(),he(L,l=>{const e=l.filter(a=>a.selected!==null);if(e.length){const a=e[e.length-1];le(a.selected),P.value=a}},{deep:!0}),(l,e)=>(v(),j(Ce,{padding:""},{default:i(()=>[o(N,{class:"my-card"},{default:i(()=>[o(g,{class:"row"},{default:i(()=>{var a,u;return[o(f,{icon:"download",flat:"",onClick:ge,title:"descargar Estructura"}),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(I,{dense:"",class:"col",modelValue:y.value.val,"onUpdate:modelValue":e[0]||(e[0]=p=>y.value.val=p),options:y.value.types,label:"Tipo",filled:""},null,8,["modelValue","options"]),((a=y.value.val)==null?void 0:a.id)==2?(v(),j(A,{key:0,spaced:"",inset:"",vertical:"",dark:""})):Q("",!0),((u=y.value.val)==null?void 0:u.id)==2?(v(),j(I,{key:1,dense:"",class:"col",modelValue:U.value.val,"onUpdate:modelValue":e[1]||(e[1]=p=>U.value.val=p),options:U.value.opts,label:"MEDIO",filled:""},null,8,["modelValue","options"])):Q("",!0)]}),_:1}),y.value.val?(v(),j(g,{key:0},{default:i(()=>{var a,u,p;return[y.value.val.id==1?(v(),w("div",_e,[o(f,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[2]||(e[2]=()=>Y.value.click())})])):y.value.val.id==2?(v(),w("div",Ee,[U.value.val?(v(),w("div",Se,[((a=U.value.val)==null?void 0:a.id)==1?(v(),w("div",Ue,[o(I,{class:"col",modelValue:t.value.seccion.val,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.seccion.val=n),options:te.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(I,{class:"col",modelValue:t.value.familias.val,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.familias.val=n),options:se.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:t.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(I,{class:"col",modelValue:t.value.categories.val,"onUpdate:modelValue":e[5]||(e[5]=n=>t.value.categories.val=n),options:ie.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:t.value.seccion.val.length==0||t.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(f,{color:"primary",label:t.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:pe},null,8,["label"])])):((u=U.value.val)==null?void 0:u.id)==2?(v(),w("div",De,[$.value.length>0?(v(),w("div",Qe,[o(I,{modelValue:O.value,"onUpdate:modelValue":[e[6]||(e[6]=n=>O.value=n),ue],options:$.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),(v(!0),w(ke,null,we(L.value,(n,b)=>(v(),w("div",{key:b},[F("div",null,[o(I,{modelValue:n.selected,"onUpdate:modelValue":[m=>n.selected=m,m=>de(m,b)],options:n.options,label:`Nivel ${b+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(A,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):Q("",!0),F("div",Ae,[o(f,{icon:"delete",flat:"",onClick:ce,disable:!O.value},null,8,["disable"])])])):((p=U.value.val)==null?void 0:p.id)==3?(v(),w("div",Ie,[o(f,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[7]||(e[7]=()=>Z.value.click())})])):Q("",!0)])):Q("",!0)])):Q("",!0)]}),_:1})):Q("",!0)]),_:1}),o(K,{modelValue:E.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>E.value.status=a),persistent:""},{default:i(()=>[o(N,null,{default:i(()=>[o(g,{class:"row items-center"},{default:i(()=>[z(" Vaciar Seccion "+ye(P.value.options.find(a=>a.id==P.value.selected).name),1)]),_:1}),o(g,null,{default:i(()=>[o(T,{title:"Productos",rows:E.value.val,columns:ee.value.columns},null,8,["rows","columns"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"Cancel",color:"primary"},null,512),[[G]]),o(f,{flat:"",label:"Vaciar Seccion",color:"negative",onClick:re})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(K,{modelValue:S.value.status,"onUpdate:modelValue":e[9]||(e[9]=a=>S.value.status=a),persistent:""},{default:i(()=>[o(N,null,{default:i(()=>[o(g,{class:"row items-center"},{default:i(()=>e[12]||(e[12]=[z(" Eliminar Ubicaciones de los Articulos ")])),_:1}),o(g,null,{default:i(()=>[o(T,{title:"Productos",rows:S.value.val,columns:ee.value.columns},null,8,["rows","columns"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"Cancel",color:"primary"},null,512),[[G]]),o(f,{flat:"",label:"Eliminar Ubicacion",color:"negative",onClick:me})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(K,{modelValue:C.value.state,"onUpdate:modelValue":e[10]||(e[10]=a=>C.value.state=a),persistent:""},{default:i(()=>[o(N,null,{default:i(()=>[o(g,{class:"text-bold text-center text-h6"},{default:i(()=>e[13]||(e[13]=[z(" Resultados de Importacion ")])),_:1}),o(g,null,{default:i(()=>[o(T,{rows:C.value.val.goals,columns:C.value.table.columns},null,8,["rows","columns"])]),_:1}),o(g,null,{default:i(()=>[o(T,{rows:C.value.val.fails,columns:C.value.table.columns},null,8,["rows","columns"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"OK",color:"primary"},null,512),[[G]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(K,{modelValue:M.value.state,"onUpdate:modelValue":e[11]||(e[11]=a=>M.value.state=a),persistent:""},{default:i(()=>[o(N,null,{default:i(()=>[o(g,{class:"text-bold text-center text-h6"},{default:i(()=>e[14]||(e[14]=[z(" Resultados de Importacion Eliminado Masivo ")])),_:1}),o(g,null,{default:i(()=>[o(T,{rows:M.value.val},null,8,["rows"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"OK",color:"primary"},null,512),[[G]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),F("input",{type:"file",ref_key:"refCreate",ref:Y,id:"refCreate",onInput:ve,hidden:"",accept:".xlsx,.xls"},null,544),F("input",{type:"file",ref_key:"refDelete",ref:Z,id:"refDelete",onInput:fe,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}))}};export{dl as default};
