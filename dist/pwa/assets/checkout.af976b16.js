import{Q as R}from"./QInput.36b4dde6.js";import{Q as E}from"./QForm.c9b7507f.js";import{a as b,Q as I,d as N}from"./QSelect.acedbf01.js";import{Q as k,a as T,e as A,d as F}from"./QList.2acc8963.js";import{Q as U}from"./QTable.ea1bd53a.js";import{Q as L}from"./QPage.6b39b421.js";import{aH as z,a as H,u as M,r as m,c as j,o as h,g as G,e as t,w as a,a3 as O,f as u,an as Y,a4 as V,d as J,ak as p,a0 as d,al as K,Q as f,am as W}from"./index.57501730.js";import{Q as y,a as _}from"./QCard.97bdd101.js";import{Q as S}from"./QCardActions.0fb184ba.js";import{C as X}from"./ClosePopup.281c5d72.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.690c07d6.js";import{u as Z}from"./Restock.95f3d024.js";import{u as tt}from"./axios.0e1b81a6.js";import{$sktRestock as P}from"./socket.3fae67a0.js";import{_ as et}from"./PrinterSelect.a889e993.js";import"./QLinearProgress.8a982583.js";import"./QCheckbox.14f4717d.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.b14e29ee.js";const ot={class:"flex justify-center"},at={class:"text-center",style:"width: 50%;"},st={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},lt={class:"text-bold"},it={class:"q-mx-sm text-h6"},Ct={__name:"checkout",setup(nt){z();const x=H(),c=Z(),i=tt(),C=M(),n=m(null),$=m({rowsPerPage:[0]}),l=m({state:!1,val:null}),r=m({state:!1,val:null,opts:["GEN","EMP"]}),w=j(()=>c.partitions.filter(s=>s._status==4||s._status==5&&s.requisition._workpoint_to==C.session.store.id_viz)),q=async()=>{c.setShowLYT(!0),c.setTitle("Verificacion"),c.setButtonShow(!1)},B=async s=>{i.loading.show({message:"..."}),console.log(s.ip),console.log(l.value);const o=await g.printForPartition({ip:s.ip,port:s._port,_partition:l.value.val.id,_workpoint_to:l.value.val._workpoint_to});console.log(o),o.status==200?(o.data?i.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):i.notify({message:`Sin conexion a <b>${s.name} <small>(${s.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),i.loading.hide()):(console.error(o),alert(`Error ${o.status}: ${o.data}`))},v=async()=>{l.value.val&&(n.value=l.value.val.id),console.log(n.value);let s=w.value.find(o=>o.id==n.value);if(s._status==5)x.push(`/distribute/checkout/${s.id}`);else if(s._status==4){i.loading.show({message:"Terminando, espera..."});let o={id:s.id,state:5,suply:s._suplier_id};console.log(o);let e=await g.nextStatePartition(o);if(console.log(e),e.status==200){if(console.log(s.requisition._status),e.data.partitionsEnd>e.data.partition.requisition._status){let D={id:e.data.partition._requisition,state:e.data.partitionsEnd};const Q=await g.nextState(D);P.emit("order_refresh",{order:Q.data}),console.log(Q.data)}P.emit("orderpartition_refresh",{order:e.data.partition}),x.push(`/distribute/checkout/${e.data.partition.id}`)}else console.log(e);i.loading.hide()}else i.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),n.value=null};return q(),(s,o)=>(h(),G(O,null,[t(L,{padding:""},{default:a(()=>[u("div",null,[u("div",ot,[u("div",at,[t(E,{onSubmit:v},{default:a(()=>[t(R,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),t(U,{rows:w.value,"row-key":"name",grid:"",pagination:$.value,"hide-bottom":""},{item:a(e=>[u("div",st,[t(T,{bordered:"",class:Y(`${e.row._status==4?"bg-green-11":"bg-red-11"} text-bold`)},{default:a(()=>[V((h(),J(F,{clickable:"",onClick:()=>{l.value.state=!0,l.value.val=e.row}},{default:a(()=>[t(A,null,{default:a(()=>[t(b,{class:"text-center text-bold"},{default:a(()=>[p(d(e.row.id),1)]),_:2},1024),t(b,{class:"text-center text-overline text-caption"},{default:a(()=>[u("span",lt,d(e.row.requisition.from.name),1),p(" (P: "+d(e.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[W]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),t(k,{modelValue:r.value.state,"onUpdate:modelValue":o[2]||(o[2]=e=>r.value.state=e)},{default:a(()=>[t(y,null,{default:a(()=>[t(_,{class:"row items-center"},{default:a(()=>[t(K,{icon:"warning",color:"orange-14","text-color":"white"}),u("span",it,"Iniciar CheckOut #"+d(n.value.id),1)]),_:1}),t(_,null,{default:a(()=>[t(I,{modelValue:r.value.val,"onUpdate:modelValue":o[1]||(o[1]=e=>r.value.val=e),options:r.value.opts,label:"Almacen Destino",filled:""},null,8,["modelValue","options"])]),_:1}),t(S,{vertical:"",align:"center"},{default:a(()=>[t(f,{flat:"",label:"Si",color:"primary",onClick:v,disable:r.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{modelValue:l.value.state,"onUpdate:modelValue":o[3]||(o[3]=e=>l.value.state=e),persistent:""},{default:a(()=>[t(y,null,{default:a(()=>[t(_,{class:"text-bold text-h5 items-center"},{default:a(()=>[p(" Particion "+d(l.value.val.id),1)]),_:1}),t(_,{class:"text-center"},{default:a(()=>o[4]||(o[4]=[p(" Que Desesas Hacer ? ")])),_:1}),t(S,{align:"center"},{default:a(()=>[V(t(f,{flat:"",icon:"close",color:"negative"},null,512),[[X]]),t(f,{flat:"",icon:"print",color:"primary"},{default:a(()=>[t(N,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[t(et,{onSelectedPartition:B,partition:!0})]),_:1})]),_:1}),t(f,{flat:"",icon:"send",color:"positive",onClick:v})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ct as default};
