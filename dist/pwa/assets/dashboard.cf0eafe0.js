import{Q as qe}from"./QDate.f4bb6a24.js";import{a as I,Q as B}from"./QCard.96933c98.js";import{i as fe,aR as xe,aS as we,j as G,c as q,U as Me,l as Ue,T as Re,aH as ge,r as m,at as Te,o as d,g as k,e,w as t,f as s,a0 as c,a1 as K,h as N,d as h,Q as C,a3 as T,a4 as J,a6 as b,S as X,a5 as W,a8 as ze,a7 as he,a as Ce,u as Se,a9 as Le,ax as Oe,m as je}from"./index.f206967d.js";import{Q as le}from"./QCardActions.858b406e.js";import{e as Be,h as Fe,Q as M,a as oe,b as Q,c as F}from"./QSeparator.243f9883.js";import{a as Ye,b as He,u as ie}from"./axios.6390b5c3.js";import{d as ae}from"./dayjs.min.cbcf888d.js";import{u as ne}from"./Restock.d7a7f586.js";import{$sktRestock as $e}from"./socket.3fae67a0.js";import{Q as be}from"./QInput.c65e1852.js";import{Q as Z,a as ye}from"./QTable.9c2ee698.js";import{Q as re,a as de}from"./QTr.393a2f67.js";import{d as ue,a as se,Q as Ge}from"./QSelect.e229e9a4.js";import{Q as pe}from"./QList.5bc323e0.js";import{Q as Je}from"./QPage.5e491fa0.js";import{R as z}from"./RestockApi.bf1dd71a.js";import{Q as ce,a as Ke,b as me}from"./QTabPanels.79764e05.js";import{Q as We}from"./QTabs.ffa91cdf.js";import{Q as Xe}from"./QToggle.e3268484.js";import{Q as Ze}from"./QBadge.45238232.js";import{C as ve}from"./ClosePopup.6345927e.js";import{I as _e}from"./invoices.7381c017.js";import"./browser.eff7c919.js";import{_ as ke}from"./PrinterSelect.a9780dab.js";import"./use-render-cache.3aae9b27.js";import"./date.9b435625.js";import"./_commonjsHelpers.88e99c8f.js";import"./QLinearProgress.2b955dd6.js";import"./QCheckbox.21d0a706.js";import"./touch.9135741d.js";import"./QResizeObserver.963e5336.js";import"./jspdf.plugin.autotable.f39316b6.js";import"./QBtnGroup.f316eb69.js";const et='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var tt=fe({name:"QSpinnerGrid",props:xe,setup(x){const{cSize:S,classes:p}=we(x);return()=>G("svg",{class:p.value,fill:"currentColor",width:S.value,height:S.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:et})}}),at=fe({name:"QInnerLoading",props:{...Ye,...Be,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(x,{slots:S}){const p=Ue(),y=He(x,p.proxy.$q),{transitionProps:$,transitionStyle:_}=Fe(x),P=q(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(y.value===!0?" q-inner-loading--dark":"")),v=q(()=>"q-inner-loading__label"+(x.labelClass!==void 0?` ${x.labelClass}`:""));function u(){const g=[G(Re,{size:x.size,color:x.color})];return x.label!==void 0&&g.push(G("div",{class:v.value,style:x.labelStyle},[x.label])),g}function f(){return x.showing===!0?G("div",{class:P.value,style:_.value},S.default!==void 0?S.default():u()):null}return()=>G(Me,$.value,f)}});const lt='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var ot=fe({name:"QSpinnerDots",props:xe,setup(x){const{cSize:S,classes:p}=we(x);return()=>G("svg",{class:p.value,fill:"currentColor",width:S.value,height:S.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:lt})}});const st={class:"text-h6"},it={class:"q-px-lg text-center"},nt={class:"text-h6"},rt={class:"text-right"},dt={class:"text-h6"},ut={class:"text-center col"},ct={class:"text-h6"},mt={key:0,class:"text-center col"},pt={class:"text-h6"},vt={class:"col row"},ft={key:1,class:"col"},gt={class:"full-width row items-center"},bt={class:"col text-dark"},yt={class:"text-h6"},_t={class:"text-bold"},kt={key:1,class:"text-center q-pa-lg text-h6 text-grey-7"},xt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},wt={class:"text-overline text-grey-7"},ht={key:0},Ct={key:1},St={key:0},$t={key:1},Vt={class:"row"},Qt={key:0,class:"col"},Dt={class:"q-ml-sm text-bold"},It={__name:"OrderViewer",props:{head:{type:Object,default:{}}},emits:["loaded","loading","fresh","chofiAssigned"],setup(x,{emit:S}){const p=ie(),y=ne();ge();const $=x,_=m({opts:[],val:[],filter:[]});m({opts:null,val:null,filter:null});const P=m(null);m(null);const v=S,u=m($.head),f=m(null),g=m(!0),L=m([]),O=m("supliers"),D=m(null),U=m([]),V=m(!1);m({state:!1}),m({state:!1,key:null});const E=m(null),A=m(!1),Y=m({state:!1}),ee=m(null),H=m([]),i=m({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:l=>l.variants.length?l.variants.map(a=>a.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"locs",label:"Ubicacion",field:l=>l.locations.length?l.locations.map(a=>a.path).join(", "):"--",align:"left",coldesc:"Ubicaciones en almacen general"},{name:"stocks",label:"Stock (pzs)",field:l=>l.stocks.reduce((a,o)=>a+o.pivot.stock,0),sortable:!0,classes:l=>l.stocks.reduce((a,o)=>a+o.pivot.stock,0)<=0?"text-red text-bold":"text-bold text-primary",align:"center",coldesc:"Stock total en almacenes GENERALES (CEDIS+PAN)"},{name:"ipack",label:"PxC",field:l=>typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:l=>l.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:l=>l.units.id==3?"Cajas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida (conteo)",field:l=>l.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:l=>l.pivot._supply_by==3?(typeof l.pivot.ipack=="number"?l.pivot.ipack:l.pieces)*(typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount):typeof l.pivot.ipack=="number"?l.pivot.toDelivered:l.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:l=>l.pivot.checkout?"OK":"---",align:"center",classes:l=>l.pivot.checkout?"text-positive text-bold":"text-red",sortable:!0,coldesc:"Revision del Administrador"},{name:"received",label:"Entrada (conteo)",field:l=>l.pivot.toReceived,align:"center",coldesc:"Embalaje recibido"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),r=q(()=>U.value.reduce((l,a)=>l+(a.pivot._supply_by==3?a.pivot.amount*a.pieces:a.pivot.amount),0));q(()=>D.value&&(D.value.id==2||D.value.id==6)),q(()=>L.value.find(l=>l.id==D.value.id).pivot),q(()=>E.value.map(l=>l._status).includes(6));const n=async()=>{v("loading"),console.log(u.value.id),g.value=!0;let l=await z.order(u.value.id);console.log(l.data),U.value=l.data.products,L.value=l.data.log.map(a=>(a.pivot.details=JSON.parse(a.pivot.details),a)),E.value=l.data.partition,D.value=l.data.status,f.value=l.data,ee.value=l.data.invoice,_.value.opts=y.users,g.value=!1,v("loaded")},w=()=>{Y.value.state=!0},te=()=>{A.value=!0},Ve=async()=>{p.loading.show({message:"Cambiando Estado"}),console.log("Iniciando surtido"),v("loading"),V.value=!0;let l=3,a={id:u.value.id,state:l};const o=await z.nextState(a);if(o.status==200){V.value=!1,p.notify({message:`Surtido iniciado para el pedido  ${u.value.id}`,icon:"done",position:"center",color:"teal"});let j={supplyer:_.value.val,pedido:u.value.id,status:l,_workpoint_to:u.value.to.id,_workpoint_from:u.value.from.id};console.log(j);let R=await z.SaveSupply(j);console.log(R),R.fail?(console.log(R),alert(`Error ${R.status}: ${R.data} 2`)):(R.forEach(Ne=>{$e.emit("partitionCreate",Ne)}),p.loading.hide(),n(),v("fresh",f.value),Y.value.state=!1)}else console.log(o),alert(`Error ${o.status}: ${o.data} 1`);v("loaded")},Qe=async l=>{p.loading.show({message:"..."}),console.log(l);const a=await z.printForSupply({ip:l.ip,port:l._port,order:u.value.id});console.log(a),a.status==200?(a.data?p.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):p.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),p.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},De=async l=>{p.loading.show({message:"..."}),console.log(l.ip),console.log(P.value);const a=await z.printForPartition({ip:l.ip,port:l._port,_partition:P.value,_workpoint_to:u.value._workpoint_to});console.log(a),a.status==200?(a.data?p.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):p.notify({message:`Sin conexion a <b>${l.name} <small>(${l.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),p.loading.hide()):(console.error(a),alert(`Error ${a.status}: ${a.data}`))},Ie=(l,a,o)=>{a(()=>{if(l==="")_.value.filter=_.value.opts;else{const j=l.toLowerCase();_.value.filter=_.value.opts.filter(R=>R.complete_name.toLowerCase().indexOf(j)>-1)}})},Pe=async()=>{console.log("Eliminando Pedido"),v("loading");let l=100,a={id:u.value.id,state:l};const o=await z.nextState(a);o.status==200?(A.value=!1,p.notify({message:`Surtido Cancelado para el pedido  ${u.value.id}`,icon:"close",position:"center",color:"negative"}),v("fresh",f.value,!0)):alert(`Error ${o.status}: ${o.data} 1`),v("loaded")},Ee=l=>{console.log(l.id),P.value=l.id},Ae=async l=>{console.log(l);const a=await z.partitionFresh(l.id);console.log(a),a.status==200&&(a.data.order.requisition.from._type!=1?_e.invoiceFormat(a.data.order):_e.transferFormat(a.data.order))};return Te(()=>H.value=i.value.columns.map(l=>l.name)),n(),(l,a)=>(d(),k(T,null,[e(B,{class:"full-width"},{default:t(()=>[e(I,{class:"row justify-between"},{default:t(()=>[s("div",null,[a[7]||(a[7]=s("div",{class:"text-overline text-grey-7"},"Sucursal",-1)),s("div",st,c(u.value.from.alias),1)]),s("div",it,[a[8]||(a[8]=s("div",{class:"text-overline text-grey-7"},"Folio",-1)),s("div",nt,c(u.value.id),1)]),s("div",rt,[a[9]||(a[9]=s("div",{class:"text-overline text-grey-7"},"Agente",-1)),s("div",dt,c(u.value.created_by.nick),1)])]),_:1}),e(M),e(I,{class:"row justify-between"},{default:t(()=>[s("div",ut,[a[10]||(a[10]=s("div",{class:"text-overline text-grey-7"},"Fecha",-1)),s("div",ct,c(K(ae)(u.value.updated_at).format("YYYY-MM-DD")),1)]),u.value.notes?(d(),k("div",mt,[a[11]||(a[11]=s("div",{class:"text-overline text-grey-7 col"},"Notas",-1)),s("div",pt,c(u.value.notes),1)])):N("",!0),s("div",vt,[D.value&&D.value.id>=2?(d(),h(C,{key:0,size:"md",class:"col",color:"primary",icon:"print",flat:"",dense:""},{default:t(()=>[e(ue,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ke,{onSelected:Qe,partition:!1})]),_:1})]),_:1})):N("",!0),e(M,{spaced:"",inset:"",vertical:"",dark:""}),D.value&&D.value.id==2?(d(),k("div",ft,[e(C,{size:"12px",class:"full-width",color:"positive",icon:"start",dense:"",label:"Iniciar",onClick:w,flat:""}),e(M,{spaced:"",inset:"",vertical:"",dark:""}),e(C,{size:"12px",class:"full-width",color:"negative",icon:"close",dense:"",label:"Cancelar",onClick:te,flat:""})])):N("",!0)])]),_:1}),e(M),g.value?(d(),h(I,{key:0,class:"text-center"},{default:t(()=>[e(ot,{size:"50px",color:"purple"})]),_:1})):(d(),k(T,{key:1},[e(M),e(We,{modelValue:O.value,"onUpdate:modelValue":a[0]||(a[0]=o=>O.value=o),class:"text-pink-5",dense:"","no-caps":""},{default:t(()=>[e(ce,{name:"log",label:"Log"}),e(ce,{name:"basket",label:"Productos"}),e(ce,{name:"supliers",label:"Surtidores"})]),_:1},8,["modelValue"]),e(Ke,{modelValue:O.value,"onUpdate:modelValue":a[3]||(a[3]=o=>O.value=o),animated:""},{default:t(()=>[e(me,{name:"log"},{default:t(()=>[e(pe,null,{default:t(()=>[(d(!0),k(T,null,J(L.value,o=>(d(),h(oe,{key:o.id},{default:t(()=>[e(Q,{avatar:""},{default:t(()=>[b(c(o.id),1)]),_:2},1024),e(Q,null,{default:t(()=>[b(c(o.name),1)]),_:2},1024),e(Q,null,{default:t(()=>[b(c(o.pivot.details.responsable),1)]),_:2},1024),e(Q,null,{default:t(()=>[b("de "+c(K(ae)(o.pivot.created_at).format("h:mm a"))+" a "+c(K(ae)(o.pivot.updated_at).format("h:mm a")),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(me,{name:"basket"},{default:t(()=>[U.value.length?(d(),h(Z,{key:0,"row-key":"id",flat:"",rows:U.value,columns:i.value.columns,pagination:i.value.pagination,filter:i.value.filter,"visible-columns":H.value},{top:t(()=>[s("div",gt,[s("div",bt,[s("span",yt,[e(C,{color:"pink-5",icon:"sync",onClick:n,round:"",dense:"",flat:""}),b(" Productos: "+c(U.value.length),1)]),a[12]||(a[12]=b(", ")),s("span",_t,"Piezas: "+c(r.value),1)]),e(be,{dense:"",modelValue:i.value.filter,"onUpdate:modelValue":a[1]||(a[1]=o=>i.value.filter=o),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:t(()=>[e(X,{name:"search"})]),_:1},8,["modelValue"]),e(M,{spaced:"",inset:"",vertical:"",dark:""}),e(C,{color:"secondary",icon:"fas fa-eye","no-caps":"",flat:""},{default:t(()=>[e(ue,{style:{"min-width":"200px"}},{default:t(()=>[e(pe,null,{default:t(()=>[(d(!0),k(T,null,J(i.value.columns,(o,j)=>W((d(),h(oe,{tag:"label",key:j},{default:t(()=>[e(Q,null,{default:t(()=>[e(se,null,{default:t(()=>[b(c(o.label),1)]),_:2},1024),e(se,{caption:""},{default:t(()=>[b(c(o.coldesc),1)]),_:2},1024)]),_:2},1024),e(Q,{side:"",top:""},{default:t(()=>[e(Xe,{color:"pink-5",modelValue:H.value,"onUpdate:modelValue":a[2]||(a[2]=R=>H.value=R),val:o.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ze]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"])):(d(),k("div",kt,"Nada por aqui"))]),_:1}),e(me,{name:"supliers"},{default:t(()=>[e(Z,{rows:E.value,"row-key":"id",dense:"",flat:"",bordered:"",grid:"","hide-header":""},{item:t(o=>[s("div",xt,[e(B,{flat:"",bordered:""},{default:t(()=>[e(I,{class:"text-center"},{default:t(()=>[a[13]||(a[13]=b(" Surtidor ")),a[14]||(a[14]=s("br",null,null,-1)),s("strong",null,c(o.row._suplier),1),e(M,{spaced:"",inset:"",vertical:"",dark:""}),e(X,{name:"print",color:"pink",size:"sm",onClick:j=>Ee(o.row)},{default:t(()=>[e(ue,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:t(()=>[e(ke,{onSelectedPartition:De,partition:!0})]),_:1})]),_:2},1032,["onClick"]),a[15]||(a[15]=s("br",null,null,-1)),s("div",wt,[e(Ze,{color:"primary","text-color":"white",label:o.row.status.name},null,8,["label"])])]),_:2},1024),e(M),e(I,{class:"flex justify-between"},{default:t(()=>[u.value.from._type!=1?(d(),k("div",ht,a[16]||(a[16]=[s("div",null,"Salida",-1),s("div",null,"Entrada",-1)]))):(d(),k("div",Ct,a[17]||(a[17]=[s("div",null,"Traspaso",-1)]))),a[18]||(a[18]=s("div",null,"Herramientas",-1))]),_:1}),e(M),e(I,{class:"flex justify-between"},{default:t(()=>[u.value.from._type!=1?(d(),k("div",St,[s("div",null,c(o.row.invoice),1),s("div",null,c(o.row.invoice_received),1)])):(d(),k("div",$t,[s("div",null,c(o.row.invoice),1)])),s("div",Vt,[o.row._status>=6?(d(),k("div",Qt,[e(C,{color:"pink",icon:"list",onClick:j=>Ae(o.row),flat:""},null,8,["onClick"])])):N("",!0)])]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])],64))]),_:1}),e(F,{modelValue:Y.value.state,"onUpdate:modelValue":a[5]||(a[5]=o=>Y.value.state=o),persistent:""},{default:t(()=>[e(B,{style:{width:"400px"}},{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(Ge,{dense:"",modelValue:_.value.val,"onUpdate:modelValue":a[4]||(a[4]=o=>_.value.val=o),options:_.value.filter,label:"SELECCIONA SURTIDOR","option-label":o=>o.staff.complete_name,filled:"",multiple:"",counter:"","max-values":"10",hint:"Maximo 10 colaboradores",style:{width:"100%"},onFilter:Ie,"input-debounce":"0","use-input":"","use-chips":""},null,8,["modelValue","options","option-label"])]),_:1}),e(le,{align:"right"},{default:t(()=>[W(e(C,{flat:"",label:"Cancel",color:"primary"},null,512),[[ve]]),e(C,{flat:"",label:"Continuar",color:"primary",onClick:Ve,disable:_.value.val.length==0},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:A.value,"onUpdate:modelValue":a[6]||(a[6]=o=>A.value=o),persistent:""},{default:t(()=>[e(B,null,{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:"negative","text-color":"white"}),a[19]||(a[19]=s("div",{class:"q-ml-sm text-bold"},"Estas a punto de cancelar el pedido ",-1)),s("div",Dt,c(u.value.id),1)]),_:1}),e(le,{align:"center"},{default:t(()=>[W(e(C,{flat:"",label:"Cancel",color:"positive"},null,512),[[ve]]),e(C,{flat:"",label:"Confirmar",color:"negative",onClick:Pe})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Pt={class:"text-h6"},Et={class:"row q-mt-md"},At={class:"q-ml-sm text-h6"},Nt={__name:"TableReport",props:{rows:{type:Array,default:[]},name:{type:String,default:""},type:{type:String,default:""}},emits:["cardResumeActived"],setup(x,{emit:S}){ne();const p=ie(),y=m({state:!1,action:null}),$=m({columns:[{name:"ID",field:"ID",label:"ID",align:"center"},{name:"code",field:"CODIGO",label:"Codigo",align:"center",sortable:!0},{name:"desc",field:"DESCRIPCION",label:"Descripcion",align:"left"},{name:"stockcedis",field:"CEDIS",label:"Stock (CEDIS)",align:"center",sortable:!0},{name:"stockpan",field:"PANTACO",label:"Stock (PAN)",align:"center",sortable:!0}],filter:""}),_={pndcs:{l:"Habilitar todo",c:"indigo-13",desc:"Los productos en esta lista se habilitaran y podran ser solicitados por cuaqluier tienda."},pdss:{l:"Deshabilitar todo",c:"pink-13",desc:"Los productos en esta lista se deshabilitaran y no podran ser solicitados."}},P=S,v=x,u=m(v.rows),f=m(v.name),g=m(v.type),L=q(()=>g.value?_[g.value]:{l:"",c:""}),O=()=>{const V=_[g.value];y.value.action=V,y.value.state=!0},D=async()=>{p.loading.show({message:"Espera..."});const V=await z.massiveAction({action:g.value});console.log(V),V.status==200?(V.data,y.value.state=!1,y.value.action=null,p.loading.hide(),p.notify({position:"center",color:"positive",icon:"done"}),P("cardResumeActived")):(console.error(V.data),alert(`Error ${V.status}: ${V.data.msg}`))},U=(V,E,A)=>{console.log(V),console.log(E),console.log(A),console.log(g.value)};return(V,E)=>(d(),k(T,null,[e(Z,{"row-key":"ID",rows:u.value,columns:$.value.columns,filter:$.value.filter,onRowClick:U},{top:t(()=>[s("div",Pt,c(f.value),1),s("div",Et,[e(C,{color:L.value.c,icon:"warning",label:L.value.l,onClick:O},null,8,["color","label"]),e(be,{modelValue:$.value.filter,"onUpdate:modelValue":E[0]||(E[0]=A=>$.value.filter=A),dense:"",type:"text",icon:"search",label:"Buscar"},{prepend:t(()=>[e(X,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter"]),e(F,{modelValue:y.value.state,"onUpdate:modelValue":E[1]||(E[1]=A=>y.value.state=A),persistent:""},{default:t(()=>[e(B,null,{default:t(()=>[e(I,{class:"row items-center"},{default:t(()=>[e(he,{icon:"warning",color:y.value.action.c,"text-color":"white"},null,8,["color"]),s("span",At,c(y.value.action.l),1)]),_:1}),e(I,null,{default:t(()=>[b(c(y.value.action.desc),1)]),_:1}),e(le,{align:"right"},{default:t(()=>[W(e(C,{flat:"",label:"cancelar",color:"primary"},null,512),[[ve]]),e(C,{flat:"",label:"continuar",color:"primary",onClick:D})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},qt={key:0,class:"bg-negative text-white q-pa-md q-mb-md"},Mt={class:"text-h6"},Ut={class:"row q-mb-md items-start justify-around"},Rt={class:"text-left"},Tt={class:"text-h5"},zt={class:"text--2"},Lt={class:"full-width row items-center"},Ot={class:"col text-h6 text-dark"},jt={__name:"AdminDashboard",props:{dash:{type:Object,default:{}}},emits:["reloadDashboard","freshOrder"],setup(x,{emit:S}){ge(),Ce();const p=Se(),y=ne(),$=ie(),_=["text-grey-5 text-bold","text-bold text-h6 text-red","text-indigo","4","5","text-bold text-pink-7","text-orange-8","8","text-primary","text-positive"],P=S,v=m({columns:[{name:"id",label:"Folio",field:"id",align:"center",sortable:!0},{name:"state",label:"Estado",field:i=>i.log.length==1?i.log[0].name:i.log[i.log.length-1].name,align:"left",sortable:!0,sort:(i,r,n,w)=>parseInt(n._status)-parseInt(w._status),classes:i=>_[i._status?parseInt(i._status)-1:parseInt(i.status.id)-1]},{name:"suplier",label:"Surtidores",field:i=>{var r;return(r=i.partition)==null?void 0:r.length},align:"center",classes:"text-bold"},{name:"laststate",label:"Ultima actividad",field:i=>ae(i.log.find(r=>r.id==i.status.id).pivot.updated_at).format("YYYY-MM-DD hh:mm A"),align:"left"},{name:"from",label:"Sucursal",field:i=>i.from.name.toUpperCase(),align:"left",sortable:!0},{name:"to",label:"Destino",field:i=>i.to.name.toUpperCase(),align:"left",sortable:!0},{name:"notes",label:"Notas",field:i=>i.notes,align:"left",classes:"text-orange text-bold"},{name:"tmodels",label:"Modelos",field:i=>i.products_count,align:"center",sortable:!0}],filter:"",pagination:{sortBy:"desc",descending:!1,rowsPerPage:20}}),u=m(!1),f=m({state:!1,title:"",data:null,name:null,type:null}),g=m({state:!1,head:null,block:!0}),L=q(()=>y.ordersSize),O=q(()=>y.ordersok.filter(i=>i._status!=100&&i._workpoint_to==p.session.store.id_viz)),D=q(()=>y.ordersok.filter(i=>i._status==100)),U=q(()=>y.orderserrors),V=q(()=>y.resume),E=async i=>{console.log(i.row),g.value.head=i.row,g.value.state=!0},A=async i=>{$.loading.show({message:"cargando..."+i});const r=await z.report(i);console.log(r.data),f.value.data=r.data.rows,f.value.name=r.data.name,f.value.type=i,f.value.state=!0,$.loading.hide()},Y=()=>{f.value.state=!1,f.state=!1,P("reloadDashboard")},ee=(i,r=!1)=>{console.log(i),r&&(g.value.state=!1),P("freshOrder",i)},H=()=>{u.value=!0};return(i,r)=>(d(),h(Je,{padding:"",class:"bg-grey-2"},{default:t(()=>[U.value.length?(d(),k("div",qt,[r[6]||(r[6]=s("div",{class:"text-warning text-bold"},"Los siguientes folios tienen errores que no permiten ser listados en la tabla. ",-1)),s("div",Mt,c(U.value.map(n=>n.id).join("id")),1),r[7]||(r[7]=s("div",{class:"text--2"},"Errores comunes: Sin log, Sin fecha, Estatus desconocido",-1))])):N("",!0),s("div",Ut,[(d(!0),k(T,null,J(V.value,n=>(d(),h(C,{stack:"","no-caps":"",class:"q-py-md",key:n.key,onClick:w=>A(n.key),color:n.total==0?"teal-10":"pink-13",disabled:n.total==0},{default:t(()=>[s("div",Rt,[s("div",Tt,c(n.total),1),s("div",zt,c(n.name),1)])]),_:2},1032,["onClick","color","disabled"]))),128))]),e(Z,{flat:"",bordered:"","row-key":"id",rows:O.value,columns:v.value.columns,filter:v.value.filter,pagination:v.value.pagination},{top:t(()=>[s("div",Lt,[s("div",Ot,"Pedidos: "+c(L.value),1),e(be,{dense:"",modelValue:v.value.filter,"onUpdate:modelValue":r[0]||(r[0]=n=>v.value.filter=n),"input-class":"text-uppercase",placeholder:"Buscar",color:"pink-5"},{append:t(()=>[e(X,{name:"search"})]),_:1},8,["modelValue"]),e(M,{spaced:"",inset:"",vertical:"",dark:""}),s("div",null,[e(X,{name:"archive",size:"md",color:"negative",onClick:H})])])]),header:t(n=>[e(re,{props:n},{default:t(()=>[e(ye,{"auto-width":""}),(d(!0),k(T,null,J(n.cols,w=>(d(),h(ye,{key:w.name,props:n},{default:t(()=>[b(c(w.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:t(n=>[e(re,{props:n},{default:t(()=>[e(de,{"auto-width":""},{default:t(()=>[n.row?(d(),h(C,{key:0,size:"sm",dense:"",round:"",flat:"",onClick:w=>n.expand=!n.expand,icon:n.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])):N("",!0)]),_:2},1024),(d(!0),k(T,null,J(n.cols,w=>(d(),h(de,{key:w.name,props:n,onClick:te=>E(n)},{default:t(()=>[b(c(w.value),1)]),_:2},1032,["props","onClick"]))),128))]),_:2},1032,["props"]),W(e(re,{props:n},{default:t(()=>[e(de,{colspan:"100%"},{default:t(()=>[e(pe,{dense:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(oe,null,{default:t(()=>[e(Q,null,{default:t(()=>r[8]||(r[8]=[b("ID")])),_:1}),e(Q,null,{default:t(()=>r[9]||(r[9]=[b("ESTADO")])),_:1}),n.row.from._type==2?(d(),h(Q,{key:0},{default:t(()=>r[10]||(r[10]=[b("SALIDA")])),_:1})):N("",!0),n.row.from._type==2?(d(),h(Q,{key:1},{default:t(()=>r[11]||(r[11]=[b("ENTRADA")])),_:1})):N("",!0),n.row.from._type==1?(d(),h(Q,{key:2},{default:t(()=>r[12]||(r[12]=[b("TRASPASO")])),_:1})):N("",!0)]),_:2},1024),(d(!0),k(T,null,J(n.row.partition,(w,te)=>(d(),k("div",{key:te},[e(oe,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(se,{overline:""},{default:t(()=>[b(c(w._suplier),1)]),_:2},1024),e(se,{caption:""},{default:t(()=>[b(c(w.id),1)]),_:2},1024)]),_:2},1024),e(Q,{class:Le(`${_[w.status.id-1]}`)},{default:t(()=>[b(c(w.status.name),1)]),_:2},1032,["class"]),n.row.from._type==2?(d(),h(Q,{key:0},{default:t(()=>[b(c(w.invoice),1)]),_:2},1024)):N("",!0),n.row.from._type==2?(d(),h(Q,{key:1},{default:t(()=>[b(c(w.invoice_received),1)]),_:2},1024)):N("",!0),n.row.from._type==1?(d(),h(Q,{key:2},{default:t(()=>[b(c(w.invoice),1)]),_:2},1024)):N("",!0)]),_:2},1024),e(M,{spaced:"",inset:""})]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),[[Oe,n.expand]])]),_:1},8,["rows","columns","filter","pagination"]),e(F,{"full-width":"",modelValue:g.value.state,"onUpdate:modelValue":r[3]||(r[3]=n=>g.value.state=n),persistent:g.value.block,"no-esc-dismiss":g.value.block,"no-backdrop-dismiss":g.value.block},{default:t(()=>[e(It,{head:g.value.head,onLoaded:r[1]||(r[1]=n=>g.value.block=!1),onLoading:r[2]||(r[2]=n=>g.value.block=!0),onFresh:ee,onChofiAssigned:ee},null,8,["head"])]),_:1},8,["modelValue","persistent","no-esc-dismiss","no-backdrop-dismiss"]),e(F,{modelValue:f.value.state,"onUpdate:modelValue":r[4]||(r[4]=n=>f.value.state=n)},{default:t(()=>[e(Nt,{rows:f.value.data,name:f.value.name,type:f.value.type,onCardResumeActived:Y},null,8,["rows","name","type"])]),_:1},8,["modelValue"]),e(F,{modelValue:u.value,"onUpdate:modelValue":r[5]||(r[5]=n=>u.value=n),"full-width":""},{default:t(()=>[e(B,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(I,{class:"q-pt-none"},{default:t(()=>[e(Z,{flat:"",bordered:"","row-key":"id",rows:D.value,columns:v.value.columns,pagination:v.value.pagination,title:"Pedidos Cancelados"},null,8,["rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const Bt={class:"q-pa-md"},Ft={class:"q-pb-sm"},Yt={key:0},$a={__name:"dashboard",setup(x){const S=ge();Ce();const p=ne();ie(),Se();const y=m({val:null}),$=m(!1),_=async()=>{p.setTitle("Dashboard"),p.setButtonShow(!0)},P=v=>{console.log("orderViewer/AdminDashboard actualizaron el pedido:",v.id),$e.emit("order_refresh",{order:v})};return je(()=>S.query,()=>{_()}),_(),(v,u)=>(d(),k(T,null,[e(F,{modelValue:$.value,"onUpdate:modelValue":u[2]||(u[2]=f=>$.value=f)},{default:t(()=>[e(B,{class:"my-card"},{default:t(()=>[e(I,null,{default:t(()=>[s("div",Bt,[s("div",Ft,c(y.value.val),1),e(qe,{modelValue:y.value.val,"onUpdate:modelValue":u[0]||(u[0]=f=>y.value.val=f),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(I,null,{default:t(()=>[e(le,{align:"right"},{default:t(()=>[e(C,{flat:"",icon:"close",color:"negative",onClick:u[1]||(u[1]=f=>$.value=!$.value)}),e(C,{flat:"",icon:"check",color:"positive",onClick:v.buscas},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),K(p).showLoad?(d(),k("div",Yt,[e(at,{showing:K(p).showLoad},{default:t(()=>[e(tt,{size:"5.5em",color:"primary"}),u[3]||(u[3]=b(" Obteniendo Datos... "))]),_:1},8,["showing"])])):(d(),h(jt,{key:1,onReload:_,onFreshOrder:P}))],64))}};export{$a as default};
