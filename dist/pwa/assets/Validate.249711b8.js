import{Q as P,a as N,b as g}from"./QTr.c07ba4fd.js";import{j as A,r as w,c as I,k as Q,m as R,v as Y,p as H,aj as K,Q as S,o as E,a as q,w as n,e as l,b1 as z,Y as L,aE as G,i as m,a4 as v,a3 as M,a$ as W,h as J,a5 as X,f as Z}from"./index.18948765.js";import{d as ee,Q as te}from"./QSelect.541e9acb.js";import{Q as oe}from"./QSeparator.3f6b0880.js";import{Q as O}from"./QInput.4b8e442d.js";import{d as j,Q as le}from"./deposits.61b184f5.js";import{Q as ae}from"./QTable.8d93edc8.js";import{Q as U,a as B}from"./QCard.d31c4412.js";import{Q as F}from"./QDialog.dfebcf04.js";import{Q as ne}from"./QDate.e845cb84.js";import{Q as se}from"./QCardActions.9c849ad1.js";import{Q as ie}from"./QPage.411556de.js";import{u as ue}from"./VDB.fe3c82ee.js";import"./ClosePopup.ddf3b2e5.js";import{u as re}from"./use-quasar.d1bf4622.js";import{d as ce}from"./dayjs.min.25545ff6.js";import"./jspdf.plugin.autotable.860e9e77.js";import"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{$socket as V}from"./socket.272efe99.js";import"./use-key-composition.3e16e653.js";import"./uid.42677368.js";import"./position-engine.091e5ef3.js";import"./rtl.b51694b1.js";import"./axios.eed4c97e.js";import"./axios.f1f32898.js";import"./QList.5fa3e6ad.js";import"./QLinearProgress.9a128f51.js";import"./QCheckbox.22b77735.js";import"./use-cache.b0833c75.js";import"./date.7a412cb9.js";import"./_commonjsHelpers.88e99c8f.js";function C(o,f=new WeakMap){if(Object(o)!==o)return o;if(f.has(o))return f.get(o);const s=o instanceof Date?new Date(o):o instanceof RegExp?new RegExp(o.source,o.flags):o instanceof Set?new Set:o instanceof Map?new Map:typeof o.constructor!="function"?Object.create(null):o.prototype!==void 0&&typeof o.prototype.constructor=="function"?o:new o.constructor;if(typeof o.constructor=="function"&&typeof o.valueOf=="function"){const u=o.valueOf();if(Object(u)!==u){const r=new o.constructor(u);return f.set(o,r),r}}return f.set(o,s),o instanceof Set?o.forEach(u=>{s.add(C(u,f))}):o instanceof Map&&o.forEach((u,r)=>{s.set(r,C(u,f))}),Object.assign(s,...Object.keys(o).map(u=>({[u]:C(o[u],f)})))}var de=A({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(o,{slots:f,emit:s}){const{proxy:u}=R(),{$q:r}=u,y=w(null),c=w(""),i=w("");let b=!1;const _=I(()=>Y({initialValue:c.value,validate:o.validate,set:x,cancel:k,updatePosition:D},"value",()=>i.value,p=>{i.value=p}));function x(){o.validate(i.value)!==!1&&(h()===!0&&(s("save",i.value,c.value),s("update:modelValue",i.value)),$())}function k(){h()===!0&&s("cancel",i.value,c.value),$()}function D(){H(()=>{y.value.updatePosition()})}function h(){return K(i.value,c.value)===!1}function $(){b=!0,y.value.hide()}function T(){b=!1,c.value=C(o.modelValue),i.value=C(o.modelValue),s("beforeShow")}function t(){s("show")}function a(){b===!1&&h()===!0&&(o.autoSave===!0&&o.validate(i.value)===!0?(s("save",i.value,c.value),s("update:modelValue",i.value)):s("cancel",i.value,c.value)),s("beforeHide")}function e(){s("hide")}function d(){const p=f.default!==void 0?[].concat(f.default(_.value)):[];return o.title&&p.unshift(Q("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},o.title)),o.buttons===!0&&p.push(Q("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[Q(S,{flat:!0,color:o.color,label:o.labelCancel||r.lang.label.cancel,onClick:k}),Q(S,{flat:!0,color:o.color,label:o.labelSet||r.lang.label.set,onClick:x})])),p}return Object.assign(u,{set:x,cancel:k,show(p){y.value!==null&&y.value.show(p)},hide(p){y.value!==null&&y.value.hide(p)},updatePosition:D}),()=>{if(o.disable!==!0)return Q(ee,{ref:y,class:"q-popup-edit",cover:o.cover,onBeforeShow:T,onShow:t,onBeforeHide:a,onHide:e,onEscapeKey:k},d)}}});const fe=m("div",{class:"col-2 q-table__title"},"Depositos",-1),me={class:"text-bold text-left"},ve={class:"text-bold text-center"},pe={class:"text-bold text-center"},ge={class:"text-bold text-center"},be={class:"text-bold text-center"},_e={class:"text-bold text-left"},ye={class:"text-bold text-center"},we={class:"text-bold text-center"},ke=["src"],Ve={class:"text-h6"},xe={class:"text-subtitle2"},he={class:"q-pa-md"},Qe=m("div",{class:"q-pb-sm"},null,-1),at={__name:"Validate",setup(o){const f=ue(),s=re(),u=V.connect();u.connected?console.log(`%c Connect ${u.id} `,"background: #222; color: #bada55"):console.log("%c No hay conexion en el socket ","background: #222; color: #bada55"),V.emit("Conexion",f),V.on("Room",t=>{console.log(t)}),V.on("StoreList",t=>{console.log(t),_.value.push(t)}),V.on("ChangeStatus",t=>{let a=_.value.findIndex(e=>e.id==t.id);a>=0&&(_.value[a].status=t.status,_.value[a]._status=t._status,s.notify({message:`El deposito de $ ${t.import} cambio de status a ${t.status.name}`,type:`${t.status.id==2?"positive":"negative"}`,position:"center"}))});const r=w({state:!1,val:null}),y=["yellow-11","green-11","red-11"],c=w({val:null,opts:[]}),i=w(!1),b=w(null),_=w([]),x=w({columns:[{name:"id",label:"Id",align:"center",field:t=>t.id},{name:"created",label:"Creado por",align:"center",field:t=>t.send_by},{name:"store",label:"Sucursal",align:"center",field:t=>t.store.name},{name:"origin",label:"Origen",align:"center",field:t=>t.origin},{name:"destiny",label:"Destino",align:"center",field:t=>t.destiny},{name:"concept",label:"Concepto",align:"left",field:t=>t.concept},{name:"reference",label:"Referencia / Folio",align:"center",field:t=>t.refernce},{name:"amount",label:"Importe",align:"center",field:t=>t.amount},{name:"status",label:"Estado",align:"left",field:t=>t.status.name},{name:"ticket",label:"Ticket",align:"center",field:t=>t.ticket},{name:"picture",label:"Foto",align:"center",field:t=>t.picture}]}),k=I(()=>c.value.val?_.value.filter(t=>t._status==c.value.val.id):_.value),D=async()=>{let t=new Date,a=ce(t).format("YYYY/MM/DD");b.value=a,console.log(a),s.loading.show({message:"Obteniendo Datos"});const e=await j.getFormStore(f.session.store.id,{filt:b.value});e.fail?console.log(e):(console.log(e),s.loading.hide(),_.value=e.deposit,c.value.opts=e.status)},h=t=>{r.value.val=t,r.value.state=!0},$=async()=>{console.log(b.value),s.loading.show({message:"Obteniendo Datos"});const t=await j.getFormStore(f.session.store.id,{filt:b.value});t.fail?console.log(t):(console.log(t),s.loading.hide(),_.value=t.deposit,i.value=!1)},T=async t=>{console.log(t),s.loading.show({message:"Poniendo Ticket"});let a={id:t.id,ticket:t.ticket};console.log(a);const e=await j.changeTicket(a);console.log(e),e.fail?console.log(e):(s.loading.hide(),t.ticket=t.ticket,V.emit("ChangeTicket",e),s.notify({message:"Se agrego Ticket",type:"positive"}))};return D(),(t,a)=>(E(),q(ie,{padding:""},{default:n(()=>[l(ae,{title:"Depositos",rows:Z(k),"row-key":"id","rows-per-page-options":[0],separator:"cell",columns:x.value.columns},{top:n(e=>[fe,l(P),l(te,{modelValue:c.value.val,"onUpdate:modelValue":a[1]||(a[1]=d=>c.value.val=d),options:c.value.opts,label:"Estado","option-label":"name",filled:"",style:{width:"200px"}},z({_:2},[c.value.val?{name:"append",fn:n(()=>[l(L,{name:"cancel",onClick:a[0]||(a[0]=G(d=>c.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),l(oe,{spaced:"",inset:"",vertical:""}),l(S,{color:"primary",icon:"event",onClick:a[2]||(a[2]=d=>i.value=!i.value),flat:"",round:""})]),body:n(e=>[l(N,{props:e},{default:n(()=>[l(g,{key:"id",props:e},{default:n(()=>[m("div",me,v(e.row.id),1)]),_:2},1032,["props"]),l(g,{key:"created",props:e},{default:n(()=>[m("div",ve,v(e.row.send_by),1)]),_:2},1032,["props"]),l(g,{key:"store",props:e},{default:n(()=>[m("div",pe,v(e.row.store.name),1)]),_:2},1032,["props"]),l(g,{key:"origin",props:e},{default:n(()=>[m("div",ge,v(e.row.origin),1)]),_:2},1032,["props"]),l(g,{key:"destiny",props:e},{default:n(()=>[m("div",be,v(e.row.destiny),1)]),_:2},1032,["props"]),l(g,{key:"concept",props:e},{default:n(()=>[m("div",_e,v(e.row.concept),1)]),_:2},1032,["props"]),l(g,{key:"reference",props:e},{default:n(()=>[m("div",ye,v(e.row.refernce),1)]),_:2},1032,["props"]),l(g,{key:"amount",props:e},{default:n(()=>[m("div",we,"$ "+v(Number(e.row.import).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),_:2},1032,["props"]),l(g,{key:"status",props:e},{default:n(()=>[l(O,{modelValue:e.row.status.name,"onUpdate:modelValue":d=>e.row.status.name=d,type:"text",filled:"","bg-color":y[e.row.status.id-1],dense:"",disable:!0},null,8,["modelValue","onUpdate:modelValue","bg-color"])]),_:2},1032,["props"]),l(g,{key:"ticket",props:e},{default:n(()=>[M(v(e.row.ticket)+" ",1),e.row.ticket==null&&e.row._status==2?(E(),q(de,{key:0,modelValue:e.row.ticket,"onUpdate:modelValue":[d=>e.row.ticket=d,d=>T(e.row)],title:"Ticket",buttons:"","label-set":"Guardar","label-cancel":"Cancelar"},{default:n(d=>[l(O,{modelValue:d.value,"onUpdate:modelValue":p=>d.value=p,dense:"",autofocus:"",onKeyup:W(d.set,["enter"]),mask:"#-######"},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])):J("",!0)]),_:2},1032,["props"]),l(g,{key:"picture",props:e,onClick:d=>h(e.row)},{default:n(()=>[e.row.picture!=null?(E(),q(le,{key:0,src:`http://192.168.10.160:1920/Assist/public/storage/${e.row.picture}`,ratio:1.7,"spinner-color":"primary","spinner-size":"20px",style:{width:"100px"}},null,8,["src","ratio"])):(E(),q(X,{key:1,rounded:"",size:"100px","font-size":"52px",color:"white","text-color":"primary",icon:"close"}))]),_:2},1032,["props","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),l(F,{modelValue:r.value.state,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.state=e)},{default:n(()=>[l(U,{class:"my-card"},{default:n(()=>[m("img",{src:`http://192.168.10.160:1920/Assist/public/storage/${r.value.val.picture}`},null,8,ke),l(B,null,{default:n(()=>[m("div",Ve,"Creado: "+v(r.value.val.send_by),1),m("div",xe,"Estado: "+v(r.value.val.status.name),1)]),_:1}),l(B,null,{default:n(()=>[M(v(r.value.val.concept),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(F,{modelValue:i.value,"onUpdate:modelValue":a[6]||(a[6]=e=>i.value=e)},{default:n(()=>[l(U,{class:"my-card"},{default:n(()=>[l(B,null,{default:n(()=>[m("div",he,[Qe,l(ne,{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=e=>b.value=e),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),l(B,null,{default:n(()=>[l(se,{align:"right"},{default:n(()=>[l(S,{flat:"",icon:"close",color:"negative",onClick:a[5]||(a[5]=e=>i.value=!i.value)}),l(S,{flat:"",icon:"check",color:"positive",onClick:$})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{at as default};
