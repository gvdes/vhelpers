import{aI as X,a as W,u as Y,r as x,c as z,p as Z,o as c,d as y,w as s,e as a,f as l,S as q,aJ as R,h as k,a4 as tt,g as v,al as p,a0 as d,ak as et,a1 as u,a3 as ot,a2 as it,Q as g}from"./index.12b3a7c1.js";import{Q as A,a as B}from"./QSelect.1404ab8d.js";import{Q as at}from"./QInput.9dbdf573.js";import{b as w,Q as st,a as lt,d as nt,e as rt}from"./QList.7f8182ad.js";import{Q as P}from"./QCardSection.9bd848f8.js";import{Q as S}from"./QImg.7e232ea9.js";import{Q as M}from"./QBtnGroup.702f234e.js";import{Q as D}from"./QCard.4a889fef.js";import{Q as dt}from"./QPageSticky.4a0478ca.js";import{Q as ct}from"./QTable.56072af5.js";import{Q as ut}from"./QPage.ee10d0f3.js";import{T as mt}from"./TouchSwipe.3f69ab59.js";import"./dayjs.min.cbcf888d.js";import{c as pt,a as vt}from"./catalogStore.281d82d1.js";import{u as ft}from"./use-quasar.f8a15415.js";import"./QDrawer.4e689d01.js";import"./QExpansionItem.4000b634.js";import"./QCardActions.6578157c.js";import"./ClosePopup.99fed926.js";import{v as V}from"./axios.625ee8ad.js";import"./socket.05630e21.js";import"./Restock.43da7470.js";import"./use-key-composition.5fa40af5.js";import"./QLinearProgress.1f9d5704.js";import"./QCheckbox.8628b5f4.js";import"./use-checkbox.996a7f11.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.ff1515e2.js";import"./QScrollObserver.ed6f50ea.js";import"./QToolbar.5bf1aa24.js";import"./QForm.1547fa35.js";import"./QRadio.5c0cd94b.js";import"./QTd.90f89e02.js";import"./QPopupEdit.0988a20b.js";import"./QTr.bd01eec7.js";import"./QLayout.cec6e6ea.js";import"./jspdf.plugin.autotable.c5200c4a.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const gt={class:"row justify-end q-gutter-sm full-width"},_t={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},kt={class:"col"},bt={class:"text-bold"},ht={class:"col"},xt={class:"text-bold"},yt={class:"col"},wt={class:"row"},Ct={class:"text-caption"},Pt={class:"text-caption"},Qt={class:"text-caption"},qt={class:"text-caption"},St=["onClick"],Vt={key:1,class:"col-6 flex flex-center bg-grey-2",style:{height:"100%"}},$t={class:"col-6 q-pa-sm flex flex--column justify-between"},Nt={class:"text-center text-bold text-red-10"},zt={class:"q-mt-md"},Rt={class:"col"},At={class:"text-bold"},Bt={key:0,class:"col"},Mt={class:"text-bold"},Dt={key:1,class:"col"},jt={key:0,class:"col"},It={key:1,class:"col"},Tt={class:"q-ml-md q-mr-md text-white bg-primary"},Ft={class:"row q-pt-xs"},$e={__name:"viewCatalogFamily",setup(Ut){const $=X();W();const n=pt(),N=ft(),C=Y(),b=x({state:!1,val:null}),Q=x([]),m=x({pagination:{rowsPerPage:12,page:1},filter:""}),_=x({val:{id:2,label:"Mayor a 1"},opts:[{id:1,label:"Agotados"},{id:2,label:"Mayor a 1"},{id:3,label:"Mayor a 25"},{id:4,label:"Mayor a 50"},{id:5,label:"Mayor a 100"}]}),f=x({val:null,opts:[]}),j=z(()=>Math.ceil(Q.value.length/m.value.pagination.rowsPerPage)),I=z(()=>Q.value.filter(e=>{var i;const o=f.value.val?e._category===f.value.val.id:!0;let t=!0;if(_.value.val){const r=(i=e.stocks.reduce((h,K)=>h+Number(K.pivot.stock),0))!=null?i:0;switch(_.value.val.id){case 1:t=r===0;break;case 2:t=r>1;break;case 3:t=r>25;break;case 4:t=r>50;break;case 5:t=r>100;break}}return o&&t})),T=async()=>{N.loading.show({message:"Obteniendo Hijos"}),console.log($.params.fid);const e={family:$.params.fid,workpoint:C.session.store.id_viz},o=await vt.getFamilysProducts(e);if(o.fail)console.log(o);else{n.setTitle(`Cat\xE1logo ${o.family.name}`),f.value.opts=o.categories;const t=o.family.products.map(i=>({...i,order:0}));if(n.orderState)for(const i of t){const r=n.order.products.find(h=>h.id===i.id);r&&(i.pivot=r.pivot)}if(n.requisitionState)for(const i of t){const r=n.requisition.products.find(h=>h.id===i.id);r&&(i.pivot=r.pivot)}Q.value=t,N.loading.hide()}},F=e=>{b.value.state=!0,b.value.val=e},U=e=>{const o={order:n.order.id,_product:e.id,units:1,price:e.prices.find(t=>t.id==1).pivot.price,total:e.prices.find(t=>t.id==1).pivot.price,amount:1,amountDelivered:0,toDelivered:0,_price_list:1,_supply_by:1};e.pivot={...o},n.pushProduct(e)},L=e=>{e.pivot.amount++,e.pivot.units++,e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProduct(e)},O=e=>{e.pivot.amount--,e.pivot.units--,e.pivot.amount<=0?(delete e.pivot,n.removeProduct(e.id)):(e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProduct(e))},E=e=>{const o={_requisition:n.requisition.id,_product:e.id,amount:1,_supply_by:1,units:1,cost:e.prices.find(t=>t.id==1).pivot.price,total:e.prices.find(t=>t.id==1).pivot.price,comments:null,stock:e.stocks.find(t=>t.id==1).pivot.stock,ipack:null};e.pivot={...o},n.pushProductRequisition(e)},G=e=>{e.pivot.amount++,e.pivot.units++,e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProductRequisition(e)},H=e=>{e.pivot.amount--,e.pivot.units--,e.pivot.amount<=0?(delete e.pivot,n.removeProductRequisition(e.id)):(e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProductRequisition(e))},J=({evt:e,...o})=>{let t=1,i=j.value;o.direction=="left"&&m.value.pagination.page<i?m.value.pagination.page++:o.direction=="right"&&m.value.pagination.page>t&&m.value.pagination.page--};return Z(()=>{T()}),(e,o)=>(c(),y(ut,{padding:""},{default:s(()=>[a(ct,{rows:I.value,"row-key":"id",grid:"",pagination:m.value.pagination,filter:m.value.filter,"onUpdate:pagination":o[5]||(o[5]=t=>m.value.pagination=t)},{top:s(()=>[l("div",gt,[a(A,{modelValue:_.value.val,"onUpdate:modelValue":o[1]||(o[1]=t=>_.value.val=t),options:_.value.opts,label:"Stocks",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:s(()=>[_.value.val!==null?(c(),y(q,{key:0,name:"close",onClick:o[0]||(o[0]=R(t=>_.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):k("",!0)]),_:1},8,["modelValue","options"]),a(A,{modelValue:f.value.val,"onUpdate:modelValue":o[3]||(o[3]=t=>f.value.val=t),options:f.value.opts,"option-label":"name",label:"Categor\xEDas",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:s(()=>[f.value.val!==null?(c(),y(q,{key:0,name:"close",onClick:o[2]||(o[2]=R(t=>f.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):k("",!0)]),_:1},8,["modelValue","options"]),a(at,{dense:"",debounce:"300",modelValue:m.value.filter,"onUpdate:modelValue":o[4]||(o[4]=t=>m.value.filter=t),placeholder:"Buscar",class:"col-auto",outlined:""},{append:s(()=>[a(q,{name:"search"})]),_:1},8,["modelValue"])])]),item:s(t=>[tt((c(),v("div",_t,[a(D,{flat:"",bordered:""},{default:s(()=>[a(P,{class:"text-center row"},{default:s(()=>[l("div",kt,[o[7]||(o[7]=p(" Codigo: ")),l("span",bt,d(t.row.code),1)]),l("div",ht,[o[8]||(o[8]=p(" CCO: ")),l("span",xt,d(t.row.name),1)]),l("div",yt,[l("div",null,[o[9]||(o[9]=p(" STOCK: ")),l("span",{class:et(["text-bold",t.row.stocks.find(i=>i.id==u(C).session.store.id_viz).pivot.stock<=0?"text-red":""])},d(t.row.stocks.find(i=>i.id==u(C).session.store.id_viz).pivot.stock<=0?"Agotado":t.row.stocks.find(i=>i.id==u(C).session.store.id_viz).pivot.stock),3)]),l("div",wt,[l("div",Ct,[p(d(t.row.stocks.find(i=>i.id==1).alias)+" ",1),l("div",Pt,d(t.row.stocks.find(i=>i.id==1).pivot.stock),1)]),a(w,{spaced:"",inset:"",vertical:"",dark:""}),l("div",Qt,[p(d(t.row.stocks.find(i=>i.id==2).alias)+" ",1),l("div",qt,d(t.row.stocks.find(i=>i.id==2).pivot.stock),1)])])])]),_:2},1024),a(w),a(P,{class:"row items-stretch",tyle:"min-height: 260px;"},{default:s(()=>[t.row.imgcover?(c(),v("div",{key:0,class:"col-6 flex flex-center bg-grey-2",onClick:i=>F(`${u(V)}/Products/${t.row.id}/${t.row.imgcover}`),style:{height:"100%"}},[a(S,{src:`${u(V)}/Products/${t.row.id}/${t.row.imgcover}`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])],8,St)):(c(),v("div",Vt,[a(S,{src:`${u(V)}/Products/sinpicture.png`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])])),l("div",$t,[l("div",Nt,d(t.row.description),1),a(w,{spaced:"",inset:"",vertical:"",dark:""}),l("div",zt,[(c(!0),v(ot,null,it(t.row.prices,(i,r)=>(c(),v("div",{key:r},[a(lt,{bordered:"",dense:""},{default:s(()=>[a(nt,null,{default:s(()=>[a(rt,null,{default:s(()=>[a(B,{class:"text-center text-bold"},{default:s(()=>[p(d(i.name),1)]),_:2},1024),a(B,{class:"text-center"},{default:s(()=>[p("$ "+d(i.pivot.price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),a(w,{spaced:"",inset:"",vertical:"",dark:""})])]),_:2},1024),a(w),a(P,{class:"text-center row"},{default:s(()=>[l("div",Rt,[o[10]||(o[10]=p(" Piezas X Caja: ")),l("span",At,d(t.row.pieces),1)]),t.row.large?(c(),v("div",Bt,[o[11]||(o[11]=p(" MED: ")),l("span",Mt,d(t.row.large),1)])):k("",!0),u(n).orderState||u(n).requisitionState?(c(),v("div",Dt,[t.row.pivot?(c(),v("div",It,[a(M,{rounded:"",class:"bg-primary"},{default:s(()=>[a(g,{size:"sm",color:"primary",icon:"remove",onClick:i=>u(n).orderState?O(t.row):H(t.row)},null,8,["onClick"]),l("div",Tt,d(t.row.pivot.amount),1),a(g,{size:"sm",color:"primary",icon:"add",onClick:i=>u(n).orderState?L(t.row):G(t.row)},null,8,["onClick"])]),_:2},1024)])):(c(),v("div",jt,[a(g,{color:t.row.stocks.reduce((i,r)=>i+Number(r.pivot.stock),0)<=0?"negative":"primary",rounded:"",label:t.row.stocks.reduce((i,r)=>i+Number(r.pivot.stock),0)<=0?"Agotado":"Agregar",onClick:i=>u(n).orderState?U(t.row):E(t.row),size:"sm",disable:t.row.stocks.reduce((i,r)=>i+Number(r.pivot.stock),0)<=0},null,8,["color","label","onClick","disable"])]))])):k("",!0)]),_:2},1024)]),_:2},1024)])),[[mt,J,void 0,{horizontal:!0}]])]),bottom:s(t=>[a(dt,{position:"bottom",class:"full-width",offset:[0,18]},{default:s(()=>[l("div",Ft,[a(M,{rounded:"",class:""},{default:s(()=>[t.pagesNumber>2?(c(),y(g,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):k("",!0),a(g,{icon:"chevron_left",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),a(g,{flat:"",disable:"","no-caps":""},{default:s(()=>[p(d(t.pagination.page)+" / "+d(t.pagesNumber),1)]),_:2},1024),a(g,{icon:"chevron_right",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),t.pagesNumber>2?(c(),y(g,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:t.lastPage,class:"q-px-sm"},null,8,["onClick"])):k("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","pagination","filter"]),a(st,{modelValue:b.value.state,"onUpdate:modelValue":o[6]||(o[6]=t=>b.value.state=t)},{default:s(()=>[a(D,{flat:"",class:"bg-transparent",style:{width:"700px","max-width":"80vw"}},{default:s(()=>[a(P,{class:"flex flex-center"},{default:s(()=>[a(S,{src:b.value.val,"spinner-color":"primary",style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{$e as default};
