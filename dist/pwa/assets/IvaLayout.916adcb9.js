import{Q as T}from"./position-engine.75ca72ec.js";import{r as f,c as q,I as z,o as c,a as y,w as a,e,a3 as n,a4 as p,f as g,h as V,Q as D,i as l,am as K,an as M,g as B,a1 as G,U as R,W}from"./index.84d07889.js";import{Q as A,a as J}from"./QSelect.fba9119a.js";import{Q as j}from"./QInput.d9712e34.js";import{Q as L}from"./QForm.96f85cb9.js";import{Q as X,a as P}from"./axios.4c6b4e85.js";import{a as Y,_ as Z,Q as ee}from"./UserToolbar.393f8d81.js";import{Q as ae}from"./QDialog.406a97c9.js";import{b as N,c as U,Q as te,a as le,d as se}from"./QLayout.3b9ec00b.js";import{u as oe}from"./VDB.4ef7b1a9.js";import{u as ne}from"./use-quasar.51cd8b23.js";import{Q as F,a as r,b as E}from"./QItem.67f57e1f.js";import{Q as ie}from"./QList.0ec306fd.js";const ue={__name:"Ticket",props:{data:{type:Object,default:null}},emits:["openCashDesk"],setup(I,{emit:_}){const m=f(I.data),t=f(null),b=["6%","8%","16%"],s={"6%":.06,"8%":.08,"16%":.16},u=q(()=>{if(t.value&&m.value){let h=s[t.value],o=parseFloat(m.value.total).toFixed(2);return parseFloat((o*h).toFixed(2))}return 0}),$=()=>{_("openCashDesk",{_inc:u.value,_iva:s[t.value]})};return z(()=>{console.log("El componente ha muerto!!")}),(h,o)=>(c(),y(N,{style:{"min-width":"400px"},flat:"",bordered:""},{default:a(()=>[e(ie,{bordered:""},{default:a(()=>[e(F,null,{default:a(()=>[e(r,null,{default:a(()=>[n("Ticket")]),_:1}),e(r,null,{default:a(()=>[n(p(m.value.ticket),1)]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(r,null,{default:a(()=>[n("Cliente")]),_:1}),e(r,null,{default:a(()=>[n(p(m.value.cliente),1)]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(r,null,{default:a(()=>[n("Fecha")]),_:1}),e(r,null,{default:a(()=>[n(p(m.value.fecha),1)]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(r,null,{default:a(()=>[n("Total")]),_:1}),e(r,null,{default:a(()=>[n("$ "+p(m.value.total),1)]),_:1})]),_:1}),e(T),e(F,{class:"bg-deep-purple-1"},{default:a(()=>[e(r,null,{default:a(()=>[n("IVA")]),_:1}),e(r,null,{default:a(()=>[e(A,{dense:"",modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=i=>t.value=i),options:b,label:"Seleccione",filled:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1}),g(u)?(c(),y(F,{key:0,class:"bg-deep-purple-1"},{default:a(()=>[e(r,null,{default:a(()=>[n("Total")]),_:1}),e(r,null,{default:a(()=>[e(E,{class:"fc-bluegrey text-h4 fw-sbold"},{default:a(()=>[n("$ "+p(g(u)),1)]),_:1}),e(E,{caption:""},{default:a(()=>[n("$ "+p((parseFloat(m.value.total)+parseFloat(g(u))).toFixed(2)),1)]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1}),t.value?(c(),y(Y,{key:0,align:"between"},{default:a(()=>[e(D,{color:"primary",label:"Cancelar",flat:"","no-caps":""}),e(D,{color:"primary",label:"Cobrar",onClick:$})]),_:1})):V("",!0)]),_:1}))}},de={class:"bg-primary row items-center justify-between q-pa-md text-white"},re=l("div",{class:"fs-dec3"},"TICKET",-1),ce={class:"text-h4"},pe={class:"text-right"},me=l("div",{class:"fs-dec3"},"IVA",-1),fe={class:"fw-bold text-h4"},ve={class:"row items-center"},_e=l("div",{class:"col-3"},"Efectivo",-1),be={class:"row"},ye={class:"bg-grey-2 row items-stretch justify-between q-pa-sm"},ge=l("div",{class:"fs-dec1"},"Cambio:",-1),he={class:"text-h5 fw-sbold fc-primary"},ke=l("div",{class:"fs-dec1"},"Falta:",-1),Qe={class:"text-h6 fs-inc3 fw-bold fc-negative"},Ve={__name:"CashDesk",props:{data:{type:Object,default:null},inc:{type:Number,default:0}},emits:["pay"],setup(I,{emit:_}){const v=I,m=[{id:"TBA",desc:"Tarjeta Credito/Debito BBVA (Bancomer)"},{id:"TDB",desc:"Transferencia/Deposito BBVA (Bancomer)"},{id:"TSA",desc:"Tarjeta Credito/Debito Santander"},{id:"TDA",desc:"Transferencia/Deposito Santander"},{id:"TSC",desc:"Tarjeta Credito/Debito Scotiabank"},{id:"TDS",desc:"Transferencia/Deposito Scotiabank"}],t=f({EFE:0,DIG:{id:null,val:0}}),b=f(v.data),s=f(v.inc),u=q(()=>(parseFloat(t.value.EFE)+parseFloat(t.value.DIG.val)).toFixed(2)),$=()=>{_("pay",t.value)};return(h,o)=>b.value?(c(),y(N,{key:0},{default:a(()=>[l("div",de,[l("div",null,[re,l("div",ce,p(b.value.ticket),1)]),l("div",pe,[me,l("div",fe,"$ "+p(s.value),1)])]),e(L,{class:"q-pa-none",onSubmit:$},{default:a(()=>[e(U,null,{default:a(()=>[l("div",ve,[_e,e(j,{class:"col",modelValue:t.value.EFE,"onUpdate:modelValue":o[0]||(o[0]=i=>t.value.EFE=i),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue","min"]),parseFloat(t.value.EFE)?(c(),y(D,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:o[1]||(o[1]=i=>t.value.EFE=0)})):V("",!0)])]),_:1}),e(U,null,{default:a(()=>[l("div",be,[e(A,{class:"col-3",modelValue:t.value.DIG.id,"onUpdate:modelValue":o[2]||(o[2]=i=>t.value.DIG.id=i),options:m,label:"Terminal","option-value":"id","emit-value":"","option-label":"id",dense:""},{option:a(i=>[e(F,K(M(i.itemProps)),{default:a(()=>[e(r,null,{default:a(()=>[e(E,{class:"text-bold"},{default:a(()=>[n(p(i.opt.id),1)]),_:2},1024),e(E,{caption:""},{default:a(()=>[n(p(i.opt.desc),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),e(j,{class:"col",modelValue:t.value.DIG.val,"onUpdate:modelValue":o[3]||(o[3]=i=>t.value.DIG.val=i),type:"number",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue","min"]),parseFloat(t.value.DIG.val)?(c(),y(D,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:o[4]||(o[4]=i=>{t.value.DIG.val=0,t.value.DIG.id=null})})):V("",!0)])]),_:1}),e(T),l("div",ye,[l("div",null,[g(u)>=s.value?(c(),B(G,{key:0},[ge,l("div",he,"$ "+p((g(u)-s.value).toFixed(2)),1)],64)):(c(),B(G,{key:1},[ke,l("div",Qe,"$ "+p((s.value-g(u)).toFixed(2)),1)],64))]),l("div",null,[g(u)>=s.value?(c(),y(D,{key:0,color:"positive",icon:"fas fa-dollar-sign",label:"Pagar",type:"submit",class:"full-height"})):V("",!0)])])]),_:1})]),_:1})):V("",!0)}};const xe=l("span",{class:"text-h6"},"IVA",-1),Fe=l("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Folio",-1),De={key:0,class:"text-right"},$e={class:"row justify-center"},Le={__name:"IvaLayout",setup(I){const _=oe(),v=ne(),m=_.series,t=f(null),b=f(""),s=f(null),u=f(0),$=f(0),h=f({state:!1}),o=q(()=>t.value&&b.value.length),i=async()=>{s.value=null,u.value=0;let x=t.value,d=b.value,S=`http://${_.session.store.ip}/access/public/iva/ticket?serie=${x}&folio=${d}`;P.get(S).then(Q=>{s.value=Q.data}).catch(Q=>{console.log(Q);let C=Q.response.status,w=Q.response.data;console.log(C),console.log(w),v.notify({html:!0,message:w.message,color:"negative",position:"center"})})},H=({_inc:x,_iva:d})=>{console.log(x,d),u.value=parseFloat(x),$.value=parseFloat(d),h.value.state=!0},O=x=>{console.log("pagando...");let d=_.session.store.ip,k=`${_.session.name} - ${_.session.store.alias}`,S=`http://${d}/access/public/iva/create`,Q={modes:x,by:k,ticket:s.value.ticket,iva:$.value};v.loading.show({message:"Imprimiendo..."}),console.log(Q),P.post(S,Q).then(C=>{console.log(C.data);let w=C.data;v.loading.hide(),h.value.state=!1,s.iva=null,s.value=null,v.notify({html:!0,color:"positive",position:"center",message:`<span class="fs-inc2"> El ticket <b>${w.ticket}</b> fue generado! </span>`}),w.printed||v.notify({html:!0,color:"negative",position:"top",icon:"fas fa-bugs",message:'<span class="fs-inc2"> No se pudo emitir el ticket, la conexion a la impresora no esta disponible! </span>'})}).catch(C=>{console.log(C),v.loading.hide()})};return(x,d)=>(c(),y(te,{view:"hHh Lpr fFf"},{default:a(()=>[e(ee,{class:"transparent text-dark",bordered:""},{default:a(()=>[e(Z),e(T),e(X,{class:"justify-between"},{default:a(()=>[l("div",null,[n("Helpers "),e(R,{name:"navigate_next",color:"primary"}),n(),xe]),e(D,{color:"primary",icon:"add"},{default:a(()=>[e(J,null,{default:a(()=>[Fe,e(T),e(L,{dense:"",onSubmit:i,class:"q-gutter-md q-pa-md"},{default:a(()=>[e(A,{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=k=>t.value=k),options:g(m),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(j,{modelValue:b.value,"onUpdate:modelValue":d[1]||(d[1]=k=>b.value=k),type:"number",label:"Folio"},null,8,["modelValue"]),g(o)?(c(),B("div",De,[e(D,{type:"submit",color:"primary",icon:"search"})])):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(se,null,{default:a(()=>[e(le,{class:"bg-grey-3",padding:""},{default:a(()=>[l("div",$e,[e(W,{name:"bounce"},{default:a(()=>[s.value?(c(),y(ue,{key:0,data:s.value,onOpenCashDesk:H},null,8,["data"])):V("",!0)]),_:1})]),e(ae,{modelValue:h.value.state,"onUpdate:modelValue":d[2]||(d[2]=k=>h.value.state=k)},{default:a(()=>[e(Ve,{data:s.value,inc:u.value,onPay:O},null,8,["data","inc"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Le as default};
