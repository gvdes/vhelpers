import{r as c,c as Q,o as b,d as k,w as n,e as o,f as d,S as w,Q as V,a1 as a,h as g,g as L,a6 as S}from"./index.867fc8c1.js";import{Q as F}from"./QToolbar.af52560b.js";import{a as m,Q as y}from"./QCard.879858f2.js";import{a as B,d as D}from"./QList.33361528.js";import{Q as u}from"./QInput.9d695ee1.js";import{Q as x}from"./QSelect.feb2f222.js";import{Q as U}from"./QForm.aae07950.js";import{Q as A}from"./QTable.a0d584fa.js";import{Q as O}from"./QPage.de8a21bc.js";import{c as f}from"./clientApi.30dab1c2.js";import{u as j}from"./axios.b42fb8ae.js";import"./QLinearProgress.460afe29.js";import"./QCheckbox.61f052c8.js";const M={class:"row"},P={class:"flex flex-center"},$={class:"row q-my-sm"},R={class:"row q-my-sm"},H={key:0},X={class:"text-h4"},z={class:"row justify-between"},G={key:0},de={__name:"formCli",setup(J){const C=j();let p=c({state:!1}),i=c({state:!1,val:"",table:{cols:[{name:"Fs_id",label:"Codigo",field:"CODCLI"},{name:"Nombre",label:"Nombre",field:"NOFCLI"},{name:"Email",label:"Correo",field:"EMACLI"},{name:"Telefono",label:"Telefono",field:"TELCLI"},{name:"Tarifa",label:"Precio",field:"TARCLI"}],rows:[],noresults:"><"}});c([]);let e=c({branch:{val:null,opts:[]},name:"",ticket:null,address:{street:null,numint:null,numext:null,cp:null,colinia:null,mun:null,state:null},phone:"",email:null,priceList:{val:null,opts:[{id:2,label:"Mayoreo"},{id:3,label:"Docena"},{id:4,label:"Caja"},{id:5,label:"Especial"},{id:6,label:"Centro"}]},agent:{db:[],val:null,opts:[]},notes:null,state:!1}),q=Q(()=>e.value.branch.val&&e.value.priceList.val&&e.value.name&&e.value.name.length>4&&(e.value.phone&&e.value.phone.length==12||e.value.email)&&e.value.agent&&e.value.ticket&&e.value.address.street&&e.value.address.state&&e.value.address.mun),v=Q(()=>({branch:e.value.branch.val,name:e.value.name.toUpperCase(),ticket:e.value.ticket,address:e.value.address,phone:e.value.phone?e.value.phone.split("-").join(""):null,email:e.value.email?e.value.email:null,priceList:e.value.priceList.val,agent:e.value.agent.val,notes:e.value.notes}));(async()=>{const s=await f.index();console.log(s),e.value.branch.opts=s.branches,e.value.agent.db=s.agents})();const I=async()=>{e.value.state=!0;let s=[],l=await f.getClientVac();console.log(l),s=l;let t=s.findIndex(r=>r.TELCLI==v.value.phone||r.EMACLI==v.value.email);if(console.log(t),t<0){let r=await f.create(v.value);T(),console.log(v.value),e.value.state=!1,C.notify({message:"Formulario Enviado....",icon:"check_circle",color:"positive"}),console.log(r)}else{e.value.state=!1,console.log(s[t]);let r=s[t].CODCLI+" - "+s[t].NOFCLI;C.notify({message:"El cliente existe ID "+r,icon:"close",color:"negative"})}},T=()=>{e.value.ticket=null,e.value.branch.val=null,e.value.priceList.val=null,e.value.name="",e.value.agent.val=null,e.value.address={street:null,numint:null,numext:null,cp:null,colinia:null,mun:null,state:null},e.value.phone="",e.value.email=null,e.value.notes=null},E=s=>{e.value.agent.opts=e.value.agent.db.filter(l=>l._store==s.id)};let N=async()=>{let s=i.value.val;const l=await f.getClient(s);console.log(l),p.value.state=!0,i.value.table.rows=l,i.value.state=!0,console.log(l)};return(s,l)=>(b(),k(O,null,{default:n(()=>[o(y,null,{default:n(()=>[o(m,null,{default:n(()=>[o(F,{class:"justify-between"},{default:n(()=>[d("div",null,[l[19]||(l[19]=d("span",{class:"text-grey"},"Helpers",-1)),o(w,{name:"navigate_next",color:"primary"}),l[20]||(l[20]=d("span",{class:"text-h6"},"Formulario Clientes",-1))]),d("div",M,[o(V,{flat:"",round:"",icon:"search",color:"teal",onClick:l[0]||(l[0]=t=>a(p).state=!0),title:"Restaurar"})])]),_:1})]),_:1})]),_:1}),o(B,{spaced:"",inset:"",vertical:"",dark:""}),d("div",P,[o(y,{flat:"",style:{width:"700px","max-width":"80vw"}},{default:n(()=>[o(m,null,{default:n(()=>[o(U,{onSubmit:I,class:"q-gutter-md text-grey-10"},{default:n(()=>[d("div",null,[o(m,{class:""},{default:n(()=>l[21]||(l[21]=[d("div",{class:"text-h4 text-center text-bold",style:{"text-decoration":"underline"}},"Datos cliente",-1)])),_:1}),o(u,{rounded:"",outlined:"",modelValue:a(e).name,"onUpdate:modelValue":l[1]||(l[1]=t=>a(e).name=t),label:"Nombre del Cliente",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:a(e).address.street,"onUpdate:modelValue":l[2]||(l[2]=t=>a(e).address.street=t),label:"Calle",class:"q-my-sm"},null,8,["modelValue"]),d("div",$,[o(u,{rounded:"",outlined:"",modelValue:a(e).address.numint,"onUpdate:modelValue":l[3]||(l[3]=t=>a(e).address.numint=t),label:"Num INT",class:"col"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:a(e).address.numext,"onUpdate:modelValue":l[4]||(l[4]=t=>a(e).address.numext=t),label:"Num EXT",class:"col"},null,8,["modelValue"])]),d("div",R,[o(u,{rounded:"",outlined:"",modelValue:a(e).address.cp,"onUpdate:modelValue":l[5]||(l[5]=t=>a(e).address.cp=t),label:"Codigo Postal",mask:"#####",class:"col"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:a(e).address.state,"onUpdate:modelValue":l[6]||(l[6]=t=>a(e).address.state=t),label:"Estado",class:"col"},null,8,["modelValue"])]),o(u,{rounded:"",outlined:"",modelValue:a(e).address.colinia,"onUpdate:modelValue":l[7]||(l[7]=t=>a(e).address.colinia=t),label:"Colonia",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:a(e).address.mun,"onUpdate:modelValue":l[8]||(l[8]=t=>a(e).address.mun=t),label:"Municipio",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:a(e).phone,"onUpdate:modelValue":l[9]||(l[9]=t=>a(e).phone=t),label:"Telefono",mask:"##-####-####",class:"q-my-sm"},null,8,["modelValue"]),o(u,{rounded:"",outlined:"",modelValue:a(e).email,"onUpdate:modelValue":l[10]||(l[10]=t=>a(e).email=t),label:"Correo Electronico",class:"q-my-sm"},null,8,["modelValue"]),o(m,{class:""},{default:n(()=>l[22]||(l[22]=[d("div",{class:"text-h4 text-center",style:{"text-decoration":"underline"}},"Datos Sucursal",-1)])),_:1}),o(u,{rounded:"",outlined:"",modelValue:a(e).ticket,"onUpdate:modelValue":l[11]||(l[11]=t=>a(e).ticket=t),label:"Ticket",mask:"#-######",class:"q-my-sm"},null,8,["modelValue"]),o(x,{rounded:"",outlined:"","option-label":"name",modelValue:a(e).branch.val,"onUpdate:modelValue":[l[12]||(l[12]=t=>a(e).branch.val=t),E],options:a(e).branch.opts,onInput:l[13]||(l[13]=t=>s.getStaff(a(e).branch.val.id)),label:"Selecciona Sucursal",class:"q-my-sm"},null,8,["modelValue","options"]),a(e).branch.val?(b(),k(x,{key:0,rounded:"",outlined:"","option-label":"complete_name",modelValue:a(e).agent.val,"onUpdate:modelValue":l[14]||(l[14]=t=>a(e).agent.val=t),options:a(e).agent.opts,label:"Quien atendio",class:"q-my-sm"},null,8,["modelValue","options"])):g("",!0),o(x,{rounded:"",outlined:"",modelValue:a(e).priceList.val,"onUpdate:modelValue":l[15]||(l[15]=t=>a(e).priceList.val=t),options:a(e).priceList.opts,label:"Precio Otorgado",class:"q-my-sm"},null,8,["modelValue","options"]),o(u,{rounded:"",outlined:"",modelValue:a(e).notes,"onUpdate:modelValue":l[16]||(l[16]=t=>a(e).notes=t),label:"Notas",class:"q-my-sm"},null,8,["modelValue"])]),a(q)?(b(),L("div",H,[o(V,{label:"Enviar",type:"submit",color:"primary",loading:a(e).state},null,8,["loading"])])):g("",!0)]),_:1})]),_:1})]),_:1})]),o(D,{modelValue:a(p).state,"onUpdate:modelValue":l[18]||(l[18]=t=>a(p).state=t)},{default:n(()=>[o(y,{class:"my-card"},{default:n(()=>[o(m,null,{default:n(()=>[d("div",X,[o(w,{name:"search",class:"q-mr-xs"}),l[23]||(l[23]=S(" Buscador de Clientes "))]),o(m,null,{default:n(()=>[o(U,{onSubmit:a(N)},{default:n(()=>[d("div",z,[o(u,{modelValue:a(i).val,"onUpdate:modelValue":l[17]||(l[17]=t=>a(i).val=t),type:"text",label:"Buscar"},null,8,["modelValue"]),o(V,{icon:"search",type:"submit",color:"primary"})]),a(i).state?(b(),L("div",G,[o(A,{rows:a(i).table.rows,columns:a(i).table.cols,"row-key":"name","no-data-label":a(i).table.noresults},null,8,["rows","columns","no-data-label"])])):g("",!0)]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{de as default};
