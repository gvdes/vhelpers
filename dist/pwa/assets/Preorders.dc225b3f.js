import{e as m,p as z,t as X,q as g,m as v,S as Z,bM as W,ag as w,L as K,z as Y,aq as ee,as as le,r as p,aU as ae,aw as te,B as oe,s as ne,Y as ie,d as se,u as re,a as de,f as ue,g as o,h as a,l as j,Q as P,k as h,j as k,a0 as D,a4 as Q,aW as B,a5 as A,i as E,a6 as O}from"./index.01aad732.js";import{Q as ce}from"./QTable.68c4d436.js";import{Q as R}from"./QForm.fce9930c.js";import{Q as fe}from"./QSelect.89493f30.js";import{Q as ve}from"./QPageSticky.9407bc90.js";import{Q as me}from"./QPage.45fc3825.js";import{C as I}from"./ClosePopup.c1474fd6.js";import{d as be}from"./dayjs.min.cbcf888d.js";import"./axios.60d20557.js";import{o as F}from"./orderApi.375cf221.js";import{u as pe}from"./OrderStore.9bcb9983.js";import{u as ge}from"./use-quasar.00e0b448.js";import"./QList.4eff6dc2.js";import"./QExpansionItem.9e45ed88.js";import"./QDrawer.c490ca27.js";/* empty css                                                                         */import{$sktOrders as M}from"./socket.168d2ba4.js";import"./QLinearProgress.a853f099.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.955528d4.js";import"./QScrollObserver.1be2845e.js";const _e=["top","right","bottom","left"],N={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:l=>_e.includes(l)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function G(l,r){return{formClass:m(()=>`q-fab--form-${l.square===!0?"square":"rounded"}`),stacked:m(()=>l.externalLabel===!1&&["top","bottom"].includes(l.labelPosition)),labelProps:m(()=>{if(l.externalLabel===!0){const i=l.hideLabel===null?r.value===!1:l.hideLabel;return{action:"push",data:{class:[l.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${l.labelPosition}`+(i===!0?" q-fab__label--external-hidden":"")],style:l.labelStyle}}}return{action:["left","top"].includes(l.labelPosition)?"unshift":"push",data:{class:[l.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${l.labelPosition}`+(l.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:l.labelStyle}}})}}const J={start:"self-end",center:"self-center",end:"self-start"},ye=Object.keys(J);var H=z({name:"QFabAction",props:{...N,icon:{type:String,default:""},anchor:{type:String,validator:l=>ye.includes(l)},to:[String,Object],replace:Boolean},emits:["click"],setup(l,{slots:r,emit:i}){const n=X(W,()=>({showing:{value:!0},onChildClick:Z})),{formClass:y,labelProps:S}=G(l,n.showing),b=m(()=>{const c=J[l.anchor];return y.value+(c!==void 0?` ${c}`:"")}),d=m(()=>l.disable===!0||n.showing.value!==!0);function u(c){n.onChildClick(c),i("click",c)}function _(){const c=[];return r.icon!==void 0?c.push(r.icon()):l.icon!==""&&c.push(g(w,{name:l.icon})),(l.label!==""||r.label!==void 0)&&c[S.value.action](g("div",S.value.data,r.label!==void 0?r.label():[l.label])),K(r.default,c)}const C=Y();return Object.assign(C.proxy,{click:u}),()=>g(v,{class:b.value,...l,noWrap:!0,stack:l.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:d.value,onClick:u},_)}});const Ce=["up","right","down","left"],he=["left","center","right"];var Se=z({name:"QFab",props:{...N,...ee,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{...N.hideLabel,default:null},direction:{type:String,default:"right",validator:l=>Ce.includes(l)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:l=>he.includes(l)}},emits:le,setup(l,{slots:r}){const i=p(null),n=p(l.modelValue===!0),y=ae(),{proxy:{$q:S}}=Y(),{formClass:b,labelProps:d}=G(l,n),u=m(()=>l.persistent!==!0),{hide:_,toggle:C}=te({showing:n,hideOnRouteChange:u}),c=m(()=>({opened:n.value})),L=m(()=>`q-fab z-fab row inline justify-center q-fab--align-${l.verticalActionsAlign} ${b.value}`+(n.value===!0?" q-fab--opened":" q-fab--closed")),U=m(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${l.direction} q-fab__actions--${n.value===!0?"opened":"closed"}`),V=m(()=>{const f={id:y.value,role:"menu"};return n.value!==!0&&(f["aria-hidden"]="true"),f}),x=m(()=>`q-fab__icon-holder  q-fab__icon-holder--${n.value===!0?"opened":"closed"}`);function q(f,$){const t=r[f],e=`q-fab__${f} absolute-full`;return t===void 0?g(w,{class:e,name:l[$]||S.iconSet.fab[$]}):g("div",{class:e},t(c.value))}function T(){const f=[];return l.hideIcon!==!0&&f.push(g("div",{class:x.value},[q("icon","icon"),q("active-icon","activeIcon")])),(l.label!==""||r.label!==void 0)&&f[d.value.action](g("div",d.value.data,r.label!==void 0?r.label(c.value):[l.label])),K(r.tooltip,f)}return oe(W,{showing:n,onChildClick(f){_(f),i.value!==null&&i.value.$el.focus()}}),()=>g("div",{class:L.value},[g(v,{ref:i,class:b.value,...l,noWrap:!0,stack:l.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":n.value===!0?"true":"false","aria-haspopup":"true","aria-controls":y.value,onClick:C},T),g("div",{class:U.value,...V.value},ne(r.default))])}});const xe={class:"text-caption text-grey"},ke={class:"text-bold"},we={class:"text-bold"},We={__name:"Preorders",setup(l){ie();const r=se(),i=pe();i.setTitle("PEDIDOS"),i.setshowLyt(!0),i.setShowEvent(!1);const n=ge(),y=re(),S=p({rowsPerPage:20}),b=p({state:!1,val:null,opts:[]}),d=p({state:!1,val:null}),u=p({state:!1,order:{_created_by:y.session.credentials.staff.id_va,_workpoint:y.session.store.id_viz,name:null,_anex:null}}),_=p({state:!0,val:null,opts:[],filter:[]}),C=p({state:!1,val:null}),c=p({columns:[{name:"id",label:"FOLIO",field:t=>t.id,align:"left",sortable:!0},{name:"client",label:"CLIENTE",field:t=>t.name,align:"center",sortable:!0},{name:"status",label:"ESTADO",field:t=>{var e;return(e=t.status)==null?void 0:e.name},align:"center",classes:t=>`text-${L.value[t.status.id-1]}`,sortable:!0},{name:"created",label:"HORA",field:t=>be(t.created_at).format("HH:mm:ss"),align:"center",sortable:!0}],filter:null}),L=p(["grey-6","red-5","deep-orange-10","blue-4","blue-10","teal-4","teal-10","green-5","green-10","light-green-10"]),U=m(()=>i.orders.filter(t=>t.created_by.id==y.session.credentials.staff.id_va)),V=async()=>{n.loading.show({message:"Creando Pedido"}),console.log(u.value.order);const t=await F.create(u.value.order);t.fail?console.log(t):(M.emit("order_add",{order:t,user:i.socket_user.profile}),i.addOrUpdate({order:t}),n.notify({message:`El Pedido ${t.id} se creo`,type:"positive",position:"center"}),n.loading.hide(),r.push(`/preorders/pedidos/${t.id}`))},x=async()=>{n.loading.show({message:"Creando Pedido"}),console.log(u.value);const t=await F.create(u.value.order);console.log(t),t.fail?console.log(t):(M.emit("order_add",{order:t,user:i.socket_user.profile}),i.addOrUpdate({order:t}),n.notify({message:`El Pedido ${t.id} se creo`,type:"positive",position:"center"}),n.loading.hide(),r.push(`/preorders/pedidos/${t.id}`))},q=(t,e)=>{e._status==1?r.push(`/preorders/pedidos/${e.id}`):(d.value.state=!0,d.value.val=e)},T=async()=>{n.loading.show({message:"Reimprimiendo"});let t={_order:d.value.val.id,_printer:i.printers.val.id};const e=await F.reimpresionClientTicket(t);e.fail?console.log(e):(b.value.state=!1,d.value.state=!1,d.value.val=null,n.loading.hide())},f=()=>{u.value.order._anex=d.value.val.id,d.value.state=!1,d.value.val=null,x()},$=()=>{r.push(`/preorders/pedidos/${d.value.val.id}`)};return(t,e)=>(de(),ue(me,{padding:""},{default:o(()=>[a(ce,{rows:U.value,columns:c.value.columns,filter:c.value.filter,onRowClick:q,pagination:S.value},{"top-right":o(()=>[a(j,{borderless:"",dense:"",debounce:"300",modelValue:c.value.filter,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value.filter=s),placeholder:"Buscar"},{append:o(()=>[a(w,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter","pagination"]),a(A,{modelValue:u.value.state,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.state=s),persistent:""},{default:o(()=>[a(P,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white"},{default:o(()=>[a(w,{name:"list"}),e[12]||(e[12]=k("span",{class:"q-ml-sm"},"Nevo Pedido",-1))]),_:1}),a(h,null,{default:o(()=>[k("div",xe,D(_.value.state?"Escribe Cliente":""),1),a(R,{onSubmit:V},{default:o(()=>[a(j,{modelValue:u.value.order.name,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.order.name=s),type:_.value.state?"text":"number",label:"Cliente"},{prepend:o(()=>[a(v,{color:"primary",icon:_.value.state?"person_add_disabled":"person_add",title:"client",flat:"",onClick:e[1]||(e[1]=s=>_.value.state=!_.value.state),disable:""},null,8,["icon"])]),_:1},8,["modelValue","type"])]),_:1})]),_:1}),a(Q,{align:"right"},{default:o(()=>[B(a(v,{flat:"",title:"Cancelar",color:"negative",icon:"close"},null,512),[[I]]),a(v,{flat:"",color:"positive",icon:"check",onClick:V})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:C.value.state,"onUpdate:modelValue":e[5]||(e[5]=s=>C.value.state=s),persistent:""},{default:o(()=>[a(P,null,{default:o(()=>[a(h,{class:"row items-center bg-teal text-white"},{default:o(()=>[a(w,{name:"post_add"}),e[13]||(e[13]=k("span",{class:"q-ml-sm"},"Nuevo Anexo",-1))]),_:1}),a(h,null,{default:o(()=>[a(R,{onSubmit:x},{default:o(()=>[a(j,{modelValue:u.value.order._anex,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.order._anex=s),type:"number",label:"Pedido"},null,8,["modelValue"])]),_:1})]),_:1}),a(Q,{align:"right"},{default:o(()=>[B(a(v,{flat:"",title:"Cancelar",color:"negative",icon:"close"},null,512),[[I]]),a(v,{flat:"",color:"positive",icon:"check",onClick:x})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:d.value.state,"onUpdate:modelValue":e[7]||(e[7]=s=>d.value.state=s),persistent:""},{default:o(()=>[a(P,null,{default:o(()=>[a(h,{class:"text-h5"},{default:o(()=>[e[14]||(e[14]=E(" Cliente : ")),k("span",ke,D(d.value.val.name),1)]),_:1}),a(h,{class:"text-h6"},{default:o(()=>[e[15]||(e[15]=E(" Pedido : ")),k("span",we,D(d.value.val.id),1)]),_:1}),a(Q,{align:"right"},{default:o(()=>[B(a(v,{flat:"",icon:"close",color:"negative"},null,512),[[I]]),a(v,{flat:"",icon:"print",color:"positive",onClick:e[6]||(e[6]=s=>b.value.state=!b.value.state)}),a(v,{flat:"",icon:"send",color:"primary",onClick:$}),a(v,{flat:"",label:"Anexo",color:"primary",onClick:f})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:b.value.state,"onUpdate:modelValue":e[9]||(e[9]=s=>b.value.state=s),persistent:""},{default:o(()=>[a(P,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white text-h6"},{default:o(()=>e[16]||(e[16]=[E(" Selecciona Impresora ")])),_:1}),a(h,{class:""},{default:o(()=>[a(fe,{modelValue:O(i).printers.val,"onUpdate:modelValue":e[8]||(e[8]=s=>O(i).printers.val=s),options:O(i).printers.opts.filter(s=>s._type==1),label:"Impresoras","option-label":"name",filled:""},null,8,["modelValue","options"])]),_:1}),a(Q,{align:"right"},{default:o(()=>[B(a(v,{flat:"",label:"Cancelar",color:"primary"},null,512),[[I]]),a(v,{flat:"",label:"Imprimir",color:"primary",disabled:!O(i).printers.val,onClick:T},null,8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ve,{position:"bottom-right",offset:[20,20]},{default:o(()=>[a(Se,{color:"primary",icon:"add",direction:"up"},{default:o(()=>[a(H,{color:"primary",onClick:e[10]||(e[10]=s=>u.value.state=!u.value.state),icon:"add",label:"Pedido"}),a(H,{color:"primary",onClick:e[11]||(e[11]=s=>C.value.state=!C.value.state),icon:"post_add",label:"Anexo"})]),_:1})]),_:1})]),_:1}))}};export{We as default};
