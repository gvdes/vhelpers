import{f as ce,Z as ve,u as pe,r as h,g as fe,a as P,h as I,i as l,p as U,d as t,n as m,a7 as H,k as d,a1 as r,j as i,ah as L,a4 as N,b9 as me,c as ge,a2 as we,a3 as xe,Q as D,l as C,aX as W,bK as ye,a5 as J,a6 as $,aj as _e}from"./index.1626ded8.js";import{Q as be}from"./QToolbar.43e023de.js";import{Q as ke}from"./QHeader.b97cd03d.js";import{a as E,b as u,Q as R}from"./QList.41b0f068.js";import{Q as he}from"./QFooter.5bb21ba1.js";import{Q as Pe}from"./QPage.25b97575.js";import{u as Ce}from"./use-quasar.3d22c1d6.js";import"./jspdf.plugin.autotable.7d0c7a51.js";import{o as Q}from"./outputsApi.bcec5e5e.js";import{E as K}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{P as Ee,d as Qe}from"./ProductsAutocomplete.94df6ee4.js";import"./QResizeObserver.dbe14e34.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.5eb31d53.js";import"./QSelect.d317d068.js";/* empty css                                                                         */const Fe={class:"row items-center"},Ve={class:"col"},Ie={class:"text-h6"},Se={class:"text-center text-bold"},Ae={class:"text-center text-bold row"},Be={class:"col"},Ne={class:"col"},De={class:"text-center text-h4"},Re={class:"text-center text-h6 text-grey-14"},Te={class:"text-center"},$e={class:"q-pa-xs"},Oe={class:"row"},je={class:"col column q-py-md"},nt={__name:"viewOutputs",setup(qe){const T=ce(),F=ve(),g=pe(),n=Ce(),v=h(null),c=h([]),s=h({val:null,state:!1}),x=h({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),w=h({state:!1,encontrados:[],faltantes:[],products:null}),O=h(null),j=h(null),X=fe(()=>{var o;return((o=c.value)==null?void 0:o.filter(e=>{var a;return e.product==((a=s.value.val)==null?void 0:a.product)}).length)>0}),Z=async()=>{n.loading.show({message:"Obteniendo datos"});const o=F.params.oid,e=await Q.getOutput(o);e.fail?console.log(e):(console.log(e),n.loading.hide(),g.session.rol=="aud"||g.session.rol=="audc"||g.session.rol=="root"||g.session.rol=="des"||(g.session.rol=="aux"||g.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||g.session.rol=="alm"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(v.value=e,c.value=e.bodie,console.log(v.value)):(T.push("/outputs"),n.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},Y=o=>{console.log(o)},ee=o=>{let e=c.value.findIndex(a=>a.product==o.code);console.log(e),e>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(s.value.val={product:o.code,description:o.description,amount:1},s.value.state=!0,console.log(o))},te=async()=>{n.loading.show({message:"Insertando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await Q.addProduct(s.value.val);o.fail?console.log(o):(console.log(o),c.value.push(s.value.val),s.value={val:null,state:!1},n.loading.hide())},le=async()=>{n.loading.show({message:"Editando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await Q.editProduct(s.value.val);if(o.fail)console.log(o);else{console.log(o);let e=c.value.findIndex(a=>a.product==s.value.val.product);e>=0&&(c.value[e].amount=s.value.val.amount,n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},oe=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await Q.removeProduct(s.value.val);if(o.fail)console.log(o);else{console.log(o);let e=c.value.findIndex(a=>a.product==s.value.val.product);e>=0&&(c.value.splice(e,1),n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},ae=async()=>{n.loading.show({message:"Terminando Salida"});let o={user:g.session.name,output:v.value,products:c.value};console.log(o);const e=await Q.endOutput(o);e.fail?console.log(e):(n.notify({message:e,position:"center",type:"positive"}),console.log(e),n.loading.hide(),T.push("/outputs"))},se=o=>{s.value.state=!0,s.value.val=o},q=()=>{s.value={val:null,state:!1}},ne=()=>{O.value.click()},ie=async()=>{let o=document.getElementById("inputFile").files[0],e=new K.Workbook,a=[],y={};e.xlsx.load(o).then(G=>{let S=e.worksheets[0],b=S.getColumn("A");S.getColumn("B"),b.eachCell({includeEmpty:!0},function(f,_){let V=f.value,A=S.getCell(`B${_}`),B=parseFloat(A.value);y[V]?y[V]+=B:y[V]=B});let p=Object.keys(y).map(f=>({codigo:f,cantidad:y[f]}));if(p.forEach(f=>a.push(f.codigo)),a.length){let f={codes:a,_workpoint:g.session.store.id_viz};n.loading.show({message:"Procesando archivo, espera.."}),Qe.getMassive(f).then(_=>{let V=_.data;V.fails.notFound.map(k=>x.value.wndNotExist.push(k)),V.fails.repeat.map(k=>x.value.repeat.push(k));let A=_.data.products;x.value.wndGetRows=A.length,x.value.state=!x.value.state,console.log(A);let B=A.map(k=>{let M=p.find(re=>re.codigo===k.code);return{product:k.code,description:k.description,amount:M?M.cantidad:0,_output:F.params.oid}});z(B),n.loading.hide()}).catch(_=>{console.log(_),n.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},de=()=>{j.value.click()},ue=async()=>{let o=document.getElementById("inputFilePreventa").files[0],e=new K.Workbook,a=[];e.xlsx.load(o).then(async y=>{let S=e.worksheets[0].getColumn("A");if(n.loading.show({message:"Procesando archivo, espera.."}),S.eachCell({includeEmpty:!0},function(b,p){b.value&&a.push(b.value)}),a.length){let b={codes:a,_workpoint:g.session.store.id_viz};console.log(b);const p=await Q.outputPreventa(b);if(p.fail)alert(p);else{w.value.encontrados=p.Encontrados,w.value.faltantes=p.Faltantes,w.value.products=p.products.length,w.value.state=!w.value.state,p.products.forEach(_=>_._output=F.params.oid);let f=p.products;console.log(f),z(f),n.loading.hide()}}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},z=async o=>{const e=await Q.addProductMasive(o);e.fail?console.log(e):(console.log(e),o.map(a=>{c.value.push(a)}),n.loading.hide())};return Z(),(o,e)=>v.value?(P(),I(Pe,{key:0,padding:""},{default:l(()=>[t(ke,{reveal:"",bordered:"",class:me(H(n).dark.isActive?"text-white bg-dark":"text-dark bg-white")},{default:l(()=>[t(be,{class:"justify-between"},{default:l(()=>[t(m,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=a=>H(T).push("/outputs")),round:""}),d("div",null,r(v.value.store.name),1),d("div",Fe,[d("div",Ve,r(v.value.warehouse.name),1),e[7]||(e[7]=i()),t(L,{name:"arrow_forward",class:"col"})]),d("div",null,r(v.value.created_by),1),d("div",null,[e[8]||(e[8]=i("salida ")),t(L,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=i()),d("span",Ie,r(v.value.code_fs),1)])]),_:1}),t(N),d("div",Se,r(v.value.notes),1),t(N),d("div",Ae,[d("div",Be,[t(m,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:ne})]),d("div",Ne,[t(m,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:de})]),d("input",{type:"file",ref_key:"inputFile",ref:O,id:"inputFile",onInput:ie,hidden:"",accept:".xlsx,.xls"},null,544),d("input",{type:"file",ref_key:"inputFilePreventa",ref:j,id:"inputFilePreventa",onInput:ue,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1},8,["class"]),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{bordered:""},{default:l(()=>[t(E,null,{default:l(()=>[t(u,null,{default:l(()=>e[10]||(e[10]=[i(" Producto ")])),_:1}),t(u,null,{default:l(()=>e[11]||(e[11]=[i(" Descripcion ")])),_:1}),t(u,{class:"text-center"},{default:l(()=>e[12]||(e[12]=[i(" Cantidad ")])),_:1})]),_:1})]),_:1}),(P(!0),ge(xe,null,we(c.value,(a,y)=>(P(),I(R,{bordered:"",key:y},{default:l(()=>[W((P(),I(E,{clickable:"",onClick:G=>se(a)},{default:l(()=>[t(u,null,{default:l(()=>[i(r(a.product),1)]),_:2},1024),t(u,null,{default:l(()=>[i(r(a.description),1)]),_:2},1024),t(u,{class:"text-center"},{default:l(()=>[i(r(a.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[_e]]),t(N)]),_:2},1024))),128)),t($,{modelValue:s.value.state,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.state=a),persistent:"",position:"bottom"},{default:l(()=>[t(D,{style:{width:"300","max-width":"40vw"}},{default:l(()=>[t(C,null,{default:l(()=>[d("div",De,r(s.value.val.product),1),d("div",Re,r(s.value.val.description),1)]),_:1}),t(C,null,{default:l(()=>[d("div",Te,[d("div",$e,[e[13]||(e[13]=d("div",{class:"text-bold text-h6"},"Cantidad:",-1)),d("div",Oe,[t(m,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=a=>s.value.val.amount--)}),d("div",je,[W(d("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.val.amount=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[ye,s.value.val.amount]])]),t(m,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=a=>s.value.val.amount++)})])])])]),_:1}),X.value?(P(),I(J,{key:1,align:"center"},{default:l(()=>[t(m,{flat:"",icon:"close",color:"red-10",onClick:q}),t(m,{flat:"",label:"Eliminar",color:"negative",onClick:oe}),t(m,{flat:"",label:"Editar",color:"blue-10",onClick:le})]),_:1})):(P(),I(J,{key:0,align:"center"},{default:l(()=>[t(m,{flat:"",label:"Cancelar",color:"negative",onClick:q}),t(m,{flat:"",label:"Agregar",color:"positive",onClick:te})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:x.value.state,"onUpdate:modelValue":e[5]||(e[5]=a=>x.value.state=a)},{default:l(()=>[t(D,null,{default:l(()=>[t(C,{class:"row text-bold text-overline text-center"},{default:l(()=>e[14]||(e[14]=[i(" Resultados de la importacion :O ")])),_:1}),t(C,null,{default:l(()=>[t(R,{bordered:""},{default:l(()=>[t(E,null,{default:l(()=>[t(u,null,{default:l(()=>e[15]||(e[15]=[i("Productos Encontrados")])),_:1}),t(u,null,{default:l(()=>[i(r(x.value.wndGetRows),1)]),_:1})]),_:1}),t(E,null,{default:l(()=>[t(u,null,{default:l(()=>e[16]||(e[16]=[i("Productos Sin Datos")])),_:1}),t(u,null,{default:l(()=>[i(r(x.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:w.value.state,"onUpdate:modelValue":e[6]||(e[6]=a=>w.value.state=a)},{default:l(()=>[t(D,null,{default:l(()=>[t(C,{class:"row text-bold text-overline text-center"},{default:l(()=>e[17]||(e[17]=[i(" Resultados de la importacion :O ")])),_:1}),t(C,null,{default:l(()=>[t(R,{bordered:""},{default:l(()=>[t(E,null,{default:l(()=>[t(u,null,{default:l(()=>e[18]||(e[18]=[i("Pedidos Encontrados")])),_:1}),t(u,null,{default:l(()=>[i(r(w.value.encontrados),1)]),_:1})]),_:1}),t(E,null,{default:l(()=>[t(u,null,{default:l(()=>e[19]||(e[19]=[i("Pedidos Sin Encontrar")])),_:1}),t(u,null,{default:l(()=>[i(r(w.value.faltantes),1)]),_:1})]),_:1}),t(E,null,{default:l(()=>[t(u,null,{default:l(()=>e[20]||(e[20]=[i("Productos Encontrados")])),_:1}),t(u,null,{default:l(()=>[i(r(w.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(he,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:l(()=>[t(D,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:l(()=>[t(C,{class:"row"},{default:l(()=>[t(Ee,{class:"col",checkState:!1,onInput:Y,onAgregar:ee}),c.value.length>0?(P(),I(m,{key:0,color:"primary",flat:"",icon:"east",onClick:ae,round:""})):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0)}};export{nt as default};
