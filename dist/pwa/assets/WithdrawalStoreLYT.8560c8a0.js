import{b as d,Q as A}from"./QList.550f4fa5.js";import{Q as j}from"./QHeader.ef0d745e.js";import{aH as q,a as G,u as H,r,c as D,o as z,d as K,w as n,e as l,f as m,E as X,Q as f,a0 as Z,a4 as h}from"./index.3fa8a8a8.js";import{Q as _}from"./QToolbar.47e620c8.js";import{Q as E}from"./QInput.1b7185f0.js";import{Q as O,d as ee}from"./QSelect.0755516f.js";import{Q as le}from"./QDate.dcbe2673.js";import{Q as ae}from"./QTable.6eb75be9.js";import{Q as te,a as oe}from"./QLayout.5d7fe04e.js";import{p as y,Q as F,a as T,j as se}from"./axios.d0a5f2ef.js";import{Q as ie}from"./QForm.5dea3742.js";import{Q as M}from"./QCardActions.bee50416.js";import{C as ne}from"./ClosePopup.bd3f4cb2.js";import"./auto.93cd34b0.js";import{u as de}from"./use-quasar.3827eff5.js";import{d as N}from"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.0a28a669.js";import{_ as ue}from"./UserToolbar.94c8d2aa.js";import"./QResizeObserver.27e0bc68.js";import"./use-render-cache.3aae9b27.js";import"./date.7f26b2b8.js";import"./QLinearProgress.3203ae97.js";import"./QCheckbox.186179cb.js";import"./QScrollObserver.f2c19650.js";import"./_commonjsHelpers.88e99c8f.js";import"./QExpansionItem.670bacfd.js";import"./QDrawer.020283eb.js";import"./touch.9135741d.js";import"./auth.36261cd0.js";const re={class:"col"},ve={class:"q-ml-sm"},Be={__name:"WithdrawalStoreLYT",setup(pe){const v=de();q(),G(),H();const b=H();r([]);const I=new Date,R=r(N(I).format("YYYY-MM-DD")),p=r([]),o=r({val:null,state:!1}),u=r({val:null,opts:[]}),s=r({state:!1,val:null,body:null}),V=r([]),P=r(V.value),i=r({state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:R.value}),C=r({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:t=>t.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:t=>t.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:t=>t.NOFPRO,align:"left",sortable:!0}]}),S=D(()=>R.value&&!u.value.val?p.value.filter(t=>t.FECHA==R.value):!R.value&&u.value.val?p.value.filter(t=>t.CAJRET==u.value.val.CODTER):R.value&&u.value.val?p.value.filter(t=>t.FECHA==R.value&&t.CAJRET==u.value.val.CODTER):p.value),x=D(()=>{if(o.value){const t=p.value.find(a=>a.CODRET===o.value.val.CODRET);if(!t)return!1;let e={CAJRET:t.CAJRET,CODRET:t.CODRET,CONRET:t.CONRET,DESTER:t.DESTER,FECHA:t.FECHA,HORA:t.HORA,IMPRET:Number(t.IMPRET).toFixed(2),PROVEEDOR:{PRORET:t.PRORET,NOFPRO:t.NOFPRO}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),g=D(()=>N(I).format("YYYY-MM-DD")===N(o.value.val.FECHA).format("YYYY-MM-DD")),U=D(()=>!i.value.CONRET||!i.value.DESTER||!i.value.IMPRET||!i.value.PROVEEDOR),Y=(t,e)=>{o.value.state=!o.value.state,console.log(e);let a={CAJRET:e.CAJRET,CODRET:e.CODRET,CONRET:e.CONRET,DESTER:e.DESTER,FECHA:e.FECHA,HORA:e.HORA,IMPRET:Number(e.IMPRET).toFixed(2),PROVEEDOR:{PRORET:e.PRORET,NOFPRO:e.NOFPRO}};o.value.val={...a}},J=async()=>{let t=b.session.store.id;console.log(t);try{let e=await se.get(`/cashier/getPrinters/${t}`);e.status==200&&(s.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),v.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},L=async()=>{console.log(b.session.store),v.loading.show({message:"Obteniendo Registros"});let e=`http://${b.session.store.ip_address}/storetools/public/api/reports/getWithdrawals`;const a=await y.get(e);a.status!=200?console.log(a):(console.log(a.data),p.value=a.data.cuts,u.value.opts=a.data.terminal,V.value=a.data.proveedores,J(),v.loading.hide())},k=async()=>{console.log(b.session.store.ip_address);let t={print:s.value.val.ip_address,codret:o.value.val.CODRET};console.log(t),v.loading.show({message:"Imprimiendo Retirada"});let a=`http://${b.session.store.ip_address}/storetools/public/api/reports/printWitrawal`;const c=await y.post(a,t);c.status!=200?console.log(c):(console.log(c.data),s.value.val=null,o.value.val=null,o.value.state=!1,v.loading.hide())},$=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),v.loading.show({message:"Modificando Retirada"});let e=`http://${b.session.store.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const a=await y.post(e,o.value.val);if(a.status!=200)console.log(a);else{console.log(a.data);let c=p.value.findIndex(w=>w.CODRET==a.data.CODRET);c>=0&&(p.value[c]=a.data),s.value.val=null,o.value.val=null,o.value.state=!1,v.loading.hide()}},B=async()=>{i.value.Print=s.value.val.ip_address,console.log(i.value),v.loading.show({message:"Agregando Anticipo"});let e=`http://${b.session.store.ip_address}/storetools/public/api/reports/addWithdrawal`;const a=await y.post(e,i.value);a.status!=200?console.log(a):(console.log(a.data),p.value.push(a.data),s.value.val=null,o.value.val=null,o.value.state=!1,v.loading.hide(),Q())},Q=()=>{i.value={state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}},W=(t,e,a)=>{if(t===""){e(()=>{P.value=V.value});return}e(()=>{const c=t.toLowerCase();P.value=V.value.filter(w=>w.NOFCLI.toLowerCase().includes(c))})};return L(),(t,e)=>(z(),K(te,{view:"hHh Lpr fFf"},{default:n(()=>[l(j,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[l(ue),l(d)]),_:1}),l(oe,null,{default:n(()=>[l(_,{class:"justify-between row"},{default:n(()=>[m("div",re,[e[21]||(e[21]=m("span",{class:"text-grey"},"Helpers",-1)),l(X,{name:"navigate_next",color:"primary"}),e[22]||(e[22]=m("span",{class:"text-h6"},"Retiradas de Cajas",-1))]),e[23]||(e[23]=m("div",{class:"col"},[m("div",{class:"row"},[m("div",{class:"col"})])],-1))]),_:1}),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(ae,{rows:S.value,filter:C.value.filter,columns:C.value.columns,onRowClick:Y},{"top-right":n(()=>[l(E,{modelValue:C.value.filter,"onUpdate:modelValue":e[0]||(e[0]=a=>C.value.filter=a),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(O,{modelValue:u.value.val,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.val=a),options:u.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER"},null,8,["modelValue","options"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(f,{color:"primary",icon:"event",flat:"",round:""},{default:n(()=>[l(ee,null,{default:n(()=>[l(le,{modelValue:R.value,"onUpdate:modelValue":e[2]||(e[2]=a=>R.value=a),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(f,{color:"primary",icon:"add",flat:"",onClick:e[3]||(e[3]=a=>i.value.state=!i.value.state)})]),_:1},8,["rows","filter","columns"])]),_:1}),l(A,{modelValue:s.value.state,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.state=a)},{default:n(()=>[l(F,{class:"my-card"},{default:n(()=>[l(T,null,{default:n(()=>e[24]||(e[24]=[m("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),l(T,null,{default:n(()=>[l(ie,{onSubmit:k,class:"q-gutter-md"},{default:n(()=>[l(O,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.val=a),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),m("div",null,[l(f,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(A,{modelValue:o.value.state,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.state=a),persistent:""},{default:n(()=>[l(F,{style:{width:"300px"}},{default:n(()=>[l(T,{class:"text-bold text-center text-h5"},{default:n(()=>[m("span",ve,"Retirada "+Z(o.value.val.CODRET),1)]),_:1}),l(T,null,{default:n(()=>[l(E,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.val.FECHA=a),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(E,{modelValue:o.value.val.HORA,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.val.HORA=a),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(E,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.val.DESTER=a),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue","disable"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(O,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.val.PROVEEDOR=a),options:V.value,label:"Proveedor",filled:"","option-label":"NOFPRO",disable:!g.value},null,8,["modelValue","options","disable"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(E,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.val.CONRET=a),type:"text",label:"Concepto",dense:"",filled:"",disable:!g.value},null,8,["modelValue","disable"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(E,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.val.IMPRET=a),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",disable:!g.value},null,8,["modelValue","disable"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(O,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.val=a),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),l(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),l(M,{align:"center"},{default:n(()=>[h(l(f,{flat:"",color:"negative",icon:"close"},null,512),[[ne]]),l(f,{flat:"",color:"primary",icon:"print",onClick:k,disable:!s.value.val},null,8,["disable"]),l(f,{flat:"",color:"yellow",icon:"edit",disable:x.value||!g.value||!s.value.val,onClick:$},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(A,{modelValue:i.value.state,"onUpdate:modelValue":e[20]||(e[20]=a=>i.value.state=a),persistent:""},{default:n(()=>[l(F,{style:{width:"300px"}},{default:n(()=>[l(T,{class:"text-bold text-center text-h5"}),l(T,null,{default:n(()=>[l(E,{modelValue:i.value.FECHA,"onUpdate:modelValue":e[14]||(e[14]=a=>i.value.FECHA=a),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(O,{modelValue:i.value.DESTER,"onUpdate:modelValue":e[15]||(e[15]=a=>i.value.DESTER=a),options:u.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(O,{modelValue:i.value.PROVEEDOR,"onUpdate:modelValue":e[16]||(e[16]=a=>i.value.PROVEEDOR=a),options:P.value,label:"Proveedor",filled:"","option-label":"NOFPRO","use-input":"","input-debounce":"0",onFilter:W,dense:""},null,8,["modelValue","options"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(E,{modelValue:i.value.CONRET,"onUpdate:modelValue":e[17]||(e[17]=a=>i.value.CONRET=a),type:"text",label:"Observacion",dense:"",filled:""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(E,{modelValue:i.value.IMPRET,"onUpdate:modelValue":e[18]||(e[18]=a=>i.value.IMPRET=a),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),l(d,{spaced:"",inset:"",vertical:"",dark:""}),l(O,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[19]||(e[19]=a=>s.value.val=a),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),l(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),l(M,{align:"center"},{default:n(()=>[l(f,{flat:"",color:"negative",icon:"close",onClick:Q}),l(f,{flat:"",color:"primary",icon:"print",onClick:k,disable:!x.value||!s.value.val},null,8,["disable"]),l(f,{flat:"",color:"positive",icon:"send",disable:U.value||!s.value.val,onClick:B},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Be as default};
