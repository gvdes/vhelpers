import{l as fe,ak as me,am as pe,c as J,s as ge,t as ve,v as be,r as h,o as u,i as B,_ as A,Z as G,e as o,ab as C,g as m,j as k,br as ne,a as se,u as ie,w as n,f as P,ad as U,W as E,X as S,h as Z,Q as $,d as y,k as w,$ as H,a0 as ye,Y as ae,q as Ce,J as ke,O as we,bs as xe,a1 as Ve}from"./index.02e98f23.js";import{Q as Qe}from"./QHeader.8a0807d4.js";import{Q as K}from"./QDate.b1b2b6f2.js";import{Q as q,d as ee}from"./QSelect.53941b07.js";import{Q as Se}from"./QToolbar.8b422708.js";import{Q as he}from"./QSpace.e8fbf6a5.js";import{Q as Y}from"./QTooltip.a0fc0175.js";import{Q as Ue,a as $e}from"./QLayout.035d2614.js";import{u as ce}from"./use-quasar.dc53eb3e.js";import{d as re}from"./dayjs.min.cbcf888d.js";import{_ as De}from"./UserToolbar.27610a49.js";import{C as z}from"./cicsdb.2af2d1d1.js";import{Q as R,a as oe}from"./QTable.6c1ae328.js";import{Q as Pe}from"./QExpansionItem.3c424fa7.js";import{Q as te}from"./QTr.fd11d386.js";import{Q as le}from"./QTd.aa6e26ad.js";import{Q as Be}from"./QFooter.ef9af694.js";import{C as qe}from"./ClosePopup.5123f35e.js";import{P as ze}from"./ProductsAutocomplete.932b1e81.js";import{c as de}from"./cyclecountStore.52fac71b.js";import"./axios.87cc1b88.js";import"./QList.87ca2251.js";import"./QPage.2e793c9e.js";import"./OrderStore.e050a98f.js";import"./QDrawer.eb1e7cb5.js";import{$sktCounters as b}from"./socket.168d2ba4.js";import{r as Ne}from"./reports.449fef5b.js";import"./QResizeObserver.04e1b2fd.js";import"./use-render-cache.3aae9b27.js";import"./date.4e270c80.js";import"./QScrollObserver.beba53c5.js";import"./_commonjsHelpers.88e99c8f.js";import"./auth.b5328b31.js";import"./QLinearProgress.aa0b5254.js";/* empty css                                                                         */import"./exceljs.min.9e24d01d.js";var Ee=fe({name:"QBar",props:{...me,dense:Boolean},setup(i,{slots:p}){const{proxy:{$q:f}}=be(),g=pe(i,f),c=J(()=>`q-bar row no-wrap items-center q-bar--${i.dense===!0?"dense":"standard"}  q-bar--${g.value===!0?"dark":"light"}`);return()=>ge("div",{class:c.value,role:"toolbar"},ve(p.default))}});const Le={class:"text-right"},Me={__name:"Locations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(i,{emit:p}){const f=i,g=p,c=r=>f.sections.filter(v=>v.root===r),d=h([{options:f.sections.filter(r=>r.root===0),selected:null}]),x=(r,v)=>{const V=r[r.length-1];d.value.splice(v+1);const Q=c(V);Q.length&&d.value.push({options:Q,selected:[]})},a=()=>{const r=d.value.filter(V=>V.selected.length>0),v=r[r.length-1];g("obtProducts",v)};return(r,v)=>(u(),B("div",null,[(u(!0),B(A,null,G(d.value,(V,Q)=>(u(),B("div",{key:Q},[o(q,{class:"col",modelValue:V.selected,"onUpdate:modelValue":[D=>V.selected=D,D=>x(D,Q)],options:V.options,label:`Nivel ${Q+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",multiple:"","use-chips":""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(C,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),m("div",Le,[o(k,{flat:"",icon:"send",disable:!d.value[0].selected,onClick:a},null,8,["disable"])])]))}},Oe={class:"col"},je={class:"text-bold"},Ae={class:"text-bold"},Te={class:"row"},_e={class:"col"},Fe={class:"col"},Ie={key:0,class:"row"},Ye={__name:"Create",props:{config:{default:{},type:Object}},emits:["create"],setup(i,{emit:p}){const f=ce();ne(),se();const g=ie(),c=de(),d=h(null),x=p,a=i,r=h({team:!1,selectSection:!1}),v=h({columns:[{name:"name",label:"Nombre",field:t=>{var e;return(e=t.staff)==null?void 0:e.complete_name},align:"left"}],filter:null}),V=h({columns:[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},{name:"locationExh",label:"Exhibicion",field:t=>{var e,l;return(l=(e=t.locations)==null?void 0:e.filter(s=>s.celler._type==2))==null?void 0:l.map(s=>s.path).join("/")},align:"left"},{name:"locationGen",label:"General",field:t=>{var e,l;return(l=(e=t.locations)==null?void 0:e.filter(s=>s.celler._type==1))==null?void 0:l.map(s=>s.path).join("/")},align:"left"}],filter:null}),Q=J(()=>a.config.type.val&&a.config.option.val&&a.config.notes&&a.config.resexh.length>0&&a.config.resgen.length>0&&a.config.products.length>0),D=(t,e)=>{const l=e.toUpperCase();return t.filter(s=>{var W,X;const F=Object.values(s).some(I=>String(I!=null?I:"").toUpperCase().includes(l)),ue=(X=(W=s.staff)==null?void 0:W.complete_name.toUpperCase().includes(l))!=null?X:!1;return F||ue})},T=t=>{(t.id==1||t.id==2)&&(r.value.selectSection=!0)},_=t=>{console.log(t),a.config.products.findIndex(l=>l.id==t.id)>=0?f.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):a.config.products.push(t)},L=t=>{console.log(t),a.config.products.findIndex(l=>l.id==t.id)>=0?f.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):a.config.products.push(t)},M=async()=>{if(a.config.option.val.id==2){f.loading.show({message:"Obteniendo Datos"});let t={workpoint:g.session.store.id_viz,seccion:a.config.section.map(l=>l.id)};console.log(t);const e=await z.obtProductSLocation(t);e.fail?console.log(e):(console.log(e),a.config.products=e,f.loading.hide())}},O=async t=>{f.loading.show({message:"Obteniendo Productos"});let e={ubicacion:t.selected,workpoint:g.session.store.id_viz,seccion:a.config.section.map(s=>s.id)};console.log(e);const l=await z.obtProductSections(e);l.fail?console.log(l):(console.log(l),a.config.products=l,f.loading.hide())},j=t=>{console.log(t);let e=a.config.products.findIndex(l=>l.id==t.id);e>=0&&a.config.products.splice(e,1)},N=()=>{Q.value?x("create"):(a.config.type.val||f.notify({message:"Falta un tipo",type:"warning",position:"left"}),a.config.option.val||f.notify({message:"Falta una opci\xF3n",type:"warning",position:"left"}),a.config.notes||f.notify({message:"Faltan notas",type:"warning",position:"left"}),a.config.resexh.length===0&&f.notify({message:"Falta Responsable exhibici\xF3n",type:"warning",position:"left"}),a.config.resgen.length===0&&f.notify({message:"Falta Responsable general",type:"warning",position:"left"}),a.config.products.length===0&&f.notify({message:"Debe agregar productos",type:"warning",position:"left"}))};return(t,e)=>(u(),B(A,null,[o($,null,{default:n(()=>[o(P,{class:"row items-center"},{default:n(()=>[m("div",Oe,[e[10]||(e[10]=U(" Creacion: ")),m("span",je,E(S(re)().format("YYYY-MM-DD")),1),e[11]||(e[11]=U()),e[12]||(e[12]=m("br",null,null,-1)),e[13]||(e[13]=U(" Creador: ")),m("span",Ae,E(S(g).session.credentials.staff.complete_name),1)]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(Z,{modelValue:i.config.notes,"onUpdate:modelValue":e[0]||(e[0]=l=>i.config.notes=l),type:"text",label:"Notas"},null,8,["modelValue"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(q,{class:"",modelValue:i.config.type.val,"onUpdate:modelValue":e[1]||(e[1]=l=>i.config.type.val=l),options:i.config.type.opts,label:"Tipo",disable:""},null,8,["modelValue","options"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(q,{class:"col",modelValue:i.config.option.val,"onUpdate:modelValue":[e[2]||(e[2]=l=>i.config.option.val=l),T],options:i.config.option.opts,label:"Seleccion",disable:!!i.config.option.val},null,8,["modelValue","options","disable"])]),_:1})]),_:1}),o($,{bordered:""},{default:n(()=>[o(P,null,{default:n(()=>[o(Pe,{"expand-separator":"",icon:"fas fa-users",label:"Responsables","header-class":"text-grey-5",modelValue:r.value.team,"onUpdate:modelValue":e[6]||(e[6]=l=>r.value.team=l),caption:`Exh: ${i.config.resexh.length} -- Gen ${i.config.resgen.length}`},{default:n(()=>[o(P,null,{default:n(()=>[o(Z,{modelValue:v.value.filter,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value.filter=l),type:"text",label:"Buscar"},null,8,["modelValue"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),m("div",Te,[m("div",_e,[o(R,{selection:"multiple",selected:i.config.resexh,"onUpdate:selected":e[4]||(e[4]=l=>i.config.resexh=l),title:"Ventas",rows:S(c).users.filter(l=>[8,9].includes(l._rol)),columns:v.value.columns,filter:v.value.filter,"filter-method":D},null,8,["selected","rows","columns","filter"])]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),m("div",Fe,[o(R,{selection:"multiple",selected:i.config.resgen,"onUpdate:selected":e[5]||(e[5]=l=>i.config.resgen=l),title:"Almacen",rows:S(c).users.filter(l=>[4,24].includes(l._rol)),columns:v.value.columns,filter:v.value.filter,"filter-method":D},null,8,["selected","rows","columns","filter"])])])]),_:1})]),_:1},8,["modelValue","caption"])]),_:1})]),_:1}),o(C,{spaced:"",inset:"",vertical:"",dark:""}),i.config.option.val?(u(),y($,{key:0,class:"my-card q-ml-md q-mr-md",bordered:""},{default:n(()=>[i.config.option.val.id==1?(u(),B("div",Ie,[o(q,{class:"col",modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=l=>d.value=l),options:S(c).locations,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),d.value?(u(),y(Me,{key:0,class:"col",sections:d.value.sections,onObtProducts:O},null,8,["sections"])):w("",!0)])):w("",!0)]),_:1})):w("",!0),o(C),i.config.products.length?(u(),y($,{key:1,class:"my-card",bordered:""},{default:n(()=>[o(P,null,{default:n(()=>[o(R,{rows:i.config.products,columns:V.value.columns},{header:n(l=>[o(te,{props:l},{default:n(()=>[(u(!0),B(A,null,G(l.cols,s=>(u(),y(oe,{key:s.name,props:l},{default:n(()=>[U(E(s.label),1)]),_:2},1032,["props"]))),128)),i.config.option.val.id==3?(u(),y(oe,{key:0,"auto-width":""})):w("",!0)]),_:2},1032,["props"])]),body:n(l=>[o(te,{props:l},{default:n(()=>[(u(!0),B(A,null,G(l.cols,s=>(u(),y(le,{key:s.name,props:l},{default:n(()=>[U(E(s.value),1)]),_:2},1032,["props"]))),128)),i.config.option.val.id==3?(u(),y(le,{key:0,"auto-width":""},{default:n(()=>[o(k,{size:"sm",color:"negative",round:"",dense:"",onClick:s=>j(l.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)):w("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})):w("",!0),i.config.option.val?(u(),y(Be,{key:2},{default:n(()=>[i.config.option.val.id==3?(u(),y($,{key:0,class:"row"},{default:n(()=>[o(ze,{class:"col",checkState:!0,onInput:L,onAgregar:_,with_locations_loc:S(g).session.credentials._rol},null,8,["with_locations_loc"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(k,{color:"primary",icon:"send",onClick:N})]),_:1})):w("",!0),i.config.option.val.id!=3?(u(),y($,{key:1},{default:n(()=>[o(k,{class:"full-width",color:"primary",label:"Crear Ciclico :p",onClick:N})]),_:1})):w("",!0)]),_:1})):w("",!0),o(ae,{modelValue:r.value.selectSection,"onUpdate:modelValue":e[9]||(e[9]=l=>r.value.selectSection=l),persistent:""},{default:n(()=>[o($,{style:{"min-width":"350px"}},{default:n(()=>[o(P,null,{default:n(()=>e[14]||(e[14]=[m("div",{class:"text-h6"},"Selecciona una Seccion",-1)])),_:1}),o(P,{class:"q-pt-none"},{default:n(()=>[o(q,{modelValue:i.config.section,"onUpdate:modelValue":e[8]||(e[8]=l=>i.config.section=l),options:S(c).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"])]),_:1}),o(H,{align:"right",class:"text-primary"},{default:n(()=>[ye(o(k,{flat:"",onClick:M,icon:"send"},null,512),[[qe]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Re={class:"text-h6"},Ge={key:0,class:"row items-center"},Bo={__name:"CiclicosLayout",setup(i){h("");const p=ce();ne();const f=se(),g=ie(),c=de(),d=h({state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}),x=h(!0),a=h({from:null,to:null}),r=h({sections:[],date:{from:null,to:null}}),v=async()=>{p.loading.show({message:"Cargado vista..."});let t=re(new Date).format("YYYY/MM/DD");a.value={from:t,to:t};let e={store:g.session.store.id_viz,suc:g.session.store.id,date:a.value};const l=await z.index(e);l.fail?console.log(l):(console.log(l),c.setCyclecount(l.inventories),c.setUsers(l.colab),c.setSections(l.secciones),c.setLocations(l.locations),p.loading.hide())},V=J(()=>{const t=r.value.date;return t?typeof t=="string"?t.length>0:t.from&&t.to:!1}),Q=()=>{d.value={state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}},D=async()=>{console.log(d.value),p.loading.show({message:"Creando Ciclicos"}),d.value._account=g.session.credentials.staff.id_va,d.value._workpoint=g.session.store.id_viz;const t=await z.addCyclecount(d.value);t.fail?console.log(t):(console.log(t),t.success&&(t.data.forEach(e=>c.addCyclecount(e.counter)),p.loading.hide(),Q()))},T=async()=>{p.loading.show({message:"Obteniendo Datos..."});let t={store:g.session.store.id_viz,suc:g.session.store.id,date:a.value};const e=await z.index(t);e.fail?console.log(e):(console.log(e),c.setCyclecount(e.inventories),c.setUsers(e.colab),c.setSections(e.secciones),c.setLocations(e.locations),p.loading.hide())},_=async()=>{p.loading.show({message:"Obteniendo Datos..."});let t={store:g.session.store.id_viz,params:r.value};console.log(t);const e=await z.productCyclecount(t);if(e.fail)console.log(e);else{console.log(e);let l="";const s=r.value.date;typeof s=="string"?l=`PSC_${s.replaceAll("/","_")}`:l=`PSC_${s.from.replaceAll("/","_")}_a_${s.to.replaceAll("/","-")}`;let F={key:l,value:e};Ne.conStockSinContar(F),p.loading.hide()}},L=t=>{console.log(t),p.notify({message:`El usuario ${t.me.names} Se Unio :)`,type:"positive",position:"top"})},M=t=>{console.log(t),c.lock(t.product.id,t)},O=t=>{console.log(t),c.unlock(t.product.id)},j=t=>{console.log(t),c.updateLockedProduct(t.product)},N=t=>{c.updateCyclecounts(t.counter),p.notify({message:`Termino el conteo ${t.user.me.names}`}),f.push("/ciclicos/counted")};return Ce(()=>{v(),b.on("connect",()=>{c.socket_user&&b.emit("index",c.socket_user.profile)}),b.connect(),ke(()=>c.socket_user.profile,t=>{t&&b.connected&&b.emit("index",t)},{immediate:!0}),b.on("joined",L),b.on("counting",M),b.on("cancelcounting",O),b.on("countingconfirmed",j),b.on("endingCounting",N)}),we(()=>{b.off("joined",L),b.off("counting",M),b.off("cancelcounting",O),b.off("countingconfirmed",j),b.off("endingCounting",N)}),v(),(t,e)=>{const l=xe("router-view");return u(),y(Ue,{view:"hHh Lpr fFf"},{default:n(()=>[o(Qe,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[o(De),o(C)]),_:1}),o($e,null,{default:n(()=>[o(Se,{class:"justify-between"},{default:n(()=>[m("div",null,[e[7]||(e[7]=m("span",{class:"text-grey"},"Helpers",-1)),e[8]||(e[8]=U()),o(Ve,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=U()),m("span",Re,E(S(c).title),1)]),S(c).showBtns?(u(),B("div",Ge,[o(k,{color:"primary",icon:"event",flat:""},{default:n(()=>[o(ee,null,{default:n(()=>[o($,{class:"my-card"},{default:n(()=>[o(P,null,{default:n(()=>[m("div",null,[e[10]||(e[10]=m("div",{class:"q-pb-sm text-center"},null,-1)),o(K,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value=s),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(H,{vertical:"",align:"center"},{default:n(()=>[o(k,{flat:"",label:"Obtener",color:"positive",onClick:T})]),_:1})]),_:1})]),_:1})]),_:1}),o(k,{color:"primary",icon:"add_shopping_cart",dense:"",flat:""},{default:n(()=>[o(ee,null,{default:n(()=>[e[12]||(e[12]=m("div",{class:"q-pa-md"},"Productos Sin Conteo",-1)),o(C),o(P,null,{default:n(()=>[o(q,{modelValue:r.value.sections,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value.sections=s),options:S(c).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":"",dense:""},null,8,["modelValue","options"]),m("div",null,[e[11]||(e[11]=m("div",{class:"q-pb-sm text-center"},null,-1)),o(K,{modelValue:r.value.date,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.date=s),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(H,{vertical:"",align:"center"},{default:n(()=>[o(k,{flat:"",label:"Obtener",color:"positive",onClick:_,disable:!r.value.sections.length||!V.value},null,8,["disable"])]),_:1})]),_:1})]),_:1}),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(k,{color:"primary",icon:"add",outline:"",onClick:e[3]||(e[3]=s=>d.value.state=!d.value.state)})])):w("",!0)]),_:1}),o(ae,{modelValue:d.value.state,"onUpdate:modelValue":e[6]||(e[6]=s=>d.value.state=s),persistent:"",maximized:x.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:n(()=>[o($,null,{default:n(()=>[o(Ee,null,{default:n(()=>[e[16]||(e[16]=m("div",{class:"text-center text-h6"},"Nuevo Inventario",-1)),o(he),o(k,{dense:"",flat:"",icon:"minimize",onClick:e[4]||(e[4]=s=>x.value=!1),disable:!x.value},{default:n(()=>[x.value?(u(),y(Y,{key:0},{default:n(()=>e[13]||(e[13]=[U("Minimize")])),_:1})):w("",!0)]),_:1},8,["disable"]),o(k,{dense:"",flat:"",icon:"crop_square",onClick:e[5]||(e[5]=s=>x.value=!0),disable:x.value},{default:n(()=>[x.value?w("",!0):(u(),y(Y,{key:0},{default:n(()=>e[14]||(e[14]=[U("Maximize")])),_:1}))]),_:1},8,["disable"]),o(k,{dense:"",flat:"",icon:"close",onClick:Q},{default:n(()=>[o(Y,null,{default:n(()=>e[15]||(e[15]=[U("Close")])),_:1})]),_:1})]),_:1}),o(Ye,{config:d.value,onCreate:D},null,8,["config"])]),_:1})]),_:1},8,["modelValue","maximized"]),o(l)]),_:1})]),_:1})}}};export{Bo as default};
