import{Q as _}from"./QSeparator.9ed28fa7.js";import{aE as j,u as L,r as b,c as P,aY as M,o as C,a as S,w as t,e,f as c,Y as T,Q as v,a4 as y,a3 as m,a2 as D,a_ as N,g as Y,a1 as U,a0 as q,h as H,ak as K,a6 as O}from"./index.b92dd970.js";import{Q as J}from"./QToolbar.664fb04b.js";import{Q as W}from"./QHeader.6dae8364.js";import{Q as z}from"./QInput.1622385a.js";import{a as G}from"./QSelect.aba570a7.js";import{Q,a as f}from"./QItemSection.78b45b77.js";import{Q as X}from"./QSlideTransition.981d2dc6.js";import{Q as Z}from"./QList.25de2146.js";import{Q as ee}from"./QTable.dbf1f078.js";import{Q as oe}from"./QDate.686093bf.js";import{Q as ae,a as R}from"./QCard.7eb7d094.js";import{Q as te}from"./QCardActions.acb6c307.js";import{Q as le}from"./QDialog.d832f787.js";import{Q as se,a as re}from"./QLayout.50c51a47.js";import"./AppFullscreen.98699624.js";import{u as ne}from"./use-quasar.03dae121.js";import"./auto.38810c21.js";import{d as x}from"./dayjs.min.cbcf888d.js";import{E as ie}from"./exceljs.min.9e24d01d.js";import{E as de,a as ce}from"./jspdf.plugin.autotable.95e2f6b3.js";import{_ as ue}from"./UserToolbar.6dc4ff3f.js";import{A as me}from"./assistApi.03ca0edf.js";import{u as fe}from"./VDB.40e0e52b.js";import{a as pe}from"./axios.9ab26c22.js";import"./QResizeObserver.50734c85.js";import"./use-key-composition.3d5c685a.js";import"./uid.937d8ee7.js";import"./position-engine.ef70afb5.js";import"./rtl.276c3f1b.js";import"./QLinearProgress.c27a8b87.js";import"./QCheckbox.54ac594f.js";import"./use-render-cache.3aae9b27.js";import"./date.754fee93.js";import"./_commonjsHelpers.88e99c8f.js";import"./ClosePopup.85079279.js";import"./axios.ba7b1b0e.js";const ge={class:"row"},ve={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition"},we={class:"text-bold"},ye={class:"text-overline"},he={key:0,class:""},be={class:"q-pa-md"},ro={__name:"OpneBoxesLYT",setup(Ce){const i=ne();j();const V=L(),k=fe(),u=b(!1),w=b(null),p=b([]),h=b({pagination:{rowsPerPage:0},filter:""});P(()=>i.platform.is.mobile);const A=async()=>{i.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const r=await me.index();if(r.error)console.log(r);else{console.log(r),p.value=r;let o=new Date,s=x(o).format("YYYY/MM/DD");w.value=s,console.log(s),E(p.value,w.value).finally(()=>{i.loading.hide()})}},E=async(r,o)=>{console.log(o);const s=r.map((a,l)=>new Promise((d,n)=>{setTimeout(()=>{a.sale=null;let B=`http://${a.ip_address}/access/public/reports/OpenCash`;pe.post(B,{filt:o}).then(g=>{a.sales=g.data||null,console.log(g.data),console.log(`Sucursal ${a.name} procesada con \xE9xito.`),d({success:!0,data:g.data})}).catch(g=>{console.log(`Error en sucursal ${a.name}: ${g.message}`),a.sales=[],i.notify({message:`Sucursal ${a.name} no tiene conexion`,type:"negative",position:"center"}),d({success:!1,error:g.message})})},l*1e3)}));try{await Promise.all(s)}catch(a){console.error("Error en alguna de las solicitudes:",a)}};k.session.rol==="adm"||k.session.rol==="root"?A():(i.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),V.replace("/"));const $=()=>{u.value=!1,i.loading.show({message:"Obteniendo Datos"}),E(p.value,w.value).finally(()=>{i.loading.hide()})},F=()=>new Promise((r,o)=>{try{let s=[];p.value.forEach((l,d)=>{s.push([{content:l.name,colSpan:3,styles:{halign:"center",fillColor:[173,216,230],fontStyle:"bold"}}]),l.sales.forEach(n=>{s.push([x(n.FECFAC).format("YYYY-MM-DD"),n.DESTER,n.TICKETS])})});const a=new de({format:"letter"});ce(a,{head:[["Fecha","Caja","Tickets"]],body:s}),a.save("Reporte de Cajas"),r()}catch(s){o(s)}}),I=()=>{i.loading.show({message:"Importando Ticket"});const r=new ie.Workbook,o=r.addWorksheet("Comparativo");o.columns=[{header:"Fecha",key:"FECFAC",width:20},{header:"Destino",key:"DESTER",width:30},{header:"Tickets",key:"TICKETS",width:10}],p.value.forEach(a=>{const l=o.addRow([a.name]);l.font={bold:!0},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ADD8E6"}},l.alignment={horizontal:"center"},a.sales.forEach(d=>{o.addRow(d)}),o.addRow([])}),(async()=>{const a=await r.xlsx.writeBuffer(),l=new Blob([a],{type:"application/octet-stream"}),d=URL.createObjectURL(l),n=document.createElement("a");n.href=d,n.download="ReporteCajas.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)})(),i.loading.hide()};return(r,o)=>{const s=M("router-view");return C(),S(se,{view:"hHh Lpr fFf"},{default:t(()=>[e(re,null,{default:t(()=>[e(W,{class:"bg-grey-3 text-dark",bordered:""},{default:t(()=>[e(ue),e(_),e(J,{class:"justify-between"},{default:t(()=>[c("div",null,[o[5]||(o[5]=c("span",{class:"text-grey"},"Helpers",-1)),e(T,{name:"navigate_next",color:"primary"}),o[6]||(o[6]=c("span",{class:"text-h6"},"Cajas Abiertas",-1))]),c("div",ge,[e(v,{color:"primary",icon:"event",onClick:o[0]||(o[0]=a=>u.value=!u.value),flat:"",round:""}),e(v,{color:"primary",icon:"download",onClick:F,flat:"",round:""}),e(v,{color:"primary",icon:"calculate",onClick:I,flat:"",round:""})])]),_:1})]),_:1}),e(ee,{title:"Sucursales",rows:p.value,"hide-header":"",pagination:h.value.pagination,filter:h.value.filter},{"top-right":t(()=>[e(z,{borderless:"",dense:"",debounce:"300",modelValue:h.value.filter,"onUpdate:modelValue":o[1]||(o[1]=a=>h.value.filter=a),placeholder:"Buscar"},{append:t(()=>[e(T,{name:"search"})]),_:1},8,["modelValue"])]),body:t(a=>[c("div",ve,[e(Z,{bordered:"",dense:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(f,null,{default:t(()=>[e(G,{class:"flex justify-between"},{default:t(()=>{var l;return[c("div",we,y(a.row.name),1),c("div",ye,[m(y((l=a.row.sales)==null?void 0:l.length)+" ",1),e(v,{color:"grey",flat:"",dense:"",icon:a.expand?"keyboard_arrow_up":"keyboard_arrow_down",onClick:d=>a.expand=!a.expand},null,8,["icon","onClick"])])]}),_:2},1024)]),_:2},1024)]),_:2},1024),e(X,null,{default:t(()=>[a.row.sales?D((C(),Y("div",he,[e(_),e(Q,{class:"text-center"},{default:t(()=>[e(f,null,{default:t(()=>o[7]||(o[7]=[m(" FECHA ")])),_:1}),e(f,null,{default:t(()=>o[8]||(o[8]=[m(" CAJA ")])),_:1}),e(f,null,{default:t(()=>o[9]||(o[9]=[m(" TICKETS ")])),_:1})]),_:1}),(C(!0),Y(U,null,q(a.row.sales,(l,d)=>D((C(),S(Q,{class:"text-center",dense:"",clickable:""},{default:t(()=>[e(f,null,{default:t(()=>[m(y(K(x)(l.FECFAC).format("YYYY-MM-DD")),1)]),_:2},1024),e(f,null,{default:t(()=>[m(y(l.DESTER),1)]),_:2},1024),e(f,null,{default:t(()=>[m(y(l.TICKETS),1)]),_:2},1024)]),_:2},1024)),[[O]])),256))],512)),[[N,a.expand]]):H("",!0)]),_:2},1024)]),_:2},1024),e(_,{spaced:"",inset:"",vertical:"",dark:""})])]),_:1},8,["rows","pagination","filter"]),e(le,{modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=a=>u.value=a)},{default:t(()=>[e(ae,{class:"my-card"},{default:t(()=>[e(R,null,{default:t(()=>[c("div",be,[o[10]||(o[10]=c("div",{class:"q-pb-sm"},null,-1)),e(oe,{modelValue:w.value,"onUpdate:modelValue":o[2]||(o[2]=a=>w.value=a),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(R,null,{default:t(()=>[e(te,{align:"right"},{default:t(()=>[e(v,{flat:"",icon:"close",color:"negative",onClick:o[3]||(o[3]=a=>u.value=!u.value)}),e(v,{flat:"",icon:"check",color:"positive",onClick:$})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(s)]),_:1})]),_:1})}}};export{ro as default};
