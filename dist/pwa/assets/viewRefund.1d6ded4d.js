import{a as _,Q as C}from"./QCard.a83387b5.js";import{Q as h}from"./QSeparator.4b2c57a4.js";import{Q as E,a as v}from"./QItemSection.676c6463.js";import{Q as D}from"./QList.f4cc273d.js";import{u as M,aE as O,r as x,c as T,o as c,a as p,w as s,h as V,e as t,f as i,a5 as r,a0 as U,a4 as f,g as L,a1 as j,a2 as z,Q as u,a3 as k,b3 as G,a7 as J}from"./index.1eb0c284.js";import{Q}from"./QCardActions.89707339.js";import{Q as I}from"./QDialog.feb16004.js";import{Q as K}from"./QFooter.53c37772.js";import{Q as W}from"./QPage.478cc9d0.js";import{C as X}from"./ClosePopup.02bfe67f.js";import{u as Z}from"./VDB.3b813074.js";import{u as ee}from"./use-quasar.4a3a4e1a.js";import"./jspdf.plugin.autotable.e093c349.js";import{r as b}from"./refundsApi.2501a52a.js";import"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{d as te}from"./dayjs.min.cbcf888d.js";import{P as oe}from"./ProductsAutocomplete.29f1c046.js";import"./QResizeObserver.3fc61669.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.ba7b1b0e.js";import"./axios.9ab26c22.js";import"./QInput.18de77cb.js";import"./use-key-composition.4dd78fd7.js";import"./uid.937d8ee7.js";import"./QSelect.83a530cc.js";import"./position-engine.9da78d89.js";import"./rtl.276c3f1b.js";/* empty css                                                                         */const le={class:"text-center"},ae={class:"text-bold"},se={class:"col text-center"},ie={class:"text-bold"},ne={class:"col text-center"},de={class:"text-bold"},re={class:"col text-center"},ue={class:"text-bold"},ce={class:"col text-center"},ve={class:"text-bold"},pe={class:"text-center text-h4"},fe={class:"text-center text-h6 text-grey-14"},me={class:"text-center"},ge={class:"q-pa-xs"},_e={class:"row"},xe={class:"col column q-py-md"},Ke={__name:"viewRefund",setup(be){const w=M(),m=O(),g=Z(),n=ee();x([]),x([]);const d=x(null),y=x(!1),l=x({state:!1,val:null}),S=T(()=>{var o;return((o=d.value)==null?void 0:o.bodie.filter(e=>{var a;return e.product==((a=l.value.val)==null?void 0:a.product)}).length)>0}),R=async()=>{n.loading.show({message:"Obteniendo Datos"});let o=g.session.store.id,e=m.params.rid;console.log(e);const a=await b.getRefund(o,e);a.error?console.log(a):a.status.id==1?(console.log(a),n.loading.hide(),d.value=a):(n.notify({message:"Ya no se puede modificar la devolucion",type:"negative",position:"top"}),w.replace("/refunds"))},A=o=>{console.log(o)},$=o=>{let e=d.value.bodie.findIndex(a=>a.product==o.code);console.log(e),e>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(l.value.val={product:o.code,description:o.description,price:o.cost,to_delivered:1},l.value.state=!0,console.log(o))},P=()=>{l.value={val:null,state:!1}},B=async()=>{n.loading.show({message:"Insertando Producto"}),l.value.val._refund=m.params.rid,console.log(l.value.val);const o=await b.addProduct(l.value.val);o.fail?console.log(o):(console.log(o),d.value.bodie.push(l.value.val),l.value={val:null,state:!1},n.loading.hide())},N=async()=>{n.loading.show({message:"Creando Devolucion"});const o=await b.endRefund({id:m.params.rid});o.fail?console.log(o):(console.log(o),n.notify({message:`Se creo la devolucion ${o.fs_id} Correctamente`,type:"positive",position:"center"}),w.push("/refunds")),n.loading.hide()},F=async()=>{n.loading.show({message:"Editando Producto"}),console.log(l.value.val),l.value.val._refund=m.params.rid;const o=await b.editProduct(l.value.val);if(o.fail)console.log(o);else{console.log(o);let e=d.value.bodie.findIndex(a=>a.product==l.value.val.product);e>=0&&(d.value.bodie[e].to_delivered=l.value.val.to_delivered,n.notify({type:"positive",position:"center"}),l.value={val:null,state:!1},n.loading.hide())}},Y=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(l.value.val),l.value.val._refund=m.params.rid;const o=await b.deleteProduct(l.value.val);if(o.fail)console.log(o);else{console.log(o);let e=d.value.bodie.findIndex(a=>a.product==l.value.val.product);e>=0&&(d.value.bodie.splice(e,1),n.notify({type:"positive",position:"center"}),l.value={val:null,state:!1},n.loading.hide())}},q=o=>{l.value.state=!0,l.value.val=o};return g.session.rol=="aux"||g.session.rol=="gen"||g.session.rol=="aud"||g.session.rol=="root"?R():(n.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),w.replace("/")),(o,e)=>d.value?(c(),p(W,{key:0,padding:""},{default:s(()=>[t(C,{class:"my-card"},{default:s(()=>[t(_,{class:"row"},{default:s(()=>[i("div",le,[e[6]||(e[6]=i("div",{class:"text-caption"},"ID",-1)),i("div",ae,r(d.value.id),1)]),i("div",se,[e[7]||(e[7]=i("div",{class:"text-caption"},"REFERENCIA",-1)),i("div",ie,r(d.value.reference),1)]),i("div",ne,[e[8]||(e[8]=i("div",{class:"text-caption"},"DESTINO",-1)),i("div",de,r(d.value.storeto.name),1)]),i("div",re,[e[9]||(e[9]=i("div",{class:"text-caption"},"CREADO",-1)),i("div",ue,r(d.value.createdby.complete_name),1)]),i("div",ce,[e[10]||(e[10]=i("div",{class:"text-caption"},"FECHA",-1)),i("div",ve,r(U(te)(d.value.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:1})]),_:1}),t(h,{spaced:"",inset:"",vertical:"",dark:""}),t(D,{bordered:""},{default:s(()=>[t(E,null,{default:s(()=>[t(v,null,{default:s(()=>e[11]||(e[11]=[f(" Producto ")])),_:1}),t(v,null,{default:s(()=>e[12]||(e[12]=[f(" Descripcion ")])),_:1}),t(v,{class:"text-center"},{default:s(()=>e[13]||(e[13]=[f(" Cantidad ")])),_:1})]),_:1})]),_:1}),(c(!0),L(z,null,j(d.value.bodie,(a,H)=>(c(),p(D,{bordered:"",key:H},{default:s(()=>[k((c(),p(E,{clickable:"",onClick:ye=>q(a)},{default:s(()=>[t(v,null,{default:s(()=>[f(r(a.product),1)]),_:2},1024),t(v,null,{default:s(()=>[f(r(a.description),1)]),_:2},1024),t(v,{class:"text-center"},{default:s(()=>[f(r(a.to_delivered),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[J]]),t(h)]),_:2},1024))),128)),t(I,{modelValue:l.value.state,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.state=a),persistent:"",position:"bottom"},{default:s(()=>[t(C,{style:{width:"300","max-width":"40vw"}},{default:s(()=>[t(_,null,{default:s(()=>[i("div",pe,r(l.value.val.product),1),i("div",fe,r(l.value.val.description),1)]),_:1}),t(_,null,{default:s(()=>[i("div",me,[i("div",ge,[e[14]||(e[14]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",_e,[t(u,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[0]||(e[0]=a=>l.value.val.to_delivered>1?l.value.val.to_delivered--:"")}),i("div",xe,[k(i("input",{type:"number",min:"1","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.val.to_delivered=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[G,l.value.val.to_delivered]])]),t(u,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[2]||(e[2]=a=>l.value.val.to_delivered++)})])])])]),_:1}),S.value?(c(),p(Q,{key:1,align:"center"},{default:s(()=>[t(u,{flat:"",icon:"close",color:"red-10",onClick:P}),t(u,{flat:"",label:"Eliminar",color:"negative",onClick:Y}),t(u,{flat:"",label:"Editar",color:"blue-10",onClick:F})]),_:1})):(c(),p(Q,{key:0,align:"center"},{default:s(()=>[t(u,{flat:"",label:"Cancelar",color:"negative",onClick:P}),t(u,{flat:"",label:"Agregar",color:"positive",onClick:B})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t(I,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=a=>y.value=a),persistent:""},{default:s(()=>[t(C,null,{default:s(()=>[t(_,{class:"row items-center"},{default:s(()=>e[15]||(e[15]=[i("span",{class:"text text-h6"},"Estas Seguro de terminar la devolucion no se podra editar",-1)])),_:1}),t(Q,{align:"right"},{default:s(()=>[k(t(u,{flat:"",icon:"close",color:"negative"},null,512),[[X]]),t(u,{flat:"",icon:"check",color:"positive",onClick:N})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:s(()=>[t(C,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[t(_,{class:"row"},{default:s(()=>[t(oe,{class:"col",checkState:!1,onInput:A,onAgregar:$}),d.value.bodie.length>0?(c(),p(u,{key:0,color:"primary",flat:"",icon:"east",onClick:e[5]||(e[5]=a=>y.value=!y.value),round:""})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0)}};export{Ke as default};
