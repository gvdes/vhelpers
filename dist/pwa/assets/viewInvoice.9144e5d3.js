import{u as U,a as j,aH as z,r as _,c as L,o as c,g as C,d as m,w as r,h as f,e as i,a3 as I,Q as p,a1 as M,f as l,a0 as v,ak as G,a2 as H}from"./index.ca87d28d.js";import{Q as J}from"./QToolbarTitle.4652ab3d.js";import{Q as K}from"./QToolbar.41aab460.js";import{Q as W,b as y}from"./QList.480ef6bc.js";import{Q as X}from"./QTable.964a5ee1.js";import{Q as V,a as w}from"./QCard.8d487bc8.js";import{Q as Y}from"./QFooter.0e8efa17.js";import{Q as Z}from"./QPage.dcdce54d.js";import{Q as ee}from"./QSelect.5fca23fd.js";import{Q as S}from"./QInput.a4292b5a.js";import{Q as te}from"./QSpace.60944b25.js";import{Q as ae}from"./QCardActions.59eb0670.js";import"./QExpansionItem.bfe72b71.js";import"./QDrawer.19bbf37f.js";import"./ClosePopup.d4dfdba4.js";import{u as oe}from"./axios.72b55d35.js";import{P as le}from"./ProductsAutocomplete.6beaa660.js";import{I as ie}from"./invoices.7c35fcae.js";import"./dayjs.min.cbcf888d.js";import"./jspdf.plugin.autotable.9b30a1df.js";import{$sktRestock as N}from"./socket.3fae67a0.js";import{i as g}from"./invoicesApi.510d043a.js";import"./QForm.c7bc20b6.js";import"./Restock.1660442e.js";import"./QBtnGroup.f9fa0187.js";import"./QLinearProgress.a1612e80.js";import"./QCheckbox.5671ec7a.js";import"./QResizeObserver.910a61cc.js";import"./QScrollObserver.583f84b2.js";import"./touch.9135741d.js";/* empty css                                                                         */import"./browser.eff7c919.js";import"./_commonjsHelpers.88e99c8f.js";const se={class:"col"},ne={class:"col"},de={class:"col text-right"},ue={class:"row q-ml-sm"},re={class:"row justify-between"},ve={class:"text-left"},ce={class:"text--3"},pe={class:"text-h6"},me={class:"text-right"},fe={class:"text-bold"},_e={class:"text--2"},ge={class:"text-center"},he={class:"text-h6"},ke={class:"text-h6"},ye={class:"text--2"},be={class:"row items-start justify-between"},xe={class:"text-center col text-primary"},we={class:"text-center col"},Qe={class:"text-center col"},Ce={class:"text-center col"},Pe={class:"text-bold"},nt={__name:"viewInvoice",setup(De){U();const s=oe(),h=j(),b=z(),d=_(null),u=_([]),n=_({val:{id:1,label:"Pieza"},opts:[{id:1,label:"Pieza"},{id:2,label:"Docena"},{id:3,label:"Caja"}]}),e=_({state:!1,val:null,edit:!1}),P=_({toDelivered:1,_supply_by:1,units:1,cost:0,total:0,comments:"",stock:0,ipack:0}),D=_({pagination:{rowsPerPage:0},columns:[{name:"code",label:"CODIGO",field:a=>a.code,align:"left"},{name:"description",label:"DESCRIPCION",field:a=>a.description,align:"left"},{name:"amount_delivered",label:"CANTIDAD",field:a=>a.pivot.units,align:"center"}]}),k=L(()=>{var a,t;return((a=n.value.val)==null?void 0:a.id)==3?e.value.val.pivot.toDelivered*e.value.val.pivot.ipack:((t=n.value.val)==null?void 0:t.id)==2?e.value.val.pivot.toDelivered*12:e.value.val.pivot.toDelivered}),q=async()=>{s.loading.show({message:"Obeteniendo Datos"});const a=await g.getInvoice(b.params.inv);a.fail?a.fail.status==401?(h.push("/distribute/invoice"),s.notify({message:"La factura ya se realizo",type:"negative",position:"center"}),s.loading.hide()):(a.fail.status=404)?(h.push("/distribute/invoice"),s.notify({message:"No existe la Factura",type:"negative",position:"center"}),s.loading.hide()):console.log(a):(console.log(a),d.value=a,u.value=a.products,s.loading.hide())},F=a=>{console.log(a);let t=u.value.findIndex(o=>o.id==a.id);console.log(t),t>=0?(e.value.val=u.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(o=>o.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=a,e.value.val.pivot=P.value,e.value.val.pivot.ipack=a.pieces,e.value.state=!0)},A=a=>{console.log(a);let t=u.value.findIndex(o=>o.id==a.id);console.log(t),t>=0?(e.value.val=u.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(o=>o.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=a,e.value.val.pivot=P.value,e.value.val.pivot.ipack=a.pieces,e.value.state=!0)},B=async()=>{s.loading.show({message:"Creando Factura"}),console.log(d.value);const a=await g.changestate(d.value);a.fail?console.log(a):(console.log(a),N.emit("order_refresh",{order:a.requisitiion}),N.emit("orderpartition_refresh",{order:a.partition}),ie.invoiceFormat(a.partition),T(a.partition))},T=async a=>{const t=await g.addInvoiceFS(a);t.fail?t.fail.status==503?(s.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide()):console.log(t):(s.notify({message:`Salida Creada ${t}`,type:"positive",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide())},x=()=>{e.value={state:!1,val:null,edit:!1}},$=async()=>{s.loading.show({message:"Insertando Producto"});let a={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(o=>o.id==1).pivot.gen,amount:0,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};const t=await g.addProduct(a);t.fail?console.log(t):(s.loading.hide(),u.value.push(t)),x()},E=async()=>{s.loading.show({message:"Eliminando Producto"}),console.log(e.value);let a={_requisition:b.params.inv,_product:e.value.val.id};console.log(a);const t=await g.deleteProduct(a);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let o=u.value.findIndex(Q=>Q.id==a._product);u.value.splice(o,1)}x()},O=async()=>{s.loading.show({message:"Editando Producto"}),console.log(e.value);let a={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(o=>o.id==1).pivot.gen,amount:0,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};console.log(a);const t=await g.editProduct(a);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let o=u.value.findIndex(Q=>Q.id==a.id);console.log(e.value.val),u.value.splice(o,1,t)}x()},R=(a,t)=>{console.log(t),e.value.val=t,n.value.val=n.value.opts.find(o=>o.id==t.pivot._supply_by),e.value.state=!0,e.value.edit=!0};return q(),(a,t)=>(c(),C(I,null,[d.value?(c(),m(Z,{key:0,padding:""},{default:r(()=>[i(K,{class:"bg-primary text-white"},{default:r(()=>[i(p,{flat:"",round:"",dense:"",icon:"arrow_back ",onClick:t[0]||(t[0]=o=>M(h).push("/distribute/invoice"))}),i(J,{class:"row"},{default:r(()=>[l("div",se,"Origen : "+v(d.value.to.name),1),l("div",ne,"Destino : "+v(d.value.from.name),1),l("div",de,v(d.value.created_by.nick),1)]),_:1}),i(p,{flat:"",round:"",dense:"",icon:"download",class:"q-mr-xs"}),i(p,{flat:"",round:"",dense:"",icon:"upload"})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),u.value.length>0?(c(),m(X,{key:0,rows:u.value,"hide-bottom":"",columns:D.value.columns,pagination:D.value.pagination,onRowClick:R},null,8,["rows","columns","pagination"])):f("",!0),i(Y,{reveal:"",elevated:"",bordered:""},{default:r(()=>[i(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",ue,[i(V,{class:"col"},{default:r(()=>[i(le,{checkState:!1,onInput:F,with_prices_Invoice:"",with_stock:"",onAgregar:A,with_locations:""})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",null,[u.value.length>0?(c(),m(p,{key:0,flat:"",icon:"send",onClick:B})):f("",!0)])]),i(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})):f("",!0),i(W,{modelValue:e.value.state,"onUpdate:modelValue":t[4]||(t[4]=o=>e.value.state=o),position:"bottom"},{default:r(()=>[e.value.val?(c(),m(V,{key:0},{default:r(()=>[i(w,{class:"bg-grey-3"},{default:r(()=>[l("div",re,[l("div",ve,[l("div",ce,"ID: "+v(e.value.val.id),1),l("div",pe,v(e.value.val.code),1)]),l("div",me,[l("div",fe,v(e.value.val.name),1),l("div",_e,v(e.value.val.barcode),1)])])]),_:1}),i(y),i(w,null,{default:r(()=>[G(v(e.value.val.description),1)]),_:1}),i(w,{class:"row justify-around items-center"},{default:r(()=>[l("div",ge,[l("div",he,v(e.value.val.pieces),1),t[5]||(t[5]=l("div",{class:"text--2"},"PxC",-1))]),(c(!0),C(I,null,H(e.value.val.stocks,o=>(c(),C("div",{key:o.id,class:"text-center"},[l("div",ke,v(o.pivot.gen),1),l("div",ye,v(o.alias),1)]))),128))]),_:1}),i(w,null,{default:r(()=>[l("div",be,[l("div",xe,[i(ee,{modelValue:n.value.val,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.val=o),options:n.value.opts,label:"Unidad Medida",filled:"",dense:""},null,8,["modelValue","options"])]),l("div",we,[t[6]||(t[6]=l("div",null,"Conteo",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.toDelivered,"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.val.pivot.toDelivered=o),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter"},null,8,["modelValue"])]),l("div",Qe,[t[7]||(t[7]=l("div",null,"PxC",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.ipack,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.val.pivot.ipack=o),type:"number","input-class":"text-h6 text-center",disable:n.value.val.id!=3},null,8,["modelValue","disable"])]),l("div",Ce,[t[8]||(t[8]=l("div",null,"Piezas",-1)),l("div",Pe,v(k.value),1)])])]),_:1}),i(ae,null,{default:r(()=>[i(p,{flat:"",icon:"close",onClick:x}),i(te),e.value.edit?f("",!0):(c(),m(p,{key:0,flat:"",icon:"add",color:"positive",onClick:$})),e.value.edit?(c(),m(p,{key:1,flat:"",icon:"delete",color:"negative",onClick:E})):f("",!0),e.value.edit?(c(),m(p,{key:2,flat:"",icon:"edit",color:"warning",onClick:O})):f("",!0)]),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"])],64))}};export{nt as default};
