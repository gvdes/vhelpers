import{Q as ee}from"./QSelect.fc026183.js";import{b as x,Q as le}from"./QList.9295e2d8.js";import{u as ce,r as p,l as ve,o as u,d as w,w as s,e as t,g as b,a3 as _,a2 as U,f as B,Q as V,h as E,ak as y,a0 as Q,a4 as D,aA as me}from"./index.d54473fa.js";import{Q as N}from"./QTd.c0ddffe1.js";import{Q as L}from"./QTr.eed4841a.js";import{Q as M}from"./QTable.1a56a17d.js";import{Q as m}from"./QCardSection.b6baa634.js";import{Q as T}from"./QCard.18e987e4.js";import{Q as O}from"./QInput.439b14c8.js";import{Q as ae}from"./QRadio.0bb6195c.js";import{Q as te}from"./QCardActions.36c2cf1b.js";import{Q as pe}from"./QPage.4b0aa5b3.js";import{C as oe}from"./ClosePopup.4d8b2113.js";import"./QDrawer.2f52e696.js";import"./axios.dc1547a3.js";import{u as fe}from"./use-quasar.e887f873.js";import{u as ge}from"./warehousStore.08fc4cff.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.cfcb9684.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as z}from"./locationsApi.dbe9dca5.js";import"./QLinearProgress.3b59fbfd.js";import"./QCheckbox.9efc4b8d.js";import"./QResizeObserver.554492f9.js";import"./QScrollObserver.cb611535.js";import"./_commonjsHelpers.88e99c8f.js";const be={key:0,class:"row"},Ve={class:"row"},he={class:"text-right row"},we={class:"text-bold"},Xe={__name:"locations",setup(ye){const R=ce(),f=fe();ge().setTitle("Ubicaciones Estructura");const $=p([]),i=p(null),a=p({state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]}),r=p({state:!1,val:null}),C=p([]),d=p([]),j=p(0),F=p({columns:[{name:"id",label:"ID",field:o=>o.id,align:"center"},{name:"name",label:"NOMBRE",field:o=>o.name,align:"left"},{name:"alias",label:"ALIAS",field:o=>o.alias,align:"left"},{name:"path",label:"PATH",field:o=>o.path,align:"left"}]}),se=async()=>{f.loading.show({message:"Obteniendo Secciones"});const o=await z.index(R.session.store.id_viz);o.fail?console.log(o):$.value=o,f.loading.hide()},P=()=>{const o=i.value.sections||[];j.value=Math.max(...o.map(l=>l.deep)),d.value=[{options:o.filter(l=>l.root===0),selected:null}],C.value=d.value[0].options},S=o=>{var l;return((l=i.value.sections)==null?void 0:l.filter(e=>e.root===o))||[]},ne=(o,l)=>{d.value.splice(l+1);const e=S(o);e.length>0&&d.value.push({options:e,selected:null})},ue=()=>{const o=d.value.filter(l=>l.selected!==null);if(!o.length)console.log("crear una raiz"),a.value.state=!0,a.value.val=i.value,a.value.type=!0;else{console.log("crear hijos");const l=o[o.length-1],e=l.selected,n=l.options.find(c=>c.id===e);a.value.state=!0,a.value.val=n,a.value.type=!1}},ie=async()=>{f.loading.show({message:"Enviando Datos"}),a.value.defaultView.forEach(e=>{e.root=a.value.type?0:a.value.val.id,e.deep=a.value.type?0:Number(a.value.val.deep)+1,e._celler=a.value.type?a.value.val.id:a.value.val._celler,e.details={create:R.session.credentials.nick}}),console.log(a.value);let o={sections:a.value.defaultView};const l=await z.insertSection(o);l.fail?console.log(l):(console.log(l),l.forEach(n=>{console.log(n),a.value.type?C.value.push(n):i.value.sections.push(n)}),f.notify({message:"Secciones Creadas",type:"positive",position:"bottom"}),f.loading.hide(),a.value={state:!1,val:null,type:!1,secuence:!0,create:{name:null,alias:null,elementos:1},defaultView:[]})},q=o=>{const l=S(o.id);return{...o,pivot:l.map(e=>q(e))}},re=o=>{let l=q(o);console.log(l),r.value.state=!0,r.value.val=l},de=async()=>{f.loading.show({message:"eliminando Seccion"}),console.log(r.value.val),console.log(i.value);const o=await z.deleteSection(r.value.val);o.fail?console.log(o):(console.log(o),i.value.sections=i.value.sections.filter(l=>!o.ids.includes(l.id)),P(),r.value={state:!1,val:null},f.loading.hide())};return se(),ve(()=>[d.value.map(o=>o.selected),a.value.create.name,a.value.create.alias,a.value.create.elementos,a.value.secuence],([o,l,e,n,c])=>{var H,W,G,J,K,X;const A=d.value.filter(g=>g.selected!==null);if(A.length){const g=A[A.length-1],k=S(g.selected);C.value=k}else C.value=((H=d.value[0])==null?void 0:H.options)||[];if(!l||!e){a.value.defaultView=[];return}const I=[];if(c){console.log(a.value.type);let g=null;a.value.type?g=i.value.sections.filter(v=>v.root==0&&v.deep==0)||[]:g=S((W=a.value.val)==null?void 0:W.id);let k=0;g.forEach(v=>{const h=parseInt(v.name.replace(l,"").trim()),Y=parseInt(v.alias.replace(e,"").trim()),Z=Math.max(isNaN(h)?0:h,isNaN(Y)?0:Y);Z>k&&(k=Z)});for(let v=1;v<=(Number(n)||1);v++){const h=k+v;I.push({name:`${l} ${h}`,alias:`${e}${h}`,path:`${((G=a.value.val)==null?void 0:G.path)||""}${(J=a.value.val)!=null&&J.path?"-":""}${e}${h}`})}}else I.push({name:l,alias:e,path:`${((K=a.value.val)==null?void 0:K.path)||""}${(X=a.value.val)!=null&&X.path?"-":""} ${e}`});a.value.defaultView=I},{deep:!0}),(o,l)=>(u(),w(pe,{padding:""},{default:s(()=>[t(T,{class:"my-card"},{default:s(()=>[t(m,null,{default:s(()=>[$.value.length>0?(u(),b("div",be,[t(ee,{class:"col",modelValue:i.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>i.value=e),P],options:$.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(x,{spaced:"",inset:"",vertical:"",dark:""}),(u(!0),b(_,null,U(d.value,(e,n)=>(u(),b("div",{key:n,class:"col"},[B("div",Ve,[t(ee,{class:"col",modelValue:e.selected,"onUpdate:modelValue":[c=>e.selected=c,c=>ne(c,n)],options:e.options,label:`Nivel ${n+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",disable:n==j.value},null,8,["modelValue","onUpdate:modelValue","options","label","disable"]),t(x,{spaced:"",inset:"",vertical:"",dark:""})])]))),128)),B("div",he,[t(V,{icon:"add",flat:"",onClick:ue,disable:!i.value},null,8,["disable"])])])):E("",!0),t(x,{spaced:"",inset:"",vertical:"",dark:""}),t(M,{rows:C.value,columns:F.value.columns},{body:s(e=>[t(L,{props:e},{default:s(()=>[(u(!0),b(_,null,U(e.cols,n=>(u(),w(N,{key:n.name,props:e},{default:s(()=>[y(Q(n.value),1)]),_:2},1032,["props"]))),128)),t(N,{"auto-width":""},{default:s(()=>[t(V,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:n=>re(e.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),t(le,{modelValue:a.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.state=e),persistent:""},{default:s(()=>[t(T,null,{default:s(()=>[t(m,{class:"text-center"},{default:s(()=>[l[8]||(l[8]=y(" NUEVA SECCION EN ALMACEN ")),B("span",we,Q(a.value.val.name.toUpperCase()),1)]),_:1}),t(m,{class:"row"},{default:s(()=>[t(O,{class:"col",modelValue:a.value.create.name,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.create.name=e),type:"text",label:"Name",filled:"",dense:""},null,8,["modelValue"]),t(x,{spaced:"",inset:"",vertical:"",dark:""}),t(O,{class:"col",modelValue:a.value.create.alias,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.create.alias=e),type:"text",label:"Alias",filled:"",dense:""},null,8,["modelValue"]),t(x,{spaced:"",inset:"",vertical:"",dark:""}),a.value.secuence?(u(),w(O,{key:0,class:"col",modelValue:a.value.create.elementos,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.create.elementos=e),type:"Number",label:"Elementos",filled:"",dense:""},null,8,["modelValue"])):E("",!0)]),_:1}),t(m,null,{default:s(()=>[t(ae,{modelValue:a.value.secuence,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.secuence=e),val:!1,label:"No Usar Secuencia"},null,8,["modelValue"]),t(ae,{modelValue:a.value.secuence,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.secuence=e),val:!0,label:"Usar Secuencia"},null,8,["modelValue"])]),_:1}),a.value.create.name&&a.value.create.alias?(u(),w(m,{key:0},{default:s(()=>[t(M,{rows:a.value.defaultView},null,8,["rows"])]),_:1})):E("",!0),t(te,{align:"right"},{default:s(()=>[D(t(V,{flat:"",label:"Cancelar",color:"negative"},null,512),[[oe]]),t(V,{flat:"",label:"Crear",color:"positive",onClick:ie,disable:!a.value.create.name||!a.value.create.alias},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:r.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>r.value.state=e),persistent:""},{default:s(()=>[t(T,null,{default:s(()=>[t(m,{class:"text-center text-bold text-h5"},{default:s(()=>l[9]||(l[9]=[y(" ELIMINAR SECCION ? ")])),_:1}),t(m,{class:"text-center text-bold text-h6"},{default:s(()=>[y(Q(r.value.val.name),1)]),_:1}),t(m,{class:"text-left text-bold"},{default:s(()=>l[10]||(l[10]=[y(" Recuerda que se eliminaran tambien todos los hijos de la seccion ")])),_:1}),t(m,null,{default:s(()=>[t(M,{rows:r.value.val.pivot,columns:F.value.columns},{body:s(e=>[t(L,{props:e},{default:s(()=>[(u(!0),b(_,null,U(e.cols,n=>(u(),w(N,{key:n.name,props:e},{default:s(()=>[y(Q(n.value),1)]),_:2},1032,["props"]))),128)),e.row.pivot.length>0?(u(),w(N,{key:0,"auto-width":""},{default:s(()=>[t(V,{size:"sm",color:"accent",round:"",dense:"",onClick:n=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024)):E("",!0)]),_:2},1032,["props"]),D(t(L,{props:e},{default:s(()=>[t(N,{colspan:"100%"},{default:s(()=>[(u(!0),b(_,null,U(e.row.pivot,(n,c)=>(u(),b("div",{class:"text-left",key:c},Q(n.name),1))),128))]),_:2},1024)]),_:2},1032,["props"]),[[me,e.expand]])]),_:1},8,["rows","columns"])]),_:1}),t(te,{align:"right"},{default:s(()=>[D(t(V,{flat:"",label:"Cancelar"},null,512),[[oe]]),t(V,{flat:"",label:"Eliminar",color:"negative",onClick:de})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Xe as default};
