import{u as U,a as j,aW as L,r as _,c as M,o as c,g as C,d as m,w as u,h as f,e as i,a3 as I,Q as p,a1 as G,f as l,a0 as v,al as W,a2 as H}from"./index.f154296f.js";import{Q as J}from"./QToolbarTitle.073e306d.js";import{Q as K}from"./QToolbar.b986c5ac.js";import{Q as X,b as y}from"./QList.d51622ed.js";import{Q as Y}from"./QTable.6467011c.js";import{Q as V}from"./QCard.816dcfaf.js";import{Q as Z}from"./QFooter.adfd63b3.js";import{Q as ee}from"./QPage.cb0e752e.js";import{Q as w}from"./QCardSection.32a39c07.js";import{Q as te}from"./QSelect.0eb8d7b3.js";import{Q as S}from"./QInput.958c0349.js";import{Q as oe}from"./QSpace.1509549c.js";import{Q as ae}from"./QCardActions.15bfa98e.js";import"./QDrawer.94e9744c.js";import"./QExpansionItem.7aa4ddcb.js";import"./ClosePopup.e630bb28.js";import"./axios.4219d86e.js";import{u as le}from"./use-quasar.cd130b71.js";import{P as ie}from"./ProductsAutocomplete.e91cc84e.js";import{I as se}from"./invoices.19eb39cc.js";import"./dayjs.min.cbcf888d.js";import"./jspdf.plugin.autotable.8cb61bde.js";import{$sktRestock as N}from"./socket.168d2ba4.js";import{i as g}from"./invoicesApi.b62385be.js";import"./QForm.cbb25e67.js";import"./QBadge.82ad98f6.js";import"./Restock.a0467988.js";import"./QBtnGroup.f600b3c2.js";import"./use-key-composition.d18df139.js";import"./QLinearProgress.63ff1b0b.js";import"./QCheckbox.3a8f695c.js";import"./use-checkbox.f22847e0.js";import"./QResizeObserver.38873fb5.js";import"./QScrollObserver.8d18cd57.js";/* empty css                                                                         */import"./browser.c61f550a.js";import"./JsBarcode.cb858474.js";import"./_commonjsHelpers.88e99c8f.js";import"./QRadio.b9771878.js";import"./QTd.c23c4067.js";import"./QPopupEdit.fa7253fb.js";import"./QTr.42676563.js";import"./QLayout.5eef1deb.js";import"./exceljs.min.9e24d01d.js";/* empty css                                                       */const ne={class:"col"},de={class:"col"},re={class:"col text-right"},ue={class:"row q-ml-sm"},ve={class:"row justify-between"},ce={class:"text-left"},pe={class:"text--3"},me={class:"text-h6"},fe={class:"text-right"},_e={class:"text-bold"},ge={class:"text--2"},he={class:"text-center"},ke={class:"text-h6"},ye={class:"text-h6"},be={class:"text--2"},xe={class:"row items-start justify-between"},we={class:"text-center col text-primary"},Qe={class:"text-center col"},Ce={class:"text-center col"},De={class:"text-center col"},Pe={class:"text-bold"},yt={__name:"viewInvoice",setup(Ie){const q=U(),s=le(),h=j(),b=L(),d=_(null),r=_([]),n=_({val:{id:1,label:"Pieza"},opts:[{id:1,label:"Pieza"},{id:2,label:"Docena"},{id:3,label:"Caja"}]}),e=_({state:!1,val:null,edit:!1}),D=_({toDelivered:1,_supply_by:1,units:1,cost:0,total:0,comments:"",stock:0,ipack:0}),P=_({pagination:{rowsPerPage:0},columns:[{name:"code",label:"CODIGO",field:o=>o.code,align:"left"},{name:"description",label:"DESCRIPCION",field:o=>o.description,align:"left"},{name:"amount_delivered",label:"CANTIDAD",field:o=>o.pivot.units,align:"center"}]}),k=M(()=>{var o,t;return((o=n.value.val)==null?void 0:o.id)==3?e.value.val.pivot.toDelivered*e.value.val.pivot.ipack:((t=n.value.val)==null?void 0:t.id)==2?e.value.val.pivot.toDelivered*12:e.value.val.pivot.toDelivered}),B=async()=>{s.loading.show({message:"Obeteniendo Datos"});const o=await g.getInvoice(b.params.inv);o.fail?o.fail.status==401?(h.push("/distribute/invoice"),s.notify({message:"La factura ya se realizo",type:"negative",position:"center"}),s.loading.hide()):(o.fail.status=404)?(h.push("/distribute/invoice"),s.notify({message:"No existe la Factura",type:"negative",position:"center"}),s.loading.hide()):console.log(o):(console.log(o),d.value=o,r.value=o.products,s.loading.hide())},F=o=>{console.log(o);let t=r.value.findIndex(a=>a.id==o.id);console.log(t),t>=0?(e.value.val=r.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(a=>a.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=o,e.value.val.pivot=D.value,e.value.val.pivot.ipack=o.pieces,e.value.state=!0)},A=o=>{console.log(o);let t=r.value.findIndex(a=>a.id==o.id);console.log(t),t>=0?(e.value.val=r.value[t],console.log(e.value.val),n.value.val=n.value.opts.find(a=>a.id==e.value.val.pivot._supply_by),console.log(n.value),e.value.state=!0,e.value.edit=!0):(e.value.val=o,e.value.val.pivot=D.value,e.value.val.pivot.ipack=o.pieces,e.value.state=!0)},T=async()=>{s.loading.show({message:"Creando Factura"}),console.log(d.value);const o=await g.changestate(d.value);o.fail?console.log(o):(console.log(o),N.emit("order_refresh",{order:o.requisitiion}),N.emit("orderpartition_refresh",{order:o.partition}),se.invoiceFormat(o.partition),$(o.partition))},$=async o=>{const t=await g.addInvoiceFS(o);t.fail?t.fail.status==503?(s.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide()):console.log(t):(s.notify({message:`Salida Creada ${t}`,type:"positive",position:"bottom"}),h.push("/distribute/invoice"),s.loading.hide())},x=()=>{e.value={state:!1,val:null,edit:!1}},z=async()=>{s.loading.show({message:"Insertando Producto"});let o={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(a=>a.id==q.session.store.id_viz).pivot.gen,amount:1,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};const t=await g.addProduct(o);t.fail?console.log(t):(s.loading.hide(),r.value.push(t)),x()},E=async()=>{s.loading.show({message:"Eliminando Producto"}),console.log(e.value);let o={_requisition:b.params.inv,_product:e.value.val.id};console.log(o);const t=await g.deleteProduct(o);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let a=r.value.findIndex(Q=>Q.id==o._product);r.value.splice(a,1)}x()},O=async()=>{s.loading.show({message:"Editando Producto"}),console.log(e.value);let o={_requisition:b.params.inv,_product:e.value.val.id,units:k.value,comments:"",stock:e.value.val.stocks.find(a=>a.id==1).pivot.gen,amount:0,cost:e.value.val.cost,total:e.value.val.cost*k.value,_supply_by:n.value.val.id,toDelivered:e.value.val.pivot.toDelivered,checkout:1,ipack:e.value.val.pivot.ipack,_suplier:d.value.partition[0]._suplier,_suplier_id:d.value.partition[0]._suplier_id,_partition:d.value.partition[0].id};console.log(o);const t=await g.editProduct(o);if(t.fail)console.log(t);else{console.log(t),s.loading.hide();let a=r.value.findIndex(Q=>Q.id==o.id);console.log(e.value.val),r.value.splice(a,1,t)}x()},R=(o,t)=>{console.log(t),e.value.val=t,n.value.val=n.value.opts.find(a=>a.id==t.pivot._supply_by),e.value.state=!0,e.value.edit=!0};return B(),(o,t)=>(c(),C(I,null,[d.value?(c(),m(ee,{key:0,padding:""},{default:u(()=>[i(K,{class:"bg-primary text-white"},{default:u(()=>[i(p,{flat:"",round:"",dense:"",icon:"arrow_back ",onClick:t[0]||(t[0]=a=>G(h).push("/distribute/invoice"))}),i(J,{class:"row"},{default:u(()=>[l("div",ne,"Origen : "+v(d.value.to.name),1),l("div",de,"Destino : "+v(d.value.from.name),1),l("div",re,v(d.value.created_by.nick),1)]),_:1}),i(p,{flat:"",round:"",dense:"",icon:"download",class:"q-mr-xs"}),i(p,{flat:"",round:"",dense:"",icon:"upload"})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),r.value.length>0?(c(),m(Y,{key:0,rows:r.value,"hide-bottom":"",columns:P.value.columns,pagination:P.value.pagination,onRowClick:R},null,8,["rows","columns","pagination"])):f("",!0),i(Z,{reveal:"",elevated:"",bordered:""},{default:u(()=>[i(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",ue,[i(V,{class:"col"},{default:u(()=>[i(ie,{checkState:!1,onInput:F,with_prices_Invoice:"",with_stock:"",onAgregar:A,with_locations:""})]),_:1}),i(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",null,[r.value.length>0?(c(),m(p,{key:0,flat:"",icon:"send",onClick:T})):f("",!0)])]),i(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1})):f("",!0),i(X,{modelValue:e.value.state,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.state=a),position:"bottom"},{default:u(()=>[e.value.val?(c(),m(V,{key:0},{default:u(()=>[i(w,{class:""},{default:u(()=>[l("div",ve,[l("div",ce,[l("div",pe,"ID: "+v(e.value.val.id),1),l("div",me,v(e.value.val.code),1)]),l("div",fe,[l("div",_e,v(e.value.val.name),1),l("div",ge,v(e.value.val.barcode),1)])])]),_:1}),i(y),i(w,null,{default:u(()=>[W(v(e.value.val.description),1)]),_:1}),i(w,{class:"row justify-around items-center"},{default:u(()=>[l("div",he,[l("div",ke,v(e.value.val.pieces),1),t[5]||(t[5]=l("div",{class:"text--2"},"PxC",-1))]),(c(!0),C(I,null,H(e.value.val.stocks,a=>(c(),C("div",{key:a.id,class:"text-center"},[l("div",ye,v(a.pivot.gen),1),l("div",be,v(a.alias),1)]))),128))]),_:1}),i(w,null,{default:u(()=>[l("div",xe,[l("div",we,[i(te,{modelValue:n.value.val,"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.val=a),options:n.value.opts,label:"Unidad Medida",filled:"",dense:""},null,8,["modelValue","options"])]),l("div",Qe,[t[6]||(t[6]=l("div",null,"Conteo",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.toDelivered,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.val.pivot.toDelivered=a),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter"},null,8,["modelValue"])]),l("div",Ce,[t[7]||(t[7]=l("div",null,"PxC",-1)),i(S,{dense:"",borderless:"",modelValue:e.value.val.pivot.ipack,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.val.pivot.ipack=a),type:"number","input-class":"text-h6 text-center",disable:n.value.val.id!=3},null,8,["modelValue","disable"])]),l("div",De,[t[8]||(t[8]=l("div",null,"Piezas",-1)),l("div",Pe,v(k.value),1)])])]),_:1}),i(ae,null,{default:u(()=>[i(p,{flat:"",icon:"close",onClick:x}),i(oe),e.value.edit?f("",!0):(c(),m(p,{key:0,flat:"",icon:"add",color:"positive",onClick:z})),e.value.edit?(c(),m(p,{key:1,flat:"",icon:"delete",color:"negative",onClick:E})):f("",!0),e.value.edit?(c(),m(p,{key:2,flat:"",icon:"edit",color:"warning",onClick:O})):f("",!0)]),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"])],64))}};export{yt as default};
