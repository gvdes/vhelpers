import{u as $,r as _,c as M,o as b,d as D,w as n,g as l,W as r,X as O,e as s,ad as B,Q as h,f as T,aa as z,ab as g,i as F,_ as P,Z as N,$ as R,j as S,k as E,a0 as j,h as L,Y as H}from"./index.52a3c292.js";import{Q as J}from"./QToolbarTitle.164de655.js";import{Q as W}from"./QDate.f9911861.js";import{q as X,d as Z}from"./QSelect.c9c7c333.js";import{Q as G}from"./QToolbar.a8883ef1.js";import{Q as Y}from"./QTable.73570121.js";import{Q as K}from"./QExpansionItem.e2dc76cf.js";import{Q as ee}from"./QList.cf079002.js";import{Q as te}from"./QPage.a8a9aaec.js";import"./QDrawer.f2292652.js";import{C as le}from"./ClosePopup.db2b9d28.js";import"./axios.172360c8.js";import{u as U}from"./use-quasar.c1be6315.js";import{b as y}from"./billingApi.c32a85e5.js";import{u as I}from"./BillingStore.5d990404.js";import"./jspdf.plugin.autotable.bb7ae945.js";import"./exceljs.min.9e24d01d.js";import{r as ae}from"./reports.428884ca.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as V}from"./dayjs.min.cbcf888d.js";import"./use-render-cache.3aae9b27.js";import"./date.6f09c2c4.js";import"./QLinearProgress.4a89e476.js";import"./QResizeObserver.81625c6a.js";import"./QScrollObserver.c4256086.js";import"./_commonjsHelpers.88e99c8f.js";const se={class:"row justify-between items-center q-mb-lg"},oe={class:"text-caption text-grey-6"},ie={class:"row q-col-gutter-md q-mb-lg"},ne={class:"col-12 col-md-4"},de={class:"text-h6 text-weight-medium"},re={class:"col-12 col-md-4"},ce={class:"text-h6 text-weight-medium"},ue={class:"col-12 col-md-4"},me={class:"text-h6 text-weight-medium"},fe={class:"row q-col-gutter-md"},ve={class:"col-12 col-sm-6"},pe={class:"text-body1"},ge={class:"col-12 col-sm-6"},be={class:"text-body1"},xe={class:"col-12 col-sm-6"},_e={class:"text-body1"},ye={class:"col-12 col-sm-6"},we={class:"row q-col-gutter-md"},he={class:"col"},Se={class:"text-body1"},Ce={class:"col"},ke={class:"text-body1"},De={class:"text-caption text-grey-7"},Ae={class:"text-body1"},Qe={class:"text-caption"},Te={class:"col-12"},Fe={class:"text-body1"},Ve={__name:"viewBilling",props:{id:{default:null,type:Number}},emits:["nextState"],setup(q,{emit:C}){$(),I();const x=U(),a=_(null),p=[{name:"ARTLFA",label:"C\xF3digo",field:"ARTLFA",align:"left"},{name:"DESLFA",label:"Descripci\xF3n",field:"DESLFA",align:"left"},{name:"CANLFA",label:"Cantidad",field:"CANLFA",align:"center"},{name:"PRELFA",label:"Precio",field:"PRELFA",align:"right"},{name:"TOTLFA",label:"Total",field:"TOTLFA",align:"right"},{name:"UNIDAD",label:"UNIDAD",field:i=>i.sat.unidad,align:"right"},{name:"CLAVE",label:"CLAVE",field:i=>i.sat.clave,align:"right"}],u=M(()=>{try{const i=JSON.parse(a.value.address);return`${i.calle} ${i.numExt} ${i.numInt?"Int. "+i.numInt:""}, ${i.colonia}, ${i.ciudad}, ${i.municipio}, CP ${i.cp}`}catch{return""}}),m=q,w=C,f=async()=>{x.loading.show({message:"Obteniendo Datos"});let i={id:m.id};const t=await y.getBilling(i);t.fail?console.log(t):(console.log(t),x.loading.hide(),a.value=t)},k=i=>{let t=null;switch(i){case"EFE":t=1;break;case"TDD":t=28;break;case"TDC":t=4;break;case"TRA":t=3;break;case"CHE":t=11;break;default:t=1;break}return t},A=()=>{if(a.value._state==1){if(!a.value.nclient)return x.notify({title:"Cliente sin registro",type:"negative",position:"center",message:"El cliente no cuenta con n\xFAmero de registro"});const i=a.value.ticketSuc.products.filter(t=>{var e,o;return!((e=t.sat)!=null&&e.clave)||!((o=t.sat)!=null&&o.unidad)});if(i.length>0){const t=i.map(e=>`\u2022 ${e.DESLFA} (${e.ARTLFA})`).join("<br>");return x.notify({message:`Los siguientes productos no tienen clave o unidad SAT:<br><br>${t}`,html:!0,type:"negative",position:"center"})}a.value.payments.forEach(t=>{t.sat=k(t.payment)}),w("nextState",a.value)}else a.value._state==2?w("nextState",a.value):a.value._state==3||(a.value._state==4?console.log("este ya se acabo"):a.value._state==5&&w("nextState"))};return f(),(i,t)=>a.value?(b(),D(h,{key:0,class:"q-pa-lg"},{default:n(()=>[l("div",se,[l("div",null,[t[0]||(t[0]=l("div",{class:"text-h5 text-weight-bold"},"Factura / Solicitud",-1)),l("div",oe," Creado el: "+r(O(V)(a.value.created_at).format("DD MMM YYYY - HH:mm")),1)]),s(X,{size:"md",color:"primary","text-color":"white"},{default:n(()=>[B(r(a.value.status.name),1)]),_:1})]),l("div",ie,[l("div",ne,[s(h,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[t[1]||(t[1]=l("div",{class:"text-grey-7 text-caption"},"Ticket",-1)),l("div",de,r(a.value.ticket),1)]),_:1})]),l("div",re,[s(h,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[t[2]||(t[2]=l("div",{class:"text-grey-7 text-caption"},"Total",-1)),l("div",ce,"$ "+r(a.value.total),1)]),_:1})]),l("div",ue,[s(h,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[t[3]||(t[3]=l("div",{class:"text-grey-7 text-caption"},"Sucursal",-1)),l("div",me,r(a.value.store.name),1)]),_:1})])]),s(T,null,{default:n(()=>[t[11]||(t[11]=l("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos del Cliente",-1)),l("div",fe,[l("div",ve,[t[4]||(t[4]=l("div",{class:"text-caption text-grey-7"},"Nombre",-1)),l("div",pe,r(a.value.name),1)]),l("div",ge,[t[5]||(t[5]=l("div",{class:"text-caption text-grey-7"},"Email",-1)),l("div",be,r(a.value.email),1)]),l("div",xe,[t[6]||(t[6]=l("div",{class:"text-caption text-grey-7"},"Tel\xE9fono",-1)),l("div",_e,r(a.value.celphone),1)]),l("div",ye,[t[7]||(t[7]=l("div",{class:"text-caption text-grey-7"},"Numero Registro",-1)),l("div",{class:z(["text-body1",a.value.nclient?"":"text-red"])},r(a.value.nclient?a.value.nclient:"Sin Registro"),3)])]),s(g),t[12]||(t[12]=l("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Datos Fiscales",-1)),l("div",we,[l("div",he,[t[8]||(t[8]=l("div",{class:"text-caption text-grey-7"},"RFC",-1)),l("div",Se,r(a.value.rfc),1)]),l("div",Ce,[t[9]||(t[9]=l("div",{class:"text-caption text-grey-7"},"Raz\xF3n Social",-1)),l("div",ke,r(a.value.razon_social),1)]),(b(!0),F(P,null,N(a.value.payments,e=>(b(),F("div",{key:e.id,class:"col"},[l("div",De,r(e.payment),1),l("div",Ae,"$ "+r(e.import),1),l("div",Qe,r(k(e.payment)),1)]))),128)),l("div",Te,[t[10]||(t[10]=l("div",{class:"text-caption text-grey-7"},"Direcci\xF3n",-1)),l("div",Fe,r(u.value),1)])])]),_:1}),s(T,null,{default:n(()=>[t[13]||(t[13]=l("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Productos",-1)),s(Y,{flat:"",bordered:"",dense:"",rows:a.value.ticketSuc.products,columns:p,"row-key":"ARTLFA",class:"q-mb-xl"},null,8,["rows"])]),_:1}),s(R,{align:"right"},{default:n(()=>[a.value._state!=4?(b(),D(S,{key:0,color:"primary",label:"Continuar",onClick:A})):E("",!0),j(s(S,{color:"negative",flat:"",label:"Cancelar"},null,512),[[le]])]),_:1})]),_:1})):E("",!0)}},qe={class:"row full-width items-center justify-between q-py-sm"},it={__name:"Billers",setup(q){const C=$(),x=I(),a=U();x.setShowToolbar(!0);const p=_({from:null,to:null}),u=_({state:!1,data:null}),m=_([]),w=_({opts:[{id:1,label:"Solicitado",class:"bg-red-10 "},{id:2,label:"Proceso",class:"bg-yellow-10 "},{id:4,label:"Creado",class:"bg-green-10"}]}),f=_({columns:[{name:"date",label:"Creado",field:e=>V(e.creeated_at).format("YYYY-MM-DD HH:mm:ss"),align:"left"},{name:"id",label:"Solicitud",field:e=>e.id,align:"left"},{name:"store",label:"Sucursal",field:e=>e.store.name,align:"left"},{name:"ticket",label:"Ticket",field:e=>e.ticket,align:"left"},{name:"contact",label:"Contacto",field:e=>e.name,align:"left"},{name:"email",label:"Correo",field:e=>e.email,align:"left"},{name:"celphone",label:"Telefono",field:e=>e.celphone,align:"left"},{name:"razonSocial",label:"Razon Social",field:e=>e.razon_social,align:"left"},{name:"Status",label:"Estado",field:e=>e.status.name,align:"left"},{name:"Usuario",label:"Usuario",field:e=>e.logs.find(o=>o._state==e._state).user.nick,align:"left"}],filter:null,paginate:{rowsPerPage:15}}),k=async()=>{a.loading.show({message:"Obteniendo Datos"});let e=V(new Date).format("YYYY/MM/DD");p.value={from:e,to:e};const o=await y.getBillings({date:p.value});o.fail?console.log(o):(console.log(o),a.loading.hide(),m.value=o)},A=async()=>{a.loading.show({message:"Obteniendo Datos"});const e=await y.getBillings({date:p.value});e.fail?console.log(e):(console.log(e),a.loading.hide(),m.value=e)},i=async(e,o,d)=>{u.value.folio=o.id,u.value.state=!0},t=async e=>{if(console.log(e),e._state==1){a.loading.show({message:"Cambiando Status"});const o=await y.getFolio(e);if(o.fail)console.log(o);else{e.claveDoc=o,e.mtdpag="PUE",console.log(e),await ae.importAspel(e);let d={billing:e,user:C.session.credentials.id};const c=await y.nextState(d);if(c.fail)console.log(c);else{a.loading.hide(),console.log(c);let v=m.value.findIndex(Q=>Q.id==c.id);v>=0&&(m.value.splice(v,1,c),u.value={state:!1,data:null})}}}else e._state==2&&a.dialog({title:"Folio de factura",message:"Proporciona el numero de folio",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(async o=>{a.loading.show({message:"Cambiando Status"}),e.invoice=o;let d={billing:e,user:C.session.credentials.id};const c=await y.finishState(d);if(c.fail)console.log(c);else{a.loading.hide(),console.log(c);let v=m.value.findIndex(Q=>Q.id==c.id);v>=0&&(m.value.splice(v,1,c),u.value={state:!1,data:null})}}).onCancel(()=>{u.value={state:!1,data:null},a.notify({message:"Se tiene que poner el numero de factura",type:"negative",position:"center"})}).onDismiss(()=>{})};return k(),(e,o)=>(b(),D(te,{padding:""},{default:n(()=>[s(G,null,{default:n(()=>[s(S,{flat:"",round:"",dense:"",icon:"receipt_long"}),s(J,null,{default:n(()=>o[4]||(o[4]=[B(" Solicitudes De Facturas ")])),_:1}),s(S,{flat:"",round:"",dense:"",icon:"event"},{default:n(()=>[s(Z,null,{default:n(()=>[s(h,{class:"my-card"},{default:n(()=>[s(T,null,{default:n(()=>[l("div",null,[o[5]||(o[5]=l("div",{class:"q-pb-sm text-center"},null,-1)),s(W,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=d=>p.value=d),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),s(R,{vertical:"",align:"center"},{default:n(()=>[s(S,{flat:"",label:"Obtener",color:"positive",onClick:A})]),_:1})]),_:1})]),_:1})]),_:1}),s(g,{spaced:"",inset:"",vertical:"",dark:""}),s(L,{modelValue:f.value.filter,"onUpdate:modelValue":o[1]||(o[1]=d=>f.value.filter=d),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"]),s(g,{spaced:"",inset:"",vertical:"",dark:""}),s(L,{modelValue:f.value.filter,"onUpdate:modelValue":o[2]||(o[2]=d=>f.value.filter=d),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])]),_:1}),s(g,{spaced:"",inset:"",vertical:"",dark:""}),(b(!0),F(P,null,N(w.value.opts,(d,c)=>(b(),D(ee,{bordered:"",key:c},{default:n(()=>[s(g,{spaced:"",inset:"",vertical:"",dark:""}),s(K,{"expand-separator":"","default-opened":"","header-class":d.class},{header:n(()=>[l("div",qe,[l("div",null,r(d.label.toUpperCase())+" - "+r(m.value.filter(v=>v._state==d.id).length),1)])]),default:n(()=>[s(g),s(Y,{rows:m.value.filter(v=>v._state==d.id),columns:f.value.columns,pagination:f.value.paginate,filter:f.value.filter,onRowClick:i},null,8,["rows","columns","pagination","filter"])]),_:2},1032,["header-class"]),s(g,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024))),128)),s(H,{modelValue:u.value.state,"onUpdate:modelValue":o[3]||(o[3]=d=>u.value.state=d),"full-width":""},{default:n(()=>[s(Ve,{id:u.value.folio,onNextState:t},null,8,["id"])]),_:1},8,["modelValue"])]),_:1}))}};export{it as default};
