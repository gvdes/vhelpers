import{c as v,i as H,D as Y,j as g,Q as m,X as Z,bc as W,S as w,L as K,t as X,r as b,x as ee,k as le,aH as ae,a as te,u as oe,o as ne,d as ie,w as o,e as a,f as k,a0 as D,a4 as q,ak as F,a1 as P}from"./index.36b6f3f3.js";import{Q as j}from"./QInput.5ac6a47a.js";import{Q as se}from"./QTable.35c88d33.js";import{Q as h}from"./QCardSection.2a5053ab.js";import{Q as R}from"./QForm.453f3ede.js";import{Q as B}from"./QCardActions.66eaa095.js";import{Q as A}from"./QCard.c09bae66.js";import{f as re,i as de,l as ue,Q as O}from"./QList.9744d304.js";import{Q as ce}from"./QSelect.b2e0eed3.js";import{l as fe}from"./use-key-composition.61edd40b.js";import{Q as me}from"./QPageSticky.0f0fcb0f.js";import{Q as ve}from"./QPage.48c14d2e.js";import{C as I}from"./ClosePopup.0f2a9450.js";import"./dayjs.min.cbcf888d.js";import"./axios.01f1ad8b.js";import{o as E}from"./orderApi.9fe6112b.js";import{u as pe}from"./OrderStore.7102468b.js";import{u as be}from"./use-quasar.21781a3f.js";import"./QExpansionItem.e32c1b0b.js";import"./QDrawer.7b8d4b06.js";/* empty css                                                                         */import{$sktOrders as M}from"./socket.05630e21.js";import"./QLinearProgress.7e0c973d.js";import"./QCheckbox.da1fe95a.js";import"./use-checkbox.3d699876.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.d3e712c7.js";import"./QScrollObserver.83400ae8.js";const ge=["top","right","bottom","left"],N={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:l=>ge.includes(l)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function G(l,s){return{formClass:v(()=>`q-fab--form-${l.square===!0?"square":"rounded"}`),stacked:v(()=>l.externalLabel===!1&&["top","bottom"].includes(l.labelPosition)),labelProps:v(()=>{if(l.externalLabel===!0){const r=l.hideLabel===null?s.value===!1:l.hideLabel;return{action:"push",data:{class:[l.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${l.labelPosition}`+(r===!0?" q-fab__label--external-hidden":"")],style:l.labelStyle}}}return{action:["left","top"].includes(l.labelPosition)?"unshift":"push",data:{class:[l.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${l.labelPosition}`+(l.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:l.labelStyle}}})}}const J={start:"self-end",center:"self-center",end:"self-start"},_e=Object.keys(J);var z=H({name:"QFabAction",props:{...N,icon:{type:String,default:""},anchor:{type:String,validator:l=>_e.includes(l)},to:[String,Object],replace:Boolean},emits:["click"],setup(l,{slots:s,emit:r}){const n=Y(W,()=>({showing:{value:!0},onChildClick:Z})),{formClass:y,labelProps:x}=G(l,n.showing),p=v(()=>{const c=J[l.anchor];return y.value+(c!==void 0?` ${c}`:"")}),d=v(()=>l.disable===!0||n.showing.value!==!0);function u(c){n.onChildClick(c),r("click",c)}function _(){const c=[];return s.icon!==void 0?c.push(s.icon()):l.icon!==""&&c.push(g(w,{name:l.icon})),(l.label!==""||s.label!==void 0)&&c[x.value.action](g("div",x.value.data,s.label!==void 0?s.label():[l.label])),K(s.default,c)}const C=X();return Object.assign(C.proxy,{click:u}),()=>g(m,{class:p.value,...l,noWrap:!0,stack:l.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:d.value,onClick:u},_)}});const ye=["up","right","down","left"],Ce=["left","center","right"];var he=H({name:"QFab",props:{...N,...re,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{...N.hideLabel,default:null},direction:{type:String,default:"right",validator:l=>ye.includes(l)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:l=>Ce.includes(l)}},emits:de,setup(l,{slots:s}){const r=b(null),n=b(l.modelValue===!0),y=fe(),{proxy:{$q:x}}=X(),{formClass:p,labelProps:d}=G(l,n),u=v(()=>l.persistent!==!0),{hide:_,toggle:C}=ue({showing:n,hideOnRouteChange:u}),c=v(()=>({opened:n.value})),L=v(()=>`q-fab z-fab row inline justify-center q-fab--align-${l.verticalActionsAlign} ${p.value}`+(n.value===!0?" q-fab--opened":" q-fab--closed")),T=v(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${l.direction} q-fab__actions--${n.value===!0?"opened":"closed"}`),V=v(()=>{const f={id:y.value,role:"menu"};return n.value!==!0&&(f["aria-hidden"]="true"),f}),S=v(()=>`q-fab__icon-holder  q-fab__icon-holder--${n.value===!0?"opened":"closed"}`);function Q(f,$){const t=s[f],e=`q-fab__${f} absolute-full`;return t===void 0?g(w,{class:e,name:l[$]||x.iconSet.fab[$]}):g("div",{class:e},t(c.value))}function U(){const f=[];return l.hideIcon!==!0&&f.push(g("div",{class:S.value},[Q("icon","icon"),Q("active-icon","activeIcon")])),(l.label!==""||s.label!==void 0)&&f[d.value.action](g("div",d.value.data,s.label!==void 0?s.label(c.value):[l.label])),K(s.tooltip,f)}return ee(W,{showing:n,onChildClick(f){_(f),r.value!==null&&r.value.$el.focus()}}),()=>g("div",{class:L.value},[g(m,{ref:r,class:p.value,...l,noWrap:!0,stack:l.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":n.value===!0?"true":"false","aria-haspopup":"true","aria-controls":y.value,onClick:C},U),g("div",{class:T.value,...V.value},le(s.default))])}});const xe={class:"text-caption text-grey"},Se={class:"text-bold"},ke={class:"text-bold"},Ze={__name:"Preorders",setup(l){ae();const s=te(),r=pe();r.setTitle("PEDIDOS"),r.setshowLyt(!0);const n=be(),y=oe(),x=b({rowsPerPage:20}),p=b({state:!1,val:null,opts:[]}),d=b({state:!1,val:null}),u=b({state:!1,order:{_created_by:y.session.credentials.staff.id_va,_workpoint:y.session.store.id_viz,name:null,_anex:null}}),_=b({state:!0,val:null,opts:[],filter:[]}),C=b({state:!1,val:null}),c=b({columns:[{name:"id",label:"FOLIO",field:t=>t.id,align:"left",sortable:!0},{name:"client",label:"CLIENTE",field:t=>t.name,align:"center",sortable:!0},{name:"status",label:"ESTADO",field:t=>{var e;return(e=t.status)==null?void 0:e.name},align:"center",classes:t=>`text-${L.value[t.status.id-1]}`,sortable:!0}],filter:null}),L=b(["grey-6","red-5","deep-orange-10","blue-4","blue-10","teal-4","teal-10","green-5","green-10","light-green-10"]),T=v(()=>r.orders.filter(t=>t.created_by.id==y.session.credentials.staff.id_va)),V=async()=>{n.loading.show({message:"Creando Pedido"}),console.log(u.value.order);const t=await E.create(u.value.order);t.fail?console.log(t):(M.emit("order_add",{order:t,user:r.socket_user.profile}),r.addOrUpdate({order:t}),n.notify({message:`El Pedido ${t.id} se creo`,type:"positive",position:"center"}),n.loading.hide(),s.push(`/preorders/pedidos/${t.id}`))},S=async()=>{n.loading.show({message:"Creando Pedido"}),console.log(u.value);const t=await E.create(u.value.order);console.log(t),t.fail?console.log(t):(M.emit("order_add",{order:t,user:r.socket_user.profile}),r.addOrUpdate({order:t}),n.notify({message:`El Pedido ${t.id} se creo`,type:"positive",position:"center"}),n.loading.hide(),s.push(`/preorders/pedidos/${t.id}`))},Q=(t,e)=>{e._status==1?s.push(`/preorders/pedidos/${e.id}`):(d.value.state=!0,d.value.val=e)},U=async()=>{n.loading.show({message:"Reimprimiendo"});let t={_order:d.value.val.id,_printer:r.printers.val.id};const e=await E.reimpresionClientTicket(t);e.fail?console.log(e):(p.value.state=!1,d.value.state=!1,d.value.val=null,n.loading.hide())},f=()=>{u.value.order._anex=d.value.val.id,d.value.state=!1,d.value.val=null,S()},$=()=>{s.push(`/preorders/pedidos/${d.value.val.id}`)};return(t,e)=>(ne(),ie(ve,{padding:""},{default:o(()=>[a(se,{rows:T.value,columns:c.value.columns,filter:c.value.filter,onRowClick:Q,pagination:x.value},{"top-right":o(()=>[a(j,{borderless:"",dense:"",debounce:"300",modelValue:c.value.filter,"onUpdate:modelValue":e[0]||(e[0]=i=>c.value.filter=i),placeholder:"Buscar"},{append:o(()=>[a(w,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter","pagination"]),a(O,{modelValue:u.value.state,"onUpdate:modelValue":e[3]||(e[3]=i=>u.value.state=i),persistent:""},{default:o(()=>[a(A,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white"},{default:o(()=>[a(w,{name:"list"}),e[12]||(e[12]=k("span",{class:"q-ml-sm"},"Nevo Pedido",-1))]),_:1}),a(h,null,{default:o(()=>[k("div",xe,D(_.value.state?"Escribe Cliente":""),1),a(R,{onSubmit:V},{default:o(()=>[a(j,{modelValue:u.value.order.name,"onUpdate:modelValue":e[2]||(e[2]=i=>u.value.order.name=i),type:_.value.state?"text":"number",label:"Cliente"},{prepend:o(()=>[a(m,{color:"primary",icon:_.value.state?"person_add_disabled":"person_add",title:"client",flat:"",onClick:e[1]||(e[1]=i=>_.value.state=!_.value.state),disable:""},null,8,["icon"])]),_:1},8,["modelValue","type"])]),_:1})]),_:1}),a(B,{align:"right"},{default:o(()=>[q(a(m,{flat:"",title:"Cancelar",color:"negative",icon:"close"},null,512),[[I]]),a(m,{flat:"",color:"positive",icon:"check",onClick:V})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:C.value.state,"onUpdate:modelValue":e[5]||(e[5]=i=>C.value.state=i),persistent:""},{default:o(()=>[a(A,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white"},{default:o(()=>[a(w,{name:"post_add"}),e[13]||(e[13]=k("span",{class:"q-ml-sm"},"Nuevo Anexo",-1))]),_:1}),a(h,null,{default:o(()=>[a(R,{onSubmit:S},{default:o(()=>[a(j,{modelValue:u.value.order._anex,"onUpdate:modelValue":e[4]||(e[4]=i=>u.value.order._anex=i),type:"number",label:"Pedido"},null,8,["modelValue"])]),_:1})]),_:1}),a(B,{align:"right"},{default:o(()=>[q(a(m,{flat:"",title:"Cancelar",color:"negative",icon:"close"},null,512),[[I]]),a(m,{flat:"",color:"positive",icon:"check",onClick:S})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:d.value.state,"onUpdate:modelValue":e[7]||(e[7]=i=>d.value.state=i),persistent:""},{default:o(()=>[a(A,null,{default:o(()=>[a(h,{class:"text-h5"},{default:o(()=>[e[14]||(e[14]=F(" Cliente : ")),k("span",Se,D(d.value.val.name),1)]),_:1}),a(h,{class:"text-h6"},{default:o(()=>[e[15]||(e[15]=F(" Pedido : ")),k("span",ke,D(d.value.val.id),1)]),_:1}),a(B,{align:"right"},{default:o(()=>[q(a(m,{flat:"",icon:"close",color:"negative"},null,512),[[I]]),a(m,{flat:"",icon:"print",color:"positive",onClick:e[6]||(e[6]=i=>p.value.state=!p.value.state)}),a(m,{flat:"",icon:"send",color:"primary",onClick:$}),a(m,{flat:"",label:"Anexo",color:"primary",onClick:f})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:p.value.state,"onUpdate:modelValue":e[9]||(e[9]=i=>p.value.state=i),persistent:""},{default:o(()=>[a(A,null,{default:o(()=>[a(h,{class:"row items-center bg-primary text-white text-h6"},{default:o(()=>e[16]||(e[16]=[F(" Selecciona Impresora ")])),_:1}),a(h,{class:""},{default:o(()=>[a(ce,{modelValue:P(r).printers.val,"onUpdate:modelValue":e[8]||(e[8]=i=>P(r).printers.val=i),options:P(r).printers.opts.filter(i=>i._type==1),label:"Impresoras","option-label":"name",filled:""},null,8,["modelValue","options"])]),_:1}),a(B,{align:"right"},{default:o(()=>[q(a(m,{flat:"",label:"Cancelar",color:"primary"},null,512),[[I]]),a(m,{flat:"",label:"Imprimir",color:"primary",disabled:!P(r).printers.val,onClick:U},null,8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(me,{position:"bottom-right",offset:[20,20]},{default:o(()=>[a(he,{color:"primary",icon:"add",direction:"up"},{default:o(()=>[a(z,{color:"primary",onClick:e[10]||(e[10]=i=>u.value.state=!u.value.state),icon:"add",label:"Pedido"}),a(z,{color:"primary",onClick:e[11]||(e[11]=i=>C.value.state=!C.value.state),icon:"post_add",label:"Anexo"})]),_:1})]),_:1})]),_:1}))}};export{Ze as default};
