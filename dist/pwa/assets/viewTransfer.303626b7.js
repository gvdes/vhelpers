import{f as ve,Z as pe,u as me,r as A,g as ge,a as S,h as V,i as l,p as j,d as t,n as y,a7 as Y,k as r,a1 as v,j as d,ah as H,a4 as N,b9 as xe,c as ye,a2 as _e,a3 as we,Q as O,l as I,aX as q,bK as be,a5 as X,a6 as U,aj as he}from"./index.25d37601.js";import{Q as ke}from"./QToolbar.fb6a9a3f.js";import{Q as Ce}from"./QHeader.3acd3ae6.js";import{a as T,b as p,Q as R}from"./QList.62fcb72d.js";import{Q as Pe}from"./QFooter.01662442.js";import{Q as Ee}from"./QPage.59bbb72f.js";import{u as Fe}from"./use-quasar.809b100b.js";import{d as Ae}from"./dayjs.min.cbcf888d.js";import{E as Se,a as W}from"./jspdf.plugin.autotable.d63fb1cd.js";import{t as E}from"./transferApi.dcefddb3.js";import{E as Z}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{P as Ie,d as Te}from"./ProductsAutocomplete.f4a2f464.js";import"./QResizeObserver.85655e73.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.100554f1.js";import"./QSelect.9632a195.js";/* empty css                                                                         */const De={class:"row items-center"},Qe={class:"col"},Ve={class:"col"},Ne={class:"text-h6"},Oe={class:"text-center text-bold"},Re={class:"text-center text-bold row"},$e={class:"col"},Ue={class:"col"},ze={class:"col"},Be={class:"text-center text-h4"},Me={class:"text-center text-h6 text-grey-14"},Ge={class:"text-center"},Le={class:"q-pa-xs"},je={class:"row"},Ye={class:"col column q-py-md"},vt={__name:"viewTransfer",setup(He){const $=ve(),F=pe(),_=me(),i=Fe(),m=A(null),n=A({val:null,state:!1}),g=A([]),b=A({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),w=A({state:!1,encontrados:[],faltantes:[],products:null}),z=A(null),B=A(null),J=ge(()=>{var s;return((s=g.value)==null?void 0:s.filter(e=>{var o;return e.product==((o=n.value.val)==null?void 0:o.product)}).length)>0}),K=async()=>{const s=F.params.oid,e=await E.getTransfer(s);e.fail?console.log(e):(console.log(e),_.session.rol=="aud"||_.session.rol=="root"||_.session.rol=="audc"||(_.session.rol=="aux"||_.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||_.session.rol=="alm"||_.session.rol=="vld"||_.session.rol=="gce"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(m.value=e,g.value=e.bodie,console.log(m.value)):($.push("/transfers"),i.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},ee=s=>{console.log(s)},te=s=>{let e=g.value.findIndex(o=>o.product==s.code);console.log(e),e>=0?i.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(n.value.val={product:s.code,description:s.description,amount:1},n.value.state=!0,console.log(s))},le=async()=>{i.loading.show({message:"Insertando Producto"}),console.log(n.value.val),n.value.val._transfer=F.params.oid;const s=await E.addProduct(n.value.val);s.fail?console.log(s):(console.log(s),g.value.push(n.value.val),n.value={val:null,state:!1},i.loading.hide())},ae=async()=>{i.loading.show({message:"Editando Producto"}),console.log(n.value.val),n.value.val._transfer=F.params.oid;const s=await E.editProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value[e].amount=n.value.val.amount,i.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},i.loading.hide())}},oe=async()=>{i.loading.show({message:"Eliminando Producto"}),console.log(n.value.val),n.value.val._transfer=F.params.oid;const s=await E.removeProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value.splice(e,1),i.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},i.loading.hide())}},se=s=>{n.value.state=!0,n.value.val=s},M=()=>{n.value={val:null,state:!1}},ne=async()=>{i.loading.show({message:"Terminando Traspaso"});let s={user:_.session.name,traspaso:m.value,products:g.value};const e=await E.endTransfer(s);e.fail?console.log(e):(i.notify({message:e,position:"center",type:"positive"}),console.log(e),i.loading.hide(),$.push("/transfers"))},ie=()=>{z.value.click()},re=async()=>{let s=document.getElementById("inputFile").files[0],e=new Z.Workbook,o=[],a={};e.xlsx.load(s).then(D=>{let h=e.worksheets[0],k=h.getColumn("A");h.getColumn("B"),k.eachCell({includeEmpty:!0},function(x,f){let C=x.value,P=h.getCell(`B${f}`),Q=parseFloat(P.value);a[C]?a[C]+=Q:a[C]=Q});let c=Object.keys(a).map(x=>({codigo:x,cantidad:a[x]}));if(c.forEach(x=>o.push(x.codigo)),o.length){let x={codes:o,_workpoint:_.session.store.id_viz};i.loading.show({message:"Procesando archivo, espera.."}),Te.getMassive(x).then(f=>{let C=f.data;C.fails.notFound.map(u=>b.value.wndNotExist.push(u)),C.fails.repeat.map(u=>b.value.repeat.push(u));let P=f.data.products;b.value.wndGetRows=P.length,b.value.state=!b.value.state,console.log(P);let Q=P.map(u=>{let L=c.find(fe=>fe.codigo===u.code);return{product:u.code,description:u.description,amount:L?L.cantidad:0,_transfer:F.params.oid}});G(Q),i.loading.hide()}).catch(f=>{console.log(f),i.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else i.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},de=()=>{B.value.click()},ue=async()=>{let s=document.getElementById("inputFilePreventa").files[0],e=new Z.Workbook,o=[];e.xlsx.load(s).then(async a=>{let h=e.worksheets[0].getColumn("A");if(i.loading.show({message:"Procesando archivo, espera.."}),h.eachCell({includeEmpty:!0},function(k,c){k.value&&o.push(k.value)}),o.length){let k={codes:o,_workpoint:_.session.store.id_viz};console.log(k);const c=await E.transferPreventa(k);if(c.fail)alert(c);else{w.value.encontrados=c.Encontrados,w.value.faltantes=c.Faltantes,w.value.products=c.products.length,w.value.state=!w.value.state,c.products.forEach(f=>f._transfer=F.params.oid);let x=c.products;console.log(x),G(x),i.loading.hide()}}else i.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},G=async s=>{const e=await E.addProductMasive(s);e.fail?console.log(e):(console.log(e),s.map(o=>{g.value.push(o)}),i.loading.hide())},ce=async()=>{const s=F.params.oid,e=await E.getTransfer(s);if(console.log(e),e.error)console.error("No se logro imprimir la factura");else{const a=new Se({format:"letter"});let D=[];const h=e.bodie.map(c=>Object.values([c.product,c.description,c.amount]));console.log(typeof e.code_fs);const k=Math.ceil(h.length/20);for(var o=0;o<h.length;o+=20)D.push(h.slice(o,o+20));console.log(D);for(let c=0;c<2;c++){let x="ORIGINAL";c>0&&(x="COPIA",a.addPage()),D.forEach(function(f,C){C>0&&a.addPage();let P=0;for(let u=0;u<f.length;u++)f[u][0]=f[u][0],f[u][1]=f[u][1],f[u][2]=parseFloat(f[u][2]),P+=parseFloat(f[u][2]);for(let u=0;u<f.length;u++);a.setFontSize(25),a.setFont("helvetica","bold"),a.text("GRUPO VIZCARRA",105,10,"center"),a.setFontSize(8),a.setFontSize(12),a.text(x,185,10,"left"),a.text("LLUVIA LIGTH SA DE CV",10,25,"left"),a.setFontSize(8),a.text(e.created_by,10,30,"left"),a.text(e.notes,10,35,"left"),a.text("DELEG, CUAUHTEMOC CDMX",10,40,"left"),a.text("DOCUMENTO",10,55,"left"),a.text("TRASPASO",10,60,"left"),a.text("NUMERO",32,55,"left"),a.text(String(e.code_fs),32,60,"left"),a.text("PAGINA",54,55,"left"),a.text(`${C+1} de ${k}`,54,60,"left"),a.text("FECHA",76,55,"left");const Q=Ae(e.created_at).format("YYYY-MM-DD");a.text(Q,76,60,"left"),W(a,{startX:10,startY:65,theme:"plain",styles:{cellPadding:1,fontSize:12,halign:"center"},head:[["Almacen de Origen","Almacen de Destino"]],body:[[`(${e.origin.alias}) ${e.origin.name}`,`(${e.destiny.alias}) ${e.destiny.name}`]]}),W(a,{startX:10,startY:80,theme:"striped",styles:{cellPadding:.6,fontSize:8,halign:"center"},head:[["ARTICULO","DESCRIPCION","CANTIDAD"]],body:f,columnStyles:{0:{fontStyle:"bold",halign:"left"},1:{fontStyle:"bold",halign:"left"},4:{halign:"center"}}}),a.setFontSize(11),a.text("TOTAL UNIDDADES:",150,200,"left"),a.text(P.toString(),190,200,"left"),a.text("Firma Almacen Origen",12,224),a.text("Firma Almacen Destino",82,224),a.text("Firma Chofer",152,224),a.rect(10,220,60,40),a.rect(80,220,60,40),a.rect(150,220,60,40)})}a.save(`Traspaso${e.code_fs}`)}};return K(),(s,e)=>m.value?(S(),V(Ee,{key:0,padding:""},{default:l(()=>[t(Ce,{reveal:"",bordered:"",class:xe(Y(i).dark.isActive?"text-white bg-dark":"text-dark bg-white")},{default:l(()=>[t(ke,{class:"justify-between"},{default:l(()=>[t(y,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=o=>Y($).push("/transfers")),round:""}),r("div",null,v(m.value.store.name),1),r("div",De,[r("div",Qe,v(m.value.origin.name),1),e[7]||(e[7]=d()),t(H,{name:"arrow_forward",class:"col"}),r("div",Ve,v(m.value.destiny.name),1)]),r("div",null,v(m.value.created_by),1),r("div",null,[e[8]||(e[8]=d("Traspaso ")),t(H,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=d()),r("span",Ne,v(m.value.code_fs),1)])]),_:1}),t(N),r("div",Oe,v(m.value.notes),1),t(N),r("div",Re,[r("div",$e,[t(y,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:ie})]),r("div",Ue,[t(y,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:de})]),r("div",ze,[t(y,{color:"primary",icon:"picture_as_pdf",label:"PDF",flat:"",onClick:ce})]),r("input",{type:"file",ref_key:"inputFile",ref:z,id:"inputFile",onInput:re,hidden:"",accept:".xlsx,.xls"},null,544),r("input",{type:"file",ref_key:"inputFilePreventa",ref:B,id:"inputFilePreventa",onInput:ue,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1},8,["class"]),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(R,{bordered:""},{default:l(()=>[t(T,null,{default:l(()=>[t(p,null,{default:l(()=>e[10]||(e[10]=[d(" Producto ")])),_:1}),t(p,null,{default:l(()=>e[11]||(e[11]=[d(" Descripcion ")])),_:1}),t(p,{class:"text-center"},{default:l(()=>e[12]||(e[12]=[d(" Cantidad ")])),_:1})]),_:1})]),_:1}),(S(!0),ye(we,null,_e(g.value,(o,a)=>(S(),V(R,{bordered:"",key:a},{default:l(()=>[q((S(),V(T,{clickable:"",onClick:D=>se(o)},{default:l(()=>[t(p,null,{default:l(()=>[d(v(o.product),1)]),_:2},1024),t(p,null,{default:l(()=>[d(v(o.description),1)]),_:2},1024),t(p,{class:"text-center"},{default:l(()=>[d(v(o.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[he]]),t(N)]),_:2},1024))),128)),t(U,{modelValue:n.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.state=o),persistent:"",position:"bottom"},{default:l(()=>[t(O,{style:{width:"300","max-width":"40vw"}},{default:l(()=>[t(I,null,{default:l(()=>[r("div",Be,v(n.value.val.product),1),r("div",Me,v(n.value.val.description),1)]),_:1}),t(I,null,{default:l(()=>[r("div",Ge,[r("div",Le,[e[13]||(e[13]=r("div",{class:"text-bold text-h6"},"Cantidad:",-1)),r("div",je,[t(y,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=o=>n.value.val.amount>1?n.value.val.amount--:"")}),r("div",Ye,[q(r("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=o=>n.value.val.amount=o),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[be,n.value.val.amount]])]),t(y,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=o=>n.value.val.amount++)})])])])]),_:1}),J.value?(S(),V(X,{key:1,align:"center"},{default:l(()=>[t(y,{flat:"",icon:"close",color:"red-10",onClick:M}),t(y,{flat:"",label:"Eliminar",color:"negative",onClick:oe}),t(y,{flat:"",label:"Editar",color:"blue-10",onClick:ae})]),_:1})):(S(),V(X,{key:0,align:"center"},{default:l(()=>[t(y,{flat:"",label:"Cancelar",color:"negative",onClick:M}),t(y,{flat:"",label:"Agregar",color:"positive",onClick:le})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:b.value.state,"onUpdate:modelValue":e[5]||(e[5]=o=>b.value.state=o)},{default:l(()=>[t(O,null,{default:l(()=>[t(I,{class:"row text-bold text-overline text-center"},{default:l(()=>e[14]||(e[14]=[d(" Resultados de la importacion :O ")])),_:1}),t(I,null,{default:l(()=>[t(R,{bordered:""},{default:l(()=>[t(T,null,{default:l(()=>[t(p,null,{default:l(()=>e[15]||(e[15]=[d("Productos Encontrados")])),_:1}),t(p,null,{default:l(()=>[d(v(b.value.wndGetRows),1)]),_:1})]),_:1}),t(T,null,{default:l(()=>[t(p,null,{default:l(()=>e[16]||(e[16]=[d("Productos Sin Datos")])),_:1}),t(p,null,{default:l(()=>[d(v(b.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:w.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>w.value.state=o)},{default:l(()=>[t(O,null,{default:l(()=>[t(I,{class:"row text-bold text-overline text-center"},{default:l(()=>e[17]||(e[17]=[d(" Resultados de la importacion :O ")])),_:1}),t(I,null,{default:l(()=>[t(R,{bordered:""},{default:l(()=>[t(T,null,{default:l(()=>[t(p,null,{default:l(()=>e[18]||(e[18]=[d("Pedidos Encontrados")])),_:1}),t(p,null,{default:l(()=>[d(v(w.value.encontrados),1)]),_:1})]),_:1}),t(T,null,{default:l(()=>[t(p,null,{default:l(()=>e[19]||(e[19]=[d("Pedidos Sin Encontrar")])),_:1}),t(p,null,{default:l(()=>[d(v(w.value.faltantes),1)]),_:1})]),_:1}),t(T,null,{default:l(()=>[t(p,null,{default:l(()=>e[20]||(e[20]=[d("Productos Encontrados")])),_:1}),t(p,null,{default:l(()=>[d(v(w.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Pe,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:l(()=>[t(O,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:l(()=>[t(I,{class:"row"},{default:l(()=>[t(Ie,{class:"col",checkState:!1,onInput:ee,onAgregar:te}),g.value.length>0?(S(),V(y,{key:0,color:"primary",flat:"",icon:"east",onClick:ne,round:""})):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)}};export{vt as default};
