import{l as re,c as _,s as h,t as ue,a9 as de,ab as ve,J as X,q as ce,O as me,ad as pe,v as ge,bl as fe,j as f,L as _e,W as ke,a as be,u as ye,r as k,o as u,d as P,w as r,e as l,g as c,ae as J,bD as Y,k as V,h as he,aV as Z,i as g,Q as ee,f as U,Y as b,_ as d,b5 as xe,a4 as y,a1 as z,a0 as te,$ as oe,a$ as Ce,a3 as Pe}from"./index.221caa3e.js";import{Q as ae,a as ie}from"./QSelect.a5e41645.js";import{Q as K}from"./QImg.ba62cb50.js";import{Q as qe,a as we,b as Se}from"./QList.3f60b836.js";import{Q as le}from"./QBtnGroup.2bf73300.js";import{Q as Qe}from"./QPageSticky.37011f7c.js";import{u as $e,b as Ve,c as Ie,Q as Te}from"./QTable.958e2803.js";import{Q as Be}from"./QSpace.aad9ff75.js";import{Q as Ne}from"./QBar.074b6a22.js";import{u as De,a as ze,b as Me,c as Ae,T as Fe}from"./use-panel.175f7d87.js";import{Q as Re}from"./QPage.74a09cbe.js";import{C as Le}from"./ClosePopup.00caced2.js";import"./dayjs.min.cbcf888d.js";import{c as je,a as se}from"./catalogStore.5f7be5d7.js";import{u as Oe}from"./use-quasar.ba838ac0.js";import"./QExpansionItem.80d01a08.js";import"./QDrawer.b431f3e9.js";import{v as ne}from"./axios.7cf70621.js";import"./socket.cfd84d65.js";import"./Restock.13d2ea5f.js";import"./QLinearProgress.f0c22688.js";import"./use-render-cache.3aae9b27.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.5ced3230.js";import"./QScrollObserver.1d0c900e.js";import"./QToolbar.36905a19.js";import"./QForm.c1bd9b44.js";import"./QTd.91c3f3ae.js";import"./QPopupEdit.559b3e15.js";import"./QTr.c9b41cb8.js";import"./QLayout.1b0d0afc.js";import"./jspdf.plugin.autotable.2c427a54.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.125a354e.js";/* empty css                                                       */var Ue=re({name:"QCarouselSlide",props:{...De,imgSrc:String},setup(i,{slots:x}){const n=_(()=>i.imgSrc?{backgroundImage:`url("${i.imgSrc}")`}:{});return()=>h("div",{class:"q-carousel__slide",style:n.value},ue(x.default))}});const Ee=["top","right","bottom","left"],Ge=["regular","flat","outline","push","unelevated"];var He=re({name:"QCarousel",props:{...de,...ze,...$e,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:i=>Ge.includes(i),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:i=>Ee.includes(i)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...Ve,...Me],setup(i,{slots:x}){const{proxy:{$q:n}}=ge(),M=ve(i,n);let v=null,w;const{updatePanelsList:I,getPanelContent:S,panelDirectives:T,goToPanel:Q,previousPanel:$,nextPanel:m,getEnabledPanels:C,panelIndex:p}=Ae(),{inFullscreen:A}=Ie(),E=_(()=>A.value!==!0&&i.height!==void 0?{height:i.height}:{}),B=_(()=>i.vertical===!0?"vertical":"horizontal"),F=_(()=>i.navigationPosition||(i.vertical===!0?"right":"bottom")),G=_(()=>`q-carousel q-panel-parent q-carousel--with${i.padding===!0?"":"out"}-padding`+(A.value===!0?" fullscreen":"")+(M.value===!0?" q-carousel--dark q-dark":"")+(i.arrows===!0?` q-carousel--arrows-${B.value}`:"")+(i.navigation===!0?` q-carousel--navigation-${F.value}`:"")),R=_(()=>{const t=[i.prevIcon||n.iconSet.carousel[i.vertical===!0?"up":"left"],i.nextIcon||n.iconSet.carousel[i.vertical===!0?"down":"right"]];return i.vertical===!1&&n.lang.rtl===!0?t.reverse():t}),L=_(()=>i.navigationIcon||n.iconSet.carousel.navigationIcon),H=_(()=>i.navigationActiveIcon||L.value),N=_(()=>({color:i.controlColor,textColor:i.controlTextColor,round:!0,[i.controlType]:!0,dense:!0}));X(()=>i.modelValue,()=>{i.autoplay&&D()}),X(()=>i.autoplay,t=>{t?D():v!==null&&(clearTimeout(v),v=null)});function D(){const t=fe(i.autoplay)===!0?Math.abs(i.autoplay):5e3;v!==null&&clearTimeout(v),v=setTimeout(()=>{v=null,t>=0?m():$()},t)}ce(()=>{i.autoplay&&D()}),me(()=>{v!==null&&clearTimeout(v)});function j(t,e){return h("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${t} q-carousel__navigation--${F.value}`+(i.controlColor!==void 0?` text-${i.controlColor}`:"")},[h("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},C().map(e))])}function o(){const t=[];if(i.navigation===!0){const e=x["navigation-icon"]!==void 0?x["navigation-icon"]:s=>h(f,{key:"nav"+s.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${s.active===!0?"":"in"}active`,...s.btnProps,onClick:s.onClick}),a=w-1;t.push(j("buttons",(s,q)=>{const O=s.props.name,W=p.value===q;return e({index:q,maxIndex:a,name:O,active:W,btnProps:{icon:W===!0?H.value:L.value,size:"sm",...N.value},onClick:()=>{Q(O)}})}))}else if(i.thumbnails===!0){const e=i.controlColor!==void 0?` text-${i.controlColor}`:"";t.push(j("thumbnails",a=>{const s=a.props;return h("img",{key:"tmb#"+s.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${s.name===i.modelValue?"":"in"}active`+e,src:s.imgSrc||s["img-src"],onClick:()=>{Q(s.name)}})}))}return i.arrows===!0&&p.value>=0&&((i.infinite===!0||p.value>0)&&t.push(h("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${B.value} absolute flex flex-center`},[h(f,{icon:R.value[0],...N.value,onClick:$})])),(i.infinite===!0||p.value<w-1)&&t.push(h("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${B.value} absolute flex flex-center`},[h(f,{icon:R.value[1],...N.value,onClick:m})]))),_e(x.control,t)}return()=>(w=I(x),h("div",{class:G.value,style:E.value},[pe("div",{class:"q-carousel__slides-container"},S(),"sl-cont",i.swipeable,()=>T.value)].concat(o())))}});const Je={class:"row justify-end q-gutter-sm full-width"},Ke={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},We={class:"col"},Xe={class:"text-bold"},Ye={class:"col"},Ze={class:"text-bold"},et={class:"col"},tt={class:"row"},ot={class:"text-caption"},at={class:"text-caption"},it={class:"text-caption"},lt={class:"text-caption"},st=["onClick"],nt={key:1,class:"col-6 flex flex-center bg-grey-2",style:{height:"100%"}},rt={class:"col-6 q-pa-sm flex flex--column justify-between"},ct={class:"text-center text-bold text-red-10"},ut={class:"q-mt-md"},dt={class:"col"},vt={class:"text-bold"},mt={key:0,class:"col"},pt={class:"text-bold"},gt={key:1,class:"col"},ft={key:0,class:"col"},_t={key:1,class:"col"},kt={class:"q-ml-md q-mr-md text-white bg-primary"},bt={class:"row q-pt-xs"},yt={class:"text-bold ellipsis"},ht={key:1,autoplay:"",loop:"",muted:"",playsinline:"",autobuffer:"",class:"media-video"},xt=["src"],Ct={key:2,class:"text-grey absolute-center"},so={__name:"viewCatalogFamily",setup(i){const x=ke();be();const n=je(),M=Oe(),v=ye(),w=k(!1),I=k(!1),S=k([]),T=k(0),Q=k(null);k({state:!1,val:null});const $=k([]),m=k({pagination:{rowsPerPage:12,page:1},filter:""}),C=k({val:{id:2,label:"Mayor a 1"},opts:[{id:1,label:"Agotados"},{id:2,label:"Mayor a 1"},{id:3,label:"Mayor a 25"},{id:4,label:"Mayor a 50"},{id:5,label:"Mayor a 100"}]}),p=k({val:null,opts:[]}),A=_(()=>Math.ceil($.value.length/m.value.pagination.rowsPerPage)),E=_(()=>$.value.filter(o=>{var a;const t=p.value.val?o._category===p.value.val.id:!0;let e=!0;if(C.value.val){const s=(a=o.stocks.reduce((q,O)=>q+Number(O.pivot.stock),0))!=null?a:0;switch(C.value.val.id){case 1:e=s===0;break;case 2:e=s>1;break;case 3:e=s>25;break;case 4:e=s>50;break;case 5:e=s>100;break}}return t&&e})),B=async()=>{M.loading.show({message:"Obteniendo Hijos"}),console.log(x.params.fid);const o={family:x.params.fid,workpoint:v.session.store.id_viz},t=await se.getFamilysProducts(o);if(t.fail)console.log(t);else{console.log(t),n.setTitle(`Cat\xE1logo ${t.family.name}`),p.value.opts=t.categories;const e=t.family.products.map(a=>({...a,order:0}));if(n.orderState)for(const a of e){const s=n.order.products.find(q=>q.id===a.id);s&&(a.pivot=s.pivot)}if(n.requisitionState)for(const a of e){const s=n.requisition.products.find(q=>q.id===a.id);s&&(a.pivot=s.pivot)}$.value=e,M.loading.hide()}},F=async o=>{w.value=!0,I.value=!0,S.value=[],T.value=0,Q.value=o;const t=await se.getProductMedia({id:o.id});t.fail?console.log(t):(console.log(t),S.value=t,I.value=!1)},G=o=>{const t={order:n.order.id,_product:o.id,units:1,price:o.prices.find(e=>e.id==1).pivot.price,total:o.prices.find(e=>e.id==1).pivot.price,amount:1,amountDelivered:0,toDelivered:0,_price_list:1,_supply_by:1};o.pivot={...t},n.pushProduct(o)},R=o=>{o.pivot.amount++,o.pivot.units++,o.pivot.total=o.pivot.amount*o.pivot.price,n.updateProduct(o)},L=o=>{o.pivot.amount--,o.pivot.units--,o.pivot.amount<=0?(delete o.pivot,n.removeProduct(o.id)):(o.pivot.total=o.pivot.amount*o.pivot.price,n.updateProduct(o))},H=o=>{const t={_requisition:n.requisition.id,_product:o.id,amount:1,_supply_by:1,units:1,cost:o.prices.find(e=>e.id==1).pivot.price,total:o.prices.find(e=>e.id==1).pivot.price,comments:null,stock:o.stocks.find(e=>e.id==1).pivot.stock,ipack:null};o.pivot={...t},n.pushProductRequisition(o)},N=o=>{o.pivot.amount++,o.pivot.units++,o.pivot.total=o.pivot.amount*o.pivot.price,n.updateProductRequisition(o)},D=o=>{o.pivot.amount--,o.pivot.units--,o.pivot.amount<=0?(delete o.pivot,n.removeProductRequisition(o.id)):(o.pivot.total=o.pivot.amount*o.pivot.price,n.updateProductRequisition(o))},j=({evt:o,...t})=>{let e=1,a=A.value;t.direction=="left"&&m.value.pagination.page<a?m.value.pagination.page++:t.direction=="right"&&m.value.pagination.page>e&&m.value.pagination.page--};return ce(()=>{B()}),(o,t)=>(u(),P(Re,{padding:""},{default:r(()=>[l(Te,{rows:E.value,"row-key":"id",grid:"",pagination:m.value.pagination,filter:m.value.filter,"onUpdate:pagination":t[5]||(t[5]=e=>m.value.pagination=e)},{top:r(()=>[c("div",Je,[l(ae,{modelValue:C.value.val,"onUpdate:modelValue":t[1]||(t[1]=e=>C.value.val=e),options:C.value.opts,label:"Stocks",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:r(()=>[C.value.val!==null?(u(),P(J,{key:0,name:"close",onClick:t[0]||(t[0]=Y(e=>C.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):V("",!0)]),_:1},8,["modelValue","options"]),l(ae,{modelValue:p.value.val,"onUpdate:modelValue":t[3]||(t[3]=e=>p.value.val=e),options:p.value.opts,"option-label":"name",label:"Categor\xEDas",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:r(()=>[p.value.val!==null?(u(),P(J,{key:0,name:"close",onClick:t[2]||(t[2]=Y(e=>p.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):V("",!0)]),_:1},8,["modelValue","options"]),l(he,{dense:"",debounce:"300",modelValue:m.value.filter,"onUpdate:modelValue":t[4]||(t[4]=e=>m.value.filter=e),placeholder:"Buscar",class:"col-auto",outlined:""},{append:r(()=>[l(J,{name:"search"})]),_:1},8,["modelValue"])])]),item:r(e=>[Z((u(),g("div",Ke,[l(ee,{flat:"",bordered:""},{default:r(()=>[l(U,{class:"text-center row"},{default:r(()=>[c("div",We,[t[8]||(t[8]=b(" Codigo: ")),c("span",Xe,d(e.row.code),1)]),c("div",Ye,[t[9]||(t[9]=b(" CCO: ")),c("span",Ze,d(e.row.name),1)]),c("div",et,[c("div",null,[t[10]||(t[10]=b(" STOCK: ")),c("span",{class:xe(["text-bold",e.row.stocks.find(a=>a.id==y(v).session.store.id_viz).pivot.stock<=0?"text-red":""])},d(e.row.stocks.find(a=>a.id==y(v).session.store.id_viz).pivot.stock<=0?"Agotado":e.row.stocks.find(a=>a.id==y(v).session.store.id_viz).pivot.stock),3)]),c("div",tt,[c("div",ot,[b(d(e.row.stocks.find(a=>a.id==1).alias)+" ",1),c("div",at,d(e.row.stocks.find(a=>a.id==1).pivot.stock),1)]),l(z,{spaced:"",inset:"",vertical:"",dark:""}),c("div",it,[b(d(e.row.stocks.find(a=>a.id==2).alias)+" ",1),c("div",lt,d(e.row.stocks.find(a=>a.id==2).pivot.stock),1)])])])]),_:2},1024),l(z),l(U,{class:"row items-stretch",tyle:"min-height: 260px;"},{default:r(()=>[e.row.imgcover?(u(),g("div",{key:0,class:"col-6 flex flex-center bg-grey-2",onClick:a=>F(e.row),style:{height:"100%"}},[l(K,{src:`${y(ne)}/Products/${e.row.id}/${e.row.imgcover}`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])],8,st)):(u(),g("div",nt,[l(K,{src:`${y(ne)}/Products/sinpicture.png`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])])),c("div",rt,[c("div",ct,d(e.row.description),1),l(z,{spaced:"",inset:"",vertical:"",dark:""}),c("div",ut,[(u(!0),g(te,null,oe(e.row.prices,(a,s)=>(u(),g("div",{key:s},[l(qe,{bordered:"",dense:""},{default:r(()=>[l(we,null,{default:r(()=>[l(Se,null,{default:r(()=>[l(ie,{class:"text-center text-bold"},{default:r(()=>[b(d(a.name),1)]),_:2},1024),l(ie,{class:"text-center"},{default:r(()=>[b("$ "+d(a.pivot.price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),l(z,{spaced:"",inset:"",vertical:"",dark:""})])]),_:2},1024),l(z),l(U,{class:"text-center row"},{default:r(()=>[c("div",dt,[t[11]||(t[11]=b(" Piezas X Caja: ")),c("span",vt,d(e.row.pieces),1)]),e.row.large?(u(),g("div",mt,[t[12]||(t[12]=b(" MED: ")),c("span",pt,d(e.row.large),1)])):V("",!0),y(n).orderState||y(n).requisitionState?(u(),g("div",gt,[e.row.pivot?(u(),g("div",_t,[l(le,{rounded:"",class:"bg-primary"},{default:r(()=>[l(f,{size:"sm",color:"primary",icon:"remove",onClick:a=>y(n).orderState?L(e.row):D(e.row)},null,8,["onClick"]),c("div",kt,d(e.row.pivot.amount),1),l(f,{size:"sm",color:"primary",icon:"add",onClick:a=>y(n).orderState?R(e.row):N(e.row)},null,8,["onClick"])]),_:2},1024)])):(u(),g("div",ft,[l(f,{color:e.row.stocks.reduce((a,s)=>a+Number(s.pivot.stock),0)<=0?"negative":"primary",rounded:"",label:e.row.stocks.reduce((a,s)=>a+Number(s.pivot.stock),0)<=0?"Agotado":"Agregar",onClick:a=>y(n).orderState?G(e.row):H(e.row),size:"sm",disable:e.row.stocks.reduce((a,s)=>a+Number(s.pivot.stock),0)<=0},null,8,["color","label","onClick","disable"])]))])):V("",!0)]),_:2},1024)]),_:2},1024)])),[[Fe,j,void 0,{horizontal:!0}]])]),bottom:r(e=>[l(Qe,{position:"bottom",class:"full-width",offset:[0,18]},{default:r(()=>[c("div",bt,[l(le,{rounded:"",class:""},{default:r(()=>[e.pagesNumber>2?(u(),P(f,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):V("",!0),l(f,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),l(f,{flat:"",disable:"","no-caps":""},{default:r(()=>[b(d(e.pagination.page)+" / "+d(e.pagesNumber),1)]),_:2},1024),l(f,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(u(),P(f,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):V("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","pagination","filter"]),l(Pe,{modelValue:w.value,"onUpdate:modelValue":t[7]||(t[7]=e=>w.value=e),persistent:""},{default:r(()=>[l(ee,{class:"media-card"},{default:r(()=>[l(Ne,null,{default:r(()=>{var e,a;return[c("div",yt,d((e=Q.value)==null?void 0:e.code)+" \u2014 "+d((a=Q.value)==null?void 0:a.description),1),l(Be),Z(l(f,{dense:"",flat:"",icon:"close"},null,512),[[Le]])]}),_:1}),l(U,{class:"q-pa-none media-content"},{default:r(()=>[I.value?(u(),P(Ce,{key:0,size:"50px",color:"primary",class:"absolute-center"})):S.value.length?(u(),P(He,{key:1,modelValue:T.value,"onUpdate:modelValue":t[6]||(t[6]=e=>T.value=e),animated:"",arrows:"",navigation:"",infinite:"",swipeable:"",class:"media-carousel"},{default:r(()=>[(u(!0),g(te,null,oe(S.value,(e,a)=>(u(),P(Ue,{key:a,name:a,class:"flex flex-center"},{default:r(()=>[e.type==="image"?(u(),P(K,{key:0,src:e.url,"spinner-color":"primary",class:"media-img"},null,8,["src"])):(u(),g("video",ht,[c("source",{src:e.url,type:"video/mp4"},null,8,xt)]))]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])):(u(),g("div",Ct," Sin archivos disponibles "))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{so as default};
