import{b as Q,Q as W}from"./QList.33a7424a.js";import{Q as se}from"./QHeader.48dbe0d8.js";import{u as ne,r as C,c as D,o as re,d as ce,w as d,e as i,f as w,ak as J,I as ue,a0 as de,Q as k,b6 as O}from"./index.746245ed.js";import{Q as pe}from"./QToolbar.d7bddab9.js";import{Q as P}from"./QSelect.a3b3557c.js";import{Q as $}from"./QCardSection.2252dd33.js";import{Q as X}from"./QCard.7a43c7d1.js";import{Q as me}from"./QTable.d2450898.js";import{Q as ve}from"./QDate.1f66f6f9.js";import{Q as fe}from"./QCardActions.e3b9f597.js";import{Q as ge}from"./QPage.c8fdd22e.js";import{Q as be,a as Ce}from"./QLayout.c26ccf60.js";import{_ as ke}from"./UserToolbar.b83274d1.js";import{_ as ye}from"./OptionsLabels.91305e38.js";import{v as Qe}from"./axios.3afb04d7.js";import{u as we}from"./use-quasar.5806cb54.js";import"./jspdf.plugin.autotable.bf10437a.js";import{d as Ve}from"./dayjs.min.cbcf888d.js";import{E as Ee}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./QResizeObserver.e21a6d74.js";import"./QLinearProgress.d34ebc7d.js";import"./QCheckbox.1c9e3e81.js";import"./use-render-cache.3aae9b27.js";import"./date.df543830.js";import"./QScrollObserver.fd117df1.js";import"./QDrawer.d32ae152.js";import"./ClosePopup.6458ef0b.js";import"./auth.acbb1d50.js";import"./QImg.bf976f3f.js";import"./QInput.cbcb5303.js";/* empty css                                                                         */import"./labels.feb501b1.js";import"./_commonjsHelpers.88e99c8f.js";var K={getData(A,h){return Qe.post(`/compare/getChangePrices/${A}`,h).then(v=>v.data).catch(v=>({fail:v}))}};const Ie={class:"text-bold"},he={class:"row"},_e={class:"q-pa-md"},ca={__name:"ChangePricesLYT",setup(A){const h=ne(),v=we(),m=C([]),u=C({state:!1,date:null}),V=C([]),Z=C([{name:"stock_exh",label:"EXHIBICION",field:o=>{var e,a,t;return((t=(a=(e=o.stocks)==null?void 0:e.find(s=>s.pivot))==null?void 0:a.pivot)==null?void 0:t.exh)||0},align:"center",sortable:!0},{name:"stock_gen",label:"GENERAL",field:o=>{var e,a,t;return((t=(a=(e=o.stocks)==null?void 0:e.find(s=>s.pivot))==null?void 0:a.pivot)==null?void 0:t.gen)||0},align:"center",sortable:!0}]),l=C({seccion:{val:null,opts:[]},familias:{val:null,opts:[]},categorias:{val:null,opts:[]}}),y=C({columns:[{name:"code",label:"CODIGO",field:o=>o.code,align:"left",sortable:!0},{name:"barcode",label:"CB",field:o=>o.barcode,align:"left",sortable:!0},{name:"description",label:"DESCRIPCION",field:o=>o.description,align:"left",sortable:!0},{name:"section",label:"SECCION",field:o=>o.categories.familia.seccion.name,align:"left",sortable:!0},{name:"family",label:"FAMILIA",field:o=>o.categories.familia.name,align:"left",sortable:!0},{name:"category",label:"CATEGORIA",field:o=>o.categories.name,align:"left",sortable:!0},{name:"locations",label:"UBICACION",field:o=>{var e;return(e=o.locations)==null?void 0:e.map(a=>a.path).join("/")},align:"center",sortable:!0},...V.value,...Z.value]}),_=C({state:!1}),ee=C({val:[0,1,2,4],opts:[{label:"Menudeo",value:1},{label:"Mayoreo",value:2},{label:"Docena",value:3},{label:"Caja",value:4}]}),x=D(()=>m.value.filter(o=>o.prices.some(e=>e.pivot.price!=0))),B=D(()=>{var o,e,a,t,s,n,c,r,p,E,T,L,N,R,U,j,M,F,G,Y,q,H,z;return((e=(o=l.value)==null?void 0:o.seccion)==null?void 0:e.val)&&!((s=(t=(a=l.value)==null?void 0:a.seccion)==null?void 0:t.familia)!=null&&s.val)?x.value.filter(I=>{var f,g,b;return((b=(g=(f=I.categories)==null?void 0:f.familia)==null?void 0:g.seccion)==null?void 0:b.id)===l.value.seccion.val.id}):((c=(n=l.value)==null?void 0:n.seccion)==null?void 0:c.val)&&((E=(p=(r=l.value)==null?void 0:r.seccion)==null?void 0:p.familia)==null?void 0:E.val)&&!((R=(N=(L=(T=l.value)==null?void 0:T.seccion)==null?void 0:L.familia)==null?void 0:N.categorias)!=null&&R.val)?x.value.filter(I=>{var f,g,b;return((b=(g=(f=I.categories)==null?void 0:f.familia)==null?void 0:g.seccion)==null?void 0:b.id)===l.value.seccion.val.id}):((j=(U=l.value)==null?void 0:U.seccion)==null?void 0:j.val)&&((G=(F=(M=l.value)==null?void 0:M.seccion)==null?void 0:F.familia)==null?void 0:G.val)&&((z=(H=(q=(Y=l.value)==null?void 0:Y.seccion)==null?void 0:q.familia)==null?void 0:H.categorias)==null?void 0:z.val)?x.value.filter(I=>{var f,g,b;return((b=(g=(f=I.categories)==null?void 0:f.familia)==null?void 0:g.seccion)==null?void 0:b.id)===l.value.seccion.val.id}):x.value}),ae=D(()=>{var o,e;return(e=(o=l.value)==null?void 0:o.seccion)!=null&&e.val?l.value.familias.opts.filter(a=>{var t,s;return a.root==((s=(t=l.value)==null?void 0:t.seccion)==null?void 0:s.val.id)}):l.value.familias.opts}),le=D(()=>{var o,e;return(e=(o=l.value)==null?void 0:o.familias)!=null&&e.val?l.value.categorias.opts.filter(a=>{var t,s;return a.root==((s=(t=l.value)==null?void 0:t.familias)==null?void 0:s.val.id)}):l.value.categorias.opts}),oe=async()=>{v.loading.show({message:"Obteniendo Informacion"});let o=new Date;u.value.date=Ve(o).format("YYYY/MM/DD");let e=h.session.store.id_viz;const a=await K.getData(e,{fechas:u.value.date});if(a.fail)console.log(a);else{if(console.log(a),m.value=a,m.value.forEach(t=>{let s=S(t.prices);t._copies=1,t.type=s.type,t.usedPrices=s.prices;const n=t.categories.familia.seccion;n&&!l.value.seccion.opts.map(p=>p.id).includes(n.id)&&l.value.seccion.opts.push(n);const c=t.categories.familia;c&&!l.value.familias.opts.map(p=>p.id).includes(c.id)&&l.value.familias.opts.push(c);const r=t.categories;r&&!l.value.categorias.opts.map(p=>p.id).includes(r.id)&&l.value.categorias.opts.push(r)}),m.value.length>0){const t=m.value[0];t.prices&&t.prices.forEach(s=>{V.value.push({name:`price_${s.id}`,label:s.name,field:n=>{var c,r;return((r=(c=n.prices.find(p=>p.id===s.id))==null?void 0:c.pivot)==null?void 0:r.price)||0},align:"center",sortable:!0})}),y.value.columns=[...y.value.columns,...V.value]}v.loading.hide()}},te=async()=>{v.loading.show({message:"Obteniendo Informacion"});let o=h.session.store.id_viz;const e=await K.getData(o,{fechas:u.value.date});if(e.fail)console.log(e);else{if(console.log(e),m.value=e,m.value.forEach(a=>{let t=S(a.prices);a._copies=1,a.type=t.type,a.usedPrices=t.prices;const s=a.categories.familia.seccion;s&&!l.value.seccion.opts.map(r=>r.id).includes(s.id)&&l.value.seccion.opts.push(s);const n=a.categories.familia;n&&!l.value.familias.opts.map(r=>r.id).includes(n.id)&&l.value.familias.opts.push(n);const c=a.categories;c&&!l.value.categorias.opts.map(r=>r.id).includes(c.id)&&l.value.categorias.opts.push(c)}),m.value.length>0){const a=m.value[0];a.prices&&a.prices.forEach(t=>{V.value.push({name:`price_${t.id}`,label:t.name,field:s=>{var n,c;return((c=(n=s.prices.find(r=>r.id===t.id))==null?void 0:n.pivot)==null?void 0:c.price)||0},align:"center",sortable:!0})}),y.value.columns=[...y.value.columns,...V.value]}v.loading.hide(),u.value.state=!u.value.state}},ie=async()=>{const o=new Ee.Workbook,e=o.addWorksheet("Comparativo");e.addRow(y.value.columns.map(c=>c.label)),B.value.forEach(c=>{e.addRow(y.value.columns.map(r=>typeof r.field=="function"?r.field(c):c[r.field]||"-"))}),e.columns.forEach(c=>{let r=0;c.eachCell({includeEmpty:!0},p=>{const E=p.value?p.value.toString().length:10;E>r&&(r=E)}),c.width=r<10?10:r});const a=await o.xlsx.writeBuffer(),t=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download="Cambio_Precios.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)},S=(o,e)=>{let a=[...o];const t=a.find(n=>n.pivot._type==4),s=a.find(n=>n.pivot._type==1);if(t.pivot.price==s.pivot.price){let n={id:0,alias:"OFERTA",name:"Oferta",pivot:{price:a[0].pivot.price},used:!0};return console.log("oferta"),{type:"off",prices:[n]}}else return console.log("estandar"),{type:"std",prices:a}};return oe(),(o,e)=>(re(),ce(be,{view:"hHh Lpr fFf"},{default:d(()=>[i(se,{class:"transparent text-dark",bordered:""},{default:d(()=>[i(ke),i(Q)]),_:1}),i(Ce,null,{default:d(()=>[i(ge,{padding:""},{default:d(()=>[i(pe,{class:"justify-between"},{default:d(()=>[w("div",null,[e[12]||(e[12]=J("Helpers ")),i(ue,{name:"navigate_next",color:"primary"}),e[13]||(e[13]=J()),e[14]||(e[14]=w("span",{class:"text-h6"},"Cambios de precio",-1))]),w("div",Ie," Cambio de Precios : "+de(typeof u.value.date=="object"?`Del ${u.value.date.from} a
            ${u.value.date.to}`:u.value.date),1),w("div",he,[i(k,{color:"primary",icon:"event",flat:"",onClick:e[0]||(e[0]=a=>u.value.state=!u.value.state)}),i(Q,{spaced:"",inset:"",vertical:"",dark:""}),i(k,{class:"col",flat:"",color:"primary",icon:"download",rounded:"",title:"Importar Excel",onClick:ie}),i(Q,{spaced:"",inset:"",vertical:"",dark:""}),i(k,{class:"col",flat:"",color:"primary",icon:"label",rounded:"",title:"Crear Etiquetas",onClick:e[1]||(e[1]=a=>_.value.state=!_.value.state)})])]),_:1}),i(X,{class:"my-card"},{default:d(()=>[i($,{class:"row"},{default:d(()=>[i(P,{class:"col",modelValue:l.value.seccion.val,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.seccion.val=a),options:l.value.seccion.opts,label:"SECCION",filled:"","option-label":"name"},O({_:2},[l.value.seccion.val?{name:"append",fn:d(()=>[i(k,{round:"",dense:"",flat:"",icon:"close",onClick:e[2]||(e[2]=a=>{l.value.seccion.val=null,l.value.familias.val=null,l.value.categorias.val=null})})]),key:"0"}:void 0]),1032,["modelValue","options"]),i(Q,{spaced:"",inset:"",vertical:"",dark:""}),i(P,{class:"col",modelValue:l.value.familias.val,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.familias.val=a),options:ae.value,label:"FAMILIA",filled:"","option-label":"name",disable:!l.value.seccion.val},O({_:2},[l.value.familias.val?{name:"append",fn:d(()=>[i(k,{round:"",dense:"",flat:"",icon:"close",onClick:e[4]||(e[4]=a=>{l.value.familias.val=null,l.value.categorias.val=null})})]),key:"0"}:void 0]),1032,["modelValue","options","disable"]),i(Q,{spaced:"",inset:"",vertical:"",dark:""}),i(P,{class:"col",modelValue:l.value.categorias.val,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.categorias.val=a),options:le.value,label:"CATEGORIA",filled:"","option-label":"name",disable:!l.value.familias.val},O({_:2},[l.value.categorias.val?{name:"append",fn:d(()=>[i(k,{round:"",dense:"",flat:"",icon:"close",onClick:e[6]||(e[6]=a=>l.value.categorias.val=null)})]),key:"0"}:void 0]),1032,["modelValue","options","disable"]),i(Q,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),i(Q,{spaced:"",inset:"",vertical:"",dark:""}),i(me,{rows:B.value,columns:y.value.columns},null,8,["rows","columns"]),i(W,{modelValue:_.value.state,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value.state=a),persistent:""},{default:d(()=>[i(ye,{products:m.value,prices:ee.value},null,8,["products","prices"])]),_:1},8,["modelValue"]),i(W,{modelValue:u.value.state,"onUpdate:modelValue":e[11]||(e[11]=a=>u.value.state=a)},{default:d(()=>[i(X,{class:"my-card"},{default:d(()=>[i($,null,{default:d(()=>[w("div",_e,[e[15]||(e[15]=w("div",{class:"q-pb-sm"},null,-1)),i(ve,{modelValue:u.value.date,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value.date=a),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),i($,null,{default:d(()=>[i(fe,{align:"right"},{default:d(()=>[i(k,{flat:"",icon:"close",color:"negative",onClick:e[10]||(e[10]=a=>u.value.state=!u.value.state)}),i(k,{flat:"",icon:"check",color:"positive",onClick:te})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{ca as default};
