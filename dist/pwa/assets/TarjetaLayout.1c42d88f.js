import{Q as D}from"./position-engine.1b2c7696.js";import{r as b,o as Q,a as ue,w as s,e as a,i as d,a3 as _,Y as G,Q as x,g as B,h as j,a4 as C,a2 as q,a5 as ce}from"./index.e6170c13.js";import{Q as me}from"./QToolbar.6793419b.js";import{Q as _e,a as $}from"./QCardActions.489b3f3d.js";import{Q as fe}from"./QInput.6bbccfb5.js";import{Q as pe}from"./QTable.be150a4b.js";import{Q as ve}from"./QSpinnerFacebook.0816083c.js";import{Q as Te}from"./QTooltip.e193f4ca.js";import{Q as N}from"./QDialog.71fbc009.js";import{Q as S,a as A}from"./QCard.d0c7ab56.js";import{Q as K,a as g}from"./QItem.15693e4d.js";import{Q as Ee}from"./QList.0fa09721.js";import{Q as Z}from"./QSelect.b56005a6.js";import{Q as xe}from"./QForm.d19d2465.js";import{Q as Ce}from"./QDate.aa2d83af.js";import{Q as Ae}from"./QPage.508275c0.js";import{Q as ge,a as be}from"./QLayout.71f9a273.js";import{_ as Ie,C as J}from"./UserToolbar.8ee99b14.js";import{u as he}from"./VDB.3ec6fcd9.js";import{a as V}from"./axios.f1f32898.js";import{e as Oe}from"./export-file.dc78ba05.js";import{u as ye}from"./use-quasar.d1a73943.js";import{E as Y,a as X}from"./jspdf.plugin.autotable.bfe188e9.js";import{a as Ne}from"./axios.ae0a941c.js";import"./QResizeObserver.415fb7b0.js";import"./use-key-composition.9a9d13a3.js";import"./QLinearProgress.2bed1743.js";import"./QCheckbox.f67f8304.js";import"./use-cache.b0833c75.js";import"./date.a2099314.js";import"./_commonjsHelpers.88e99c8f.js";const Re=d("span",{class:"text-h6"},"Consulta de Pagos",-1),Pe={class:"justify-end"},Se={key:0},Ve={class:"row"},Fe={class:"col"},Le={class:"col"},De={key:0},Qe={class:"text-h4"},$e={class:"text-subtitle2"},Ue={class:"text-h5"},we={class:"text-h5 text-center"},Me={class:"text-h5 text-center"},ze=d("div",{class:"text-h6 text-center"},"Impresora",-1),He={class:"q-pa-md"},Ge=d("div",{class:"q-pb-sm"},null,-1),Be=d("span",{class:"text-bold text-h6"},"Selecciona el Formato \u{1F60A}",-1),bt={__name:"TarjetaLayout",setup(je){const y=he(),T=ye(),F=[{name:"terminal",label:"TERMINAL",align:"center",field:t=>t.TERMINAL},{name:"ticket",label:"TICKET",align:"center",field:t=>t.TICKET},{name:"cliente",label:"CLIENTE",align:"center",field:t=>t.CLIENTE},{name:"fecha",label:"FECHA",align:"center",field:t=>t.FECHA},{name:"hora",label:"HORA",align:"center",field:t=>t.HORA},{name:"efectivo",label:"EFECTIVO",align:"center",field:t=>t.EFECTIVO},{name:"tarjetas",label:"TARJETAS",align:"center",field:t=>t.TARJETAS},{name:"transferencias",label:"TRANSFERENCIAS",align:"center",field:t=>t.TRANSFERENCIAS},{name:"creditos",label:"CREDITOS",align:"center",field:t=>t.CREDITOS},{name:"vales",label:"VALES",align:"center",field:t=>t.VALES}],W=b({val:null,body:null}),f=b({state:!1,val:null,body:null}),E=b({val:null,filter:null,state:!1,body:null}),I=b(!1),i=b({state:!1,body:null}),L=b(!1),h=b(!1),R=b(null),c=b({state:!1,val:null,opts:[{id:1,label:"Factura"},{id:2,label:"Ticket"}]}),k=()=>{let t=i.value.body.TICKET.split("-"),l={type:"Reimpresion",serie:t[0],folio:t[1],print:f.value.val.ip_address};L.value=!0;let r=`http://${y.session.store.ip}/access/public/modify/newmod`;V.post(r,l).then(u=>{console.log(u),L.value=!1,f.value.val=null,f.value.state=!1}).catch(u=>u)},ee=async()=>{console.log("Recibiendo Datos :)"),I.value=!0;let l=`http://${y.session.store.ip}/access/public/reports/getCash`;V.get(l).then(o=>{W.value.body=o.data.terminales,E.value.body=o.data.formaspagos,console.log(o.data),E.value.state=!0,I.value=!1,console.log("ya lo recibi que no te enganen :)"),te()}).catch(o=>console.log(o))},te=async()=>{let t=y.session.store.id;console.log(t);try{let l=await Ne.get(`/cashier/getPrinters/${t}`);l.status==200&&(f.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),T.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},U=(t,l,o)=>{let r=l!==void 0?l(t,o):t;return r=r==null?"":String(r),r=r.split('"').join('""'),/^\d{1,2}-\d{4}$/.test(r)&&(r=`'${r}`),`"${r}"`},ae=()=>{const t=[F.map(o=>U(o.label))].concat(E.value.body.map(o=>F.map(r=>U(typeof r.field=="function"?r.field(o):o[r.field===void 0?r.name:r.field],r.format,o)).join(","))).join(`\r
`);Oe("reporteCobros.csv",t,"text/csv")!==!0?T.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):T.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},le=()=>{console.log(R.value);let t={filt:R.value};console.log("Recibiendo Datos :)"),I.value=!0;let o=`http://${y.session.store.ip}/access/public/reports/filter`;V.post(o,t).then(r=>{E.value.body=r.data.formaspagos,E.value.state=!0,I.value=!1,h.value=!1,console.log("ya lo recibi que no te enganen :)")}).catch(r=>console.log(r))},oe=(t,l)=>{console.log("aqui se podra reimprimir"),console.log(l.TICKET),i.value.state=!0,i.value.body=l},w=()=>{T.loading.show({message:"Importando Ticket"});let t=y.session.store.ip,l=i.value.body.TICKET;const o=`http://${t}/access/public/modify/getTicket/${l}`;V.get(o).then(r=>{c.value.val.id==1?ne(r.data).then(u=>{T.notify({message:`El ticket ${l} se descargo correctamente`,type:"positive",position:"center"}),c.value.state=!1,c.value.val=null,T.loading.hide()}).catch(u=>{T.notify({message:`El ticket ${l} no se descargo correctamente`,type:"negative",position:"center"})}):c.value.val.id==2&&re(r.data).then(u=>{T.notify({message:`El ticket ${l} se descargo correctamente`,type:"positive",position:"center"}),c.value.state=!1,c.value.val=null,T.loading.hide()}).catch(u=>{T.notify({message:`El ticket ${l} no se descargo correctamente`,type:"negative",position:"center"})})}).catch(r=>console.log(r))},se=(t,l)=>{let o=70;return t.forEach(r=>{o+=7}),o+=10,l.forEach(r=>{o+=4}),o+=41,o},re=t=>new Promise((l,o)=>{try{let r=t.products,u=t.payments,n=se(r,u);console.log(t.products[0].ARTICULO);const e=new Y({format:[80,n]});n=62,e.setFontSize(8),e.text("----------------------------------------------------------------------------",2,10),e.text(t.empresa.CTT1TPV,2,13),e.text(t.empresa.CTT2TPV,2,16),e.text(t.empresa.CTT3TPV,2,19),e.text(t.empresa.CTT4TPV,2,22),e.text(t.empresa.CTT5TPV,2,25),e.text(t.header.TERMINAL,2,34),e.text(`N\xBA ${t.header.TICKET}`,2,37),e.text(`FECHA ${t.header.FECHA}`,20,37),e.text(t.header.HORA,50,37),e.text(`Forma de Pago: ${t.header.PAGOPRINCIPAL}`,2,40),e.text(t.header.NOMBRECLIENTE,2,43),e.text(t.header.DOMICILIO,2,46),e.text(t.header.POBALCION+t.header.CODIGOPOSTAL,2,49),e.text(t.header.PROVINCIA,2,52),e.text("_________________________________________________",2,58),e.text("ARTICULO",2,61),e.text("UD.",25,61),e.text("PRECIO",40,61),e.text("TOTAL",57,61),e.text("_________________________________________________",2,62);let O=0;r.forEach(m=>{e.setFontSize(6),n+=3,e.text(m.ARTICULO+"   "+m.DESCRIPCION.substring(0,47),2,n),n+=4,e.text(Number(m.CANTIDAD).toFixed(2),25,n),e.text(Number(m.PRECIO).toFixed(2),40,n),e.text(Number(m.TOTAL).toFixed(2),57,n),O+=Number(m.CANTIDAD)}),n+=10,e.setFontSize(8),e.setFont("helvetica","bold"),e.text("TOTAL",54,n,"right"),e.text(`$ ${Number(t.header.TOTAL).toFixed(2)}`,56,n,"left"),e.setFont("helvetica","normal"),u.forEach(m=>{n+=4,e.text(m.CONCEPTOPAGO,54,n,"right"),e.text(`$ ${Number(m.IMPORTE).toFixed(2)}`,56,n,"left")}),n+=5,e.text(`N Articulos: ${O}`,2,n),n+=5,e.setFontSize(6),e.text(`Le Atendio: ${t.header.DEPENDIENTE}`,2,n),n+=5,e.setFontSize(8),e.text("---------------------------------Grupo-Vizcarra----------------------------",2,n),n+=5,e.text(t.empresa.PTT1TPV,2,n),n+=3,e.text(t.empresa.PTT2TPV,2,n),n+=3,e.text(t.empresa.PTT3TPV,2,n),n+=3,e.text(t.empresa.PTT4TPV,2,n),n+=3,e.text(t.empresa.PTT5TPV,2,n),n+=3,e.text(t.empresa.PTT6TPV,2,n),n+=3,e.text(t.empresa.PTT7TPV,2,n),n+=3,e.text(t.empresa.PTT8TPV,2,n),e.save(`Ticket ${t.header.TICKET}`),l()}catch(r){o(r)}}),ne=t=>new Promise((l,o)=>{try{let u=t.products,n=t.payments;const e=new Y;let O=[];const m=u.map(P=>Object.values(P)),ie=Math.ceil(m.length/20);for(var r=0;r<m.length;r+=20)O.push(m.slice(r,r+20));console.log(O);for(let P=0;P<1;P++)O.forEach(function(p,M){M>0&&e.addPage();let z=0,H=0;for(let v=0;v<p.length;v++)p[v][1]=p[v][1].replace(/\n/g," "),p[v][2]=parseFloat(p[v][2]),p[v][3]=Number(p[v][3]).toFixed(2),p[v][4]=Number(p[v][4]).toFixed(2),z+=parseFloat(p[v][2]),H+=parseFloat(p[v][4]);e.setFontSize(25),e.setFont("helvetica","bold"),e.text("GRUPO VIZCARRA",105,10,"center"),e.setFontSize(8),e.text("Hora Ticket:",10,10,"left"),e.text(t.header.HORA,10,15,"left"),e.setFontSize(12),e.text(`${t.header.NOMBRECLIENTE} ${t.header.CLIENTE}`,10,25,"left"),e.text(`SUCURSAL ${t.empresa.DESTPV}`,120,25,"left"),e.setFontSize(8),e.text(t.header.DOMICILIO,10,30,"left"),e.text(t.header.CODIGOPOSTAL,10,35,"left"),e.text(t.header.POBALCION+t.header.PROVINCIA,10,40,"left"),e.text(t.empresa.CTT3TPV,120,30,"left"),e.text("LLI1210184G8",120,45,"left"),e.rect(120,51,80,5),e.text("DOCUMENTO",121,55,"left"),e.text("FACTURA",121,60,"left"),e.text("NUMERO",143,55,"left"),e.text(t.header.TICKET,143,60,"left"),e.text("PAGINA",165,55,"left"),e.text(`${M+1} de ${ie}`,165,60,"left"),e.text("FECHA",185,55,"left");const de=t.header.FECHA;e.text(de,185,60,"left"),X(e,{startX:10,startY:65,theme:"grid",styles:{cellPadding:1,fontSize:8,halign:"center"},head:[["CREADOR DOC","ALMACEN","AGENTE","FORMA DE PAGO"]],body:[["APP","GEN",t.header.DEPENDIENTE,n[0].CONCEPTOPAGO]]}),X(e,{startX:10,startY:80,theme:"striped",styles:{cellPadding:.6,fontSize:8,halign:"left"},head:[["ARTICULO","DESCRIPCION","CANTIDAD","PRECIO","TOTAL"]],body:p,columnStyles:{0:{fontStyle:"bold",halign:"left"},1:{fontStyle:"bold",halign:"left"},2:{halign:"center"},3:{halign:"center"},4:{halign:"center"}}}),e.setFontSize(11),e.text("TOTAL UNIDADES:",60,200,"left"),e.text(Number(z).toFixed(2),100,200,"left"),e.setFont("helvetica","bold"),e.text("TOTAL:",140,200,"left"),e.text(`$ ${Number(H).toFixed(2)}`,160,200,"left"),e.setFontSize(8),e.text("Debo(emos) y pagare(mos) incondicionalmente por este pagare a la order de GRUPO VIZCARRA, en la ciudad de Mexico,",5,210,"left"),e.text("la cantidad de el valor recibido a mi(nuestra) entera satisfaccion",5,215,"left"),e.text("Este pagare forma parte de una serie numerica del 1 al y 9 y todos estos estan sujetos a la condicion, de que al no pagarse cualquiera de ellos a su",5,220,"left"),e.text("vencimiento sean exigibles todos los que le sigan en numero, ademas de los ya vencidosm desde la fecha de su vencimiento de el presente documento",5,225,"left"),e.text("hasta el dia de su liquidacion, causaran intereses moratorios al tipo del % mensual en esta ciudad justamente con el principal",5,230,"left"),e.setFontSize(15),e.text("______________",31,248,"center"),e.text("AUTORIZO",20,254,"left"),e.text("______________",85,248,"center"),e.text("CHOFER",75,254,"left"),e.text("______________",140,248,"center"),e.text("RECIBIO",130,254,"left"),e.text("______________",168,248,"left"),e.text("FECHA Y HORA",168,254,"left"),e.setFontSize(9),e.text("UNA VEZ ENTREGADA LA MERCANCIA EN LA FLETERA O DOMICILIO QUE INDIQUE EL CLIENTE ",5,260,"left"),e.text("LLUVIA LIGHT SA DE CV NO ES RESPONSABLE POR PEDIDAS TOTALES, PARCIALES ",5,265,"left"),e.text("O CUALQUIER TIPO DE DANO EN LA MERCANCIA DE ESTE DOCUMENTO ",5,270,"left"),e.setFont("helvetica","bold"),e.setFontSize(12),e.text("NO SE ACEPTAN CAMBIOS NI DEVOLUCIONES",5,275,"left"),e.setFontSize(25),e.setFont("helvetica","bold"),e.text("GRUPO VIZCARRA",105,10,"center")});e.save(`Factura ${t.header.TICKET}`),l()}catch(u){o(u)}});return ee(),(t,l)=>(Q(),ue(ge,{view:"hHh Lpr fFf"},{default:s(()=>[a(_e,{class:"transparent text-dark",bordered:""},{default:s(()=>[a(Ie),a(D),a(me,{class:"justify-between"},{default:s(()=>[d("div",null,[_("Helpers "),a(G,{name:"navigate_next",color:"primary"}),_(),Re])]),_:1})]),_:1}),a(be,null,{default:s(()=>[a(Ae,{padding:""},{default:s(()=>[d("div",Pe,[a(x,{color:"primary",icon:"event",onClick:l[0]||(l[0]=o=>h.value=!h.value),flat:"",round:""})]),a(D,{spaced:"",inset:"",vertical:"",dark:""}),E.value.state?(Q(),B("div",Se,[a(pe,{class:"my-sticky-header-table",title:"Fromas de Pago",rows:E.value.body,"row-key":"name",filter:E.value.filter,separator:"cell",onRowClick:oe,columns:F},{"top-right":s(()=>[d("div",Ve,[d("div",Fe,[a(fe,{borderless:"",dense:"",debounce:"300",modelValue:E.value.filter,"onUpdate:modelValue":l[1]||(l[1]=o=>E.value.filter=o),placeholder:"Search"},{append:s(()=>[a(G,{name:"search"})]),_:1},8,["modelValue"])]),a(D,{spaced:"",inset:"",vertical:"",dark:""}),d("div",Le,[a(x,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:ae})])])]),_:1},8,["rows","filter"])])):j("",!0),a(N,{modelValue:I.value,"onUpdate:modelValue":l[2]||(l[2]=o=>I.value=o),persistent:""},{default:s(()=>[I.value?(Q(),B("div",De,[a(ve,{color:"primary",size:"7.5em"}),a(Te,{offset:[0,8]},{default:s(()=>[_("Cargando Informacion")]),_:1})])):j("",!0)]),_:1},8,["modelValue"]),a(N,{modelValue:i.value.state,"onUpdate:modelValue":l[5]||(l[5]=o=>i.value.state=o),persistent:""},{default:s(()=>[a(S,{style:{width:"700px","max-width":"70vw"}},{default:s(()=>[a(A,{class:"row justify-between"},{default:s(()=>[d("div",Qe,"Ticket : "+C(i.value.body.TICKET),1),d("div",$e,C(i.value.body.TERMINAL),1)]),_:1}),a(A,null,{default:s(()=>[d("div",Ue,C(i.value.body.CNOFAC),1)]),_:1}),a(A,null,{default:s(()=>[d("div",we,C(i.value.body.CLIENTE),1),d("div",Me,C(i.value.body.FECHA),1)]),_:1}),a(A,null,{default:s(()=>[a(Ee,{bordered:""},{default:s(()=>[a(K,null,{default:s(()=>[a(g,null,{default:s(()=>[_("EFECTIVO")]),_:1}),a(g,null,{default:s(()=>[_("TARJETA")]),_:1}),a(g,null,{default:s(()=>[_("TRANSFERENCIA")]),_:1}),a(g,null,{default:s(()=>[_("VALE")]),_:1}),a(g,null,{default:s(()=>[_("CREDITO")]),_:1})]),_:1}),a(K,null,{default:s(()=>[a(g,null,{default:s(()=>[_(C(i.value.body.EFECTIVO),1)]),_:1}),a(g,null,{default:s(()=>[_(C(i.value.body.TARJETAS),1)]),_:1}),a(g,null,{default:s(()=>[_(C(i.value.body.TRANSFERENCIAS),1)]),_:1}),a(g,null,{default:s(()=>[_(C(i.value.body.VALES),1)]),_:1}),a(g,null,{default:s(()=>[_(C(i.value.body.CREDITOS),1)]),_:1})]),_:1})]),_:1})]),_:1}),a($,{align:"center"},{default:s(()=>[q(a(x,{flat:"",color:"negative",icon:"close"},null,512),[[J]]),a(x,{flat:"",color:"primary",icon:"print",onClick:l[3]||(l[3]=o=>f.value.state=!f.value.state)}),a(x,{flat:"",color:"primary",icon:"picture_as_pdf",onClick:l[4]||(l[4]=o=>c.value.state=!w.state)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:f.value.state,"onUpdate:modelValue":l[7]||(l[7]=o=>f.value.state=o)},{default:s(()=>[a(S,{class:"my-card"},{default:s(()=>[a(A,null,{default:s(()=>[ze]),_:1}),a(A,null,{default:s(()=>[a(xe,{onSubmit:k,class:"q-gutter-md"},{default:s(()=>[a(Z,{dense:"","option-label":"name",modelValue:f.value.val,"onUpdate:modelValue":l[6]||(l[6]=o=>f.value.val=o),options:f.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),d("div",null,[a(x,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:f.value.val===null||L.value},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:h.value,"onUpdate:modelValue":l[10]||(l[10]=o=>h.value=o)},{default:s(()=>[a(S,{class:"my-card"},{default:s(()=>[a(A,null,{default:s(()=>[d("div",He,[Ge,a(Ce,{modelValue:R.value,"onUpdate:modelValue":l[8]||(l[8]=o=>R.value=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),a(A,null,{default:s(()=>[a($,{align:"right"},{default:s(()=>[a(x,{flat:"",icon:"close",color:"negative",onClick:l[9]||(l[9]=o=>h.value=!h.value)}),a(x,{flat:"",icon:"check",color:"positive",onClick:le})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:c.value.state,"onUpdate:modelValue":l[12]||(l[12]=o=>c.value.state=o),persistent:""},{default:s(()=>[a(S,null,{default:s(()=>[a(A,{class:"row items-center"},{default:s(()=>[a(ce,{icon:"picture_as_pdf",color:"primary","text-color":"white"}),Be]),_:1}),a(A,null,{default:s(()=>[a(Z,{modelValue:c.value.val,"onUpdate:modelValue":l[11]||(l[11]=o=>c.value.val=o),options:c.value.opts,label:"Formatos",filled:""},null,8,["modelValue","options"])]),_:1}),a($,{align:"right"},{default:s(()=>[q(a(x,{flat:"",label:"Cancel",color:"negative"},null,512),[[J]]),a(x,{flat:"",label:"Seleccionar",color:"positive",onClick:w,disable:!c.value.val},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{bt as default};
