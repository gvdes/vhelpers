import"./axios.b16d05b9.js";const d=(r,t,a)=>{const u=t.category.familia.seccion.id,e=a.find(i=>i._category==u).rules;let l=0,s=0,p=0;if(!e)return!1;let n=r.filter(i=>i.id===t.id).reduce((i,m)=>i+Number(v(m.pivot,m.pieces)),0),c=r.filter(i=>i.category.familia.id===t.category.familia.id).reduce((i,m)=>i+Number(v(m.pivot,m.pieces)),0),o=r.filter(i=>i.category.familia.seccion.id===t.category.familia.seccion.id&&i.id!==t.id).reduce((i,m)=>i+Number(v(m.pivot,m.pieces)),0);r.findIndex(i=>i.id==t.id)>=0?(l=n,s=c,p=o):(l=n+Number(t.pivot.units),s=c+Number(t.pivot.units),p=o+Number(t.pivot.units));for(const i of e)if(i._type===2&&(i.sameModel==1&&l>=i.min&&(!i.max||l<=i.max)||i.sameModel==0&&s>=i.min&&(!i.max||s<=i.max)||i.sameModel==0&&p>=i.min&&(!i.max||s<=i.max)&&i.family==0))return!0;return!1},b=(r,t,a)=>{const u=t.category.familia.seccion.id,e=a.find(i=>i._category==u).rules;let l=0,s=0,p=0;if(!e)return!1;let n=r.filter(i=>i.id===t.id).reduce((i,m)=>i+Number(v(m.pivot,m.pieces)),0),c=r.filter(i=>i.category.familia.id===t.category.familia.id).reduce((i,m)=>i+Number(v(m.pivot,m.pieces)),0),o=r.filter(i=>i.category.familia.seccion.id===t.category.familia.seccion.id&&i.id!==t.id).reduce((i,m)=>i+Number(v(m.pivot,m.pieces)),0);r.findIndex(i=>i.id==t.id)>=0?(l=n,s=c,p=o):(l=n+Number(t.pivot.units),s=c+Number(t.pivot.units),p=o+Number(t.pivot.units));for(const i of e)if(i._type===3&&(i.sameModel==1&&l>=i.min&&(!i.max||l<=i.max)||i.sameModel==0&&s>=i.min&&(!i.max||s<=i.max)||i.sameModel==0&&p>=i.min&&(!i.max||s<=i.max)&&i.family==0))return!0;return!1},_=(r,t)=>{let a=0;return a=r.filter(e=>e.id===t.id).reduce((e,l)=>e+Number(v(l.pivot,l.pieces)),0)+Number(t.pivot.units),a>=t.pieces},N=async(r,t,a)=>{const u=[];for(const e of r){const l=e.pivot._supply_by==3?e.pivot.amount*e.pieces:e.pivot._supply_by==2?e.pivot.amount*12:e.pivot.amount;let s=0;t.client._price_list<=3?_(r,e)?s=4:b(r,e,a)?s=3:d(r,e,a)?s=2:s=1:s=t.client._price_list;const p=e.prices.find(n=>n.id==s);if(p){const n=e.pivot.price,c=e.pivot._price_list,o=p.pivot.price;(n!==o||c!==s)&&(e.pivot._price_list=s,e.pivot.price=o,e.pivot.total=l*o,u.push({_order:e.pivot._order,_product:e.id,_price_list:s,price:o,total:l*o}))}}},g=async(r,t,a)=>{const u=[];for(const e of r){const l=e.pivot.units;let s=0;t<=3?_(r,e)?s=4:b(r,e,a)?s=3:d(r,e,a)?s=2:s=1:s=t,console.log(s);const p=e.prices.find(n=>n.id==s);if(p){const n=e.pivot.price,c=e.pivot._price_list,o=p.pivot.price;(n!==o||c!==s)&&(e.pivot._price_list=s,e.pivot.price=o,e.pivot.total=l*o,u.push({_product:e.id,_price_list:s,price:o,total:l*o}))}}},v=(r,t)=>r.units,P=(r,t)=>{t.forEach(a=>{a.type==="NXM"?x(r,a):a.type==="COM"?M(r,a):a.type==="BLOCK"&&h(r,a)})},x=(r,t)=>{const a=t.products.map(n=>n._product),u=r.filter(n=>a.includes(n.id));if(!u.length)return;u.forEach(n=>{const c=Number(n.pivot.units),o=Number(n.pivot.price);n.pivot.subtotal=c*o,n.pivot.promo_units=0,n.pivot.promo_discount=0,n.pivot.total=n.pivot.subtotal});const e=u.reduce((n,c)=>n+Number(c.pivot.units),0),s=Math.floor(e/t.buy)*(t.buy-t.pay);if(s<=0)return;let p=s;for(const n of u){if(p<=0)break;const c=Number(n.pivot.units),o=Number(n.pivot.price),f=Math.min(c,p);f<=0||(n.pivot.promo_units+=f,n.pivot.promo_discount+=f*o,n.pivot.total-=f*o,p-=f)}},M=(r,t)=>{const a=t.products.map(c=>c._product),u=r.filter(c=>a.includes(c.id));if(u.length!==a.length)return;u.forEach(c=>{const o=Number(c.pivot.units),f=Number(c.pivot.price);c.pivot.subtotal=o*f,c.pivot.promo_units=0,c.pivot.promo_discount=0,c.pivot.total=c.pivot.subtotal});const e=Math.min(...u.map(c=>Number(c.pivot.units)));if(e<=0)return;const l=t.buy-t.pay;let s=e*l;const p=u.reduce((c,o)=>o.id>c.id?o:c),n=Number(p.pivot.price);p.pivot.promo_units=s,p.pivot.promo_discount=s*n,p.pivot.total-=s*n},h=(r,t)=>{const a=t.products.map(o=>o._product),u=r.filter(o=>a.includes(o.id));if(!u.length)return;u.forEach(o=>{const f=Number(o.pivot.units),i=Number(o.pivot.price);o.pivot.subtotal=f*i,o.pivot.promo_units=0,o.pivot.promo_discount=0,o.pivot.total=o.pivot.subtotal});const e=u.reduce((o,f)=>o+Number(f.pivot.units),0);if(e<t.buy)return;const l=Math.floor(e/t.buy),p=t.buy*Number(u[0].pivot.price)-t.block_price,n=l*p;let c=l*t.buy;for(const o of u){if(c<=0)break;const f=Number(o.pivot.units);Number(o.pivot.price);const i=Math.min(f,c),m=i/(l*t.buy),y=n*m;o.pivot.promo_units+=i,o.pivot.promo_discount+=y,o.pivot.total-=y,c-=i}};var B={verificarPrecioMayoreo:d,verificarPrecioDocena:b,actualizarPreciosProductos:N,actualizarPreciosProductosSales:g,verificarPrecioCaja:_,aplicarPromociones:P};export{B as R};
