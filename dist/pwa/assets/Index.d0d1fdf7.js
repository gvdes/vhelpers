import{u as F,r as m,c as N,o as D,g as S,e,w as l,i as s,a4 as f,Y as A,b1 as J,aE as K,Q as g,f as V,aW as L,a3 as B,a2 as M,a1 as q,a as U,h as E,aX as T}from"./index.6b919260.js";import{Q as k,a as v}from"./QCard.8fb4f9b5.js";import{Q as r}from"./QSeparator.d085a7d5.js";import{Q as H}from"./QSlideTransition.8c2f3460.js";import{Q as Z}from"./QPage.8dbc82ef.js";import{Q as j}from"./QInput.915469e0.js";import{Q as O,b as ee}from"./QSelect.8ec1d6fa.js";import{Q as z}from"./QCardActions.657489ad.js";import{Q as G}from"./QDialog.426be046.js";import{u as W}from"./VDB.67686440.js";import{u as X}from"./use-quasar.cf091104.js";import"./jspdf.plugin.autotable.e02077b2.js";import{r as I}from"./refundsApi.3835e941.js";import"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{d as Q}from"./dayjs.min.25545ff6.js";import{Q as te}from"./QDate.e368d8f9.js";import{Q as se}from"./QTable.afd27c73.js";import{C as oe}from"./ClosePopup.b39444cf.js";import{p as le}from"./Refund.ba7848ca.js";import"./use-key-composition.abdd2bcc.js";import"./uid.42677368.js";import"./QItemSection.b320ee72.js";import"./position-engine.a0970efb.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.76bdd693.js";import"./axios.f1f32898.js";import"./use-cache.b0833c75.js";import"./date.b1069da3.js";import"./QList.c1754208.js";import"./QLinearProgress.bdaaec4d.js";import"./QCheckbox.b0154d03.js";const ae={class:"text-bold text-centerz"},ie={class:"row"},ne=["onClick"],re={class:"col"},de=s("div",{class:"text-caption"},"ID",-1),ue={class:"text-bold"},ce={class:"col"},ve=s("div",{class:"text-caption"},"Referencia",-1),fe={class:"text-bold"},me={class:"col"},pe=s("div",{class:"text-caption"},"Referencia",-1),_e={class:"text-bold"},ye={class:"col"},xe=s("div",{class:"text-caption"},"Origen",-1),be={class:"text-bold"},ge={class:"col"},we=s("div",{class:"text-caption"},"Destino",-1),he={class:"text-bold"},Ve={class:"col"},ke=s("div",{class:"text-caption"},"Tipo",-1),De={class:"text-bold"},Qe=s("div",{class:"text-caption"},"Estado",-1),Ce={class:"text-bold"},$e=s("div",{class:"text-caption"},"Creado Por",-1),Re={class:"text-bold"},Ye={class:"col"},Ee=s("div",{class:"text-caption"},"Devolucion",-1),Ne={class:"text-bold"},Se={class:"col"},Ae={class:"text-caption"},Be={class:"text-bold"},P={__name:"ViewRefunds",props:{refunds:{type:Array,default:[]},status:{type:Array,default:[]}},setup(C){const w=C,d=F(),p=W(),b=X(),u=m(null),c=m(null),_=m({state:!1,val:null}),x=m({columns:[{name:"id",label:"ID",field:t=>t.id},{name:"reference",label:"REFERENCIA",field:t=>t.reference},{name:"destiny",label:"DESTINO",field:t=>t.storefrom.name},{name:"origin",label:"ORIGEN",field:t=>t.storeto.name},{name:"createby",label:"CREADO POR",field:t=>t.createdby.complete_name},{name:"date",label:"FECHA",field:t=>Q(t.created_at).format("DD-MM-YYYY HH:mm:ss")},{name:"status",label:"Estado",field:t=>t.status}],filter:""}),h=N(()=>u.value&&!c.value?w.refunds.filter(t=>t.status.id==u.value.id):!u.value&&c.value?w.refunds.filter(t=>Q(t.created_at).format("YYYY/MM/DD")==c.value):u.value&&c.value?w.refunds.filter(t=>Q(t.created_at).format("YYYY/MM/DD")==c.value&&t.status.id==u.value.id):w.refunds),i=t=>{switch(t){case 1:return"red";case 2:return"yellow";case 3:return"blue";case 4:return"green"}},$=t=>{t.status.id==1&&t.storefrom.id==p.session.store.id?(console.log("terminar el que se esta creando"),d.push(`/refunds/${t.id}`)):t.status.id==1&&t.storeto.id==p.session.store.id?b.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storefrom.id==p.session.store.id?b.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):t.status.id==2&&t.storeto.id==p.session.store.id?(console.log("se va a recibir"),_.value.state=!0,_.value.val=t):t.status.id==4&&b.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"})},R=async t=>{b.loading.show({message:"Cambiando Estado"});let n={id:t.id,uid:p.session.id};const o=await I.nexState(n);o.fail?console.log(o):(d.push(`/refunds/verified/${t.id}`),b.loading.hide())},Y=t=>{console.log(t),le.refund(t)};return(t,n)=>(D(),S(q,null,[e(se,{rows:V(h),grid:"",columns:x.value.columns,filter:x.value.filter},{"top-left":l(()=>[s("div",ae,f(c.value),1)]),"top-right":l(()=>[s("div",ie,[e(j,{class:"col",filled:"",dense:"",modelValue:x.value.filter,"onUpdate:modelValue":n[0]||(n[0]=o=>x.value.filter=o),placeholder:"Buscar"},{append:l(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{class:"col",modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=o=>u.value=o),options:C.status,label:"Estado",dense:"",filled:"","option-label":"name"},J({_:2},[u.value?{name:"append",fn:l(()=>[e(A,{name:"cancel",onClick:n[1]||(n[1]=K(o=>u.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{color:"primary",flat:"",icon:"event"},{default:l(()=>[e(ee,null,{default:l(()=>[e(te,{modelValue:c.value,"onUpdate:modelValue":n[3]||(n[3]=o=>c.value=o),landscape:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})])]),item:l(o=>[s("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:a=>$(o.row)},[e(k,{bordered:"",class:"text-center my-card"},{default:l(()=>[e(v,{class:"row",dense:""},{default:l(()=>[s("div",re,[de,s("div",ue,f(o.row.id),1)]),e(r,{vertical:""}),s("div",ce,[ve,s("div",fe,f(o.row.reference),1)]),e(r,{vertical:""}),s("div",me,[pe,s("div",_e,f(V(Q)(o.row.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:2},1024),e(r),e(v,{class:"row"},{default:l(()=>[s("div",ye,[xe,s("div",be,f(o.row.storefrom.name),1)]),e(r,{vertical:""}),s("div",ge,[we,s("div",he,f(o.row.storeto.name),1)])]),_:2},1024),e(r),e(v,{class:"row"},{default:l(()=>[s("div",Ve,[ke,s("div",De,f(o.row.type.name),1)]),e(r,{vertical:""}),s("div",{class:L(`col bg-${i(o.row.status.id)}`)},[Qe,s("div",Ce,f(o.row.status.name),1)],2)]),_:2},1024),e(r),e(v,null,{default:l(()=>[$e,s("div",Re,f(o.row.createdby.complete_name),1)]),_:2},1024),e(v,{class:"row",onClick:a=>Y(o.row)},{default:l(()=>[s("div",Ye,[Ee,s("div",Ne,f(o.row.fs_id),1)]),e(r,{vertical:""}),s("div",Se,[s("div",Ae,f(o.row._type==1?"ABONO":"ENTRADA"),1),s("div",Be,f(o.row._type==1?o.row.season_ticket:o.row.entry),1)])]),_:2},1032,["onClick"])]),_:2},1024)],8,ne)]),_:1},8,["rows","columns","filter"]),e(G,{modelValue:_.value.state,"onUpdate:modelValue":n[5]||(n[5]=o=>_.value.state=o),persistent:""},{default:l(()=>[e(k,null,{default:l(()=>[e(v,{class:"text-center text-bold text-h5"},{default:l(()=>[B(" Quires recepcionar la devolucion ? ")]),_:1}),e(z,{align:"right"},{default:l(()=>[M(e(g,{flat:"",label:"Cancelar",color:"negative"},null,512),[[oe]]),e(g,{flat:"",label:"Recibir",color:"positive",onClick:n[4]||(n[4]=o=>R(_.value.val))})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Me={class:"row justify-between"},Oe=s("span",{class:"text-h6"},"Devoluciones ",-1),Ie={class:"row"},Ue={key:0},Te={class:"row"},He=s("div",{class:"col"},"Destino",-1),Pe={class:"row"},Fe=s("div",{class:"col"},"Origen",-1),qe=s("span",{class:"text-center text-h6 text-bold"},"Nueva Devolucion",-1),kt={__name:"Index",setup(C){const w=F(),d=W(),p=X(),b=m([]),u=m([]),c=m([]),_=m(null),x=m(!1),h=m(!1),i=m({state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:d.session.store.id,store_to:null,_created_by:d.session.id}),$=N(()=>i.value.type?i.value.type.id==1?c.value.filter(o=>o._type==1):c.value.filter(o=>o._type==2):c.value),R=N(()=>!(i.value.reference&&i.value.type&&i.value.provider)),Y=async()=>{p.loading.show({message:"Obteniendo Datos",type:"positive",position:"center"});let o=d.session.store.id;const a=await I.index(o);a.error?console.log(a):(console.log(a),b.value=a.types,c.value=a.provider,_.value=a.refunds,u.value=a.status,p.loading.hide())},t=async()=>{i.value={state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:d.session.store.id,store_to:null,_created_by:d.session.id}},n=async()=>{i.value.store_to=i.value.provider._store,console.log(i.value);const o=await I.addRefund(i.value);o.error?console.log(o):(console.log(o),p.notify({message:"Se creo correctamente la devolucion",type:"positive",position:"center"}),w.push(`/refunds/${o.id}`))};return d.session.rol=="aux"||d.session.rol=="gen"||d.session.rol=="aud"||d.session.rol=="root"?Y():(p.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),w.replace("/")),(o,a)=>(D(),S(q,null,[e(Z,{padding:""},{default:l(()=>[e(k,null,{default:l(()=>[e(v,null,{default:l(()=>[s("div",Me,[s("div",null,[B("Helpers "),e(A,{name:"navigate_next",color:"primary"}),B(),Oe]),s("div",Ie,[V(d).session.store.id!=1?(D(),U(g,{key:0,color:"primary",icon:"add",flat:"",onClick:a[0]||(a[0]=y=>i.value.state=!i.value.state)})):E("",!0)])])]),_:1})]),_:1}),e(r,{spaced:"",inset:"",vertical:"",dark:""}),_.value?(D(),S("div",Ue,[e(k,{class:"my-card"},{default:l(()=>[e(v,{class:"text-center text-bold text-h6"},{default:l(()=>[s("div",Te,[He,e(g,{color:"grey",round:"",flat:"",dense:"",icon:x.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:a[1]||(a[1]=y=>x.value=!x.value)},null,8,["icon"])])]),_:1}),e(v,null,{default:l(()=>[e(H,null,{default:l(()=>[M(s("div",null,[e(P,{refunds:_.value.to,status:u.value},null,8,["refunds","status"])],512),[[T,x.value]])]),_:1})]),_:1})]),_:1}),e(r,{spaced:"",inset:"",vertical:"",dark:""}),V(d).session.store.id!=1?(D(),U(k,{key:0,class:"my-card"},{default:l(()=>[e(v,{class:"text-center text-bold text-h6"},{default:l(()=>[s("div",Pe,[Fe,e(g,{color:"grey",round:"",flat:"",dense:"",icon:h.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:a[2]||(a[2]=y=>h.value=!h.value)},null,8,["icon"])])]),_:1}),e(v,null,{default:l(()=>[e(H,null,{default:l(()=>[M(s("div",null,[e(P,{refunds:_.value.from,status:u.value},null,8,["refunds","status"])],512),[[T,h.value]])]),_:1})]),_:1})]),_:1})):E("",!0)])):E("",!0)]),_:1}),e(G,{modelValue:i.value.state,"onUpdate:modelValue":a[7]||(a[7]=y=>i.value.state=y),persistent:""},{default:l(()=>[e(k,null,{default:l(()=>[e(v,null,{default:l(()=>[qe]),_:1}),e(v,null,{default:l(()=>[e(j,{modelValue:i.value.reference,"onUpdate:modelValue":a[3]||(a[3]=y=>i.value.reference=y),type:"text",label:"Referencia",filled:"",dense:""},null,8,["modelValue"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:i.value.type,"onUpdate:modelValue":[a[4]||(a[4]=y=>i.value.type=y),a[5]||(a[5]=()=>i.value.provider=null)],options:b.value,label:"Tipo",filled:"",dense:"","option-label":"name"},null,8,["modelValue","options"]),e(r,{spaced:"",inset:"",vertical:"",dark:""}),e(O,{modelValue:i.value.provider,"onUpdate:modelValue":a[6]||(a[6]=y=>i.value.provider=y),options:V($),label:"Destino",filled:"",dense:"",disable:i.value.type==null,"option-label":"name"},null,8,["modelValue","options","disable"]),e(r,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(z,{align:"right"},{default:l(()=>[e(g,{flat:"",label:"Cancel",color:"primary",onClick:t}),e(g,{flat:"",label:"Enviar",color:"primary",onClick:n,disable:V(R)},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{kt as default};
