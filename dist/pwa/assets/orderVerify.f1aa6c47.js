import{u as ae,a as le,aI as oe,r as f,c as se,p as ie,m as ne,o as k,d as P,w as s,h as Q,e as a,f as i,a0 as x,Q as v,a1 as re,a4 as h,al as T}from"./index.e74f744c.js";import{b as g,Q as V}from"./QList.bf2ca64e.js";import{Q as m}from"./QCardSection.3a5b15bd.js";import{Q as w}from"./QCard.726ff719.js";import{Q as U}from"./QTable.dd6ed05e.js";import{Q as q}from"./QInput.d4cf9b9a.js";import{Q as B}from"./QCardActions.2124a3dd.js";import{Q as E}from"./QForm.69b98e45.js";import{Q as de}from"./QFooter.8556ff60.js";import{Q as ue}from"./QPage.3d276047.js";import{C as N}from"./ClosePopup.82bddfb2.js";import"./axios.952f42b7.js";import{u as ce}from"./use-quasar.da86dd6a.js";import{P as ve}from"./ProductsAutocomplete.52d19ad6.js";import{_ as pe}from"./productView.2ff412b3.js";import{d as fe}from"./dayjs.min.cbcf888d.js";import{R as F}from"./resoursesOrder.1aae7d6e.js";import{o as y}from"./orderApi.7e560072.js";import"./use-key-composition.8f0344f2.js";import"./QSelect.d601643f.js";import"./QLinearProgress.a4f3b7d6.js";import"./QCheckbox.b7319d3b.js";import"./use-checkbox.04130c60.js";import"./QResizeObserver.c2d55b44.js";/* empty css                                                                         */import"./QSpace.23338568.js";import"./_commonjsHelpers.88e99c8f.js";const me={class:"col"},ge={class:"text-center text-h6"},ye={class:"col"},be={class:"col"},xe={class:"text-center text-h6"},we={class:"col"},Ce={class:"text-center text-h6"},_e={class:"col"},Ve={class:"text-center text-h6"},De={class:"col"},ke={class:"text-center text-h6"},et={__name:"orderVerify",setup(Pe){const $=ae(),u=ce(),I=le(),L=oe(),l=f(null),c=f({state:!1,val:null}),C=f(!1),d=f({state:!1,val:null,opts:[]}),n=f({state:!1,val:null,edit:!1}),S=f({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),_=f([]),A=f({columns:[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},{name:"amount",label:"Pedido",field:t=>t.pivot.units,align:"center"},{name:"verify",label:"Verificado",field:t=>t.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:t=>t.pivot.price,align:"center"},{name:"total",label:"Total",field:t=>t.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),O=f({columns:[{name:"id",label:"Codigo",field:t=>t.id,align:"left"},{name:"Nombre",label:"Descripcion",field:t=>t.name,align:"left"},{name:"Telefono",label:"Pedido",field:t=>t.celphone,align:"center"}],pagination:{rowsPerPage:0}}),Y=se(()=>l.value.products.every(t=>t.pivot.amountDelivered||t.pivot.amountDelivered>0)),j=async()=>{let t=L.params.ord;const e=await y.getOrderVerify(t);e.fail?e.fail.status==401?(u.notify({message:e.fail.response.data,position:"center",type:"negative"}),I.push("/verifyOrder")):console.log(e):(console.log(e),l.value=e.order,_.value=e.rules)},K=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0?(n.value.val=l.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=S.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},M=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0?(n.value.val=l.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=S.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},z=(t,e)=>{console.log(e),n.value.val=e,n.value.edit=!0,n.value.state=!0},D=()=>{n.value={state:!1,val:null,edit:!1}},G=t=>{l.value.products.push(t),D()},H=t=>{let e=l.value.products.findIndex(o=>o.id==t.id);e>=0&&(l.value.products.splice(e,1),D())},J=async()=>{if(d.value.val){const t=await y.getClient(d.value);t.fail?console.log(t):t.length>0?(console.log(t),d.value.opts=t):u.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else u.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},W=async(t,e)=>{u.loading.show({message:"Recalculando Ticket"});let o={order:l.value.id,client:e.id};const r=await y.changeClientOrder(o);r.fail?console.log(r):(l.value.client=e,F.actualizarPreciosProductos(l.value.products,l.value,_.value),d.value={state:!1,val:null,opts:[]},u.loading.hide())},X=()=>{console.log("cambio de cliente"),d.value.state=!0},R=t=>{t.ctrlKey&&t.key.toLowerCase()==="b"?(t.preventDefault(),d.value.state||(d.value.state=!0)):t.ctrlKey&&t.key.toLowerCase()==="p"&&(t.preventDefault(),c.value.state||(c.value.state=!0))},Z=async()=>{u.loading.show({message:"Terminando Verificacion"});let t={uid:$.session.credentials.staff.id_va,oid:l.value.id};const e=await y.nextState(t);e.fail?console.log(e):(console.log(e),u.notify({message:"El pedido ya esta en Caja",position:"center",type:"positive",icon:"check"}),u.loading.hide(),I.push("/verifyOrder"))},ee=async()=>{if(c.value.val){let t={uid:$.session.credentials.staff.id_va,oid:l.value.id};const e=await y.getOrderAdd(c.value.val,t);console.log(e),e.fail?e.fail.status==401?u.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):e.fail.status==404?u.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):console.log(e):e?(console.log(e),te(l.value.products,e.products).then(o=>l.value.products=o),F.actualizarPreciosProductos(l.value.products,l.value,_.value),c.value={state:!1,val:null}):u.notify({message:"No hay ningun pedido con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"})}else u.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},te=async(t,e)=>{const o=[...t];for(const r of e){const b=o.find(p=>p.id===r.id);if(b){b.pivot.units+=r.pivot.units,b.pivot.toDelivered=0,b.pivot.amountDelivered=0;const p=await y.editProduct(b.pivot);console.log(b),p.fail?console.log("Edit failed:",p):console.log("Edited:",p)}else{r.pivot._order=l.value.id,r.pivot.toDelivered=0,r.pivot.amountDelivered=0;const p=await y.addProduct(r.pivot);p.fail?console.log("Add failed:",p):(console.log("Added:",p),o.push(r))}}return o};return ie(()=>{j(),window.addEventListener("keydown",R)}),ne(()=>{window.removeEventListener("keydown",R)}),(t,e)=>l.value?(k(),P(ue,{key:0,padding:""},{default:s(()=>[a(w,{class:"my-card"},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[i("div",me,[e[8]||(e[8]=i("div",{class:"text-caption text-center"},"Dependiente",-1)),i("div",ge,x(`${l.value.created_by.names} ${l.value.created_by.surname_pat}
            ${l.value.created_by.surname_mat}`),1)]),i("div",ye,[e[9]||(e[9]=i("div",{class:"text-caption text-center"},"Cliente",-1)),a(v,{class:"full-width",flat:"",label:l.value.client.name,onClick:X},null,8,["label"])]),i("div",be,[e[10]||(e[10]=i("div",{class:"text-caption text-center"},"Fecha",-1)),i("div",xe,x(re(fe)(l.value.created_at).format("YYYY-MM-DD")),1)]),a(v,{color:"primary",flat:""}),a(g,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(w,{class:"my-card"},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[i("div",we,[e[11]||(e[11]=i("div",{class:"text-caption text-center"},"Orden",-1)),i("div",Ce,x(l.value.id),1)]),i("div",_e,[e[12]||(e[12]=i("div",{class:"text-caption text-center"},"Total",-1)),i("div",Ve,"$ "+x(Number(l.value.products.reduce((o,r)=>o+r.pivot.total,0)).toFixed(2)),1)]),i("div",De,[e[13]||(e[13]=i("div",{class:"text-caption text-center"},"Cantidad",-1)),i("div",ke,x(l.value.products.reduce((o,r)=>o+Number(r.pivot.toDelivered),0)),1)]),a(v,{color:"primary",flat:"",icon:"add",onClick:e[0]||(e[0]=o=>c.value.state=!c.value.state)}),a(g,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(g,{spaced:"",inset:"",vertical:"",dark:""}),a(U,{rows:l.value.products,columns:A.value.columns,"hide-bottom":"",pagination:A.value.pagination,onRowClick:z},null,8,["rows","columns","pagination"]),a(V,{modelValue:n.value.state,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.state=o),persistent:"",position:"bottom"},{default:s(()=>[a(pe,{product:n.value.val,order:l.value,edit:n.value.edit,onReset:D,products:l.value.products,rules:_.value,onAddProduct:G,onDeleteProduct:H},null,8,["product","order","edit","products","rules"])]),_:1},8,["modelValue"]),a(V,{modelValue:d.value.state,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.state=o),persistent:""},{default:s(()=>[a(w,{style:{width:"700px"}},{default:s(()=>[a(E,{onSubmit:J},{default:s(()=>[e[14]||(e[14]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),e[15]||(e[15]=i("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),a(m,null,{default:s(()=>[a(g,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[a(q,{autofocus:"",modelValue:d.value.val,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.val=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),d.value.opts.length>0?(k(),P(m,{key:0},{default:s(()=>[a(U,{rows:d.value.opts,columns:O.value.columns,pagination:O.value.pagination,onRowClick:W},null,8,["rows","columns","pagination"])]),_:1})):Q("",!0),a(B,{align:"right"},{default:s(()=>[h(a(v,{flat:"",label:"Cancelar",color:"primary"},null,512),[[N]]),a(v,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=o=>C.value=o),persistent:""},{default:s(()=>[a(w,null,{default:s(()=>[a(m,{class:"text-center text-bold text-h6"},{default:s(()=>[T(" Orden "+x(l.value.id),1)]),_:1}),a(m,null,{default:s(()=>e[16]||(e[16]=[T(" El pedido se ira directo a caja, "),i("span",{class:"text-bold"}," Deseas Continuar?",-1)])),_:1}),a(B,{align:"right"},{default:s(()=>[h(a(v,{flat:"",icon:"close",color:"negative"},null,512),[[N]]),a(v,{flat:"",icon:"send",color:"positive",onClick:Z})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:c.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>c.value.state=o),persistent:""},{default:s(()=>[a(w,{style:{width:"300px"}},{default:s(()=>[a(E,{onSubmit:ee},{default:s(()=>[e[17]||(e[17]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Comanda",-1)),e[18]||(e[18]=i("div",{class:"text-center text-bold text-caption"},"Busca ID de commanda",-1)),a(m,null,{default:s(()=>[a(g,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[a(q,{autofocus:"",modelValue:c.value.val,"onUpdate:modelValue":e[5]||(e[5]=o=>c.value.val=o),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),a(B,{align:"right"},{default:s(()=>[h(a(v,{flat:"",label:"Cancel",color:"primary"},null,512),[[N]]),a(v,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(de,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:s(()=>[a(w,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[a(m,{class:"row"},{default:s(()=>[a(ve,{class:"col",checkState:!1,onInput:M,onAgregar:K}),Y.value?(k(),P(v,{key:0,color:"primary",flat:"",icon:"east",onClick:e[7]||(e[7]=o=>C.value=!C.value),round:""})):Q("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):Q("",!0)}};export{et as default};
