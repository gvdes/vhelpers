import{Q as C}from"./QSeparator.ec2b083e.js";import{r as y,c as A,o as b,a as S,w as o,aD as L,u as P,aV as M,e,i as d,Y as T,Q as h,a4 as v,a3 as m,a2 as D,aX as N,g as V,a1 as U,a0 as q,h as H,f as K,a6 as O}from"./index.55203867.js";import{Q as J}from"./QToolbar.7deb1e7d.js";import{Q as W}from"./QHeader.b84436b2.js";import{Q as z}from"./QInput.f8723620.js";import{a as x,b as f,c as X}from"./QSelect.db37b910.js";import{Q as G}from"./auto.df2a9770.js";import{Q as Z}from"./QList.30127cde.js";import{Q as ee}from"./QTable.7a03e92b.js";import{Q as ae}from"./QDate.4dbc7483.js";import{u as oe,Q as te,a as R}from"./use-quasar.73cedc4a.js";import{Q as le}from"./QCardActions.52e78da3.js";import{Q as se}from"./QDialog.a43b8688.js";import{Q as re,a as ne}from"./QLayout.9d4a4862.js";import"./AppFullscreen.a5629344.js";import{d as Q}from"./dayjs.min.25545ff6.js";import{E as ie}from"./exceljs.min.9e24d01d.js";import{E as ce}from"./jspdf.plugin.autotable.41e193bc.js";import{_ as de}from"./UserToolbar.6704bbbf.js";import{a as ue}from"./assistApi.5aba79bc.js";import{u as me}from"./VDB.0b30abeb.js";import{a as fe}from"./axios.f1f32898.js";import"./QResizeObserver.988d326c.js";import"./use-key-composition.ae250c18.js";import"./uid.42677368.js";import"./position-engine.946b97ba.js";import"./rtl.b51694b1.js";import"./QLinearProgress.17ad83cf.js";import"./QCheckbox.6a86d86f.js";import"./use-cache.b0833c75.js";import"./date.16a9c4f8.js";import"./_commonjsHelpers.88e99c8f.js";import"./ClosePopup.f9fcfddc.js";import"./axios.ae0a941c.js";const pe=d("span",{class:"text-grey"},"Helpers",-1),ge=d("span",{class:"text-h6"},"Cajas Abiertas",-1),he={class:"row"},_e={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition"},ve={class:"text-bold"},we={class:"text-overline"},ye={key:0,class:""},be={class:"q-pa-md"},Ce=d("div",{class:"q-pb-sm"},null,-1),sa={__name:"OpneBoxesLYT",setup(xe){const i=oe();L();const Y=P(),k=me(),u=y(!1),_=y(null),p=y([]),w=y({pagination:{rowsPerPage:0},filter:""});A(()=>i.platform.is.mobile);const $=async()=>{i.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const r=await ue.index();if(r.error)console.log(r);else{console.log(r),p.value=r;let t=new Date,s=Q(t).format("YYYY/MM/DD");_.value=s,console.log(s),E(p.value,_.value).finally(()=>{i.loading.hide()})}},E=async(r,t)=>{console.log(t);const s=r.map((a,l)=>new Promise((c,n)=>{setTimeout(()=>{a.sale=null;let j=`http://${a.ip_address}/access/public/reports/OpenCash`;fe.post(j,{filt:t}).then(g=>{a.sales=g.data||null,console.log(g.data),console.log(`Sucursal ${a.name} procesada con \xE9xito.`),c({success:!0,data:g.data})}).catch(g=>{console.log(`Error en sucursal ${a.name}: ${g.message}`),a.sales=[],i.notify({message:`Sucursal ${a.name} no tiene conexion`,type:"negative",position:"center"}),c({success:!1,error:g.message})})},l*1e3)}));try{await Promise.all(s)}catch(a){console.error("Error en alguna de las solicitudes:",a)}};k.session.rol==="adm"||k.session.rol==="root"?$():(i.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),Y.replace("/"));const F=()=>{u.value=!1,i.loading.show({message:"Obteniendo Datos"}),E(p.value,_.value).finally(()=>{i.loading.hide()})},I=()=>new Promise((r,t)=>{try{let s=[];p.value.forEach((l,c)=>{s.push([{content:l.name,colSpan:3,styles:{halign:"center",fillColor:[173,216,230],fontStyle:"bold"}}]),l.sales.forEach(n=>{s.push([Q(n.FECFAC).format("YYYY-MM-DD"),n.DESTER,n.TICKETS])})});const a=new ce({format:"letter"});a.autoTable({head:[["Fecha","Caja","Tickets"]],body:s}),a.save("Reporte de Cajas"),r()}catch(s){t(s)}}),B=()=>{i.loading.show({message:"Importando Ticket"});const r=new ie.Workbook,t=r.addWorksheet("Comparativo");t.columns=[{header:"Fecha",key:"FECFAC",width:20},{header:"Destino",key:"DESTER",width:30},{header:"Tickets",key:"TICKETS",width:10}],p.value.forEach(a=>{const l=t.addRow([a.name]);l.font={bold:!0},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ADD8E6"}},l.alignment={horizontal:"center"},a.sales.forEach(c=>{t.addRow(c)}),t.addRow([])}),(async()=>{const a=await r.xlsx.writeBuffer(),l=new Blob([a],{type:"application/octet-stream"}),c=URL.createObjectURL(l),n=document.createElement("a");n.href=c,n.download="ReporteCajas.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)})(),i.loading.hide()};return(r,t)=>{const s=M("router-view");return b(),S(re,{view:"hHh Lpr fFf"},{default:o(()=>[e(ne,null,{default:o(()=>[e(W,{class:"bg-grey-3 text-dark",bordered:""},{default:o(()=>[e(de),e(C),e(J,{class:"justify-between"},{default:o(()=>[d("div",null,[pe,e(T,{name:"navigate_next",color:"primary"}),ge]),d("div",he,[e(h,{color:"primary",icon:"event",onClick:t[0]||(t[0]=a=>u.value=!u.value),flat:"",round:""}),e(h,{color:"primary",icon:"download",onClick:I,flat:"",round:""}),e(h,{color:"primary",icon:"calculate",onClick:B,flat:"",round:""})])]),_:1})]),_:1}),e(ee,{title:"Sucursales",rows:p.value,"hide-header":"",pagination:w.value.pagination,filter:w.value.filter},{"top-right":o(()=>[e(z,{borderless:"",dense:"",debounce:"300",modelValue:w.value.filter,"onUpdate:modelValue":t[1]||(t[1]=a=>w.value.filter=a),placeholder:"Buscar"},{append:o(()=>[e(T,{name:"search"})]),_:1},8,["modelValue"])]),body:o(a=>[d("div",_e,[e(Z,{bordered:"",dense:""},{default:o(()=>[e(x,null,{default:o(()=>[e(f,null,{default:o(()=>[e(X,{class:"flex justify-between"},{default:o(()=>{var l;return[d("div",ve,v(a.row.name),1),d("div",we,[m(v((l=a.row.sales)==null?void 0:l.length)+" ",1),e(h,{color:"grey",flat:"",dense:"",icon:a.expand?"keyboard_arrow_up":"keyboard_arrow_down",onClick:c=>a.expand=!a.expand},null,8,["icon","onClick"])])]}),_:2},1024)]),_:2},1024)]),_:2},1024),e(G,null,{default:o(()=>[a.row.sales?D((b(),V("div",ye,[e(C),e(x,{class:"text-center"},{default:o(()=>[e(f,null,{default:o(()=>[m(" FECHA ")]),_:1}),e(f,null,{default:o(()=>[m(" CAJA ")]),_:1}),e(f,null,{default:o(()=>[m(" TICKETS ")]),_:1})]),_:1}),(b(!0),V(U,null,q(a.row.sales,(l,c)=>D((b(),S(x,{class:"text-center",dense:"",clickable:""},{default:o(()=>[e(f,null,{default:o(()=>[m(v(K(Q)(l.FECFAC).format("YYYY-MM-DD")),1)]),_:2},1024),e(f,null,{default:o(()=>[m(v(l.DESTER),1)]),_:2},1024),e(f,null,{default:o(()=>[m(v(l.TICKETS),1)]),_:2},1024)]),_:2},1024)),[[O]])),256))],512)),[[N,a.expand]]):H("",!0)]),_:2},1024)]),_:2},1024),e(C,{spaced:"",inset:"",vertical:"",dark:""})])]),_:1},8,["rows","pagination","filter"]),e(se,{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=a=>u.value=a)},{default:o(()=>[e(te,{class:"my-card"},{default:o(()=>[e(R,null,{default:o(()=>[d("div",be,[Ce,e(ae,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=a=>_.value=a),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),e(R,null,{default:o(()=>[e(le,{align:"right"},{default:o(()=>[e(h,{flat:"",icon:"close",color:"negative",onClick:t[3]||(t[3]=a=>u.value=!u.value)}),e(h,{flat:"",icon:"check",color:"positive",onClick:F})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(s)]),_:1})]),_:1})}}};export{sa as default};
