import{b as B,Q as J}from"./QList.4a757eac.js";import{Q as X}from"./QHeader.51591201.js";import{r as y,c as _,o as D,g as N,d as T,w as u,e as s,f as m,a0 as M,a1 as q,Q as R,ak as I,h as $,a3 as K,aH as Z,a as ee,u as te,l as ae,S as oe,aI as le}from"./index.9b29710f.js";import{Q as se,d as ne}from"./QSelect.87e05c4d.js";import{Q as re}from"./QInput.3b7036ed.js";import{Q as ie}from"./QForm.12e4aec1.js";import{Q as de}from"./QToolbar.a1a4a4cc.js";import{Q as j}from"./QTable.5ec2cc9a.js";import{Q as A}from"./QCard.d96924d3.js";import{Q as ue}from"./QPage.eca68e2e.js";import{Q as ce,a as me}from"./QLayout.4680b3b8.js";import{u as z}from"./use-quasar.b8ea7103.js";import{d as E}from"./dayjs.min.cbcf888d.js";import{_ as fe}from"./UserToolbar.b2464383.js";import{a as Y}from"./axios.a2476ef4.js";import{Q as F}from"./QCardSection.a7ef9b11.js";import{Q as H,a as pe,b as O}from"./QTabPanels.5287e861.js";import{Q as ve}from"./QTabs.4e0d2bd8.js";import{E as be}from"./exceljs.min.9e24d01d.js";import{c as V}from"./_commonjsHelpers.88e99c8f.js";import"./use-key-composition.d3a46ef2.js";import"./QResizeObserver.df0db8ef.js";import"./QLinearProgress.12db62c0.js";import"./QCheckbox.e42e9a6c.js";import"./QScrollObserver.a5b3438d.js";import"./QDrawer.f3cb5b3e.js";import"./QCardActions.e9ff8ca8.js";import"./ClosePopup.09f26d01.js";import"./auth.01722758.js";import"./TouchSwipe.650cfb5f.js";import"./use-render-cache.3aae9b27.js";var P={index({dateranges:x,view:w,store:p}){let v=w.id;return x.to,x.from,Y.get(`/ciclicos?v=${v}&store=${p}`).then(h=>h.data).catch(h=>({fail:h}))},find(x,w){return Y.get(`/ciclicos/${x}?store=${w}`).then(p=>p.data).catch(p=>({fail:p}))}},W={exports:{}};(function(x,w){(function(p,v){v()})(V,function(){function p(o,a){return typeof a=="undefined"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function v(o,a,d){var n=new XMLHttpRequest;n.open("GET",o),n.responseType="blob",n.onload=function(){g(n.response,a,d)},n.onerror=function(){console.error("could not download file")},n.send()}function h(o){var a=new XMLHttpRequest;a.open("HEAD",o,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function k(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(a)}}var t=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof V=="object"&&V.global===V?V:void 0,b=t.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=t.saveAs||(typeof window!="object"||window!==t?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(o,a,d){var n=t.URL||t.webkitURL,c=document.createElement("a");a=a||o.name||"download",c.download=a,c.rel="noopener",typeof o=="string"?(c.href=o,c.origin===location.origin?k(c):h(c.href)?v(o,a,d):k(c,c.target="_blank")):(c.href=n.createObjectURL(o),setTimeout(function(){n.revokeObjectURL(c.href)},4e4),setTimeout(function(){k(c)},0))}:"msSaveOrOpenBlob"in navigator?function(o,a,d){if(a=a||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(p(o,d),a);else if(h(o))v(o,a,d);else{var n=document.createElement("a");n.href=o,n.target="_blank",setTimeout(function(){k(n)})}}:function(o,a,d,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof o=="string")return v(o,a,d);var c=o.type==="application/octet-stream",S=/constructor/i.test(t.HTMLElement)||t.safari,Q=/CriOS\/[\d]+/.test(navigator.userAgent);if((Q||c&&S||b)&&typeof FileReader!="undefined"){var L=new FileReader;L.onloadend=function(){var e=L.result;e=Q?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},L.readAsDataURL(o)}else{var C=t.URL||t.webkitURL,i=C.createObjectURL(o);n?n.location=i:location.href=i,n=null,setTimeout(function(){C.revokeObjectURL(i)},4e4)}});t.saveAs=g.saveAs=g,x.exports=g})})(W);var ge=W.exports;const ye={class:"row justify-between"},we={class:"text-h6"},he={class:"text-subtitle2"},ke={class:"text-subtitle2"},_e={class:"text-subtitle2"},xe={class:"text-white"},Ce={__name:"Viewer",props:{folio:[String,Number],store:[String,Number]},emits:["errorsearch"],setup(x,{emit:w}){const p=z(),v=x,h=v.folio,k=v.store,t=y(null),b=y(null),g=y("body"),o=y(null),a=y({cols:[{name:"id",field:"id",label:"ID",align:"left"},{name:"lcode",field:"code",label:"Codigo"},{name:"scode",field:"name",label:"Codigo C."},{name:"descr",field:"description",label:"Articulo",align:"left",classes:"fs-dec4"},{name:"sai",field:i=>i.ordered.stocks,label:"SAI",align:"center"},{name:"counteds",field:i=>i.ordered.stocks_acc,label:"UC",align:"center"},{name:"sat",field:i=>{var e;return(e=i.ordered.stocks_end)!=null?e:"--"},label:"SAT",align:"center"},{name:"ufus",field:i=>i.ordered.stocks_acc-i.ordered.stocks,label:"UF/US",align:"center"},{name:"locs",field:i=>i.locations.map(e=>e.path).join(", "),label:"Ubicacion (es)",align:"left"}],columnsLog:[{name:"id",field:"id",label:"ID",align:"left"},{name:"name",field:"name",label:"Nombre",align:"left"},{name:"responsable",field:i=>i.details.responsable,label:"Responsable",align:"left"},{name:"fecha",field:"created_at",label:"Fecha",align:"left"}]}),d=_(()=>t.value?t.value.created_by:null),n=_(()=>t.value?t.value.log:[]),c=_(()=>t.value&&t.value.responsables&&t.value.responsables.length?t.value.responsables.map(i=>i.nick).join(","):""),S=_(()=>t.value&&t.value.products&&t.value.products.length?t.value.products:[]),Q=_(()=>t.value?t.value.status.name:"");_(()=>""),_(()=>""),(async()=>{p.loading.show({message:"Obteniendo Informacion"});const i=await P.find(h,k);console.log(i),i.fail?b.value=i.fail:t.value=i.inventory,p.loading.hide()})();const C=i=>{let e=`INV_${t.value.id}_${t.value.workpoint.alias}.xlsx`;console.log(e);let l=new be.Workbook,r=l.addWorksheet("Sheet1");r.columns=[{header:"ID",key:"id"},{header:"Codigo",key:"lcode"},{header:"Codigo C.",key:"scode"},{header:"Articulo",key:"description"},{header:"SAI",key:"sai"},{header:"UC",key:"uc"},{header:"SAT",key:"sat"},{header:"UF/US",key:"ufus"},{header:"Ubicacion(es)",key:"locs"}],S.value.forEach(f=>{r.addRow({id:f.id,lcode:f.code,scode:f.name,description:f.description,sai:parseInt(f.ordered.stocks),uc:parseInt(f.ordered.stocks_acc),sat:parseInt(f.ordered.stocks_end),ufus:parseInt(f.ordered.stocks_acc)-parseInt(f.ordered.stocks),locs:f.locations.map(U=>U.path).join(", ")})}),r.getCell("L2").value="Folio:",r.getCell("M2").value=t.value.id,r.getCell("L3").value="Sucursal:",r.getCell("M3").value=t.value.workpoint.name,r.getCell("L4").value="Estado:",r.getCell("M4").value=Q.value,r.getCell("L5").value="Creado por:",r.getCell("M5").value=d.value?d.value.names:"",r.getCell("L6").value="Realizado por:",r.getCell("M6").value=c.value,r.getCell("L7").value="Inicio:",r.getCell("M7").value="",r.getCell("L8").value="Termino:",r.getCell("M8").value="",l.xlsx.writeBuffer().then(f=>ge(new Blob([f],{type:"application/octet-stream"}),e))};return(i,e)=>(D(),N(K,null,[t.value?(D(),T(A,{key:0,class:"my-card"},{default:u(()=>[s(F,null,{default:u(()=>[m("div",ye,[m("div",we,"Inventario "+M(q(h)),1),m("div",null,[s(R,{color:"primary",label:"descargar",onClick:C})])]),m("div",he,[e[2]||(e[2]=I("Creado por: ")),m("b",null,M(d.value?d.value.names:"Nobody"),1)]),m("div",ke,[e[3]||(e[3]=I("Realizado por: ")),m("b",null,M(c.value),1)]),m("div",_e,[e[4]||(e[4]=I("Estado: ")),m("b",null,M(Q.value),1)])]),_:1}),s(ve,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l)},{default:u(()=>[s(H,{name:"log",label:"Log"}),s(H,{name:"body",label:"Resumen"})]),_:1},8,["modelValue"]),s(pe,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),animated:""},{default:u(()=>[s(O,{name:"log"},{default:u(()=>[e[5]||(e[5]=m("div",{class:"text-h6"},"Log",-1)),s(j,{rows:n.value,columns:a.value.columnsLog},null,8,["rows","columns"])]),_:1}),s(O,{name:"body"},{default:u(()=>[s(j,{flat:"",rows:S.value,columns:a.value.cols,"row-key":"name",ref_key:"rowsproducts",ref:o},null,8,["rows","columns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):$("",!0),b.value?(D(),T(A,{key:1,class:"bg-negative"},{default:u(()=>[s(F,null,{default:u(()=>[m("pre",xe,M(b.value),1)]),_:1})]),_:1})):$("",!0)],64))}},Qe={class:"row items-center"},Se={key:0,class:"text-right"},lt={__name:"CiclicosLayout",setup(x){const w=y(""),p=z(),v=Z(),h=ee(),k=te(),t=y({state:!1,data:null}),b=y(null),g=y([]),o=y({cols:[{name:"id",field:"id",label:"Folio"},{name:"started",field:e=>E(e.created_at).format("YYYY/MM/DD HH:mm:ss"),label:"Creacion",align:"center"},{name:"status",field:e=>e.status.name,label:"Estado",align:"center"},{name:"ended",field:e=>{let l=e.log.find(r=>r.id==3);return l?E(l.pivot.created_at).format("YYYY/MM/DD HH:mm:ss"):"--"},align:"center",label:"Termino"},{name:"models",field:"products_count",label:"Modelos"},{name:"type",field:e=>e.type.name,label:"Tipo"},{name:"warehouse",field:e=>e.settings?JSON.parse(e.settings).warehouse.name:"---",label:"Almacen"}]}),a=y([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"c",label:"otra ...",disable:!0}]),d=y({from:E(Date.now()).startOf("day"),to:E(Date.now()).endOf("day")}),n=_(()=>w.value&&w.value.length),c=_(()=>d.value.from.format("YYYY/MM/DD")),S=_(()=>d.value.to.format("YYYY/MM/DD")),Q=()=>{console.log("searching folio"),t.value.folio=w.value,t.value.state=!0},L=async(e,l,r)=>{t.value.folio=l.id,t.value.state=!0},C=async()=>{var U;console.log(k.session),p.loading.show({message:"Cargado vista..."});let e=(U=v.query.v)!=null?U:"day",l=a.value.findIndex(G=>G.id==e),r=l>=0?l:0;console.log(r),b.value=a.value[r],d.value.from=E(Date.now()).startOf(b.value.id);const f=await P.index({dateranges:d,view:b.value,store:k.session.store.id_viz});console.log(f),g.value=f.inventories,p.loading.hide()},i=()=>{h.push(`/ciclicos?v=${b.value.id}`)};return C(),ae(()=>v.query,()=>{C()}),(e,l)=>(D(),T(ce,{view:"hHh Lpr fFf"},{default:u(()=>[s(X,{class:"bg-grey-3 text-dark",bordered:""},{default:u(()=>[s(fe),s(B)]),_:1}),s(me,null,{default:u(()=>[s(de,{class:"justify-between"},{default:u(()=>[m("div",null,[l[3]||(l[3]=m("span",{class:"text-grey"},"Helpers",-1)),l[4]||(l[4]=I()),s(oe,{name:"navigate_next",color:"primary"}),l[5]||(l[5]=I()),l[6]||(l[6]=m("span",{class:"text-h6"},"Ciclicos",-1))]),m("div",Qe,[s(se,{modelValue:b.value,"onUpdate:modelValue":[l[0]||(l[0]=r=>b.value=r),i],options:a.value,label:"Vista",autofocus:"",borderless:""},{prepend:u(()=>[s(R,{dense:"",flat:"",color:"primary",icon:"autorenew",onClick:le(C,["stop"])})]),_:1},8,["modelValue","options"]),s(R,{color:"primary",icon:"search",dense:"",flat:""},{default:u(()=>[s(ne,null,{default:u(()=>[l[7]||(l[7]=m("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Inventario",-1)),s(B),s(ie,{dense:"",onSubmit:Q,class:"q-gutter-md q-pa-md"},{default:u(()=>[s(re,{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=r=>w.value=r),type:"number",label:"Folio",autofocus:""},null,8,["modelValue"]),n.value?(D(),N("div",Se,[s(R,{type:"submit",color:"primary",icon:"search"})])):$("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),s(ue,{padding:""},{default:u(()=>[s(A,{class:"my-card",flat:""},{default:u(()=>[s(j,{title:`Inventarios del ${c.value} al ${S.value} [ ${g.value.length} ]`,rows:g.value,columns:o.value.cols,"row-key":"id",onRowClick:L},null,8,["title","rows","columns"])]),_:1}),s(J,{modelValue:t.value.state,"onUpdate:modelValue":l[2]||(l[2]=r=>t.value.state=r),"full-width":""},{default:u(()=>[s(Ce,{folio:t.value.folio,store:q(k).session.store.id_viz},null,8,["folio","store"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{lt as default};
