import{Q as _}from"./QSeparator.c83f4ce8.js";import{r as V,c as A,o as u,a as v,w as a,e,f as c,a4 as r,Y,Q as x,a0 as Z,g as w,h as g,_ as z,aV as X,a5 as b,a1 as G,a2 as J,a6 as K,a3 as D,a7 as W}from"./index.cb849e3f.js";import{b as ee,Q as S}from"./QSelect.37b8002b.js";import{Q as N}from"./QInput.1034ddb1.js";import{Q as le}from"./QForm.12616ced.js";import{Q as ae}from"./QToolbar.c0dd9952.js";import{Q as te}from"./QHeader.53ac2b1b.js";import{u as oe,Q as L,a as I}from"./use-quasar.2b8e7c4c.js";import{Q as O,a as n}from"./QItemSection.855be14b.js";import{Q as U}from"./QList.40b804ff.js";import{Q as se}from"./QCheckbox.d530b464.js";import{Q as E}from"./QCardActions.cbd3de43.js";import{Q as re}from"./QDialog.1f39e965.js";import{Q as ne}from"./QPage.8e85209b.js";import{Q as ie,a as ue}from"./QLayout.f2021ab6.js";import{C as de}from"./ClosePopup.d8f5019d.js";import{u as me}from"./VDB.e021eecb.js";import{_ as pe}from"./UserToolbar.d74f8248.js";import{a as P}from"./axios.9ab26c22.js";import{a as fe}from"./axios.ba7b1b0e.js";import"./use-key-composition.c78babc0.js";import"./uid.937d8ee7.js";import"./position-engine.70ebb198.js";import"./rtl.276c3f1b.js";import"./QResizeObserver.6d9db52a.js";const ve={key:0,class:"text-right"},ce={class:"row justify-center"},be={class:"text-bold text-h5"},He={__name:"ValeLYT",setup(ge){const p=me(),d=oe(),R=p.series,Q=V(null),k=V(""),i=V({state:!1,body:null}),m=V({state:!1,val:null,body:null}),C=V(""),f=V([]),$=A(()=>Q.value&&k.value.length),B=A(()=>C.value?i.value.body.product.filter(s=>s.ARTICULO.includes(C.value)):i.value.body.product),y=A(()=>d.platform.is.mobile),F=A(()=>f.value.length>0?f.value.every(s=>Number(s.change)>0)&&f.value.every(s=>Number(s.change)<=Number(s.CANTIDAD)):!1),h=async()=>{let s=p.session.store.id;console.log(s);try{let l=await fe.get(`/cashier/getPrinters/${s}`);l.status==200&&(m.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),d.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},q=async()=>{d.loading.show({message:"Obteniendo Ticket"}),i.value.body=null;let s={type:"Modificacion",serie:Q.value,folio:k.value},t=`http://${p.session.store.ip}/access/public/modify/newmod`;P.post(t,s).then(o=>{console.log(o),i.value.state=!0,i.value.body=o.data,d.loading.hide()}).catch(o=>{console.log(o.response.data.message),d.notify({html:!0,message:o.response.data.message,color:"negative",position:"center"})})},H=()=>{m.value.state=!0},j=()=>{d.loading.show({message:"Obteniendo Ticket"}),f.value.map(o=>o._chantot=o.change*o.PRECIO);let s={ticket:i.value.body.ticket,products:f.value,print:m.value.val,created:`${p.session.name} - ${p.session.store.alias}`},t=`http://${p.session.store.ip}/access/public/modify/createVal`;P.post(t,s).then(o=>{console.log(o),o.data.mmsg&&(d.notify({message:`devolucion ${o.data.devolucion}`,type:"positive",position:"center"}),d.notify({message:`vale ${o.data.vale}`,type:"positive",position:"center"})),Q.value=null,k.value="",i.value={state:!1,body:null},m.value={state:!1,val:null,body:null},C.value="",f.value=[],d.loading.hide()}).catch(o=>{console.log(o),d.notify({html:!0,message:o,color:"negative",position:"center"})}),console.log(s)},M=()=>{Q.value=null,k.value="",i.value={state:!1,body:null},m.value={state:!1,val:null,body:null},C.value="",f.value=[]};return p.session.rol=="aux"||p.session.rol=="gen"||p.session.rol=="aud"||p.session.rol=="root"?h():(d.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),$router.replace("/")),h(),(s,l)=>(u(),v(ie,{view:"hHh Lpr fFf"},{default:a(()=>[e(te,{class:"transparent text-dark",bordered:""},{default:a(()=>[e(pe),e(_),e(ae,{class:"justify-between"},{default:a(()=>[c("div",null,[l[6]||(l[6]=r("Helpers ")),e(Y,{name:"navigate_next",color:"primary"}),l[7]||(l[7]=r()),l[8]||(l[8]=c("span",{class:"text-h6"},"VALES",-1))]),e(x,{color:"primary",icon:"add"},{default:a(()=>[e(ee,null,{default:a(()=>[l[9]||(l[9]=c("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Folio",-1)),e(_),e(le,{dense:"",onSubmit:q,class:"q-gutter-md q-pa-md"},{default:a(()=>[e(S,{modelValue:Q.value,"onUpdate:modelValue":l[0]||(l[0]=t=>Q.value=t),options:Z(R),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(N,{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=t=>k.value=t),type:"number",label:"Folio"},null,8,["modelValue"]),$.value?(u(),w("div",ve,[e(x,{type:"submit",color:"primary",icon:"search"})])):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ue,null,{default:a(()=>[e(ne,{class:"bg-grey-3",padding:""},{default:a(()=>[c("div",ce,[e(z,{name:"bounce"},{default:a(()=>[i.value.state?(u(),v(L,{key:0,flat:"",bordered:"",style:X(`width: ${y.value?"100%;":"70%;"}`)},{default:a(()=>[e(I,null,{default:a(()=>[c("div",be,"Ticket: "+b(i.value.body.ticket.ticket),1),c("div",null,"N\xBA Cliente: "+b(i.value.body.ticket.codcli),1),c("div",null,"Cliente: "+b(i.value.body.ticket.cliente),1),c("div",null,"Fecha: "+b(i.value.body.ticket.fecha),1)]),_:1}),e(I,{class:"text-center text-bold"},{default:a(()=>l[10]||(l[10]=[r(" Selecciona los productos que se creara el vale ")])),_:1}),e(I,null,{default:a(()=>[e(N,{modelValue:C.value,"onUpdate:modelValue":l[2]||(l[2]=t=>C.value=t),type:"text",label:"Buscar",filled:""},null,8,["modelValue"])]),_:1}),e(I,null,{default:a(()=>[e(U,{bordered:""},{default:a(()=>[e(O,{dense:""},{default:a(()=>[e(n,null,{default:a(()=>l[11]||(l[11]=[r("ARTICULO")])),_:1}),y.value?g("",!0):(u(),v(n,{key:0,class:"text-left"},{default:a(()=>l[12]||(l[12]=[r("DESCRIPCION")])),_:1})),e(n,{class:"text-right"},{default:a(()=>l[13]||(l[13]=[r("CANTIDAD")])),_:1}),y.value?g("",!0):(u(),v(n,{key:1,class:"text-right"},{default:a(()=>l[14]||(l[14]=[r("PRECIO")])),_:1})),y.value?g("",!0):(u(),v(n,{key:2,class:"text-right"},{default:a(()=>l[15]||(l[15]=[r("TOTAL")])),_:1})),e(n,null,{default:a(()=>l[16]||(l[16]=[r(" SELECT ")])),_:1}),e(n,null,{default:a(()=>l[17]||(l[17]=[r(" PIEZAS A DEV")])),_:1}),e(_,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),e(_,{spaced:"",inset:"",vertical:"",dark:""}),(u(!0),w(J,null,G(B.value,(t,o)=>(u(),v(U,{bordered:"",key:o},{default:a(()=>[D((u(),v(O,{dense:"",tag:"label"},{default:a(()=>[e(n,null,{default:a(()=>[r(b(t.ARTICULO),1)]),_:2},1024),y.value?g("",!0):(u(),v(n,{key:0,class:"text-left"},{default:a(()=>[r(b(t.DESCRIPCION),1)]),_:2},1024)),e(n,{class:"text-right"},{default:a(()=>[r(b(Number(t.CANTIDAD).toFixed(2)),1)]),_:2},1024),y.value?g("",!0):(u(),v(n,{key:1,class:"text-right"},{default:a(()=>[r(b(Number(t.PRECIO).toFixed(2)),1)]),_:2},1024)),y.value?g("",!0):(u(),v(n,{key:2,class:"text-right"},{default:a(()=>[r(b(Number(t.TOTAL).toFixed(2)),1)]),_:2},1024)),e(n,null,{default:a(()=>[e(se,{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=T=>f.value=T),val:t},null,8,["modelValue","val"])]),_:2},1024),e(n,null,{default:a(()=>[e(N,{modelValue:t.change,"onUpdate:modelValue":T=>t.change=T,type:"number",label:"PZ",outlined:"",error:t.change>Number(t.CANTIDAD),"error-message":"es mayor que la cantidad X(",disable:!f.value.some(T=>T.ARTICULO===t.ARTICULO)},null,8,["modelValue","onUpdate:modelValue","error","disable"])]),_:2},1024),e(_,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024)),[[W]])]),_:2},1024))),128))]),_:1}),c("div",null,[e(E,{align:"between"},{default:a(()=>[e(x,{flat:"",icon:"cancel",onClick:M}),e(x,{flat:"",icon:"arrow_forward",disable:!F.value,onClick:H},null,8,["disable"])]),_:1})])]),_:1},8,["style"])):g("",!0)]),_:1})]),e(re,{modelValue:m.value.state,"onUpdate:modelValue":l[5]||(l[5]=t=>m.value.state=t),persistent:""},{default:a(()=>[e(L,null,{default:a(()=>[e(I,{class:"row items-center"},{default:a(()=>[e(K,{icon:"print",color:"primary","text-color":"white"}),l[18]||(l[18]=c("span",{class:"q-ml-sm"},"Selecciona Impresora",-1))]),_:1}),e(I,null,{default:a(()=>[e(S,{modelValue:m.value.val,"onUpdate:modelValue":l[4]||(l[4]=t=>m.value.val=t),options:m.value.body,label:"Impresora","option-label":"name",filled:""},null,8,["modelValue","options"])]),_:1}),e(E,{align:"right"},{default:a(()=>[D(e(x,{flat:"",label:"Cancel",color:"negative"},null,512),[[de]]),e(x,{flat:"",label:"Continuar",color:"positive",onClick:j,disable:!m.value.val},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{He as default};
