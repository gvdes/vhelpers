import{i as ne,c as F,j as I,k as $,t as de,u as ue,a as re,aH as ce,r as w,o as x,d as g,w as i,h as b,f as o,e as s,a1 as ve,Q as r,a0 as d,an as pe,ak as v,a4 as O,b9 as me}from"./index.1caea72c.js";import{b as m,a as fe,d as A,e as q,Q as L}from"./QList.c5925261.js";import{b as _e,Q as xe}from"./QTable.12d1f84c.js";import{i as ge,j as be}from"./use-key-composition.2156c461.js";import{Q as z}from"./QCard.c7bbc0b0.js";import{Q as ke}from"./QBtnGroup.0d2eba0f.js";import{Q as ye}from"./QPageSticky.3dadf1ae.js";import{Q as V}from"./QCardSection.e7ec6c6e.js";import{Q as we}from"./QSelect.f9196b14.js";import{Q as he}from"./QInput.1e2dc3e6.js";import{Q as qe}from"./QSpace.fb5a16a3.js";import{Q as K}from"./QCardActions.70d330c5.js";import{Q as Ce}from"./QFooter.965ec8fb.js";import{Q as Qe}from"./QPage.b53b15b6.js";import{C as Pe}from"./ClosePopup.f2176256.js";import"./QDrawer.25422a8a.js";import"./axios.d0e85866.js";import{u as Se}from"./use-quasar.2a5547a4.js";import{P as Ve}from"./ProductsAutocomplete.cd19069d.js";import{E as Be}from"./exceljs.min.9e24d01d.js";import{u as Ie}from"./Restock.f8df692f.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.c889c6b6.js";import"./JsBarcode.cb858474.js";import"./dayjs.min.cbcf888d.js";import{$sktRestock as ze}from"./socket.05630e21.js";import"./QForm.3c7e1f82.js";import"./QBadge.0397ff13.js";import{R as C}from"./RestockApi.45eba5a7.js";import"./QToolbar.934f2598.js";import"./QLinearProgress.478806cb.js";import"./QCheckbox.5473f73d.js";import"./QResizeObserver.cbcc886d.js";import"./QScrollObserver.83cb7307.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";import"./QRadio.54142cc7.js";import"./QTd.ec2d11eb.js";import"./QPopupEdit.806030d9.js";import"./QTr.8b167a68.js";import"./QLayout.5d2bfff3.js";/* empty css                                                       */var Fe=ne({name:"QBanner",props:{...ge,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(h,{slots:Q}){const{proxy:{$q:u}}=de(),N=be(h,u),P=F(()=>"q-banner row items-center"+(h.dense===!0?" q-banner--dense":"")+(N.value===!0?" q-banner--dark q-dark":"")+(h.rounded===!0?" rounded-borders":"")),S=F(()=>`q-banner__actions row items-center justify-end col-${h.inlineActions===!0?"auto":"all"}`);return()=>{const n=[I("div",{class:"q-banner__avatar col-auto row items-center self-start"},$(Q.avatar)),I("div",{class:"q-banner__content col text-body2"},$(Q.default))],f=$(Q.action);return f!==void 0&&n.push(I("div",{class:S.value},f)),I("div",{class:P.value+(h.inlineActions===!1&&f!==void 0?" q-banner--top-padding":""),role:"alert"},n)}}});const Ne={class:"row items-stretch justify-between bg-primary text-white"},Re={class:"row items-center col divlcient"},De={class:"q-pa-sm col text-center"},$e={class:"text-uppercase"},Ae={class:"q-pa-sm col text-center"},je={class:"text-bold"},Ee={class:"q-pa-sm col text-center"},Ue={class:"text-bold"},Me={class:"row items-center justify-between q-mt-sm"},Te={class:"row text-center"},Oe={class:"q-px-md"},Le={class:"text-bold"},Ke={class:"q-px-md"},Ge={class:"text-bold"},He={class:"q-px-md"},Je={class:"text-bold"},We={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3"},Ye={class:"row items-center q-pt-md"},Xe={class:"col q-px-md"},Ze={class:"text-bold"},et={class:"text--2"},tt={class:"col q-px-md"},lt={class:"text-center"},ot={class:"text--2"},at={class:"text-weight-bold"},st={class:"row q-pt-xs"},it={class:"row"},nt={class:"text-h6 col text-bold text-left"},dt={class:"text-h6 col text-bold text-right"},ut={class:"text-subtitle2 col"},rt={class:"row items-end"},ct={class:"text-center"},vt={class:"col q-pa-xs"},pt={class:"col column q-py-md"},mt={class:"col q-pa-xs"},ft={class:"text-bold text-red"},_t={class:"row q-ml-sm"},sl={__name:"viewNewRequisition",setup(h){const Q=ue(),u=Se(),N=Ie(),P=re(),S=ce(),n=w(null),f=w([]),t=w({state:!1,val:null,edit:!1}),k=w({state:!1,notfound:[],added:[]}),j=w(null),E=w({pagination:{rowsPerPage:16},filter:""}),c=w({_requisition:S.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null}),G=F(()=>{let a=t.value.val.pivot._supply_by==3?t.value.val.pivot.amount*t.value.val.pieces:t.value.val.pivot._supply_by==2?t.value.val.pivot.amount*12:t.value.val.pivot.amount;return t.value.val.pivot.units=a,a}),H=F(()=>{let a=t.value.val.pivot._supply_by==3?t.value.val.pivot.stock/t.value.val.pieces:t.value.val.pivot._supply_by==2?t.value.val.pivot.stock/12:t.value.val.pivot.stock;return t.value.val.pivot.units=a,a}),U=a=>a.pivot._supply_by==3?a.pivot.stock/a.pieces:a.pivot._supply_by==2?a.pivot.stock/12:a.pivot.stock,J=a=>{console.log(a),t.value.val=a,t.value.state=!0,t.value.edit=!0},W=a=>{console.log(a);let l=n.value.products.findIndex(e=>e.id==a.id);console.log(l),l>=0?(t.value.val=n.value.products[l],t.value.state=!0,t.value.edit=!0):(t.value.edit=!1,t.value.val=a,c.value._product=ops.id,c.value._supply_by=ops._unit,c.value.ipack=ops.pieces,c.value.cost=ops.prices.find(e=>e.id==7).pivot.price,c.value.stock=ops.stocks.find(e=>e.id==n.value.to.id).pivot.stock,t.value.val.pivot=c.value,t.value.state=!0)},Y=a=>{console.log(a);let l=n.value.products.findIndex(e=>e.id==a.id);console.log(l),l>=0?(t.value.val=n.value.products[l],console.log(t.value.val),t.value.state=!0,t.value.edit=!0):(t.value.val=a,c.value._product=a.id,c.value._supply_by=a._unit,c.value.ipack=a.pieces,c.value.cost=a.prices.find(e=>e.id==7).pivot.price,c.value.stock=a.stocks.find(e=>e.id==n.value.to.id).pivot.stock,t.value.val.pivot=c.value,t.value.edit=!1,t.value.state=!0)},X=async()=>{N.setShowLYT(!1),u.loading.show({message:"Obteniendo Pedido"});let a={workpoint:Q.session.store.id_viz,folio:S.params.rid};const l=await C.getRequired(a);l.fail?console.log(l):(u.loading.hide(),console.log(l),n.value=l.order,f.value=l.units,n.value._status!=1&&P.push("/distribute/dashboardStore"))},Z=async()=>{u.loading.show({message:"Insertando Producto"}),t.value.val.pivot.total=t.value.val.pivot.units*t.value.val.pivot.cost;const a=await C.addProductRequired(t.value.val.pivot);a.fail?console.log(a):(console.log(a),u.loading.hide(),n.value.products.push(a),R())},ee=async()=>{u.loading.show({message:"Editando Producto"}),t.value.val.pivot.total=t.value.val.pivot.units*t.value.val.pivot.cost;const a=await C.addProductRequired(t.value.val.pivot);if(a.fail)console.log(a);else{console.log(a),u.loading.hide();let l=n.value.products.findIndex(e=>e.id==t.value.val.id);n.value.products.splice(l,1,a),R()}},te=async()=>{u.loading.show({message:"Eliminando Producto"});const a=await C.deleteProductRequired(t.value.val.pivot);if(a.fail)console.log(a);else{console.log(a),u.loading.hide();let l=n.value.products.findIndex(e=>e.id==t.value.val.id);n.value.products.splice(l,1),R()}},le=()=>{j.value.click()},oe=async()=>{let a=document.getElementById("inputFile").files[0],l=new Be.Workbook,e={};l.xlsx.load(a).then(async p=>{let D=l.worksheets[0],se=D.getColumn("A");D.getColumn("B"),se.eachCell({includeEmpty:!0},function(y,_){if(_===1)return;let B=y.value,ie=D.getCell(`B${_}`),T=parseFloat(ie.value);B&&(e[B]?e[B]+=T:e[B]=T)});let M=Object.keys(e).map(y=>({codigo:y,cantidad:e[y]}));if(M.length){let y={codes:M,_requisition:n.value.id};u.loading.show({message:"Procesando archivo, espera.."}),console.log(y);const _=await C.addMassiveProducts(y);_.fail?console.log(_):(console.log(_),n.value.products=_.products,k.value.state=!0,k.value.added=_.products,k.value.notfound=_.notFound,u.loading.hide())}else u.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ae=async()=>{u.loading.show({message:"Enviando Pedido"});const a=await C.nextStep({id:n.value.id});console.log(a),a.status==200?(console.log(a),u.notify({message:"Pedido Enviado :)",type:"positive",position:"center"}),P.push("/distribute/dashboardStore"),ze.emit("order_refresh",{order:a.data.requisition}),u.loading.hide()):alert("Problema con el envio de el pedido ")},R=()=>{c.value={_requisition:S.params.rid,_product:null,amount:1,_supply_by:null,units:0,cost:0,total:null,comments:null,stock:null,ipack:null},t.value={state:!1,val:null,edit:!1}};return X(),(a,l)=>n.value?(x(),g(Qe,{key:0,padding:""},{default:i(()=>[o("div",Ne,[s(r,{onClick:l[0]||(l[0]=()=>ve(P).push("/distribute/dashboardStore")),flat:"",icon:"close",color:"white"}),o("div",Re,[o("div",De,[l[8]||(l[8]=o("div",{class:"text--2"},"Destino:",-1)),o("div",$e,d(n.value.to.alias),1)]),o("div",Ae,[l[9]||(l[9]=o("div",{class:"text--2"},"Folio:",-1)),o("div",je,d(n.value.id),1)]),o("div",Ee,[l[10]||(l[10]=o("div",{class:"text--2"},"Almacen:",-1)),o("div",Ue,d(n.value._warehouse),1)])])]),o("div",Me,[o("div",Te,[o("div",Oe,[l[11]||(l[11]=o("div",{class:"text--2"},"Modelos",-1)),o("span",Le,d(n.value.products.length),1)]),o("div",Ke,[l[12]||(l[12]=o("div",{class:"text--2"},"Unidades",-1)),o("span",Ge,d(n.value.products.reduce((e,p)=>e+Number(p.pivot.units),0)),1)]),o("div",He,[l[13]||(l[13]=o("div",{class:"text--2"},"Cajas",-1)),o("span",Je,d(n.value.products.reduce((e,p)=>e+Number(Number(p.pivot.units)/Number(p.pieces)),0)),1)])])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(xe,{grid:"",flat:"",dark:"","row-key":"id",rows:n.value.products,filter:E.value.filter,pagination:E.value.pagination},{item:i(e=>[o("div",We,[s(z,{class:"q-mb-sm q-mr-sm",onClick:p=>J(e.row)},{default:i(()=>[o("div",Ye,[o("div",Xe,[o("div",Ze,d(e.row.code),1),o("div",null,d(e.row.name),1),o("div",et,d(e.row.description),1)])]),o("div",tt,[s(_e,{flat:"",class:""},{default:i(()=>[o("thead",null,[o("tr",null,[o("th",null,"Sol. ("+d(f.value.find(p=>p.id==e.row.pivot._supply_by).name)+")",1),l[14]||(l[14]=o("th",null,"pzs / caj",-1)),o("th",null,"Disp. ("+d(f.value.find(p=>p.id==e.row.pivot._supply_by).name)+")",1)])]),o("tbody",null,[o("tr",lt,[o("td",null,d(e.row.pivot.amount),1),o("td",null,d(e.row.pieces),1),o("td",null,[o("span",{class:pe(U(e.row)>=1?"text-green-10":"text-pink-10")},d(Math.round(U(e.row))),3)])])])]),_:2},1024)]),e.row.pivot.comments||e.row.pivot._supply_by?(x(),g(Fe,{key:0,rounded:"",class:""},{default:i(()=>[o("span",ot,[l[15]||(l[15]=v(" Se surtira la cantidad de ")),o("span",at,d(e.row.pivot.units)+"pz",1),v(" correspondiente a la unidad de "+d(f.value.find(p=>p.id==e.row.pivot._supply_by).name)+" ",1),s(m,{dark:""}),v(" Notas: "+d(e.row.pivot.comments),1)])]),_:2},1024)):b("",!0)]),_:2},1032,["onClick"])])]),bottom:i(e=>[s(ye,{position:"bottom",class:"full-width",offset:[0,18]},{default:i(()=>[o("div",st,[s(ke,{rounded:"",class:""},{default:i(()=>[e.pagesNumber>2?(x(),g(r,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):b("",!0),s(r,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),s(r,{flat:"",disable:"","no-caps":""},{default:i(()=>[v(d(e.pagination.page)+" / "+d(e.pagesNumber),1)]),_:2},1024),s(r,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(x(),g(r,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):b("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","filter","pagination"]),s(L,{modelValue:t.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>t.value.state=e),position:"bottom"},{default:i(()=>[t.value.val?(x(),g(z,{key:0},{default:i(()=>[s(V,{class:"item-center"},{default:i(()=>[o("div",it,[o("div",nt,d(t.value.val.code),1),l[16]||(l[16]=o("div",{class:"text-subtitle2 col text-bold text-center"},null,-1)),o("div",dt,d(t.value.val.name),1)]),o("div",ut,d(t.value.val.description),1)]),_:1}),s(V,null,{default:i(()=>[o("div",rt,[o("div",ct,[o("div",vt,[l[17]||(l[17]=o("div",{class:"text-bold text-h6"},"Cantidad:",-1)),s(r,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:l[1]||(l[1]=e=>t.value.val.pivot.amount++)}),s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",pt,[O(o("input",{type:"number",min:"1","onUpdate:modelValue":l[2]||(l[2]=e=>t.value.val.pivot.amount=e),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[me,t.value.val.pivot.amount]])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(r,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:l[3]||(l[3]=e=>t.value.val.pivot.amount>1?t.value.val.pivot.amount--:"")})])]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",mt,[s(we,{dense:"",filled:"",modelValue:t.value.val.units,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.val.units=e),options:f.value,label:"Surtir por","option-label":"name",disable:""},null,8,["modelValue","options"]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(he,{dense:"",filled:"",modelValue:t.value.val.pivot.comments,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.val.pivot.comments=e),type:"text",label:"Notas"},null,8,["modelValue"]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(fe,null,{default:i(()=>[s(A,{class:"bg-grey-11"},{default:i(()=>[s(q,{class:"text-left text-caption text-bold"},{default:i(()=>[v("STOCK "+d(t.value.val.stocks.find(e=>e.id==n.value.to.id).alias),1)]),_:1}),s(q,{class:"text-bold text-center"},{default:i(()=>[v(d(H.value)+" "+d(t.value.val.units.id==3?"Cjs":t.value.val.units.id==2?"Dcns":"Pzs"),1)]),_:1})]),_:1}),s(A,{class:"bg-grey-11"},{default:i(()=>[s(q,{class:"text-left text-caption"},{default:i(()=>l[18]||(l[18]=[v("P x C")])),_:1}),s(q,{class:"text-bold text-center"},{default:i(()=>[v(d(t.value.val.pieces)+" pzs",1)]),_:1})]),_:1}),s(A,null,{default:i(()=>[s(q,{class:"text-left text-caption"},{default:i(()=>l[19]||(l[19]=[v("Unidades")])),_:1}),s(q,{class:"text-bold text-center"},{default:i(()=>[v(d(G.value)+" pzs",1)]),_:1})]),_:1})]),_:1})])])]),_:1}),s(K,null,{default:i(()=>[s(qe),t.value.edit?b("",!0):(x(),g(r,{key:0,flat:"",icon:"add",color:"positive",onClick:Z})),t.value.edit?(x(),g(r,{key:1,flat:"",icon:"delete",color:"negative",onClick:te})):b("",!0),t.value.edit?(x(),g(r,{key:2,flat:"",icon:"edit",color:"warning",onClick:ee})):b("",!0)]),_:1})]),_:1})):b("",!0)]),_:1},8,["modelValue"]),s(L,{modelValue:k.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>k.value.state=e),persistent:""},{default:i(()=>[s(z,null,{default:i(()=>[s(V,{class:"text-center text-h5 text-bold"},{default:i(()=>l[20]||(l[20]=[v(" Resultados de Importacion ")])),_:1}),s(V,{class:"text-centet text-h6 text-bold"},{default:i(()=>[v(" Correctos: "+d(k.value.added.length),1)]),_:1}),s(V,null,{default:i(()=>[l[21]||(l[21]=v(" Modelos sin Coincidencia: ")),o("span",ft,d(k.value.notfound),1)]),_:1}),s(K,{align:"right"},{default:i(()=>[O(s(r,{flat:"",label:"OK",color:"primary"},null,512),[[Pe]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Ce,{reveal:"",elevated:"",bordered:""},{default:i(()=>[s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",_t,[o("div",null,[s(r,{icon:"upload",flat:"",onClick:le})]),s(m,{spaced:"",inset:"",vertical:"",dark:""}),s(z,{class:"col"},{default:i(()=>[s(Ve,{checkState:!1,onInput:W,with_prices_Invoice:"",with_stock_cedis:n.value.to.id,onAgregar:Y,with_locations:""},null,8,["with_stock_cedis"])]),_:1}),s(m,{spaced:"",inset:"",vertical:"",dark:""}),o("div",null,[n.value.products.length>0?(x(),g(r,{key:0,flat:"",icon:"send",onClick:ae})):b("",!0)])]),s(m,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),o("input",{type:"file",ref_key:"inputFile",ref:j,id:"inputFile",onInput:oe,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1})):b("",!0)}};export{sl as default};
