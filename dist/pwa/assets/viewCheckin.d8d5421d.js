import{Q as de}from"./QToolbarTitle.1607bb56.js";import{Q as ue}from"./QToolbar.3c981c3a.js";import{b as L,a as ce,Q as A,d as pe,e as M}from"./QList.fbe92372.js";import{u as ve,aH as me,a as fe,r as g,c as b,p as ge,o as p,d as x,w as l,f as a,e as s,ak as v,a0 as n,a1 as be,g as w,h,S as K,Q,a2 as G,a3 as H,aI as ye,al as _e,a4 as O,b4 as he,am as ke,n as xe}from"./index.de8d81c3.js";import{Q as I}from"./QInput.61d32a9d.js";import{d as we,a as Y}from"./QSelect.40eb47ae.js";import{Q as Qe}from"./QToggle.87442da4.js";import{Q as Ce}from"./QTable.25e4aa49.js";import{Q as V}from"./QCardSection.bdc282f9.js";import{Q as Se}from"./QForm.8798c660.js";import{Q as J}from"./QCard.685d9ac6.js";import{Q as $e}from"./QCardActions.2df30c51.js";import{Q as W}from"./QFooter.c735b2e7.js";import{Q as qe}from"./QPage.d6217888.js";import{C as Ve}from"./ClosePopup.f5853d13.js";import{u as Ee}from"./use-quasar.608984ce.js";import{R as f}from"./RestockApi.adaa6b88.js";import{i as X}from"./invoicesApi.16d1a450.js";import{$sktRestock as C}from"./socket.05630e21.js";import{u as De}from"./Restock.b9d7a950.js";import"./use-key-composition.a00e15d3.js";import"./use-checkbox.11634e09.js";import"./QLinearProgress.5a8c3ba1.js";import"./QCheckbox.5ec2a4bb.js";import"./QResizeObserver.ed45798b.js";import"./axios.29bdad68.js";import"./QRadio.53768cb8.js";import"./QTd.5b025cdf.js";import"./QPopupEdit.3391cef4.js";import"./QTr.e58e6b5a.js";import"./QLayout.5bda3682.js";import"./QScrollObserver.f4fa5630.js";import"./QExpansionItem.a37d0abd.js";import"./QDrawer.d0ae7c5f.js";import"./jspdf.plugin.autotable.2941991f.js";import"./_commonjsHelpers.88e99c8f.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const Re={class:"bg-cyan-10 text-white"},Pe={key:0,class:"text--3"},je={class:"text-bold text-h6"},Ie={key:0,class:"text-white"},Te={class:"text-bold"},ze={class:"q-px-md q-py-sm"},Ue={class:"col text-white row justify-between"},Fe={key:0,class:"row items-center justify-between q-pt-sm"},Ne={class:"full-width row items-center justify-between"},Be={class:"row justify-between"},Le={class:"text-left"},Ae={class:"text--3"},Me={class:"text-h6"},Ke={class:"text-right"},Ge={class:"text-bold"},He={class:"text--2"},Oe={class:"text-h6"},Ye={class:"text--2"},Je={class:"row items-start justify-between"},We={class:"text-center col text-primary"},Xe={class:"text-bold"},Ze={class:"text-center col text-orange-10"},et={class:"text-bold"},tt={class:"text-center col"},at={class:"text-bold"},ot={class:"text-center col"},it={class:"text-center col"},st={class:"text-bold"},lt={class:"q-ml-md"},nt={class:"text-bold text-center text-h6"},rt={class:"q-pa-md text-bold text-uppercase text-center"},Jt={__name:"viewCheckin",setup(dt){const T=ve(),r=Ee(),D=De(),S=me(),$=fe(),d=g(null),E=g({state:!1}),y=g(""),z=g(null),R=g(null),P=g(["code","request","ipack","uspply","delivery","checkout","received","reqinpzs"]),k=g({columns:[{name:"id",label:"ID",field:"id",align:"left",coldesc:"Identificador del producto (MySQL)"},{name:"code",label:"Codigo",field:"code",align:"left",coldesc:"Codigo principal del producto"},{name:"assocs",label:"Asociados",field:t=>t.variants.length?t.variants.map(e=>e.barcode).join(", "):null,align:"left",coldesc:"Codigos relacionados al codigo principal"},{name:"bcode",label:"Codigo de Barras",field:"barcode",align:"center",coldesc:"Codigo de barras principal"},{name:"ipack",label:"PxC",field:t=>typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces,align:"center",coldesc:"Unidades x Embalaje"},{name:"request",label:"Solicitud",field:t=>t.pivot.amount,align:"center",coldesc:"Embalaje solicitado"},{name:"uspply",label:"Unidad",field:t=>t.pivot._supply_by==3?"Cajas":t.pivot._supply_by==2?"Docenas":"Piezas",align:"left",coldesc:"Unidad de embalaje del producto"},{name:"delivery",label:"Salida",field:t=>t.pivot.toDelivered,align:"center",coldesc:"Embalaje surtido",sortable:!0},{name:"reqinpzs",label:"Piezas",field:t=>t.pivot._supply_by==3?(typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces)*(typeof t.pivot.ipack=="number"?t.pivot.toDelivered:t.pivot.amount):typeof t.pivot.ipack=="number"?t.pivot.toDelivered:t.pivot.amount,align:"center",coldesc:"Unidades totales en embalaje"},{name:"checkout",label:"Checkout",field:t=>t.pivot.checkout?"OK":null,classes:t=>t.pivot.checkout?"text-positive text-bold":"",align:"center",coldesc:"Revision del Administrador",sortable:!0},{name:"received",label:"Conteo",field:t=>t.pivot.toReceived,align:"center",coldesc:"Embalaje recepcion"},{name:"descr",label:"Descripcion",field:"description",align:"left"},{name:"section",label:"Seccion",field:"section",align:"left"},{name:"family",label:"Familia",field:"family",align:"left"},{name:"category",label:"Categoria",field:"category",align:"left"}],filter:"",pagination:{sortBy:"locs",descending:!1,rowsPerPage:20}}),i=g({state:!1,item:null,form:{count:0,ipack:null,setting:!1}}),m=b(()=>d.value?d.value.products.filter(t=>t.pivot.checkout==1):[]),_=b(()=>d.value?d.value.status:null),U=b(()=>_.value?_.value.id==9:!1),Z=b(()=>m.value.filter(t=>typeof t.pivot.toReceived!="number")),F=b(()=>m.value.filter(t=>typeof t.pivot.toReceived=="number")),q=b(()=>{let t=y.value.toUpperCase().trim();return t.length?m.value.filter(e=>e.code.match(t)||e.barcode&&e.barcode.match(t)||e.variants.some(o=>o.barcode.toUpperCase().includes(t))):m.value}),ee=b(()=>q.value.reduce((t,e)=>t+(e.pivot._supply_by==3?e.pivot.amount*e.pivot.ipack:e.pivot.amount),0)),j=b(()=>m.value.reduce((t,e)=>t+Number(e.pivot.toReceived!==e.pivot.toDelivered),0)),N=async()=>{r.loading.show({message:"Obteniendo Informacion"}),D.setShowLYT(!1);const t=await f.partitionFresh(S.params.chk);console.log(t.data.order),t.status==200?t.data.order.requisition.from.id==T.session.store.id_viz?t.data.order._status==9||t.data.order._status>9?(r.loading.hide(),d.value=t.data.order):t.data.order._status==7||t.data.order._status==8?await te():t.data.order._status<7&&(d.value=t.data.order,r.loading.hide()):($.push("/distribute/checkin"),r.notify({message:"No perteneces a la sucursal",type:"negative",position:"center"}),r.loading.hide()):alert(`Error ${t.status}: ${t.response.data} `)},te=async()=>{let t={partition:S.params.chk,verified:T.session.credentials.staff.id,state:9,key:S.query.key};console.log(t);let e=await f.saveCheck(t);if(console.log(e),e.status==200){let o=D.partitions.findIndex(u=>u.id==e.data.partition.id);if(o>=0){if(D.partitions.splice(o,1,e.data.partition),e.data.partitionsEnd>e.data.partition.requisition._status){let u={id:e.data.partition._requisition,state:e.data.partitionsEnd};const c=await f.nextState(u);C.emit("order_refresh",{order:c.data}),console.log(c.data)}C.emit("orderpartition_refresh",{order:e.data.partition})}r.loading.hide(),d.value=e.data.partition,r.loading.hide()}else e.status==401?(alert(e.response.data.message),console.log(e.response.data.message),r.loading.hide()):alert(`Error ${e.status}: ${e.response.data} `)},B=t=>{console.log(t),i.value.item=t,i.value.form.count=typeof t.pivot.toReceived=="number"?t.pivot.toReceived:0,i.value.form.ipack=typeof t.pivot.ipack=="number"?t.pivot.ipack:t.pieces,i.value.state=!0,xe(()=>{R.value.focus(),R.value.select()})},ae=()=>{let t=y.value.toUpperCase().trim();if(t.length){let e=q.value.length==1?q.value[0]:q.value.find(o=>o.code==t||o.barcode==t||o.variants.some(u=>u.barcode.toUpperCase().includes(t)));e?B(e):r.notify({message:`Sin coincidencias para <b>${t}</b>`,color:"pink-5",position:"center",html:!0})}},oe=async()=>{const t=parseInt(i.value.form.count),e=parseInt(i.value.form.ipack),o={order:i.value.item.pivot._partition,product:i.value.item.id,received:t,ipack:e,checkout:!1};console.log(o);const u=await f.setReceiveProduct(o);if(console.log(u),u.status==200){let c=m.value.findIndex(re=>re.id==i.value.item.id);m.value[c].pivot.toReceived=t,m.value[c].pivot.ipack=e,i.value.state=!1,y.value="",r.notify({color:"positive",icon:"done",position:"right",message:""})}else alert(`Error ${u.status}: ${u.data}`)},ie=async()=>{r.loading.show({message:"Terminando, espera..."}),console.log(d.value.requisition._workpoint_from),E.value.state=!1;let t={id:S.params.chk,state:10,suply:d.value._suplier_id};console.log(t),console.log("... por acasito");let e=await f.nextStatePartition(t);if(console.log(e),e.status==200){if(e.data.partitionsEnd>e.data.partition.requisition._status){let u={id:e.data.partition._requisition,state:e.data.partitionsEnd};const c=await f.nextState(u);C.emit("order_refresh",{order:c.data}),console.log(c.data)}d.value._status=e.data.partition._status,d.value.status.name=e.data.partition.status.name;const o=await f.partitionFresh(e.data.partition.id);if(o.status==200){console.log(o.data),C.emit("orderpartition_refresh",{order:o.data.order});let u=await j.value>0?f.sendMessageDiff(o.data.order):"";if(d.value._warehouse=="GEN"){let c=await f.refresTransit({id:o.data.order.id});console.log(c)}console.log(u),d.value.requisition.from._type!=1?await se(o.data.order):await le(o.data.order)}else alert(`Error ${o.status}: ${o.data}`)}else console.log(e);r.loading.hide()},se=async t=>{r.loading.show({message:"Realizando Salida"});const e=await X.addEntryFS(t);console.log(e),e.fail?e.fail.status==503?(r.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),$.push("/distribute/checkin")):console.log(e):(r.notify({message:`Entrada Creada ${e.invoice_received}`,type:"positive",position:"bottom"}),C.emit("orderpartition_refresh",{order:e}),$.push("/distribute/checkin"),r.loading.hide())},le=async t=>{r.loading.show({message:"Realizando Salida"});const e=await X.endTransferFS(t);e.fail?e.fail.status==503?(r.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),$.push("/distribute/checkout")):console.log(e):(r.notify({message:`Traspaso Creado ${e.invoice_received}`,type:"positive",position:"bottom"}),C.emit("orderpartition_refresh",{order:e}),$.push("/distribute/checkout"),r.loading.hide())},ne=(t,e,o)=>U.value?B(e):null;return ge(async()=>{window.layoutReady?await N():window.addEventListener("layout-ready",async()=>{await N()},{once:!0})}),(t,e)=>(p(),x(qe,null,{default:l(()=>[a("div",Re,[s(ue,null,{default:l(()=>{var o;return[s(de,null,{default:l(()=>[v(" Pedido "+n(be(S).params.chk)+" ",1),d.value?(p(),w("span",Pe,"- "+n(d.value.requisition.from.alias),1)):h("",!0)]),_:1}),a("div",je,"Diferencias : "+n(j.value),1),(o=d.value)!=null&&o.invoice_received?(p(),w("div",Ie,[a("div",null,n(d.value.requisition.from._type==1?"Traspaso":"Entrada"),1),a("div",Te,n(d.value.invoice_received),1)])):h("",!0)]}),_:1}),s(L),a("div",ze,[a("div",Ue,[a("div",null,[e[9]||(e[9]=v("Productos: ")),a("b",null,n(m.value.length),1)]),a("div",null,[e[10]||(e[10]=v("Piezas: ")),a("b",null,n(ee.value),1)])]),_.value&&_.value.id>=5?(p(),w("div",Fe,[a("div",null,[e[11]||(e[11]=a("span",{class:"text--2"},"Contados:",-1)),e[12]||(e[12]=v()),a("b",null,n(F.value.length),1)]),a("div",null,[e[13]||(e[13]=a("span",{class:"text--2"},"Por contar:",-1)),e[14]||(e[14]=v()),a("b",null,n(Z.value.length),1)])])):h("",!0)])]),s(Ce,{"row-key":"id",rows:q.value,columns:k.value.columns,pagination:k.value.pagination,filter:k.value.filter,"visible-columns":P.value,onRowClick:ne},{top:l(()=>[a("div",Ne,[s(I,{dense:"",modelValue:k.value.filter,"onUpdate:modelValue":e[0]||(e[0]=o=>k.value.filter=o),placeholder:"Buscar","input-class":"text-uppercase",color:"pink-5"},{append:l(()=>[s(K,{name:"search"})]),_:1},8,["modelValue"]),s(Q,{color:"secondary",icon:"fas fa-eye",flat:"","no-caps":""},{default:l(()=>[s(we,{style:{"min-width":"200px"}},{default:l(()=>[s(ce,null,{default:l(()=>[(p(!0),w(H,null,G(k.value.columns,(o,u)=>O((p(),x(pe,{tag:"label",key:u},{default:l(()=>[s(M,null,{default:l(()=>[s(Y,null,{default:l(()=>[v(n(o.label),1)]),_:2},1024),s(Y,{caption:""},{default:l(()=>[v(n(o.coldesc),1)]),_:2},1024)]),_:2},1024),s(M,{side:"",top:""},{default:l(()=>[s(Qe,{color:"pink-5",modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=c=>P.value=c),val:o.name},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024)),[[ke]])),128))]),_:1})]),_:1})]),_:1})])]),_:1},8,["rows","columns","pagination","filter","visible-columns"]),s(A,{modelValue:i.value.state,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.state=o),position:"bottom",onHide:e[4]||(e[4]=o=>z.value.focus())},{default:l(()=>[i.value.item?(p(),x(J,{key:0},{default:l(()=>[s(V,{class:"bg-grey-3"},{default:l(()=>[a("div",Be,[a("div",Le,[a("div",Ae,"ID: "+n(i.value.item.id),1),a("div",Me,n(i.value.item.code),1)]),a("div",Ke,[a("div",Ge,n(i.value.item.name),1),a("div",He,n(i.value.item.barcode),1)])])]),_:1}),s(L),s(V,null,{default:l(()=>[v(n(i.value.item.description),1)]),_:1}),s(V,{class:"row justify-around items-center bg-grey-2"},{default:l(()=>[(p(!0),w(H,null,G(i.value.item.stocks,o=>(p(),w("div",{key:o.id,class:"text-center"},[a("div",Oe,n(o.pivot.gen),1),a("div",Ye,n(o.alias),1)]))),128))]),_:1}),s(Se,{onSubmit:ye(oe,["prevent"])},{default:l(()=>[s(V,null,{default:l(()=>[a("div",Je,[a("div",We,[e[15]||(e[15]=a("div",null,"Solicitud",-1)),a("div",Xe,n(i.value.item.pivot.amount)+" "+n(i.value.item.pivot._supply_by==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:i.value.item.pivot._supply_by==2?`Docena${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`),1)]),a("div",Ze,[e[16]||(e[16]=a("div",null,"Salida",-1)),v(" "+n(i.value.item.pivot.toDelivered)+" ",1),a("div",et,[v(n(i.value.item.pivot.toDelivered)+" "+n(i.value.item.pivot._supply_by==3?`Caja${i.value.item.pivot.amount!=1?"s":""}`:i.value.item.pivot._supply_by==2?`Docena${i.value.item.pivot.amount!=1?"s":""}`:`Pieza${i.value.item.pivot.amount!=1?"s":""}`)+" ",1),a("small",null,"("+n(i.value.item.pivot._supply_by==3?i.value.item.pivot.toDelivered*i.value.item.pivot.ipack:i.value.item.pivot.toDelivered)+" pzs)",1)])]),a("div",tt,[e[17]||(e[17]=a("div",null,"PxC",-1)),a("div",at,n(i.value.item.pivot.ipack),1)]),a("div",ot,[e[18]||(e[18]=a("div",null,"Conteo",-1)),s(I,{dense:"",borderless:"",modelValue:i.value.form.count,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.form.count=o),type:"number",min:"0","input-class":"text-h6 text-center",ref_key:"iptcounter",ref:R},null,8,["modelValue"])]),a("div",it,[e[19]||(e[19]=a("div",null,"Piezas",-1)),a("div",st,n(i.value.item.pivot._supply_by==3?i.value.form.count*i.value.form.ipack:i.value.item.pivot._supply_by==2?i.value.form.count*12:i.value.form.count),1)])])]),_:1}),s(Q,{color:"indigo",type:"submit",square:"",icon:"done","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1})]),_:1})):h("",!0)]),_:1},8,["modelValue"]),s(A,{modelValue:E.value.state,"onUpdate:modelValue":e[5]||(e[5]=o=>E.value.state=o)},{default:l(()=>[s(J,null,{default:l(()=>[s(V,{class:"row items-start"},{default:l(()=>[s(_e,{icon:"warning",color:"orange-14","text-color":"white"}),a("div",lt,[e[20]||(e[20]=a("div",{class:"text-h6"},"Quieres finalizar la revision?",-1)),e[21]||(e[21]=a("div",null,"EL pedido ya no podra editarse y se emitira una entrada...",-1)),a("div",nt,"Diferencias: "+n(j.value),1)])]),_:1}),s($e,{align:"right"},{default:l(()=>[O(s(Q,{flat:"",label:"No",color:"primary","no-caps":""},null,512),[[Ve]]),s(Q,{flat:"",label:"Si",color:"primary",onClick:ie})]),_:1})]),_:1})]),_:1},8,["modelValue"]),U.value?(p(),x(W,{key:0,bordered:"",class:"bg-indigo-10 text-dark q-pa-sm row",elevated:""},{default:l(()=>[s(I,{color:"white",modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=o=>y.value=o),type:"text",class:"col","input-class":"text-white text-h6 text-center text-uppercase",autofocus:"",dense:"",onKeypress:he(ae,["enter"]),ref_key:"iptfinder",ref:z},{prepend:l(()=>[s(K,{name:"fas fa-barcode",color:"white"})]),append:l(()=>[s(Q,{flat:"",icon:"fas fa-eraser",color:"white",dense:"",onClick:e[6]||(e[6]=o=>y.value=""),disabled:!y.value.length},null,8,["disabled"])]),_:1},8,["modelValue"]),F.value.length>0?(p(),x(Q,{key:0,color:"white","text-color":"indigo-10",label:"Finalizar",icon:"done",onClick:e[8]||(e[8]=o=>E.value.state=!0),"no-caps":""})):h("",!0)]),_:1})):h("",!0),_.value&&_.value.id!=9?(p(),x(W,{key:1,bordered:"",class:"bg-orange-9 text-white"},{default:l(()=>[a("div",rt,n(_.value.name),1)]),_:1})):h("",!0)]),_:1}))}};export{Jt as default};
