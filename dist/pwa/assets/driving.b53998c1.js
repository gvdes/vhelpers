import{Q as R}from"./QInput.80370726.js";import{Q as E}from"./QForm.5d6a5f12.js";import{a as _,d as I}from"./QSelect.5fff77db.js";import{Q as D,a as N,e as F,d as z}from"./QList.a94945a7.js";import{Q as A}from"./QTable.4bc1bc5c.js";import{Q as T}from"./QPage.af1a1659.js";import{Q as j,a as k}from"./QCard.c8c57353.js";import{aH as H,a as L,u as U,r as x,c as M,o as y,g as G,e,w as a,a3 as J,f as m,an as K,a4 as S,d as O,ak as p,a0 as f,Q as b,am as W}from"./index.3d87faec.js";import{Q as X}from"./QCardActions.f86dd132.js";import{C as Y}from"./ClosePopup.a3b86a29.js";import"./dayjs.min.cbcf888d.js";import{R as g}from"./RestockApi.556fdbae.js";import{u as Z}from"./Restock.bad58839.js";import{u as tt}from"./axios.a3ede753.js";import{$sktRestock as C}from"./socket.3fae67a0.js";import{_ as et}from"./PrinterSelect.7d3d9817.js";import"./QLinearProgress.c3270b77.js";import"./QCheckbox.38dbb6bc.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.b39cfb39.js";const ot={class:"flex justify-center"},at={class:"text-center",style:"width: 50%;"},st={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},it={class:"text-bold"},Pt={__name:"driving",setup(rt){H();const P=L(),u=Z(),l=tt(),c=U(),n=x(null),V=x({rowsPerPage:[0]}),r=x({state:!1,val:null}),w=M(()=>u.partitions.filter(i=>{const t=["chf","amc","vld","root","jch","gce"].includes(c.session.rol),o=i.requisition.from.id==c.session.store.id_viz,s=i.requisition.to.id==c.session.store.id_viz,d=["gen","aux","alm","root","recp","gce"].includes(c.session.rol);return t&&s?i._status===6:o&&d?i._status===7:!1})),$=async()=>{u.setTitle("En Camino"),u.setButtonShow(!1)},q=async i=>{l.loading.show({message:"..."}),console.log(i.ip),console.log(r.value);const t=await g.printForPartition({ip:i.ip,port:i._port,_partition:r.value.val.id,_workpoint_to:r.value.val._workpoint_to});console.log(t),t.status==200?(t.data?l.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):l.notify({message:`Sin conexion a <b>${i.name} <small>(${i.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),l.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},Q=async()=>{if(w.value.findIndex(t=>t.id==n.value)>=0){l.loading.show({message:"Cambiando Estado"});let t=Number(u.partitions.find(d=>d.id==n.value)._status)+Number(1),o={partition:n.value,chofi:c.session.credentials.staff.id,state:t};console.log(o);let s=null;if(t==7?s=await g.SaveChofi(o):t==8&&(s=await g.saveReceipt(o)),console.log(s),s.status==200){let d=u.partitions.findIndex(v=>v.id==s.data.partition.id);if(d>=0){if(u.partitions.splice(d,1,s.data.partition),s.data.partitionsEnd>s.data.partition.requisition._status){let v={id:s.data.partition._requisition,state:s.data.partitionsEnd};const h=await g.nextState(v);C.emit("order_refresh",{order:h.data}),console.log(h.data)}C.emit("orderpartition_refresh",{order:s.data.partition})}n.value=null,r.value={state:!1,val:null},t==8&&P.push("/distribute/checkin"),l.loading.hide()}else alert(`Error ${s.status}: ${s.data} 2`)}else l.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),n.value=null};$();const B=i=>{switch(i){case 4:return"bg-blue-11";case 7:return"bg-red-11";case 5:return"bg-purple-11";case 9:return"bg-green-11";case 23:return"bg-yellow-11";case 13:return"bg-coffe-11";default:return""}};return(i,t)=>(y(),G(J,null,[e(T,{padding:""},{default:a(()=>[m("div",null,[m("div",ot,[m("div",at,[e(E,{onSubmit:Q},{default:a(()=>[e(R,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),e(A,{rows:w.value,"row-key":"name",grid:"",pagination:V.value,"hide-bottom":""},{item:a(o=>[m("div",st,[e(N,{bordered:"",class:K(B(o.row.requisition.from.id))},{default:a(()=>[S((y(),O(z,{clickable:"",onClick:()=>{r.value.state=!0,r.value.val=o.row}},{default:a(()=>[e(F,null,{default:a(()=>[e(_,{class:"text-center text-bold"},{default:a(()=>[p(f(o.row.id),1)]),_:2},1024),e(_,{class:"text-center text-overline text-caption"},{default:a(()=>[m("span",it,f(o.row.requisition.from.name),1),p(" (P: "+f(o.row.requisition.id)+")",1)]),_:2},1024),e(_,{class:"text-center text-bold"},{default:a(()=>[p(f(o.row.status.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[W]])]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),e(D,{modelValue:r.value.state,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value.state=o),persistent:""},{default:a(()=>[e(j,null,{default:a(()=>[e(k,{class:"text-bold text-h5 items-center"},{default:a(()=>[p(" Particion "+f(r.value.val.id),1)]),_:1}),e(k,{class:"text-center"},{default:a(()=>t[3]||(t[3]=[p(" Que Desesas Hacer ? ")])),_:1}),e(X,{align:"center"},{default:a(()=>[S(e(b,{flat:"",icon:"close",color:"negative"},null,512),[[Y]]),e(b,{flat:"",icon:"print",color:"primary"},{default:a(()=>[e(I,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[e(et,{onSelectedPartition:q,partition:!0})]),_:1})]),_:1}),e(b,{flat:"",icon:"send",color:"positive",onClick:t[1]||(t[1]=()=>{n.value=r.value.val.id,Q()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Pt as default};
