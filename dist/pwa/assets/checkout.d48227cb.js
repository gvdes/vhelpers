import{Q as I}from"./QInput.bb35ed2f.js";import{Q as R}from"./QForm.5ec54b32.js";import{a as k,Q as A,d as N}from"./QSelect.9889a937.js";import{Q as $,a as T,e as F,d as U}from"./QList.eb8278b8.js";import{Q as L}from"./QBadge.1538f847.js";import{Q as z}from"./QTable.f8043fde.js";import{Q as M}from"./QPage.21bedb3a.js";import{aI as j,a as G,u as H,r as m,c as O,o as h,g as Y,e as o,w as s,a3 as J,f as n,ak as K,a4 as y,d as W,al as p,a0 as d,am as X,Q as f,an as Z}from"./index.55af4c22.js";import{Q as v}from"./QCardSection.c56eb11d.js";import{Q as V}from"./QCardActions.d9a34e26.js";import{Q as S}from"./QCard.87a66689.js";import{C as tt}from"./ClosePopup.a28b2b06.js";import"./dayjs.min.cbcf888d.js";import{R as _}from"./RestockApi.211a66fa.js";import{u as et}from"./Restock.b393fd6f.js";import{u as ot}from"./use-quasar.c7466d1e.js";import{$sktRestock as P}from"./socket.05630e21.js";import{_ as at}from"./PrinterSelect.1ebb9eeb.js";import"./use-key-composition.e50ba1dc.js";import"./QLinearProgress.052fbeb7.js";import"./QCheckbox.b0b99c1c.js";import"./use-checkbox.a9839774.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.808164a9.js";import"./QToolbar.0c28ad56.js";import"./QRadio.48719c93.js";import"./QTd.8a1f25cb.js";import"./QPopupEdit.29891855.js";import"./QTr.13b49d0b.js";import"./QLayout.9882fc11.js";import"./QScrollObserver.b3c54605.js";import"./QResizeObserver.f0209c2d.js";import"./QDrawer.262a4c4a.js";import"./QExpansionItem.5289560f.js";import"./jspdf.plugin.autotable.d642b748.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */import"./QBtnGroup.04c74151.js";const st={class:"flex justify-center"},it={class:"text-center",style:"width: 50%;"},lt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},rt={class:"text-bold"},nt={class:"q-mx-sm text-h6"},Kt={__name:"checkout",setup(ut){j();const b=G(),c=et(),l=ot(),C=H(),r=m(null),q=m({rowsPerPage:[0]}),i=m({state:!1,val:null}),u=m({state:!1,val:null,opts:["GEN","EMP"]}),w=O(()=>c.partitions.filter(a=>a._status==4||a._status==5&&a.requisition._workpoint_to==C.session.store.id_viz)),B=async()=>{c.setShowLYT(!0),c.setTitle("Verificacion"),c.setButtonShow(!1),c.setButtonShowAdd(!1)},D=async a=>{l.loading.show({message:"..."}),console.log(a.ip),console.log(i.value);const e=await _.printForPartition({ip:a.ip,port:a._port,_partition:i.value.val.id,_workpoint_to:i.value.val._workpoint_to});console.log(e),e.status==200?(e.data?l.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):l.notify({message:`Sin conexion a <b>${a.name} <small>(${a.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),l.loading.hide()):(console.error(e),alert(`Error ${e.status}: ${e.data}`))},g=async()=>{i.value.val&&(r.value=i.value.val.id),console.log(r.value);let a=w.value.find(e=>e.id==r.value);if(console.log(a._blocked),a._blocked!=1)if(a._status==5)b.push(`/distribute/checkout/${a.id}`);else if(a._status==4){l.loading.show({message:"Terminando, espera..."});let e={id:a.id,state:5,suply:a._suplier_id};console.log(e);let t=await _.nextStatePartition(e);if(console.log(t),t.status==200){if(console.log(a.requisition._status),t.data.partitionsEnd>t.data.partition.requisition._status){let x={id:t.data.partition._requisition,state:t.data.partitionsEnd};const Q=await _.nextState(x);P.emit("order_refresh",{order:Q.data}),console.log(Q.data)}P.emit("orderpartition_refresh",{order:t.data.partition}),b.push(`/distribute/checkout/${t.data.partition.id}`)}else console.log(t),alert(t.data.message);l.loading.hide()}else l.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),r.value=null;else l.notify({message:"El pedido se esta validando",type:"negative",position:"bottom"}),r.value=null},E=a=>{let e=a.status==4?"11":"10",t=a.status==4?"text-dark":"text-white";switch(a.requisition.from.id){case 4:return`bg-blue-${e} ${t}`;case 7:return`bg-red-${e} ${t}`;case 5:return`bg-purple-${e} ${t}`;case 9:return`bg-green-${e} ${t}`;case 23:return`bg-yellow-${e} ${t}`;case 13:return`bg-brown-${e} ${t}`;default:return"text-dark"}};return B(),(a,e)=>(h(),Y(J,null,[o(M,{padding:""},{default:s(()=>[n("div",null,[n("div",st,[n("div",it,[o(R,{onSubmit:g},{default:s(()=>[o(I,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),o(z,{rows:w.value,"row-key":"name",grid:"",pagination:q.value,"hide-bottom":""},{item:s(t=>[n("div",lt,[o(T,{bordered:"",class:K(E(t.row))},{default:s(()=>[y((h(),W(U,{clickable:"",onClick:()=>{i.value.state=!0,i.value.val=t.row}},{default:s(()=>[o(F,null,{default:s(()=>[o(k,{class:"text-center text-bold"},{default:s(()=>[p(d(t.row.id),1)]),_:2},1024),o(k,{class:"text-center text-overline text-caption"},{default:s(()=>[n("span",rt,d(t.row.requisition.from.name),1),p(" "+d(`P-${t.row.requisition.id}`),1)]),_:2},1024)]),_:2},1024),n("div",null,[o(L,{color:t.row._blocked?"negative":"positive"},null,8,["color"])])]),_:2},1032,["onClick"])),[[Z]]),n("div",null,"( "+d(t.row.status.name)+" )",1)]),_:2},1032,["class"])])]),_:1},8,["rows","pagination"])])]),_:1}),o($,{modelValue:u.value.state,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.state=t)},{default:s(()=>[o(S,null,{default:s(()=>[o(v,{class:"row items-center"},{default:s(()=>[o(X,{icon:"warning",color:"orange-14","text-color":"white"}),n("span",nt,"Iniciar CheckOut #"+d(r.value.id),1)]),_:1}),o(v,null,{default:s(()=>[o(A,{modelValue:u.value.val,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.val=t),options:u.value.opts,label:"Almacen Destino",filled:""},null,8,["modelValue","options"])]),_:1}),o(V,{vertical:"",align:"center"},{default:s(()=>[o(f,{flat:"",label:"Si",color:"primary",onClick:g,disable:u.value.val==null},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o($,{modelValue:i.value.state,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value.state=t),persistent:""},{default:s(()=>[o(S,null,{default:s(()=>[o(v,{class:"text-bold text-h5 items-center"},{default:s(()=>[p(" Particion "+d(i.value.val.id),1)]),_:1}),o(v,{class:"text-center"},{default:s(()=>e[4]||(e[4]=[p(" Que Desesas Hacer ? ")])),_:1}),o(V,{align:"center"},{default:s(()=>[y(o(f,{flat:"",icon:"close",color:"negative"},null,512),[[tt]]),o(f,{flat:"",icon:"print",color:"primary"},{default:s(()=>[o(N,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:s(()=>[o(at,{onSelectedPartition:D,partition:!0})]),_:1})]),_:1}),o(f,{flat:"",icon:"send",color:"positive",onClick:g})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Kt as default};
