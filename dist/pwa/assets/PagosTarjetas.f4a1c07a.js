import{b as r}from"./QList.357bdae8.js";import{Q as L}from"./QHeader.762a2a31.js";import{u as O,r as v,c as C,o as H,d as P,w as n,e as s,f as l,S as q,a0 as y,Q as S}from"./index.0fdaff4d.js";import{Q as M}from"./QSelect.cbeeb7c7.js";import{Q as K}from"./QToolbar.6df42c8a.js";import{Q as b}from"./QCardSection.00fbc919.js";import{Q as k}from"./QCard.2a654ec9.js";import{Q as U}from"./QInput.fe7dff6e.js";import{Q as z}from"./QForm.0bd41dac.js";import{Q as w}from"./QTable.8cf7a817.js";import{Q as G}from"./QPage.64195f4d.js";import{Q as W,a as X}from"./QLayout.f49b40ee.js";import{_ as Y}from"./UserToolbar.ca24bffd.js";import{b as Z}from"./axios.7d24dc86.js";import{e as A}from"./export-file.041709e1.js";import{u as ee}from"./use-quasar.3538a447.js";import"./jspdf.plugin.autotable.224ed27d.js";import"./use-key-composition.b41d6ff8.js";import"./QResizeObserver.cdf99542.js";import"./QLinearProgress.883b4630.js";import"./QCheckbox.1d3959e7.js";import"./QScrollObserver.dcb03ea8.js";import"./QDrawer.e40ea7c6.js";import"./QCardActions.bc87cb95.js";import"./ClosePopup.315b6bfc.js";import"./auth.c6bef323.js";import"./_commonjsHelpers.88e99c8f.js";const te={class:"row"},ae={class:"q-mb-lg row"},oe={class:"text-center text-h6"},se={class:"text-center text-h6"},le={class:"text-center text-h6"},ne={class:"row"},ie={class:"col"},re={class:"row"},ce={class:"row"},ue={class:"col"},de={class:"row"},me={class:"col"},fe={class:"row"},pe={class:"col"},Pe={__name:"PagosTarjetas",setup(ve){const N=O(),c=ee(),h=v(null),i=v([]),Q=v([]),u=v({val:"SELECCIONA CAJA",opts:[]}),_=v([{name:"bauchers",label:"Baucher",field:a=>a}]),m=v([{name:"terminal",label:"Caja",align:"left",field:a=>a.TERMINAL},{name:"ticket",label:"Ticket",field:a=>a.TICKET},{name:"total",label:"Total",field:a=>a.TARJETAS},{name:"fecha",label:"Fecha",field:a=>a.FECHA},{name:"hora",label:"Hora",field:a=>a.HORA},{name:"cliente",label:"Cliente",align:"left",field:a=>a.CLIENTE}]),f=C(()=>u.value.val?Q.value.filter(a=>a.TERMINAL==u.value.val.DESTER):[]),E=C(()=>{if(i.value.length>0){let a=[...i.value];return f.value.filter(o=>{const e=a.indexOf(o.TARJETAS);return e!==-1?(a.splice(e,1),!0):!1})}else return[]}),x=C(()=>{if(i.value.length>0){let a=[...i.value];return f.value.filter(o=>{const e=a.indexOf(o.TARJETAS);return e!==-1?(a.splice(e,1),!1):!0})}else return f.value}),T=C(()=>{let a=[...f.value];return i.value.filter(o=>{const e=a.findIndex(t=>t.TARJETAS===o);return e!==-1?(a.splice(e,1),!1):!0})}),j=()=>{if(h.value){i.value.unshift(h.value),h.value=null;const a=$(T.value,x.value);a.length>0?(c.notify({message:`Se encontr\xF3 una coincidencia: Combinaci\xF3n: ${a[0].combinacion.map(o=>o).join(" + ")} = ${a[0].monto}, Ticket: ${a[0].ticket}`,type:"positive",position:"center"}),i.value.unshift(a[0].monto),a[0].combinacion.forEach(o=>{const e=i.value.findIndex(t=>t==o);e!==-1&&i.value.splice(e,1)})):console.log("No se encontraron coincidencias.")}},B=async()=>{console.log("Recibiendo Datos :)"),c.loading.show({message:"Obteniendo datos"});let o=`http://${N.session.store.ip_address}/access/public/reports/getCashCard`;Z.get(o).then(e=>{console.log(e),Q.value=e.data.formaspagos,u.value.opts=e.data.terminales,c.loading.hide()}).catch(e=>console.log(e))},R=()=>{const a=[_.value.map(e=>p(e.label))].concat(T.value.map(e=>_.value.map(t=>p(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);A("SobrantesBauchers.csv",a,"text/csv")!==!0?c.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):c.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},F=()=>{const a=[m.value.map(e=>p(e.label))].concat(x.value.map(e=>m.value.map(t=>p(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);A("BucherFaltantes.csv",a,"text/csv")!==!0?c.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):c.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},I=()=>{const a=[m.value.map(e=>p(e.label))].concat(E.value.map(e=>m.value.map(t=>p(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);A("BauchersEncontrados.csv",a,"text/csv")!==!0?c.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):c.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},p=(a,o,e)=>{let t=o!==void 0?o(a,e):a;return t=t==null?"":String(t),t=t.split('"').join('""'),/^\d{1,2}-\d{4}$/.test(t)&&(t=`'${t}`),`"${t}"`},$=(a,o)=>{const e=V(a),t=[];return e.forEach(d=>{const D=d.reduce((g,J)=>Number(g)+Number(J),0);o.forEach(g=>{g.TARJETAS==D&&t.push({combinacion:d,ticket:g.TICKET,monto:g.TARJETAS})})}),t},V=a=>{const o=[];for(let e=0;e<1<<a.length;e++){const t=[];for(let d=0;d<a.length;d++)e&1<<d&&t.push(a[d]);t.length>0&&o.push(t)}return o};return B(),(a,o)=>(H(),P(W,{view:"hHh Lpr fFf"},{default:n(()=>[s(X,null,{default:n(()=>[s(G,{padding:""},{default:n(()=>[s(L,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[s(Y),s(r)]),_:1}),s(K,{class:"justify-between"},{default:n(()=>[l("div",null,[o[2]||(o[2]=l("span",{class:"text-grey"},"Helpers",-1)),s(q,{name:"navigate_next",color:"primary"}),o[3]||(o[3]=l("span",{class:"text-h6"},"Tarjetas",-1))]),l("div",te,[s(M,{modelValue:u.value.val,"onUpdate:modelValue":o[0]||(o[0]=e=>u.value.val=e),options:u.value.opts,"option-label":"DESTER",label:"Caja",outlined:"",dense:""},null,8,["modelValue","options"])])]),_:1}),l("div",ae,[s(k,{class:"my-card col",bordered:""},{default:n(()=>[s(b,null,{default:n(()=>o[4]||(o[4]=[l("div",{class:"text-h6"},"Bauchers",-1)])),_:1}),s(b,null,{default:n(()=>[l("div",oe,"$ "+y(i.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0)),1)]),_:1})]),_:1}),s(r,{spaced:"",inset:"",vertical:"",dark:""}),s(k,{class:"my-card col"},{default:n(()=>[s(b,null,{default:n(()=>o[5]||(o[5]=[l("div",{class:"text-h6"},"Cobros",-1)])),_:1}),s(b,null,{default:n(()=>[l("div",se,"$ "+y(f.value.reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0)),1)]),_:1})]),_:1}),s(r,{spaced:"",inset:"",vertical:"",dark:""}),s(k,{class:"my-card col"},{default:n(()=>[s(b,null,{default:n(()=>o[6]||(o[6]=[l("div",{class:"text-h6"},"Diferencia",-1)])),_:1}),s(b,null,{default:n(()=>[l("div",le,"$ "+y(Number(Number(i.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0))-Number(f.value.reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0))).toFixed(2)),1)]),_:1})]),_:1})]),s(z,{onSubmit:j,class:"q-gutter-md"},{default:n(()=>[s(U,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=e=>h.value=e),type:"number",label:"IMPORTE",outlined:"",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md",disable:u.value.val=="SELECCIONA CAJA"},null,8,["modelValue","disable"])]),_:1}),s(r,{spaced:"",inset:"",vertical:"",dark:""}),l("div",ne,[l("div",null,[s(w,{title:"LISTA",rows:i.value,"row-key":"name",columns:_.value,pagination:{rowsPerPage:9},"hide-bottom":""},null,8,["rows","columns"])]),s(r,{spaced:"",inset:"",vertical:"",dark:""}),l("div",ie,[l("div",re,[s(w,{title:"Bauchers Faltantes",rows:T.value,"row-key":"name",class:"col",columns:_.value},{"top-right":n(()=>[l("div",ce,[s(r,{spaced:"",inset:"",vertical:"",dark:""}),l("div",ue,[s(S,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:R,disable:!(T.value.length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"]),s(r,{spaced:"",inset:"",vertical:"",dark:""}),s(w,{title:"Cobros Faltantes",rows:x.value,"row-key":"name",class:"col",columns:m.value},{"top-right":n(()=>[l("div",de,[s(r,{spaced:"",inset:"",vertical:"",dark:""}),l("div",me,[s(S,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:F,disable:!(x.value.length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])]),s(r,{spaced:"",inset:"",vertical:"",dark:""}),s(w,{title:"Cobros Encontrados",rows:E.value,"row-key":"name",columns:m.value},{"top-right":n(()=>[l("div",fe,[s(r,{spaced:"",inset:"",vertical:"",dark:""}),l("div",pe,[s(S,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:I,disable:!(E.value.length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])])])]),_:1})]),_:1})]),_:1}))}};export{Pe as default};
