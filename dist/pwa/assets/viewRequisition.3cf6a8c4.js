import{Q as I}from"./QInput.ae6dc5c4.js";import{Q as L}from"./QSeparator.970ad44f.js";import{r as _,c as V,t as j,q as z,o as u,g as b,e,w as t,a1 as h,u as G,aD as H,i as J,f as Q,a as C,h as N,Q as k,a3 as n,a0 as R,a2 as K,a4 as f}from"./index.d6535de1.js";import{Q as x,a as r}from"./QItemSection.db0401dc.js";import{Q as B}from"./QList.bed8137d.js";import{Q as W}from"./QPage.4498dc94.js";import{Q as X,a as U}from"./QCard.eab9b540.js";import{Q as Y}from"./QCardActions.60a5f8a8.js";import{Q as Z}from"./QDialog.5e34c3f3.js";import{C as ee}from"./ClosePopup.1d106147.js";import{u as te}from"./VDB.6b3d0108.js";import{u as oe}from"./use-quasar.505fcb9f.js";import{u as ae,r as $}from"./requisitionApi.164313b9.js";import{i as se}from"./resoursesApi.a3328345.js";import"./use-key-composition.3e547522.js";import"./uid.42677368.js";import"./axios.d0e8637f.js";import"./axios.f1f32898.js";const le={class:"row"},ke={__name:"viewRequisition",setup(ne){const d=te(),m=oe(),S=G(),O=H(),p=_(!1),i=ae(),y=O.params.oid,c=_(null),g=_([]),v=_(""),w=V(()=>v.value.length<=0?g.value:g.value.filter(o=>o.description.toLowerCase().includes(v.value.toLowerCase()))),D=V(()=>w.value.some(o=>o.amount>0)),P=V(()=>w.value.filter(o=>o.amount>0)),T=async()=>{m.loading.show({message:"Obteniendo Datos"});const o=await $.getRequisition(d.session.store.id,y);o.status!==200?console.log(o):(m.loading.hide(),console.log(o),c.value=o.data,A(),i.setTitle(`${o.data.notes||y}`),i.setShowCreateButton(!1),i.setShowOrders(!1))},A=async()=>{const o=await se.getAssortmentInsumos();o.error?console.log(o):(console.log(o),g.value=o,c.value.bodie.length>0&&g.value.forEach(a=>{const s=c.value.bodie.find(l=>l.code===a.code);console.log(s),s?a.amount=s.amount:a.amount=0}))},E=async()=>{m.loading.show({message:"Cerrando Pedido"});let o={id:y,products:P.value};const a=await $.finishRequisition(o);a.status!=200?console.log(a):(S.push("/assortment"),m.loading.hide())};return j(()=>{d.session.rol=="aux"||d.session.rol=="gen"||d.session.rol=="aud"||d.session.rol=="root"?T():(m.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),S.replace("/"))}),z(()=>{i.setTitle("Pedidos Insumos"),i.setShowCreateButton(!0),i.setShowOrders(!0)}),(o,a)=>(u(),b(h,null,[e(W,{padding:""},{default:t(()=>{var s;return[J("div",le,[e(I,{class:"col",modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=l=>v.value=l),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),Q(D)?(u(),C(L,{key:0,spaced:"",inset:"",vertical:"",dark:""})):N("",!0),Q(D)?(u(),C(k,{key:1,color:"primary",flat:"",dense:"",icon:"send",onClick:a[1]||(a[1]=l=>p.value=!p.value),disable:((s=c.value)==null?void 0:s._status)>1},null,8,["disable"])):N("",!0)]),e(L,{spaced:"",inset:"",vertical:"",dark:""}),e(B,null,{default:t(()=>[e(x,null,{default:t(()=>[e(r,null,{default:t(()=>[n("Codigo")]),_:1}),e(r,null,{default:t(()=>[n("Descripcion")]),_:1}),e(r,null,{default:t(()=>[n("Cantidad")]),_:1})]),_:1})]),_:1}),(u(!0),b(h,null,R(Q(w),(l,F)=>(u(),C(B,{bordered:"",key:F},{default:t(()=>[e(x,null,{default:t(()=>[e(r,null,{default:t(()=>[n(f(l.code),1)]),_:2},1024),e(r,null,{default:t(()=>[n(f(l.description),1)]),_:2},1024),e(r,null,{default:t(()=>{var q;return[e(I,{modelValue:l.amount,"onUpdate:modelValue":M=>l.amount=M,type:"number",filled:"",disable:((q=c.value)==null?void 0:q._status)>1},null,8,["modelValue","onUpdate:modelValue","disable"])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1}),e(Z,{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=s=>p.value=s),persistent:""},{default:t(()=>[e(X,{style:{width:"500px"}},{default:t(()=>[e(U,{class:"text-bold text-h6 text-center"},{default:t(()=>[n(" Se Creara Pedido ")]),_:1}),e(U,null,{default:t(()=>[(u(!0),b(h,null,R(Q(P),(s,l)=>(u(),C(B,{key:l,bordered:""},{default:t(()=>[e(x,null,{default:t(()=>[e(r,null,{default:t(()=>[n(f(s.code),1)]),_:2},1024),e(r,null,{default:t(()=>[n(f(s.description),1)]),_:2},1024),e(r,null,{default:t(()=>[n(f(s.amount),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(Y,{align:"right"},{default:t(()=>[K(e(k,{flat:"",label:"Cancel",color:"primary"},null,512),[[ee]]),e(k,{flat:"",label:"Crear",color:"primary",onClick:E})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ke as default};
