import{Q as h}from"./QInput.f6fa87e6.js";import{Q as D}from"./QSeparator.8a831898.js";import{u as H,a as M,aH as j,r as g,c as w,p as z,m as G,o as u,g as b,e,w as a,a3 as y,f as J,d as Q,h as q,Q as V,ak as n,a2 as I,a4 as K,a0 as m}from"./index.d87ba090.js";import{Q as W,a as k,b as B,d as r}from"./QList.9f6b0a46.js";import{Q as X}from"./QPage.ce47e99b.js";import{Q as L}from"./QCardSection.f84172c8.js";import{Q as Y}from"./QCardActions.fa9275b3.js";import{Q as Z}from"./QCard.e3958f52.js";import{C as ee}from"./ClosePopup.b4d916ee.js";import{u as te}from"./use-quasar.eba3be69.js";import{u as ae}from"./layoutStore.61f4f5f2.js";import{r as R}from"./requisitionApi.320258ae.js";import{i as oe}from"./resoursesApi.c76e9ad4.js";import"./use-key-composition.3243082c.js";import"./use-dark.af54e05c.js";import"./axios.a1a5c455.js";const le={class:"row"},ye={__name:"viewRequisition",setup(se){const U=H(),f=te(),$=M(),N=j(),c=g(!1),i=ae(),C=N.params.oid,d=g(null),p=g([]),v=g(""),_=w(()=>v.value.length<=0?p.value:p.value.filter(o=>o.description.toLowerCase().includes(v.value.toLowerCase()))),S=w(()=>_.value.some(o=>o.amount>0)),x=w(()=>_.value.filter(o=>o.amount>0)),O=async()=>{f.loading.show({message:"Obteniendo Datos"});const o=await R.getRequisition(U.session.store.id,C);o.status!==200?console.log(o):(f.loading.hide(),console.log(o),d.value=o.data,T(),i.setTitle(`${o.data.notes||C}`),i.setShowCreateButton(!1),i.setShowOrders(!1))},T=async()=>{const o=await oe.getAssortmentInsumos();o.error?console.log(o):(console.log(o),p.value=o,d.value.bodie.length>0&&p.value.forEach(t=>{const l=d.value.bodie.find(s=>s.code===t.code);console.log(l),l?t.amount=l.amount:t.amount=0}))},A=async()=>{f.loading.show({message:"Cerrando Pedido"});let o={id:C,products:x.value};const t=await R.finishRequisition(o);t.status!=200?console.log(t):($.push("/assortment"),f.loading.hide())};return z(()=>{O()}),G(()=>{i.setTitle("Pedidos Insumos"),i.setShowCreateButton(!0),i.setShowOrders(!0)}),(o,t)=>(u(),b(y,null,[e(X,{padding:""},{default:a(()=>{var l;return[J("div",le,[e(h,{class:"col",modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),S.value?(u(),Q(D,{key:0,spaced:"",inset:"",vertical:"",dark:""})):q("",!0),S.value?(u(),Q(V,{key:1,color:"primary",flat:"",dense:"",icon:"send",onClick:t[1]||(t[1]=s=>c.value=!c.value),disable:((l=d.value)==null?void 0:l._status)>1},null,8,["disable"])):q("",!0)]),e(D,{spaced:"",inset:"",vertical:"",dark:""}),e(k,null,{default:a(()=>[e(B,null,{default:a(()=>[e(r,null,{default:a(()=>t[3]||(t[3]=[n("Codigo")])),_:1}),e(r,null,{default:a(()=>t[4]||(t[4]=[n("Descripcion")])),_:1}),e(r,null,{default:a(()=>t[5]||(t[5]=[n("Cantidad")])),_:1})]),_:1})]),_:1}),(u(!0),b(y,null,I(_.value,(s,E)=>(u(),Q(k,{bordered:"",key:E},{default:a(()=>[e(B,null,{default:a(()=>[e(r,null,{default:a(()=>[n(m(s.code),1)]),_:2},1024),e(r,null,{default:a(()=>[n(m(s.description),1)]),_:2},1024),e(r,null,{default:a(()=>{var P;return[e(h,{modelValue:s.amount,"onUpdate:modelValue":F=>s.amount=F,type:"number",filled:"",disable:((P=d.value)==null?void 0:P._status)>1},null,8,["modelValue","onUpdate:modelValue","disable"])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1}),e(W,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=l=>c.value=l),persistent:""},{default:a(()=>[e(Z,{style:{width:"500px"}},{default:a(()=>[e(L,{class:"text-bold text-h6 text-center"},{default:a(()=>t[6]||(t[6]=[n(" Se Creara Pedido ")])),_:1}),e(L,null,{default:a(()=>[(u(!0),b(y,null,I(x.value,(l,s)=>(u(),Q(k,{key:s,bordered:""},{default:a(()=>[e(B,null,{default:a(()=>[e(r,null,{default:a(()=>[n(m(l.code),1)]),_:2},1024),e(r,null,{default:a(()=>[n(m(l.description),1)]),_:2},1024),e(r,null,{default:a(()=>[n(m(l.amount),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(Y,{align:"right"},{default:a(()=>[K(e(V,{flat:"",label:"Cancel",color:"primary"},null,512),[[ee]]),e(V,{flat:"",label:"Crear",color:"primary",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ye as default};
