import{u as fe,aE as pe,r as A,c as ve,o as S,a as V,w as l,h as Y,e as t,Q as y,ak as me,f as i,a4 as p,a3 as d,Y as H,g as ge,a0 as xe,a1 as ye,a2 as j,b3 as _e,a6 as we}from"./index.3b7adfdb.js";import{Q as be}from"./QToolbar.3a332d50.js";import{Q as N}from"./QSeparator.d4c94cee.js";import{Q as he}from"./QHeader.8c923cc6.js";import{Q as I,a as v}from"./QItemSection.ac61c254.js";import{Q as O}from"./QList.e8a6f904.js";import{Q as R,a as Q}from"./QCard.5dd63e54.js";import{Q as q}from"./QCardActions.f10e633b.js";import{Q as U}from"./QDialog.862b13eb.js";import{Q as ke}from"./QFooter.f2f18940.js";import{Q as Ce}from"./QPage.caff941b.js";import{u as Pe}from"./VDB.145c67ef.js";import{u as Ee}from"./use-quasar.9b4b2037.js";import{d as Fe}from"./dayjs.min.cbcf888d.js";import{E as Ae,a as X}from"./jspdf.plugin.autotable.f8d21b32.js";import{t as P}from"./transferApi.1b309022.js";import{E as W}from"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{P as Se,d as Ie}from"./ProductsAutocomplete.3627bb50.js";import"./QResizeObserver.39665fa7.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.ba7b1b0e.js";import"./axios.9ab26c22.js";import"./QInput.95e7beed.js";import"./use-key-composition.9f88c70f.js";import"./uid.937d8ee7.js";import"./QSelect.7d9106bb.js";import"./position-engine.9823335b.js";import"./rtl.276c3f1b.js";/* empty css                                                                         */const Qe={class:"row items-center"},Te={class:"col"},De={class:"col"},Ve={class:"text-h6"},Ne={class:"text-center text-bold"},Oe={class:"text-center text-bold row"},Re={class:"col"},$e={class:"col"},Ue={class:"col"},Be={class:"text-center text-h4"},Me={class:"text-center text-h6 text-grey-14"},ze={class:"text-center"},Ge={class:"q-pa-xs"},Le={class:"row"},Ye={class:"col column q-py-md"},kt={__name:"viewTransfer",setup(He){const $=fe(),E=pe(),F=Pe(),r=Ee(),m=A(null),n=A({val:null,state:!1}),g=A([]),w=A({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),_=A({state:!1,encontrados:[],faltantes:[],products:null}),B=A(null),M=A(null),J=ve(()=>{var s;return((s=g.value)==null?void 0:s.filter(e=>{var o;return e.product==((o=n.value.val)==null?void 0:o.product)}).length)>0}),Z=async()=>{const s=E.params.oid,e=await P.getTransfer(s);e.fail?console.log(e):(console.log(e),F.session.rol=="aud"||(F.session.rol=="aux"||F.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||F.session.rol=="alm"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(m.value=e,g.value=e.bodie,console.log(m.value)):($.push("/transfers"),r.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},K=s=>{console.log(s)},ee=s=>{let e=g.value.findIndex(o=>o.product==s.code);console.log(e),e>=0?r.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(n.value.val={product:s.code,description:s.description,amount:1},n.value.state=!0,console.log(s))},te=async()=>{r.loading.show({message:"Insertando Producto"}),console.log(n.value.val),n.value.val._transfer=E.params.oid;const s=await P.addProduct(n.value.val);s.fail?console.log(s):(console.log(s),g.value.push(n.value.val),n.value={val:null,state:!1},r.loading.hide())},le=async()=>{r.loading.show({message:"Editando Producto"}),console.log(n.value.val),n.value.val._transfer=E.params.oid;const s=await P.editProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value[e].amount=n.value.val.amount,r.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},r.loading.hide())}},ae=async()=>{r.loading.show({message:"Eliminando Producto"}),console.log(n.value.val),n.value.val._transfer=E.params.oid;const s=await P.removeProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value.splice(e,1),r.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},r.loading.hide())}},oe=s=>{n.value.state=!0,n.value.val=s},z=()=>{n.value={val:null,state:!1}},se=async()=>{r.loading.show({message:"Terminando Traspaso"});let s={user:F.session.name,traspaso:m.value,products:g.value};const e=await P.endTransfer(s);e.fail?console.log(e):(r.notify({message:e,position:"center",type:"positive"}),console.log(e),r.loading.hide(),$.push("/transfers"))},ne=()=>{B.value.click()},ie=async()=>{let s=document.getElementById("inputFile").files[0],e=new W.Workbook,o=[],a={};e.xlsx.load(s).then(T=>{let b=e.worksheets[0],h=b.getColumn("A");b.getColumn("B"),h.eachCell({includeEmpty:!0},function(x,f){let k=x.value,C=b.getCell(`B${f}`),D=parseFloat(C.value);a[k]?a[k]+=D:a[k]=D});let c=Object.keys(a).map(x=>({codigo:x,cantidad:a[x]}));if(c.forEach(x=>o.push(x.codigo)),o.length){let x={codes:o,_workpoint:F.session.store.id_viz};r.loading.show({message:"Procesando archivo, espera.."}),Ie.getMassive(x).then(f=>{let k=f.data;k.fails.notFound.map(u=>w.value.wndNotExist.push(u)),k.fails.repeat.map(u=>w.value.repeat.push(u));let C=f.data.products;w.value.wndGetRows=C.length,w.value.state=!w.value.state,console.log(C);let D=C.map(u=>{let L=c.find(ce=>ce.codigo===u.code);return{product:u.code,description:u.description,amount:L?L.cantidad:0,_transfer:E.params.oid}});G(D),r.loading.hide()}).catch(f=>{console.log(f),r.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},re=()=>{M.value.click()},de=async()=>{let s=document.getElementById("inputFilePreventa").files[0],e=new W.Workbook,o=[];e.xlsx.load(s).then(async a=>{let b=e.worksheets[0].getColumn("A");if(r.loading.show({message:"Procesando archivo, espera.."}),b.eachCell({includeEmpty:!0},function(h,c){h.value&&o.push(h.value)}),o.length){let h={codes:o,_workpoint:F.session.store.id_viz};console.log(h);const c=await P.transferPreventa(h);if(c.fail)alert(c);else{_.value.encontrados=c.Encontrados,_.value.faltantes=c.Faltantes,_.value.products=c.products.length,_.value.state=!_.value.state,c.products.forEach(f=>f._transfer=E.params.oid);let x=c.products;console.log(x),G(x),r.loading.hide()}}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},G=async s=>{const e=await P.addProductMasive(s);e.fail?console.log(e):(console.log(e),s.map(o=>{g.value.push(o)}),r.loading.hide())},ue=async()=>{const s=E.params.oid,e=await P.getTransfer(s);if(console.log(e),e.error)console.error("No se logro imprimir la factura");else{const a=new Ae({format:"letter"});let T=[];const b=e.bodie.map(c=>Object.values([c.product,c.description,c.amount]));console.log(typeof e.code_fs);const h=Math.ceil(b.length/20);for(var o=0;o<b.length;o+=20)T.push(b.slice(o,o+20));console.log(T);for(let c=0;c<2;c++){let x="ORIGINAL";c>0&&(x="COPIA",a.addPage()),T.forEach(function(f,k){k>0&&a.addPage();let C=0;for(let u=0;u<f.length;u++)f[u][0]=f[u][0],f[u][1]=f[u][1],f[u][2]=parseFloat(f[u][2]),C+=parseFloat(f[u][2]);for(let u=0;u<f.length;u++);a.setFontSize(25),a.setFont("helvetica","bold"),a.text("GRUPO VIZCARRA",105,10,"center"),a.setFontSize(8),a.setFontSize(12),a.text(x,185,10,"left"),a.text("LLUVIA LIGTH SA DE CV",10,25,"left"),a.setFontSize(8),a.text(e.created_by,10,30,"left"),a.text(e.notes,10,35,"left"),a.text("DELEG, CUAUHTEMOC CDMX",10,40,"left"),a.text("DOCUMENTO",10,55,"left"),a.text("TRASPASO",10,60,"left"),a.text("NUMERO",32,55,"left"),a.text(String(e.code_fs),32,60,"left"),a.text("PAGINA",54,55,"left"),a.text(`${k+1} de ${h}`,54,60,"left"),a.text("FECHA",76,55,"left");const D=Fe(e.created_at).format("YYYY-MM-DD");a.text(D,76,60,"left"),X(a,{startX:10,startY:65,theme:"plain",styles:{cellPadding:1,fontSize:12,halign:"center"},head:[["Almacen de Origen","Almacen de Destino"]],body:[[`(${e.origin.alias}) ${e.origin.name}`,`(${e.destiny.alias}) ${e.destiny.name}`]]}),X(a,{startX:10,startY:80,theme:"striped",styles:{cellPadding:.6,fontSize:8,halign:"center"},head:[["ARTICULO","DESCRIPCION","CANTIDAD"]],body:f,columnStyles:{0:{fontStyle:"bold",halign:"left"},1:{fontStyle:"bold",halign:"left"},4:{halign:"center"}}}),a.setFontSize(11),a.text("TOTAL UNIDDADES:",150,200,"left"),a.text(C.toString(),190,200,"left"),a.text("Firma Almacen Origen",12,224),a.text("Firma Almacen Destino",82,224),a.text("Firma Chofer",152,224),a.rect(10,220,60,40),a.rect(80,220,60,40),a.rect(150,220,60,40)})}a.save(`Traspaso${e.code_fs}`)}};return Z(),(s,e)=>m.value?(S(),V(Ce,{key:0,padding:""},{default:l(()=>[t(he,{reveal:"",bordered:"",class:"bg-white text-black"},{default:l(()=>[t(be,{class:"justify-between"},{default:l(()=>[t(y,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=o=>me($).push("/transfers")),round:""}),i("div",null,p(m.value.store.name),1),i("div",Qe,[i("div",Te,p(m.value.origin.name),1),e[7]||(e[7]=d()),t(H,{name:"arrow_forward",class:"col"}),i("div",De,p(m.value.destiny.name),1)]),i("div",null,p(m.value.created_by),1),i("div",null,[e[8]||(e[8]=d("Traspaso ")),t(H,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=d()),i("span",Ve,p(m.value.code_fs),1)])]),_:1}),t(N),i("div",Ne,p(m.value.notes),1),t(N),i("div",Oe,[i("div",Re,[t(y,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:ne})]),i("div",$e,[t(y,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:re})]),i("div",Ue,[t(y,{color:"primary",icon:"picture_as_pdf",label:"PDF",flat:"",onClick:ue})]),i("input",{type:"file",ref_key:"inputFile",ref:B,id:"inputFile",onInput:ie,hidden:"",accept:".xlsx,.xls"},null,544),i("input",{type:"file",ref_key:"inputFilePreventa",ref:M,id:"inputFilePreventa",onInput:de,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(O,{bordered:""},{default:l(()=>[t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[10]||(e[10]=[d(" Producto ")])),_:1}),t(v,null,{default:l(()=>e[11]||(e[11]=[d(" Descripcion ")])),_:1}),t(v,{class:"text-center"},{default:l(()=>e[12]||(e[12]=[d(" Cantidad ")])),_:1})]),_:1})]),_:1}),(S(!0),ge(ye,null,xe(g.value,(o,a)=>(S(),V(O,{bordered:"",key:a},{default:l(()=>[j((S(),V(I,{clickable:"",onClick:T=>oe(o)},{default:l(()=>[t(v,null,{default:l(()=>[d(p(o.product),1)]),_:2},1024),t(v,null,{default:l(()=>[d(p(o.description),1)]),_:2},1024),t(v,{class:"text-center"},{default:l(()=>[d(p(o.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[we]]),t(N)]),_:2},1024))),128)),t(U,{modelValue:n.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.state=o),persistent:"",position:"bottom"},{default:l(()=>[t(R,{style:{width:"300","max-width":"40vw"}},{default:l(()=>[t(Q,null,{default:l(()=>[i("div",Be,p(n.value.val.product),1),i("div",Me,p(n.value.val.description),1)]),_:1}),t(Q,null,{default:l(()=>[i("div",ze,[i("div",Ge,[e[13]||(e[13]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",Le,[t(y,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=o=>n.value.val.amount>1?n.value.val.amount--:"")}),i("div",Ye,[j(i("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=o=>n.value.val.amount=o),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[_e,n.value.val.amount]])]),t(y,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=o=>n.value.val.amount++)})])])])]),_:1}),J.value?(S(),V(q,{key:1,align:"center"},{default:l(()=>[t(y,{flat:"",icon:"close",color:"red-10",onClick:z}),t(y,{flat:"",label:"Eliminar",color:"negative",onClick:ae}),t(y,{flat:"",label:"Editar",color:"blue-10",onClick:le})]),_:1})):(S(),V(q,{key:0,align:"center"},{default:l(()=>[t(y,{flat:"",label:"Cancelar",color:"negative",onClick:z}),t(y,{flat:"",label:"Agregar",color:"positive",onClick:te})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:w.value.state,"onUpdate:modelValue":e[5]||(e[5]=o=>w.value.state=o)},{default:l(()=>[t(R,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[14]||(e[14]=[d(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(O,{bordered:""},{default:l(()=>[t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[15]||(e[15]=[d("Productos Encontrados")])),_:1}),t(v,null,{default:l(()=>[d(p(w.value.wndGetRows),1)]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[16]||(e[16]=[d("Productos Sin Datos")])),_:1}),t(v,null,{default:l(()=>[d(p(w.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:_.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>_.value.state=o)},{default:l(()=>[t(R,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[17]||(e[17]=[d(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(O,{bordered:""},{default:l(()=>[t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[18]||(e[18]=[d("Pedidos Encontrados")])),_:1}),t(v,null,{default:l(()=>[d(p(_.value.encontrados),1)]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[19]||(e[19]=[d("Pedidos Sin Encontrar")])),_:1}),t(v,null,{default:l(()=>[d(p(_.value.faltantes),1)]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[20]||(e[20]=[d("Productos Encontrados")])),_:1}),t(v,null,{default:l(()=>[d(p(_.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ke,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:l(()=>[t(R,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:l(()=>[t(Q,{class:"row"},{default:l(()=>[t(Se,{class:"col",checkState:!1,onInput:K,onAgregar:ee}),g.value.length>0?(S(),V(y,{key:0,color:"primary",flat:"",icon:"east",onClick:se,round:""})):Y("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0)}};export{kt as default};
