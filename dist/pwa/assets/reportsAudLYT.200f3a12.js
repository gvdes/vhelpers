import{b as k,a as we,d as ye,e as re}from"./QList.3ab20964.js";import{Q as xe}from"./QHeader.51c1a8b5.js";import{a as Ne,u as Ce,r as w,c as _,o as B,d as ce,w as s,e as t,f as E,ak as L,I as C,Q as M,g as Qe,a2 as he,a3 as Ve,b6 as O,aI as R,a4 as De,a0 as _e,am as Me}from"./index.1ea72c5d.js";import{Q as Se}from"./QToolbarTitle.089ba2d3.js";import{d as de,Q as F,a as Ye}from"./QSelect.d838039d.js";import{Q as Be}from"./QToggle.e822b4d6.js";import{Q as Ee}from"./QDate.55f55b01.js";import{Q as ue}from"./QToolbar.acaf800a.js";import{Q as Le}from"./axios.787ddc3d.js";import{Q as Oe}from"./QCard.6d73bb3c.js";import{Q as Re}from"./QInput.bd131565.js";import{Q as Fe}from"./QTable.2e97b9be.js";import{Q as Te}from"./QPage.e0562f28.js";import{Q as Ue,a as Ae}from"./QLayout.33a02b54.js";import{u as Ie}from"./use-quasar.63954dec.js";import{r as me}from"./reportApi.733eb12a.js";import{E as je}from"./exceljs.min.9e24d01d.js";import{d as y}from"./dayjs.min.cbcf888d.js";import{c as Xe}from"./_commonjsHelpers.88e99c8f.js";import{_ as Pe}from"./UserToolbar.a192f9bf.js";import"./QDrawer.0f9428ff.js";import"./QCardActions.f5e8ece4.js";import"./jspdf.plugin.autotable.114679fa.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./ClosePopup.a8e12a93.js";import"./QResizeObserver.c5b85e62.js";import"./QCheckbox.9646dc4c.js";import"./use-render-cache.3aae9b27.js";import"./date.e1c0e507.js";import"./QLinearProgress.54dd51f6.js";import"./QScrollObserver.256b86fe.js";import"./auth.2fc42e00.js";var pe={exports:{}};(function(T,U){(function(u,p){T.exports=p()})(Xe,function(){var u="week",p="year";return function(Q,x,f){var g=x.prototype;g.week=function(o){if(o===void 0&&(o=null),o!==null)return this.add(7*(o-this.week()),"day");var m=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var N=f(this).startOf(p).add(1,p).date(m),S=f(this).endOf(u);if(N.isBefore(S))return 1}var Y=f(this).startOf(p).date(m).startOf(u).subtract(1,"millisecond"),h=this.diff(Y,u,!0);return h<0?f(this).startOf("week").week():Math.ceil(h)},g.weeks=function(o){return o===void 0&&(o=null),this.week(o)}}})})(pe);var $e=pe.exports;const ha={__name:"reportsAudLYT",setup(T){y.extend($e),Ne();const U=Ce(),u=Ie(),p=new Date,Q=w(y(p).format("YYYY/MM/DD")),x=w([{id:1,label:"PERSONALIZADA",active:!0},{id:2,label:"DIA",active:!1},{id:3,label:"SEMANA",active:!1},{id:4,label:"MES",active:!1}]),f=w(y(p).format("YYYY/MM/DD")),g=w([]),o=w({seccion:null,familia:null,categoria:null}),m=w([]),N=w({columns:[{name:"code",label:"Codigo",field:a=>a.code,align:"left"},{name:"description",label:"Descripcion",field:a=>a.description,align:"left"},{name:"cb",label:"CB",field:a=>a.barcode,align:"left"},{name:"section",label:"Seccion",field:a=>a.category.familia.seccion.name,align:"left"},{name:"family",label:"Familia",field:a=>a.category.familia.name,align:"left"},{name:"category",label:"Categoria",field:a=>a.category.name,align:"left"},{name:"provider",label:"Proveedor",field:a=>a.providers.name,align:"left"},{name:"pxc",label:"PXC",field:a=>a.pieces,align:"center"},{name:"ultll",label:"Ultima_LL",field:a=>{var e,l;return a.purchases.length?y((l=a.purchases)==null?void 0:l.reduce((n,v)=>new Date(v.created_at)>new Date(n)?v.created_at:n,(e=a.purchases[0])==null?void 0:e.created_at)).format("YYYY/MM/DD"):null},align:"left"},{name:"purchase",label:"Compras",field:a=>a.purchases.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0),align:"center"},{name:"purchasexc",label:"Compras X C",field:a=>Number(Number(a.purchases.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0))/Number(a.pieces)).toFixed(2),align:"center"},{name:"sales",label:"Ventas",field:a=>Number(a.sales.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0)),align:"center"},{name:"salesxc",label:"Ventas X C",field:a=>Number(Number(a.sales.reduce((e,l)=>{var n;return e+Number((n=l.pivot)==null?void 0:n.amount)},0))/Number(a.pieces)).toFixed(2),align:"center"},{name:"stock",label:"Stock",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.stock},align:"center"},{name:"stockxc",label:"Stock X C",field:a=>{var e,l;return Number(Number((l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.stock)/Number(a.pieces)).toFixed(2)},align:"center"},{name:"min",label:"Minimo",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.min},align:"center"},{name:"max",label:"Maximo",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.max},align:"center"},{name:"in_transit",label:"En Transito",field:a=>{var e,l;return(l=(e=a.stocks[0])==null?void 0:e.pivot)==null?void 0:l.in_transit},align:"center"},{name:"centro",label:"Centro",field:a=>{var e;return(e=a.prices.find(l=>l.id==6).pivot)==null?void 0:e.price},align:"center"},{name:"especial",label:"Especial",field:a=>{var e;return(e=a.prices.find(l=>l.id==5).pivot)==null?void 0:e.price},align:"center"},{name:"caja",label:"Caja",field:a=>{var e;return(e=a.prices.find(l=>l.id==4).pivot)==null?void 0:e.price},align:"center"},{name:"docena",label:"Docena",field:a=>{var e;return(e=a.prices.find(l=>l.id==3).pivot)==null?void 0:e.price},align:"center"},{name:"mayoreo",label:"Mayoreo",field:a=>{var e;return(e=a.prices.find(l=>l.id==2).pivot)==null?void 0:e.price},align:"center"},{name:"menudeo",label:"Menudeo",field:a=>{var e;return(e=a.prices.find(l=>l.id==1).pivot)==null?void 0:e.price},align:"center"}],filter:null}),S=_(()=>x.value.filter(a=>a.active).length>0),Y=_(()=>g.value.filter(a=>a.deep==0)),h=_(()=>{let a=g.value.filter(e=>e.deep==1);return o.value.seccion?a.filter(e=>e.root==o.value.seccion.id):a}),fe=_(()=>{let a=g.value.filter(e=>e.deep==2);return o.value.familia?a.filter(e=>e.root==o.value.familia.id):a}),ve=async()=>{u.loading.show({message:"Obteniendo Categorias"});const a=await me.init();a.fail?console.log(a):(g.value=a,u.loading.hide())},be=async()=>{u.loading.show({message:"Obteniendo Datos"});let a,e=x.value.find(v=>v.active);switch(e.id){case 1:a=f.value;break;case 2:a=Q.value;break;case 3:a=y(Q.value).week();break;case 4:a=y(Q.value).month()+1;break}let l={workpoint:U.session.store,time:e,range:a,filters:o.value};console.log(l);const n=await me.obtReport(l);n.fail?console.log(n):(console.log(n),m.value=n,u.loading.hide())},ge=()=>{m.value=[],o.value.familia=null,o.value.categoria=null},ke=()=>{const a=new je.Workbook,e=a.addWorksheet("Reporte");let l=m.value.map(i=>{var V,D,b,I,j,X,P,$,q,H,W,G,J,Z,z,K,ee,ae,le,te,ie,oe,ne,se;return{Codigo:i.code,Descripcion:i.description,CB:i.barcode,Seccion:i.category.familia.seccion.name,Familia:i.category.familia.name,Categoria:i.category.name,Proveedor:i.providers.name,PXC:i.pieces,Ultima_LL:i.purchases.length?y((D=i.purchases)==null?void 0:D.reduce((r,d)=>new Date(d.created_at)>new Date(r)?d.created_at:r,(V=i.purchases[0])==null?void 0:V.created_at)).format("YYYY/MM/DD"):null,Compras:i.purchases.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0),"Compras X C":Number(Number(Number(i.purchases.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0))/Number(i.pieces)).toFixed(2)),Ventas:Number(i.sales.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0)),"Ventas X C":Number(Number(Number(i.sales.reduce((r,d)=>{var c;return r+Number((c=d.pivot)==null?void 0:c.amount)},0))/Number(i.pieces)).toFixed(2)),Stock:(I=(b=i.stocks[0])==null?void 0:b.pivot)==null?void 0:I.stock,"Stock X C":Number(Number(Number((X=(j=i.stocks[0])==null?void 0:j.pivot)==null?void 0:X.stock)/Number(i.pieces)).toFixed(2)),Minimo:($=(P=i.stocks[0])==null?void 0:P.pivot)==null?void 0:$.min,Maximo:(H=(q=i.stocks[0])==null?void 0:q.pivot)==null?void 0:H.max,"En Transito":(G=(W=i.stocks[0])==null?void 0:W.pivot)==null?void 0:G.in_transit,Centro:(Z=(J=i.prices.find(r=>r.id==6))==null?void 0:J.pivot)==null?void 0:Z.price,Especial:(K=(z=i.prices.find(r=>r.id==5))==null?void 0:z.pivot)==null?void 0:K.price,Caja:(ae=(ee=i.prices.find(r=>r.id==4))==null?void 0:ee.pivot)==null?void 0:ae.price,Docena:(te=(le=i.prices.find(r=>r.id==3))==null?void 0:le.pivot)==null?void 0:te.price,Mayoreo:(oe=(ie=i.prices.find(r=>r.id==2))==null?void 0:ie.pivot)==null?void 0:oe.price,Menudeo:(se=(ne=i.prices.find(r=>r.id==1))==null?void 0:ne.pivot)==null?void 0:se.price}});const n=Object.keys(l[0]).map(i=>({name:i,filterButton:!0})),v=l.map(i=>Object.values(i));e.addTable({name:"Reporte",ref:"A1",headerRow:!0,style:{showRowStripes:!0},columns:n,rows:v}),(async()=>{const i=await a.xlsx.writeBuffer(),V=new Blob([i],{type:"application/octet-stream"}),D=URL.createObjectURL(V),b=document.createElement("a");b.href=D,b.download="Reporte.xlsx",document.body.appendChild(b),b.click(),document.body.removeChild(b)})()};return ve(),(a,e)=>(B(),ce(Ue,{view:"hHh Lpr fFf"},{default:s(()=>[t(xe,{class:"transparent text-dark",bordered:""},{default:s(()=>[t(Pe),t(k),t(k)]),_:1}),t(k,{spaced:"",inset:"",vertical:"",dark:""}),t(Ae,{class:"q-ml-sm"},{default:s(()=>[t(Te,{padding:""},{default:s(()=>[t(Oe,{class:"my-card"},{default:s(()=>[t(Le,null,{default:s(()=>[t(ue,null,{default:s(()=>{var l;return[t(Se,null,{default:s(()=>[E("div",null,[e[8]||(e[8]=E("span",{class:"text-grey"},"Helpers",-1)),e[9]||(e[9]=L()),t(C,{name:"navigate_next",color:"primary"}),e[10]||(e[10]=L()),e[11]||(e[11]=E("span",{class:"text-h6"},"Reportes Auditoria",-1))])]),_:1}),t(M,{flat:"",round:"",dense:"",icon:"apps",class:"q-mr-xs"},{default:s(()=>[t(de,null,{default:s(()=>[t(we,{style:{"min-width":"100px"}},{default:s(()=>[(B(!0),Qe(Ve,null,he(x.value,(n,v)=>De((B(),ce(ye,{tag:"label",key:v},{default:s(()=>[t(re,null,{default:s(()=>[t(Ye,null,{default:s(()=>[L(_e(n.label),1)]),_:2},1024)]),_:2},1024),t(re,{side:"",top:""},{default:s(()=>[t(Be,{color:"primary",modelValue:n.active,"onUpdate:modelValue":A=>n.active=A,val:"friend",disable:S.value&&!n.active},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)]),_:2},1024)),[[Me]])),128))]),_:1})]),_:1})]),_:1}),t(M,{flat:"",round:"",dense:"",icon:"event",disable:((l=x.value.find(n=>n.active))==null?void 0:l.id)!=1},{default:s(()=>[t(de,null,{default:s(()=>[t(Ee,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),range:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"])]}),_:1}),t(k,{spaced:"",inset:"",vertical:"",dark:""}),t(ue,{class:"row"},{default:s(()=>[t(F,{class:"col",modelValue:o.value.seccion,"onUpdate:modelValue":[e[2]||(e[2]=l=>o.value.seccion=l),ge],options:Y.value,label:"Seccion","option-label":"name",filled:"",dense:""},O({_:2},[o.value.seccion?{name:"append",fn:s(()=>[t(C,{name:"cancel",onClick:e[1]||(e[1]=R(()=>{o.value.familia=null,o.value.categoria=null,o.value.seccion=null},["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),t(k,{spaced:"",inset:"",vertical:"",dark:""}),t(F,{class:"col",modelValue:o.value.familia,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.familia=l),options:h.value,label:"Familia","option-label":"name",filled:"",dense:"",disable:!o.value.seccion},O({_:2},[o.value.familia?{name:"append",fn:s(()=>[t(C,{name:"cancel",onClick:e[3]||(e[3]=R(()=>{o.value.familia=null,o.value.categoria=null},["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","disable"]),t(k,{spaced:"",inset:"",vertical:"",dark:""}),t(F,{class:"col",modelValue:o.value.categoria,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.categoria=l),options:fe.value,label:"Categoria","option-label":"name",filled:"",dense:"",disable:!o.value.familia},O({_:2},[o.value.categoria?{name:"append",fn:s(()=>[t(C,{name:"cancel",onClick:e[5]||(e[5]=R(()=>{o.value.categoria=null},["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","disable"]),t(k,{spaced:"",inset:"",vertical:"",dark:""}),t(M,{color:"primary",icon:"send",flat:"",disabled:!o.value.seccion,onClick:be},null,8,["disabled"])]),_:1})]),_:1})]),_:1}),t(Fe,{rows:m.value,columns:N.value.columns},{"top-right":s(()=>[t(Re,{borderless:"",dense:"",debounce:"300",modelValue:N.value.filter,"onUpdate:modelValue":e[7]||(e[7]=l=>N.value.filter=l),placeholder:"Buscar",disable:m.value.length<=0},{append:s(()=>[t(C,{name:"search"})]),_:1},8,["modelValue","disable"]),t(M,{color:"primary",icon:"download",onClick:ke,flat:"",disable:m.value.length<=0},null,8,["disable"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})]),_:1}))}};export{ha as default};
