import{Q as r}from"./QSeparator.576aefcb.js";import{r as h,c as w,o as O,a as H,w as l,e as o,i as n,Y as P,a4 as k,f as d,Q as A}from"./index.9e166c6b.js";import{Q as q}from"./QSelect.c68b4bde.js";import{Q as M}from"./QToolbar.18c9bb48.js";import{Q as K}from"./QHeader.aaffdf4d.js";import{Q as S,a as b}from"./QCard.acd96016.js";import{Q as U}from"./QInput.322e590b.js";import{Q as Y}from"./QForm.8d3869da.js";import{Q as E}from"./QTable.464bf889.js";import{Q as z}from"./QPage.1263fb6b.js";import{Q as G,a as W}from"./QLayout.a7ccc454.js";import{u as X}from"./VDB.af0cccff.js";import{_ as Z}from"./UserToolbar.958b5e9f.js";import{a as ee}from"./axios.f1f32898.js";import{e as Q}from"./export-file.dc78ba05.js";import{u as te}from"./use-quasar.98ac0588.js";import"./jspdf.plugin.autotable.89bab503.js";import"./use-key-composition.9a3df10d.js";import"./uid.42677368.js";import"./position-engine.0b062b42.js";import"./QDialog.048bb1ad.js";import"./rtl.b51694b1.js";import"./QResizeObserver.0b4f18ea.js";import"./QList.ec0c8653.js";import"./QLinearProgress.dd1d6084.js";import"./QCheckbox.784332fa.js";import"./QCardActions.07a471d6.js";import"./ClosePopup.08498697.js";import"./_commonjsHelpers.88e99c8f.js";const ae=n("span",{class:"text-grey"},"Helpers",-1),oe=n("span",{class:"text-h6"},"Tarjetas",-1),se={class:"row"},ne={class:"q-mb-lg row"},le=n("div",{class:"text-h6"},"Bauchers",-1),ie={class:"text-center text-h6"},re=n("div",{class:"text-h6"},"Cobros",-1),ce={class:"text-center text-h6"},de=n("div",{class:"text-h6"},"Diferencia",-1),ue={class:"text-center text-h6"},me={class:"row"},fe={class:"col"},pe={class:"row"},ve={class:"row"},he={class:"col"},be={class:"row"},_e={class:"col"},ge={class:"row"},xe={class:"col"},We={__name:"PagosTarjetas",setup(Te){const j=X(),c=te(),_=h(null),i=h([]),N=h([]),u=h({val:"SELECCIONA CAJA",opts:[]}),x=h([{name:"bauchers",label:"Baucher",field:a=>a}]),f=h([{name:"terminal",label:"Caja",align:"left",field:a=>a.TERMINAL},{name:"ticket",label:"Ticket",field:a=>a.TICKET},{name:"total",label:"Total",field:a=>a.TARJETAS},{name:"fecha",label:"Fecha",field:a=>a.FECHA},{name:"hora",label:"Hora",field:a=>a.HORA},{name:"cliente",label:"Cliente",align:"left",field:a=>a.CLIENTE}]),p=w(()=>u.value.val?N.value.filter(a=>a.TERMINAL==u.value.val.DESTER):[]),y=w(()=>{if(i.value.length>0){let a=[...i.value];return p.value.filter(s=>{const e=a.indexOf(s.TARJETAS);return e!==-1?(a.splice(e,1),!0):!1})}else return[]}),T=w(()=>{if(i.value.length>0){let a=[...i.value];return p.value.filter(s=>{const e=a.indexOf(s.TARJETAS);return e!==-1?(a.splice(e,1),!1):!0})}else return p.value}),C=w(()=>{let a=[...p.value];return i.value.filter(s=>{const e=a.findIndex(t=>t.TARJETAS===s);return e!==-1?(a.splice(e,1),!1):!0})}),B=()=>{if(_.value){i.value.unshift(_.value),_.value=null;const a=V(C.value,T.value);a.length>0?(c.notify({message:`Se encontr\xF3 una coincidencia: Combinaci\xF3n: ${a[0].combinacion.map(s=>s).join(" + ")} = ${a[0].monto}, Ticket: ${a[0].ticket}`,type:"positive",position:"center"}),i.value.unshift(a[0].monto),a[0].combinacion.forEach(s=>{const e=i.value.findIndex(t=>t==s);e!==-1&&i.value.splice(e,1)})):console.log("No se encontraron coincidencias.")}},R=async()=>{console.log("Recibiendo Datos :)"),c.loading.show({message:"Obteniendo datos"});let s=`http://${j.session.store.ip}/access/public/reports/getCashCard`;ee.get(s).then(e=>{console.log(e),N.value=e.data.formaspagos,u.value.opts=e.data.terminales,c.loading.hide()}).catch(e=>console.log(e))},F=()=>{const a=[x.value.map(e=>v(e.label))].concat(C.value.map(e=>x.value.map(t=>v(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);Q("SobrantesBauchers.csv",a,"text/csv")!==!0?c.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):c.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},I=()=>{const a=[f.value.map(e=>v(e.label))].concat(T.value.map(e=>f.value.map(t=>v(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);Q("BucherFaltantes.csv",a,"text/csv")!==!0?c.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):c.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},$=()=>{const a=[f.value.map(e=>v(e.label))].concat(y.value.map(e=>f.value.map(t=>v(typeof t.field=="function"?t.field(e):e[t.field===void 0?t.name:t.field],t.format,e)).join(","))).join(`\r
`);Q("BauchersEncontrados.csv",a,"text/csv")!==!0?c.notify({message:"Browser denied file download...",color:"negative",icon:"warning"}):c.notify({message:"Descarga Completa :)",color:"positive",icon:"check",position:"center"})},v=(a,s,e)=>{let t=s!==void 0?s(a,e):a;return t=t==null?"":String(t),t=t.split('"').join('""'),/^\d{1,2}-\d{4}$/.test(t)&&(t=`'${t}`),`"${t}"`},V=(a,s)=>{const e=D(a),t=[];return e.forEach(m=>{const J=m.reduce((g,L)=>Number(g)+Number(L),0);s.forEach(g=>{g.TARJETAS==J&&t.push({combinacion:m,ticket:g.TICKET,monto:g.TARJETAS})})}),t},D=a=>{const s=[];for(let e=0;e<1<<a.length;e++){const t=[];for(let m=0;m<a.length;m++)e&1<<m&&t.push(a[m]);t.length>0&&s.push(t)}return s};return R(),(a,s)=>(O(),H(G,{view:"hHh Lpr fFf"},{default:l(()=>[o(W,null,{default:l(()=>[o(z,{padding:""},{default:l(()=>[o(K,{class:"bg-grey-3 text-dark",bordered:""},{default:l(()=>[o(Z),o(r),o(M,{class:"justify-between"},{default:l(()=>[n("div",null,[ae,o(P,{name:"navigate_next",color:"primary"}),oe]),n("div",se,[o(q,{modelValue:u.value.val,"onUpdate:modelValue":s[0]||(s[0]=e=>u.value.val=e),options:u.value.opts,"option-label":"DESTER",label:"Caja",outlined:"",dense:""},null,8,["modelValue","options"])])]),_:1})]),_:1}),n("div",ne,[o(S,{class:"my-card col",bordered:""},{default:l(()=>[o(b,null,{default:l(()=>[le]),_:1}),o(b,null,{default:l(()=>[n("div",ie,"$ "+k(i.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0)),1)]),_:1})]),_:1}),o(r,{spaced:"",inset:"",vertical:"",dark:""}),o(S,{class:"my-card col"},{default:l(()=>[o(b,null,{default:l(()=>[re]),_:1}),o(b,null,{default:l(()=>[n("div",ce,"$ "+k(d(p).reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0)),1)]),_:1})]),_:1}),o(r,{spaced:"",inset:"",vertical:"",dark:""}),o(S,{class:"my-card col"},{default:l(()=>[o(b,null,{default:l(()=>[de]),_:1}),o(b,null,{default:l(()=>[n("div",ue,"$ "+k(Number(Number(i.value.reduce((e,t)=>Number(Number(e)+Number(t)).toFixed(2),0))-Number(d(p).reduce((e,t)=>Number(Number(e)+Number(t.TARJETAS)).toFixed(2),0))).toFixed(2)),1)]),_:1})]),_:1})]),o(Y,{onSubmit:B,class:"q-gutter-md"},{default:l(()=>[o(U,{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=e=>_.value=e),type:"number",label:"IMPORTE",outlined:"",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md",disable:u.value.val=="SELECCIONA CAJA"},null,8,["modelValue","min","disable"])]),_:1}),o(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",me,[n("div",null,[o(E,{title:"LISTA",rows:i.value,"row-key":"name",columns:x.value,pagination:{rowsPerPage:9},"hide-bottom":""},null,8,["rows","columns"])]),o(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",fe,[n("div",pe,[o(E,{title:"Bauchers Faltantes",rows:d(C),"row-key":"name",class:"col",columns:x.value},{"top-right":l(()=>[n("div",ve,[o(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",he,[o(A,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:F,disable:!(d(C).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"]),o(r,{spaced:"",inset:"",vertical:"",dark:""}),o(E,{title:"Cobros Faltantes",rows:d(T),"row-key":"name",class:"col",columns:f.value},{"top-right":l(()=>[n("div",be,[o(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",_e,[o(A,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:I,disable:!(d(T).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])]),o(r,{spaced:"",inset:"",vertical:"",dark:""}),o(E,{title:"Cobros Encontrados",rows:d(y),"row-key":"name",columns:f.value},{"top-right":l(()=>[n("div",ge,[o(r,{spaced:"",inset:"",vertical:"",dark:""}),n("div",xe,[o(A,{color:"primary",icon:"archive",dense:"","no-caps":"",flat:"",round:"",onClick:$,disable:!(d(y).length>0)},null,8,["disable"])])])]),_:1},8,["rows","columns"])])])]),_:1})]),_:1})]),_:1}))}};export{We as default};
