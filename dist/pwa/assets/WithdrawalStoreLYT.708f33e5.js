import{b as n,Q as w}from"./QList.66d9cd87.js";import{Q as j}from"./QHeader.0986a723.js";import{aH as q,a as G,u as Q,r,c as D,o as z,d as K,w as d,e as a,f,E as X,Q as c,a0 as Z,a4 as h}from"./index.83364bbe.js";import{Q as _}from"./QToolbar.5746697f.js";import{Q as E}from"./QInput.4ef6b02a.js";import{Q as O,d as ee}from"./QSelect.29a6ffa7.js";import{Q as le}from"./QDate.bdedb6a2.js";import{Q as ae}from"./QTable.82348a29.js";import{Q as te,a as oe}from"./QLayout.ead1b6f7.js";import{p as y,Q as A,a as T,j as se}from"./axios.8cf5f97a.js";import{Q as ie}from"./QForm.ec739274.js";import{Q as H}from"./QCardActions.b283e767.js";import{C as de}from"./ClosePopup.4e57b4f1.js";import"./auto.70e41793.js";import{u as ne}from"./use-quasar.5235b619.js";import{d as F}from"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.f3558280.js";import{_ as ue}from"./UserToolbar.13cc1a5e.js";import"./QResizeObserver.ab40c9ec.js";import"./use-render-cache.3aae9b27.js";import"./date.5d21659a.js";import"./QLinearProgress.c86f4fac.js";import"./QCheckbox.d33e8c99.js";import"./QScrollObserver.bdb0e91c.js";import"./_commonjsHelpers.88e99c8f.js";import"./QDrawer.06618bdd.js";import"./auth.b8ad3bac.js";const re={class:"col"},ve={class:"q-ml-sm"},Le={__name:"WithdrawalStoreLYT",setup(pe){const v=ne();q(),G(),Q();const b=Q();r([]);const N=new Date,p=r(F(N).format("YYYY-MM-DD")),m=r([]),o=r({val:null,state:!1}),u=r({val:null,opts:[]}),s=r({state:!1,val:null,body:null}),V=r([]),P=r(V.value),i=r({state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:p.value}),C=r({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:t=>t.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:t=>t.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:t=>t.NOFPRO,align:"left",sortable:!0}]}),M=D(()=>p.value&&!u.value.val?m.value.filter(t=>t.FECHA==p.value):!p.value&&u.value.val?m.value.filter(t=>t.CAJRET==u.value.val.CODTER):p.value&&u.value.val?m.value.filter(t=>t.FECHA==p.value&&t.CAJRET==u.value.val.CODTER):m.value),S=D(()=>{if(o.value){const t=m.value.find(l=>l.CODRET===o.value.val.CODRET);if(!t)return!1;let e={CAJRET:t.CAJRET,CODRET:t.CODRET,CONRET:t.CONRET,DESTER:t.DESTER,FECHA:t.FECHA,HORA:t.HORA,IMPRET:Number(t.IMPRET).toFixed(2),PROVEEDOR:{PRORET:t.PRORET,NOFPRO:t.NOFPRO}};return JSON.stringify(e)===JSON.stringify(o.value.val)}else return!0}),g=D(()=>F(N).format("YYYY-MM-DD")===F(o.value.val.FECHA).format("YYYY-MM-DD")),U=D(()=>!i.value.CONRET||!i.value.DESTER||!i.value.IMPRET||!i.value.PROVEEDOR),Y=(t,e)=>{o.value.state=!o.value.state,console.log(e);let l={CAJRET:e.CAJRET,CODRET:e.CODRET,CONRET:e.CONRET,DESTER:e.DESTER,FECHA:e.FECHA,HORA:e.HORA,IMPRET:Number(e.IMPRET).toFixed(2),PROVEEDOR:{PRORET:e.PRORET,NOFPRO:e.NOFPRO}};o.value.val={...l}},J=async()=>{let t=b.session.store.id;console.log(t);try{let e=await se.get(`/cashier/getPrinters/${t}`);e.status==200&&(s.value.body=e.data,console.log("Impresoras listas :)"))}catch(e){console.log(e),v.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},L=async()=>{console.log(b.session.store),v.loading.show({message:"Obteniendo Registros"});let e=`http://${b.session.store.ip_address}/storetools/public/api/reports/getWithdrawals`;const l=await y.get(e);l.status!=200?console.log(l):(console.log(l.data),m.value=l.data.cuts,u.value.opts=l.data.terminal,V.value=l.data.proveedores,J(),v.loading.hide())},I=async()=>{console.log(b.session.store.ip_address);let t={print:s.value.val.ip_address,codret:o.value.val.CODRET};console.log(t),v.loading.show({message:"Imprimiendo Retirada"});let l=`http://${b.session.store.ip_address}/storetools/public/api/reports/printWitrawal`;const R=await y.post(l,t);R.status!=200?console.log(R):(console.log(R.data),s.value.val=null,o.value.val=null,o.value.state=!1,v.loading.hide())},$=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),v.loading.show({message:"Modificando Retirada"});let e=`http://${b.session.store.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const l=await y.post(e,o.value.val);if(l.status!=200)console.log(l);else{console.log(l.data);let R=m.value.findIndex(k=>k.CODRET==l.data.CODRET);R>=0&&(m.value[R]=l.data),s.value.val=null,o.value.val=null,o.value.state=!1,v.loading.hide()}},B=async()=>{i.value.Print=s.value.val.ip_address,console.log(i.value),v.loading.show({message:"Agregando Anticipo"});let e=`http://${b.session.store.ip_address}/storetools/public/api/reports/addWithdrawal`;const l=await y.post(e,i.value);l.status!=200?console.log(l):(console.log(l.data),m.value.push(l.data),s.value.val=null,o.value.val=null,o.value.state=!1,v.loading.hide(),x())},x=()=>{i.value={state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:p.value}},W=(t,e,l)=>{if(t===""){e(()=>{P.value=V.value});return}e(()=>{const R=t.toLowerCase();P.value=V.value.filter(k=>k.NOFCLI.toLowerCase().includes(R))})};return L(),(t,e)=>(z(),K(te,{view:"hHh Lpr fFf"},{default:d(()=>[a(j,{class:"bg-grey-3 text-dark",bordered:""},{default:d(()=>[a(ue),a(n)]),_:1}),a(oe,null,{default:d(()=>[a(_,{class:"justify-between row"},{default:d(()=>[f("div",re,[e[21]||(e[21]=f("span",{class:"text-grey"},"Helpers",-1)),a(X,{name:"navigate_next",color:"primary"}),e[22]||(e[22]=f("span",{class:"text-h6"},"Retiradas de Cajas",-1))]),e[23]||(e[23]=f("div",{class:"col"},[f("div",{class:"row"},[f("div",{class:"col"})])],-1))]),_:1}),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(ae,{rows:M.value,filter:C.value.filter,columns:C.value.columns,onRowClick:Y},{"top-right":d(()=>[a(E,{modelValue:C.value.filter,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value.filter=l),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{modelValue:u.value.val,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.val=l),options:u.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER"},null,8,["modelValue","options"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(c,{color:"primary",icon:"event",flat:"",round:""},{default:d(()=>[a(ee,null,{default:d(()=>[a(le,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(c,{color:"primary",icon:"add",flat:"",onClick:e[3]||(e[3]=l=>i.value.state=!i.value.state)})]),_:1},8,["rows","filter","columns"])]),_:1}),a(w,{modelValue:s.value.state,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.state=l)},{default:d(()=>[a(A,{class:"my-card"},{default:d(()=>[a(T,null,{default:d(()=>e[24]||(e[24]=[f("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),a(T,null,{default:d(()=>[a(ie,{onSubmit:I,class:"q-gutter-md"},{default:d(()=>[a(O,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),f("div",null,[a(c,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(w,{modelValue:o.value.state,"onUpdate:modelValue":e[13]||(e[13]=l=>o.value.state=l),persistent:""},{default:d(()=>[a(A,{style:{width:"300px"}},{default:d(()=>[a(T,{class:"text-bold text-center text-h5"},{default:d(()=>[f("span",ve,"Retirada "+Z(o.value.val.CODRET),1)]),_:1}),a(T,null,{default:d(()=>[a(E,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.val.FECHA=l),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.HORA,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.val.HORA=l),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.val.DESTER=l),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue","disable"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.val.PROVEEDOR=l),options:V.value,label:"Proveedor",filled:"","option-label":"NOFPRO",disable:!g.value},null,8,["modelValue","options","disable"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.val.CONRET=l),type:"text",label:"Concepto",dense:"",filled:"",disable:!g.value},null,8,["modelValue","disable"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.val.IMPRET=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",disable:!g.value},null,8,["modelValue","disable"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(n,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(H,{align:"center"},{default:d(()=>[h(a(c,{flat:"",color:"negative",icon:"close"},null,512),[[de]]),a(c,{flat:"",color:"primary",icon:"print",onClick:I,disable:!s.value.val},null,8,["disable"]),a(c,{flat:"",color:"yellow",icon:"edit",disable:S.value||!g.value||!s.value.val,onClick:$},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(w,{modelValue:i.value.state,"onUpdate:modelValue":e[20]||(e[20]=l=>i.value.state=l),persistent:""},{default:d(()=>[a(A,{style:{width:"300px"}},{default:d(()=>[a(T,{class:"text-bold text-center text-h5"}),a(T,null,{default:d(()=>[a(E,{modelValue:i.value.FECHA,"onUpdate:modelValue":e[14]||(e[14]=l=>i.value.FECHA=l),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{modelValue:i.value.DESTER,"onUpdate:modelValue":e[15]||(e[15]=l=>i.value.DESTER=l),options:u.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{modelValue:i.value.PROVEEDOR,"onUpdate:modelValue":e[16]||(e[16]=l=>i.value.PROVEEDOR=l),options:P.value,label:"Proveedor",filled:"","option-label":"NOFPRO","use-input":"","input-debounce":"0",onFilter:W,dense:""},null,8,["modelValue","options"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:i.value.CONRET,"onUpdate:modelValue":e[17]||(e[17]=l=>i.value.CONRET=l),type:"text",label:"Observacion",dense:"",filled:""},null,8,["modelValue"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:i.value.IMPRET,"onUpdate:modelValue":e[18]||(e[18]=l=>i.value.IMPRET=l),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(n,{spaced:"",inset:"",vertical:"",dark:""}),a(O,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":e[19]||(e[19]=l=>s.value.val=l),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(n,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(H,{align:"center"},{default:d(()=>[a(c,{flat:"",color:"negative",icon:"close",onClick:x}),a(c,{flat:"",color:"positive",icon:"send",disable:U.value||!s.value.val,onClick:B},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Le as default};
