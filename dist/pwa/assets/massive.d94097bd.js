import{u as be,r as c,c as J,l as he,o as m,d as $,w as i,e as o,Q as f,h as Q,g as C,a3 as we,a2 as ke,f as j,al as F,a0 as ye,a4 as W}from"./index.c2f5f4e3.js";import{b as A,Q as K}from"./QList.ad92ec23.js";import{Q as I}from"./QSelect.2047fd6e.js";import{Q as g}from"./QCardSection.fed8a97e.js";import{Q as z}from"./QCard.7cc3dc50.js";import{Q as N}from"./QTable.41d37387.js";import{Q as q}from"./QCardActions.d49ddb1a.js";import{Q as Ce}from"./QPage.17984628.js";import{C as G}from"./ClosePopup.8bd06445.js";import"./QDrawer.0e1edfa0.js";import"./QExpansionItem.e926aa81.js";import"./axios.ea4a1dc9.js";import{u as Ve}from"./use-quasar.39f9e42d.js";import{u as _e}from"./warehousStore.625e70d8.js";import"./QInput.d5f95cb2.js";/* empty css                                                                         */import"./jspdf.plugin.autotable.e12e60e4.js";import{E as X}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as B}from"./locationsApi.fe76edde.js";import"./use-key-composition.a7b75bd7.js";import"./QLinearProgress.789a8ffd.js";import"./QCheckbox.d16d5612.js";import"./use-checkbox.7e1bd460.js";import"./QResizeObserver.121c3205.js";import"./QScrollObserver.e23a7fbb.js";import"./_commonjsHelpers.88e99c8f.js";const xe={key:0},Ee={key:1},De={key:0},Se={key:0,class:"row"},Ue={key:1},Qe={key:0},Ae={class:"text-left"},Ie={key:2},ul={__name:"massive",setup(Be){const w=be(),r=Ve();_e().setTitle("Acciones Masivas");const T=c([]),s=c({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),O=c(null),Y=c(null),Z=c(null),ae=c([]),L=c([]),oe=c(0),P=c(null),D=c({val:[],status:!1}),S=c({val:[],status:!1}),V=c({val:null,types:[{id:1,label:"CREAR"},{id:2,label:"ELIMINAR"}]}),U=c({val:null,opts:[{id:1,label:"CATEGORIAS"},{id:2,label:"UBICACION"},{id:3,label:"EXCEL"}]}),_=c({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),M=c({state:!1,val:!0,table:{columns:[{name:"product",label:"Producto",field:l=>l.product,align:"left"},{name:"success",label:"Estado",field:l=>l.success?"Creado":":0",align:"center"},{name:"locations",label:"",field:l=>{var e;return l.success?((e=l.locations)!=null?e:[]).map(a=>a.path).join("/"):l.error},align:"left"}]}}),ee=c({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"locations",label:"Ubicacion",field:l=>l.locations.map(e=>e.path).join("/"),align:"left"}]}),te=J(()=>s.value.all.filter(l=>l.deep==0)),se=J(()=>s.value.seccion.val.length>0?s.value.all.filter(l=>l.deep==1&&s.value.seccion.val.map(e=>e.id).includes(l.root)):s.value.all.filter(l=>l.deep==1)),ie=J(()=>{if(s.value.seccion.val.length>0&&s.value.familias.val.length==0){let l=s.value.all.filter(e=>e.deep==1&&s.value.seccion.val.map(a=>a.id).includes(e.root)).map(e=>e.id);return s.value.all.filter(e=>e.deep==2&&l.includes(e.root))}else return s.value.familias.val.length>0?s.value.all.filter(l=>l.deep==2&&s.value.familias.val.map(e=>e.id).includes(l.root)):s.value.all.filter(l=>l.deep==2)}),ne=async()=>{r.loading.show({message:"Obteniendo Secciones"});const l=await B.getInit(w.session.store.id_viz);l.fail?console.log(l):(console.log(l),T.value=l.celler,s.value.all=l.categories),r.loading.hide()},de=()=>{const l=O.value.sections||[];oe.value=Math.max(...l.map(e=>e.deep)),L.value=[{options:l.filter(e=>e.root===0),selected:null}],ae.value=L.value[0].options},le=l=>{var e;return((e=O.value.sections)==null?void 0:e.filter(a=>a.root===l))||[]},ue=(l,e)=>{L.value.splice(e+1);const a=le(l);a.length>0&&L.value.push({options:a,selected:null})},ce=async()=>{r.loading.show({message:"Obeniendo Productos"});let l={workpoint:w.session.store.id_viz,section:P.value.selected};const e=await B.obtProduct(l);e.fail?console.log(e):(console.log(e),D.value.status=!0,D.value.val=e,r.loading.hide())},re=async()=>{r.loading.show({message:"Eliminando Ubicaciones"});let l={products:D.value.val.map(a=>a.id),section:P.value.selected,id_viz:w.session.credentials.staff.id_va};console.log(l);const e=await B.deleteSectionProducts(l);e.fail?console.log(e):(console.log(e),D.value={val:[],status:!1},r.loading.hide())},pe=async()=>{var a,d,p;r.loading.show({message:"El reporte puede tardar unos minutos"});let l={workpoint:w.session.store.id_viz,sections:(a=s.value.seccion.val)==null?void 0:a.map(n=>n.id),familys:(d=s.value.familias.val)==null?void 0:d.map(n=>n.id),categories:(p=s.value.categories.val)==null?void 0:p.map(n=>n.id)};console.log(l);const e=await B.obtProductCategories(l);e.fail?console.log(e):(r.loading.hide(),console.log(e),S.value.status=!0,S.value.val=e)},ve=async()=>{r.loading.show({message:"Eliminando Ubicaciones"});let l={products:S.value.val.map(a=>({product:a.id,locations:a.locations.map(d=>d.id)})),id_viz:w.session.credentials.staff.id_va};const e=await B.deleteCategoriesLocations(l);e.fail?console.log(e):(console.log(e),console.log(e),S.value={val:[],status:!1},r.loading.hide())},me=()=>{var d;let l=(d=document.getElementById("refCreate"))==null?void 0:d.files[0],e=new X.Workbook,a={};r.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async p=>{let n=e.worksheets[0],b=n.getColumn("A");n.getColumn("B"),b.eachCell({includeEmpty:!0},function(k,x){if(x===1)return;let t=k.value,h=n.getCell(`B${x}`).value;!t||(a[t]||(a[t]=[]),a[t].includes(h)||a[t].push(h||cantidad))});let v=Object.keys(a).map(k=>({_product:k,_location:a[k],_workpoint:w.session.store.id_viz}));console.log(v);let R={products:v,id_viz:w.session.credentials.staff.id_va};const u=await B.addMassiveLocation(R);u.fail?console.log(u):(console.log(u),_.value.state=!0,_.value.val=u,r.loading.hide())})},fe=()=>{var d;let l=(d=document.getElementById("refDelete"))==null?void 0:d.files[0],e=new X.Workbook,a={};r.loading.show({message:"Importando Datos"}),e.xlsx.load(l).then(async p=>{e.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(u,k){if(k===1)return;let x=u.value;!x||(a[x]=!0)});let v=Object.keys(a).map(u=>({_product:u,_workpoint:w.session.store.id_viz}));console.log(v);let R={products:v,id_viz:w.session.credentials.staff.id_va};if(v.length){const u=await B.deleteMassiveLocation(R);u.fail?console.log(u):(console.log(u),M.value.state=!0,M.value.val=u,r.loading.hide())}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ge=async()=>{const l=new X.Workbook;T.value.forEach((p,n)=>{var x;const b=l.addWorksheet(`${p.name}_${n}`),v=p.sections||[],R=Math.max(...v.map(t=>t.deep||1)),u=[];for(let t=0;t<=R;t++)u.push(`NOMBRE_${t}`,`PATH_${t}`,`ID_${t}`);b.addRow(u);const k=(t,h)=>{const y=Array(R*3).fill("");for(let E=0;E<h.length;E++)y[E]=h[E];y[t.deep*3]=t.name,y[t.deep*3+1]=t.path,y[t.deep*3+2]=t.id,b.addRow(y),v.filter(E=>E.root===t.id).forEach(E=>k(E,y))};v.filter(t=>t.deep===0).forEach(t=>k(t,[t.name,t.path,t.path])),(x=b.columns)==null||x.forEach(t=>{let h=0;t.eachCell({includeEmpty:!0},y=>{const H=y.value?y.value.toString().length:10;H>h&&(h=H)}),t.width=h<10?10:h})});const e=await l.xlsx.writeBuffer(),a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a");d.href=URL.createObjectURL(a),d.download="almacenes.xlsx",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return ne(),he(L,l=>{const e=l.filter(a=>a.selected!==null);if(e.length){const a=e[e.length-1];le(a.selected),P.value=a}},{deep:!0}),(l,e)=>(m(),$(Ce,{padding:""},{default:i(()=>[o(z,{class:"my-card"},{default:i(()=>[o(g,{class:"row"},{default:i(()=>{var a,d;return[o(f,{icon:"download",flat:"",onClick:ge,title:"descargar Estructura"}),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(I,{dense:"",class:"col",modelValue:V.value.val,"onUpdate:modelValue":e[0]||(e[0]=p=>V.value.val=p),options:V.value.types,label:"Tipo",filled:""},null,8,["modelValue","options"]),((a=V.value.val)==null?void 0:a.id)==2?(m(),$(A,{key:0,spaced:"",inset:"",vertical:"",dark:""})):Q("",!0),((d=V.value.val)==null?void 0:d.id)==2?(m(),$(I,{key:1,dense:"",class:"col",modelValue:U.value.val,"onUpdate:modelValue":e[1]||(e[1]=p=>U.value.val=p),options:U.value.opts,label:"MEDIO",filled:""},null,8,["modelValue","options"])):Q("",!0)]}),_:1}),V.value.val?(m(),$(g,{key:0},{default:i(()=>{var a,d,p;return[V.value.val.id==1?(m(),C("div",xe,[o(f,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[2]||(e[2]=()=>Y.value.click())})])):V.value.val.id==2?(m(),C("div",Ee,[U.value.val?(m(),C("div",De,[((a=U.value.val)==null?void 0:a.id)==1?(m(),C("div",Se,[o(I,{class:"col",modelValue:s.value.seccion.val,"onUpdate:modelValue":e[3]||(e[3]=n=>s.value.seccion.val=n),options:te.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(I,{class:"col",modelValue:s.value.familias.val,"onUpdate:modelValue":e[4]||(e[4]=n=>s.value.familias.val=n),options:se.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:s.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(I,{class:"col",modelValue:s.value.categories.val,"onUpdate:modelValue":e[5]||(e[5]=n=>s.value.categories.val=n),options:ie.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:s.value.seccion.val.length==0||s.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),o(f,{color:"primary",label:s.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:pe},null,8,["label"])])):((d=U.value.val)==null?void 0:d.id)==2?(m(),C("div",Ue,[T.value.length>0?(m(),C("div",Qe,[o(I,{modelValue:O.value,"onUpdate:modelValue":[e[6]||(e[6]=n=>O.value=n),de],options:T.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),o(A,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),C(we,null,ke(L.value,(n,b)=>(m(),C("div",{key:b},[j("div",null,[o(I,{modelValue:n.selected,"onUpdate:modelValue":[v=>n.selected=v,v=>ue(v,b)],options:n.options,label:`Nivel ${b+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(A,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):Q("",!0),j("div",Ae,[o(f,{icon:"delete",flat:"",onClick:ce,disable:!O.value},null,8,["disable"])])])):((p=U.value.val)==null?void 0:p.id)==3?(m(),C("div",Ie,[o(f,{icon:"upload",label:"Exportar Excel",class:"full-width",color:"black",onClick:e[7]||(e[7]=()=>Z.value.click())})])):Q("",!0)])):Q("",!0)])):Q("",!0)]}),_:1})):Q("",!0)]),_:1}),o(K,{modelValue:D.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>D.value.status=a),persistent:""},{default:i(()=>[o(z,null,{default:i(()=>[o(g,{class:"row items-center"},{default:i(()=>[F(" Vaciar Seccion "+ye(P.value.options.find(a=>a.id==P.value.selected).name),1)]),_:1}),o(g,null,{default:i(()=>[o(N,{title:"Productos",rows:D.value.val,columns:ee.value.columns},null,8,["rows","columns"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"Cancel",color:"primary"},null,512),[[G]]),o(f,{flat:"",label:"Vaciar Seccion",color:"negative",onClick:re})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(K,{modelValue:S.value.status,"onUpdate:modelValue":e[9]||(e[9]=a=>S.value.status=a),persistent:""},{default:i(()=>[o(z,null,{default:i(()=>[o(g,{class:"row items-center"},{default:i(()=>e[12]||(e[12]=[F(" Eliminar Ubicaciones de los Articulos ")])),_:1}),o(g,null,{default:i(()=>[o(N,{title:"Productos",rows:S.value.val,columns:ee.value.columns},null,8,["rows","columns"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"Cancel",color:"primary"},null,512),[[G]]),o(f,{flat:"",label:"Eliminar Ubicacion",color:"negative",onClick:ve})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(K,{modelValue:_.value.state,"onUpdate:modelValue":e[10]||(e[10]=a=>_.value.state=a),persistent:""},{default:i(()=>[o(z,null,{default:i(()=>[o(g,{class:"text-bold text-center text-h6"},{default:i(()=>e[13]||(e[13]=[F(" Resultados de Importacion ")])),_:1}),o(g,null,{default:i(()=>[o(N,{rows:_.value.val.goals,columns:_.value.table.columns},null,8,["rows","columns"])]),_:1}),o(g,null,{default:i(()=>[o(N,{rows:_.value.val.fails,columns:_.value.table.columns},null,8,["rows","columns"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"OK",color:"primary"},null,512),[[G]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(K,{modelValue:M.value.state,"onUpdate:modelValue":e[11]||(e[11]=a=>M.value.state=a),persistent:""},{default:i(()=>[o(z,null,{default:i(()=>[o(g,{class:"text-bold text-center text-h6"},{default:i(()=>e[14]||(e[14]=[F(" Resultados de Importacion Eliminado Masivo ")])),_:1}),o(g,null,{default:i(()=>[o(N,{rows:M.value.val},null,8,["rows"])]),_:1}),o(q,{align:"right"},{default:i(()=>[W(o(f,{flat:"",label:"OK",color:"primary"},null,512),[[G]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j("input",{type:"file",ref_key:"refCreate",ref:Y,id:"refCreate",onInput:me,hidden:"",accept:".xlsx,.xls"},null,544),j("input",{type:"file",ref_key:"refDelete",ref:Z,id:"refDelete",onInput:fe,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}))}};export{ul as default};
