import{Q as z,a as M,b as c}from"./QTr.482112f1.js";import{r as f,c as j,o as h,a as Q,w as s,e as o,b1 as E,Y as V,aE as U,Q as y,i as n,a4 as r,a5 as P,f as W,a3 as J}from"./index.cf9a8c0d.js";import{Q as C}from"./QSelect.66a2d2f1.js";import{Q as k}from"./QSeparator.fffa493b.js";import{Q as G}from"./QInput.4984f274.js";import{d as S,Q as H}from"./deposits.6edfcc1e.js";import{Q as K}from"./QTable.ab59b670.js";import{Q as B,a as x}from"./QCard.c1da1200.js";import{Q as T}from"./QDialog.5874e710.js";import{Q as X}from"./QDate.dddf2cd0.js";import{Q as Z}from"./QCardActions.ae8e69ab.js";import{Q as ee}from"./QPage.11dbc2da.js";import{u as te}from"./VDB.113f0175.js";import"./ClosePopup.5a964c48.js";import{u as oe}from"./use-quasar.ba608af2.js";import{d as le}from"./dayjs.min.25545ff6.js";import"./jspdf.plugin.autotable.80ef4ad2.js";import{E as ae}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{$socket as w}from"./socket.272efe99.js";import"./use-key-composition.42bb86b0.js";import"./uid.42677368.js";import"./position-engine.6ed1889f.js";import"./rtl.b51694b1.js";import"./axios.eed4c97e.js";import"./axios.f1f32898.js";import"./QList.297701a7.js";import"./QLinearProgress.4a69537f.js";import"./QCheckbox.a111769c.js";import"./use-cache.b0833c75.js";import"./date.8aa2b840.js";import"./_commonjsHelpers.88e99c8f.js";const se=n("div",{class:"col-2 q-table__title q-mr-xl"},"Depositos",-1),ne={class:"text-bold text-left"},ie={class:"text-bold text-center"},re={class:"text-bold text-center"},de={class:"text-bold text-center"},ce={class:"text-bold text-center"},ue={class:"text-bold text-left"},me={class:"text-bold text-center"},pe={class:"text-bold text-center"},ve={class:"text-bold text-left"},fe=["src"],ge={class:"text-h6"},be={class:"text-subtitle2"},_e={class:"q-pa-md"},ye=n("div",{class:"q-pb-sm"},null,-1),Ze={__name:"Confirm",setup(ke){const A=te(),u=oe(),$=w.connect();$.connected?console.log(`%c Connect ${$.id} `,"background: #222; color: #bada55"):console.log("%c No hay conexion en el socket ","background: #222; color: #bada55"),w.on("List",e=>{console.log(e),m.value.push(e)}),w.on("ChangeTicket",e=>{let l=m.value.findIndex(t=>t.id==e.id);l>=0&&(m.value[l].ticket=e.ticket,u.notify({message:`El deposito de $ ${e.import} se agrego el ticket ${e.ticket}`,type:"positive",position:"center"}))});const p=f({state:!1,val:null}),i=f({val:{id:1,name:"Pendiente"},opts:[]}),F=["yellow-11","green-11","red-11"],v=f(!1),g=f(null),d=f({val:null,opts:[]}),m=f([]),b=f({columns:[{name:"id",label:"Id",align:"center",field:e=>e.id},{name:"created",label:"Creado por",align:"center",field:e=>e.send_by},{name:"store",label:"Sucursal",align:"center",field:e=>e.store.name},{name:"origin",label:"Origen",align:"center",field:e=>e.origin},{name:"destiny",label:"Destino",align:"center",field:e=>e.destiny},{name:"concept",label:"Concepto",align:"left",field:e=>e.concept},{name:"reference",label:"Referencia / Folio",align:"center",field:e=>e.refernce},{name:"amount",label:"Importe",align:"center",field:e=>e.amount},{name:"status",label:"Estado",align:"left",field:e=>e.status.name},{name:"ticket",label:"Ticket",align:"center",field:e=>e.ticket},{name:"picture",label:"Foto",align:"center",field:e=>e.picture}],filter:""}),D=j(()=>d.value.val&&i.value.val?m.value.filter(e=>e._store==d.value.val.id&&e._status==i.value.val.id):d.value.val&&!i.value.val?m.value.filter(e=>e._store==d.value.val.id):!d.value.val&&i.value.val?m.value.filter(e=>e._status==i.value.val.id):m.value),I=async()=>{let e=new Date,l=le(e).format("YYYY/MM/DD");g.value=l,console.log(l),u.loading.show({message:"Obteniendo Datos"}),u.loading.show({message:"Obteniendo Datos"});const t=await S.getForm({filt:g.value});t.fail?console.log(t):(console.log(t),u.loading.hide(),m.value=t.deposit,i.value.opts=t.status,d.value.opts=t.stores)},q=e=>{p.value.val=e,p.value.state=!0},N=async e=>{u.loading.show({message:"Cambiando estado"});let l={id:e.id,status:e.status.id};console.log(l);const t=await S.changeStatus(l);console.log(t),t.fail?console.log(t):(u.loading.hide(),e._status=e.status.id,w.emit("ChangeStatus",t),u.notify({message:"Se cambio de estado",type:"positive"}))},O=async()=>{console.log(g.value),u.loading.show({message:"Obteniendo Datos"});const e=await S.getForm({filt:g.value});e.fail?console.log(e):(console.log(e),u.loading.hide(),m.value=e.deposit,v.value=!1)},R=async()=>{const e=new ae.Workbook,l=e.addWorksheet("Comparativo");l.addRow(b.value.columns.map(a=>a.label)),D.value.forEach(async a=>{l.addRow([a.id,a.send_by,a.store.name,a.origin,a.destiny,a.concept,a.refernce,a.amount,a.status.name,a.ticket,`http://192.168.10.160:1920/Assist/public/storage/${a.picture}`])}),(async()=>{const a=await e.xlsx.writeBuffer(),Y=new Blob([a],{type:"application/octet-stream"}),L=URL.createObjectURL(Y),_=document.createElement("a");_.href=L,_.download=`Comparativo${A.session.store.alias}.xlsx`,document.body.appendChild(_),_.click(),document.body.removeChild(_)})()};return I(),(e,l)=>(h(),Q(ee,{padding:""},{default:s(()=>[o(K,{title:"Depositos",rows:W(D),"row-key":"id","rows-per-page-options":[0],separator:"cell",columns:b.value.columns,filter:b.value.filter},{top:s(t=>[se,o(z),o(C,{modelValue:d.value.val,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.val=a),options:d.value.opts,label:"Sucursal","option-label":"name",filled:"",style:{width:"200px"}},E({_:2},[d.value.val?{name:"append",fn:s(()=>[o(V,{name:"cancel",onClick:l[0]||(l[0]=U(a=>d.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),o(k,{spaced:"",inset:"",vertical:""}),o(C,{modelValue:i.value.val,"onUpdate:modelValue":l[3]||(l[3]=a=>i.value.val=a),options:i.value.opts,label:"Estado","option-label":"name",filled:"",style:{width:"200px"}},E({_:2},[i.value.val?{name:"append",fn:s(()=>[o(V,{name:"cancel",onClick:l[2]||(l[2]=U(a=>i.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),o(k,{spaced:"",inset:"",vertical:""}),o(y,{color:"primary",icon:"event",onClick:l[4]||(l[4]=a=>v.value=!v.value),flat:"",round:""}),o(k,{spaced:"",inset:"",vertical:""}),o(y,{color:"primary",icon:"download",onClick:R,flat:"",round:""}),o(k,{spaced:"",inset:"",vertical:""}),o(G,{borderless:"",dense:"",debounce:"300",modelValue:b.value.filter,"onUpdate:modelValue":l[5]||(l[5]=a=>b.value.filter=a),placeholder:"Search"},{append:s(()=>[o(V,{name:"search"})]),_:1},8,["modelValue"])]),body:s(t=>[o(M,{props:t},{default:s(()=>[o(c,{key:"id",props:t},{default:s(()=>[n("div",ne,r(t.row.id),1)]),_:2},1032,["props"]),o(c,{key:"created",props:t},{default:s(()=>[n("div",ie,r(t.row.send_by),1)]),_:2},1032,["props"]),o(c,{key:"store",props:t},{default:s(()=>[n("div",re,r(t.row.store.name),1)]),_:2},1032,["props"]),o(c,{key:"origin",props:t},{default:s(()=>[n("div",de,r(t.row.origin),1)]),_:2},1032,["props"]),o(c,{key:"destiny",props:t},{default:s(()=>[n("div",ce,r(t.row.destiny),1)]),_:2},1032,["props"]),o(c,{key:"concept",props:t},{default:s(()=>[n("div",ue,r(t.row.concept),1)]),_:2},1032,["props"]),o(c,{key:"reference",props:t},{default:s(()=>[n("div",me,r(t.row.refernce),1)]),_:2},1032,["props"]),o(c,{key:"amount",props:t},{default:s(()=>[n("div",pe,"$ "+r(Number(t.row.import).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),_:2},1032,["props"]),o(c,{key:"status",props:t},{default:s(()=>[o(C,{"bg-color":F[t.row.status.id-1],modelValue:t.row.status,"onUpdate:modelValue":[a=>t.row.status=a,a=>N(t.row)],options:i.value.opts,label:"Estado",filled:"","option-label":"name",dense:""},null,8,["bg-color","modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"]),o(c,{key:"ticket",props:t},{default:s(()=>[n("div",ve,r(t.row.ticket),1)]),_:2},1032,["props"]),o(c,{key:"picture",props:t,onClick:a=>q(t.row)},{default:s(()=>[t.row.picture!=null?(h(),Q(H,{key:0,src:`http://192.168.10.160:1920/Assist/public/storage/${t.row.picture}`,ratio:1.7,"spinner-color":"primary","spinner-size":"20px",style:{width:"100px"}},null,8,["src","ratio"])):(h(),Q(P,{key:1,rounded:"",size:"100px","font-size":"52px",color:"white","text-color":"primary",icon:"close"}))]),_:2},1032,["props","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),o(T,{modelValue:p.value.state,"onUpdate:modelValue":l[6]||(l[6]=t=>p.value.state=t)},{default:s(()=>[o(B,{class:"my-card"},{default:s(()=>[n("img",{src:`http://192.168.10.160:1920/Assist/public/storage/${p.value.val.picture}`},null,8,fe),o(x,null,{default:s(()=>[n("div",ge,"Creado: "+r(p.value.val.send_by),1),n("div",be,"Estado: "+r(p.value.val.status.name),1)]),_:1}),o(x,null,{default:s(()=>[J(r(p.value.val.concept),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(T,{modelValue:v.value,"onUpdate:modelValue":l[9]||(l[9]=t=>v.value=t)},{default:s(()=>[o(B,{class:"my-card"},{default:s(()=>[o(x,null,{default:s(()=>[n("div",_e,[ye,o(X,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=t=>g.value=t),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(x,null,{default:s(()=>[o(Z,{align:"right"},{default:s(()=>[o(y,{flat:"",icon:"close",color:"negative",onClick:l[8]||(l[8]=t=>v.value=!v.value)}),o(y,{flat:"",icon:"check",color:"positive",onClick:O})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ze as default};
