import{Q as $,a as B}from"./QTable.e8d8347a.js";import{aH as oe,a as le,u as ie,r as S,c as F,o as Q,d as k,w as l,h as se,e,f,a0 as d,Q as _,ak as n,g as re,a2 as ne,a3 as de,b4 as J,a4 as E,al as ue,S as C}from"./index.77abf6d1.js";import{a as m}from"./QSelect.12dc6247.js";import{a as z,d as K,e as y,b as ce,Q as N}from"./QList.305caac5.js";import{Q as h}from"./QCardSection.578649e2.js";import{Q as A}from"./QTr.fc23f748.js";import{Q as b}from"./QTd.24b157f4.js";import{Q as L}from"./QInput.296f34c4.js";import{Q as M}from"./QPopupEdit.0f0f0fc5.js";import{Q as P}from"./QCardActions.82c96ee7.js";import{Q as q}from"./QCard.4b64cf3a.js";import{Q as ve}from"./QPage.a56dd8cd.js";import{C as I}from"./ClosePopup.2e567ed2.js";import"./dayjs.min.cbcf888d.js";import{R as me}from"./RestockApi.9240baf7.js";import{i as R}from"./invoicesApi.7a182f84.js";import{u as pe}from"./Restock.5e9dc6ef.js";import{u as fe}from"./use-quasar.ef5b2aed.js";import{$sktRestock as D}from"./socket.b400efe4.js";import"./QBtnGroup.7b44dea8.js";import{I as ge}from"./invoices.6742a20d.js";import"./use-key-composition.09ed0229.js";import"./QLinearProgress.20583cc8.js";import"./QCheckbox.7cd0a6fa.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.3c55aa06.js";import"./QToolbar.d27d0521.js";import"./QForm.f2d3d151.js";import"./QRadio.6c135a90.js";import"./QLayout.0ddda853.js";import"./QScrollObserver.1ae8179f.js";import"./QResizeObserver.4d389a46.js";import"./QDrawer.6038474d.js";import"./jspdf.plugin.autotable.b5a44541.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const _e={class:"text-bold text-center text-h6"},ye={class:"text-caption"},be={class:"text-caption"},we={class:"text-center text-bold"},xe={class:"text-center text-bold"},Se={class:"text-center text-bold"},nt={__name:"Compare",setup(he){oe(),le();const w=pe(),u=fe(),j=ie(),s=S({state:!1,val:null}),c=S({state:!1,val:null}),g=S([]),x=S(!1),G=F(()=>w.partitions.filter(o=>o._status==10&&o.requisition._workpoint_to==j.session.store.id_viz)),T=F(()=>G.value.filter(o=>o.products.some(t=>t.pivot.toReceived!==t.pivot.toDelivered)||!o.invoice||!o.invoice_received)),H=async()=>{w.setShowLYT(!0),w.setTitle("Modificaciones"),w.setButtonShow(!0),w.setButtonShowAdd(!1)},V=S({columnsPrimary:[{name:"name",align:"left",label:"Sucursal",field:o=>o.requisition.from.name},{name:"order",align:"center",label:"Pedido",field:o=>o.requisition.id},{name:"partition",align:"center",label:"Particion",field:o=>o.id},{name:"notes",align:"center",label:"Notas",field:o=>o.requisition.notes},{name:"invoice",align:"center",label:"Salida",field:o=>o.invoice},{name:"entry",align:"center",label:"Entrada",field:o=>o.invoice_received},{name:"modified",align:"center",label:"Diferencias",field:o=>o.products.filter(t=>t.pivot.toReceived!==t.pivot.toDelivered).length}],columnsProduct:[{name:"code",align:"left",label:"Codigo",field:o=>o.code},{name:"description",align:"left",label:"Descripcion",field:o=>o.description},{name:"toDelivered",align:"center",label:"Salida",field:o=>o.pivot.toDelivered*p(o.pivot._supply_by,o)},{name:"toReceived",align:"center",label:"Entrada",field:o=>o.pivot.toReceived*p(o.pivot._supply_by,o)},{name:"Diference",align:"center",label:"Diferencia",field:o=>Number(o.pivot.toDelivered-o.pivot.toReceived)*p(o.pivot._supply_by,o)}],pagination:{rowsPerPage:0}}),Y=async()=>{u.loading.show({message:"Realizando Cambios"});const o=g.value.products.map(i=>({id:i.id,toReceived:i.pivot.toReceived})),t=g.value.products.map(i=>({id:i.id,toDelivered:i.pivot.toDelivered}));console.log(s.value.val);try{const i=await me.correction(s.value.val);if(i.status!=200)console.log(i),s.value.val.products=JSON.parse(JSON.stringify(g.value.products));else{if(console.log(i.data),c.value.val=i.data,c.value.state=!0,i.data.res.Eliminar.success){const a=i.data.deleted.map(r=>r);s.value.val.products=s.value.val.products.filter(r=>!a.includes(r.id))}else console.log(g),s.value.val.products=JSON.parse(JSON.stringify(g.value.products));i.data.res.Entrada.success?i.data.toReceived.forEach(a=>{const r=s.value.val.products.find(v=>v.id===a._product);r&&(r.pivot.toReceived=a.toReceived)}):o.forEach(a=>{const r=s.value.val.products.find(v=>v.id===a.id);r&&(r.pivot.toReceived=a.toReceived)}),i.data.res.Salida.success?i.data.toDelivered.forEach(a=>{const r=s.value.val.products.find(v=>v.id===a._product);r&&(r.pivot.toDelivered=a.toDelivered)}):t.forEach(a=>{const r=s.value.val.products.find(v=>v.id===a.id);r&&(r.pivot.toDelivered=a.toDelivered)})}}catch(i){s.value.val.products=JSON.parse(JSON.stringify(g.value.products)),console.error("Error al guardar:",i)}finally{D.emit("orderpartition_refresh",{order:s.value.val}),s.value.val.products.forEach(i=>{i.pivot.units=i.pivot.toDelivered*p(i.pivot._supply_by,i),console.log(i.pivot.toDelivered*p(i.pivot._supply_by,i))}),console.log(s.value.val),ge.invoiceFormat(s.value.val),x.value=!1,u.loading.hide(),s.value={state:!1,val:null},g.value=[]}},W=o=>{let t=s.value.val.products.findIndex(i=>i.id==o.id);s.value.val.products.splice(t,1),console.log(o.pivot)},X=(o,t)=>{s.value.state=!s.value.state,s.value.val=JSON.parse(JSON.stringify(t)),g.value=JSON.parse(JSON.stringify(t))},Z=()=>{s.value.val.requisition.from._type==1?O(s.value.val,!0):ae(s.value.val)},ee=()=>{s.value.val.requisition.from._type==1?O(s.value.val,!1):te(s.value.val)},te=async o=>{u.loading.show({message:"generando entrada"});const t=await R.addEntryFS(o);t.fail?t.fail.status==503?(u.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),u.loading.hide()):console.log(t):(console.log(t),u.notify({message:`Entrada Creada ${t.invoice_received}`,type:"positive",position:"bottom"}),D.emit("orderpartition_refresh",{order:t}),u.loading.hide())},ae=async o=>{u.loading.show({message:"salida"});const t=await R.addInvoiceFS(o);t.fail?t.fail.status==503?(u.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),u.loading.hide()):console.log(t):(console.log(t),u.notify({message:`Salida Creada ${t.invoice}`,type:"positive",position:"bottom"}),D.emit("orderpartition_refresh",{order:t}),u.loading.hide())},O=async(o,t)=>{if(u.loading.show({message:"generando traspaso"}),t){const i=await R.addTransferFS(o);i.fail?i.fail.status==503?(u.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),u.loading.hide()):console.log(i):(console.log(i),u.notify({message:`Traspaso Creado ${i.invoice}`,type:"positive",position:"bottom"}),D.emit("orderpartition_refresh",{order:i}),u.loading.hide())}else{const i=await R.endTransferFS(o);i.fail?i.fail.status==503?(u.notify({message:"No hubo conexion a cedis, Intentarlo mas tarde",type:"negative",position:"bottom"}),u.loading.hide()):console.log(i):(console.log(i),u.notify({message:`Traspaso Creado ${i.invoice_received}`,type:"positive",position:"bottom"}),D.emit("orderpartition_refresh",{order:i}),u.loading.hide())}},p=(o,t)=>{let i;switch(o){case 1:i=1;break;case 2:i=12;break;case 3:i=t.pivot.ipack}return i},U=o=>{let t;switch(o){case 1:t="Pieza";break;case 2:t="Docena";break;case 3:t="Caja"}return t};return H(),(o,t)=>(Q(),k(ve,{padding:""},{default:l(()=>{var i;return[((i=T.value)==null?void 0:i.length)>0?(Q(),k($,{key:0,dense:"",title:"Modificacion Sucursales",rows:T.value,columns:V.value.columnsPrimary,pagination:V.value.pagination,"hide-bottom":"",onRowClick:X},null,8,["rows","columns","pagination"])):se("",!0),e(N,{modelValue:s.value.state,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.state=a),persistent:""},{default:l(()=>[e(q,{style:{width:"800px","max-width":"80vw"}},{default:l(()=>[e(h,{class:"items-center"},{default:l(()=>[f("div",_e,"Particion - "+d(s.value.val.id),1),e(z,{bordered:""},{default:l(()=>[e(K,null,{default:l(()=>[e(y,null,{default:l(()=>[e(m,{class:"text-center",caption:!!s.value.val.invoice},{default:l(()=>[e(_,{flat:!!s.value.val.invoice,onClick:Z,disable:!!s.value.val.invoice},{default:l(()=>[n(d(s.value.val.requisition.from._type==2?"Factura":"Traspaso"),1)]),_:1},8,["flat","disable"])]),_:1},8,["caption"]),e(m,{class:"text-center text-bold"},{default:l(()=>[n(d(s.value.val.invoice),1)]),_:1})]),_:1}),e(ce,{spaced:"",inset:"",vertical:"",dark:""}),e(y,null,{default:l(()=>[e(m,{class:"text-center",caption:!!s.value.val.invoice_received},{default:l(()=>[e(_,{flat:!!s.value.val.invoice_received,onClick:ee,disable:!!s.value.val.invoice_received},{default:l(()=>[n(d(s.value.val.requisition.from._type==2?"Entrada":"Traspaso"),1)]),_:1},8,["flat","disable"])]),_:1},8,["caption"]),e(m,{class:"text-center text-bold"},{default:l(()=>[n(d(s.value.val.invoice_received),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{bordered:""},{default:l(()=>[e(K,null,{default:l(()=>[e(y,null,{default:l(()=>[e(m,{class:"text-center",caption:""},{default:l(()=>t[4]||(t[4]=[n("Surtidor")])),_:1}),e(m,{class:"text-center text-caption"},{default:l(()=>[n(d(s.value.val._suplier),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(m,{class:"text-center",caption:""},{default:l(()=>t[5]||(t[5]=[n("Verificador")])),_:1}),e(m,{class:"text-center text-caption"},{default:l(()=>{var a;return[n(d((a=s.value.val.verified)==null?void 0:a.complete_name),1)]}),_:1})]),_:1}),e(y,null,{default:l(()=>[e(m,{class:"text-center",caption:""},{default:l(()=>t[6]||(t[6]=[n("Chofer")])),_:1}),e(m,{class:"text-center text-caption"},{default:l(()=>{var a;return[n(d((a=s.value.val.driving)==null?void 0:a.complete_name),1)]}),_:1})]),_:1}),e(y,null,{default:l(()=>[e(m,{class:"text-center",caption:""},{default:l(()=>t[7]||(t[7]=[n("Recibo")])),_:1}),e(m,{class:"text-center text-caption"},{default:l(()=>{var a;return[n(d((a=s.value.val.receipt)==null?void 0:a.complete_name),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(h,null,{default:l(()=>[e($,{rows:s.value.val.products,columns:V.value.columnsProduct,pagination:V.value.pagination,"hide-bottom":""},{header:l(a=>[e(A,{props:a},{default:l(()=>[(Q(!0),re(de,null,ne(a.cols,r=>(Q(),k(B,{key:r.name,props:a},{default:l(()=>[n(d(r.label),1)]),_:2},1032,["props"]))),128)),e(B,{"auto-width":""})]),_:2},1032,["props"])]),body:l(a=>[e(A,{props:a},{default:l(()=>[e(b,null,{default:l(()=>[n(d(a.row.code),1)]),_:2},1024),e(b,null,{default:l(()=>[n(d(a.row.description),1)]),_:2},1024),e(b,{class:"text-center"},{default:l(()=>[n(d(a.row.pivot.toDelivered*p(a.row.pivot._supply_by,a.row))+" ",1),e(M,{modelValue:a.row.pivot.toDelivered,"onUpdate:modelValue":r=>a.row.pivot.toDelivered=r},{default:l(r=>[e(L,{type:"number",modelValue:r.value,"onUpdate:modelValue":v=>r.value=v,dense:"",autofocus:"",onKeyup:J(v=>r.set(),["enter"]),min:1},null,8,["modelValue","onUpdate:modelValue","onKeyup"]),f("div",ye," Surtido Por "+d(U(a.row.pivot._supply_by)),1),n(" Piezas: "+d(r.value*p(a.row.pivot._supply_by,a.row)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(b,{class:"text-center"},{default:l(()=>[n(d(a.row.pivot.toReceived*p(a.row.pivot._supply_by,a.row))+" ",1),e(M,{modelValue:a.row.pivot.toReceived,"onUpdate:modelValue":r=>a.row.pivot.toReceived=r},{default:l(r=>[e(L,{type:"number",modelValue:r.value,"onUpdate:modelValue":v=>r.value=v,dense:"",autofocus:"",onKeyup:J(v=>r.set(),["enter"]),min:1},null,8,["modelValue","onUpdate:modelValue","onKeyup"]),f("div",be," Surtido Por "+d(U(a.row.pivot._supply_by)),1),n(" Piezas: "+d(r.value*p(a.row.pivot._supply_by,a.row)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(b,{class:"text-center"},{default:l(()=>[n(d(Number(a.row.pivot.toDelivered-a.row.pivot.toReceived)*p(a.row.pivot._supply_by,a.row)),1)]),_:2},1024),e(b,{"auto-width":""},{default:l(()=>[e(_,{color:a.row.pivot.toDelivered>=0&&a.row.pivot.toReceived>0?"grey":"negative",icon:"delete",onClick:r=>W(a.row),disable:a.row.pivot.toDelivered>=0&&a.row.pivot.toReceived>0,flat:""},null,8,["color","onClick","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])]),_:1}),e(P,{align:"right"},{default:l(()=>[E(e(_,{flat:"",label:"Cancel",color:"primary"},null,512),[[I]]),e(_,{flat:"",label:"Guardar",color:"primary",onClick:t[0]||(t[0]=a=>x.value=!x.value)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(N,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=a=>x.value=a),persistent:""},{default:l(()=>[e(q,null,{default:l(()=>[e(h,{class:"row items-center"},{default:l(()=>[e(ue,{icon:"warning",color:"white","text-color":"negative"}),t[8]||(t[8]=f("span",{class:"q-ml-sm text-bold text-h6"},"Se realizara las modificaciones correspondientes",-1))]),_:1}),e(P,{align:"right"},{default:l(()=>[E(e(_,{flat:"",label:"Cancelar",color:"primary"},null,512),[[I]]),e(_,{flat:"",label:"Enviar",color:"primary",onClick:Y})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(N,{modelValue:c.value.state,"onUpdate:modelValue":t[3]||(t[3]=a=>c.value.state=a),persistent:""},{default:l(()=>[e(q,null,{default:l(()=>[e(h,{class:"text-center text-bold text-h6"},{default:l(()=>t[9]||(t[9]=[n(" Resultado de la Modificacin ")])),_:1}),e(h,null,{default:l(()=>[f("div",we,[t[10]||(t[10]=f("span",{class:"text-center q-mr-md"},"Elminar :",-1)),n(d(c.value.val.res.Eliminar.message?c.value.val.res.Eliminar.message:""),1),e(C,{class:"q-mb-sm",size:"sm",color:c.value.val.res.Eliminar.success?"positive":"negative",name:c.value.val.res.Eliminar.success?"check":"close"},null,8,["color","name"])]),f("div",xe,[t[11]||(t[11]=f("span",{class:"text-center q-mr-md"},"Salida :",-1)),n(d(c.value.val.res.Salida.message?c.value.val.res.Salida.message:"")+" ",1),e(C,{class:"q-ml-md q-mb-sm",size:"sm",color:c.value.val.res.Salida.success?"positive":"negative",name:c.value.val.res.Salida.success?"check":"close"},null,8,["color","name"])]),f("div",Se,[t[12]||(t[12]=f("span",{class:"text-center q-mr-md"},"Entrada :",-1)),n(d(c.value.val.res.Entrada.message?c.value.val.res.Entrada.message:""),1),e(C,{class:"q-ml-md q-mb-sm",size:"sm",color:c.value.val.res.Entrada.success?"positive":"negative",name:c.value.val.res.Entrada.success?"check":"close"},null,8,["color","name"])])]),_:1}),e(P,{align:"right"},{default:l(()=>[E(e(_,{flat:"",label:"OK",color:"primary"},null,512),[[I]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{nt as default};
