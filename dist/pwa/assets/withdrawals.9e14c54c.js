import{b as u,Q as P}from"./QList.c5925261.js";import{Q as Y}from"./QHeader.a75cd3a9.js";import{aH as q,a as j,u as N,r as p,c as w,o as G,d as h,w as n,e as a,f,S as z,Q as c,a0 as K,a4 as X}from"./index.1caea72c.js";import{Q as b,d as Z}from"./QSelect.f9196b14.js";import{Q as _}from"./QToolbar.934f2598.js";import{Q as E}from"./QInput.1e2dc3e6.js";import{Q as ll}from"./QDate.ae83b615.js";import{Q as el}from"./QTable.12d1f84c.js";import{Q as al,a as tl}from"./QLayout.5d2bfff3.js";import{Q as V}from"./QCardSection.e7ec6c6e.js";import{Q as ol}from"./QForm.3c7e1f82.js";import{Q as A}from"./QCard.c7bbc0b0.js";import{Q as x}from"./QCardActions.70d330c5.js";import{C as sl}from"./ClosePopup.f2176256.js";import"./auto.e7a8401f.js";import{u as il}from"./use-quasar.2a5547a4.js";import"./dayjs.min.cbcf888d.js";import"./exceljs.min.9e24d01d.js";import"./jspdf.plugin.autotable.c889c6b6.js";import{_ as nl}from"./UserToolbar.db44fbf8.js";import{A as ul}from"./assistApi.e1a5a380.js";import{a as dl,b as g}from"./axios.d0e85866.js";import"./use-key-composition.2156c461.js";import"./QResizeObserver.cbcc886d.js";import"./use-render-cache.3aae9b27.js";import"./date.6349387d.js";import"./QLinearProgress.478806cb.js";import"./QCheckbox.5473f73d.js";import"./QScrollObserver.83cb7307.js";import"./_commonjsHelpers.88e99c8f.js";import"./QDrawer.25422a8a.js";import"./auth.973a5dad.js";const rl={class:"col"},vl={class:"col"},pl={class:"row"},ml={class:"q-ml-sm"},Gl={__name:"withdrawals",setup(fl){const r=il();q(),j(),N();const Q=N(),d=p([]),O=p(null),m=p([]),o=p({val:null,state:!1}),v=p({val:null,opts:[]}),s=p({state:!1,val:null,body:null}),T=p([]),y=p(T.value),i=p({state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}),C=p({filter:"",columns:[{name:"date",label:"FECHA",field:t=>t.FECHA,align:"left",sortable:!0},{name:"time",label:"TIME",field:t=>t.HORA,align:"left",sortable:!0},{name:"code",label:"CODIGO",field:t=>t.CODRET,align:"left",sortable:!0},{name:"idter",label:"ID",field:t=>t.CAJRET,align:"center",sortable:!0},{name:"ter",label:"TERMINAL",field:t=>t.DESTER,align:"left",sortable:!0},{name:"conc",label:"CONCEPTO",field:t=>t.CONRET,align:"left",sortable:!0},{name:"import",label:"IMPORTE",field:t=>Number(t.IMPRET).toFixed(2),align:"center",sortable:!0},{name:"provider",label:"PROVEEDOR",field:t=>t.NOFPRO,align:"left",sortable:!0}]}),H=w(()=>O.value&&!v.value.val?m.value.filter(t=>t.FECHA==O.value):!O.value&&v.value.val?m.value.filter(t=>t.CAJRET==v.value.val.CODTER):O.value&&v.value.val?m.value.filter(t=>t.FECHA==O.value&&t.CAJRET==v.value.val.CODTER):m.value),k=w(()=>{if(o.value){const t=m.value.find(e=>e.CODRET===o.value.val.CODRET);if(!t)return!1;let l={CAJRET:t.CAJRET,CODRET:t.CODRET,CONRET:t.CONRET,DESTER:t.DESTER,FECHA:t.FECHA,HORA:t.HORA,IMPRET:Number(t.IMPRET).toFixed(2),PROVEEDOR:{PRORET:t.PRORET,NOFPRO:t.NOFPRO}};return JSON.stringify(l)===JSON.stringify(o.value.val)}else return!0}),S=w(()=>!i.value.CONRET||!i.value.DESTER||!i.value.IMPRET||!i.value.PROVEEDOR),U=async()=>{r.loading.show({message:"Cargando Informacion"}),console.log("se inicia el init");const t=await ul.index();t.error||(console.log(t),d.value.opts=t,r.loading.hide(),J())},M=(t,l)=>{o.value.state=!o.value.state,console.log(l);let e={CAJRET:l.CAJRET,CODRET:l.CODRET,CONRET:l.CONRET,DESTER:l.DESTER,FECHA:l.FECHA,HORA:l.HORA,IMPRET:Number(l.IMPRET).toFixed(2),PROVEEDOR:{PRORET:l.PRORET,NOFPRO:l.NOFPRO}};o.value.val={...e}},J=async()=>{let t=Q.session.store.id;console.log(t);try{let l=await dl.get(`/cashier/getPrinters/${t}`);l.status==200&&(s.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),r.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},L=async()=>{console.log(d.value.val.ip_address),r.loading.show({message:"Obteniendo Registros"});let l=`http://${d.value.val.ip_address}/storetools/public/api/reports/getWithdrawals`;const e=await g.get(l);e.status!=200?console.log(e):(console.log(e.data),m.value=e.data.cuts,v.value.opts=e.data.terminal,T.value=e.data.proveedores,r.loading.hide())},F=async()=>{console.log(d.value.val.ip_address);let t={print:s.value.val.ip_address,codret:o.value.val.CODRET};console.log(t),r.loading.show({message:"Imprimiendo Retirada"});let e=`http://${d.value.val.ip_address}/storetools/public/api/reports/printWitrawal`;const R=await g.post(e,t);R.status!=200?console.log(R):(console.log(R.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide())},$=async()=>{o.value.val.Print=s.value.val.ip_address,console.log(o.value.val),r.loading.show({message:"Modificando Retirada"});let l=`http://${d.value.val.ip_address}/storetools/public/api/reports/modifyWithdrawal`;const e=await g.post(l,o.value.val);if(e.status!=200)console.log(e);else{console.log(e.data);let R=m.value.findIndex(D=>D.CODRET==e.data.CODRET);R>=0&&(m.value[R]=e.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide()}},B=async()=>{i.value.Print=s.value.val.ip_address,console.log(i.value),r.loading.show({message:"Agregando Anticipo"});let l=`http://${d.value.val.ip_address}/storetools/public/api/reports/addWithdrawal`;const e=await g.post(l,i.value);e.status!=200?console.log(e):(console.log(e.data),m.value.push(e.data),s.value.val=null,o.value.val=null,o.value.state=!1,r.loading.hide(),I())},I=()=>{i.value={state:!1,CONRET:null,DESTER:null,IMPRET:null,CLIENTE:null,FECHA:null}},W=(t,l,e)=>{if(t===""){l(()=>{y.value=T.value});return}l(()=>{const R=t.toLowerCase();y.value=T.value.filter(D=>D.NOFCLI.toLowerCase().includes(R))})};return U(),(t,l)=>(G(),h(al,{view:"hHh Lpr fFf"},{default:n(()=>[a(Y,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[a(nl),a(u)]),_:1}),a(tl,null,{default:n(()=>[a(_,{class:"justify-between row"},{default:n(()=>[f("div",rl,[l[22]||(l[22]=f("span",{class:"text-grey"},"Helpers",-1)),a(z,{name:"navigate_next",color:"primary"}),l[23]||(l[23]=f("span",{class:"text-h6"},"Retiradas de Cajas",-1))]),f("div",vl,[f("div",pl,[l[24]||(l[24]=f("div",{class:"col"},null,-1)),a(b,{class:"col",modelValue:d.value.val,"onUpdate:modelValue":[l[0]||(l[0]=e=>d.value.val=e),L],options:d.value.opts,label:"Sucursales",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"])])])]),_:1}),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(el,{rows:H.value,filter:C.value.filter,columns:C.value.columns,onRowClick:M},{"top-right":n(()=>[a(E,{modelValue:C.value.filter,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value.filter=e),type:"text",label:"Buscar",filled:"",dense:"",disable:!d.value.val},null,8,["modelValue","disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:v.value.val,"onUpdate:modelValue":l[2]||(l[2]=e=>v.value.val=e),options:v.value.opts,label:"Terminal",filled:"",style:{"min-width":"150px"},dense:"","option-label":"DESTER",disable:!d.value.val},null,8,["modelValue","options","disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(c,{color:"primary",icon:"event",flat:"",round:"",disable:!d.value.val},{default:n(()=>[a(Z,null,{default:n(()=>[a(ll,{modelValue:O.value,"onUpdate:modelValue":l[3]||(l[3]=e=>O.value=e),landscape:"",minimal:"",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["disable"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(c,{color:"primary",icon:"add",flat:"",onClick:l[4]||(l[4]=e=>i.value.state=!i.value.state),disable:!d.value.val},null,8,["disable"])]),_:1},8,["rows","filter","columns"])]),_:1}),a(P,{modelValue:s.value.state,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.state=e)},{default:n(()=>[a(A,{class:"my-card"},{default:n(()=>[a(V,null,{default:n(()=>l[25]||(l[25]=[f("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),a(V,null,{default:n(()=>[a(ol,{onSubmit:F,class:"q-gutter-md"},{default:n(()=>[a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),f("div",null,[a(c,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"},disable:s.value.val===null},null,8,["disable"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(P,{modelValue:o.value.state,"onUpdate:modelValue":l[14]||(l[14]=e=>o.value.state=e),persistent:""},{default:n(()=>[a(A,{style:{width:"300px"}},{default:n(()=>[a(V,{class:"text-bold text-center text-h5"},{default:n(()=>[f("span",ml,"Retirada "+K(o.value.val.CODRET),1)]),_:1}),a(V,null,{default:n(()=>[a(E,{modelValue:o.value.val.FECHA,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.val.FECHA=e),type:"date",label:"Fecha",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.HORA,"onUpdate:modelValue":l[8]||(l[8]=e=>o.value.val.HORA=e),type:"time",label:"Hora",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.DESTER,"onUpdate:modelValue":l[9]||(l[9]=e=>o.value.val.DESTER=e),type:"text",label:"Terminal",dense:"",filled:"",disable:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:o.value.val.PROVEEDOR,"onUpdate:modelValue":l[10]||(l[10]=e=>o.value.val.PROVEEDOR=e),options:T.value,label:"Proveedor",filled:"","option-label":"NOFPRO"},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.CONRET,"onUpdate:modelValue":l[11]||(l[11]=e=>o.value.val.CONRET=e),type:"text",label:"Concepto",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:o.value.val.IMPRET,"onUpdate:modelValue":l[12]||(l[12]=e=>o.value.val.IMPRET=e),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[13]||(l[13]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(x,{align:"center"},{default:n(()=>[X(a(c,{flat:"",color:"negative",icon:"close"},null,512),[[sl]]),a(c,{flat:"",color:"primary",icon:"print",onClick:F,disable:!k.value||!s.value.val},null,8,["disable"]),a(c,{flat:"",color:"yellow",icon:"edit",disable:k.value||!s.value.val,onClick:$},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(P,{modelValue:i.value.state,"onUpdate:modelValue":l[21]||(l[21]=e=>i.value.state=e),persistent:""},{default:n(()=>[a(A,{style:{width:"300px"}},{default:n(()=>[a(V,{class:"text-bold text-center text-h5"}),a(V,null,{default:n(()=>[a(E,{modelValue:i.value.FECHA,"onUpdate:modelValue":l[15]||(l[15]=e=>i.value.FECHA=e),type:"date",label:"Fecha",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:i.value.DESTER,"onUpdate:modelValue":l[16]||(l[16]=e=>i.value.DESTER=e),options:v.value.opts,label:"Terminal",filled:"","option-label":"DESTER",dense:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{modelValue:i.value.PROVEEDOR,"onUpdate:modelValue":l[17]||(l[17]=e=>i.value.PROVEEDOR=e),options:y.value,label:"Proveedor",filled:"","option-label":"NOFPRO","use-input":"","input-debounce":"0",onFilter:W,dense:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:i.value.CONRET,"onUpdate:modelValue":l[18]||(l[18]=e=>i.value.CONRET=e),type:"text",label:"Observacion",dense:"",filled:""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(E,{modelValue:i.value.IMPRET,"onUpdate:modelValue":l[19]||(l[19]=e=>i.value.IMPRET=e),type:"number",label:"Importe",dense:"",filled:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":""},null,8,["modelValue"]),a(u,{spaced:"",inset:"",vertical:"",dark:""}),a(b,{dense:"","option-label":"name",modelValue:s.value.val,"onUpdate:modelValue":l[20]||(l[20]=e=>s.value.val=e),options:s.value.body,label:"Impresora",filled:""},null,8,["modelValue","options"]),a(u,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),a(x,{align:"center"},{default:n(()=>[a(c,{flat:"",color:"negative",icon:"close",onClick:I}),a(c,{flat:"",color:"positive",icon:"send",disable:S.value||!s.value.val,onClick:B},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Gl as default};
