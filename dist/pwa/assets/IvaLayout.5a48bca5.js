import{Q as S}from"./position-engine.752db2f3.js";import{r as p,c as G,I as M,o as m,a as h,w as a,e,a3 as s,a4 as v,h as Q,f as x,Q as I,i as l,am as R,an as W,g as j,a1 as N,U as J,W as X}from"./index.e0f48bec.js";import{Q as q,a as Y}from"./QSelect.8170484e.js";import{Q as A}from"./QInput.f63363f8.js";import{Q as O}from"./QForm.515e2258.js";import{Q as Z,a as L}from"./axios.2251ed73.js";import{a as ee,_ as ae,Q as te}from"./UserToolbar.7569cce4.js";import{Q as le}from"./QDialog.a356f375.js";import{b as z,c as H,Q as se,a as oe,d as ne}from"./QLayout.a94689c6.js";import{u as K}from"./VDB.13bcbade.js";import{u as ie}from"./use-quasar.9825ae15.js";import{Q as D,a as i,b as P}from"./QItem.439a5fca.js";import{Q as ue}from"./QList.95764696.js";import{a as re}from"./axios.f5ac4534.js";const de={__name:"Ticket",props:{data:{type:Object,default:null}},emits:["openCashDesk"],setup(E,{emit:k}){const f=E,w=K(),t=p(f.data),u=p(null),o=["6%","8%","16%"],_={"6%":.06,"8%":.08,"16%":.16},b=p({body:null,val:null}),g=G(()=>{if(u.value&&t.value){let F=_[u.value],d=parseFloat(t.value.total).toFixed(2);return parseFloat((d*F).toFixed(2))}return 0}),n=()=>{k("openCashDesk",{_inc:g.value,_iva:_[u.value],impresora:b.value.val.ip_address})};return M(()=>{console.log("El componente ha muerto!!")}),(async()=>{let F=w.session.store.id;console.log(F);try{let d=await re.get(`/cashier/getPrinters/${F}`);d.status==200&&(b.value.body=d.data,console.log("Impresoras listas :)"))}catch(d){console.log(d),$q.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}})(),(F,d)=>(m(),h(z,{style:{"min-width":"400px"},flat:"",bordered:""},{default:a(()=>[e(ue,{bordered:""},{default:a(()=>[e(D,null,{default:a(()=>[e(i,null,{default:a(()=>[s("Ticket")]),_:1}),e(i,null,{default:a(()=>[s(v(t.value.ticket),1)]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(i,null,{default:a(()=>[s("Cliente")]),_:1}),e(i,null,{default:a(()=>[s(v(t.value.cliente),1)]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(i,null,{default:a(()=>[s("Fecha")]),_:1}),e(i,null,{default:a(()=>[s(v(t.value.fecha),1)]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(i,null,{default:a(()=>[s("Total")]),_:1}),e(i,null,{default:a(()=>[s("$ "+v(t.value.total),1)]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(i,null,{default:a(()=>[s("Impresora")]),_:1}),e(i,null,{default:a(()=>[e(q,{dense:"",modelValue:b.value.val,"onUpdate:modelValue":d[0]||(d[0]=T=>b.value.val=T),options:b.value.body,label:"Impresora","option-label":"name",filled:"",autofocus:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(S),b.value.val?(m(),h(D,{key:0,class:"bg-deep-purple-1"},{default:a(()=>[e(i,null,{default:a(()=>[s("IVA")]),_:1}),e(i,null,{default:a(()=>[e(q,{dense:"",modelValue:u.value,"onUpdate:modelValue":d[1]||(d[1]=T=>u.value=T),options:o,label:"Seleccione",filled:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})):Q("",!0),x(g)?(m(),h(D,{key:1,class:"bg-deep-purple-1"},{default:a(()=>[e(i,null,{default:a(()=>[s("Total")]),_:1}),e(i,null,{default:a(()=>[e(P,{class:"fc-bluegrey text-h4 fw-sbold"},{default:a(()=>[s("$ "+v(x(g)),1)]),_:1}),e(P,{caption:""},{default:a(()=>[s("$ "+v((parseFloat(t.value.total)+parseFloat(x(g))).toFixed(2)),1)]),_:1})]),_:1})]),_:1})):Q("",!0)]),_:1}),u.value?(m(),h(ee,{key:0,align:"between"},{default:a(()=>[e(I,{color:"primary",label:"Cancelar",flat:"","no-caps":""}),e(I,{color:"primary",label:"Cobrar",onClick:n})]),_:1})):Q("",!0)]),_:1}))}},ce={class:"bg-primary row items-center justify-between q-pa-md text-white"},pe=l("div",{class:"fs-dec3"},"TICKET",-1),me={class:"text-h4"},ve={class:"text-right"},fe=l("div",{class:"fs-dec3"},"IVA",-1),_e={class:"fw-bold text-h4"},be={class:"row items-center"},ye=l("div",{class:"col-3"},"Efectivo",-1),ge={class:"row"},he={class:"bg-grey-2 row items-stretch justify-between q-pa-sm"},ke=l("div",{class:"fs-dec1"},"Cambio:",-1),Ve={class:"text-h5 fw-sbold fc-primary"},Qe=l("div",{class:"fs-dec1"},"Falta:",-1),xe={class:"text-h6 fs-inc3 fw-bold fc-negative"},De={__name:"CashDesk",props:{data:{type:Object,default:null},inc:{type:Number,default:0}},emits:["pay"],setup(E,{emit:k}){const f=E,w=[{id:"TBA",desc:"Tarjeta Credito/Debito BBVA (Bancomer)"},{id:"TDB",desc:"Transferencia/Deposito BBVA (Bancomer)"},{id:"TSA",desc:"Tarjeta Credito/Debito Santander"},{id:"TDA",desc:"Transferencia/Deposito Santander"},{id:"TSC",desc:"Tarjeta Credito/Debito Scotiabank"},{id:"TDS",desc:"Transferencia/Deposito Scotiabank"}],t=p({EFE:0,DIG:{id:null,val:0}}),u=p(f.data),o=p(f.inc),_=G(()=>(parseFloat(t.value.EFE)+parseFloat(t.value.DIG.val)).toFixed(2)),b=()=>{k("pay",t.value)};return(g,n)=>u.value?(m(),h(z,{key:0},{default:a(()=>[l("div",ce,[l("div",null,[pe,l("div",me,v(u.value.ticket),1)]),l("div",ve,[fe,l("div",_e,"$ "+v(o.value),1)])]),e(O,{class:"q-pa-none",onSubmit:b},{default:a(()=>[e(H,null,{default:a(()=>[l("div",be,[ye,e(A,{class:"col",modelValue:t.value.EFE,"onUpdate:modelValue":n[0]||(n[0]=r=>t.value.EFE=r),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue","min"]),parseFloat(t.value.EFE)?(m(),h(I,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:n[1]||(n[1]=r=>t.value.EFE=0)})):Q("",!0)])]),_:1}),e(H,null,{default:a(()=>[l("div",ge,[e(q,{class:"col-3",modelValue:t.value.DIG.id,"onUpdate:modelValue":n[2]||(n[2]=r=>t.value.DIG.id=r),options:w,label:"Terminal","option-value":"id","emit-value":"","option-label":"id",dense:""},{option:a(r=>[e(D,R(W(r.itemProps)),{default:a(()=>[e(i,null,{default:a(()=>[e(P,{class:"text-bold"},{default:a(()=>[s(v(r.opt.id),1)]),_:2},1024),e(P,{caption:""},{default:a(()=>[s(v(r.opt.desc),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),e(A,{class:"col",modelValue:t.value.DIG.val,"onUpdate:modelValue":n[3]||(n[3]=r=>t.value.DIG.val=r),type:"number",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4"},null,8,["modelValue","min"]),parseFloat(t.value.DIG.val)?(m(),h(I,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:n[4]||(n[4]=r=>{t.value.DIG.val=0,t.value.DIG.id=null})})):Q("",!0)])]),_:1}),e(S),l("div",he,[l("div",null,[x(_)>=o.value?(m(),j(N,{key:0},[ke,l("div",Ve,"$ "+v((x(_)-o.value).toFixed(2)),1)],64)):(m(),j(N,{key:1},[Qe,l("div",xe,"$ "+v((o.value-x(_)).toFixed(2)),1)],64))]),l("div",null,[x(_)>=o.value?(m(),h(I,{key:0,color:"positive",icon:"fas fa-dollar-sign",label:"Pagar",type:"submit",class:"full-height"})):Q("",!0)])])]),_:1})]),_:1})):Q("",!0)}};const Fe=l("span",{class:"text-h6"},"IVA",-1),$e=l("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Folio",-1),Ie={key:0,class:"text-right"},Ce={class:"row justify-center"},Oe={__name:"IvaLayout",setup(E){const k=K(),f=ie(),w=k.series,t=p(null),u=p(""),o=p(null),_=p(0),b=p(0),g=p({state:!1}),n=p(null),r=G(()=>t.value&&u.value.length),F=async()=>{o.value=null,_.value=0;let $=t.value,c=u.value,U=`http://${k.session.store.ip}/access/public/iva/ticket?serie=${$}&folio=${c}`;L.get(U).then(V=>{o.value=V.data}).catch(V=>{console.log(V);let C=V.response.status,B=V.response.data;console.log(C),console.log(B),f.notify({html:!0,message:B.message,color:"negative",position:"center"})})},d=({_inc:$,_iva:c,impresora:y})=>{console.log($,c,y),n.value=y,_.value=parseFloat($),b.value=parseFloat(c),g.value.state=!0},T=$=>{console.log("pagando...");let c=k.session.store.ip,y=`${k.session.name} - ${k.session.store.alias}`,U=`http://${c}/access/public/iva/create`,V={modes:$,by:y,ticket:o.value.ticket,iva:b.value,impresora:n.value};console.log(V),f.loading.show({message:"Imprimiendo..."}),console.log(V),L.post(U,V).then(C=>{console.log(C.data);let B=C.data;f.loading.hide(),g.value.state=!1,o.iva=null,o.value=null,f.notify({html:!0,color:"positive",position:"center",message:`<span class="fs-inc2"> El ticket <b>${B.ticket}</b> fue generado! </span>`}),B.printed||f.notify({html:!0,color:"negative",position:"top",icon:"fas fa-bugs",message:'<span class="fs-inc2"> No se pudo emitir el ticket, la conexion a la impresora no esta disponible! </span>'})}).catch(C=>{console.log(C),f.loading.hide()})};return($,c)=>(m(),h(se,{view:"hHh Lpr fFf"},{default:a(()=>[e(te,{class:"transparent text-dark",bordered:""},{default:a(()=>[e(ae),e(S),e(Z,{class:"justify-between"},{default:a(()=>[l("div",null,[s("Helpers "),e(J,{name:"navigate_next",color:"primary"}),s(),Fe]),e(I,{color:"primary",icon:"add"},{default:a(()=>[e(Y,null,{default:a(()=>[$e,e(S),e(O,{dense:"",onSubmit:F,class:"q-gutter-md q-pa-md"},{default:a(()=>[e(q,{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=y=>t.value=y),options:x(w),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(A,{modelValue:u.value,"onUpdate:modelValue":c[1]||(c[1]=y=>u.value=y),type:"number",label:"Folio"},null,8,["modelValue"]),x(r)?(m(),j("div",Ie,[e(I,{type:"submit",color:"primary",icon:"search"})])):Q("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ne,null,{default:a(()=>[e(oe,{class:"bg-grey-3",padding:""},{default:a(()=>[l("div",Ce,[e(X,{name:"bounce"},{default:a(()=>[o.value?(m(),h(de,{key:0,data:o.value,onOpenCashDesk:d},null,8,["data"])):Q("",!0)]),_:1})]),e(le,{modelValue:g.value.state,"onUpdate:modelValue":c[2]||(c[2]=y=>g.value.state=y)},{default:a(()=>[e(De,{data:o.value,inc:_.value,onPay:T},null,8,["data","inc"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Oe as default};
