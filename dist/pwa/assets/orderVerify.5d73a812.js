import{u as J,a as W,aH as X,c as S,o as D,d as $,w as d,e as o,f as a,a0 as p,g as M,a3 as ue,a2 as ce,an as Y,Q as y,h as z,r as _,p as pe,m as ve,a1 as me,a4 as T,ak as K}from"./index.78954dea.js";import{b as C,Q as j}from"./QList.0ceff5da.js";import{Q as b}from"./QCardSection.844d8eb3.js";import{Q as k}from"./QCard.360840ba.js";import{Q as H}from"./QTable.1825e05d.js";import{Q as R}from"./QInput.d9a9a280.js";import{Q as I}from"./QCardActions.73c79b27.js";import{Q as G}from"./QForm.2d6d3ebf.js";import{Q as fe}from"./QFooter.0f8c38d6.js";import{Q as ge}from"./QPage.1d1a43a8.js";import{C as F}from"./ClosePopup.cf11ce4d.js";import"./axios.4d9114d9.js";import{u as Z}from"./use-quasar.36143f2e.js";import{P as ye}from"./ProductsAutocomplete.a3a61f21.js";import{Q as xe}from"./QSpace.66bb2073.js";import{o as w}from"./orderApi.3aee9b3f.js";import{R as V}from"./resoursesOrder.232e6bb5.js";import{d as be}from"./dayjs.min.cbcf888d.js";import"./use-key-composition.75b5357d.js";import"./QSelect.4059e1c1.js";import"./QLinearProgress.0eabd787.js";import"./QCheckbox.57c9d336.js";import"./QResizeObserver.0540dedf.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const we={class:"row"},Pe={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},_e={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},Ce={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},De={class:"row"},he={class:"text-h6 col text-bold text-left"},ke={class:"text-h6 col text-bold text-right"},Ve={class:"text-subtitle2 col"},$e={class:"row items-start justify-between"},Qe={class:"text-center col text-primary"},Be={class:"text-bold"},Ne={class:"text-caption"},ze={class:"text-center col"},Ae={class:"text-center col"},Se={class:"text-bold text-caption"},Oe={class:"text-center col"},Ee={class:"text-bold"},Ue={__name:"productView",props:{product:{type:Object,default:{}},order:{type:Object,default:{}},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct"],setup(r,{emit:O}){J();const c=Z();W(),X();const l=r,A=O,i=S(()=>!l.product.pivot.amountDelivered||l.product.pivot.amountDelivered<=0),v=S(()=>l.product.pivot._supply_by==3?l.product.pivot.amountDelivered*l.product.pieces:l.product.pivot._supply_by==2?l.product.pivot.amountDelivered*12:l.product.pivot.amountDelivered),Q=S(()=>l.order.client._price_list<=3?[1,2,3,4]:[l.order.client._price_list]),u=S(()=>l.order.client._price_list<=3?v.value>=l.product.pieces&&(l.product.pivot._supply_by==1||l.product.pivot._supply_by==2)||l.product.pivot._supply_by==3?4:V.verificarPrecioDocena(l.products,l.product,l.rules)?3:V.verificarPrecioMayoreo(l.products,l.product,l.rules)?2:1:l.order.client._price_list),n=()=>{A("reset")},E=async()=>{c.loading.show({message:"Editando Producto"});let x=l.product.prices.find(h=>h.id==u.value).pivot.price,f=v.value*x;l.product.pivot.toDelivered=v.value,l.product.pivot._price_list=u.value,l.product.pivot.price=x,l.product.pivot.total=f;const m=await w.editProduct(l.product.pivot);m.fail?console.log(m):(c.loading.hide(),n(),V.actualizarPreciosProductos(l.products,l.order,l.rules))},B=async()=>{c.loading.show({message:"Agregando producto"});let x=l.product.prices.find(h=>h.id==u.value).pivot.price,f=v.value*x;l.product.pivot.toDelivered=v.value,l.product.pivot._price_list=u.value,l.product.pivot.price=x,l.product.pivot.total=f,l.product.pivot._product=l.product.id,l.product.pivot._order=l.order.id;const m=await w.addProduct(l.product.pivot);m.fail?console.log(m):(A("addProduct",l.product),c.loading.hide(),V.actualizarPreciosProductos(l.products,l.order,l.rules))},U=async()=>{c.loading.show({message:"Eliminando Producto"});const x=await w.deleteProduct(l.product.pivot);x.fail?console.log(x):(A("deleteProduct",l.product),c.loading.hide(),V.actualizarPreciosProductos(l.products,l.order,l.rules))};return(x,f)=>(D(),$(k,null,{default:d(()=>[o(b,{class:"item-center"},{default:d(()=>[a("div",we,[a("div",Pe,p(r.product.category.familia.seccion.name),1),a("div",_e,p(r.product.category.familia.name),1),a("div",Ce,p(r.product.category.name),1)])]),_:1}),o(b,{class:"item-center"},{default:d(()=>[a("div",De,[a("div",he,p(r.product.code),1),a("div",ke,p(r.product.name),1)]),a("div",Ve,p(r.product.description),1)]),_:1}),o(b,{class:"item-center row"},{default:d(()=>[(D(!0),M(ue,null,ce(r.product.prices.filter(m=>Q.value.includes(m.id)),(m,h)=>(D(),M("div",{class:"col text-subtitle2 text-center",key:h},[a("div",{class:Y(m.id==u.value?"text-weight-bold":"text-caption text-strike")},p(m.alias),3),o(C,{spaced:"",inset:"",vertical:"",dark:""}),a("div",{class:Y(m.id==u.value?"text-bold  text-blue-13":"text-caption")},p(m.pivot.price),3),o(C,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),o(b,null,{default:d(()=>[a("div",$e,[a("div",Qe,[f[2]||(f[2]=a("div",null,"Solicitud",-1)),a("div",Be,p(r.product.pivot.amount)+" "+p(r.product.pivot._supply_by==3?`Caja${r.product.pivot.amount!=1?"s":""}`:r.product.pivot._supply_by==2?`Docena${r.product.pivot.amount!=1?"s":""}`:`Pieza${r.product.pivot.amount!=1?"s":""}`),1),a("div",Ne,p(`(${r.product.pivot.units} Pzs)`),1)]),a("div",ze,[f[3]||(f[3]=a("div",null,"PxC",-1)),o(R,{dense:"",borderless:"",modelValue:r.product.pieces,"onUpdate:modelValue":f[0]||(f[0]=m=>r.product.pieces=m),type:"number","input-class":"text-h6 text-center",disable:r.product.pivot._supply_by!=3},null,8,["modelValue","disable"])]),a("div",Ae,[a("div",Se,p(r.product.pivot._supply_by==3?"Cajas":r.product.pivot._supply_by==2?"Docenas":"Piezas"),1),o(R,{autofocus:"",dense:"",borderless:"",modelValue:r.product.pivot.amountDelivered,"onUpdate:modelValue":f[1]||(f[1]=m=>r.product.pivot.amountDelivered=m),type:"number",min:"0","input-class":"text-center text-bold text-h6",ref:"iptcounter"},null,8,["modelValue"])]),a("div",Oe,[f[4]||(f[4]=a("div",null,"Piezas",-1)),a("div",Ee,p(v.value),1)])])]),_:1}),o(I,null,{default:d(()=>[o(y,{flat:"",icon:"close",onClick:n}),o(xe),r.edit?z("",!0):(D(),$(y,{key:0,flat:"",icon:"add",color:"positive",onClick:B,disable:i.value},null,8,["disable"])),r.edit?(D(),$(y,{key:1,flat:"",icon:"delete",color:"negative",onClick:U})):z("",!0),r.edit?(D(),$(y,{key:2,flat:"",icon:"edit",color:"warning",onClick:E,disable:i.value},null,8,["disable"])):z("",!0)]),_:1})]),_:1}))}},je={class:"col"},Ie={class:"text-center text-h6"},Re={class:"col"},qe={class:"col"},Te={class:"text-center text-h6"},Fe={class:"col"},Le={class:"text-center text-h6"},Me={class:"col"},Ye={class:"text-center text-h6"},Ke={class:"col"},He={class:"text-center text-h6"},wt={__name:"orderVerify",setup(r){const O=J(),c=Z(),l=W(),A=X(),i=_(null),v=_({state:!1,val:null}),Q=_(!1),u=_({state:!1,val:null,opts:[]}),n=_({state:!1,val:null,edit:!1}),E=_({amount:0,amountDelivered:0,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),B=_([]),U=_({columns:[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},{name:"amount",label:"Pedido",field:t=>t.pivot.units,align:"center"},{name:"verify",label:"Verificado",field:t=>t.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:t=>t.pivot.price,align:"center"},{name:"total",label:"Total",field:t=>t.pivot.total,align:"center"}],pagination:{rowsPerPage:0}}),x=_({columns:[{name:"id",label:"Codigo",field:t=>t.id,align:"left"},{name:"Nombre",label:"Descripcion",field:t=>t.name,align:"left"},{name:"Telefono",label:"Pedido",field:t=>t.celphone,align:"center"}],pagination:{rowsPerPage:0}}),f=S(()=>i.value.products.every(t=>t.pivot.amountDelivered||t.pivot.amountDelivered>0)),m=async()=>{let t=A.params.ord;const e=await w.getOrderVerify(t);e.fail?e.fail.status==401?(c.notify({message:e.fail.response.data,position:"center",type:"negative"}),l.push("/verifyOrder")):console.log(e):(console.log(e),i.value=e.order,B.value=e.rules)},h=t=>{let e=i.value.products.findIndex(s=>s.id==t.id);e>=0?(n.value.val=i.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=E.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},ee=t=>{let e=i.value.products.findIndex(s=>s.id==t.id);e>=0?(n.value.val=i.value.products[e],n.value.state=!0,n.value.edit=!0):(t.pivot=E.value,n.value.val=t,n.value.state=!0,n.value.edit=!1)},te=(t,e)=>{console.log(e),n.value.val=e,n.value.edit=!0,n.value.state=!0},q=()=>{n.value={state:!1,val:null,edit:!1}},oe=t=>{i.value.products.push(t),q()},le=t=>{let e=i.value.products.findIndex(s=>s.id==t.id);e>=0&&(i.value.products.splice(e,1),q())},ae=async()=>{if(u.value.val){const t=await w.getClient(u.value);t.fail?console.log(t):t.length>0?(console.log(t),u.value.opts=t):c.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(t)}else c.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},ie=async(t,e)=>{c.loading.show({message:"Recalculando Ticket"});let s={order:i.value.id,client:e.id};const g=await w.changeClientOrder(s);g.fail?console.log(g):(i.value.client=e,V.actualizarPreciosProductos(i.value.products,i.value,B.value),u.value={state:!1,val:null,opts:[]},c.loading.hide())},se=()=>{console.log("cambio de cliente"),u.value.state=!0},L=t=>{t.ctrlKey&&t.key.toLowerCase()==="b"?(t.preventDefault(),u.value.state||(u.value.state=!0)):t.ctrlKey&&t.key.toLowerCase()==="p"&&(t.preventDefault(),v.value.state||(v.value.state=!0))},de=async()=>{c.loading.show({message:"Terminando Verificacion"});let t={uid:O.session.credentials.staff.id_va,oid:i.value.id};const e=await w.nextState(t);e.fail?console.log(e):(console.log(e),c.notify({message:"El pedido ya esta en Caja",position:"center",type:"positive",icon:"check"}),c.loading.hide(),l.push("/verifyOrder"))},re=async()=>{if(v.value.val){let t={uid:O.session.credentials.staff.id_va,oid:i.value.id};const e=await w.getOrderAdd(v.value.val,t);console.log(e),e.fail?e.fail.status==401?c.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):e.fail.status==404?c.notify({message:e.fail.response.data,position:"bottom",type:"negative"}):console.log(e):e?(console.log(e),ne(i.value.products,e.products).then(s=>i.value.products=s),V.actualizarPreciosProductos(i.value.products,i.value,B.value),v.value={state:!1,val:null}):c.notify({message:"No hay ningun pedido con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"})}else c.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},ne=async(t,e)=>{const s=[...t];for(const g of e){const N=s.find(P=>P.id===g.id);if(N){N.pivot.units+=g.pivot.units,N.pivot.toDelivered=0,N.pivot.amountDelivered=0;const P=await w.editProduct(N.pivot);console.log(N),P.fail?console.log("Edit failed:",P):console.log("Edited:",P)}else{g.pivot._order=i.value.id,g.pivot.toDelivered=0,g.pivot.amountDelivered=0;const P=await w.addProduct(g.pivot);P.fail?console.log("Add failed:",P):(console.log("Added:",P),s.push(g))}}return s};return pe(()=>{m(),window.addEventListener("keydown",L)}),ve(()=>{window.removeEventListener("keydown",L)}),(t,e)=>i.value?(D(),$(ge,{key:0,padding:""},{default:d(()=>[o(k,{class:"my-card"},{default:d(()=>[o(b,{class:"row"},{default:d(()=>[a("div",je,[e[8]||(e[8]=a("div",{class:"text-caption text-center"},"Dependiente",-1)),a("div",Ie,p(`${i.value.created_by.names} ${i.value.created_by.surname_pat}
            ${i.value.created_by.surname_mat}`),1)]),a("div",Re,[e[9]||(e[9]=a("div",{class:"text-caption text-center"},"Cliente",-1)),o(y,{class:"full-width",flat:"",label:i.value.client.name,onClick:se},null,8,["label"])]),a("div",qe,[e[10]||(e[10]=a("div",{class:"text-caption text-center"},"Fecha",-1)),a("div",Te,p(me(be)(i.value.created_at).format("YYYY-MM-DD")),1)]),o(y,{color:"primary",flat:""}),o(C,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(k,{class:"my-card"},{default:d(()=>[o(b,{class:"row"},{default:d(()=>[a("div",Fe,[e[11]||(e[11]=a("div",{class:"text-caption text-center"},"Orden",-1)),a("div",Le,p(i.value.id),1)]),a("div",Me,[e[12]||(e[12]=a("div",{class:"text-caption text-center"},"Total",-1)),a("div",Ye,"$ "+p(Number(i.value.products.reduce((s,g)=>s+g.pivot.total,0)).toFixed(2)),1)]),a("div",Ke,[e[13]||(e[13]=a("div",{class:"text-caption text-center"},"Cantidad",-1)),a("div",He,p(i.value.products.reduce((s,g)=>s+Number(g.pivot.toDelivered),0)),1)]),o(y,{color:"primary",flat:"",icon:"add",onClick:e[0]||(e[0]=s=>v.value.state=!v.value.state)}),o(C,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(H,{rows:i.value.products,columns:U.value.columns,"hide-bottom":"",pagination:U.value.pagination,onRowClick:te},null,8,["rows","columns","pagination"]),o(j,{modelValue:n.value.state,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.state=s),persistent:"",position:"bottom"},{default:d(()=>[o(Ue,{product:n.value.val,order:i.value,edit:n.value.edit,onReset:q,products:i.value.products,rules:B.value,onAddProduct:oe,onDeleteProduct:le},null,8,["product","order","edit","products","rules"])]),_:1},8,["modelValue"]),o(j,{modelValue:u.value.state,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.state=s),persistent:""},{default:d(()=>[o(k,{style:{width:"700px"}},{default:d(()=>[o(G,{onSubmit:ae},{default:d(()=>[e[14]||(e[14]=a("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),e[15]||(e[15]=a("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),o(b,null,{default:d(()=>[o(C,{spaced:"",inset:"",vertical:"",dark:""}),a("div",null,[o(R,{autofocus:"",modelValue:u.value.val,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.val=s),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),u.value.opts.length>0?(D(),$(b,{key:0},{default:d(()=>[o(H,{rows:u.value.opts,columns:x.value.columns,pagination:x.value.pagination,onRowClick:ie},null,8,["rows","columns","pagination"])]),_:1})):z("",!0),o(I,{align:"right"},{default:d(()=>[T(o(y,{flat:"",label:"Cancelar",color:"primary"},null,512),[[F]]),o(y,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(j,{modelValue:Q.value,"onUpdate:modelValue":e[4]||(e[4]=s=>Q.value=s),persistent:""},{default:d(()=>[o(k,null,{default:d(()=>[o(b,{class:"text-center text-bold text-h6"},{default:d(()=>[K(" Orden "+p(i.value.id),1)]),_:1}),o(b,null,{default:d(()=>e[16]||(e[16]=[K(" El pedido se ira directo a caja, "),a("span",{class:"text-bold"}," Deseas Continuar?",-1)])),_:1}),o(I,{align:"right"},{default:d(()=>[T(o(y,{flat:"",icon:"close",color:"negative"},null,512),[[F]]),o(y,{flat:"",icon:"send",color:"positive",onClick:de})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(j,{modelValue:v.value.state,"onUpdate:modelValue":e[6]||(e[6]=s=>v.value.state=s),persistent:""},{default:d(()=>[o(k,{style:{width:"300px"}},{default:d(()=>[o(G,{onSubmit:re},{default:d(()=>[e[17]||(e[17]=a("div",{class:"text-h6 text-bold text-center"},"Buscar Comanda",-1)),e[18]||(e[18]=a("div",{class:"text-center text-bold text-caption"},"Busca ID de commanda",-1)),o(b,null,{default:d(()=>[o(C,{spaced:"",inset:"",vertical:"",dark:""}),a("div",null,[o(R,{autofocus:"",modelValue:v.value.val,"onUpdate:modelValue":e[5]||(e[5]=s=>v.value.val=s),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),o(I,{align:"right"},{default:d(()=>[T(o(y,{flat:"",label:"Cancel",color:"primary"},null,512),[[F]]),o(y,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(fe,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:d(()=>[o(k,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:d(()=>[o(b,{class:"row"},{default:d(()=>[o(ye,{class:"col",checkState:!1,onInput:ee,onAgregar:h}),f.value?(D(),$(y,{key:0,color:"primary",flat:"",icon:"east",onClick:e[7]||(e[7]=s=>Q.value=!Q.value),round:""})):z("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):z("",!0)}};export{wt as default};
