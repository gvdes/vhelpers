import{Q as P,a as v}from"./QSelect.e2b065f9.js";import{b as h,a as J,d as K,e as w}from"./QList.50729234.js";import{Q as b}from"./QCardSection.4706c313.js";import{Q as N}from"./QCard.5cada9f8.js";import{Q as E}from"./QTd.79ee2f47.js";import{u as Y,r as f,c as I,l as Z,o as m,d as Q,w as o,f as n,e as t,g as y,a3 as z,a2 as D,h as S,ak as L,a1 as ee,a0 as c,al as p,Q as M}from"./index.eed437d0.js";import{Q as te}from"./QTr.64b79515.js";import{Q as le}from"./QTable.0cd03545.js";import{Q as oe}from"./QPage.a405e71e.js";import"./QDrawer.fa8bbbae.js";import"./QExpansionItem.a803090b.js";import"./QCardActions.e38329fe.js";import"./ClosePopup.d2e53e88.js";import"./axios.1827c22f.js";import{u as ae}from"./use-quasar.4cc3dfd9.js";import{u as se}from"./warehousStore.98174f96.js";import{P as ie}from"./ProductsAutocomplete.928c7477.js";import"./jspdf.plugin.autotable.cf4f64f1.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as U}from"./locationsApi.158d072b.js";import"./use-key-composition.88110e91.js";import"./QLinearProgress.ae99a0c2.js";import"./QCheckbox.ebfa3b1a.js";import"./use-checkbox.5c639eab.js";import"./QResizeObserver.f5192848.js";import"./QScrollObserver.43f8b16a.js";import"./QInput.b65338fd.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const ne={key:0},ce={key:0},de={class:"row"},re={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},ue={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},me={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},pe={class:"row"},ve={class:"text-h6 col text-bold text-left"},fe={class:"text-h6 col text-bold text-right"},ge={class:"text-subtitle2 col"},Je={__name:"products",setup(_e){const g=Y(),r=ae();se().setTitle("Ubicaciones Productos");const V=f([]),k=f(null),O=f([]),_=f([]),$=f(0),a=f(null),x=f(null),B=f({columns:[{name:"name",label:"NOMBRE",field:l=>l.name,align:"left"},{name:"alias",label:"ALIAS",field:l=>l.alias,align:"left"},{name:"path",label:"PATH",field:l=>l.path,align:"left"}],paginate:{rowsPerPage:0}}),A=I(()=>r.platform.is.mobile),F=I(()=>{var l,e;return(e=(l=a.value)==null?void 0:l.locations)==null?void 0:e.find(s=>{var d;return s.id==((d=x.value)==null?void 0:d.selected)})}),H=async()=>{r.loading.show({message:"Obteniendo Secciones"});let l={_rol:g.session.credentials._rol,_workpoint:g.session.store.id_viz};const e=await U.index(l);e.fail?console.log(e):V.value=e,r.loading.hide()},R=()=>{const l=k.value.sections||[];$.value=Math.max(...l.map(e=>e.deep)),_.value=[{options:l.filter(e=>e.root===0),selected:null}],O.value=_.value[0].options},T=l=>{var e;return((e=k.value.sections)==null?void 0:e.filter(s=>s.root===l))||[]},j=(l,e)=>{_.value.splice(e+1);const s=T(l);s.length>0&&_.value.push({options:s,selected:null})},q=l=>{a.value=l,console.log(l)},G=l=>{a.value=l,console.log(l)},W=async()=>{console.log(g.session),r.loading.show({message:"Agregando Ubicacion"}),console.log(x.value);let l={id_viz:g.session.credentials.staff.id_va,_location:x.value.selected,_product:a.value.id};const e=await U.addLocations(l);if(e.fail)console.log(e);else{console.log(e);const s=_.value.filter(d=>d.selected!==null);if(s.length){const i=s[s.length-1].options.find(u=>u.id===x.value.selected);a.value.locations.push(i)}r.notify({message:"Ubicacion Agregada",type:"positive",position:"bottom"}),r.loading.hide()}},X=async l=>{console.log(g.session),r.loading.show({message:"Eliminando Ubicacion"});let e={id_viz:g.session.credentials.staff.id_va,_location:l,_product:a.value.id};console.log(e);const s=await U.addLocations(e);if(s.fail)console.log(s);else{console.log(s),r.notify({message:"Ubicacion Eliminada",type:"positive",position:"bottom"});let d=a.value.locations.findIndex(i=>i.id==l);a.value.locations.splice(d,1),r.loading.hide()}};return H(),Z(_,l=>{const e=l.filter(s=>s.selected!==null);if(e.length){const s=e[e.length-1];T(s.selected),x.value=s}},{deep:!0}),(l,e)=>(m(),Q(oe,{padding:""},{default:o(()=>{var s,d;return[n("div",{class:L(A.value?"":"row")},[t(N,{class:L(A.value?"my-card":"col my-card")},{default:o(()=>[t(b,null,{default:o(()=>[V.value.length>0?(m(),y("div",ne,[t(P,{modelValue:k.value,"onUpdate:modelValue":[e[0]||(e[0]=i=>k.value=i),R],options:V.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(h,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),y(z,null,D(_.value,(i,u)=>(m(),y("div",{key:u},[n("div",null,[t(P,{modelValue:i.selected,"onUpdate:modelValue":[C=>i.selected=C,C=>j(C,u)],options:i.options,label:`Nivel ${u+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(h,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):S("",!0)]),_:1})]),_:1},8,["class"]),t(h,{spaced:"",inset:"",vertical:"",dark:""}),t(N,{class:L(A.value?"my-card":"col my-card")},{default:o(()=>[t(b,null,{default:o(()=>[t(ie,{onInput:q,onAgregar:G,with_locations_loc:ee(g).session.credentials._rol},null,8,["with_locations_loc"])]),_:1}),a.value?(m(),y("div",ce,[t(b,{class:"item-center"},{default:o(()=>[n("div",de,[n("div",re,c(a.value.category.familia.seccion.name),1),n("div",ue,c(a.value.category.familia.name),1),n("div",me,c(a.value.category.name),1)])]),_:1}),t(b,{class:"item-center"},{default:o(()=>[n("div",pe,[n("div",ve,c(a.value.code),1),n("div",fe,c(a.value.name),1)]),n("div",ge,c(a.value.description),1),n("div",null,[t(J,null,{default:o(()=>[t(K,null,{default:o(()=>[t(w,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[1]||(e[1]=[p("GEN")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.gen),1)]),_:1})]),_:1}),t(w,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[2]||(e[2]=[p("EXH")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.exh),1)]),_:1})]),_:1}),t(w,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[3]||(e[3]=[p("FDT")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.fdt),1)]),_:1})]),_:1}),t(w,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[4]||(e[4]=[p("TRA")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.in_transit),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),a.value.locations.length>0?(m(),Q(b,{key:0},{default:o(()=>[e[5]||(e[5]=n("div",{class:"text-center text-bold text-h6"},"Ubicaciones",-1)),t(h,{spaced:"",inset:"",vertical:"",dark:""}),t(le,{rows:a.value.locations,columns:B.value.columns,pagination:B.value.paginate,"hide-bottom":"","hide-header":""},{body:o(i=>[t(te,{props:i},{default:o(()=>[(m(!0),y(z,null,D(i.cols,u=>(m(),Q(E,{key:u.name,props:i},{default:o(()=>[p(c(u.value),1)]),_:2},1032,["props"]))),128)),t(E,{"auto-width":""},{default:o(()=>[t(M,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:u=>X(i.row.id),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])]),_:1})):S("",!0)])):S("",!0)]),_:1},8,["class"])],2),t(h,{spaced:"",inset:"",vertical:"",dark:""}),((s=x.value)==null?void 0:s.selected)&&((d=a.value)==null?void 0:d.id)&&!F.value?(m(),Q(N,{key:0,class:"my-card"},{default:o(()=>[t(b,null,{default:o(()=>[t(M,{color:"primary",icon:"add_link",onClick:W})]),_:1})]),_:1})):S("",!0)]}),_:1}))}};export{Je as default};
