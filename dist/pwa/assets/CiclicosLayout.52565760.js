import{b as Y,Q as X}from"./QList.69eb5491.js";import{Q as K}from"./QHeader.e531061e.js";import{r as w,c as h,o as M,g as U,d as R,w as u,e as n,f,a0 as L,a1 as z,Q as T,ak as I,a3 as F,a2 as Z,h as j,aH as ee,a as te,u as oe,l as ae,I as le,aI as se}from"./index.7d273429.js";import{Q as ne,d as re}from"./QSelect.e143cc54.js";import{Q as ie}from"./QInput.6dbca343.js";import{Q as de}from"./QForm.610b65d5.js";import{Q as ue}from"./QToolbar.01afc2ad.js";import{Q as P}from"./QTable.dcbb2092.js";import{Q as A}from"./QCard.c64e6f8c.js";import{Q as ce}from"./QPage.2694df2a.js";import{Q as me,a as fe}from"./QLayout.fe4b08b9.js";import{u as ve}from"./use-quasar.98a6e278.js";import{d as V}from"./dayjs.min.cbcf888d.js";import{_ as pe}from"./UserToolbar.09bdf317.js";import{v as H}from"./axios.fe2e7621.js";import{Q as O}from"./QCardSection.c342ad59.js";import{Q as N,a as be,b as q}from"./QTabPanels.14a7cfdd.js";import{Q as ge}from"./QTabs.19b15e65.js";import{E as ye}from"./exceljs.min.9e24d01d.js";import{c as D}from"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.5d634d57.js";import"./QLinearProgress.9a4df600.js";import"./QCheckbox.b36b1069.js";import"./QScrollObserver.bcdf7677.js";import"./QDrawer.dcbe1506.js";import"./QCardActions.ad50d1ad.js";import"./ClosePopup.644a39ca.js";import"./auth.52a43564.js";import"./use-render-cache.3aae9b27.js";var W={index({dateranges:C,view:k,store:p}){let g=k.id;return C.to,C.from,H.get(`/ciclicos?v=${g}&store=${p}`).then(_=>_.data).catch(_=>({fail:_}))},find(C,k){return H.get(`/ciclicos/${C}?store=${k}`).then(p=>p.data).catch(p=>({fail:p}))}},G={exports:{}};(function(C,k){(function(p,g){g()})(D,function(){function p(a,e){return typeof e=="undefined"?e={autoBom:!1}:typeof e!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function g(a,e,m){var l=new XMLHttpRequest;l.open("GET",a),l.responseType="blob",l.onload=function(){x(l.response,e,m)},l.onerror=function(){console.error("could not download file")},l.send()}function _(a){var e=new XMLHttpRequest;e.open("HEAD",a,!1);try{e.send()}catch{}return 200<=e.status&&299>=e.status}function s(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(e)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof D=="object"&&D.global===D?D:void 0,b=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),x=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(a,e,m){var l=d.URL||d.webkitURL,c=document.createElement("a");e=e||a.name||"download",c.download=e,c.rel="noopener",typeof a=="string"?(c.href=a,c.origin===location.origin?s(c):_(c.href)?g(a,e,m):s(c,c.target="_blank")):(c.href=l.createObjectURL(a),setTimeout(function(){l.revokeObjectURL(c.href)},4e4),setTimeout(function(){s(c)},0))}:"msSaveOrOpenBlob"in navigator?function(a,e,m){if(e=e||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(p(a,m),e);else if(_(a))g(a,e,m);else{var l=document.createElement("a");l.href=a,l.target="_blank",setTimeout(function(){s(l)})}}:function(a,e,m,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof a=="string")return g(a,e,m);var c=a.type==="application/octet-stream",S=/constructor/i.test(d.HTMLElement)||d.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||c&&S||b)&&typeof FileReader!="undefined"){var Q=new FileReader;Q.onloadend=function(){var v=Q.result;v=E?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=v:location=v,l=null},Q.readAsDataURL(a)}else{var i=d.URL||d.webkitURL,r=i.createObjectURL(a);l?l.location=r:location.href=r,l=null,setTimeout(function(){i.revokeObjectURL(r)},4e4)}});d.saveAs=x.saveAs=x,C.exports=x})})(G);var we=G.exports;const ke={class:"row justify-between"},he={class:"text-h6"},_e={class:"text-subtitle2"},xe={class:"text-subtitle2"},Ce={class:"text-subtitle2"},Qe={class:"text-white"},Me={__name:"Viewer",props:{folio:[String,Number],store:[String,Number]},emits:["errorsearch"],setup(C,{emit:k}){const p=C,g=p.folio,_=p.store,s=w(null),d=w(null),b=w("body"),x=w(null),a=w({cols:[{name:"id",field:"id",label:"ID",align:"left"},{name:"lcode",field:"code",label:"Codigo"},{name:"scode",field:"name",label:"Codigo C."},{name:"descr",field:"description",label:"Articulo",align:"left",classes:"fs-dec4"},{name:"sai",field:i=>i.ordered.stocks,label:"SAI",align:"center"},{name:"counteds",field:i=>i.ordered.stocks_acc,label:"UC",align:"center"},{name:"sat",field:i=>{var r;return(r=i.ordered.stocks_end)!=null?r:"--"},label:"SAT",align:"center"},{name:"ufus",field:i=>i.ordered.stocks_acc-i.ordered.stocks,label:"UF/US",align:"center"},{name:"locs",field:i=>i.locations.map(r=>r.path).join(", "),label:"Ubicacion (es)",align:"left"}]}),e=h(()=>s.value?s.value.created_by:null),m=h(()=>s.value?s.value.log:[]),l=h(()=>s.value&&s.value.responsables&&s.value.responsables.length?s.value.responsables.map(i=>i.nick).join(","):""),c=h(()=>s.value&&s.value.products&&s.value.products.length?s.value.products:[]),S=h(()=>s.value?s.value.status.name:"");h(()=>""),h(()=>""),(async()=>{const i=await W.find(g,_);console.log(i),i.fail?d.value=i.fail:s.value=i.inventory})();const Q=i=>{let r=`INV_${s.value.id}_${s.value.workpoint.alias}.xlsx`;console.log(r);let v=new ye.Workbook,t=v.addWorksheet("Sheet1");t.columns=[{header:"ID",key:"id"},{header:"Codigo",key:"lcode"},{header:"Codigo C.",key:"scode"},{header:"Articulo",key:"description"},{header:"SAI",key:"sai"},{header:"UC",key:"uc"},{header:"SAT",key:"sat"},{header:"UF/US",key:"ufus"},{header:"Ubicacion(es)",key:"locs"}],c.value.forEach(o=>{t.addRow({id:o.id,lcode:o.code,scode:o.name,description:o.description,sai:parseInt(o.ordered.stocks),uc:parseInt(o.ordered.stocks_acc),sat:parseInt(o.ordered.stocks_end),ufus:parseInt(o.ordered.stocks_acc)-parseInt(o.ordered.stocks),locs:o.locations.map(y=>y.path).join(", ")})}),t.getCell("L2").value="Folio:",t.getCell("M2").value=s.value.id,t.getCell("L3").value="Sucursal:",t.getCell("M3").value=s.value.workpoint.name,t.getCell("L4").value="Estado:",t.getCell("M4").value=S.value,t.getCell("L5").value="Creado por:",t.getCell("M5").value=e.value?e.value.names:"",t.getCell("L6").value="Realizado por:",t.getCell("M6").value=l.value,t.getCell("L7").value="Inicio:",t.getCell("M7").value="",t.getCell("L8").value="Termino:",t.getCell("M8").value="",v.xlsx.writeBuffer().then(o=>we(new Blob([o],{type:"application/octet-stream"}),r))};return(i,r)=>(M(),U(F,null,[s.value?(M(),R(A,{key:0,class:"my-card"},{default:u(()=>[n(O,null,{default:u(()=>[f("div",ke,[f("div",he,"Inventario "+L(z(g)),1),f("div",null,[n(T,{color:"primary",label:"descargar",onClick:Q})])]),f("div",_e,[r[2]||(r[2]=I("Creado por: ")),f("b",null,L(e.value?e.value.names:"Nobody"),1)]),f("div",xe,[r[3]||(r[3]=I("Realizado por: ")),f("b",null,L(l.value),1)]),f("div",Ce,[r[4]||(r[4]=I("Estado: ")),f("b",null,L(S.value),1)])]),_:1}),n(ge,{modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=v=>b.value=v)},{default:u(()=>[n(N,{name:"log",label:"Log"}),n(N,{name:"body",label:"Resumen"})]),_:1},8,["modelValue"]),n(be,{modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=v=>b.value=v),animated:""},{default:u(()=>[n(q,{name:"log"},{default:u(()=>[r[5]||(r[5]=f("div",{class:"text-h6"},"Log",-1)),(M(!0),U(F,null,Z(m.value,(v,t)=>(M(),U("div",{key:t},[f("pre",null,L(v),1)]))),128))]),_:1}),n(q,{name:"body"},{default:u(()=>[n(P,{flat:"",rows:c.value,columns:a.value.cols,"row-key":"name",ref_key:"rowsproducts",ref:x},null,8,["rows","columns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):j("",!0),d.value?(M(),R(A,{key:1,class:"bg-negative"},{default:u(()=>[n(O,null,{default:u(()=>[f("pre",Qe,L(d.value),1)]),_:1})]),_:1})):j("",!0)],64))}},Se={class:"row items-center"},Le={key:0,class:"text-right"},lt={__name:"CiclicosLayout",setup(C){const k=w(""),p=ve(),g=ee(),_=te(),s=oe(),d=w({state:!1,data:null}),b=w(null),x=w([]),a=w({cols:[{name:"id",field:"id",label:"Folio"},{name:"started",field:t=>V(t.created_at).format("YYYY/MM/DD HH:mm:ss"),label:"Creacion",align:"center"},{name:"status",field:t=>t.status.name,label:"Estado",align:"center"},{name:"ended",field:t=>{let o=t.log.find(y=>y.id==3);return o?V(o.pivot.created_at).format("YYYY/MM/DD HH:mm:ss"):"--"},align:"center",label:"Termino"},{name:"models",field:"products_count",label:"Modelos"},{name:"type",field:t=>t.type.name,label:"Tipo"},{name:"warehouse",field:t=>t.settings?t.settings.warehouse.name:"---",label:"Almacen"}]}),e=w([{id:"day",label:"Hoy"},{id:"week",label:"Semana"},{id:"month",label:"Mes"},{id:"c",label:"otra ...",disable:!0}]),m=w({from:V(Date.now()).startOf("day"),to:V(Date.now()).endOf("day")}),l=h(()=>x.value.map(t=>(t.settings=JSON.parse(t.settings),t))),c=h(()=>k.value&&k.value.length),S=h(()=>m.value.from.format("YYYY/MM/DD")),E=h(()=>m.value.to.format("YYYY/MM/DD")),Q=()=>{console.log("searching folio"),d.value.folio=k.value,d.value.state=!0},i=async(t,o,y)=>{d.value.folio=o.id,d.value.state=!0},r=async()=>{var B;console.log(s.session),p.loading.show({message:"Cargado vista..."});let t=(B=g.query.v)!=null?B:"day",o=e.value.findIndex(J=>J.id==t),y=o>=0?o:0;console.log(y),b.value=e.value[y],m.value.from=V(Date.now()).startOf(b.value.id);const $=await W.index({dateranges:m,view:b.value,store:s.session.store.id_viz});console.log($),x.value=$.inventories,p.loading.hide()},v=()=>{_.push(`/ciclicos?v=${b.value.id}`)};return r(),ae(()=>g.query,()=>{r()}),(t,o)=>(M(),R(me,{view:"hHh Lpr fFf"},{default:u(()=>[n(K,{class:"bg-grey-3 text-dark",bordered:""},{default:u(()=>[n(pe),n(Y)]),_:1}),n(fe,null,{default:u(()=>[n(ue,{class:"justify-between"},{default:u(()=>[f("div",null,[o[3]||(o[3]=f("span",{class:"text-grey"},"Helpers",-1)),o[4]||(o[4]=I()),n(le,{name:"navigate_next",color:"primary"}),o[5]||(o[5]=I()),o[6]||(o[6]=f("span",{class:"text-h6"},"Ciclicos",-1))]),f("div",Se,[n(ne,{modelValue:b.value,"onUpdate:modelValue":[o[0]||(o[0]=y=>b.value=y),v],options:e.value,label:"Vista",autofocus:"",borderless:""},{prepend:u(()=>[n(T,{dense:"",flat:"",color:"primary",icon:"autorenew",onClick:se(r,["stop"])})]),_:1},8,["modelValue","options"]),n(T,{color:"primary",icon:"search",dense:"",flat:""},{default:u(()=>[n(re,null,{default:u(()=>[o[7]||(o[7]=f("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Inventario",-1)),n(Y),n(de,{dense:"",onSubmit:Q,class:"q-gutter-md q-pa-md"},{default:u(()=>[n(ie,{modelValue:k.value,"onUpdate:modelValue":o[1]||(o[1]=y=>k.value=y),type:"number",label:"Folio",autofocus:""},null,8,["modelValue"]),c.value?(M(),U("div",Le,[n(T,{type:"submit",color:"primary",icon:"search"})])):j("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),n(ce,{padding:""},{default:u(()=>[n(A,{class:"my-card",flat:""},{default:u(()=>[n(P,{title:`Inventarios del ${S.value} al ${E.value} [ ${x.value.length} ]`,rows:l.value,columns:a.value.cols,"row-key":"id",onRowClick:i},null,8,["title","rows","columns"])]),_:1}),n(X,{modelValue:d.value.state,"onUpdate:modelValue":o[2]||(o[2]=y=>d.value.state=y),"full-width":""},{default:u(()=>[n(Me,{folio:d.value.folio,store:z(s).session.store.id_viz},null,8,["folio","store"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{lt as default};
