import"./axios.bf079879.js";const v=(a,o,l)=>{const p=o.category.familia.seccion.id,e=l.find(i=>i._category==p).rules;let n=0,t=0,s=0;if(!e)return!1;let c=a.filter(i=>i.id===o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),f=a.filter(i=>i.category.familia.id===o.category.familia.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),r=a.filter(i=>i.category.familia.seccion.id===o.category.familia.seccion.id&&i.id!==o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0);a.findIndex(i=>i.id==o.id)>=0?(n=c,t=f,s=r):(n=c+Number(o.pivot.units),t=f+Number(o.pivot.units),s=r+Number(o.pivot.units));for(const i of e)if(i._type===2&&(i.sameModel==1&&n>=i.min&&(!i.max||n<=i.max)||i.sameModel==0&&t>=i.min&&(!i.max||t<=i.max)||i.sameModel==0&&s>=i.min&&(!i.max||t<=i.max)&&i.family==0))return!0;return!1},d=(a,o,l)=>{const p=o.category.familia.seccion.id,e=l.find(i=>i._category==p).rules;let n=0,t=0,s=0;if(!e)return!1;let c=a.filter(i=>i.id===o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),f=a.filter(i=>i.category.familia.id===o.category.familia.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0),r=a.filter(i=>i.category.familia.seccion.id===o.category.familia.seccion.id&&i.id!==o.id).reduce((i,m)=>i+Number(u(m.pivot,m.pieces)),0);a.findIndex(i=>i.id==o.id)>=0?(n=c,t=f,s=r):(n=c+Number(o.pivot.units),t=f+Number(o.pivot.units),s=r+Number(o.pivot.units));for(const i of e)if(i._type===3&&(i.sameModel==1&&n>=i.min&&(!i.max||n<=i.max)||i.sameModel==0&&t>=i.min&&(!i.max||t<=i.max)||i.sameModel==0&&s>=i.min&&(!i.max||t<=i.max)&&i.family==0))return!0;return!1},_=(a,o)=>{let l=0;return l=a.filter(e=>e.id===o.id).reduce((e,n)=>e+Number(u(n.pivot,n.pieces)),0)+Number(o.pivot.units),l>=o.pieces},b=async(a,o,l)=>{const p=[];for(const e of a){const n=e.pivot._supply_by==3?e.pivot.amount*e.pieces:e.pivot._supply_by==2?e.pivot.amount*12:e.pivot.amount;let t=0;o.client._price_list<=3?_(a,e)?t=4:d(a,e,l)?t=3:v(a,e,l)?t=2:t=1:t=o.client._price_list;const s=e.prices.find(c=>c.id==t);if(s){const c=e.pivot.price,f=e.pivot._price_list,r=s.pivot.price;(c!==r||f!==t)&&(e.pivot._price_list=t,e.pivot.price=r,e.pivot.total=n*r,p.push({_order:e.pivot._order,_product:e.id,_price_list:t,price:r,total:n*r}))}}},g=async(a,o,l)=>{const p=[];for(const e of a){const n=e.pivot.units;let t=0;o<=3?_(a,e)?t=4:d(a,e,l)?t=3:v(a,e,l)?t=2:t=1:t=o,console.log(t);const s=e.prices.find(c=>c.id==t);if(s){const c=e.pivot.price,f=e.pivot._price_list,r=s.pivot.price;(c!==r||f!==t)&&(e.pivot._price_list=t,e.pivot.price=r,e.pivot.total=n*r,p.push({_product:e.id,_price_list:t,price:r,total:n*r}))}}},u=(a,o)=>a.units,x=(a,o)=>{o.forEach(l=>{l.type==="NXM"&&N(a,l)})},N=(a,o)=>{const l=o.products.map(s=>s._product),p=a.filter(s=>l.includes(s.id));if(!p.length)return;p.forEach(s=>{const c=Number(s.pivot.units),f=Number(s.pivot.price);s.pivot.subtotal=c*f,s.pivot.promo_units=0,s.pivot.promo_discount=0,s.pivot.total=s.pivot.subtotal});const e=p.reduce((s,c)=>s+Number(c.pivot.units),0),n=Math.floor(e/2);if(n<=0)return;let t=n;for(const s of p){if(t<=0)break;const c=Number(s.pivot.units),f=Number(s.pivot.price),r=Math.min(c,t);r<=0||(s.pivot.promo_units+=r,s.pivot.promo_discount+=r*f,s.pivot.total-=r*f,t-=r)}};var M={verificarPrecioMayoreo:v,verificarPrecioDocena:d,actualizarPreciosProductos:b,actualizarPreciosProductosSales:g,verificarPrecioCaja:_,aplicarPromociones:x};export{M as R};
