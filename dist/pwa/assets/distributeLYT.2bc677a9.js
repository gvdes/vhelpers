import{Q as B}from"./QHeader.b8b06f2a.js";import{aH as L,a as F,u as Y,r as $,q as M,p as T,a$ as j,o as g,d as h,w as c,e as n,a1 as w,f as m,a0 as b,Q as _,h as P}from"./index.fd350b89.js";import{Q as H}from"./QToolbar.a962b7f0.js";import{Q as I,a as N}from"./QLayout.0180285a.js";import{Q as E}from"./QDate.6e5ff825.js";import{Q as A,a as R}from"./QCard.9f1a5405.js";import{Q as G}from"./QCardActions.249b1a8e.js";import{d as J}from"./QList.089ead1d.js";import{_ as K}from"./UserToolbar.6b4abdc8.js";import{u as V}from"./Restock.6ca218fc.js";import{d as W}from"./dayjs.min.cbcf888d.js";import{R as p}from"./RestockApi.89d60020.js";import{u as X}from"./axios.bfe39b1e.js";import{$sktRestock as a}from"./socket.3fae67a0.js";import"./QResizeObserver.e9566465.js";import"./QScrollObserver.df1a7b07.js";import"./use-render-cache.3aae9b27.js";import"./date.0757d0bc.js";import"./QSelect.2a23302d.js";import"./QExpansionItem.6fb12d6b.js";import"./QDrawer.955b9e7c.js";import"./touch.9135741d.js";import"./ClosePopup.65fd9e4a.js";import"./auth.e9466448.js";import"./_commonjsHelpers.88e99c8f.js";const Z={class:"text-bold"},oo={class:"row"},eo={class:"col row"},ro={class:"q-pa-md"},bo={__name:"distributeLYT",setup(to){const y=V();L(),F();const t=V(),v=X(),s=Y(),f=$(!1),d=$({val:{from:null,to:null}}),S={profile:{me:{id:s.session.credentials.staff.id_va,nick:s.session.credentials.nick,picture:"",names:s.session.credentials.staff.complete_name,surname_pat:"",surname_mat:"",change_password:!1,_rol:1},workpoint:s.session.store},workpoint:s.session.store},Q=async()=>{t.setShowLoad(!0),v.loading.show({message:"Cargado vista..."}),console.log("%cIniciando MainLayout...","font-size:2em;color:orange;");let o=W(new Date).format("YYYY/MM/DD");d.value.val={from:o,to:o};const e=await p.index({date:d.value.val,storeTo:s.session.store.id_viz});e.fail?console.log(e):(console.log(e),t.fillOrders(e.orders),t.fillResume(e.resume),t.fillPrinters(e.printers),t.setUsers(e.staff),t.fillPartitions(e.partitions),t.setShowLoad(!1),console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),v.loading.hide())},k=async()=>{f.value=!1,v.loading.show({message:"Obteniendo Datos"});const o=await p.index({date:d.value.val,storeTo:s.session.store.id_viz});console.log(o),t.fillOrders(o.orders),t.fillPartitions(o.partitions),console.log("%cMainLayout listo!!","font-size:2em;color:orange;"),v.loading.hide()},C=async o=>{if(console.log(o),o.order.requisition.to.id===s.session.store.id_viz||o.order.requisition.from.id===s.session.store.id_viz){o.order,console.log("Partition refresh!!",o);let e=o.order,i=o.order.id;t.addOrUpdatePartition(i,e),console.log(e),console.log(i);let r=t.ordersdb.find(u=>u.id==e._requisition).partition;console.log(r);let l=r.findIndex(u=>u.id==e.id);l>=0&&r.splice(l,1,e)}},z=o=>{console.log(`%c${o.user.me.nick} de ${o.from.alias} se ha unido a Restock (UID: ${o.user.me.id})`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},q=async o=>{if(console.log(o),o.order.to.id===s.session.store.id_viz||o.order.from.id===s.session.store.id_viz){let e=o.order;console.log(o.order.to.id);let i=await p.orderFresh(e.id),r=i.data.order,l=i.data.oid;t.addOrUpdate(l,r)}},O=async o=>{if(console.log(o),o.requisition.to.id===s.session.store.id_viz||o.requisition.from.id===s.session.store.id_viz){console.log(o.requisition.to.id);let e=o,i=o.id;t.addOrUpdatePartition(i,e)}},x=o=>{t.orderUpdate(o)},D=async o=>{if(o.order.to.id===s.session.store.id_viz){let e=o.order,i=o.state,r=await p.orderFresh(e.id),l=r.data.order,u=r.data.oid;t.addOrUpdate(u,l),i.id==2}},U=async o=>{var e;if(console.log(o),((e=o.order)==null?void 0:e.to.id)===s.session.store.id_viz||o.order.from.id===s.session.store.id_viz){console.log("REFRESHING BY SKT!!",o);let i=o.order,r=await p.orderFresh(i.id);console.log(r);let l=r.data.order;console.log(l.partition);let u=r.data.oid;t.addOrUpdate(u,l)}};return M(()=>{a.connect(),a.emit("joinat",S),a.on("joineddashreq",z),a.on("creating",q),a.on("order_update",x),a.on("order_changestate",D),a.on("order_refresh",U),a.on("orderpartition_refresh",C),a.on("sktPartitionCreate",O)}),T(()=>{a.off("joineddashreq",z),a.off("creating",q),a.off("order_update",x),a.off("order_changestate",D),a.off("order_refresh",U),a.off("orderpartition_refresh",C),a.on("sktPartitionCreate",O)}),Q(),(o,e)=>{const i=j("router-view");return g(),h(I,{view:"hHh Lpr fFf"},{default:c(()=>[n(B,{class:"transparent text-dark",bordered:""},{default:c(()=>[n(K)]),_:1}),n(N,null,{default:c(()=>[w(t).showLYT?(g(),h(H,{key:0,class:"row justify-between items-center"},{default:c(()=>[m("div",Z,b(w(y).title),1),m("div",null,b(d.value.val&&d.value.val.from?`Del ${d.value.val.from} a ${d.value.val.to}`:d.value.val),1),m("div",oo,[n(_,{color:"white",round:"",unelevated:"",flat:"",icon:"sync",onClick:Q}),m("div",eo,[w(y).showButton?(g(),h(_,{key:0,color:"primary",icon:"event",onClick:e[0]||(e[0]=r=>f.value=!f.value),flat:"",round:""})):P("",!0)])])]),_:1})):P("",!0),n(i)]),_:1}),n(J,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=r=>f.value=r)},{default:c(()=>[n(A,{class:"my-card"},{default:c(()=>[n(R,null,{default:c(()=>[m("div",ro,[e[4]||(e[4]=m("div",{class:"q-pb-sm text-center"},null,-1)),n(E,{modelValue:d.value.val,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value.val=r),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),n(R,null,{default:c(()=>[n(G,{align:"right"},{default:c(()=>[n(_,{flat:"",icon:"close",color:"negative",onClick:e[2]||(e[2]=r=>f.value=!f.value)}),n(_,{flat:"",icon:"check",color:"positive",onClick:k})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{bo as default};
