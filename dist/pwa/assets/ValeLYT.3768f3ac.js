import{Q as T}from"./QSeparator.1133f537.js";import{r as C,c as A,o as u,a as v,w as a,e,i as b,a3 as r,Y as Z,Q as V,f as m,g as D,h as y,_ as z,aU as X,a4 as g,a0 as G,a1 as J,a5 as K,a2 as S,a6 as W}from"./index.0cca38c5.js";import{d as ee,Q as L,a as O,b as n}from"./QSelect.039f887b.js";import{Q as N}from"./QInput.28bed99e.js";import{Q as ae}from"./QForm.061f8c5e.js";import{Q as le}from"./QToolbar.70153696.js";import{Q as te}from"./QHeader.cd592aa8.js";import{Q as U,a as x}from"./QCard.223ea652.js";import{Q as E}from"./QList.54b5f586.js";import{Q as oe}from"./QCheckbox.3bbebfa6.js";import{Q as P}from"./QCardActions.e40a88fb.js";import{Q as se}from"./QDialog.c9afd5e4.js";import{Q as re}from"./QPage.0bb45455.js";import{Q as ne,a as ie}from"./QLayout.2fb914d0.js";import{C as ue}from"./ClosePopup.d3a702a8.js";import{u as de}from"./VDB.541c1b67.js";import{_ as ce}from"./UserToolbar.a8f53ffe.js";import{a as R}from"./axios.f1f32898.js";import{u as me}from"./use-quasar.a81f546b.js";import{a as pe}from"./axios.eed4c97e.js";import"./use-key-composition.fb1517f2.js";import"./uid.42677368.js";import"./position-engine.dfcb92a2.js";import"./rtl.b51694b1.js";import"./QResizeObserver.25079b51.js";const fe=b("span",{class:"text-h6"},"VALES",-1),ve=b("div",{class:"q-pa-md bg-grey-2 text-primary"},"Buscar Folio",-1),be={key:0,class:"text-right"},ge={class:"row justify-center"},ye={class:"text-bold text-h5"},_e=b("span",{class:"q-ml-sm"},"Selecciona Impresora",-1),Ye={__name:"ValeLYT",setup(he){const p=de(),d=me(),$=p.series,h=C(null),Q=C(""),i=C({state:!1,body:null}),c=C({state:!1,val:null,body:null}),k=C(""),f=C([]),B=A(()=>h.value&&Q.value.length),F=A(()=>k.value?i.value.body.product.filter(s=>s.ARTICULO.includes(k.value)):i.value.body.product),_=A(()=>d.platform.is.mobile),q=A(()=>f.value.length>0?f.value.every(s=>Number(s.change)>0)&&f.value.every(s=>Number(s.change)<=Number(s.CANTIDAD)):!1),w=async()=>{let s=p.session.store.id;console.log(s);try{let t=await pe.get(`/cashier/getPrinters/${s}`);t.status==200&&(c.value.body=t.data,console.log("Impresoras listas :)"))}catch(t){console.log(t),d.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},H=async()=>{d.loading.show({message:"Obteniendo Ticket"}),i.value.body=null;let s={type:"Modificacion",serie:h.value,folio:Q.value},l=`http://${p.session.store.ip}/access/public/modify/newmod`;R.post(l,s).then(o=>{console.log(o),i.value.state=!0,i.value.body=o.data,d.loading.hide()}).catch(o=>{console.log(o.response.data.message),d.notify({html:!0,message:o.response.data.message,color:"negative",position:"center"})})},j=()=>{c.value.state=!0},M=()=>{d.loading.show({message:"Obteniendo Ticket"}),f.value.map(o=>o._chantot=o.change*o.PRECIO);let s={ticket:i.value.body.ticket,products:f.value,print:c.value.val,created:`${p.session.name} - ${p.session.store.alias}`},l=`http://${p.session.store.ip}/access/public/modify/createVal`;R.post(l,s).then(o=>{console.log(o),o.data.mmsg&&(d.notify({message:`devolucion ${o.data.devolucion}`,type:"positive",position:"center"}),d.notify({message:`vale ${o.data.vale}`,type:"positive",position:"center"})),h.value=null,Q.value="",i.value={state:!1,body:null},c.value={state:!1,val:null,body:null},k.value="",f.value=[],d.loading.hide()}).catch(o=>{console.log(o),d.notify({html:!0,message:o,color:"negative",position:"center"})}),console.log(s)},Y=()=>{h.value=null,Q.value="",i.value={state:!1,body:null},c.value={state:!1,val:null,body:null},k.value="",f.value=[]};return p.session.rol=="aux"||p.session.rol=="gen"||p.session.rol=="aud"||p.session.rol=="root"?w():(d.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),$router.replace("/")),w(),(s,t)=>(u(),v(ne,{view:"hHh Lpr fFf"},{default:a(()=>[e(te,{class:"transparent text-dark",bordered:""},{default:a(()=>[e(ce),e(T),e(le,{class:"justify-between"},{default:a(()=>[b("div",null,[r("Helpers "),e(Z,{name:"navigate_next",color:"primary"}),r(),fe]),e(V,{color:"primary",icon:"add"},{default:a(()=>[e(ee,null,{default:a(()=>[ve,e(T),e(ae,{dense:"",onSubmit:H,class:"q-gutter-md q-pa-md"},{default:a(()=>[e(L,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=l=>h.value=l),options:m($),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(N,{modelValue:Q.value,"onUpdate:modelValue":t[1]||(t[1]=l=>Q.value=l),type:"number",label:"Folio"},null,8,["modelValue"]),m(B)?(u(),D("div",be,[e(V,{type:"submit",color:"primary",icon:"search"})])):y("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,null,{default:a(()=>[e(re,{class:"bg-grey-3",padding:""},{default:a(()=>[b("div",ge,[e(z,{name:"bounce"},{default:a(()=>[i.value.state?(u(),v(U,{key:0,flat:"",bordered:"",style:X(`width: ${m(_)?"100%;":"70%;"}`)},{default:a(()=>[e(x,null,{default:a(()=>[b("div",ye,"Ticket: "+g(i.value.body.ticket.ticket),1),b("div",null,"N\xBA Cliente: "+g(i.value.body.ticket.codcli),1),b("div",null,"Cliente: "+g(i.value.body.ticket.cliente),1),b("div",null,"Fecha: "+g(i.value.body.ticket.fecha),1)]),_:1}),e(x,{class:"text-center text-bold"},{default:a(()=>[r(" Selecciona los productos que se creara el vale ")]),_:1}),e(x,null,{default:a(()=>[e(N,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=l=>k.value=l),type:"text",label:"Buscar",filled:""},null,8,["modelValue"])]),_:1}),e(x,null,{default:a(()=>[e(E,{bordered:""},{default:a(()=>[e(O,{dense:""},{default:a(()=>[e(n,null,{default:a(()=>[r("ARTICULO")]),_:1}),m(_)?y("",!0):(u(),v(n,{key:0,class:"text-left"},{default:a(()=>[r("DESCRIPCION")]),_:1})),e(n,{class:"text-right"},{default:a(()=>[r("CANTIDAD")]),_:1}),m(_)?y("",!0):(u(),v(n,{key:1,class:"text-right"},{default:a(()=>[r("PRECIO")]),_:1})),m(_)?y("",!0):(u(),v(n,{key:2,class:"text-right"},{default:a(()=>[r("TOTAL")]),_:1})),e(n,null,{default:a(()=>[r(" SELECT ")]),_:1}),e(n,null,{default:a(()=>[r(" PIEZAS A DEV")]),_:1}),e(T,{spaced:"",inset:"",vertical:"",dark:""})]),_:1})]),_:1}),e(T,{spaced:"",inset:"",vertical:"",dark:""}),(u(!0),D(J,null,G(m(F),(l,o)=>(u(),v(E,{bordered:"",key:o},{default:a(()=>[S((u(),v(O,{dense:"",tag:"label"},{default:a(()=>[e(n,null,{default:a(()=>[r(g(l.ARTICULO),1)]),_:2},1024),m(_)?y("",!0):(u(),v(n,{key:0,class:"text-left"},{default:a(()=>[r(g(l.DESCRIPCION),1)]),_:2},1024)),e(n,{class:"text-right"},{default:a(()=>[r(g(Number(l.CANTIDAD).toFixed(2)),1)]),_:2},1024),m(_)?y("",!0):(u(),v(n,{key:1,class:"text-right"},{default:a(()=>[r(g(Number(l.PRECIO).toFixed(2)),1)]),_:2},1024)),m(_)?y("",!0):(u(),v(n,{key:2,class:"text-right"},{default:a(()=>[r(g(Number(l.TOTAL).toFixed(2)),1)]),_:2},1024)),e(n,null,{default:a(()=>[e(oe,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=I=>f.value=I),val:l},null,8,["modelValue","val"])]),_:2},1024),e(n,null,{default:a(()=>[e(N,{modelValue:l.change,"onUpdate:modelValue":I=>l.change=I,type:"number",label:"PZ",outlined:"",error:l.change>Number(l.CANTIDAD),"error-message":"es mayor que la cantidad X(",disable:!f.value.some(I=>I.ARTICULO===l.ARTICULO)},null,8,["modelValue","onUpdate:modelValue","error","disable"])]),_:2},1024),e(T,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024)),[[W]])]),_:2},1024))),128))]),_:1}),b("div",null,[e(P,{align:"between"},{default:a(()=>[e(V,{flat:"",icon:"cancel",onClick:Y}),e(V,{flat:"",icon:"arrow_forward",disable:!m(q),onClick:j},null,8,["disable"])]),_:1})])]),_:1},8,["style"])):y("",!0)]),_:1})]),e(se,{modelValue:c.value.state,"onUpdate:modelValue":t[5]||(t[5]=l=>c.value.state=l),persistent:""},{default:a(()=>[e(U,null,{default:a(()=>[e(x,{class:"row items-center"},{default:a(()=>[e(K,{icon:"print",color:"primary","text-color":"white"}),_e]),_:1}),e(x,null,{default:a(()=>[e(L,{modelValue:c.value.val,"onUpdate:modelValue":t[4]||(t[4]=l=>c.value.val=l),options:c.value.body,label:"Impresora","option-label":"name",filled:""},null,8,["modelValue","options"])]),_:1}),e(P,{align:"right"},{default:a(()=>[S(e(V,{flat:"",label:"Cancel",color:"negative"},null,512),[[ue]]),e(V,{flat:"",label:"Continuar",color:"positive",onClick:M,disable:!c.value.val},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Ye as default};
