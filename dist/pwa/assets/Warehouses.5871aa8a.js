import{Q as B}from"./QToolbarTitle.48fcb888.js";import{Q as X}from"./QToolbar.901abb86.js";import{b as h}from"./QList.bf2ca64e.js";import{Q as w}from"./QSelect.d601643f.js";import{u as F,r as y,c as S,o as I,d as _,w as v,e as o,al as D,Q as A}from"./index.e74f744c.js";import{Q as L}from"./QCardSection.3a5b15bd.js";import{Q as M}from"./QCard.726ff719.js";import{Q as Y}from"./QTable.dd6ed05e.js";import{Q as U}from"./QPage.3d276047.js";import{r as P}from"./reportApi.32c4e0be.js";import{u as W}from"./use-quasar.da86dd6a.js";import"./jspdf.plugin.autotable.f2770f0e.js";import{E as j}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{d as m}from"./dayjs.min.cbcf888d.js";import"./use-key-composition.8f0344f2.js";import"./QLinearProgress.a4f3b7d6.js";import"./QCheckbox.b7319d3b.js";import"./use-checkbox.04130c60.js";import"./axios.952f42b7.js";import"./_commonjsHelpers.88e99c8f.js";const ge={__name:"Warehouses",setup(q){F();const p=W(),E=y([]),l=y({all:[],seccion:{val:[]},familias:{val:[]},categories:{val:[]}}),k=y(!1),g=y([]),b=S(()=>({pagination:{rowsPerPage:10}})),Q=[{name:"code",label:"CODIGO",field:e=>e.code,align:"left"},{name:"description",label:"DESCRIPCION",field:e=>e.description,align:"left"},{name:"barcode",label:"CB",field:e=>e.barcode,align:"left"},{name:"section",label:"SECCION",field:e=>e.category.familia.seccion.name,align:"left"},{name:"family",label:"FAMILIA",field:e=>e.category.familia.name,align:"left"},{name:"category",label:"CATEGORIA",field:e=>e.category.name,align:"left"},{name:"mennav",label:"MEDNAV/PERS",field:e=>e.large,align:"left"},{name:"provider",label:"PROVEEDOR",field:e=>e.providers.name,align:"left"},{name:"maker",label:"FABRICANTE",field:e=>{var a;return(a=e.makers)==null?void 0:a.name},align:"left"},{name:"pxc",label:"PXC",field:e=>e.pieces,align:"center"},{name:"purchases",label:"COMPRAS",field:e=>e.PurchaseYear,align:"center"},{name:"purchasesPXC",label:"COMPRAS PXC",field:e=>Number(e.PurchaseYear/e.pieces).toFixed(2),align:"center"},{name:`sales${m().year()-1}`,label:`VENTAS ${m().year()-1}`,field:e=>e.SalesSubYear,align:"center"},{name:`sales${m().year()-1} PXC`,label:`VENTAS ${m().year()-1} PXC`,field:e=>Number(e.SalesSubYear/e.pieces).toFixed(2),align:"center"},{name:`sales${m().year()}`,label:`VENTAS ${m().year()}`,field:e=>e.SalesYear,align:"center"},{name:`sales${m().year()} PXC`,label:`VENTAS ${m().year()} PXC`,field:e=>Number(e.SalesYear/e.pieces).toFixed(2),align:"center"},{name:"stock",label:"STOCK",field:e=>e.SumStock,align:"center"},{name:"stock PXC",label:"STOCK PXC",field:e=>Number(e.SumStock/e.pieces).toFixed(2),align:"center"}],V=e=>{const a=[];e.forEach(n=>{n.stocks&&n.stocks.forEach(r=>{a.find(s=>s.id===r.id)||a.push(r)})});const i=a.map(n=>({name:`s_${n.alias}`,label:`${n.alias}`,field:r=>{var C;const s=(C=r.stocks)==null?void 0:C.find(u=>u.id===n.id);return s?s.pivot.stock:0},align:"center"}));return[...Q,...i]},x=S(()=>l.value.all.filter(e=>e.deep==0)),N=S(()=>l.value.seccion.val.length>0?l.value.all.filter(e=>e.deep==1&&l.value.seccion.val.map(a=>a.id).includes(e.root)):l.value.all.filter(e=>e.deep==1)),T=S(()=>{if(l.value.seccion.val.length>0&&l.value.familias.val.length==0){let e=l.value.all.filter(a=>a.deep==1&&l.value.seccion.val.map(i=>i.id).includes(a.root)).map(a=>a.id);return l.value.all.filter(a=>a.deep==2&&e.includes(a.root))}else return l.value.familias.val.length>0?l.value.all.filter(e=>e.deep==2&&l.value.familias.val.map(a=>a.id).includes(e.root)):l.value.all.filter(e=>e.deep==2)}),O=async()=>{p.loading.show({message:"Obteniendo Familias"});const e=await P.init();e.fail?(console.log(e),p.loading.hide()):(console.log(e),l.value.all=e,p.loading.hide())},R=async()=>{var i,n,r;p.loading.show({message:"El reporte puede tardar unos minutos"}),k.value=!0;let e={sections:(i=l.value.seccion.val)==null?void 0:i.map(s=>s.id),familys:(n=l.value.familias.val)==null?void 0:n.map(s=>s.id),categories:(r=l.value.categories.val)==null?void 0:r.map(s=>s.id)};console.log(e);const a=await P.reportWarehouses(e);a.fail?(console.log(a),p.notify({message:"No se pudo obtener el reporte comuniquese con soporte",type:"negative",position:"center"})):(console.log(a),g.value=a,E.value=V(g.value),k.value=!1,p.loading.hide())},$=async()=>{const e=new j.Workbook,a=e.addWorksheet("Almacenes"),i=b.value.columns.map(t=>({header:t.label,key:t.name,width:15}));a.columns=i;const r=g.value.map(t=>{const c={};return b.value.columns.forEach(d=>{let f;typeof d.field=="function"?f=d.field(t):f=t[d.field],c[d.name]=f}),c}).map(t=>b.value.columns.map(c=>t[c.name]));a.addTable({name:"Almacenes",ref:"A1",headerRow:!0,style:{theme:"TableStyleMedium9",showRowStripes:!0},columns:b.value.columns.map(t=>({name:t.label,filterButton:!0})),rows:r}),a.columns.forEach(t=>{let c=0;t.eachCell({includeEmpty:!0},d=>{const f=d.value?d.value.toString().length:10;f>c&&(c=f)}),t.width=c<10?10:c});const s=await e.xlsx.writeBuffer(),C=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=document.createElement("a");u.href=URL.createObjectURL(C),u.download="almacenes.xlsx",document.body.appendChild(u),u.click(),document.body.removeChild(u)};return O(),(e,a)=>(I(),_(U,{padding:""},{default:v(()=>[o(X,null,{default:v(()=>[o(B,null,{default:v(()=>a[3]||(a[3]=[D(" ALMACENES ")])),_:1})]),_:1}),o(h),o(M,{class:"my-card"},{default:v(()=>[o(L,{class:"row"},{default:v(()=>[o(w,{class:"col",modelValue:l.value.seccion.val,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value.seccion.val=i),options:x.value,label:"Seccion",filled:"",dense:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(w,{class:"col",modelValue:l.value.familias.val,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.familias.val=i),options:N.value,label:"Familia",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:l.value.seccion.val.length==0},null,8,["modelValue","options","disable"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(w,{class:"col",modelValue:l.value.categories.val,"onUpdate:modelValue":a[2]||(a[2]=i=>l.value.categories.val=i),options:T.value,label:"Categoria",filled:"",dense:"","option-label":"name",multiple:"","use-chips":"",disable:l.value.seccion.val.length==0||l.value.familias.val.length==0},null,8,["modelValue","options","disable"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(A,{color:"primary",label:l.value.seccion.val.length>0?"Obtener":"Todos",flat:"",onClick:R},null,8,["label"])]),_:1})]),_:1}),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(Y,{rows:g.value,pagination:b.value.pagination,loading:k.value,columns:E.value},{"top-right":v(()=>[o(A,{disable:g.value.value,color:"primary",icon:"download",flat:"",onClick:$},null,8,["disable"])]),_:1},8,["rows","pagination","loading","columns"])]),_:1}))}};export{ge as default};
