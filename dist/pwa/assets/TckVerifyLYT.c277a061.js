import{u as fe,r as y,g as h,a as f,h as j,i as t,d as e,a4 as p,k as s,j as v,ah as J,n as b,a7 as K,m as H,c as x,p as N,aE as be,Q as g,l as d,a1 as r,a5 as P,aX as G,aY as ge,a6 as I,bc as ye,ba as L,a2 as B,a3 as F}from"./index.7b36b598.js";import{Q as xe}from"./QHeader.3caed621.js";import{e as ke,Q as $,a as V}from"./QSelect.6d05204b.js";import{Q as A}from"./QForm.55f39c90.js";import{Q as _e}from"./QToolbar.16507dcd.js";import{Q as Ve,a as Ce,b as E}from"./QList.912e2662.js";import{Q as W}from"./QSpace.9d6d302e.js";import{Q as Z}from"./QTable.7331a546.js";import{a as we}from"./QExpansionItem.404142ee.js";import{Q as Qe}from"./QPage.4fad267d.js";import{Q as he}from"./QFooter.8f5d5723.js";import{Q as Pe,a as Te}from"./QLayout.5a70b4ab.js";import{C as Se}from"./ClosePopup.8d8b6328.js";import{_ as Ie}from"./UserToolbar.c011ba69.js";import{a as Ue,b as ee}from"./axios.59d61e02.js";import{u as qe}from"./use-quasar.d212ba29.js";/* empty css                                                                         */import"./QResizeObserver.aad412c0.js";import"./QLinearProgress.51f9a353.js";import"./QScrollObserver.b72b88d9.js";import"./QImg.8ac60bab.js";import"./favorites.6a93ba8d.js";import"./auth.21736647.js";const De={key:0,class:"text-right"},Ne={key:0},Be={class:"row"},Fe={class:"justify-center"},$e={class:"text-center text-bold"},Ee={class:"row justify-between"},Me={class:"text-left"},Re={class:"text--3"},je={class:"text-h6"},He={class:"text-right"},Le={class:"text--2"},Ae={class:"row"},Oe={class:"text-center col"},Xe={class:"text-center col"},Ye={class:"text-center col"},ze={class:"text-h6"},xl={__name:"TckVerifyLYT",setup(Je){const U=fe(),m=qe(),le=U.series,T=y(null),C=y(null),S=y(""),c=y({state:!1,val:null,body:null}),M=y({state:!1}),n=y({state:!1,body:[],head:null}),u=y({state:!1,val:null}),q=y(!1),R=y([]),k=y({pagination:{rowsPerPage:0},visibleColumns:["code","description"],visibleColumnstwo:["code","description","checkout","diferencia"],columns:[{name:"code",label:"Codigo",field:o=>o.codigo,required:!0,align:"left",sortable:!0},{name:"barcode",label:"CB",field:o=>o.cb,align:"left",sortable:!0},{name:"shortcode",label:"Corto",field:o=>o.corto,align:"center",sortable:!0},{name:"description",label:"Descripcion",field:o=>o.descripcion,align:"left",sortable:!0},{name:"checkout",label:"Validado",field:o=>o.checkout,align:"center",sortable:!0},{name:"diferencia",label:"Diferencia",field:o=>o.diferencia,align:"center",sortable:!0}]}),te=h(()=>T.value&&S.value.length),w=h(()=>n.value.body.filter(o=>o.validate==0)),_=h(()=>n.value.body.filter(o=>o.validate==1)),Q=h(()=>{var o;return(o=n.value.body)==null?void 0:o.filter(l=>l.diferencia!=0)}),O=h(()=>_.value.length>0&&Q.value.length==0&&w.value.length==0),X=h(()=>_.value.length>0&&Q.value.length>0&&w.value.length==0),ae=async()=>{m.loading.show({message:"Se esta obteniendo el ticket"});let o={serie:T.value,folio:S.value},a=`http://${U.session.store.ip_address}/access/public/modify/getTck`;ee.post(a,o).then(i=>{console.log(i.data),n.value.head=i.data.ticket,n.value.body=i.data.product,n.value.state=!0,m.loading.hide()}).catch(i=>{console.log(i.response.data),m.notify({html:!0,message:i.response.data,color:"negative",position:"center"}),m.loading.hide()})},oe=()=>{let o=u.value.val,l=n.value.body.findIndex(a=>a.codigo==o.codigo);l>=0?(n.value.body[l].checkout=o.conteo*o.pxc,n.value.body[l].validate=1,n.value.body[l].diferencia=o.checkout-o.cantidad,n.value.body[l].diferencia!=0?(console.log("Hay diferencia se bloquea productos sin revisar para que se analice el producto revisado ?"),m.notify({message:"El producto esta mal contado",type:"negative",icon:"sentiment_dissatisfied",position:"top"})):m.notify({message:"El producto esta bien contado",type:"positive",icon:"mood",position:"top"}),u.value.val=null,u.value.state=!1):m.notify({message:"No se encuentra el articulo"})},Y=(o,l)=>{console.log(l),u.value.state=!0,u.value.val=l},se=()=>{console.log("conteo terminado"),T.value=null,C.value="",S.value="",n.value={state:!1,body:[],head:null},u.value={state:!1,val:null}},ne=()=>{console.log("Terminado Incompleto"),M.value.state=!0},ie=()=>{Q.value.forEach(o=>{let l=n.value.body.findIndex(a=>a.codigo==o.codigo);l>=0&&(n.value.body[l].checkout=0,n.value.body[l].diferencia=0,n.value.body[l].conteo=0,n.value.body[l].validate=0)})},de=(o,l,a)=>{l(()=>{const i=o.toUpperCase();R.value=n.value.body.filter(D=>{const ve=D.variants.some(pe=>pe.cb.toUpperCase().indexOf(i)>-1),me=D.codigo.toUpperCase().indexOf(i)>-1||D.cb.toUpperCase().indexOf(i)>-1||D.corto.toUpperCase().indexOf(i)>-1;return ve||me}),console.log(R.value)})},ue=()=>{let o=n.value.body.filter(l=>l==C.value);u.value.state=!0,u.value.val=o[0],C.value=""},re=o=>{C.value=o,console.log(C.value)},z=async()=>{let o=U.session.store.id;try{let l=await Ue.get(`/cashier/getPrinters/${o}`);l.status==200&&(c.value.body=l.data,console.log("Impresoras listas :)"))}catch(l){console.log(l),m.notify({message:"No se pudiron obtener las impresoras",type:"negative",position:"center",icon:"error"})}},ce=async()=>{m.loading.show({message:"Imprimiendo Diferencias"});let o={printer:c.value.val.ip_address,data:n.value,invalid:w.value,valid:_.value,diff:Q.value},a=`http://${U.session.store.ip_address}/access/public/modify/PrintDiff`;ee.post(a,o).then(i=>{console.log(i.data),i.data==1&&(m.notify({message:"Impresion Correcta",type:"positive",position:"center"}),c.value.state=!1,c.value.val=null),m.loading.hide()}).catch(i=>{console.log(i.response.data),m.notify({html:!0,message:i.response.data,color:"negative",position:"center"}),m.loading.hide()})};return z(),z(),(o,l)=>(f(),j(Pe,{view:"hHh Lpr fFf"},{default:t(()=>[e(xe,{class:"transparent text-dark",bordered:""},{default:t(()=>[e(Ie),e(p)]),_:1}),e(Te,null,{default:t(()=>[e(Qe,{class:"",padding:""},{default:t(()=>[e(_e,{class:"justify-between"},{default:t(()=>[s("div",null,[l[16]||(l[16]=v("Helpers ")),e(J,{name:"navigate_next",color:"primary"}),l[17]||(l[17]=v()),l[18]||(l[18]=s("span",{class:"text-h6"},"TICKETS",-1))]),e(b,{color:"primary",icon:"add"},{default:t(()=>[e(ke,null,{default:t(()=>[l[19]||(l[19]=s("div",{class:"q-pa-md text-primary"},"Buscar Folio",-1)),e(p),e(A,{dense:"",onSubmit:ae,class:"q-gutter-md q-pa-md"},{default:t(()=>[e($,{modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=a=>T.value=a),options:K(le),label:"Serie",autofocus:""},null,8,["modelValue","options"]),e(H,{modelValue:S.value,"onUpdate:modelValue":l[1]||(l[1]=a=>S.value=a),type:"number",label:"Folio"},null,8,["modelValue"]),te.value?(f(),x("div",De,[e(b,{type:"submit",color:"primary",icon:"search"})])):N("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n.value.state?(f(),x("div",Ne,[s("div",null,[e(be,{name:"bounce"},{default:t(()=>[e(g,null,{default:t(()=>[e(d,null,{default:t(()=>[e(Ve,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(E,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[20]||(l[20]=[v("Fecha:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.fecha),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(E,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[21]||(l[21]=[v("Ticket:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.ticket),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(E,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[22]||(l[22]=[v("Cliente:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.cliente),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(E,null,{default:t(()=>[e(V,{caption:"",class:"text-center"},{default:t(()=>l[23]||(l[23]=[v("Total:")])),_:1}),e(V,{class:"text-bold text-center"},{default:t(()=>[v(r(n.value.head.total),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),e(p,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Be,[e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[24]||(l[24]=[s("div",{class:"text-center"},"X Validar",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(w.value.length),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[25]||(l[25]=[s("div",{class:"text-center"},"Validados",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(_.value.length),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[26]||(l[26]=[s("div",{class:"text-center"},"Dif",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(n.value.body.reduce((a,i)=>a+Number(i.diferencia),0)),1)]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{class:"my-card col"},{default:t(()=>[e(d,null,{default:t(()=>l[27]||(l[27]=[s("div",{class:"text-center"},"Cajas",-1)])),_:1}),e(d,{class:"text-center text-h4"},{default:t(()=>[v(r(n.value.body.reduce((a,i)=>a+Number(i.conteo),0)),1)]),_:1})]),_:1})]),e(p,{spaced:"",inset:"",vertical:"",dark:""}),s("div",Fe,[e(g,{class:"my-card"},{default:t(()=>[e(P,null,{default:t(()=>[l[28]||(l[28]=s("div",null," Productos Revisados",-1)),e(p,{spaced:"",inset:"",vertical:"",dark:""}),s("div",$e,r(_.value.length),1),e(W),e(b,{color:"grey",round:"",flat:"",dense:"",icon:q.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:l[2]||(l[2]=a=>q.value=!q.value)},null,8,["icon"])]),_:1}),e(we,null,{default:t(()=>[G(s("div",null,[e(p),e(d,{class:"text-subtitle2"},{default:t(()=>[e(d,null,{default:t(()=>[e(Z,{flat:"",rows:_.value,columns:k.value.columns,"visible-columns":k.value.visibleColumnstwo,"no-data-label":"No hay datos :(",pagination:k.value.pagination,onRowClick:Y,"hide-bottom":""},null,8,["rows","columns","visible-columns","pagination"])]),_:1})]),_:1})],512),[[ge,q.value]])]),_:1})]),_:1}),e(g,{class:"my-card"},{default:t(()=>[e(d,null,{default:t(()=>[e(Z,{flat:"",title:"Productos Sin Revisar",rows:w.value,columns:k.value.columns,"visible-columns":k.value.visibleColumns,"no-data-label":"No hay datos :(",pagination:k.value.pagination,onRowClick:Y,"hide-bottom":""},{top:t(()=>[l[29]||(l[29]=s("div",null," Productos Sin Revisar",-1)),e(W),e($,{modelValue:k.value.visibleColumns,"onUpdate:modelValue":l[3]||(l[3]=a=>k.value.visibleColumns=a),multiple:"",outlined:"",dense:"","options-dense":"","display-value":K(m).lang.table.columns,"emit-value":"","map-options":"",options:k.value.columns,"option-value":"name","options-cover":"",style:{"min-width":"150px"}},null,8,["modelValue","display-value","options"])]),_:1},8,["rows","columns","visible-columns","pagination"])]),_:1})]),_:1}),e(p,{spaced:"",inset:"",vertical:"",dark:""})])])):N("",!0),e(I,{modelValue:u.value.state,"onUpdate:modelValue":l[6]||(l[6]=a=>u.value.state=a),persistent:"",position:"bottom"},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"bg-grey-3"},{default:t(()=>[s("div",Ee,[s("div",Me,[s("div",Re,"CCO: "+r(u.value.val.corto),1),s("div",je,r(u.value.val.codigo),1)]),s("div",He,[l[30]||(l[30]=s("div",{class:"text-bold"},"CAJAS",-1)),s("div",Le,r(Math.round(u.value.val.cantidad/u.value.val.pxc)),1)])])]),_:1}),e(p),e(d,null,{default:t(()=>[v(r(u.value.val.descripcion),1)]),_:1}),e(A,{onSubmit:ye(oe,["prevent"])},{default:t(()=>[e(d,null,{default:t(()=>[s("div",Ae,[s("div",Oe,[l[31]||(l[31]=s("div",null,"Cajas",-1)),e(H,{dense:"",borderless:"",modelValue:u.value.val.conteo,"onUpdate:modelValue":l[4]||(l[4]=a=>u.value.val.conteo=a),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter",autofocus:""},null,8,["modelValue"])]),s("div",Xe,[l[32]||(l[32]=s("div",null,"PXC",-1)),e(H,{dense:"",borderless:"",modelValue:u.value.val.pxc,"onUpdate:modelValue":l[5]||(l[5]=a=>u.value.val.pxc=a),type:"number",min:"0","input-class":"text-h6 text-center",ref:"iptcounter"},null,8,["modelValue"])]),s("div",Ye,[l[33]||(l[33]=s("div",null,"Conteo",-1)),s("div",ze,r(u.value.val.conteo*u.value.val.pxc),1)])])]),_:1}),e(b,{color:"green-5",type:"submit",square:"",icon:"done_all","no-caps":"",class:"q-mt-md q-py-md full-width"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:O.value,"onUpdate:modelValue":l[8]||(l[8]=a=>O.value=a),persistent:""},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"row items-center"},{default:t(()=>[e(L,{icon:"mood",color:"positive","text-color":"white"}),l[34]||(l[34]=s("span",{class:"q-ml-sm"},"Productos validados correctamente",-1))]),_:1}),e(d,{class:"row"},{default:t(()=>[e(P,{class:"col"},{default:t(()=>[e(b,{flat:"",icon:"print",color:"primary",onClick:l[7]||(l[7]=a=>c.value.state=!c.value.state)})]),_:1}),e(P,null,{default:t(()=>[e(b,{flat:"",label:"TERMINAR",color:"positive",onClick:se})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:X.value,"onUpdate:modelValue":l[10]||(l[10]=a=>X.value=a),persistent:""},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"row items-center"},{default:t(()=>[e(L,{icon:"sentiment_dissatisfied",color:"negative","text-color":"white"}),l[35]||(l[35]=s("span",{class:"q-ml-sm"},"Hay productos Con diferencia",-1))]),_:1}),e(d,null,{default:t(()=>[(f(!0),x(F,null,B(Q.value,(a,i)=>(f(),x("div",null,r(a.codigo),1))),256))]),_:1}),e(d,{class:"row"},{default:t(()=>[e(P,{class:"col"},{default:t(()=>[e(b,{flat:"",icon:"print",color:"primary",onClick:l[9]||(l[9]=a=>c.value.state=!c.value.state)})]),_:1}),e(P,null,{default:t(()=>[e(b,{flat:"",label:"Regresar",color:"negative",onClick:ie})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:c.value.state,"onUpdate:modelValue":l[12]||(l[12]=a=>c.value.state=a)},{default:t(()=>[e(g,{class:"my-card"},{default:t(()=>[e(d,null,{default:t(()=>l[36]||(l[36]=[s("div",{class:"text-h6 text-center"},"Impresora",-1)])),_:1}),e(d,null,{default:t(()=>[e(A,{onSubmit:ce,class:"q-gutter-md"},{default:t(()=>[e($,{dense:"","option-label":"name",modelValue:c.value.val,"onUpdate:modelValue":l[11]||(l[11]=a=>c.value.val=a),options:c.value.body,label:"Impresora",filled:"",autofocus:"",style:{width:"200px"}},null,8,["modelValue","options"]),s("div",null,[e(b,{label:"Enviar",type:"submit",color:"primary",style:{width:"200px"}})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:M.value.state,"onUpdate:modelValue":l[14]||(l[14]=a=>M.value.state=a),persistent:""},{default:t(()=>[e(g,null,{default:t(()=>[e(d,{class:"row items-center"},{default:t(()=>[e(L,{icon:"warning",color:"warning","text-color":"black"}),l[37]||(l[37]=s("span",{class:"q-ml-sm"},"Hay Productos que no estan validados",-1))]),_:1}),e(d,null,{default:t(()=>[l[38]||(l[38]=s("div",{class:"text-bold"}," Productos No Validados ",-1)),(f(!0),x(F,null,B(w.value,(a,i)=>(f(),x("div",{key:i},r(a.codigo),1))),128))]),_:1}),e(d,null,{default:t(()=>[l[39]||(l[39]=s("div",{class:"text-bold"}," Productos Con Diferencia ",-1)),(f(!0),x(F,null,B(Q.value,(a,i)=>(f(),x("div",{key:i},r(a.codigo),1))),128))]),_:1}),e(d,null,{default:t(()=>[l[40]||(l[40]=s("div",{class:"text-bold"}," Productos Validados ",-1)),(f(!0),x(F,null,B(_.value,(a,i)=>(f(),x("div",{key:i},r(a.codigo),1))),128))]),_:1}),e(P,{align:"right"},{default:t(()=>[e(b,{flat:"",color:"primary",icon:"print",onClick:l[13]||(l[13]=a=>c.value.state=!c.value.state)}),G(e(b,{flat:"",label:"Continuar",color:"primary"},null,512),[[Se]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),n.value.state?(f(),j(he,{key:0,reveal:"",elevated:"",bordered:"",class:"row"},{default:t(()=>[e($,{class:"col",modelValue:C.value,"onUpdate:modelValue":[l[15]||(l[15]=a=>C.value=a),ue],options:R.value,filled:"","option-label":"codigo","use-input":"","fill-input":"","hide-selected":"","input-class":"text-white","input-debounce":"0",onFilter:de,onInputValue:re,dense:""},{before:t(()=>[e(J,{name:"fas fa-barcode",color:"white"})]),_:1},8,["modelValue","options"]),_.value.length>0?(f(),j(b,{key:0,color:"white","text-color":"primary",size:"sm",label:"Terminar",onClick:ne})):N("",!0)]),_:1})):N("",!0)]),_:1})]),_:1}))}};export{xl as default};
