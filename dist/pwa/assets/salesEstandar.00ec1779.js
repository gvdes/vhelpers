import{Q as Le}from"./QToolbarTitle.c3376430.js";import{Q as z,a as se,d as ae}from"./QSelect.a3b3557c.js";import{Q as Te}from"./QToggle.9308d30b.js";import{d as M,e as G,b as Q,a as oe,Q as W}from"./QList.33a7424a.js";import{Q as N}from"./QCardSection.2252dd33.js";import{Q as q}from"./QCard.7a43c7d1.js";import{b3 as Ue,u as ee,r as V,c as F,p as ie,o as y,g as U,d as D,w as o,e as t,Q as x,b4 as ne,ak as J,b5 as Be,f as i,a0 as k,a as be,aH as ye,a3 as Ie,a2 as qe,an as re,h as C,m as xe,aF as Oe,aG as Re,l as je,a1 as ce,a4 as ve,n as X}from"./index.746245ed.js";import{Q as T}from"./QInput.cbcb5303.js";import{Q as ze}from"./QToolbar.d7bddab9.js";import{Q as Y}from"./QTable.d2450898.js";import{Q as H}from"./QCardActions.e3b9f597.js";import{Q as pe}from"./QForm.95d03695.js";import{Q as Me}from"./QFooter.23588629.js";import{Q as Ke}from"./QPage.c8fdd22e.js";import{C as me}from"./ClosePopup.6458ef0b.js";import{u as Ge,c as fe}from"./cashApi.0dd41182.js";import"./QDrawer.d32ae152.js";import{b as Je}from"./axios.3afb04d7.js";import{u as te}from"./use-quasar.5806cb54.js";import{p as ge}from"./productsApi.cbf6e942.js";import{Q as Ze}from"./QSpace.bc1445f9.js";import{R}from"./resoursesOrder.be951328.js";import{Q as We}from"./QCheckbox.1c9e3e81.js";import{o as Xe}from"./orderApi.7cb8413f.js";import{s as Ye}from"./saleLocalApi.563cf48e.js";import"./QLinearProgress.d34ebc7d.js";import"./QResizeObserver.e21a6d74.js";import"./QScrollObserver.fd117df1.js";const He={class:"QuickRegular row items-center"},et={class:"row items-center justify-between no-wrap QuickRegular"},tt={class:"col"},lt={class:"text-grey-4 q-pl-md"},at={class:"text--2 text-grey-5"},ot={__name:"ProductAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]}},emits:["input","similarcodes","agregar"],setup(b,{expose:B,emit:p}){const d=te(),A=ee(),h=b,S=p,e=V({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),m=V(null),_=F(()=>({autocomplete:e.value.target,limit:h.limit,_workpoint:A.session.store.id_viz,strict:e.value.read_barcode}));F(()=>s=>h.checkState?h.blockStates.some(n=>n==s.state.id):!1),ie(()=>{e.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let s=JSON.parse(localStorage.getItem("typeiptsearch"));s&&(e.value.iptsearch.type=s.type,e.value.iptsearch.icon=s.icon)});const g=()=>{e.value.read_barcode=!e.value.read_barcode,e.value.target="",localStorage.setItem("barcodereader",e.value.read_barcode)},r=(s,n,v)=>{console.log(_.value),s.trim().length>1&&(e.value.target=s.toUpperCase().trim(),console.log(e.value.target),ge.autocomplete(_.value).then(P=>{console.log(P);let j=P.data.map(L=>{if(h.checkState)if(h.wkpToVal){let K=L.stocks.find(Z=>Z._workpoint==h.wkpToVal);L.stateToVal=K?{own:K,state:K.status}:{own:null,state:L.status}}else L.stateToVal={own:!0,state:L.status};else L.stateToVal={own:!0,state:L.status};return L});n(()=>{e.value.options=j},L=>{L.setOptionIndex(-1),L.moveOptionSelection(1,!0)})}).catch(P=>{console.log(P)}))},O=()=>{switch(e.value.iptsearch.type){case"text":e.value.iptsearch.type="number",e.value.iptsearch.icon="fas fa-font";break;case"number":e.value.iptsearch.type="text",e.value.iptsearch.icon="fas fa-hashtag";break}localStorage.setItem("typeiptsearch",JSON.stringify(e.value.iptsearch))},$=s=>{e.value.target="",S("input",s)},f=()=>{e.value.target.trim().toUpperCase(),e.value.target.length&&(e.value.iptsearch.processing=!0,console.log(_.value),ge.autocomplete(_.value).then(s=>{let n=s.data;switch(Object.keys(n).length){case 0:let v=e.value.target;d.notify({message:`Sin resultados para <b>${v}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),c();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(n),$(n);break}e.value.target="",e.value.iptsearch.processing=!1}).catch(s=>{console.log(s)}))},c=()=>{console.log("putFocus ejecutada!!"),m.value.focus()};B({focus:()=>{var s,n;return(n=(s=m.value)==null?void 0:s.focus)==null?void 0:n.call(s)}});const w=s=>{S("agregar",s)};return(s,n)=>(y(),U("div",He,[e.value.read_barcode?(y(),D(T,{key:0,ref_key:"iptatc",ref:m,loading:e.value.iptsearch.processing,disable:e.value.iptsearch.processing,modelValue:e.value.target,"onUpdate:modelValue":n[1]||(n[1]=v=>e.value.target=v),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:ne(f,["enter"]),autocomplete:"off",autofocus:""},{prepend:o(()=>[t(x,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:n[0]||(n[0]=v=>g())},null,8,["color","icon"])]),_:1},8,["loading","disable","modelValue"])):(y(),D(z,{key:1,dense:"",filled:"",color:"blue-13",class:"text-uppercase col",ref_key:"iptatc",ref:m,"use-input":"","hide-dropdown-icon":"","option-value":"id","option-label":"id","hide-selected":"",behavior:"menu",modelValue:e.value.target,"onUpdate:modelValue":n[3]||(n[3]=v=>e.value.target=v),"input-debounce":400,autofocus:"",options:e.value.options,type:e.value.iptsearch.type,onFilter:r,"popup-content-class":"bg-darkl1"},{"no-option":o(()=>[t(M,null,{default:o(()=>[t(G,{class:"text-grey QuickRegular"},{default:o(()=>n[4]||(n[4]=[J("Nada por aqui...")])),_:1})]),_:1})]),prepend:o(()=>[t(x,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:n[2]||(n[2]=v=>g())},null,8,["color","icon"]),t(x,{type:"button",dense:"",size:"sm",flat:"",onClick:O,icon:e.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:o(v=>[t(M,Be(v.itemProps,{onClick:P=>w(v.opt)}),{default:o(()=>[t(G,null,{default:o(()=>[i("div",et,[i("div",tt,[i("div",null,[J(k(v.opt.code)+" ",1),i("span",lt,k(v.opt.name),1)]),i("div",at,k(v.opt.description),1)])])]),_:2},1024)]),_:2},1040,["onClick"])]),_:1},8,["modelValue","options","type"]))]))}};var st=Ue(ot,[["__scopeId","data-v-35342126"]]);const it={class:"row"},nt={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},ut={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},dt={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},rt={class:"row"},ct={class:"text-h6 col text-bold text-left"},vt={class:"text-h6 col text-bold text-right"},pt={class:"text-subtitle2 col"},mt={class:"text-center"},ft={class:"q-pa-xs"},gt={class:"row items-center justify-center q-gutter-md"},bt={__name:"viewProduct",props:{product:{type:Object,default:{}},_price_list:{type:Number,default:1},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]}},emits:["reset","addProduct","deleteProduct","editProduct"],setup(b,{emit:B}){ee();const p=te();be(),ye();const d=b,A=B,h=F(()=>!d.product.pivot.amountDelivered||d.product.pivot.amountDelivered<=0),S=F(()=>d.product.pivot.amountDelivered),e=F(()=>d._price_list<=3?[1,2,3,4]:[d._price_list]),m=F(()=>d._price_list<=3?R.verificarPrecioCaja(d.products,d.product,d.rules)?4:R.verificarPrecioDocena(d.products,d.product,d.rules)?3:R.verificarPrecioMayoreo(d.products,d.product,d.rules)?2:1:d._price_list),_=()=>{A("reset")},g=async()=>{p.loading.show({message:"Editando Producto"});let $=d.product.prices.find(c=>c.id==m.value).pivot.price,f=S.value*$;d.product.pivot.toDelivered=S.value,d.product.pivot._price_list=m.value,d.product.pivot.price=$,d.product.pivot.total=f,p.loading.hide(),_(),R.actualizarPreciosProductosSales(d.products,d._price_list,d.rules),A("editProduct")},r=async()=>{(!d.product.pivot.amountDelivered||d.product.pivot.amountDelivered<1)&&(d.product.pivot.amountDelivered=1),p.loading.show({message:"Agregando producto"});let $=d.product.prices.find(c=>c.id==m.value).pivot.price,f=S.value*$;d.product.pivot.toDelivered=S.value,d.product.pivot._price_list=m.value,d.product.pivot.price=$,d.product.pivot.total=f,d.product.pivot._product=d.product.id,console.log(d.product),A("addProduct",d.product),p.loading.hide(),R.actualizarPreciosProductosSales(d.products,d._price_list,d.rules)},O=async()=>{p.loading.show({message:"Eliminando Producto"}),A("deleteProduct",d.product),p.loading.hide(),R.actualizarPreciosProductosSales(d.products,d._price_list,d.rules)};return($,f)=>(y(),D(q,null,{default:o(()=>[t(N,{class:"item-center"},{default:o(()=>[i("div",it,[i("div",nt,k(b.product.category.familia.seccion.name),1),i("div",ut,k(b.product.category.familia.name),1),i("div",dt,k(b.product.category.name),1)])]),_:1}),t(N,{class:"item-center"},{default:o(()=>[i("div",rt,[i("div",ct,k(b.product.code),1),i("div",vt,k(b.product.name),1)]),i("div",pt,k(b.product.description),1)]),_:1}),t(N,{class:"item-center row"},{default:o(()=>[(y(!0),U(Ie,null,qe(b.product.prices.filter(c=>e.value.includes(c.id)),(c,w)=>(y(),U("div",{class:"col text-subtitle2 text-center",key:w},[i("div",{class:re(c.id==m.value?"text-weight-bold":"text-caption text-strike")},k(c.alias),3),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),i("div",{class:re(c.id==m.value?"text-bold  text-blue-13":"text-caption")},k(c.pivot.price),3),t(Q,{spaced:"",inset:"",vertical:"",dark:""})]))),128))]),_:1}),t(N,null,{default:o(()=>[i("div",mt,[i("div",ft,[f[6]||(f[6]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",gt,[t(x,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:f[0]||(f[0]=c=>b.product.pivot.amountDelivered>1?b.product.pivot.amountDelivered--:"")}),t(T,{modelValue:b.product.pivot.amountDelivered,"onUpdate:modelValue":[f[1]||(f[1]=c=>b.product.pivot.amountDelivered=c),f[4]||(f[4]=c=>{c?c<1?b.product.pivot.amountDelivered=1:Number.isInteger(c)||(b.product.pivot.amountDelivered=Math.floor(c)):b.product.pivot.amountDelivered=1})],modelModifiers:{number:!0},type:"number",outlined:"",min:"1",step:"1","input-class":"text-center text-h3",style:{width:"100px"},autofocus:"",onKeydown:f[2]||(f[2]=ne(c=>b.edit?g():r(),["enter"])),onKeypress:f[3]||(f[3]=c=>(c.key==="."||c.key==="-")&&c.preventDefault())},null,8,["modelValue"]),t(x,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:f[5]||(f[5]=c=>b.product.pivot.amountDelivered++)})])])])]),_:1}),t(H,null,{default:o(()=>[t(x,{flat:"",icon:"close",onClick:_}),t(Ze),b.edit?C("",!0):(y(),D(x,{key:0,flat:"",icon:"add",color:"positive",onClick:r,disable:h.value},null,8,["disable"])),b.edit?(y(),D(x,{key:1,flat:"",icon:"delete",color:"negative",onClick:O})):C("",!0),b.edit?(y(),D(x,{key:2,flat:"",icon:"edit",color:"warning",onClick:g,disable:h.value},null,8,["disable"])):C("",!0)]),_:1})]),_:1}))}},yt={class:"bg-primary row items-center justify-between q-pa-md text-white"},xt={class:"text-right"},_t={class:"fw-bold text-h4"},ht={class:"row text-center items-center"},kt={class:"col"},wt={class:"row text-center items-center"},Pt={class:"col"},Vt={class:"col"},Ct={class:"row flex justify-center"},At={class:"col flex justify-center"},Dt={key:0,class:"col"},Nt={key:0,class:"row flex justify-center text-center"},St={class:"col"},Ft={class:"col"},$t={class:"row flex justify-center"},Et={class:"col flex justify-center"},Qt={key:0,class:"col"},Lt={class:"row"},Tt={class:"text-h5"},Ut={key:0,class:"text-center"},Bt={__name:"PaymentSales",props:{total:{type:Number,default:0},paymeths:{type:Array,default:[]},client:{type:Number,default:0}},emits:["sendTicket"],setup(b,{emit:B}){ee();const p=te(),d=V({dafpa:!1,vales:!1}),A=b,h=B,S=V({opts:[]}),e=V({PFPA:{id:A.paymeths[1],val:Math.round(A.total)},SFPA:{id:null,val:0},VALE:{id:null,val:0},conditions:{createWithdrawal:!1,super:null}}),m=F(()=>(Number(Number.parseFloat(e.value.SFPA.val)+Number.parseFloat(e.value.PFPA.val))+Number.parseFloat(e.value.VALE.val)-Number.parseFloat(A.total)).toFixed(2)),_=F(()=>{var w,s,n;return m.value>=0&&(((w=e.value.PFPA.id)==null?void 0:w.id)&&e.value.PFPA.val>0||((s=e.value.SFPA.id)==null?void 0:s.id)&&e.value.SFPA.val>0||((n=e.value.VALE.id)==null?void 0:n.id)&&e.value.VALE.val>0)}),g=F(()=>{const w=Object.values(e.value);if(w.some(P=>P.id&&P.id.alias==="EFE"&&P.val>0))return!1;const n=w.some(P=>P.id&&P.id.alias!=="EFE"),v=w.reduce((P,j)=>P+Number(j.val||0),0);return n&&v>A.total}),r=w=>{var s;return w.id==((s=e.value.SFPA.id)==null?void 0:s.id)},O=w=>{var s;return w.id==((s=e.value.PFPA.id)==null?void 0:s.id)},$=async()=>{p.loading.show({message:"Buscando Vales"}),console.log("Buscando vales");let s=`http://192.168.10.160:1619/access/public/modify/vales?price=${A.client}`;Je.get(s).then(n=>{console.log(n.data),p.loading.hide();let v=n.data.map(P=>({id:{id:5,alias:"[V]",name:"VALE",code:P.CODANT},val:Number(P.IMPANT)}));S.value.opts=v,d.value.vales=!0}).catch(n=>{console.log(n.response.data),p.notify({html:!0,message:n.response.data,color:"negative",position:"bottom"}),p.loading.hide()})},f=w=>{w.key==="Enter"&&_.value&&(w.preventDefault(),c())},c=()=>{e.value.conditions.super=g.value,e.value.change=m.value,h("sendTicket",e.value),S.value=V({opts:[]}),e.value={PFPA:{id:null,val:0},SFPA:{id:null,val:0},VALE:{id:null,val:0}}};return ie(()=>{window.addEventListener("keydown",f)}),xe(()=>{window.removeEventListener("keydown",f)}),(w,s)=>(y(),D(q,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:o(()=>[i("div",yt,[s[11]||(s[11]=i("div",null,[i("div",{class:"text-bold text-h4"},"Cobro Documento")],-1)),i("div",xt,[s[10]||(s[10]=i("div",{class:"fs-dec3"},"Total Actual",-1)),i("div",_t,"$ "+k(Number(b.total).toFixed(2)),1)])]),t(N,null,{default:o(()=>{var n;return[i("div",ht,[s[12]||(s[12]=i("div",{class:"col"}," Forma de pago: ",-1)),i("div",kt,[t(z,{class:"col-3",modelValue:e.value.PFPA.id,"onUpdate:modelValue":s[0]||(s[0]=v=>e.value.PFPA.id=v),options:b.paymeths,"option-value":"id","option-label":"name",dense:"",filled:"",label:"Forma de pago","option-disable":v=>r(v)},null,8,["modelValue","options","option-disable"])])]),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),i("div",wt,[i("div",Pt,k(((n=e.value.PFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),i("div",Vt,[t(T,{class:"col",modelValue:e.value.PFPA.val,"onUpdate:modelValue":s[2]||(s[2]=v=>e.value.PFPA.val=v),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:o(()=>[parseFloat(e.value.PFPA.val)?(y(),D(x,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:s[1]||(s[1]=v=>e.value.PFPA.val=0)})):C("",!0)]),_:1},8,["modelValue"])])])]}),_:1}),t(N,null,{default:o(()=>{var n;return[i("div",Ct,[i("div",At,[t(x,{color:"primary",label:"2\xAA Forma de pago",onClick:s[3]||(s[3]=()=>{d.value.dafpa=!d.value.dafpa,e.value.SFPA.val=0,e.value.SFPA.id=null}),outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),d.value.dafpa?(y(),U("div",Dt,[t(z,{class:"col-3",modelValue:e.value.SFPA.id,"onUpdate:modelValue":s[4]||(s[4]=v=>e.value.SFPA.id=v),options:b.paymeths,label:"Forma Pago","option-value":"id","option-label":"name",dense:"",filled:"","option-disable":v=>O(v)},null,8,["modelValue","options","option-disable"])])):C("",!0)]),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),d.value.dafpa?(y(),U("div",Nt,[i("div",St,k(((n=e.value.SFPA.id)==null?void 0:n.id)==2?"Efectivo":"Importe Cobrado"),1),i("div",Ft,[t(T,{class:"col",modelValue:e.value.SFPA.val,"onUpdate:modelValue":s[6]||(s[6]=v=>e.value.SFPA.val=v),type:"number",autofocus:"",min:0,step:"any",dense:"","input-class":"q-pl-md fw-sbold fs-inc4 text-center",filled:""},{after:o(()=>[parseFloat(e.value.SFPA.val)?(y(),D(x,{key:0,color:"primary",icon:"backspace",flat:"",dense:"",round:"",onClick:s[5]||(s[5]=v=>e.value.SFPA.val=0)})):C("",!0)]),_:1},8,["modelValue"])])])):C("",!0)]}),_:1}),t(N,null,{default:o(()=>[i("div",$t,[i("div",Et,[t(x,{color:"primary",label:"Cobrar Vale",onClick:$,outline:"",rounded:"",dense:"",size:"md",style:{width:"70%"}})]),d.value.vales?(y(),U("div",Qt,[i("div",Lt,[t(z,{class:"col",modelValue:e.value.VALE,"onUpdate:modelValue":s[7]||(s[7]=n=>e.value.VALE=n),options:S.value.opts,label:"Vale","option-label":n=>`Vale : ${n.id?n.id.code:""}`,dense:"",filled:""},{option:o(n=>[t(M,Oe(Re(n.itemProps)),{default:o(()=>[t(G,null,{default:o(()=>[t(se,null,{default:o(()=>[J(k(n.opt.id.code),1)]),_:2},1024),t(se,{caption:""},{default:o(()=>[J("$ "+k(Number(n.opt.val).toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label"]),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),e.value.VALE.id?(y(),D(T,{key:0,modelValue:e.value.VALE.val,"onUpdate:modelValue":s[8]||(s[8]=n=>e.value.VALE.val=n),type:"Number",label:"Monto",disable:"",filled:"",dense:""},null,8,["modelValue"])):C("",!0)])])):C("",!0)])]),_:1}),g.value?(y(),D(N,{key:0,class:"flex justify-end"},{default:o(()=>[t(We,{modelValue:e.value.conditions.createWithdrawal,"onUpdate:modelValue":s[9]||(s[9]=n=>e.value.conditions.createWithdrawal=n),label:"Crear Retirada por la diferencia"},null,8,["modelValue"])]),_:1})):C("",!0),t(H,{class:"bg-deep-purple-3 row items-center justify-between q-pa-md text-black"},{default:o(()=>[i("div",null,[s[13]||(s[13]=i("div",{class:"fs-dec3"},"Cambio",-1)),i("div",Tt," $ "+k(m.value),1)]),_.value?(y(),U("div",Ut,[t(x,{color:"primary",icon:"payment",label:"Pagar",onClick:c})])):C("",!0)]),_:1})]),_:1}))}},It={class:"row items-center justify-between"},qt={class:"col"},Ot={class:"col"},Rt={class:"col"},jt={class:"text-caption text-center"},zt={class:"text-center text-h6"},Mt={key:0,class:"col"},Kt={class:"text-center text-h6 text-caption"},Gt={key:1,class:"col"},Jt={class:"text-center text-h6"},Zt={class:"col"},Wt={class:"text-center text-h6"},Xt={class:"row q-ml-sm q-mr-sm"},Yt={key:0,class:"col"},Ht={class:"col"},Dl={__name:"salesEstandar",setup(b){const B=ee(),p=te();be(),ye();const d=Ge();V(null);const A=V(null),h=V({val:{id:1,label:"Preventa",type:"number"},opts:[{id:1,label:"Preventa",type:"number"}],valueVal:null}),S=V({amount:0,amountDelivered:1,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1}),e=V({name:"IVA",option:!1,optval:[16,8,6],value:0,amount:0}),m=V({val:null,opts:[]}),_=V({val:null,opts:[]}),g=V({state:!1,val:null,edit:!1}),r=V({client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:B.session.credentials.staff,products:[],observation:null}),O=F(()=>(r.value.products||[]).filter(l=>l.pivot.toDelivered>0)),$=F(()=>(r.value.products||[]).filter(l=>!l.pivot.toDelivered)),f=V(!1),c=V({columns:[{name:"code",label:"Codigo",field:l=>l.code,align:"left"},{name:"description",label:"Descripcion",field:l=>l.description,align:"left"},{name:"verify",label:"Cantidad",field:l=>l.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:l=>l.pivot.price,align:"center"},{name:"bruto",label:e.option?"Bruto":"Total",field:l=>l.pivot.total,align:"center"},{name:"iva",label:"Total",field:l=>l.pivot.total,align:"center"},{name:"neto",label:"Total",field:l=>l.pivot.total,align:"center"}],pagination:{rowsPerPage:0},filter:null}),w=V({columns:[{name:"id",label:"Codigo",field:l=>l.id,align:"left"},{name:"Nombre",label:"Descripcion",field:l=>l.name,align:"left"},{name:"Telefono",label:"Pedido",field:l=>l.celphone,align:"center"}],pagination:{rowsPerPage:0}}),s=V({columns:[{name:"id",label:"Codigo",field:l=>l.id,align:"left"},{name:"Nombre",label:"Descripcion",field:l=>l.complete_name,align:"left"}],pagination:{rowsPerPage:0}}),n=F(()=>Number(r.value.products.reduce((l,a)=>l+a.pivot.total,0)).toFixed(2)),v=F(()=>r.value.products.reduce((l,a)=>l+Number(a.pivot.toDelivered),0)),P=F(()=>r.value.products.length>0&&r.value.dependiente&&r.value.client),j=F(()=>[{name:"code",label:"Codigo",field:a=>a.code,align:"left"},{name:"description",label:"Descripcion",field:a=>a.description,align:"left"},,{name:"verify",label:"Verificado",field:a=>a.pivot.toDelivered,align:"center"},{name:"price",label:"Precio",field:a=>a.pivot.price,align:"center"},{name:"bruto",label:e.value.option?"Subtotal":"Total",field:a=>a.pivot.total,format:a=>`$ ${a.toFixed(2)}`,align:"center"}]),L=l=>{if(console.log(l),l.prices.map(u=>u.pivot.price).includes(0))p.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let u=r.value.products.findIndex(E=>E.id==l.id);u>=0?(g.value.val=r.value.products[u],g.value.state=!0,g.value.edit=!0):(l.pivot=S.value,g.value.val=l,g.value.state=!0,g.value.edit=!1)}},K=l=>{if(console.log(l),l.prices.map(u=>u.pivot.price).includes(0))p.notify({message:"El producto no tiene precio :/",type:"negative",position:"center"});else{let u=r.value.products.findIndex(E=>E.id==l.id);u>=0?(g.value.val=r.value.products[u],g.value.state=!0,g.value.edit=!0):(l.pivot=S.value,g.value.val=l,g.value.state=!0,g.value.edit=!1)}},Z=(l,a)=>{console.log(a),g.value.val=a,g.value.edit=!0,g.value.state=!0},_e=()=>{console.log("cambio de cliente"),m.value.state=!0},he=async()=>{if(m.value.val){const l=await Xe.getClient(m.value);l.fail?console.log(l):l.length>0?(console.log(l),m.value.opts=l):p.notify({message:"No hay ningun cliente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(l)}else p.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},ke=async(l,a)=>{p.loading.show({message:"Recalculando Ticket"}),r.value.client=a,R.actualizarPreciosProductosSales(r.value.products,a._price_list,d.rules),m.value={state:!1,val:null,opts:[]},p.loading.hide()},we=()=>{console.log("cambio de cliente"),_.value.state=!0},Pe=async()=>{if(_.value.val){let l={val:_.value.val,sto:B.session.store.id};const a=await fe.getDependiente(l);a.fail?console.log(a):a.length>0?(console.log(a),_.value.opts=a):p.notify({message:"No hay ningun Dependiente con el parametro de busqueda intentalo de nuevo",type:"negative",position:"bottom"}),console.log(a)}else p.notify({message:"Coloca Numero, telefono o Nombre para hacer la busqueda",type:"negative",position:"bottom"})},Ve=(l,a)=>{r.value.dependiente=a,_.value={state:!1,val:null,opts:[]},p.loading.hide()},Ce=l=>{r.value.products.push(l),le(),X(()=>{var a;(a=A.value)==null||a.focus()})},Ae=()=>{X(()=>{var l;(l=A.value)==null||l.focus()})},De=l=>{let a=r.value.products.findIndex(u=>u.id==l.id);a>=0&&(r.value.products.splice(a,1),le()),X(()=>{var u;(u=A.value)==null||u.focus()})},Ne=async l=>{p.loading.show({message:"Realizando Ticket"}),r.value.payments=l,r.value.change=l.conditions.super?0:l.change,e.value.option?(r.value.subtotal=r.value.products.reduce((E,I)=>E+I.pivot.total,0),r.value.iva=e.value.value,r.value.total=Number(n.value*Number(1+e.value.value/100).toFixed(2)),r.value.impuesto=Number(n.value*Number(e.value.value/100)).toFixed(2)):r.value.total=r.value.products.reduce((E,I)=>E+I.pivot.total,0);let a={order:r.value,cashier:d.cash,config:e.value};console.log(a);const u=await Ye.addSale(a);if(console.log(u),u.fail)console.log(u);else{console.log(u),f.value=!1;let E={client:{id:0,name:"PUBLICO EN GENERAL",phone:"",email:"",rfc:"",address:'{"cp": 6300, "calle": "PLAZA DE LOS ANGELEES 5", "colonia": "Guerrero", "municipio": "Deleg. Cuauhtemoc CDMX"}',created_at:"2020-12-28T07:00:00.000000Z",updated_at:null,_price_list:1,store_name:null},dependiente:r.value.dependiente,products:[],observation:null};r.value=E,e.value.value=0,e.value.option=!1,p.loading.hide()}},le=()=>{g.value={state:!1,val:null,edit:!1},S.value={amount:0,amountDelivered:null,price:0,toDelivered:0,total:0,units:0,_price_list:1,_supply_by:1},X(()=>{var l;(l=A.value)==null||l.focus()})},Se=async()=>{switch(console.log(h.value),h.value.val.id){case 1:Fe(h.value);break}},Fe=async l=>{if(console.log(l),l){p.loading.show({message:"Obteniendo Orden"});let a={uid:B.session.credentials.staff.id_va,oid:l.valueVal};const u=await fe.getOrderCash(a);u.fail?u.fail.status==401?(console.log(u),p.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),l.value=null,p.loading.hide()):u.fail.status==404?(console.log(u),p.notify({message:u.fail.response.data,type:"negative",position:"bottom"}),l.value=null,p.loading.hide()):console.log(u):(r.value.order=l.valueVal,r.value.dependiente=u.staff,r.value.client=u.client,u.products.forEach(E=>{var de;console.log(E);const I=r.value.products.find(Qe=>Qe.id===E.id),Ee=((de=E.pivot)==null?void 0:de.units)||0;I?(I.pivot||(I.pivot={units:0}),I.pivot.units+=Ee):r.value.products.push({...E})}),h.value.valueVal=null,console.log(u),p.loading.hide())}},$e=()=>{r.value.products=[]},ue=l=>{l.ctrlKey&&l.key.toLowerCase()==="b"?(l.preventDefault(),m.value.state||(m.value.state=!0)):l.ctrlKey&&l.key.toLowerCase()==="d"?(l.preventDefault(),_.value.state||(_.value.state=!0)):l.altKey&&l.key==="Enter"&&P.value&&(l.preventDefault(),f.value||(f.value=!0))};return je(()=>r.value,l=>{localStorage.setItem("current_sale",JSON.stringify(l))},{deep:!0}),ie(()=>{const l=localStorage.getItem("current_sale");l&&(r.value=JSON.parse(l)),window.addEventListener("keydown",ue)}),xe(()=>{window.removeEventListener("keydown",ue)}),(l,a)=>(y(),D(Ke,null,{default:o(()=>[t(ze,{class:""},{default:o(()=>[t(Le),t(x,{flat:"",round:"",dense:"",icon:"settings",class:"q-mr-xs"},{default:o(()=>[t(ae,{style:{width:"200px"}},{default:o(()=>[t(q,{class:"my-card"},{default:o(()=>[t(N,null,{default:o(()=>[t(oe,{dense:""},{default:o(()=>[t(M,{class:"q-px-sm q-py-xs column"},{default:o(()=>[i("div",It,[t(se,null,{default:o(()=>[J(k(e.value.name),1)]),_:1}),t(Te,{color:"blue",modelValue:e.value.option,"onUpdate:modelValue":[a[0]||(a[0]=u=>e.value.option=u),a[1]||(a[1]=u=>{u?e.value.value=16:e.value.value=0})]},null,8,["modelValue"])]),e.value.option?(y(),D(z,{key:0,modelValue:e.value.value,"onUpdate:modelValue":a[2]||(a[2]=u=>e.value.value=u),options:e.value.optval,label:"Porcentaje",filled:"",dense:"","emit-value":"","map-options":"",class:"q-mt-sm"},null,8,["modelValue","options"])):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(x,{flat:"",round:"",dense:"",icon:"receipt_long"},{default:o(()=>[t(ae,null,{default:o(()=>[t(oe,{style:{"min-width":"100px"}},{default:o(()=>[t(M,null,{default:o(()=>[t(G,null,{default:o(()=>[t(z,{modelValue:h.value.val,"onUpdate:modelValue":a[3]||(a[3]=u=>h.value.val=u),options:h.value.opts,label:"Tipo",filled:"",dense:""},null,8,["modelValue","options"]),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),t(T,{modelValue:h.value.valueVal,"onUpdate:modelValue":a[4]||(a[4]=u=>h.value.valueVal=u),type:h.value.val.type,dense:"",filled:"",label:h.value.val.label,onKeyup:ne(Se,["enter"])},null,8,["modelValue","type","label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(x,{icon:"delete_sweep",onClick:$e,flat:"",round:"",dense:"",title:"Eliminar Productos"}),t(x,{icon:"notes",flat:"",round:"",dense:"",title:"Agregar Notas"},{default:o(()=>[t(ae,null,{default:o(()=>[t(oe,{style:{"min-width":"100px"}},{default:o(()=>[t(M,null,{default:o(()=>[t(G,null,{default:o(()=>[t(T,{modelValue:r.value.observation,"onUpdate:modelValue":a[5]||(a[5]=u=>r.value.observation=u),type:"text",label:"Observacion"},null,8,["modelValue"])]),_:1})]),_:1}),t(Q)]),_:1})]),_:1})]),_:1})]),_:1}),t(q,{class:"my-card"},{default:o(()=>[t(N,{class:"row"},{default:o(()=>[i("div",qt,[a[14]||(a[14]=i("div",{class:"text-caption text-center"},"Dependiente",-1)),t(x,{class:"full-width",flat:"",label:r.value.dependiente?r.value.dependiente.complete_name:"CTRL+d",onClick:we},null,8,["label"])]),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),i("div",Ot,[a[15]||(a[15]=i("div",{class:"text-caption text-center"},"Cliente",-1)),t(x,{class:"full-width",flat:"",label:r.value.client?r.value.client.name:"CTRL+b",onClick:_e},null,8,["label"])])]),_:1})]),_:1}),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),t(q,{class:"my-card"},{default:o(()=>[t(N,{class:"row"},{default:o(()=>[i("div",Rt,[i("div",jt,k(e.value.option?"SUBTOTAL":"TOTAL"),1),i("div",zt,"$ "+k(n.value),1)]),e.value.option?(y(),U("div",Mt,[a[16]||(a[16]=i("div",{class:"text-caption text-center"}," IVA ",-1)),i("div",Kt,"$ "+k(Number(n.value*Number(e.value.value/100)).toFixed(2)),1)])):C("",!0),e.value.option?(y(),U("div",Gt,[a[17]||(a[17]=i("div",{class:"text-caption text-center"}," TOTAL ",-1)),i("div",Jt,"$ "+k(Number(n.value*Number(1+e.value.value/100)).toFixed(2)),1)])):C("",!0),i("div",Zt,[a[18]||(a[18]=i("div",{class:"text-caption text-center"},"Cantidad",-1)),i("div",Wt,k(v.value),1)])]),_:1})]),_:1}),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),t(T,{class:"q-ml-md q-mr-md",modelValue:c.value.filter,"onUpdate:modelValue":a[6]||(a[6]=u=>c.value.filter=u),type:"text",label:"Buscar",filled:"",dense:""},null,8,["modelValue"]),t(Q,{spaced:"",inset:"",vertical:"",dark:""}),i("div",Xt,[$.value.length>0?(y(),U("div",Yt,[t(Y,{rows:$.value,columns:j.value,"hide-bottom":"",pagination:c.value.pagination,onRowClick:Z,filter:c.value.filter},null,8,["rows","columns","pagination","filter"])])):C("",!0),$.value.length>0?(y(),D(Q,{key:1,spaced:"",inset:"",vertical:"",dark:""})):C("",!0),i("div",Ht,[t(Y,{rows:O.value,columns:j.value,"hide-bottom":"",pagination:c.value.pagination,onRowClick:Z,filter:c.value.filter},null,8,["rows","columns","pagination","filter"])])]),t(W,{modelValue:g.value.state,"onUpdate:modelValue":a[7]||(a[7]=u=>g.value.state=u),persistent:"",position:"bottom"},{default:o(()=>[t(bt,{product:g.value.val,_price_list:m.value.val?m.value.val._price_list:1,edit:g.value.edit,onReset:le,products:r.value.products,rules:ce(d).rules,onAddProduct:Ce,onDeleteProduct:De,onEditProduct:Ae},null,8,["product","_price_list","edit","products","rules"])]),_:1},8,["modelValue"]),t(W,{modelValue:m.value.state,"onUpdate:modelValue":a[9]||(a[9]=u=>m.value.state=u)},{default:o(()=>[t(q,{style:{width:"700px"}},{default:o(()=>[t(pe,{onSubmit:he},{default:o(()=>[a[19]||(a[19]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Cliente",-1)),a[20]||(a[20]=i("div",{class:"text-center text-bold text-caption"},"Busca por ID, Celular, o Nombre",-1)),t(N,null,{default:o(()=>[t(Q,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[t(T,{autofocus:"",modelValue:m.value.val,"onUpdate:modelValue":a[8]||(a[8]=u=>m.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),m.value.opts.length>0?(y(),D(N,{key:0},{default:o(()=>[t(Y,{rows:m.value.opts,columns:w.value.columns,pagination:w.value.pagination,onRowClick:ke},null,8,["rows","columns","pagination"])]),_:1})):C("",!0),t(H,{align:"right"},{default:o(()=>[ve(t(x,{flat:"",label:"Cancelar",color:"primary"},null,512),[[me]]),t(x,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(W,{modelValue:_.value.state,"onUpdate:modelValue":a[11]||(a[11]=u=>_.value.state=u)},{default:o(()=>[t(q,{style:{width:"700px"}},{default:o(()=>[t(pe,{onSubmit:Pe},{default:o(()=>[a[21]||(a[21]=i("div",{class:"text-h6 text-bold text-center"},"Buscar Dependiente",-1)),a[22]||(a[22]=i("div",{class:"text-center text-bold text-caption"},"Busca por Nombre",-1)),t(N,null,{default:o(()=>[t(Q,{spaced:"",inset:"",vertical:"",dark:""}),i("div",null,[t(T,{autofocus:"",modelValue:_.value.val,"onUpdate:modelValue":a[10]||(a[10]=u=>_.value.val=u),type:"text",label:"Buscar",dense:"",filled:""},null,8,["modelValue"])])]),_:1}),_.value.opts.length>0?(y(),D(N,{key:0},{default:o(()=>[t(Y,{rows:_.value.opts,columns:s.value.columns,pagination:s.value.pagination,onRowClick:Ve},null,8,["rows","columns","pagination"])]),_:1})):C("",!0),t(H,{align:"right"},{default:o(()=>[ve(t(x,{flat:"",label:"Cancelar",color:"primary"},null,512),[[me]]),t(x,{flat:"",label:"Buscar",type:"submit",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",null,[t(W,{modelValue:f.value,"onUpdate:modelValue":a[12]||(a[12]=u=>f.value=u)},{default:o(()=>[t(Bt,{total:e.value.option?Number(n.value*Number.parseFloat(1+e.value.value/100)):Number(n.value),paymeths:ce(d).methods,client:r.value.client.id,onSendTicket:Ne},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])]),t(Me,{bordered:"",class:"bg-white"},{default:o(()=>[t(q,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:o(()=>[t(N,{class:"row"},{default:o(()=>[t(st,{ref_key:"productRef",ref:A,class:"col",checkState:!1,onInput:K,onAgregar:L},null,512),P.value?(y(),D(x,{key:0,color:"primary",flat:"",icon:"east",onClick:a[13]||(a[13]=u=>f.value=!f.value),round:""})):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Dl as default};
