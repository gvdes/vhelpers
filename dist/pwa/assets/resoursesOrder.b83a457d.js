import{o as y}from"./orderApi.febe7b14.js";const d=(a,o,p)=>{const m=o.categories.familia.seccion.id,i=p.find(e=>e._category==m).rules;let s=0,t=0,c=0;if(!i)return!1;let n=a.filter(e=>e.id===o.id).reduce((e,r)=>e+Number(v(r.pivot,r.pieces)),0),f=a.filter(e=>e.categories.familia.id===o.categories.familia.id).reduce((e,r)=>e+Number(v(r.pivot,r.pieces)),0),l=a.filter(e=>e.categories.familia.seccion.id===o.categories.familia.seccion.id&&e.id!==o.id).reduce((e,r)=>e+Number(v(r.pivot,r.pieces)),0);a.findIndex(e=>e.id==o.id)>=0?(s=n,t=f,c=l):(s=n+Number(o.pivot.amountDelivered),t=f+Number(o.pivot.amountDelivered),c=l+Number(o.pivot.amountDelivered));for(const e of i)if(e._type===2&&(e.sameModel==1&&s>=e.min&&(!e.max||s<=e.max)||e.sameModel==0&&t>=e.min&&(!e.max||t<=e.max)||e.sameModel==0&&c>=e.min&&(!e.max||t<=e.max)&&e.family==0))return!0;return!1},u=(a,o,p)=>{const m=o.categories.familia.seccion.id,i=p.find(e=>e._category==m).rules;let s=0,t=0,c=0;if(!i)return!1;let n=a.filter(e=>e.id===o.id).reduce((e,r)=>e+Number(v(r.pivot,r.pieces)),0),f=a.filter(e=>e.categories.familia.id===o.categories.familia.id).reduce((e,r)=>e+Number(v(r.pivot,r.pieces)),0),l=a.filter(e=>e.categories.familia.seccion.id===o.categories.familia.seccion.id&&e.id!==o.id).reduce((e,r)=>e+Number(v(r.pivot,r.pieces)),0);a.findIndex(e=>e.id==o.id)>=0?(s=n,t=f,c=l):(s=n+Number(o.pivot.amountDelivered),t=f+Number(o.pivot.amountDelivered),c=l+Number(o.pivot.amountDelivered));for(const e of i)if(e._type===3&&(e.sameModel==1&&s>=e.min&&(!e.max||s<=e.max)||e.sameModel==0&&t>=e.min&&(!e.max||t<=e.max)||e.sameModel==0&&c>=e.min&&(!e.max||t<=e.max)&&e.family==0))return!0;return!1},b=async(a,o,p)=>{const m=[];for(const i of a){const s=i.pivot._supply_by==3?i.pivot.amountDelivered*i.pieces:i.pivot._supply_by==2?i.pivot.amountDelivered*12:i.pivot.amountDelivered;let t=0;o.client._price_list<=3?s>=i.pieces&&(i.pivot._supply_by==1||i.pivot._supply_by==2)||i.pivot._supply_by==3?t=4:u(a,i,p)?t=3:d(a,i,p)?t=2:t=1:t=o.client._price_list;const c=i.prices.find(n=>n.id==t);if(c){const n=i.pivot.price,f=i.pivot._price_list,l=c.pivot.price;(n!==l||f!==t)&&(i.pivot._price_list=t,i.pivot.price=l,i.pivot.total=s*l,m.push({_order:i.pivot._order,_product:i.id,_price_list:t,price:l,total:s*l}))}}if(m.length>0){const i=await y.updateProductPrices(m);console.log(i),i.fail?console.error("Error al actualizar precios:",i):console.log("Precios actualizados correctamente")}},g=async(a,o,p)=>{const m=[];for(const i of a){const s=i.pivot._supply_by==3?i.pivot.amountDelivered*i.pieces:i.pivot._supply_by==2?i.pivot.amountDelivered*12:i.pivot.amountDelivered;let t=0;o<=3?s>=i.pieces&&(i.pivot._supply_by==1||i.pivot._supply_by==2)||i.pivot._supply_by==3?t=4:u(a,i,p)?t=3:d(a,i,p)?t=2:t=1:t=o;const c=i.prices.find(n=>n.id==t);if(c){const n=i.pivot.price,f=i.pivot._price_list,l=c.pivot.price;(n!==l||f!==t)&&(i.pivot._price_list=t,i.pivot.price=l,i.pivot.total=s*l,m.push({_product:i.id,_price_list:t,price:l,total:s*l}))}}},v=(a,o)=>a._supply_by==3?a.amountDelivered*o:a._supply_by==2?a.amountDelivered*12:a.amountDelivered;var D={verificarPrecioMayoreo:d,verificarPrecioDocena:u,actualizarPreciosProductos:b,actualizarPreciosProductosSales:g};export{D as R};
