import{br as W,a as Y,u as Z,r as x,c as z,q as J,o as c,d as y,w as s,e as a,g as l,a1 as Q,bC as R,k,h as tt,a0 as et,i as v,Q as A,f as P,ad as p,W as r,aa as ot,X as u,ab as C,_ as it,Z as at,j as g,Y as st}from"./index.dd686a55.js";import{Q as B,a as M}from"./QSelect.2d5192a4.js";import{Q as S}from"./QImg.412b0c7c.js";import{Q as lt,a as nt,b as dt}from"./QList.f45618d9.js";import{Q as j}from"./QBtnGroup.43583612.js";import{Q as rt}from"./QPageSticky.9f5648d8.js";import{Q as ct}from"./QTable.c61bdc8e.js";import{Q as ut}from"./QPage.a81cb91b.js";import{T as mt}from"./TouchSwipe.c3c0e0fc.js";import"./dayjs.min.cbcf888d.js";import{c as pt,a as vt}from"./catalogStore.9d0ac021.js";import{u as ft}from"./use-quasar.e03d6c21.js";import"./QExpansionItem.0221bb27.js";import"./QDrawer.cafc259d.js";import"./ClosePopup.e406de66.js";import{v as V}from"./axios.b899aa11.js";import"./socket.168d2ba4.js";import"./Restock.097bc3ab.js";import"./QLinearProgress.9a913c44.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.721f2004.js";import"./QScrollObserver.301e4a23.js";import"./QToolbar.928fb148.js";import"./QForm.5d3576b5.js";import"./QTd.7781ffaf.js";import"./QPopupEdit.e746627c.js";import"./QTr.76e3166b.js";import"./QLayout.baaf34f7.js";import"./jspdf.plugin.autotable.6472fb4d.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const gt={class:"row justify-end q-gutter-sm full-width"},_t={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},kt={class:"col"},bt={class:"text-bold"},ht={class:"col"},xt={class:"text-bold"},yt={class:"col"},Ct={class:"row"},wt={class:"text-caption"},Pt={class:"text-caption"},qt={class:"text-caption"},Qt={class:"text-caption"},St=["onClick"],Vt={key:1,class:"col-6 flex flex-center bg-grey-2",style:{height:"100%"}},$t={class:"col-6 q-pa-sm flex flex--column justify-between"},Nt={class:"text-center text-bold text-red-10"},zt={class:"q-mt-md"},Rt={class:"col"},At={class:"text-bold"},Bt={key:0,class:"col"},Mt={class:"text-bold"},jt={key:1,class:"col"},Dt={key:0,class:"col"},It={key:1,class:"col"},Tt={class:"q-ml-md q-mr-md text-white bg-primary"},Ft={class:"row q-pt-xs"},ye={__name:"viewCatalogFamily",setup(Ut){const $=W();Y();const n=pt(),N=ft(),w=Z(),b=x({state:!1,val:null}),q=x([]),m=x({pagination:{rowsPerPage:12,page:1},filter:""}),_=x({val:{id:2,label:"Mayor a 1"},opts:[{id:1,label:"Agotados"},{id:2,label:"Mayor a 1"},{id:3,label:"Mayor a 25"},{id:4,label:"Mayor a 50"},{id:5,label:"Mayor a 100"}]}),f=x({val:null,opts:[]}),D=z(()=>Math.ceil(q.value.length/m.value.pagination.rowsPerPage)),I=z(()=>q.value.filter(e=>{var i;const o=f.value.val?e._category===f.value.val.id:!0;let t=!0;if(_.value.val){const d=(i=e.stocks.reduce((h,K)=>h+Number(K.pivot.stock),0))!=null?i:0;switch(_.value.val.id){case 1:t=d===0;break;case 2:t=d>1;break;case 3:t=d>25;break;case 4:t=d>50;break;case 5:t=d>100;break}}return o&&t})),T=async()=>{N.loading.show({message:"Obteniendo Hijos"}),console.log($.params.fid);const e={family:$.params.fid,workpoint:w.session.store.id_viz},o=await vt.getFamilysProducts(e);if(o.fail)console.log(o);else{n.setTitle(`Cat\xE1logo ${o.family.name}`),f.value.opts=o.categories;const t=o.family.products.map(i=>({...i,order:0}));if(n.orderState)for(const i of t){const d=n.order.products.find(h=>h.id===i.id);d&&(i.pivot=d.pivot)}if(n.requisitionState)for(const i of t){const d=n.requisition.products.find(h=>h.id===i.id);d&&(i.pivot=d.pivot)}q.value=t,N.loading.hide()}},F=e=>{b.value.state=!0,b.value.val=e},U=e=>{const o={order:n.order.id,_product:e.id,units:1,price:e.prices.find(t=>t.id==1).pivot.price,total:e.prices.find(t=>t.id==1).pivot.price,amount:1,amountDelivered:0,toDelivered:0,_price_list:1,_supply_by:1};e.pivot={...o},n.pushProduct(e)},L=e=>{e.pivot.amount++,e.pivot.units++,e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProduct(e)},O=e=>{e.pivot.amount--,e.pivot.units--,e.pivot.amount<=0?(delete e.pivot,n.removeProduct(e.id)):(e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProduct(e))},E=e=>{const o={_requisition:n.requisition.id,_product:e.id,amount:1,_supply_by:1,units:1,cost:e.prices.find(t=>t.id==1).pivot.price,total:e.prices.find(t=>t.id==1).pivot.price,comments:null,stock:e.stocks.find(t=>t.id==1).pivot.stock,ipack:null};e.pivot={...o},n.pushProductRequisition(e)},X=e=>{e.pivot.amount++,e.pivot.units++,e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProductRequisition(e)},G=e=>{e.pivot.amount--,e.pivot.units--,e.pivot.amount<=0?(delete e.pivot,n.removeProductRequisition(e.id)):(e.pivot.total=e.pivot.amount*e.pivot.price,n.updateProductRequisition(e))},H=({evt:e,...o})=>{let t=1,i=D.value;o.direction=="left"&&m.value.pagination.page<i?m.value.pagination.page++:o.direction=="right"&&m.value.pagination.page>t&&m.value.pagination.page--};return J(()=>{T()}),(e,o)=>(c(),y(ut,{padding:""},{default:s(()=>[a(ct,{rows:I.value,"row-key":"id",grid:"",pagination:m.value.pagination,filter:m.value.filter,"onUpdate:pagination":o[5]||(o[5]=t=>m.value.pagination=t)},{top:s(()=>[l("div",gt,[a(B,{modelValue:_.value.val,"onUpdate:modelValue":o[1]||(o[1]=t=>_.value.val=t),options:_.value.opts,label:"Stocks",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:s(()=>[_.value.val!==null?(c(),y(Q,{key:0,name:"close",onClick:o[0]||(o[0]=R(t=>_.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):k("",!0)]),_:1},8,["modelValue","options"]),a(B,{modelValue:f.value.val,"onUpdate:modelValue":o[3]||(o[3]=t=>f.value.val=t),options:f.value.opts,"option-label":"name",label:"Categor\xEDas",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:s(()=>[f.value.val!==null?(c(),y(Q,{key:0,name:"close",onClick:o[2]||(o[2]=R(t=>f.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):k("",!0)]),_:1},8,["modelValue","options"]),a(tt,{dense:"",debounce:"300",modelValue:m.value.filter,"onUpdate:modelValue":o[4]||(o[4]=t=>m.value.filter=t),placeholder:"Buscar",class:"col-auto",outlined:""},{append:s(()=>[a(Q,{name:"search"})]),_:1},8,["modelValue"])])]),item:s(t=>[et((c(),v("div",_t,[a(A,{flat:"",bordered:""},{default:s(()=>[a(P,{class:"text-center row"},{default:s(()=>[l("div",kt,[o[7]||(o[7]=p(" Codigo: ")),l("span",bt,r(t.row.code),1)]),l("div",ht,[o[8]||(o[8]=p(" CCO: ")),l("span",xt,r(t.row.name),1)]),l("div",yt,[l("div",null,[o[9]||(o[9]=p(" STOCK: ")),l("span",{class:ot(["text-bold",t.row.stocks.find(i=>i.id==u(w).session.store.id_viz).pivot.stock<=0?"text-red":""])},r(t.row.stocks.find(i=>i.id==u(w).session.store.id_viz).pivot.stock<=0?"Agotado":t.row.stocks.find(i=>i.id==u(w).session.store.id_viz).pivot.stock),3)]),l("div",Ct,[l("div",wt,[p(r(t.row.stocks.find(i=>i.id==1).alias)+" ",1),l("div",Pt,r(t.row.stocks.find(i=>i.id==1).pivot.stock),1)]),a(C,{spaced:"",inset:"",vertical:"",dark:""}),l("div",qt,[p(r(t.row.stocks.find(i=>i.id==2).alias)+" ",1),l("div",Qt,r(t.row.stocks.find(i=>i.id==2).pivot.stock),1)])])])]),_:2},1024),a(C),a(P,{class:"row items-stretch",tyle:"min-height: 260px;"},{default:s(()=>[t.row.imgcover?(c(),v("div",{key:0,class:"col-6 flex flex-center bg-grey-2",onClick:i=>F(`${u(V)}/Products/${t.row.id}/${t.row.imgcover}`),style:{height:"100%"}},[a(S,{src:`${u(V)}/Products/${t.row.id}/${t.row.imgcover}`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])],8,St)):(c(),v("div",Vt,[a(S,{src:`${u(V)}/Products/sinpicture.png`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])])),l("div",$t,[l("div",Nt,r(t.row.description),1),a(C,{spaced:"",inset:"",vertical:"",dark:""}),l("div",zt,[(c(!0),v(it,null,at(t.row.prices,(i,d)=>(c(),v("div",{key:d},[a(lt,{bordered:"",dense:""},{default:s(()=>[a(nt,null,{default:s(()=>[a(dt,null,{default:s(()=>[a(M,{class:"text-center text-bold"},{default:s(()=>[p(r(i.name),1)]),_:2},1024),a(M,{class:"text-center"},{default:s(()=>[p("$ "+r(i.pivot.price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),a(C,{spaced:"",inset:"",vertical:"",dark:""})])]),_:2},1024),a(C),a(P,{class:"text-center row"},{default:s(()=>[l("div",Rt,[o[10]||(o[10]=p(" Piezas X Caja: ")),l("span",At,r(t.row.pieces),1)]),t.row.large?(c(),v("div",Bt,[o[11]||(o[11]=p(" MED: ")),l("span",Mt,r(t.row.large),1)])):k("",!0),u(n).orderState||u(n).requisitionState?(c(),v("div",jt,[t.row.pivot?(c(),v("div",It,[a(j,{rounded:"",class:"bg-primary"},{default:s(()=>[a(g,{size:"sm",color:"primary",icon:"remove",onClick:i=>u(n).orderState?O(t.row):G(t.row)},null,8,["onClick"]),l("div",Tt,r(t.row.pivot.amount),1),a(g,{size:"sm",color:"primary",icon:"add",onClick:i=>u(n).orderState?L(t.row):X(t.row)},null,8,["onClick"])]),_:2},1024)])):(c(),v("div",Dt,[a(g,{color:t.row.stocks.reduce((i,d)=>i+Number(d.pivot.stock),0)<=0?"negative":"primary",rounded:"",label:t.row.stocks.reduce((i,d)=>i+Number(d.pivot.stock),0)<=0?"Agotado":"Agregar",onClick:i=>u(n).orderState?U(t.row):E(t.row),size:"sm",disable:t.row.stocks.reduce((i,d)=>i+Number(d.pivot.stock),0)<=0},null,8,["color","label","onClick","disable"])]))])):k("",!0)]),_:2},1024)]),_:2},1024)])),[[mt,H,void 0,{horizontal:!0}]])]),bottom:s(t=>[a(rt,{position:"bottom",class:"full-width",offset:[0,18]},{default:s(()=>[l("div",Ft,[a(j,{rounded:"",class:""},{default:s(()=>[t.pagesNumber>2?(c(),y(g,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):k("",!0),a(g,{icon:"chevron_left",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),a(g,{flat:"",disable:"","no-caps":""},{default:s(()=>[p(r(t.pagination.page)+" / "+r(t.pagesNumber),1)]),_:2},1024),a(g,{icon:"chevron_right",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),t.pagesNumber>2?(c(),y(g,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:t.lastPage,class:"q-px-sm"},null,8,["onClick"])):k("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","pagination","filter"]),a(st,{modelValue:b.value.state,"onUpdate:modelValue":o[6]||(o[6]=t=>b.value.state=t)},{default:s(()=>[a(A,{flat:"",class:"bg-transparent",style:{width:"700px","max-width":"80vw"}},{default:s(()=>[a(P,{class:"flex flex-center"},{default:s(()=>[a(S,{src:b.value.val,"spinner-color":"primary",style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{ye as default};
