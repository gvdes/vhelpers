import{Q as B}from"./QInput.c65e1852.js";import{Q as $}from"./QForm.1b811a48.js";import{a as y,d as I}from"./QSelect.e229e9a4.js";import{c as R,b as q,a as D}from"./QSeparator.243f9883.js";import{Q as F}from"./QList.5bc323e0.js";import{Q as E}from"./QTable.9c2ee698.js";import{Q as N}from"./QPage.5e491fa0.js";import{Q as T,a as b}from"./QCard.96933c98.js";import{aH as z,a as A,u as H,r as c,c as L,o as k,g as U,e as o,w as a,a3 as j,f as d,a5 as S,d as M,a6 as u,a0 as m,Q as f,a8 as G}from"./index.f206967d.js";import{Q as J}from"./QCardActions.858b406e.js";import{C as K}from"./ClosePopup.6345927e.js";import"./dayjs.min.cbcf888d.js";import{R as _}from"./RestockApi.bf1dd71a.js";import{u as O}from"./Restock.d7a7f586.js";import{u as W}from"./axios.6390b5c3.js";import{$sktRestock as P}from"./socket.3fae67a0.js";import{_ as X}from"./PrinterSelect.a9780dab.js";import"./QLinearProgress.2b955dd6.js";import"./QCheckbox.21d0a706.js";import"./_commonjsHelpers.88e99c8f.js";import"./QBtnGroup.f316eb69.js";const Y={class:"flex justify-center"},Z={class:"text-center",style:"width: 50%;"},tt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},kt={__name:"supply",setup(et){z(),A();const l=O(),n=W(),v=H(),r=c(null),V=c({rowsPerPage:[0]}),s=c({state:!1,val:null}),g=L(()=>l.partitions.filter(i=>i._status==3&&i._suplier_id==v.session.credentials.staff.id&&i.requisition._workpoint_to==v.session.store.id_viz)),h=async()=>{l.setTitle("Surtido"),l.setButtonShow(!1)},C=async i=>{n.loading.show({message:"..."}),console.log(i.ip),console.log(s.value);const t=await _.printForPartition({ip:i.ip,port:i._port,_partition:s.value.val.id,_workpoint_to:s.value.val._workpoint_to});console.log(t),t.status==200?(t.data?n.notify({message:"Impresion correcta",icon:"done",color:"positive",position:"top"}):n.notify({message:`Sin conexion a <b>${i.name} <small>(${i.ip})</small></b>`,icon:"fas fa-bug",color:"negative",position:"center",html:!0,timeout:4e3}),n.loading.hide()):(console.error(t),alert(`Error ${t.status}: ${t.data}`))},x=async()=>{if(console.log("Finalizando Surtido"),g.value.findIndex(t=>t.id==r.value)>=0){n.loading.show({message:"Terminando, espera..."});let t={id:r.value,state:4};const e=await _.nextStatePartition(t);console.log(e);let Q=l.partitions.findIndex(p=>p.id==e.data.partition.id);if(Q>=0){if(l.partitions.splice(Q,1,e.data.partition),e.data.partitionsEnd>e.data.partition.requisition._status){let p={id:e.data.partition._requisition,state:e.data.partitionsEnd};const w=await _.nextState(p);P.emit("order_refresh",{order:w.data}),console.log(w.data)}P.emit("orderpartition_refresh",{order:e.data.partition}),e.status==200&&(r.value=null,s.value={state:!1,val:null}),n.loading.hide()}}else n.notify({message:"No se encuentra tu pedido",type:"negative",position:"bottom"}),r.value=null};return h(),(i,t)=>(k(),U(j,null,[o(N,{padding:""},{default:a(()=>[d("div",null,[d("div",Y,[d("div",Z,[o($,{onSubmit:x},{default:a(()=>[o(B,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),type:"number",label:"Pedido",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1})])]),o(E,{rows:g.value,"row-key":"name",grid:"",pagination:V.value,"hide-bottom":""},{item:a(e=>[d("div",tt,[o(F,{bordered:""},{default:a(()=>[S((k(),M(D,{clickable:"",onClick:()=>{s.value.state=!0,s.value.val=e.row}},{default:a(()=>[o(q,null,{default:a(()=>[o(y,{class:"text-center text-bold"},{default:a(()=>[u(m(e.row.id),1)]),_:2},1024),o(y,{class:"text-center text-overline text-caption"},{default:a(()=>[u("(P: "+m(e.row.requisition.id)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[G]])]),_:2},1024)])]),_:1},8,["rows","pagination"])])]),_:1}),o(R,{modelValue:s.value.state,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.state=e),persistent:""},{default:a(()=>[o(T,null,{default:a(()=>[o(b,{class:"text-bold text-h5 items-center"},{default:a(()=>[u(" Particion "+m(s.value.val.id),1)]),_:1}),o(b,{class:"text-center"},{default:a(()=>t[3]||(t[3]=[u(" Que Desesas Hacer ? ")])),_:1}),o(J,{align:"center"},{default:a(()=>[S(o(f,{flat:"",icon:"close",color:"negative"},null,512),[[K]]),o(f,{flat:"",icon:"print",color:"primary"},{default:a(()=>[o(I,{class:"bg-grey-1 text-indigo-10",style:{"min-width":"250px"}},{default:a(()=>[o(X,{onSelectedPartition:C,partition:!0})]),_:1})]),_:1}),o(f,{flat:"",icon:"send",color:"positive",onClick:t[1]||(t[1]=()=>{r.value=s.value.val.id,x()})})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{kt as default};
