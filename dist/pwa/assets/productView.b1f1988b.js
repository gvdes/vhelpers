import{a as D,Q as M}from"./QSelect.9eb26f2a.js";import{Q as S,a as b,b as u}from"./QList.35ad6390.js";import{u as O,a as T,W as F,c as P,J,q as W,o as v,d as y,w as i,e,f as q,g as l,_ as a,i as h,a0 as A,$ as N,b5 as w,a4 as j,Y as r,a1 as m,j as g,aV as Y,bI as G,h as H,a2 as K,k as Q,Q as X}from"./index.fd78ab5f.js";import{Q as Z}from"./QSpace.423d3fc4.js";import{u as tt}from"./use-quasar.b6b34f91.js";import{o as C}from"./orderApi.904c8fab.js";import{R as k}from"./resoursesOrder.b0a75f4c.js";const et={class:"row"},ot={class:"text-subtitle2 col text-bold text-left text-muted text-overline"},st={class:"text-subtitle2 col text-bold text-center text-muted text-overline"},dt={class:"text-subtitle2 col text-bold text-right text-muted text-overline"},it={class:"row"},lt={class:"text-h6 col text-bold text-left text-strong"},at={class:"text-h6 col text-bold text-right text-strong"},rt={class:"text-subtitle2 col text-muted"},ct={class:"item-center row"},ut={class:"row items-end"},nt={class:"text-center"},pt={class:"col q-pa-xs"},vt={class:"col column q-py-md bg-section",style:{"border-radius":"8px"}},xt=["disabled"],mt={class:"col q-pa-xs"},ft={key:0},Qt={__name:"productView",props:{product:{type:Object,default:{}},order:{type:Object,default:{}},edit:{type:Boolean,default:!1},products:{type:Array,default:[]},rules:{type:Array,default:[]},units:{type:Array,default:[]},unit:{type:Object,default:{}}},emits:["reset","addProduct","deleteProduct"],setup(o,{emit:I}){const V=O(),f=tt();T(),F();const t=o,_=I,z=P(()=>!t.product.pivot.amount||t.product.pivot.amount<=0),n=P(()=>t.product.pivot._supply_by==3?t.product.pivot.amount*t.product.pieces:t.product.pivot._supply_by==2?t.product.pivot.amount*12:t.product.pivot.amount),U=()=>{t.product.pivot._supply_by=t.product.units.id},R=P(()=>t.order.client._price_list<=3?[1,2,3,4]:[t.order.client._price_list]),x=P(()=>t.order.client._price_list<=3?n.value>=t.product.pieces&&(t.product.pivot._supply_by==1||t.product.pivot._supply_by==2)||t.product.pivot._supply_by==3?4:k.verificarPrecioDocena(t.products,t.product,t.rules)?3:k.verificarPrecioMayoreo(t.products,t.product,t.rules)?2:1:t.order.client._price_list),B=()=>{_("reset")},$=async()=>{f.loading.show({message:"Editando Producto"});let c=t.product.prices.find(p=>p.id==x.value).pivot.price,d=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=x.value,t.product.pivot.price=c,t.product.pivot.total=d,console.log(t.product.pivot);const s=await C.editProduct(t.product.pivot);s.fail?console.log(s):(f.loading.hide(),B(),k.actualizarPreciosProductos(t.products,t.order,t.rules))},E=async()=>{f.loading.show({message:"Agregando producto"});let c=t.product.prices.find(p=>p.id==x.value).pivot.price,d=n.value*c;t.product.pivot.toDelivered=n.value,t.product.pivot._price_list=x.value,t.product.pivot.price=c,t.product.pivot.total=d,t.product.pivot._product=t.product.id,t.product.pivot._order=t.order.id,console.log(t.product.pivot);const s=await C.addProduct(t.product.pivot);s.fail?console.log(s):(_("addProduct",t.product),f.loading.hide(),k.actualizarPreciosProductos(t.products,t.order,t.rules))},L=async()=>{f.loading.show({message:"Eliminando Producto"});const c=await C.deleteProduct(t.product.pivot);c.fail?console.log(c):(_("deleteProduct",t.product),f.loading.hide(),k.actualizarPreciosProductos(t.products,t.order,t.rules))};return J(n,c=>{t.product.pivot.units=c},t.product.units),W(()=>{!t.product.pivot._supply_by&&t.units.length&&(t.product.pivot._supply_by=t.product.units),t.product.pivot.amount||(t.product.pivot.amount=1),t.product.pivot.units=n.value}),(c,d)=>(v(),y(X,{class:"card-bg"},{default:i(()=>[e(q,null,{default:i(()=>[l("div",et,[l("div",ot,a(o.product.category.familia.seccion.name),1),l("div",st,a(o.product.category.familia.name),1),l("div",dt,a(o.product.category.name),1)]),l("div",it,[l("div",lt,a(o.product.code),1),l("div",at,a(o.product.name),1)]),l("div",rt,a(o.product.description),1),e(S,{class:"q-mt-md q-mb-md"},{default:i(()=>[e(b,null,{default:i(()=>[(v(!0),h(A,null,N([...o.product.stocks].sort((s,p)=>s.id-p.id),(s,p)=>(v(),y(u,{key:p},{default:i(()=>[e(D,{caption:"",class:w(["text-center",s.id==j(V).session.store.id?"text-bold text-blue":"text-caption"])},{default:i(()=>[r(a(s.alias),1)]),_:2},1032,["class"]),e(D,{overline:"",class:w(["text-center text-bold",[s.pivot.stock<0?"text-red":"text-caption text-overline",s.id==j(V).session.store.id?"text-blue":"text-caption"]])},{default:i(()=>[r(a(s.pivot.stock),1)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1}),l("div",ct,[(v(!0),h(A,null,N(o.product.prices.filter(s=>R.value.includes(s.id)),(s,p)=>(v(),h("div",{class:"col text-subtitle2 text-center",key:p},[l("div",{class:w(s.id==x.value?"text-strong":"text-caption text-muted text-strike")},a(s.alias),3),e(m,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),l("div",{class:w(s.id==x.value?"text-bold text-price":"text-caption text-muted")},a(s.pivot.price),3),e(m,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}})]))),128))])]),_:1}),e(q,null,{default:i(()=>[l("div",ut,[l("div",nt,[l("div",pt,[d[5]||(d[5]=l("div",{class:"text-bold text-h6 text-strong"},"Cantidad:",-1)),e(g,{flat:"",color:"positive",icon:"add",class:"text-h5",onClick:d[0]||(d[0]=s=>o.product.pivot.amount++),disabled:o.order._status!=1},null,8,["disabled"]),e(m,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),l("div",vt,[Y(l("input",{type:"number",min:"1","onUpdate:modelValue":d[1]||(d[1]=s=>o.product.pivot.amount=s),class:"text-center exo clean-input",style:{width:"100px","font-size":"3em",margin:"auto"},disabled:o.order._status!=1},null,8,xt),[[G,o.product.pivot.amount]])]),e(m,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(g,{flat:"",color:"negative",icon:"remove",class:"text-h5",onClick:d[2]||(d[2]=s=>o.product.pivot.amount>1?o.product.pivot.amount--:""),disabled:o.order._status!=1},null,8,["disabled"])])]),e(m,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),l("div",mt,[e(M,{dense:"",filled:"",modelValue:o.product.units,"onUpdate:modelValue":[d[3]||(d[3]=s=>o.product.units=s),U],options:o.units,label:"Surtir por","option-label":"name",disable:o.order._status!=1},null,8,["modelValue","options","disable"]),e(m,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(H,{dense:"",filled:"",modelValue:o.product.pivot.comments,"onUpdate:modelValue":d[4]||(d[4]=s=>o.product.pivot.comments=s),type:"text",label:"Notas",disable:o.order._status!=1},null,8,["modelValue","disable"]),e(m,{spaced:"",inset:"",vertical:"",style:{background:"var(--separator)"}}),e(S,{dense:""},{default:i(()=>[e(b,{class:"bg-highlight"},{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>d[6]||(d[6]=[r("P x C")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(a(o.product.pieces)+" pzs",1)]),_:1})]),_:1}),e(b,null,{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>d[7]||(d[7]=[r("Cajas")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(a(Number(n.value/o.product.pieces).toFixed(1)),1)]),_:1})]),_:1}),e(b,{class:"bg-highlight"},{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>d[8]||(d[8]=[r("Unidades")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(a(n.value)+" pzs",1)]),_:1})]),_:1}),e(b,null,{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>d[9]||(d[9]=[r("Precio")])),_:1}),e(u,{class:"text-bold text-center text-price"},{default:i(()=>[r(a(o.product.prices.find(s=>s.id==x.value).pivot.price),1)]),_:1})]),_:1}),e(b,null,{default:i(()=>[e(u,{class:"text-left text-caption text-muted"},{default:i(()=>d[10]||(d[10]=[r("Total")])),_:1}),e(u,{class:"text-bold text-center text-strong"},{default:i(()=>[r(a(o.product.prices.find(s=>s.id==x.value).pivot.price*n.value),1)]),_:1})]),_:1})]),_:1})])])]),_:1}),e(K,null,{default:i(()=>[e(g,{flat:"",icon:"close",onClick:B}),e(Z),o.order._status==1?(v(),h("div",ft,[o.edit?Q("",!0):(v(),y(g,{key:0,flat:"",icon:"add",color:"positive",onClick:E,disable:z.value},null,8,["disable"])),o.edit?(v(),y(g,{key:1,flat:"",icon:"delete",color:"negative",onClick:L})):Q("",!0),o.edit?(v(),y(g,{key:2,flat:"",icon:"edit",color:"warning",onClick:$,disable:z.value},null,8,["disable"])):Q("",!0)])):Q("",!0)]),_:1})]),_:1}))}};export{Qt as _};
