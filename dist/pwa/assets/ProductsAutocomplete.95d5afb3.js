import{bx as F,u as H,r as y,c as k,q as J,o as f,i as w,d as S,w as r,e as c,j as g,by as R,h as D,Y as V,bz as K,g as i,_,k as E,ae as Y,b5 as G}from"./index.5a92cc75.js";import{a as x,b as B}from"./QList.7902a402.js";import{Q as L}from"./QSelect.b6220e71.js";import{a as I}from"./axios.36a303a2.js";import{u as W}from"./use-quasar.317cf8ee.js";/* empty css                                                                         */var N={autocomplete(n){return I.post("/product",n)},getMassive(n){return I.post("/product/getMassive",n)}};const X={class:"QuickRegular row items-center"},Z={class:"row items-center justify-between no-wrap QuickRegular"},ee={class:"col"},te={class:"text-grey-4 q-pl-md"},ae={class:"text--2 text-grey-5"},oe={class:"text--3"},le={key:0,class:"text--3 text-amber-13"},se={__name:"ProductsAutocomplete",props:{limit:{default:30,type:Number},_category:{default:null,type:Boolean},_status:{default:null,type:Boolean},_location:{default:null,type:Boolean},_celler:{default:null,type:Boolean},check_stock:{default:null,type:Boolean},with_locations:{default:null,type:Boolean},with_image:{default:null,type:Boolean},with_prices:{default:null,type:Boolean},with_prices_Invoice:{default:null,type:Boolean},with_stock:{default:null,type:Boolean},with_stock_cedis:{default:null,type:Number},checkState:{default:!0,type:Boolean},workpointStatus:{default:null,type:[Array,String]},withHistoric:{default:null,type:Boolean},wkpToVal:{default:null,type:Number},with_locations_loc:{default:null,type:Number},blockStates:{type:Array,default:()=>[4,5,6]}},emits:["input","similarcodes","agregar"],setup(n,{expose:Q,emit:T}){const C=W(),v=H(),o=n,h=T,e=y({target:"",iptsearch:{processing:!1,type:"number",icon:"fas fa-font"},options:void 0,read_barcode:!0}),d=y(null),u=k(()=>({autocomplete:e.value.target,_category:o._category,_status:o._status,_location:o._location,with_locations:o.with_locations,with_locations_loc:o.with_locations_loc,with_stock:o.with_stock,check_stock:o.check_stock,with_prices:o.with_prices,withHistoric:o.withHistoric,_celler:o._celler,limit:o.limit,with_stock_cedis:o.with_stock_cedis,_workpoint_status:o.workpointStatus,_workpoint:v.session.store.id_viz})),P=k(()=>t=>o.checkState?o.blockStates.some(a=>a==t.state)&&![1,2,5,6,12,18,19,21,22,24].includes(v.session.credentials._rol):!1);J(()=>{e.value.read_barcode=JSON.parse(localStorage.getItem("barcodereader"));let t=JSON.parse(localStorage.getItem("typeiptsearch"));t&&(e.value.iptsearch.type=t.type,e.value.iptsearch.icon=t.icon)});const b=()=>{e.value.read_barcode=!e.value.read_barcode,e.value.target="",localStorage.setItem("barcodereader",e.value.read_barcode)},$=(t,a,l)=>{console.log(u.value),t.trim().length>1&&(e.value.target=t.toUpperCase().trim(),console.log(e.value.target),console.log(u.value),N.autocomplete(u.value).then(p=>{console.log(p);let U=p.data.map(s=>{if(o.checkState)if(o.wkpToVal){let m=s.stocks.find(j=>j.id==o.wkpToVal);s.stateToVal=m?{own:m,state:m.pivot._status}:{own:null,state:s.status}}else s.stateToVal={own:!0,state:s.status};else s.stateToVal={own:!0,state:s.status};return s});a(()=>{e.value.options=U},s=>{s.setOptionIndex(-1),s.moveOptionSelection(1,!0)})}).catch(p=>{console.log(p)}))},q=()=>{switch(e.value.iptsearch.type){case"text":e.value.iptsearch.type="number",e.value.iptsearch.icon="fas fa-font";break;case"number":e.value.iptsearch.type="text",e.value.iptsearch.icon="fas fa-hashtag";break}localStorage.setItem("typeiptsearch",JSON.stringify(e.value.iptsearch))},z=t=>{e.value.target="",h("input",t)},O=()=>{e.value.target.trim().toUpperCase(),e.value.target.length&&(e.value.iptsearch.processing=!0,N.autocomplete(u.value).then(t=>{console.log(u.value);let a=t.data;switch(a.length){case 0:let l=e.value.target;C.notify({message:`Sin resultados para <b>${l}</b>`,color:"negative",icon:"fas fa-times",html:!0,timeout:1e3,position:"center"}),A();break;default:console.log("Perfecto, aqui esta tu producto"),console.log(a[0]),z(a[0]);break}e.value.target="",e.value.iptsearch.processing=!1}).catch(t=>{console.log(t)}))},A=()=>{console.log("putFocus ejecutada!!"),d.value.focus()};Q({focus:()=>{var t,a;return(a=(t=d.value)==null?void 0:t.focus)==null?void 0:a.call(t)}});const M=t=>{h("agregar",t)};return(t,a)=>(f(),w("div",X,[e.value.read_barcode?(f(),S(D,{key:0,ref_key:"iptatc",ref:d,loading:e.value.iptsearch.processing,disable:e.value.iptsearch.processing,modelValue:e.value.target,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.target=l),dense:"",filled:"",color:"blue-13",class:"text-uppercase col",onKeypress:R(O,["enter"]),autocomplete:"off",autofocus:""},{prepend:r(()=>[c(g,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:a[0]||(a[0]=l=>b())},null,8,["color","icon"])]),_:1},8,["loading","disable","modelValue"])):(f(),S(L,{key:1,dense:"",filled:"",color:"blue-13",class:"text-uppercase col",ref_key:"iptatc",ref:d,"use-input":"","hide-dropdown-icon":"","option-value":"id","option-label":"id","hide-selected":"",behavior:"menu",modelValue:e.value.target,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.target=l),"input-debounce":400,autofocus:"",options:e.value.options,type:e.value.iptsearch.type,onFilter:$,"popup-content-class":"bg-darkl1"},{"no-option":r(()=>[c(x,null,{default:r(()=>[c(B,{class:"text-grey QuickRegular"},{default:r(()=>a[4]||(a[4]=[V("Nada por aqui...")])),_:1})]),_:1})]),prepend:r(()=>[c(g,{dense:"",flat:"",color:e.value.read_barcode?"light-blue-13":"blue-13",icon:e.value.read_barcode?"far fa-keyboard":"fas fa-barcode",onClick:a[2]||(a[2]=l=>b())},null,8,["color","icon"]),c(g,{type:"button",dense:"",size:"sm",flat:"",onClick:q,icon:e.value.iptsearch.icon,color:"grey-6"},null,8,["icon"])]),option:r(l=>[c(x,K(l.itemProps,{onClick:p=>M(l.opt),disable:P.value(l.opt.stateToVal)}),{default:r(()=>[c(B,null,{default:r(()=>[i("div",Z,[i("div",ee,[i("div",null,[V(_(l.opt.code)+" ",1),i("span",te,_(l.opt.name),1)]),i("div",ae,_(l.opt.description),1),i("div",oe,_(l.opt.stateToVal.state.name),1),l.opt.stateToVal.own?E("",!0):(f(),w("div",le,"Producto en conflicto con status "))]),c(Y,{name:"fas fa-circle",class:G(["q-pl-md",`bullet-${l.opt.stateToVal.state+1}`]),size:"10px"},null,8,["class"])])]),_:2},1024)]),_:2},1040,["onClick","disable"])]),_:1},8,["modelValue","options","type"]))]))}};var de=F(se,[["__scopeId","data-v-851ea05e"]]);export{de as P,N as d};
