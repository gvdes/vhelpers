import{Q as T}from"./QInput.5b22e110.js";import{Q as w,a as c}from"./QCard.3913e517.js";import{Q as D}from"./QForm.48aa6ec5.js";import{Q as P,c as $}from"./QSeparator.ce112ec0.js";import{u as B,r as m,q as F,p as A,a1 as b,o as g,d as x,w as o,h as y,e as s,f as i,a0 as v,Q as N,U as E}from"./index.afd768e7.js";import{Q as L}from"./QPage.e30bbbaa.js";import{u as O,c as U}from"./cashApi.7ea391f6.js";import{_ as q}from"./PaymentSales.c06b35ff.js";import{u as z}from"./axios.694c069c.js";import{o as Q}from"./orderApi.873df50f.js";import"./QSelect.a3428ae8.js";import"./QCheckbox.a821ea96.js";import"./QCardActions.66eb3c12.js";const j={class:"row justify-center"},K={class:"col text-right"},R={class:"col text-right"},I={class:"col text-right"},M={class:"col text-right"},Y={class:"col text-right"},de={__name:"salesTpv",setup(Z){const _=B(),d=z(),f=O(),r=m(!1),u=m(null),t=m(null),k=m([]),V=async()=>{if(u.value){d.loading.show({message:"Obteniendo Orden"});let a={uid:_.session.credentials.staff.id_va,oid:u.value};const e=await Q.getOrderCash(a);e.fail?e.fail.status==401?(console.log(e),d.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),u.value=null,d.loading.hide()):e.fail.status==404?(console.log(e),d.notify({message:e.fail.response.data,type:"negative",position:"bottom"}),u.value=null,d.loading.hide()):console.log(e):(t.value=e,console.log(e),d.loading.hide())}},S=async a=>{d.loading.show({message:"Realizando Ticket"}),t.value.payments=a,t.value.change=a.conditions.super?0:Number.parseFloat(a.SFPA.val)+Number.parseFloat(a.PFPA.val)+Number.parseFloat(a.VALE.val)-t.value.products.reduce((n,p)=>n+p.pivot.total,0),t.value.total=t.value.products.reduce((n,p)=>n+p.pivot.total,0);let e={order:t.value,cashier:f.cash};console.log(e);const l=await U.addSale(e);l.fail?console.log(l):(console.log(l),r.value=!1,u.value=null,k.value=[],C())},C=async()=>{let a={uid:_.session.credentials.staff.id_va,oid:t.value.id};console.log(a);const e=await Q.nextStateFinish(a);e.fail?console.log(e):(console.log(e),t.value=null,d.loading.hide())},h=a=>{a.altKey&&a.key==="Enter"&&t.value&&(a.preventDefault(),r.value||(r.value=!0))};return F(()=>{window.addEventListener("keydown",h)}),A(()=>{window.removeEventListener("keydown",h)}),(a,e)=>b(f).cash?(g(),x(L,{key:0,padding:""},{default:o(()=>[t.value?y("",!0):(g(),x(w,{key:0},{default:o(()=>[s(D,{onSubmit:V,class:"q-gutter-md"},{default:o(()=>[s(c,null,{default:o(()=>[s(T,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),type:"text",label:"Escanea",filled:"",dense:"",autofocus:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),s(P,{spaced:"",inset:"",vertical:"",dark:""}),i("div",j,[s(E,{name:"bounce"},{default:o(()=>[t.value?(g(),x(w,{key:0,class:"my-card",style:{"min-width":"600px"}},{default:o(()=>[s(c,{class:"text-bold text-h6 row"},{default:o(()=>[e[3]||(e[3]=i("div",{class:"col text-left"},"Cliente:",-1)),i("div",K,v(t.value.client.name),1)]),_:1}),s(c,{class:"text-bold text-h6 row"},{default:o(()=>[e[4]||(e[4]=i("div",{class:"col text-left"},"Dependiente:",-1)),i("div",R,v(`${t.value.created_by.names} ${t.value.created_by.surname_pat}
              ${t.value.created_by.surname_mat} `),1)]),_:1}),s(c,{class:"text-bold text-h6 row"},{default:o(()=>[e[5]||(e[5]=i("div",{class:"col text-left"},"Orden: ",-1)),i("div",I,v(t.value.id),1)]),_:1}),s(c,{class:"text-bold text-h6 row"},{default:o(()=>[e[6]||(e[6]=i("div",{class:"col text-left"}," Productos: ",-1)),i("div",M,v(t.value.products.length)+" ART",1)]),_:1}),s(c,{class:"text-bold text-h6 row"},{default:o(()=>[e[7]||(e[7]=i("div",{class:"col text-left"}," Piezas: ",-1)),i("div",Y,v(t.value.products.reduce((l,n)=>l+n.pivot.toDelivered,0))+" PZS",1)]),_:1}),s(c,{class:"text-bold text-h4 row bg-primary text-white"},{default:o(()=>[e[8]||(e[8]=i("div",{class:"col text-left"}," Total a Pagar: ",-1)),s(N,{class:"flex justify-right text-h5 bg-white text-primary",size:"xl",label:`$ ${t.value.products.reduce((l,n)=>l+n.pivot.total,0)}`,onClick:e[1]||(e[1]=l=>r.value=!r.value)},null,8,["label"])]),_:1})]),_:1})):y("",!0)]),_:1})]),i("div",null,[s($,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value=l)},{default:o(()=>[s(q,{total:t.value.products.reduce((l,n)=>l+n.pivot.total,0),paymeths:b(f).methods,client:t.value._client,onSendTicket:S},null,8,["total","paymeths","client"])]),_:1},8,["modelValue"])])]),_:1})):y("",!0)}};export{de as default};
