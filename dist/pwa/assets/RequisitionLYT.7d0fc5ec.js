import{Q as h}from"./QSeparator.d492475d.js";import{r as m,c as x,o as j,a as q,w as i,e as o,i as Q,a3 as y,Y as S,f as N,Q as w,a$ as F,a2 as P}from"./index.d31dbdb9.js";import{Q as H}from"./QToolbar.64b28b83.js";import{Q as L}from"./QHeader.3e808474.js";import{Q as $}from"./QSelect.d20a12f6.js";import{Q as B}from"./QInput.7b8be957.js";import{Q as M}from"./QTable.2283fb0d.js";import{u as A,Q as E,a as z}from"./use-quasar.0cd850f3.js";import{Q as I}from"./QCardActions.d7fed535.js";import{Q as K}from"./QDialog.8134b6dd.js";import{Q as O}from"./QPage.93e13254.js";import{Q as Y,a as X}from"./QLayout.639465a3.js";import{C as T}from"./ClosePopup.be1c6acb.js";import{u as G}from"./VDB.c9be2561.js";import{_ as J}from"./UserToolbar.797537b2.js";import{v as _}from"./axios.ae0a941c.js";import"./jspdf.plugin.autotable.f728524b.js";import"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import"./QResizeObserver.c1a2ea92.js";import"./use-key-composition.31dfadbb.js";import"./uid.42677368.js";import"./position-engine.9d8e9107.js";import"./rtl.b51694b1.js";import"./QList.c750e12e.js";import"./QLinearProgress.56b3af21.js";import"./QCheckbox.bfb1a587.js";import"./axios.f1f32898.js";import"./_commonjsHelpers.88e99c8f.js";var V={getSeccion(){return _.get("/resources/getSeccion").then(u=>u.data).catch(u=>({fail:u}))},getProductsCompare(u,s){return _.post(`/resources/getProductReport/${u}`,s).then(r=>r.data).catch(r=>({fail:r}))},create(u){return _.post("/resources/create",u).then(s=>s.data).catch(s=>({fail:s}))}};const W=Q("span",{class:"text-h6"},"Resurtido",-1),Z={class:"row"},ee=Q("div",{class:"text-h6"},"Agrega una nota",-1),$e={__name:"RequisitionLYT",setup(u){const s=G(),r=A(),v=m({status:!1}),n=m({val:null,opts:[]}),c=m({val:[],opts:[]}),g=m([]),p=m(null),b=m({columns:[{name:"short_code",label:"Codigo Corto",align:"left",sortable:!0,field:e=>e.name},{name:"codigo",label:"Codigo",align:"left",sortable:!0,field:e=>e.code},{name:"description",label:"Descripcion",align:"left",sortable:!0,field:e=>e.description},{name:"Seccion",label:"Seccion",align:"left",sortable:!0,field:e=>e.categories.familia.seccion.name},{name:"Familia",label:"Familia",align:"left",sortable:!0,field:e=>e.categories.familia.name},{name:"Categoria",label:"Categoria",align:"left",sortable:!0,field:e=>e.categories.name},{name:"pieces",label:"PXC",align:"center",sortable:!0,field:e=>e.pieces},{name:"cedis",label:"Cedis",align:"center",sortable:!0,field:e=>e.cedis},{name:"texcoco",label:"Texcoco",align:"center",sortable:!0,field:e=>e.texcoco},{name:"Sucursal",label:`${s.session.store.name}`,align:"center",sortable:!0,field:e=>e.sucursal},{name:"Percentge",label:`${s.session.store.name} % `,align:"center",sortable:!0,field:e=>e.percentage,format:(e,a)=>`${e}%`}],filter:""}),C=x(()=>g.value.map(e=>{let a=Math.round(Number(e.stocks.filter(l=>l.id==1).map(l=>l.pivot.stock))/Number(e.pieces)),t=Math.round(Number(e.stocks.filter(l=>l.id==2).map(l=>l.pivot.stock))/Number(e.pieces)),d=Number(e.stocks.filter(l=>l.id==s.session.store.id_viz).map(l=>l.pivot.stock)),f=Math.round(Number(e.stocks.filter(l=>l.id==s.session.store.id_viz).map(l=>l.pivot.stock))*100/Number(e.pieces));return{id:e.id,name:e.name,code:e.code,cost:e.cost,description:e.description,categories:e.categories,pieces:e.pieces,cedis:a,texcoco:t,sucursal:d,percentage:f}}).filter(e=>e.cedis+e.texcoco>0&&e.percentage<=20)),k=x(()=>c.value.val.length>0?C.value.filter(e=>c.value.val.includes(e.categories.name)):C.value),D=async()=>{r.loading.show({message:"Obteniendo secciones"});const e=await V.getSeccion();e.fail?console.log(e):(console.log(e),n.value.opts=e,r.loading.hide()),console.log(e)},R=async()=>{if(n.value.val){r.loading.show({message:"Obteniendo Reporte"}),console.log(n.value.val.map(d=>d.id));let e=s.session.store.id_viz,a=n.value.val.map(d=>d.id);const t=await V.getProductsCompare(e,{data:a});t.fail?console.log(t):(r.loading.hide(),console.log(t),g.value=t,g.value.forEach(d=>{const f=d.categories.name;f&&!c.value.opts.includes(f)&&c.value.opts.push(f)}))}},U=async()=>{r.loading.show({message:"Creando Pedido"});let e={workpoint_from:s.session.store.id_viz,workpoint_to:1,products:k.value,notes:p.value,id_userviz:s.session.id,type:2};console.log(e);const a=await V.create(e);a.fail?console.log(a):(console.log(a),r.notify({message:`Se creo el pedido ${a.order.id}`,type:"positive",position:"center"}),g.value=[],p.value=[],n.value.val=null,c.value.val=[],r.loading.hide())};return D(),(e,a)=>(j(),q(Y,{view:"hHh Lpr fFf"},{default:i(()=>[o(L,{class:"transparent text-dark",bordered:""},{default:i(()=>[o(J),o(h),o(H,{class:"justify-between"},{default:i(()=>[Q("div",null,[y("Helpers "),o(S,{name:"navigate_next",color:"primary"}),y(),W])]),_:1})]),_:1}),o(X,null,{default:i(()=>[o(O,{padding:""},{default:i(()=>[Q("div",Z,[o($,{class:"col",modelValue:n.value.val,"onUpdate:modelValue":a[0]||(a[0]=t=>n.value.val=t),options:n.value.opts,label:"Familia","option-label":"name",filled:"",multiple:"","use-chips":"",onBlur:R},null,8,["modelValue","options"]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o($,{class:"col",modelValue:c.value.val,"onUpdate:modelValue":a[1]||(a[1]=t=>c.value.val=t),options:c.value.opts,label:"Categoria",filled:"",disable:!n.value.val,multiple:"","use-chips":""},null,8,["modelValue","options","disable"])]),o(h,{spaced:"",inset:"",vertical:"",dark:""}),o(M,{rows:N(k),columns:b.value.columns,separator:"cell",filter:b.value.filter},{"top-right":i(()=>[o(B,{borderless:"",dense:"",debounce:"300",modelValue:b.value.filter,"onUpdate:modelValue":a[2]||(a[2]=t=>b.value.filter=t),placeholder:"Buscar"},{append:i(()=>[o(S,{name:"search"})]),_:1},8,["modelValue"]),o(w,{color:"primary","icon-right":"send",flat:"",onClick:a[3]||(a[3]=t=>v.value.state=!v.value.state),disable:N(C).length==0},null,8,["disable"])]),_:1},8,["rows","columns","filter"]),o(K,{modelValue:v.value.state,"onUpdate:modelValue":a[7]||(a[7]=t=>v.value.state=t),persistent:""},{default:i(()=>[o(E,{style:{"min-width":"350px"}},{default:i(()=>[o(z,null,{default:i(()=>[ee]),_:1}),o(z,{class:"q-pt-none"},{default:i(()=>[o(B,{dense:"",modelValue:p.value,"onUpdate:modelValue":a[4]||(a[4]=t=>p.value=t),autofocus:"",onKeyup:a[5]||(a[5]=F(t=>e.prompt=!1,["enter"]))},null,8,["modelValue"])]),_:1}),o(I,{align:"right",class:"text-primary"},{default:i(()=>[P(o(w,{flat:"",label:"Cancelar",onClick:a[6]||(a[6]=t=>p.value=null)},null,512),[[T]]),P(o(w,{flat:"",label:"Enviar Pedido",onClick:U},null,512),[[T]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{$e as default};
