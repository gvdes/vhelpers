import{u as O,a as g,Q as y}from"./axios.1aa5578e.js";import{b as Q,d as h,e as v,a as D,Q as E}from"./QList.50f6271a.js";import{a as T,aH as U,u as L,r as _,c as j,o as c,d as f,w as s,h as V,e as o,f as d,a0 as r,a1 as z,ak as p,g as G,a2 as J,a3 as K,Q as u,a4 as C,b7 as W,am as X}from"./index.40a830e1.js";import{Q as k}from"./QCardActions.3c1e4fb2.js";import{Q as Z}from"./QFooter.d60edb11.js";import{Q as ee}from"./QPage.3eb38237.js";import{C as te}from"./ClosePopup.a76e2454.js";import"./jspdf.plugin.autotable.71acc640.js";import{r as x}from"./refundsApi.54e87643.js";import"./exceljs.min.9e24d01d.js";import"./browser.eff7c919.js";import{p as oe}from"./Refund.38babef0.js";import{d as le}from"./dayjs.min.cbcf888d.js";import{P as ae}from"./ProductsAutocomplete.182200bd.js";import"./QResizeObserver.8ec1f975.js";import"./_commonjsHelpers.88e99c8f.js";import"./QInput.73f7b306.js";import"./QSelect.86d67d4e.js";/* empty css                                                                         */const se={class:"text-center"},de={class:"text-bold"},ie={class:"col text-center"},ne={class:"text-bold"},re={class:"col text-center"},ue={class:"text-bold"},ce={class:"col text-center"},ve={class:"text-bold"},fe={class:"col text-center"},pe={class:"text-bold"},me={class:"text-center text-h4"},ge={class:"text-center text-h6 text-grey-14"},_e={class:"text-center"},xe={class:"q-pa-xs"},be={class:"row"},ye={class:"col column q-py-md"},Oe={__name:"viewRefund",setup(Ce){const w=T(),m=U(),I=L(),n=O();_([]),_([]);const i=_(null),b=_(!1),l=_({state:!1,val:null}),R=j(()=>{var t;return((t=i.value)==null?void 0:t.bodie.filter(e=>{var a;return e.product==((a=l.value.val)==null?void 0:a.product)}).length)>0}),S=async()=>{n.loading.show({message:"Obteniendo Datos"});let t=I.session.store.id,e=m.params.rid;console.log(e);const a=await x.getRefund(t,e);a.error?console.log(a):a.status.id==1?(console.log(a),n.loading.hide(),i.value=a):(n.notify({message:"Ya no se puede modificar la devolucion",type:"negative",position:"top"}),w.replace("/refunds"))},A=t=>{console.log(t)},$=t=>{let e=i.value.bodie.findIndex(a=>a.product==t.code);console.log(e),e>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(l.value.val={product:t.code,description:t.description,price:t.cost,to_delivered:1},l.value.state=!0,console.log(t))},P=()=>{l.value={val:null,state:!1}},B=async()=>{n.loading.show({message:"Insertando Producto"}),l.value.val._refund=m.params.rid,console.log(l.value.val);const t=await x.addProduct(l.value.val);t.fail?console.log(t):(console.log(t),i.value.bodie.push(l.value.val),l.value={val:null,state:!1},n.loading.hide())},N=async()=>{n.loading.show({message:"Creando Devolucion"});const t=await x.endRefund({id:m.params.rid});t.fail?console.log(t):(console.log(t),n.notify({message:`Se creo la devolucion ${t.fs_id} Correctamente`,type:"positive",position:"center"}),w.push("/refunds"),H(t)),n.loading.hide()},F=async()=>{n.loading.show({message:"Editando Producto"}),console.log(l.value.val),l.value.val._refund=m.params.rid;const t=await x.editProduct(l.value.val);if(t.fail)console.log(t);else{console.log(t);let e=i.value.bodie.findIndex(a=>a.product==l.value.val.product);e>=0&&(i.value.bodie[e].to_delivered=l.value.val.to_delivered,n.notify({type:"positive",position:"center"}),l.value={val:null,state:!1},n.loading.hide())}},Y=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(l.value.val),l.value.val._refund=m.params.rid;const t=await x.deleteProduct(l.value.val);if(t.fail)console.log(t);else{console.log(t);let e=i.value.bodie.findIndex(a=>a.product==l.value.val.product);e>=0&&(i.value.bodie.splice(e,1),n.notify({type:"positive",position:"center"}),l.value={val:null,state:!1},n.loading.hide())}},q=t=>{l.value.state=!0,l.value.val=t},H=t=>{console.log(t),oe.refund(t)};return S(),(t,e)=>i.value?(c(),f(ee,{key:0,padding:""},{default:s(()=>[o(y,{class:"my-card"},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[d("div",se,[e[6]||(e[6]=d("div",{class:"text-caption"},"ID",-1)),d("div",de,r(i.value.id),1)]),d("div",ie,[e[7]||(e[7]=d("div",{class:"text-caption"},"REFERENCIA",-1)),d("div",ne,r(i.value.reference),1)]),d("div",re,[e[8]||(e[8]=d("div",{class:"text-caption"},"DESTINO",-1)),d("div",ue,r(i.value.storeto.name),1)]),d("div",ce,[e[9]||(e[9]=d("div",{class:"text-caption"},"CREADO",-1)),d("div",ve,r(i.value.createdby.complete_name),1)]),d("div",fe,[e[10]||(e[10]=d("div",{class:"text-caption"},"FECHA",-1)),d("div",pe,r(z(le)(i.value.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:1})]),_:1}),o(Q,{spaced:"",inset:"",vertical:"",dark:""}),o(D,{bordered:""},{default:s(()=>[o(h,null,{default:s(()=>[o(v,null,{default:s(()=>e[11]||(e[11]=[p(" Producto ")])),_:1}),o(v,null,{default:s(()=>e[12]||(e[12]=[p(" Descripcion ")])),_:1}),o(v,{class:"text-center"},{default:s(()=>e[13]||(e[13]=[p(" Cantidad ")])),_:1})]),_:1})]),_:1}),(c(!0),G(K,null,J(i.value.bodie,(a,M)=>(c(),f(D,{bordered:"",key:M},{default:s(()=>[C((c(),f(h,{clickable:"",onClick:ke=>q(a)},{default:s(()=>[o(v,null,{default:s(()=>[p(r(a.product),1)]),_:2},1024),o(v,null,{default:s(()=>[p(r(a.description),1)]),_:2},1024),o(v,{class:"text-center"},{default:s(()=>[p(r(a.to_delivered),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[X]]),o(Q)]),_:2},1024))),128)),o(E,{modelValue:l.value.state,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.state=a),persistent:"",position:"bottom"},{default:s(()=>[o(y,{style:{width:"300","max-width":"40vw"}},{default:s(()=>[o(g,null,{default:s(()=>[d("div",me,r(l.value.val.product),1),d("div",ge,r(l.value.val.description),1)]),_:1}),o(g,null,{default:s(()=>[d("div",_e,[d("div",xe,[e[14]||(e[14]=d("div",{class:"text-bold text-h6"},"Cantidad:",-1)),d("div",be,[o(u,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[0]||(e[0]=a=>l.value.val.to_delivered>1?l.value.val.to_delivered--:"")}),d("div",ye,[C(d("input",{type:"number",min:"1","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.val.to_delivered=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[W,l.value.val.to_delivered]])]),o(u,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[2]||(e[2]=a=>l.value.val.to_delivered++)})])])])]),_:1}),R.value?(c(),f(k,{key:1,align:"center"},{default:s(()=>[o(u,{flat:"",icon:"close",color:"red-10",onClick:P}),o(u,{flat:"",label:"Eliminar",color:"negative",onClick:Y}),o(u,{flat:"",label:"Editar",color:"blue-10",onClick:F})]),_:1})):(c(),f(k,{key:0,align:"center"},{default:s(()=>[o(u,{flat:"",label:"Cancelar",color:"negative",onClick:P}),o(u,{flat:"",label:"Agregar",color:"positive",onClick:B})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),o(E,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),persistent:""},{default:s(()=>[o(y,null,{default:s(()=>[o(g,{class:"row items-center"},{default:s(()=>e[15]||(e[15]=[d("span",{class:"text text-h6"},"Estas Seguro de terminar la devolucion no se podra editar",-1)])),_:1}),o(k,{align:"right"},{default:s(()=>[C(o(u,{flat:"",icon:"close",color:"negative"},null,512),[[te]]),o(u,{flat:"",icon:"check",color:"positive",onClick:N})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Z,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:s(()=>[o(y,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:s(()=>[o(g,{class:"row"},{default:s(()=>[o(ae,{class:"col",checkState:!1,onInput:A,onAgregar:$}),i.value.bodie.length>0?(c(),f(u,{key:0,color:"primary",flat:"",icon:"east",onClick:e[5]||(e[5]=a=>b.value=!b.value),round:""})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0)}};export{Oe as default};
