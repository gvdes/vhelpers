import{Q as L,a as z,b as c}from"./QTr.0a753c76.js";import{r as f,c as M,o as h,a as Q,w as s,e as o,b1 as D,Y as V,aE as E,Q as k,i as n,a4 as r,a5 as j,f as P,a3 as W}from"./index.0cca38c5.js";import{Q as C}from"./QSelect.039f887b.js";import{Q as x}from"./QSeparator.1133f537.js";import{Q as J}from"./QInput.28bed99e.js";import{d as S,Q as G}from"./deposits.7beca5bf.js";import{Q as H}from"./QTable.66a630d5.js";import{Q as U,a as w}from"./QCard.223ea652.js";import{Q as B}from"./QDialog.c9afd5e4.js";import{Q as K}from"./QDate.68368ed8.js";import{Q as X}from"./QCardActions.e40a88fb.js";import{Q as Z}from"./QPage.0bb45455.js";import{u as ee}from"./VDB.541c1b67.js";import"./ClosePopup.d3a702a8.js";import{u as te}from"./use-quasar.a81f546b.js";import{d as oe}from"./dayjs.min.25545ff6.js";import"./jspdf.plugin.autotable.63f507ae.js";import{E as le}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{$socket as ae}from"./socket.f521047e.js";import"./use-key-composition.fb1517f2.js";import"./uid.42677368.js";import"./position-engine.dfcb92a2.js";import"./rtl.b51694b1.js";import"./axios.eed4c97e.js";import"./axios.f1f32898.js";import"./QList.54b5f586.js";import"./QLinearProgress.aea89b22.js";import"./QCheckbox.3bbebfa6.js";import"./use-cache.b0833c75.js";import"./date.31216428.js";import"./_commonjsHelpers.88e99c8f.js";const se=n("div",{class:"col-2 q-table__title q-mr-xl"},"Depositos",-1),ne={class:"text-bold text-left"},ie={class:"text-bold text-center"},re={class:"text-bold text-center"},de={class:"text-bold text-center"},ce={class:"text-bold text-center"},ue={class:"text-bold text-left"},me={class:"text-bold text-center"},pe={class:"text-bold text-center"},ve={class:"text-bold text-left"},fe=["src"],ge={class:"text-h6"},be={class:"text-subtitle2"},_e={class:"q-pa-md"},ye=n("div",{class:"q-pb-sm"},null,-1),Ze={__name:"Confirm",setup(ke){const T=ee(),u=te(),b=ae.connect();b.connected?console.log(`%c Connect ${b.id} `,"background: #222; color: #bada55"):console.log("%c No hay conexion en el socket ","background: #222; color: #bada55"),b.on("List",e=>{console.log(e),m.value.push(e)}),b.on("ChangeTicket",e=>{let l=m.value.findIndex(t=>t.id==e.id);l>=0&&(m.value[l].ticket=e.ticket,u.notify({message:`El deposito de $ ${e.import} se agrego el ticket ${e.ticket}`,type:"positive",position:"center"}))});const p=f({state:!1,val:null}),i=f({val:{id:1,name:"Pendiente"},opts:[]}),A=["yellow-11","green-11","red-11"],v=f(!1),g=f(null),d=f({val:null,opts:[]}),m=f([]),_=f({columns:[{name:"id",label:"Id",align:"center",field:e=>e.id},{name:"created",label:"Creado por",align:"center",field:e=>e.send_by},{name:"store",label:"Sucursal",align:"center",field:e=>e.store.name},{name:"origin",label:"Origen",align:"center",field:e=>e.origin},{name:"destiny",label:"Destino",align:"center",field:e=>e.destiny},{name:"concept",label:"Concepto",align:"left",field:e=>e.concept},{name:"reference",label:"Referencia / Folio",align:"center",field:e=>e.refernce},{name:"amount",label:"Importe",align:"center",field:e=>e.amount},{name:"status",label:"Estado",align:"left",field:e=>e.status.name},{name:"ticket",label:"Ticket",align:"center",field:e=>e.ticket},{name:"picture",label:"Foto",align:"center",field:e=>e.picture}],filter:""}),$=M(()=>d.value.val&&i.value.val?m.value.filter(e=>e._store==d.value.val.id&&e._status==i.value.val.id):d.value.val&&!i.value.val?m.value.filter(e=>e._store==d.value.val.id):!d.value.val&&i.value.val?m.value.filter(e=>e._status==i.value.val.id):m.value),F=async()=>{let e=new Date,l=oe(e).format("YYYY/MM/DD");g.value=l,console.log(l),u.loading.show({message:"Obteniendo Datos"}),u.loading.show({message:"Obteniendo Datos"});const t=await S.getForm({filt:g.value});t.fail?console.log(t):(console.log(t),u.loading.hide(),m.value=t.deposit,i.value.opts=t.status,d.value.opts=t.stores)},I=e=>{p.value.val=e,p.value.state=!0},q=async e=>{u.loading.show({message:"Cambiando estado"});let l={id:e.id,status:e.status.id};console.log(l);const t=await S.changeStatus(l);console.log(t),t.fail?console.log(t):(u.loading.hide(),e._status=e.status.id,b.emit("ChangeStatus",t),u.notify({message:"Se cambio de estado",type:"positive"}))},N=async()=>{console.log(g.value),u.loading.show({message:"Obteniendo Datos"});const e=await S.getForm({filt:g.value});e.fail?console.log(e):(console.log(e),u.loading.hide(),m.value=e.deposit,v.value=!1)},O=async()=>{const e=new le.Workbook,l=e.addWorksheet("Comparativo");l.addRow(_.value.columns.map(a=>a.label)),$.value.forEach(async a=>{l.addRow([a.id,a.send_by,a.store.name,a.origin,a.destiny,a.concept,a.refernce,a.amount,a.status.name,a.ticket,`http://192.168.10.160:1920/Assist/public/storage/${a.picture}`])}),(async()=>{const a=await e.xlsx.writeBuffer(),R=new Blob([a],{type:"application/octet-stream"}),Y=URL.createObjectURL(R),y=document.createElement("a");y.href=Y,y.download=`Comparativo${T.session.store.alias}.xlsx`,document.body.appendChild(y),y.click(),document.body.removeChild(y)})()};return F(),(e,l)=>(h(),Q(Z,{padding:""},{default:s(()=>[o(H,{title:"Depositos",rows:P($),"row-key":"id","rows-per-page-options":[0],separator:"cell",columns:_.value.columns,filter:_.value.filter},{top:s(t=>[se,o(L),o(C,{modelValue:d.value.val,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.val=a),options:d.value.opts,label:"Sucursal","option-label":"name",filled:"",style:{width:"200px"}},D({_:2},[d.value.val?{name:"append",fn:s(()=>[o(V,{name:"cancel",onClick:l[0]||(l[0]=E(a=>d.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),o(x,{spaced:"",inset:"",vertical:""}),o(C,{modelValue:i.value.val,"onUpdate:modelValue":l[3]||(l[3]=a=>i.value.val=a),options:i.value.opts,label:"Estado","option-label":"name",filled:"",style:{width:"200px"}},D({_:2},[i.value.val?{name:"append",fn:s(()=>[o(V,{name:"cancel",onClick:l[2]||(l[2]=E(a=>i.value.val=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),o(x,{spaced:"",inset:"",vertical:""}),o(k,{color:"primary",icon:"event",onClick:l[4]||(l[4]=a=>v.value=!v.value),flat:"",round:""}),o(x,{spaced:"",inset:"",vertical:""}),o(k,{color:"primary",icon:"download",onClick:O,flat:"",round:""}),o(x,{spaced:"",inset:"",vertical:""}),o(J,{borderless:"",dense:"",debounce:"300",modelValue:_.value.filter,"onUpdate:modelValue":l[5]||(l[5]=a=>_.value.filter=a),placeholder:"Search"},{append:s(()=>[o(V,{name:"search"})]),_:1},8,["modelValue"])]),body:s(t=>[o(z,{props:t},{default:s(()=>[o(c,{key:"id",props:t},{default:s(()=>[n("div",ne,r(t.row.id),1)]),_:2},1032,["props"]),o(c,{key:"created",props:t},{default:s(()=>[n("div",ie,r(t.row.send_by),1)]),_:2},1032,["props"]),o(c,{key:"store",props:t},{default:s(()=>[n("div",re,r(t.row.store.name),1)]),_:2},1032,["props"]),o(c,{key:"origin",props:t},{default:s(()=>[n("div",de,r(t.row.origin),1)]),_:2},1032,["props"]),o(c,{key:"destiny",props:t},{default:s(()=>[n("div",ce,r(t.row.destiny),1)]),_:2},1032,["props"]),o(c,{key:"concept",props:t},{default:s(()=>[n("div",ue,r(t.row.concept),1)]),_:2},1032,["props"]),o(c,{key:"reference",props:t},{default:s(()=>[n("div",me,r(t.row.refernce),1)]),_:2},1032,["props"]),o(c,{key:"amount",props:t},{default:s(()=>[n("div",pe,"$ "+r(Number(t.row.import).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),_:2},1032,["props"]),o(c,{key:"status",props:t},{default:s(()=>[o(C,{"bg-color":A[t.row.status.id-1],modelValue:t.row.status,"onUpdate:modelValue":[a=>t.row.status=a,a=>q(t.row)],options:i.value.opts,label:"Estado",filled:"","option-label":"name",dense:""},null,8,["bg-color","modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"]),o(c,{key:"ticket",props:t},{default:s(()=>[n("div",ve,r(t.row.ticket),1)]),_:2},1032,["props"]),o(c,{key:"picture",props:t,onClick:a=>I(t.row)},{default:s(()=>[t.row.picture!=null?(h(),Q(G,{key:0,src:`http://192.168.10.160:1920/Assist/public/storage/${t.row.picture}`,ratio:1.7,"spinner-color":"primary","spinner-size":"20px",style:{width:"100px"}},null,8,["src","ratio"])):(h(),Q(j,{key:1,rounded:"",size:"100px","font-size":"52px",color:"white","text-color":"primary",icon:"close"}))]),_:2},1032,["props","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),o(B,{modelValue:p.value.state,"onUpdate:modelValue":l[6]||(l[6]=t=>p.value.state=t)},{default:s(()=>[o(U,{class:"my-card"},{default:s(()=>[n("img",{src:`http://192.168.10.160:1920/Assist/public/storage/${p.value.val.picture}`},null,8,fe),o(w,null,{default:s(()=>[n("div",ge,"Creado: "+r(p.value.val.send_by),1),n("div",be,"Estado: "+r(p.value.val.status.name),1)]),_:1}),o(w,null,{default:s(()=>[W(r(p.value.val.concept),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(B,{modelValue:v.value,"onUpdate:modelValue":l[9]||(l[9]=t=>v.value=t)},{default:s(()=>[o(U,{class:"my-card"},{default:s(()=>[o(w,null,{default:s(()=>[n("div",_e,[ye,o(K,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=t=>g.value=t),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(w,null,{default:s(()=>[o(X,{align:"right"},{default:s(()=>[o(k,{flat:"",icon:"close",color:"negative",onClick:l[8]||(l[8]=t=>v.value=!v.value)}),o(k,{flat:"",icon:"check",color:"positive",onClick:N})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ze as default};
