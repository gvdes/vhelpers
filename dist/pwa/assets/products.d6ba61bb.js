import{Q as P,a as v}from"./QSelect.3cfe8482.js";import{u as X,r as f,c as E,J as Y,o as m,d as w,w as o,g as n,e as t,f as b,i as h,a1 as y,a0 as I,$ as z,k as Q,b5 as N,Q as L,a4 as K,_ as c,Y as p,j as D}from"./index.05780af2.js";import{Q as Z,a as ee,b as S}from"./QList.f18c3160.js";import{Q as M}from"./QTd.11568bef.js";import{Q as te}from"./QTr.aac61035.js";import{Q as le}from"./QTable.75c520e2.js";import{Q as oe}from"./QPage.fa21fb6b.js";import"./QExpansionItem.88d53ce4.js";import"./QDrawer.2ceec1d5.js";import"./ClosePopup.6ace4e34.js";import"./axios.dbc32149.js";import{u as ae}from"./use-quasar.8c58ebcf.js";import{u as se}from"./warehousStore.bc0047c2.js";import{P as ie}from"./ProductsAutocomplete.cdd81cce.js";import"./jspdf.plugin.autotable.2185c89a.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{l as U}from"./locationsApi.91ed318b.js";import"./QLinearProgress.6a044d08.js";import"./QResizeObserver.34af1731.js";import"./QScrollObserver.7bc9a7bb.js";/* empty css                                                                         */import"./_commonjsHelpers.88e99c8f.js";const ne={key:0},ce={key:0},de={class:"row"},re={class:"text-subtitle2 col text-bold text-left text-grey text-overline"},ue={class:"text-subtitle2 col text-bold text-center text-grey text-overline"},me={class:"text-subtitle2 col text-bold text-right text-grey text-overline"},pe={class:"row"},ve={class:"text-h6 col text-bold text-left"},fe={class:"text-h6 col text-bold text-right"},_e={class:"text-subtitle2 col"},Fe={__name:"products",setup(ge){const _=X(),r=ae();se().setTitle("Ubicaciones Productos");const V=f([]),k=f(null),$=f([]),g=f([]),O=f(0),a=f(null),x=f(null),B=f({columns:[{name:"name",label:"NOMBRE",field:l=>l.name,align:"left"},{name:"alias",label:"ALIAS",field:l=>l.alias,align:"left"},{name:"path",label:"PATH",field:l=>l.path,align:"left"}],paginate:{rowsPerPage:0}}),A=E(()=>r.platform.is.mobile),j=E(()=>{var l,e;return(e=(l=a.value)==null?void 0:l.locations)==null?void 0:e.find(s=>{var d;return s.id==((d=x.value)==null?void 0:d.selected)})}),F=async()=>{r.loading.show({message:"Obteniendo Secciones"});let l={_rol:_.session.credentials._rol,_workpoint:_.session.store.id_viz};const e=await U.index(l);e.fail?console.log(e):V.value=e,r.loading.hide()},H=()=>{const l=k.value.sections||[];O.value=Math.max(...l.map(e=>e.deep)),g.value=[{options:l.filter(e=>e.root===0),selected:null}],$.value=g.value[0].options},T=l=>{var e;return((e=k.value.sections)==null?void 0:e.filter(s=>s.root===l))||[]},R=(l,e)=>{g.value.splice(e+1);const s=T(l);s.length>0&&g.value.push({options:s,selected:null})},q=l=>{a.value=l,console.log(l)},G=l=>{a.value=l,console.log(l)},J=async()=>{console.log(_.session),r.loading.show({message:"Agregando Ubicacion"}),console.log(x.value);let l={id_viz:_.session.credentials.staff.id_va,_location:x.value.selected,_product:a.value.id};const e=await U.addLocations(l);if(e.fail)console.log(e);else{console.log(e);const s=g.value.filter(d=>d.selected!==null);if(s.length){const i=s[s.length-1].options.find(u=>u.id===x.value.selected);a.value.locations.push(i)}r.notify({message:"Ubicacion Agregada",type:"positive",position:"bottom"}),r.loading.hide()}},W=async l=>{console.log(_.session),r.loading.show({message:"Eliminando Ubicacion"});let e={id_viz:_.session.credentials.staff.id_va,_location:l,_product:a.value.id};console.log(e);const s=await U.addLocations(e);if(s.fail)console.log(s);else{console.log(s),r.notify({message:"Ubicacion Eliminada",type:"positive",position:"bottom"});let d=a.value.locations.findIndex(i=>i.id==l);a.value.locations.splice(d,1),r.loading.hide()}};return F(),Y(g,l=>{const e=l.filter(s=>s.selected!==null);if(e.length){const s=e[e.length-1];T(s.selected),x.value=s}},{deep:!0}),(l,e)=>(m(),w(oe,{padding:""},{default:o(()=>{var s,d;return[n("div",{class:N(A.value?"":"row")},[t(L,{class:N(A.value?"my-card":"col my-card")},{default:o(()=>[t(b,null,{default:o(()=>[V.value.length>0?(m(),h("div",ne,[t(P,{modelValue:k.value,"onUpdate:modelValue":[e[0]||(e[0]=i=>k.value=i),H],options:V.value,label:"ALMAC\xC9N",filled:"","option-label":"name",dense:""},null,8,["modelValue","options"]),t(y,{spaced:"",inset:"",vertical:"",dark:""}),(m(!0),h(I,null,z(g.value,(i,u)=>(m(),h("div",{key:u},[n("div",null,[t(P,{modelValue:i.selected,"onUpdate:modelValue":[C=>i.selected=C,C=>R(C,u)],options:i.options,label:`Nivel ${u+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(y,{spaced:"",inset:"",vertical:"",dark:""})])]))),128))])):Q("",!0)]),_:1})]),_:1},8,["class"]),t(y,{spaced:"",inset:"",vertical:"",dark:""}),t(L,{class:N(A.value?"my-card":"col my-card")},{default:o(()=>[t(b,null,{default:o(()=>[t(ie,{onInput:q,onAgregar:G,with_locations_loc:K(_).session.credentials._rol},null,8,["with_locations_loc"])]),_:1}),a.value?(m(),h("div",ce,[t(b,{class:"item-center"},{default:o(()=>[n("div",de,[n("div",re,c(a.value.category.familia.seccion.name),1),n("div",ue,c(a.value.category.familia.name),1),n("div",me,c(a.value.category.name),1)])]),_:1}),t(b,{class:"item-center"},{default:o(()=>[n("div",pe,[n("div",ve,c(a.value.code),1),n("div",fe,c(a.value.name),1)]),n("div",_e,c(a.value.description),1),n("div",null,[t(Z,null,{default:o(()=>[t(ee,null,{default:o(()=>[t(S,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[1]||(e[1]=[p("GEN")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.gen),1)]),_:1})]),_:1}),t(S,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[2]||(e[2]=[p("EXH")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.exh),1)]),_:1})]),_:1}),t(S,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[3]||(e[3]=[p("FDT")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.fdt),1)]),_:1})]),_:1}),t(S,null,{default:o(()=>[t(v,{class:"text-caption text-center"},{default:o(()=>e[4]||(e[4]=[p("TRA")])),_:1}),t(v,{class:"text-center"},{default:o(()=>[p(c(a.value.stocks[0].pivot.in_transit),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),a.value.locations.length>0?(m(),w(b,{key:0},{default:o(()=>[e[5]||(e[5]=n("div",{class:"text-center text-bold text-h6"},"Ubicaciones",-1)),t(y,{spaced:"",inset:"",vertical:"",dark:""}),t(le,{rows:a.value.locations,columns:B.value.columns,pagination:B.value.paginate,"hide-bottom":"","hide-header":""},{body:o(i=>[t(te,{props:i},{default:o(()=>[(m(!0),h(I,null,z(i.cols,u=>(m(),w(M,{key:u.name,props:i},{default:o(()=>[p(c(u.value),1)]),_:2},1032,["props"]))),128)),t(M,{"auto-width":""},{default:o(()=>[t(D,{size:"sm",color:"negative",flat:"",round:"",dense:"",onClick:u=>W(i.row.id),icon:"delete"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])]),_:1})):Q("",!0)])):Q("",!0)]),_:1},8,["class"])],2),t(y,{spaced:"",inset:"",vertical:"",dark:""}),((s=x.value)==null?void 0:s.selected)&&((d=a.value)==null?void 0:d.id)&&!j.value?(m(),w(L,{key:0,class:"my-card"},{default:o(()=>[t(b,null,{default:o(()=>[t(D,{color:"primary",icon:"add_link",onClick:J})]),_:1})]),_:1})):Q("",!0)]}),_:1}))}};export{Fe as default};
