import{u as q,r as p,c as N,o as Q,g as S,e,w as a,f as t,a5 as m,Y as A,b2 as L,aF as W,Q as g,a0 as B,aX as Z,a4 as M,a3 as O,a2 as j,a as T,h as E,aY as F}from"./index.1eb0c284.js";import{Q as k,a as u}from"./QCard.a83387b5.js";import{Q as d}from"./QSeparator.4b2c57a4.js";import{Q as H}from"./QSlideTransition.ee70c03f.js";import{Q as h}from"./QPage.478cc9d0.js";import{Q as z}from"./QInput.18de77cb.js";import{Q as I,b as ee}from"./QSelect.83a530cc.js";import{Q as G}from"./QCardActions.89707339.js";import{Q as X}from"./QDialog.feb16004.js";import{u as J}from"./VDB.3b813074.js";import{u as K}from"./use-quasar.4a3a4e1a.js";import"./jspdf.plugin.autotable.e093c349.js";import{r as U}from"./refundsApi.2501a52a.js";import"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{d as C}from"./dayjs.min.cbcf888d.js";import{Q as te}from"./QDate.bfd814ca.js";import{Q as se}from"./QTable.1e5bc119.js";import{C as le}from"./ClosePopup.02bfe67f.js";import"./use-key-composition.4dd78fd7.js";import"./uid.937d8ee7.js";import"./QItemSection.676c6463.js";import"./position-engine.9da78d89.js";import"./rtl.276c3f1b.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.ba7b1b0e.js";import"./axios.9ab26c22.js";import"./use-render-cache.3aae9b27.js";import"./date.e6da79a6.js";import"./QList.f4cc273d.js";import"./QLinearProgress.975c7374.js";import"./QCheckbox.818afc7e.js";const oe={class:"text-bold text-centerz"},ae={class:"row"},ie=["onClick"],ne={class:"col"},re={class:"text-bold"},de={class:"col"},ue={class:"text-bold"},ce={class:"col"},ve={class:"text-bold"},fe={class:"col"},me={class:"text-bold"},pe={class:"col"},_e={class:"text-bold"},ye={class:"col"},xe={class:"text-bold"},be={class:"text-bold"},we={class:"text-bold"},ge={class:"col"},Ve={class:"text-bold"},ke={class:"col"},De={class:"text-caption"},Qe={class:"text-bold"},P={__name:"ViewRefunds",props:{refunds:{type:Array,default:[]},status:{type:Array,default:[]}},setup($){const D=q(),r=J(),_=K(),c=p(null),v=p(null),y=p({state:!1,val:null}),b=$,w=p({columns:[{name:"id",label:"ID",field:s=>s.id},{name:"reference",label:"REFERENCIA",field:s=>s.reference},{name:"destiny",label:"DESTINO",field:s=>s.storefrom.name},{name:"origin",label:"ORIGEN",field:s=>s.storeto.name},{name:"createby",label:"CREADO POR",field:s=>s.createdby.complete_name},{name:"date",label:"FECHA",field:s=>C(s.created_at).format("DD-MM-YYYY HH:mm:ss")},{name:"status",label:"Estado",field:s=>s.status}],filter:""}),V=N(()=>c.value&&!v.value?b.refunds.filter(s=>s.status.id==c.value.id):!c.value&&v.value?b.refunds.filter(s=>C(s.created_at).format("YYYY/MM/DD")==v.value):c.value&&v.value?b.refunds.filter(s=>C(s.created_at).format("YYYY/MM/DD")==v.value&&s.status.id==c.value.id):b.refunds),n=s=>{switch(s){case 1:return"red";case 2:return"yellow";case 3:return"blue";case 4:return"green"}},R=s=>{s.status.id==1&&s.storefrom.id==r.session.store.id?(console.log("terminar el que se esta creando"),D.push(`/refunds/${s.id}`)):s.status.id==1&&s.storeto.id==r.session.store.id?_.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):s.status.id==2&&s.storefrom.id==r.session.store.id?_.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"}):s.status.id==2&&s.storeto.id==r.session.store.id?(console.log("se va a recibir"),y.value.state=!0,y.value.val=s):s.status.id==4&&_.notify({message:"No se puede abrir la devolucion",type:"negative",position:"center"})},Y=async s=>{_.loading.show({message:"Cambiando Estado"});let l={id:s.id,uid:r.session.id};const i=await U.nexState(l);i.fail?console.log(i):(D.push(`/refunds/verified/${s.id}`),_.loading.hide())};return(s,l)=>(Q(),S(j,null,[e(se,{rows:V.value,grid:"",columns:w.value.columns,filter:w.value.filter},{"top-left":a(()=>[t("div",oe,m(v.value),1)]),"top-right":a(()=>[t("div",ae,[e(z,{class:"col",filled:"",dense:"",modelValue:w.value.filter,"onUpdate:modelValue":l[0]||(l[0]=i=>w.value.filter=i),placeholder:"Buscar"},{append:a(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{class:"col",modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=i=>c.value=i),options:$.status,label:"Estado",dense:"",filled:"","option-label":"name"},L({_:2},[c.value?{name:"append",fn:a(()=>[e(A,{name:"cancel",onClick:l[1]||(l[1]=W(i=>c.value=null,["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(g,{color:"primary",flat:"",icon:"event"},{default:a(()=>[e(ee,null,{default:a(()=>[e(te,{modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=i=>v.value=i),landscape:"",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})])]),item:a(i=>[t("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:f=>R(i.row)},[e(k,{bordered:"",class:"text-center my-card"},{default:a(()=>[e(u,{class:"row",dense:""},{default:a(()=>[t("div",ne,[l[6]||(l[6]=t("div",{class:"text-caption"},"ID",-1)),t("div",re,m(i.row.id),1)]),e(d,{vertical:""}),t("div",de,[l[7]||(l[7]=t("div",{class:"text-caption"},"Referencia",-1)),t("div",ue,m(i.row.reference),1)]),e(d,{vertical:""}),t("div",ce,[l[8]||(l[8]=t("div",{class:"text-caption"},"Referencia",-1)),t("div",ve,m(B(C)(i.row.created_at).format("DD-MM-YYYY HH:mm:ss")),1)])]),_:2},1024),e(d),e(u,{class:"row"},{default:a(()=>[t("div",fe,[l[9]||(l[9]=t("div",{class:"text-caption"},"Origen",-1)),t("div",me,m(i.row.storefrom.name),1)]),e(d,{vertical:""}),t("div",pe,[l[10]||(l[10]=t("div",{class:"text-caption"},"Destino",-1)),t("div",_e,m(i.row.storeto.name),1)])]),_:2},1024),e(d),e(u,{class:"row"},{default:a(()=>[t("div",ye,[l[11]||(l[11]=t("div",{class:"text-caption"},"Tipo",-1)),t("div",xe,m(i.row.type.name),1)]),e(d,{vertical:""}),t("div",{class:Z(`col bg-${n(i.row.status.id)}`)},[l[12]||(l[12]=t("div",{class:"text-caption"},"Estado",-1)),t("div",be,m(i.row.status.name),1)],2)]),_:2},1024),e(d),e(u,null,{default:a(()=>[l[13]||(l[13]=t("div",{class:"text-caption"},"Creado Por",-1)),t("div",we,m(i.row.createdby.complete_name),1)]),_:2},1024),e(u,{class:"row"},{default:a(()=>[t("div",ge,[l[14]||(l[14]=t("div",{class:"text-caption"},"Devolucion",-1)),t("div",Ve,m(i.row.fs_id),1)]),e(d,{vertical:""}),t("div",ke,[t("div",De,m(i.row._type==1?"ABONO":"ENTRADA"),1),t("div",Qe,m(i.row._type==1?i.row.season_ticket:i.row.entry),1)])]),_:2},1024)]),_:2},1024)],8,ie)]),_:1},8,["rows","columns","filter"]),e(X,{modelValue:y.value.state,"onUpdate:modelValue":l[5]||(l[5]=i=>y.value.state=i),persistent:""},{default:a(()=>[e(k,null,{default:a(()=>[e(u,{class:"text-center text-bold text-h5"},{default:a(()=>l[15]||(l[15]=[M(" Quires recepcionar la devolucion ? ")])),_:1}),e(G,{align:"right"},{default:a(()=>[O(e(g,{flat:"",label:"Cancelar",color:"negative"},null,512),[[le]]),e(g,{flat:"",label:"Recibir",color:"positive",onClick:l[4]||(l[4]=i=>Y(y.value.val))})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ce={class:"row justify-between"},$e={class:"row"},Re={key:0},Ye={class:"row"},Ee={class:"row"},dt={__name:"Index",setup($){const D=q(),r=J(),_=K(),c=p([]),v=p([]),y=p([]),b=p(null),w=p(!1),V=p(!1),n=p({state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:r.session.store.id,store_to:null,_created_by:r.session.id}),R=N(()=>n.value.type?n.value.type.id==1?y.value.filter(f=>f._type==1):y.value.filter(f=>f._type==2):y.value),Y=N(()=>!(n.value.reference&&n.value.type&&n.value.provider)),s=async()=>{_.loading.show({message:"Obteniendo Datos",type:"positive",position:"center"});let f=r.session.store.id;const o=await U.index(f);o.error?console.log(o):(console.log(o),c.value=o.types,y.value=o.provider,b.value=o.refunds,v.value=o.status,_.loading.hide())},l=async()=>{n.value={state:!1,reference:null,provider:null,_warehouse:1,type:null,_status:1,_store_from:r.session.store.id,store_to:null,_created_by:r.session.id}},i=async()=>{n.value.store_to=n.value.provider._store,console.log(n.value);const f=await U.addRefund(n.value);f.error?console.log(f):(console.log(f),_.notify({message:"Se creo correctamente la devolucion",type:"positive",position:"center"}),D.push(`/refunds/${f.id}`))};return r.session.rol=="aux"||r.session.rol=="gen"||r.session.rol=="aud"||r.session.rol=="root"?s():(_.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),D.replace("/")),(f,o)=>(Q(),S(j,null,[e(h,{padding:""},{default:a(()=>[e(k,null,{default:a(()=>[e(u,null,{default:a(()=>[t("div",Ce,[t("div",null,[o[8]||(o[8]=M("Helpers ")),e(A,{name:"navigate_next",color:"primary"}),o[9]||(o[9]=M()),o[10]||(o[10]=t("span",{class:"text-h6"},"Devoluciones ",-1))]),t("div",$e,[B(r).session.store.id!=1?(Q(),T(g,{key:0,color:"primary",icon:"add",flat:"",onClick:o[0]||(o[0]=x=>n.value.state=!n.value.state)})):E("",!0)])])]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),b.value?(Q(),S("div",Re,[e(k,{class:"my-card"},{default:a(()=>[e(u,{class:"text-center text-bold text-h6"},{default:a(()=>[t("div",Ye,[o[11]||(o[11]=t("div",{class:"col"},"Destino",-1)),e(g,{color:"grey",round:"",flat:"",dense:"",icon:w.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[1]||(o[1]=x=>w.value=!w.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:a(()=>[e(H,null,{default:a(()=>[O(t("div",null,[e(P,{refunds:b.value.to,status:v.value},null,8,["refunds","status"])],512),[[F,w.value]])]),_:1})]),_:1})]),_:1}),e(d,{spaced:"",inset:"",vertical:"",dark:""}),B(r).session.store.id!=1?(Q(),T(k,{key:0,class:"my-card"},{default:a(()=>[e(u,{class:"text-center text-bold text-h6"},{default:a(()=>[t("div",Ee,[o[12]||(o[12]=t("div",{class:"col"},"Origen",-1)),e(g,{color:"grey",round:"",flat:"",dense:"",icon:V.value?"keyboard_arrow_up":"keyboard_arrow_down",onClick:o[2]||(o[2]=x=>V.value=!V.value)},null,8,["icon"])])]),_:1}),e(u,null,{default:a(()=>[e(H,null,{default:a(()=>[O(t("div",null,[e(P,{refunds:b.value.from,status:v.value},null,8,["refunds","status"])],512),[[F,V.value]])]),_:1})]),_:1})]),_:1})):E("",!0)])):E("",!0)]),_:1}),e(X,{modelValue:n.value.state,"onUpdate:modelValue":o[7]||(o[7]=x=>n.value.state=x),persistent:""},{default:a(()=>[e(k,null,{default:a(()=>[e(u,null,{default:a(()=>o[13]||(o[13]=[t("span",{class:"text-center text-h6 text-bold"},"Nueva Devolucion",-1)])),_:1}),e(u,null,{default:a(()=>[e(z,{modelValue:n.value.reference,"onUpdate:modelValue":o[3]||(o[3]=x=>n.value.reference=x),type:"text",label:"Referencia",filled:"",dense:""},null,8,["modelValue"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{modelValue:n.value.type,"onUpdate:modelValue":[o[4]||(o[4]=x=>n.value.type=x),o[5]||(o[5]=()=>n.value.provider=null)],options:c.value,label:"Tipo",filled:"",dense:"","option-label":"name"},null,8,["modelValue","options"]),e(d,{spaced:"",inset:"",vertical:"",dark:""}),e(I,{modelValue:n.value.provider,"onUpdate:modelValue":o[6]||(o[6]=x=>n.value.provider=x),options:R.value,label:"Destino",filled:"",dense:"",disable:n.value.type==null,"option-label":"name"},null,8,["modelValue","options","disable"]),e(d,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),e(G,{align:"right"},{default:a(()=>[e(g,{flat:"",label:"Cancel",color:"primary",onClick:l}),e(g,{flat:"",label:"Enviar",color:"primary",onClick:i,disable:Y.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{dt as default};
