import{b as m,Q as h}from"./QList.01e1304b.js";import{aH as k,u as Q,r as I,o as _,d as x,w as c,f as v,a0 as P,e as a,Q as R,I as V}from"./index.7070277f.js";import{Q as T}from"./QSelect.909b0821.js";import{Q as G}from"./QInput.1826f8af.js";import{Q as y}from"./QTable.b9a063dd.js";import{Q as H}from"./QDate.04da629b.js";import{Q as N}from"./axios.97eb91c6.js";import{Q as B}from"./QCardActions.afc580e9.js";import{Q as $}from"./QCard.57aaff64.js";import{Q as Y}from"./QPage.13cf001b.js";import{u as j}from"./use-quasar.64b87885.js";import{u as M}from"./Restock.3ccff8c5.js";import{d as q}from"./dayjs.min.cbcf888d.js";import{E as W}from"./exceljs.min.9e24d01d.js";import{R as O}from"./RestockApi.54e187ad.js";import"./QLinearProgress.bdc661e2.js";import"./QCheckbox.8a9cf3c1.js";import"./use-render-cache.3aae9b27.js";import"./date.0b21e94c.js";import"./QToolbar.fbfe65df.js";import"./QForm.648dc6e4.js";import"./QRadio.dafed61e.js";import"./QTd.fdae597f.js";import"./QPopupEdit.4017bb53.js";import"./QTr.112890cc.js";import"./QLayout.c802a111.js";import"./QScrollObserver.9b91a71c.js";import"./QResizeObserver.1eab3948.js";import"./ClosePopup.aebd2f63.js";import"./QDrawer.7c3a2802.js";import"./jspdf.plugin.autotable.711d9f80.js";import"./_commonjsHelpers.88e99c8f.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const J={class:"text-center text-h6 text-bold"},z={class:"row"},K={class:"q-pa-md"},Qe={__name:"reportStore",setup(X){const p=j();k();const S=M(),L=Q(),r=I({workpoints:[],cedis:null,val:null}),C=I(!1),t=I({from:null,to:null}),d=I({salidas:null,entradas:null}),i=I({rows:[],filter:""}),U=async()=>{S.setShowLYT(!1);let A=new Date,e=q(A).format("YYYY/MM/DD");t.value={from:e,to:e},console.log(e);const o=await O.getStores();o.status==200?(console.log(o.data),r.value.workpoints=o.data,r.value.val=o.data.find(l=>l.id==L.session.store.id),r.value.cedis=o.data.filter(l=>l.id==1)[0],f()):console.log(o)},f=async()=>{i.value.rows=[],p.loading.show({message:"Obteniendo datos"});let A={cedis:r.value.cedis,sucursal:r.value.val,fechas:t.value};console.log(A);const e=await O.getData(A);console.log(e),e.status==200?(console.log(e.data),d.value.salidas=e.data.salidas,d.value.entradas=e.data.entradas,p.loading.hide(),w()):alert(e)},w=()=>{p.loading.show({message:"Haciendo Match"}),d.value.entradas.sort((e,o)=>o.ARTICULOS!==e.ARTICULOS?o.ARTICULOS.localeCompare(e.ARTICULOS):o.SALIDA.localeCompare(e.SALIDA)),d.value.salidas.sort((e,o)=>o.ARTICULOS!==e.ARTICULOS?o.ARTICULOS.localeCompare(e.ARTICULOS):o.FACTURA.localeCompare(e.FACTURA));const A=new Set;d.value.entradas.forEach(e=>{const o=d.value.salidas.find((l,n)=>{const u=("FAC "+l.FACTURA).trim().toUpperCase(),s=(e.SALIDA||"").trim().toUpperCase();u!==s&&console.log("\u274C No match por FACTURA:",{articulo:l.ARTICULOS,salidaFacturaStr:u,entradaSalidaStr:s});const D=l.ARTICULOS===e.ARTICULOS&&u===s;return D&&A.add(n),D});if(o){const l=e.CANTIDAD*e.PRECIO,n=o.CANTIDAD*o.PRECIO,u=o.ARTICULOS===e.ARTICULOS,s=o.CANTIDAD===e.CANTIDAD,D=o.PRECIO===e.PRECIO,F=n===l;i.value.rows.push({SALIDA:o.FACTURA,FECHA:o.FECHAYHORA,REFERENCIA:o.REFERENCIA,CLIENTE:o.NOMBRECLIENTE,CODIGO:o.ARTICULOS,DESCRIPCION:o.DESCRIPCION,CANTIDAD:Number(o.CANTIDAD).toFixed(2),codigoIGUAL:u?"verdadero":"falso",CANTIDADIGUAL:s?"verdadero":"falso",PRECIOIGUAL:D?"verdadero":"falso",TOTALIGUAL:F?"verdadero":"falso",ENTRADA:e.FACTURA,ENTRADA_SALIDA:e.SALIDA,ENTRADA_FECHA:e.FECHA,ENTRADA_CODIGO:e.ARTICULOS,ENTRADA_DESCRIPCION:e.DESCRIPCION,ENTRADA_CANTIDAD:Number(e.CANTIDAD).toFixed(2)});const E=d.value.salidas.indexOf(o);E>-1&&d.value.salidas.splice(E,1)}else e.CANTIDAD*e.PRECIO,i.value.rows.push({SALIDA:"",FECHA:"",REFERENCIA:"",CLIENTE:"",CODIGO:"",DESCRIPCION:"",CANTIDAD:"",codigoIGUAL:!1,CANTIDADIGUAL:!1,PRECIOIGUAL:!1,TOTALIGUAL:!1,ENTRADA:e.FACTURA,ENTRADA_SALIDA:e.SALIDA,ENTRADA_FECHA:e.FECHA,ENTRADA_CODIGO:e.ARTICULOS,ENTRADA_DESCRIPCION:e.DESCRIPCION,ENTRADA_CANTIDAD:Number(e.CANTIDAD).toFixed(2)})}),d.value.salidas.forEach((e,o)=>{A.has(o)||(e.CANTIDAD*e.PRECIO,i.value.rows.push({SALIDA:e.FACTURA,FECHA:e.FECHAYHORA,REFERENCIA:e.REFERENCIA,CLIENTE:e.NOMBRECLIENTE,CODIGO:e.ARTICULOS,DESCRIPCION:e.DESCRIPCION,CANTIDAD:Number(e.CANTIDAD).toFixed(2),codigoIGUAL:!1,CANTIDADIGUAL:!1,PRECIOIGUAL:!1,TOTALIGUAL:!1,ENTRADA:"",ENTRADA_SALIDA:"",ENTRADA_FECHA:"",ENTRADA_CODIGO:"",ENTRADA_DESCRIPCION:"",ENTRADA_CANTIDAD:""}))}),p.loading.hide()},g=async()=>{console.log(t.value),C.value=!1,i.value.rows=[],f()},b=async()=>{const A=new W.Workbook,e=A.addWorksheet(`Comparativo ${r.value.val.name}`);console.log(),e.addTable({name:"Comparativo",ref:"A1",headerRow:!0,totalsRow:!1,style:{showRowStripes:!0},columns:Object.keys(i.value.rows[0]).map(l=>({name:l,filterButton:!0})),rows:i.value.rows.map(l=>Object.values(l))}),e.columns.forEach(l=>{let n=0;l.eachCell({includeEmpty:!0},u=>{const s=u.value?u.value.toString().length:10;s>n&&(n=s)}),l.width=n<10?10:n}),(async()=>{const l=await A.xlsx.writeBuffer(),n=new Blob([l],{type:"application/octet-stream"}),u=URL.createObjectURL(n),s=document.createElement("a");s.href=u,s.download=`Comparativo ${r.value.val.name} ${typeof t.value=="object"?`Del ${t.value.from} a ${t.value.to}`:t.value}.xlsx`,document.body.appendChild(s),s.click(),document.body.removeChild(s)})()};return U(),(A,e)=>(_(),x(Y,{padding:""},{default:c(()=>[v("div",J,"Reporte "+P(t.value&&t.value.from?`Del ${t.value.from} a ${t.value.to}`:t.value),1),a(m,{spaced:"",inset:"",vertical:"",dark:""}),v("div",z,[a(R,{color:"primary",icon:"event",onClick:e[0]||(e[0]=o=>C.value=!C.value),flat:"",rounded:""}),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{modelValue:r.value.cedis,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.cedis=o),options:r.value.workpoints,label:"Cedis",class:"col","option-label":"name",disable:!0,outlined:""},null,8,["modelValue","options"]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(T,{disable:"",modelValue:r.value.val,"onUpdate:modelValue":[e[2]||(e[2]=o=>r.value.val=o),f],options:r.value.workpoints,label:"Sucursal",class:"col","option-label":"name",outlined:"","option-disable":o=>o.id==1},null,8,["modelValue","options","option-disable"])]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(y,{title:"Comparativo",rows:i.value.rows,filter:i.value.filter},{"top-right":c(()=>[a(G,{borderless:"",dense:"",debounce:"300",modelValue:i.value.filter,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.filter=o),placeholder:"Buscar"},{append:c(()=>[a(V,{name:"search"})]),_:1},8,["modelValue"]),a(m,{spaced:"",inset:"",vertical:"",dark:""}),a(R,{color:"primary",icon:"ios_share",onClick:b,flat:"",disable:i.value.rows.length<=0},null,8,["disable"])]),_:1},8,["rows","filter"]),a(h,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=o=>C.value=o)},{default:c(()=>[a($,{class:"my-card"},{default:c(()=>[a(N,null,{default:c(()=>[v("div",K,[e[7]||(e[7]=v("div",{class:"q-pb-sm"},null,-1)),a(H,{modelValue:t.value,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value=o),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),a(N,null,{default:c(()=>[a(B,{align:"right"},{default:c(()=>[a(R,{flat:"",icon:"close",color:"negative",onClick:e[5]||(e[5]=o=>C.value=!C.value)}),a(R,{flat:"",icon:"check",color:"positive",onClick:g})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Qe as default};
