import{u as J,r as k,J as M,o,d,w as t,g as r,e,i as g,Q as E,f as x,ad as _,W as u,ab as y,X as Q,k as p,$ as z,j as P,a4 as W,Z as F,_ as D,a0 as Y,Y as Z}from"./index.52a3c292.js";import{Q as w}from"./QImg.cfafbdca.js";import{Q as G}from"./QUploader.f62b5f08.js";import{a as j}from"./QSelect.c9c7c333.js";import{Q as A,a as S,b as $}from"./QList.cf079002.js";import{Q as H}from"./QFooter.8f5f450e.js";import{Q as K}from"./QPage.a8a9aaec.js";import{C as ee}from"./ClosePopup.db2b9d28.js";import"./exceljs.min.9e24d01d.js";import{u as te}from"./use-quasar.c1be6315.js";import"./dayjs.min.cbcf888d.js";import{p as V}from"./productsApi.66936c85.js";import{u as ae}from"./ProductsStore.6f7970ad.js";import{P as le}from"./ProductsAutocomplete.9b309604.js";import{v as I}from"./axios.172360c8.js";import"./QCircularProgress.626adfc8.js";import"./QResizeObserver.81625c6a.js";import"./_commonjsHelpers.88e99c8f.js";/* empty css                                                                         */const se={class:"row justify-center"},oe={key:0},re={class:"col"},ie={class:"text-bold"},ne={class:"col"},ue={class:"text-bold"},de={key:0,class:"col-6 flex flex-center"},ce={key:1,class:"col-6 flex flex-center"},ve={key:1},pe={class:"col-6 q-pa-sm flex flex--column justify-between"},me={class:"text-center text-bold text-red-10"},fe={class:"col"},ge={class:"text-bold"},_e={key:0,class:"col"},he={class:"text-bold"},xe={class:"text-green text-subtitle2 q-mb-sm"},ye={class:"text-negative text-subtitle2 q-mb-sm"},be={class:"row q-ml-sm"},Te={__name:"PictureProducts",setup(ke){const h=te();J(),ae().setTitle("Imagenes Productos");const b=k(null),f=k(null),i=k({state:!1,result:{state:!1,val:null}}),a=k({state:!1,val:null}),C=k(null),U=()=>{i.value.state=!0,C.value.click()},B=()=>{b.value.pickFiles()},q=()=>{b.value&&b.value.reset(),f.value=null,a.value.state=!1},L=async()=>{var n;h.loading.show({message:"Subiendo Imagenes"});const l=(n=C.value)==null?void 0:n.files;if(!(l!=null&&l.length)){console.warn("No se seleccion\xF3 ning\xFAn archivo."),i.value.state=!1;return}const s=Array.from(l).map(v=>{const[X]=v.name.split(".");return{code:X,file:v}});console.log(s);const m=new FormData;s.forEach(v=>{m.append("codes[]",v.code),m.append("files[]",v.file)});const c=await V.massiveUpdateImg(m);c.fail?console.log(c):(console.log(c),C.value=null,i.value.result.state=!0,i.value.result.val=c,h.notify({message:`\u2705 ${c.actualizados.length} actualizadas, \u26A0\uFE0F ${c.error.length} con error`,type:"info"}),h.loading.hide())},N=l=>{f.value=URL.createObjectURL(l[0]),a.value.val.imgcoverExist=l[0]},R=l=>{console.log(l),a.value.state=!0,a.value.val=l},T=l=>{console.log(l),a.value.state=!0,a.value.val=l},O=async()=>{h.loading.show({message:"Actualizando Imagen"});const l=new FormData;l.append("id",a.value.val.id),l.append("code",a.value.val.code),l.append("picture",a.value.val.imgcoverExist);const s=await V.updateImgProduct(l);s.fail?console.log(s):(console.log(s),b.value.reset(),f.value=null,a.value.val.imgcoverExist=null,a.value.val.imgcover=s.image,h.notify({message:s.mssg,type:"positive",position:"bottom"}),h.loading.hide())};return M(()=>i.value.result.state,l=>{l||(i.value.result.val={actualizados:[],error:[]},i.value.state=!1)}),(l,s)=>(o(),d(K,{padding:""},{default:t(()=>[r("div",se,[e(W,{name:"bounce"},{default:t(()=>[a.value.state?(o(),g("div",oe,[e(E,{flat:"",bordered:""},{default:t(()=>[e(x,{class:"text-center row"},{default:t(()=>[r("div",re,[s[1]||(s[1]=_(" Codigo: ")),r("span",ie,u(a.value.val.code),1)]),r("div",ne,[s[2]||(s[2]=_(" CCO: ")),r("span",ue,u(a.value.val.name),1)])]),_:1}),e(y),e(x,{class:"row items-stretch"},{default:t(()=>[a.value.val.imgcover?(o(),g("div",de,[e(w,{src:`${Q(I)}/Products/${a.value.val.id}/${a.value.val.imgcover}`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1},null,8,["src"])])):(o(),g("div",ce,[f.value==null?(o(),d(w,{key:0,src:`${Q(I)}/Products/sinpicture.png`,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%","object-fit":"contain"},ratio:1,onClick:B},null,8,["src"])):p("",!0),e(G,{ref_key:"uploader",ref:b,accept:".jpg, .png, .jpeg",onAdded:N,"hide-upload-btn":"",style:{display:"none"},"field-name":"file"},null,512),f.value?(o(),g("div",ve,[(o(),d(w,{src:f.value,key:f.value,"spinner-color":"primary",style:{"max-height":"250px","max-width":"100%",width:"200px","object-fit":"contain"},ratio:1},null,8,["src"]))])):p("",!0)])),r("div",pe,[r("div",me,u(a.value.val.description),1)])]),_:1}),e(y),e(x,{class:"text-center row"},{default:t(()=>[r("div",fe,[s[3]||(s[3]=_(" Piezas X Caja: ")),r("span",ge,u(a.value.val.pieces),1)]),a.value.val.large?(o(),g("div",_e,[s[4]||(s[4]=_(" MED: ")),r("span",he,u(a.value.val.large),1)])):p("",!0)]),_:1}),e(z,{align:"right"},{default:t(()=>[e(P,{flat:"",label:"Cancel",color:"negative",onClick:q}),e(P,{flat:"",label:"Enviar",color:"positive",disable:!a.value.val.imgcoverExist,onClick:O},null,8,["disable"])]),_:1})]),_:1})])):p("",!0)]),_:1})]),e(Z,{modelValue:i.value.result.state,"onUpdate:modelValue":s[0]||(s[0]=m=>i.value.result.state=m),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(E,{style:{"min-width":"400px","max-height":"80vh"}},{default:t(()=>{var m,c;return[e(x,{class:"text-center text-bold text-primary"},{default:t(()=>s[5]||(s[5]=[_(" Resultados de la carga masiva ")])),_:1}),(m=i.value.result.val.actualizados)!=null&&m.length?(o(),d(x,{key:0},{default:t(()=>[r("div",xe,"Actualizados correctamente ("+u(i.value.result.val.actualizados.length)+")",1),e(A,{bordered:"",separator:""},{default:t(()=>[(o(!0),g(D,null,F(i.value.result.val.actualizados,(n,v)=>(o(),d(S,{key:"ok-"+v},{default:t(()=>[e($,null,{default:t(()=>[e(j,null,{default:t(()=>[r("b",null,u(n.Codigo),1)]),_:2},1024),e(j,{caption:""},{default:t(()=>[_(u(n.mssg),1)]),_:2},1024)]),_:2},1024),n.image?(o(),d($,{key:0,side:""},{default:t(()=>[e(w,{src:`${Q(I)}/Products/${n.id}/${n.image}`,alt:n.Codigo,style:{width:"50px",height:"50px","border-radius":"8px","object-fit":"cover"}},null,8,["src","alt"])]),_:2},1024)):p("",!0)]),_:2},1024))),128))]),_:1})]),_:1})):p("",!0),(c=i.value.result.val.error)!=null&&c.length?(o(),d(x,{key:1},{default:t(()=>[r("div",ye,"Errores ("+u(i.value.result.val.error.length)+")",1),e(A,{bordered:"",separator:""},{default:t(()=>[(o(!0),g(D,null,F(i.value.result.val.error,(n,v)=>(o(),d(S,{key:"err-"+v},{default:t(()=>[e($,null,{default:t(()=>[e(j,null,{default:t(()=>[r("b",null,u(n.Codigo||"\u2014"),1)]),_:2},1024),e(j,{caption:""},{default:t(()=>[_(u(n.mssg),1)]),_:2},1024)]),_:2},1024),n.image?(o(),d($,{key:0,side:""},{default:t(()=>[e(w,{src:`${Q(I)}/Products/${n.id}/${n.image}`,alt:n.Codigo,style:{width:"50px",height:"50px","border-radius":"8px","object-fit":"cover"}},null,8,["src","alt"])]),_:2},1024)):p("",!0)]),_:2},1024))),128))]),_:1})]),_:1})):p("",!0),e(z,{align:"right"},{default:t(()=>[Y(e(P,{flat:"",label:"Cerrar",color:"primary"},null,512),[[ee]])]),_:1})]}),_:1})]),_:1},8,["modelValue"]),e(H,{reveal:"",elevated:"",bordered:""},{default:t(()=>[e(y,{spaced:"",inset:"",vertical:"",dark:""}),r("div",be,[r("div",null,[e(P,{icon:"upload",flat:"",onClick:U})]),e(y,{spaced:"",inset:"",vertical:"",dark:""}),i.value.state?p("",!0):(o(),d(E,{key:0,class:"col"},{default:t(()=>[e(le,{checkState:!1,onInput:R,onAgregar:T})]),_:1})),e(y,{spaced:"",inset:"",vertical:"",dark:""})]),e(y,{spaced:"",inset:"",vertical:"",dark:""})]),_:1}),r("input",{type:"file",ref_key:"inputFile",ref:C,id:"inputFile",onInput:L,hidden:"",accept:".jpg, .jpeg, .png",multiple:""},null,544)]),_:1}))}};export{Te as default};
