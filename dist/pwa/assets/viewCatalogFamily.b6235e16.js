import{aH as G,a as K,u as X,r as x,c as z,p as J,o as d,d as h,w as i,e as a,f as l,S as V,aI as B,h as k,a4 as W,g as p,ak as u,a0 as n,an as Y,a1 as _,a3 as Z,a2 as tt,Q as f}from"./index.be192ee6.js";import{Q as D,a as M}from"./QSelect.cd223c52.js";import{Q as et}from"./QInput.6e9b67fc.js";import{b as y,Q as ot,a as at,d as st,e as it}from"./QList.c8ebc72f.js";import{Q as C}from"./QCardSection.30d8e469.js";import{Q as $}from"./QImg.b5b50261.js";import{Q as j}from"./QBtnGroup.a798b625.js";import{Q as A}from"./QCard.dd592c54.js";import{Q as lt}from"./QPageSticky.8eb34e13.js";import{Q as rt}from"./QTable.3120fa4a.js";import{Q as nt}from"./QPage.fd426d17.js";import{T as dt}from"./TouchSwipe.cf270be8.js";import"./dayjs.min.cbcf888d.js";import{c as ct,a as ut}from"./catalogStore.85ff8730.js";import{u as mt}from"./use-quasar.cebbf4cd.js";import"./QDrawer.40d07889.js";import"./QCardActions.c1937265.js";import"./ClosePopup.42cde6d5.js";import{v as S}from"./axios.0d58d5b3.js";import"./socket.05630e21.js";import"./Restock.5159433c.js";import"./use-key-composition.d4319e60.js";import"./QLinearProgress.90a5e3b9.js";import"./QCheckbox.30873060.js";import"./_commonjsHelpers.88e99c8f.js";import"./QResizeObserver.30f73c00.js";import"./QScrollObserver.0e6dcf79.js";import"./QToolbar.33476caf.js";import"./QForm.4ccf1640.js";import"./QRadio.8efd2680.js";import"./QTd.c82c5612.js";import"./QPopupEdit.80904775.js";import"./QTr.802ba315.js";import"./QLayout.36d2f8a9.js";import"./jspdf.plugin.autotable.fe1b0140.js";import"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";/* empty css                                                       */const pt={class:"row justify-end q-gutter-sm full-width"},vt={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},ft={class:"col"},gt={class:"text-bold"},_t={class:"col"},kt={class:"text-bold"},bt={class:"col"},xt={class:"row"},ht={class:"text-caption"},yt={class:"text-caption"},wt={class:"text-caption"},Ct={class:"text-caption"},Qt=["onClick"],Pt={key:1,class:"col-6 flex flex-center bg-grey-2",style:{height:"100%"}},Vt={class:"col-6 q-pa-sm flex flex--column justify-between"},$t={class:"text-center text-bold text-red-10"},St={class:"q-mt-md"},qt={class:"col"},Nt={class:"text-bold"},zt={key:0,class:"col"},Bt={class:"text-bold"},Dt={key:1,class:"col"},Mt={key:0,class:"col"},jt={key:1,class:"col"},At={class:"q-ml-md q-mr-md text-white bg-primary"},It={class:"row q-pt-xs"},Qe={__name:"viewCatalogFamily",setup(Tt){const q=G();K();const m=ct(),N=mt(),w=X(),b=x({state:!1,val:null}),Q=x([]),c=x({pagination:{rowsPerPage:12,page:1},filter:""}),g=x({val:null,opts:[{id:1,label:"Agotados"},{id:2,label:"Mayor a 1"},{id:3,label:"Mayor a 25"},{id:4,label:"Mayor a 50"},{id:5,label:"Mayor a 100"}]}),v=x({val:null,opts:[]}),I=z(()=>Math.ceil(Q.value.length/c.value.pagination.rowsPerPage)),T=z(()=>Q.value.filter(s=>{var o;const e=v.value.val?s._category===v.value.val.id:!0;let t=!0;if(g.value.val){const r=(o=s.stocks.reduce((P,R)=>P+Number(R.pivot.stock),0))!=null?o:0;switch(g.value.val.id){case 1:t=r===0;break;case 2:t=r>1;break;case 3:t=r>25;break;case 4:t=r>50;break;case 5:t=r>100;break}}return e&&t})),F=async()=>{N.loading.show({message:"Obteniendo Hijos"}),console.log(q.params.fid);const s={family:q.params.fid,workpoint:w.session.store.id_viz},e=await ut.getFamilysProducts(s);if(e.fail)console.log(e);else{m.setTitle(`Cat\xE1logo ${e.family.name}`),v.value.opts=e.categories;const t=e.family.products.map(o=>({...o,order:0}));if(m.orderState)for(const o of t){const r=m.order.products.find(P=>P.id===o.id);r&&(o.pivot=r.pivot)}Q.value=t,N.loading.hide()}},U=s=>{b.value.state=!0,b.value.val=s},L=s=>{const e={order:m.order.id,_product:s.id,units:1,price:s.prices.find(t=>t.id==1).pivot.price,total:s.prices.find(t=>t.id==1).pivot.price,amount:1,amountDelivered:0,toDelivered:0,_price_list:1,_supply_by:1};s.pivot={...e},m.pushProduct(s)},O=s=>{s.pivot.amount++,s.pivot.units++,s.pivot.total=s.pivot.amount*s.pivot.price,m.updateProduct(s)},E=s=>{s.pivot.amount--,s.pivot.units--,s.pivot.amount<=0?(delete s.pivot,m.removeProduct(s.id)):(s.pivot.total=s.pivot.amount*s.pivot.price,m.updateProduct(s))},H=({evt:s,...e})=>{let t=1,o=I.value;e.direction=="left"&&c.value.pagination.page<o?c.value.pagination.page++:e.direction=="right"&&c.value.pagination.page>t&&c.value.pagination.page--};return J(()=>{F()}),(s,e)=>(d(),h(nt,{padding:""},{default:i(()=>[a(rt,{rows:T.value,"row-key":"id",grid:"",pagination:c.value.pagination,filter:c.value.filter,"onUpdate:pagination":e[5]||(e[5]=t=>c.value.pagination=t)},{top:i(()=>[l("div",pt,[a(D,{modelValue:g.value.val,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value.val=t),options:g.value.opts,label:"Stocks",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:i(()=>[g.value.val!==null?(d(),h(V,{key:0,name:"close",onClick:e[0]||(e[0]=B(t=>g.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):k("",!0)]),_:1},8,["modelValue","options"]),a(D,{modelValue:v.value.val,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value.val=t),options:v.value.opts,"option-label":"name",label:"Categor\xEDas",dense:"",outlined:"",class:"col-auto",style:{width:"200px","max-width":"200px"}},{append:i(()=>[v.value.val!==null?(d(),h(V,{key:0,name:"close",onClick:e[2]||(e[2]=B(t=>v.value.val=null,["stop","prevent"])),class:"cursor-pointer"})):k("",!0)]),_:1},8,["modelValue","options"]),a(et,{dense:"",debounce:"300",modelValue:c.value.filter,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.filter=t),placeholder:"Buscar",class:"col-auto",outlined:""},{append:i(()=>[a(V,{name:"search"})]),_:1},8,["modelValue"])])]),item:i(t=>[W((d(),p("div",vt,[a(A,{flat:"",bordered:""},{default:i(()=>[a(C,{class:"text-center row"},{default:i(()=>[l("div",ft,[e[7]||(e[7]=u(" Codigo: ")),l("span",gt,n(t.row.code),1)]),l("div",_t,[e[8]||(e[8]=u(" CCO: ")),l("span",kt,n(t.row.name),1)]),l("div",bt,[l("div",null,[e[9]||(e[9]=u(" STOCK: ")),l("span",{class:Y(["text-bold",t.row.stocks.find(o=>o.id==_(w).session.store.id_viz).pivot.stock<=0?"text-red":""])},n(t.row.stocks.find(o=>o.id==_(w).session.store.id_viz).pivot.stock<=0?"Agotado":t.row.stocks.find(o=>o.id==_(w).session.store.id_viz).pivot.stock),3)]),l("div",xt,[l("div",ht,[u(n(t.row.stocks.find(o=>o.id==1).alias)+" ",1),l("div",yt,n(t.row.stocks.find(o=>o.id==1).pivot.stock),1)]),a(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",wt,[u(n(t.row.stocks.find(o=>o.id==2).alias)+" ",1),l("div",Ct,n(t.row.stocks.find(o=>o.id==2).pivot.stock),1)])])])]),_:2},1024),a(y),a(C,{class:"row items-stretch",tyle:"min-height: 260px;"},{default:i(()=>[t.row.imgcover?(d(),p("div",{key:0,class:"col-6 flex flex-center bg-grey-2",onClick:o=>U(`${_(S)}/Products/${t.row.id}/${t.row.imgcover}`),style:{height:"100%"}},[a($,{src:`${_(S)}/Products/${t.row.id}/${t.row.imgcover}`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])],8,Qt)):(d(),p("div",Pt,[a($,{src:`${_(S)}/Products/sinpicture.png`,"spinner-color":"primary",style:{width:"100%",height:"100%","max-height":"250px","object-fit":"contain"}},null,8,["src"])])),l("div",Vt,[l("div",$t,n(t.row.description),1),a(y,{spaced:"",inset:"",vertical:"",dark:""}),l("div",St,[(d(!0),p(Z,null,tt(t.row.prices,(o,r)=>(d(),p("div",{key:r},[a(at,{bordered:"",dense:""},{default:i(()=>[a(st,null,{default:i(()=>[a(it,null,{default:i(()=>[a(M,{class:"text-center text-bold"},{default:i(()=>[u(n(o.name),1)]),_:2},1024),a(M,{class:"text-center"},{default:i(()=>[u("$ "+n(o.pivot.price),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),a(y,{spaced:"",inset:"",vertical:"",dark:""})])]),_:2},1024),a(y),a(C,{class:"text-center row"},{default:i(()=>[l("div",qt,[e[10]||(e[10]=u(" Piezas X Caja: ")),l("span",Nt,n(t.row.pieces),1)]),t.row.large?(d(),p("div",zt,[e[11]||(e[11]=u(" MED: ")),l("span",Bt,n(t.row.large),1)])):k("",!0),_(m).orderState?(d(),p("div",Dt,[t.row.pivot?(d(),p("div",jt,[a(j,{rounded:"",class:"bg-primary"},{default:i(()=>[a(f,{size:"sm",color:"primary",icon:"remove",onClick:o=>E(t.row)},null,8,["onClick"]),l("div",At,n(t.row.pivot.amount),1),a(f,{size:"sm",color:"primary",icon:"add",onClick:o=>O(t.row)},null,8,["onClick"])]),_:2},1024)])):(d(),p("div",Mt,[a(f,{color:t.row.stocks.reduce((o,r)=>o+Number(r.pivot.stock),0)<=0?"negative":"primary",rounded:"",label:t.row.stocks.reduce((o,r)=>o+Number(r.pivot.stock),0)<=0?"Agotado":"Agregar",onClick:o=>L(t.row),size:"sm",disable:t.row.stocks.reduce((o,r)=>o+Number(r.pivot.stock),0)<=0},null,8,["color","label","onClick","disable"])]))])):k("",!0)]),_:2},1024)]),_:2},1024)])),[[dt,H,void 0,{mouse:!0}]])]),bottom:i(t=>[a(lt,{position:"bottom",class:"full-width",offset:[0,18]},{default:i(()=>[l("div",It,[a(j,{rounded:"",class:""},{default:i(()=>[t.pagesNumber>2?(d(),h(f,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):k("",!0),a(f,{icon:"chevron_left",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),a(f,{flat:"",disable:"","no-caps":""},{default:i(()=>[u(n(t.pagination.page)+" / "+n(t.pagesNumber),1)]),_:2},1024),a(f,{icon:"chevron_right",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),t.pagesNumber>2?(d(),h(f,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:t.lastPage,class:"q-px-sm"},null,8,["onClick"])):k("",!0)]),_:2},1024)])]),_:2},1024)]),_:1},8,["rows","pagination","filter"]),a(ot,{modelValue:b.value.state,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value.state=t)},{default:i(()=>[a(A,{flat:"",class:"bg-transparent",style:{width:"700px","max-width":"80vw"}},{default:i(()=>[a(C,{class:"flex flex-center"},{default:i(()=>[a($,{src:b.value.val,"spinner-color":"primary",style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Qe as default};
