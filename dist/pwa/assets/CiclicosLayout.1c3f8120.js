import{b as C,Q as ne}from"./QList.8a1b83fc.js";import{Q as fe}from"./QHeader.4fed7e3c.js";import{i as me,c as W,j as pe,k as ge,t as ve,r as h,o as u,g as B,a3 as O,a2 as G,e as o,f as m,Q as k,aW as se,a as ie,u as ae,w as n,al as U,a0 as j,a1 as S,d as y,h as w,a4 as be,p as ye,l as Ce,m as ke,aX as we,S as xe}from"./index.b613c3cf.js";import{Q as K}from"./QDate.77da1fef.js";import{Q as P}from"./QCardSection.9b889a72.js";import{Q as H}from"./QCardActions.24873f56.js";import{Q as $}from"./QCard.2a50bc81.js";import{Q as q,d as Z}from"./QSelect.152be433.js";import{Q as Ve}from"./QToolbar.e5b0d67b.js";import{Q as Qe}from"./QSpace.d1371ac1.js";import{Q as Y}from"./QTooltip.1434b913.js";import{i as Se,j as he}from"./use-key-composition.0102fd89.js";import{Q as Ue,a as $e}from"./QLayout.2a0e02c3.js";import{u as re}from"./use-quasar.92ea2bcb.js";import{d as ce}from"./dayjs.min.cbcf888d.js";import{_ as De}from"./UserToolbar.61420a0a.js";import{C as z}from"./cicsdb.150a1acb.js";import{Q as ee}from"./QInput.b35b4736.js";import{Q as R,a as oe}from"./QTable.f3af7f3b.js";import{Q as Pe}from"./QExpansionItem.4748e399.js";import{Q as te}from"./QTr.be734f04.js";import{Q as le}from"./QTd.7bfb67bc.js";import{Q as Be}from"./QFooter.b2e9f77a.js";import{C as qe}from"./ClosePopup.451551fc.js";import{P as ze}from"./ProductsAutocomplete.7c735797.js";import{c as de}from"./cyclecountStore.111855ff.js";import"./axios.75706f19.js";import"./QDrawer.fec8091b.js";import"./QPage.79603525.js";import"./OrderStore.e513b83a.js";import{$sktCounters as b}from"./socket.41f46bf6.js";import{r as Ne}from"./reports.46b39817.js";import"./QResizeObserver.344264fb.js";import"./use-render-cache.3aae9b27.js";import"./date.2e893d97.js";import"./QScrollObserver.d4aebe0b.js";import"./_commonjsHelpers.88e99c8f.js";import"./auth.cb579e35.js";import"./QLinearProgress.a24c2da6.js";import"./QCheckbox.182a7ce2.js";import"./use-checkbox.048c83cf.js";/* empty css                                                                         */import"./exceljs.min.9e24d01d.js";var je=me({name:"QBar",props:{...Se,dense:Boolean},setup(i,{slots:p}){const{proxy:{$q:f}}=ve(),g=he(i,f),r=W(()=>`q-bar row no-wrap items-center q-bar--${i.dense===!0?"dense":"standard"}  q-bar--${g.value===!0?"dark":"light"}`);return()=>pe("div",{class:r.value,role:"toolbar"},ge(p.default))}});const Ee={class:"text-right"},Le={__name:"Locations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(i,{emit:p}){const f=i,g=p,r=c=>f.sections.filter(v=>v.root===c),d=h([{options:f.sections.filter(c=>c.root===0),selected:null}]),x=(c,v)=>{const V=c[c.length-1];d.value.splice(v+1);const Q=r(V);Q.length&&d.value.push({options:Q,selected:[]})},a=()=>{const c=d.value.filter(V=>V.selected.length>0),v=c[c.length-1];g("obtProducts",v)};return(c,v)=>(u(),B("div",null,[(u(!0),B(O,null,G(d.value,(V,Q)=>(u(),B("div",{key:Q},[o(q,{class:"col",modelValue:V.selected,"onUpdate:modelValue":[D=>V.selected=D,D=>x(D,Q)],options:V.options,label:`Nivel ${Q+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:"",multiple:"","use-chips":""},null,8,["modelValue","onUpdate:modelValue","options","label"]),o(C,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),m("div",Ee,[o(k,{flat:"",icon:"send",disable:!d.value[0].selected,onClick:a},null,8,["disable"])])]))}},Me={class:"col"},Ae={class:"text-bold"},Oe={class:"text-bold"},Te={class:"row"},Fe={class:"col"},Ie={class:"col"},_e={key:0,class:"row"},Ye={__name:"Create",props:{config:{default:{},type:Object}},emits:["create"],setup(i,{emit:p}){const f=re();se(),ie();const g=ae(),r=de(),d=h(null),x=p,a=i,c=h({team:!1,selectSection:!1}),v=h({columns:[{name:"name",label:"Nombre",field:t=>{var e;return(e=t.staff)==null?void 0:e.complete_name},align:"left"}],filter:null}),V=h({columns:[{name:"code",label:"Codigo",field:t=>t.code,align:"left"},{name:"description",label:"Descripcion",field:t=>t.description,align:"left"},{name:"locationExh",label:"Exhibicion",field:t=>{var e,l;return(l=(e=t.locations)==null?void 0:e.filter(s=>s.celler._type==2))==null?void 0:l.map(s=>s.path).join("/")},align:"left"},{name:"locationGen",label:"General",field:t=>{var e,l;return(l=(e=t.locations)==null?void 0:e.filter(s=>s.celler._type==1))==null?void 0:l.map(s=>s.path).join("/")},align:"left"}],filter:null}),Q=W(()=>a.config.type.val&&a.config.option.val&&a.config.notes&&a.config.resexh.length>0&&a.config.resgen.length>0&&a.config.products.length>0),D=(t,e)=>{const l=e.toUpperCase();return t.filter(s=>{var X,J;const I=Object.values(s).some(_=>String(_!=null?_:"").toUpperCase().includes(l)),ue=(J=(X=s.staff)==null?void 0:X.complete_name.toUpperCase().includes(l))!=null?J:!1;return I||ue})},T=t=>{(t.id==1||t.id==2)&&(c.value.selectSection=!0)},F=t=>{console.log(t),a.config.products.findIndex(l=>l.id==t.id)>=0?f.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):a.config.products.push(t)},E=t=>{console.log(t),a.config.products.findIndex(l=>l.id==t.id)>=0?f.notify({message:"El producto ya esta en la lista :)",type:"warning",position:"top"}):a.config.products.push(t)},L=async()=>{if(a.config.option.val.id==2){f.loading.show({message:"Obteniendo Datos"});let t={workpoint:g.session.store.id_viz,seccion:a.config.section.map(l=>l.id)};console.log(t);const e=await z.obtProductSLocation(t);e.fail?console.log(e):(console.log(e),a.config.products=e,f.loading.hide())}},M=async t=>{f.loading.show({message:"Obteniendo Productos"});let e={ubicacion:t.selected,workpoint:g.session.store.id_viz,seccion:a.config.section.map(s=>s.id)};console.log(e);const l=await z.obtProductSections(e);l.fail?console.log(l):(console.log(l),a.config.products=l,f.loading.hide())},A=t=>{console.log(t);let e=a.config.products.findIndex(l=>l.id==t.id);e>=0&&a.config.products.splice(e,1)},N=()=>{Q.value?x("create"):(a.config.type.val||f.notify({message:"Falta un tipo",type:"warning",position:"left"}),a.config.option.val||f.notify({message:"Falta una opci\xF3n",type:"warning",position:"left"}),a.config.notes||f.notify({message:"Faltan notas",type:"warning",position:"left"}),a.config.resexh.length===0&&f.notify({message:"Falta Responsable exhibici\xF3n",type:"warning",position:"left"}),a.config.resgen.length===0&&f.notify({message:"Falta Responsable general",type:"warning",position:"left"}),a.config.products.length===0&&f.notify({message:"Debe agregar productos",type:"warning",position:"left"}))};return(t,e)=>(u(),B(O,null,[o($,null,{default:n(()=>[o(P,{class:"row items-center"},{default:n(()=>[m("div",Me,[e[10]||(e[10]=U(" Creacion: ")),m("span",Ae,j(S(ce)().format("YYYY-MM-DD")),1),e[11]||(e[11]=U()),e[12]||(e[12]=m("br",null,null,-1)),e[13]||(e[13]=U(" Creador: ")),m("span",Oe,j(S(g).session.credentials.staff.complete_name),1)]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(ee,{modelValue:i.config.notes,"onUpdate:modelValue":e[0]||(e[0]=l=>i.config.notes=l),type:"text",label:"Notas"},null,8,["modelValue"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(q,{class:"",modelValue:i.config.type.val,"onUpdate:modelValue":e[1]||(e[1]=l=>i.config.type.val=l),options:i.config.type.opts,label:"Tipo",disable:""},null,8,["modelValue","options"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(q,{class:"col",modelValue:i.config.option.val,"onUpdate:modelValue":[e[2]||(e[2]=l=>i.config.option.val=l),T],options:i.config.option.opts,label:"Seleccion",disable:!!i.config.option.val},null,8,["modelValue","options","disable"])]),_:1})]),_:1}),o($,{bordered:""},{default:n(()=>[o(P,null,{default:n(()=>[o(Pe,{"expand-separator":"",icon:"fas fa-users",label:"Responsables","header-class":"text-grey-5",modelValue:c.value.team,"onUpdate:modelValue":e[6]||(e[6]=l=>c.value.team=l),caption:`Exh: ${i.config.resexh.length} -- Gen ${i.config.resgen.length}`},{default:n(()=>[o(P,null,{default:n(()=>[o(ee,{modelValue:v.value.filter,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value.filter=l),type:"text",label:"Buscar"},null,8,["modelValue"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),m("div",Te,[m("div",Fe,[o(R,{selection:"multiple",selected:i.config.resexh,"onUpdate:selected":e[4]||(e[4]=l=>i.config.resexh=l),title:"Ventas",rows:S(r).users.filter(l=>[8,9].includes(l._rol)),columns:v.value.columns,filter:v.value.filter,"filter-method":D},null,8,["selected","rows","columns","filter"])]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),m("div",Ie,[o(R,{selection:"multiple",selected:i.config.resgen,"onUpdate:selected":e[5]||(e[5]=l=>i.config.resgen=l),title:"Almacen",rows:S(r).users.filter(l=>[4,24].includes(l._rol)),columns:v.value.columns,filter:v.value.filter,"filter-method":D},null,8,["selected","rows","columns","filter"])])])]),_:1})]),_:1},8,["modelValue","caption"])]),_:1})]),_:1}),o(C,{spaced:"",inset:"",vertical:"",dark:""}),i.config.option.val?(u(),y($,{key:0,class:"my-card q-ml-md q-mr-md",bordered:""},{default:n(()=>[i.config.option.val.id==1?(u(),B("div",_e,[o(q,{class:"col",modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=l=>d.value=l),options:S(r).locations,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),d.value?(u(),y(Le,{key:0,class:"col",sections:d.value.sections,onObtProducts:M},null,8,["sections"])):w("",!0)])):w("",!0)]),_:1})):w("",!0),o(C),i.config.products.length?(u(),y($,{key:1,class:"my-card",bordered:""},{default:n(()=>[o(P,null,{default:n(()=>[o(R,{rows:i.config.products,columns:V.value.columns},{header:n(l=>[o(te,{props:l},{default:n(()=>[(u(!0),B(O,null,G(l.cols,s=>(u(),y(oe,{key:s.name,props:l},{default:n(()=>[U(j(s.label),1)]),_:2},1032,["props"]))),128)),i.config.option.val.id==3?(u(),y(oe,{key:0,"auto-width":""})):w("",!0)]),_:2},1032,["props"])]),body:n(l=>[o(te,{props:l},{default:n(()=>[(u(!0),B(O,null,G(l.cols,s=>(u(),y(le,{key:s.name,props:l},{default:n(()=>[U(j(s.value),1)]),_:2},1032,["props"]))),128)),i.config.option.val.id==3?(u(),y(le,{key:0,"auto-width":""},{default:n(()=>[o(k,{size:"sm",color:"negative",round:"",dense:"",onClick:s=>A(l.row),icon:"delete"},null,8,["onClick"])]),_:2},1024)):w("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})):w("",!0),i.config.option.val?(u(),y(Be,{key:2},{default:n(()=>[i.config.option.val.id==3?(u(),y($,{key:0,class:"row"},{default:n(()=>[o(ze,{class:"col",checkState:!0,onInput:E,onAgregar:F,with_locations_loc:S(g).session.credentials._rol},null,8,["with_locations_loc"]),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(k,{color:"primary",icon:"send",onClick:N})]),_:1})):w("",!0),i.config.option.val.id!=3?(u(),y($,{key:1},{default:n(()=>[o(k,{class:"full-width",color:"primary",label:"Crear Ciclico :p",onClick:N})]),_:1})):w("",!0)]),_:1})):w("",!0),o(ne,{modelValue:c.value.selectSection,"onUpdate:modelValue":e[9]||(e[9]=l=>c.value.selectSection=l),persistent:""},{default:n(()=>[o($,{style:{"min-width":"350px"}},{default:n(()=>[o(P,null,{default:n(()=>e[14]||(e[14]=[m("div",{class:"text-h6"},"Selecciona una Seccion",-1)])),_:1}),o(P,{class:"q-pt-none"},{default:n(()=>[o(q,{modelValue:i.config.section,"onUpdate:modelValue":e[8]||(e[8]=l=>i.config.section=l),options:S(r).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":""},null,8,["modelValue","options"])]),_:1}),o(H,{align:"right",class:"text-primary"},{default:n(()=>[be(o(k,{flat:"",onClick:L,icon:"send"},null,512),[[qe]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Re={class:"text-h6"},Ge={key:0,class:"row items-center"},Mo={__name:"CiclicosLayout",setup(i){h("");const p=re();se();const f=ie(),g=ae(),r=de(),d=h({state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}),x=h(!0),a=h({from:null,to:null}),c=h({sections:[],date:{from:null,to:null}}),v=async()=>{p.loading.show({message:"Cargado vista..."});let t=ce(new Date).format("YYYY/MM/DD");a.value={from:t,to:t};let e={store:g.session.store.id_viz,suc:g.session.store.id,date:a.value};const l=await z.index(e);l.fail?console.log(l):(console.log(l),r.setCyclecount(l.inventories),r.setUsers(l.colab),r.setSections(l.secciones),r.setLocations(l.locations),p.loading.hide())},V=W(()=>{const t=c.value.date;return t?typeof t=="string"?t.length>0:t.from&&t.to:!1}),Q=()=>{d.value={state:!1,type:{val:{id:2,label:"Ciego"},opts:[{id:1,label:"Normal"},{id:2,label:"Ciego"}]},option:{val:null,opts:[{id:1,label:"Ubicacion"},{id:2,label:"Sin Ubicacion"},{id:3,label:"Producto"}]},notes:null,resexh:[],resgen:[],section:null,products:[]}},D=async()=>{console.log(d.value),p.loading.show({message:"Creando Ciclicos"}),d.value._account=g.session.credentials.staff.id_va,d.value._workpoint=g.session.store.id_viz;const t=await z.addCyclecount(d.value);t.fail?console.log(t):(console.log(t),t.success&&(t.data.forEach(e=>r.addCyclecount(e.counter)),p.loading.hide(),Q()))},T=async()=>{p.loading.show({message:"Obteniendo Datos..."});let t={store:g.session.store.id_viz,suc:g.session.store.id,date:a.value};const e=await z.index(t);e.fail?console.log(e):(console.log(e),r.setCyclecount(e.inventories),r.setUsers(e.colab),r.setSections(e.secciones),r.setLocations(e.locations),p.loading.hide())},F=async()=>{p.loading.show({message:"Obteniendo Datos..."});let t={store:g.session.store.id_viz,params:c.value};console.log(t);const e=await z.productCyclecount(t);if(e.fail)console.log(e);else{console.log(e);let l="";const s=c.value.date;typeof s=="string"?l=`PSC_${s.replaceAll("/","_")}`:l=`PSC_${s.from.replaceAll("/","_")}_a_${s.to.replaceAll("/","-")}`;let I={key:l,value:e};Ne.conStockSinContar(I),p.loading.hide()}},E=t=>{console.log(t),p.notify({message:`El usuario ${t.me.names} Se Unio :)`,type:"positive",position:"top"})},L=t=>{console.log(t),r.lock(t.product.id,t)},M=t=>{console.log(t),r.unlock(t.product.id)},A=t=>{console.log(t),r.updateLockedProduct(t.product)},N=t=>{r.updateCyclecounts(t.counter),p.notify({message:`Termino el conteo ${t.user.me.names}`}),f.push("/ciclicos/counted")};return ye(()=>{v(),b.on("connect",()=>{r.socket_user&&b.emit("index",r.socket_user.profile)}),b.connect(),Ce(()=>r.socket_user.profile,t=>{t&&b.connected&&b.emit("index",t)},{immediate:!0}),b.on("joined",E),b.on("counting",L),b.on("cancelcounting",M),b.on("countingconfirmed",A),b.on("endingCounting",N)}),ke(()=>{b.off("joined",E),b.off("counting",L),b.off("cancelcounting",M),b.off("countingconfirmed",A),b.off("endingCounting",N)}),v(),(t,e)=>{const l=we("router-view");return u(),y(Ue,{view:"hHh Lpr fFf"},{default:n(()=>[o(fe,{class:"bg-grey-3 text-dark",bordered:""},{default:n(()=>[o(De),o(C)]),_:1}),o($e,null,{default:n(()=>[o(Ve,{class:"justify-between"},{default:n(()=>[m("div",null,[e[7]||(e[7]=m("span",{class:"text-grey"},"Helpers",-1)),e[8]||(e[8]=U()),o(xe,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=U()),m("span",Re,j(S(r).title),1)]),S(r).showBtns?(u(),B("div",Ge,[o(k,{color:"primary",icon:"event",flat:""},{default:n(()=>[o(Z,null,{default:n(()=>[o($,{class:"my-card"},{default:n(()=>[o(P,null,{default:n(()=>[m("div",null,[e[10]||(e[10]=m("div",{class:"q-pb-sm text-center"},null,-1)),o(K,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value=s),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(H,{vertical:"",align:"center"},{default:n(()=>[o(k,{flat:"",label:"Obtener",color:"positive",onClick:T})]),_:1})]),_:1})]),_:1})]),_:1}),o(k,{color:"primary",icon:"add_shopping_cart",dense:"",flat:""},{default:n(()=>[o(Z,null,{default:n(()=>[e[12]||(e[12]=m("div",{class:"q-pa-md"},"Productos Sin Conteo",-1)),o(C),o(P,null,{default:n(()=>[o(q,{modelValue:c.value.sections,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value.sections=s),options:S(r).sections,label:"Seccion",filled:"","option-label":"name",multiple:"","use-chips":"",dense:""},null,8,["modelValue","options"]),m("div",null,[e[11]||(e[11]=m("div",{class:"q-pb-sm text-center"},null,-1)),o(K,{modelValue:c.value.date,"onUpdate:modelValue":e[2]||(e[2]=s=>c.value.date=s),range:"",minimal:""},null,8,["modelValue"])])]),_:1}),o(H,{vertical:"",align:"center"},{default:n(()=>[o(k,{flat:"",label:"Obtener",color:"positive",onClick:F,disable:!c.value.sections.length||!V.value},null,8,["disable"])]),_:1})]),_:1})]),_:1}),o(C,{spaced:"",inset:"",vertical:"",dark:""}),o(k,{color:"primary",icon:"add",outline:"",onClick:e[3]||(e[3]=s=>d.value.state=!d.value.state)})])):w("",!0)]),_:1}),o(ne,{modelValue:d.value.state,"onUpdate:modelValue":e[6]||(e[6]=s=>d.value.state=s),persistent:"",maximized:x.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:n(()=>[o($,null,{default:n(()=>[o(je,null,{default:n(()=>[e[16]||(e[16]=m("div",{class:"text-center text-h6"},"Nuevo Inventario",-1)),o(Qe),o(k,{dense:"",flat:"",icon:"minimize",onClick:e[4]||(e[4]=s=>x.value=!1),disable:!x.value},{default:n(()=>[x.value?(u(),y(Y,{key:0},{default:n(()=>e[13]||(e[13]=[U("Minimize")])),_:1})):w("",!0)]),_:1},8,["disable"]),o(k,{dense:"",flat:"",icon:"crop_square",onClick:e[5]||(e[5]=s=>x.value=!0),disable:x.value},{default:n(()=>[x.value?w("",!0):(u(),y(Y,{key:0},{default:n(()=>e[14]||(e[14]=[U("Maximize")])),_:1}))]),_:1},8,["disable"]),o(k,{dense:"",flat:"",icon:"close",onClick:Q},{default:n(()=>[o(Y,null,{default:n(()=>e[15]||(e[15]=[U("Close")])),_:1})]),_:1})]),_:1}),o(Ye,{config:d.value,onCreate:D},null,8,["config"])]),_:1})]),_:1},8,["modelValue","maximized"]),o(l)]),_:1})]),_:1})}}};export{Mo as default};
