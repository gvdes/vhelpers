import{r as k,c as ce,o as P,a as I,w as a,h as j,u as pe,aD as ve,e,Q as m,f as H,i as d,a4 as u,a3 as i,Y as L,g as fe,a0 as me,a1 as ge,a2 as W,b2 as _e,a6 as he}from"./index.d5f50973.js";import{Q as we}from"./QToolbar.824680f5.js";import{Q as D}from"./QSeparator.5f295d7c.js";import{Q as xe}from"./QHeader.a42c1fd3.js";import{Q as C,a as r}from"./QItemSection.516a5973.js";import{Q as R}from"./QList.8104b91d.js";import{Q as T,a as Q}from"./QCard.70a1173a.js";import{Q as J}from"./QCardActions.b5daf9f8.js";import{Q as $}from"./QDialog.5b3742ec.js";import{Q as ye}from"./QFooter.b918b475.js";import{Q as be}from"./QPage.93c7127d.js";import{u as ke}from"./VDB.68ede9ab.js";import{u as Pe}from"./use-quasar.9cca4b66.js";import"./jspdf.plugin.autotable.3aa5fe5f.js";import{o as E}from"./outputsApi.c6355215.js";import{E as Y}from"./exceljs.min.9e24d01d.js";import"./browser.94c942de.js";import{P as Ce,d as Qe}from"./ProductsAutocomplete.a1264785.js";import"./QResizeObserver.1715da82.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.76bdd693.js";import"./axios.f1f32898.js";import"./QInput.b34b987f.js";import"./use-key-composition.f9415d84.js";import"./uid.42677368.js";import"./QSelect.3064671c.js";import"./position-engine.f258a937.js";import"./rtl.b51694b1.js";/* empty css                                                                         */const Ee={class:"row items-center"},Fe={class:"col"},Ve={class:"text-h6"},Ie={class:"text-center text-bold"},Se={class:"text-center text-bold row"},Be={class:"col"},Ne={class:"col"},Ae={class:"text-center text-h4"},De={class:"text-center text-h6 text-grey-14"},Re={class:"text-center"},Te={class:"q-pa-xs"},$e=d("div",{class:"text-bold text-h6"},"Cantidad:",-1),Oe={class:"row"},qe={class:"col column q-py-md"},_t={__name:"viewOutputs",setup(Ge){const N=pe(),F=ve(),_=ke(),n=Pe(),p=k(null),c=k([]),s=k({val:null,state:!1}),h=k({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),g=k({state:!1,encontrados:[],faltantes:[],products:null}),O=k(null),q=k(null),K=ce(()=>{var o;return((o=c.value)==null?void 0:o.filter(t=>{var l;return t.product==((l=s.value.val)==null?void 0:l.product)}).length)>0}),X=async()=>{n.loading.show({message:"Obteniendo datos"});const o=F.params.oid,t=await E.getOutput(o);t.fail?console.log(t):(console.log(t),n.loading.hide(),_.session.rol=="aud"||(_.session.rol=="aux"||_.session.rol=="gen")&&t.origin.id!==4&&t.destiny.id!==4||_.session.rol=="alm"&&([5,6].includes(t.destiny.id)||[5,6].includes(t.origin.id))?(p.value=t,c.value=t.bodie,console.log(p.value)):(N.push("/outputs"),n.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},Z=o=>{console.log(o)},ee=o=>{let t=c.value.findIndex(l=>l.product==o.code);console.log(t),t>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(s.value.val={product:o.code,description:o.description,amount:1},s.value.state=!0,console.log(o))},te=async()=>{n.loading.show({message:"Insertando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await E.addProduct(s.value.val);o.fail?console.log(o):(console.log(o),c.value.push(s.value.val),s.value={val:null,state:!1},n.loading.hide())},ae=async()=>{n.loading.show({message:"Editando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await E.editProduct(s.value.val);if(o.fail)console.log(o);else{console.log(o);let t=c.value.findIndex(l=>l.product==s.value.val.product);t>=0&&(c.value[t].amount=s.value.val.amount,n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},oe=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await E.removeProduct(s.value.val);if(o.fail)console.log(o);else{console.log(o);let t=c.value.findIndex(l=>l.product==s.value.val.product);t>=0&&(c.value.splice(t,1),n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},le=async()=>{n.loading.show({message:"Terminando Salida"});let o={user:_.session.name,output:p.value,products:c.value};console.log(o);const t=await E.endOutput(o);t.fail?console.log(t):(n.notify({message:t,position:"center",type:"positive"}),console.log(t),n.loading.hide(),N.push("/outputs"))},se=o=>{s.value.state=!0,s.value.val=o},G=()=>{s.value={val:null,state:!1}},ne=()=>{O.value.click()},ie=async()=>{let o=document.getElementById("inputFile").files[0],t=new Y.Workbook,l=[],w={};t.xlsx.load(o).then(U=>{let S=t.worksheets[0],y=S.getColumn("A");S.getColumn("B"),y.eachCell({includeEmpty:!0},function(f,x){let V=f.value,B=S.getCell(`B${x}`),A=parseFloat(B.value);w[V]?w[V]+=A:w[V]=A});let v=Object.keys(w).map(f=>({codigo:f,cantidad:w[f]}));if(v.forEach(f=>l.push(f.codigo)),l.length){let f={codes:l,_workpoint:_.session.store.id_viz};n.loading.show({message:"Procesando archivo, espera.."}),Qe.getMassive(f).then(x=>{let V=x.data;V.fails.notFound.map(b=>h.value.wndNotExist.push(b)),V.fails.repeat.map(b=>h.value.repeat.push(b));let B=x.data.products;h.value.wndGetRows=B.length,h.value.state=!h.value.state,console.log(B);let A=B.map(b=>{let z=v.find(ue=>ue.codigo===b.code);return{product:b.code,description:b.description,amount:z?z.cantidad:0,_output:F.params.oid}});M(A),n.loading.hide()}).catch(x=>{console.log(x),n.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},de=()=>{q.value.click()},re=async()=>{let o=document.getElementById("inputFilePreventa").files[0],t=new Y.Workbook,l=[];t.xlsx.load(o).then(async w=>{let S=t.worksheets[0].getColumn("A");if(n.loading.show({message:"Procesando archivo, espera.."}),S.eachCell({includeEmpty:!0},function(y,v){y.value&&l.push(y.value)}),l.length){let y={codes:l,_workpoint:_.session.store.id_viz};console.log(y);const v=await E.outputPreventa(y);if(v.fail)alert(v);else{g.value.encontrados=v.Encontrados,g.value.faltantes=v.Faltantes,g.value.products=v.products.length,g.value.state=!g.value.state,v.products.forEach(x=>x._output=F.params.oid);let f=v.products;console.log(f),M(f),n.loading.hide()}}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},M=async o=>{const t=await E.addProductMasive(o);t.fail?console.log(t):(console.log(t),o.map(l=>{c.value.push(l)}),n.loading.hide())};return _.session.rol=="root"||_.session.rol=="aud"?X():(n.notify({message:"No tienes acceso a esta pagina",type:"negative",position:"center"}),N.replace("/")),(o,t)=>p.value?(P(),I(be,{key:0,padding:""},{default:a(()=>[e(xe,{reveal:"",bordered:"",class:"bg-white text-black"},{default:a(()=>[e(we,{class:"justify-between"},{default:a(()=>[e(m,{color:"primary",icon:"arrow_back",flat:"",onClick:t[0]||(t[0]=l=>H(N).push("/transfers")),round:""}),d("div",null,u(p.value.store.name),1),d("div",Ee,[d("div",Fe,u(p.value.warehouse.name),1),i(),e(L,{name:"arrow_forward",class:"col"})]),d("div",null,u(p.value.created_by),1),d("div",null,[i("salida "),e(L,{name:"navigate_next",color:"primary"}),i(),d("span",Ve,u(p.value.code_fs),1)])]),_:1}),e(D),d("div",Ie,u(p.value.notes),1),e(D),d("div",Se,[d("div",Be,[e(m,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:ne})]),d("div",Ne,[e(m,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:de})]),d("input",{type:"file",ref_key:"inputFile",ref:O,id:"inputFile",onInput:ie,hidden:"",accept:".xlsx,.xls"},null,544),d("input",{type:"file",ref_key:"inputFilePreventa",ref:q,id:"inputFilePreventa",onInput:re,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1}),e(D,{spaced:"",inset:"",vertical:"",dark:""}),e(R,{bordered:""},{default:a(()=>[e(C,null,{default:a(()=>[e(r,null,{default:a(()=>[i(" Producto ")]),_:1}),e(r,null,{default:a(()=>[i(" Descripcion ")]),_:1}),e(r,{class:"text-center"},{default:a(()=>[i(" Cantidad ")]),_:1})]),_:1})]),_:1}),(P(!0),fe(ge,null,me(c.value,(l,w)=>(P(),I(R,{bordered:"",key:w},{default:a(()=>[W((P(),I(C,{clickable:"",onClick:U=>se(l)},{default:a(()=>[e(r,null,{default:a(()=>[i(u(l.product),1)]),_:2},1024),e(r,null,{default:a(()=>[i(u(l.description),1)]),_:2},1024),e(r,{class:"text-center"},{default:a(()=>[i(u(l.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[he]]),e(D)]),_:2},1024))),128)),e($,{modelValue:s.value.state,"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.state=l),persistent:"",position:"bottom"},{default:a(()=>[e(T,{style:{width:"300","max-width":"40vw"}},{default:a(()=>[e(Q,null,{default:a(()=>[d("div",Ae,u(s.value.val.product),1),d("div",De,u(s.value.val.description),1)]),_:1}),e(Q,null,{default:a(()=>[d("div",Re,[d("div",Te,[$e,d("div",Oe,[e(m,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:t[1]||(t[1]=l=>s.value.val.amount--)}),d("div",qe,[W(d("input",{type:"number",min:"1","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.val.amount=l),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[_e,s.value.val.amount]])]),e(m,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:t[3]||(t[3]=l=>s.value.val.amount++)})])])])]),_:1}),H(K)?(P(),I(J,{key:1,align:"center"},{default:a(()=>[e(m,{flat:"",icon:"close",color:"red-10",onClick:G}),e(m,{flat:"",label:"Eliminar",color:"negative",onClick:oe}),e(m,{flat:"",label:"Editar",color:"blue-10",onClick:ae})]),_:1})):(P(),I(J,{key:0,align:"center"},{default:a(()=>[e(m,{flat:"",label:"Cancelar",color:"negative",onClick:G}),e(m,{flat:"",label:"Agregar",color:"positive",onClick:te})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),e($,{modelValue:h.value.state,"onUpdate:modelValue":t[5]||(t[5]=l=>h.value.state=l)},{default:a(()=>[e(T,null,{default:a(()=>[e(Q,{class:"row text-bold text-overline text-center"},{default:a(()=>[i(" Resultados de la importacion :O ")]),_:1}),e(Q,null,{default:a(()=>[e(R,{bordered:""},{default:a(()=>[e(C,null,{default:a(()=>[e(r,null,{default:a(()=>[i("Productos Encontrados")]),_:1}),e(r,null,{default:a(()=>[i(u(h.value.wndGetRows),1)]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(r,null,{default:a(()=>[i("Productos Sin Datos")]),_:1}),e(r,null,{default:a(()=>[i(u(h.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e($,{modelValue:g.value.state,"onUpdate:modelValue":t[6]||(t[6]=l=>g.value.state=l)},{default:a(()=>[e(T,null,{default:a(()=>[e(Q,{class:"row text-bold text-overline text-center"},{default:a(()=>[i(" Resultados de la importacion :O ")]),_:1}),e(Q,null,{default:a(()=>[e(R,{bordered:""},{default:a(()=>[e(C,null,{default:a(()=>[e(r,null,{default:a(()=>[i("Pedidos Encontrados")]),_:1}),e(r,null,{default:a(()=>[i(u(g.value.encontrados),1)]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(r,null,{default:a(()=>[i("Pedidos Sin Encontrar")]),_:1}),e(r,null,{default:a(()=>[i(u(g.value.faltantes),1)]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(r,null,{default:a(()=>[i("Productos Encontrados")]),_:1}),e(r,null,{default:a(()=>[i(u(g.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ye,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:a(()=>[e(T,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:a(()=>[e(Q,{class:"row"},{default:a(()=>[e(Ce,{class:"col",checkState:!1,onInput:Z,onAgregar:ee}),c.value.length>0?(P(),I(m,{key:0,color:"primary",flat:"",icon:"east",onClick:le,round:""})):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)}};export{_t as default};
