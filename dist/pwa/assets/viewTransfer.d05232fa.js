import{a as fe,aH as pe,u as ve,r as A,c as me,o as S,d as V,w as l,h as H,e as t,Q as y,a1 as ge,f as i,a0 as p,ak as d,S as Y,g as xe,a2 as ye,a3 as _e,a4 as j,b9 as we,am as be}from"./index.d87ba090.js";import{Q as he}from"./QToolbar.df69cb8a.js";import{Q as N}from"./QSeparator.8a831898.js";import{Q as ke}from"./QHeader.b0ab2319.js";import{b as I,d as v,a as O,Q as U}from"./QList.9f6b0a46.js";import{Q}from"./QCardSection.f84172c8.js";import{Q as q}from"./QCardActions.fa9275b3.js";import{Q as R}from"./QCard.e3958f52.js";import{Q as Ce}from"./QFooter.40428a2b.js";import{Q as Pe}from"./QPage.ce47e99b.js";import{u as Ee}from"./use-quasar.eba3be69.js";import{d as Fe}from"./dayjs.min.cbcf888d.js";import{E as Ae,a as X}from"./jspdf.plugin.autotable.ea40903c.js";import{t as E}from"./transferApi.8555f5c6.js";import{E as W}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{P as Se,d as Ie}from"./ProductsAutocomplete.df4503f7.js";import"./use-dark.af54e05c.js";import"./QResizeObserver.76402ea5.js";import"./use-key-composition.3243082c.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.a1a5c455.js";import"./QInput.f6fa87e6.js";import"./QSelect.99543841.js";/* empty css                                                                         */const Qe={class:"row items-center"},Te={class:"col"},De={class:"col"},Ve={class:"text-h6"},Ne={class:"text-center text-bold"},Oe={class:"text-center text-bold row"},Re={class:"col"},$e={class:"col"},Ue={class:"col"},Be={class:"text-center text-h4"},Me={class:"text-center text-h6 text-grey-14"},ze={class:"text-center"},Ge={class:"q-pa-xs"},Le={class:"row"},He={class:"col column q-py-md"},_t={__name:"viewTransfer",setup(Ye){const $=fe(),F=pe(),_=ve(),r=Ee(),m=A(null),n=A({val:null,state:!1}),g=A([]),b=A({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),w=A({state:!1,encontrados:[],faltantes:[],products:null}),B=A(null),M=A(null),J=me(()=>{var s;return((s=g.value)==null?void 0:s.filter(e=>{var o;return e.product==((o=n.value.val)==null?void 0:o.product)}).length)>0}),Z=async()=>{const s=F.params.oid,e=await E.getTransfer(s);e.fail?console.log(e):(console.log(e),_.session.rol=="aud"||_.session.rol=="root"||_.session.rol=="audc"||(_.session.rol=="aux"||_.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||_.session.rol=="alm"||_.session.rol=="vld"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(m.value=e,g.value=e.bodie,console.log(m.value)):($.push("/transfers"),r.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},K=s=>{console.log(s)},ee=s=>{let e=g.value.findIndex(o=>o.product==s.code);console.log(e),e>=0?r.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(n.value.val={product:s.code,description:s.description,amount:1},n.value.state=!0,console.log(s))},te=async()=>{r.loading.show({message:"Insertando Producto"}),console.log(n.value.val),n.value.val._transfer=F.params.oid;const s=await E.addProduct(n.value.val);s.fail?console.log(s):(console.log(s),g.value.push(n.value.val),n.value={val:null,state:!1},r.loading.hide())},le=async()=>{r.loading.show({message:"Editando Producto"}),console.log(n.value.val),n.value.val._transfer=F.params.oid;const s=await E.editProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value[e].amount=n.value.val.amount,r.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},r.loading.hide())}},ae=async()=>{r.loading.show({message:"Eliminando Producto"}),console.log(n.value.val),n.value.val._transfer=F.params.oid;const s=await E.removeProduct(n.value.val);if(s.fail)console.log(s);else{console.log(s);let e=g.value.findIndex(o=>o.product==n.value.val.product);e>=0&&(g.value.splice(e,1),r.notify({type:"positive",position:"center"}),n.value={val:null,state:!1},r.loading.hide())}},oe=s=>{n.value.state=!0,n.value.val=s},z=()=>{n.value={val:null,state:!1}},se=async()=>{r.loading.show({message:"Terminando Traspaso"});let s={user:_.session.name,traspaso:m.value,products:g.value};const e=await E.endTransfer(s);e.fail?console.log(e):(r.notify({message:e,position:"center",type:"positive"}),console.log(e),r.loading.hide(),$.push("/transfers"))},ne=()=>{B.value.click()},ie=async()=>{let s=document.getElementById("inputFile").files[0],e=new W.Workbook,o=[],a={};e.xlsx.load(s).then(T=>{let h=e.worksheets[0],k=h.getColumn("A");h.getColumn("B"),k.eachCell({includeEmpty:!0},function(x,f){let C=x.value,P=h.getCell(`B${f}`),D=parseFloat(P.value);a[C]?a[C]+=D:a[C]=D});let c=Object.keys(a).map(x=>({codigo:x,cantidad:a[x]}));if(c.forEach(x=>o.push(x.codigo)),o.length){let x={codes:o,_workpoint:_.session.store.id_viz};r.loading.show({message:"Procesando archivo, espera.."}),Ie.getMassive(x).then(f=>{let C=f.data;C.fails.notFound.map(u=>b.value.wndNotExist.push(u)),C.fails.repeat.map(u=>b.value.repeat.push(u));let P=f.data.products;b.value.wndGetRows=P.length,b.value.state=!b.value.state,console.log(P);let D=P.map(u=>{let L=c.find(ce=>ce.codigo===u.code);return{product:u.code,description:u.description,amount:L?L.cantidad:0,_transfer:F.params.oid}});G(D),r.loading.hide()}).catch(f=>{console.log(f),r.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},re=()=>{M.value.click()},de=async()=>{let s=document.getElementById("inputFilePreventa").files[0],e=new W.Workbook,o=[];e.xlsx.load(s).then(async a=>{let h=e.worksheets[0].getColumn("A");if(r.loading.show({message:"Procesando archivo, espera.."}),h.eachCell({includeEmpty:!0},function(k,c){k.value&&o.push(k.value)}),o.length){let k={codes:o,_workpoint:_.session.store.id_viz};console.log(k);const c=await E.transferPreventa(k);if(c.fail)alert(c);else{w.value.encontrados=c.Encontrados,w.value.faltantes=c.Faltantes,w.value.products=c.products.length,w.value.state=!w.value.state,c.products.forEach(f=>f._transfer=F.params.oid);let x=c.products;console.log(x),G(x),r.loading.hide()}}else r.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},G=async s=>{const e=await E.addProductMasive(s);e.fail?console.log(e):(console.log(e),s.map(o=>{g.value.push(o)}),r.loading.hide())},ue=async()=>{const s=F.params.oid,e=await E.getTransfer(s);if(console.log(e),e.error)console.error("No se logro imprimir la factura");else{const a=new Ae({format:"letter"});let T=[];const h=e.bodie.map(c=>Object.values([c.product,c.description,c.amount]));console.log(typeof e.code_fs);const k=Math.ceil(h.length/20);for(var o=0;o<h.length;o+=20)T.push(h.slice(o,o+20));console.log(T);for(let c=0;c<2;c++){let x="ORIGINAL";c>0&&(x="COPIA",a.addPage()),T.forEach(function(f,C){C>0&&a.addPage();let P=0;for(let u=0;u<f.length;u++)f[u][0]=f[u][0],f[u][1]=f[u][1],f[u][2]=parseFloat(f[u][2]),P+=parseFloat(f[u][2]);for(let u=0;u<f.length;u++);a.setFontSize(25),a.setFont("helvetica","bold"),a.text("GRUPO VIZCARRA",105,10,"center"),a.setFontSize(8),a.setFontSize(12),a.text(x,185,10,"left"),a.text("LLUVIA LIGTH SA DE CV",10,25,"left"),a.setFontSize(8),a.text(e.created_by,10,30,"left"),a.text(e.notes,10,35,"left"),a.text("DELEG, CUAUHTEMOC CDMX",10,40,"left"),a.text("DOCUMENTO",10,55,"left"),a.text("TRASPASO",10,60,"left"),a.text("NUMERO",32,55,"left"),a.text(String(e.code_fs),32,60,"left"),a.text("PAGINA",54,55,"left"),a.text(`${C+1} de ${k}`,54,60,"left"),a.text("FECHA",76,55,"left");const D=Fe(e.created_at).format("YYYY-MM-DD");a.text(D,76,60,"left"),X(a,{startX:10,startY:65,theme:"plain",styles:{cellPadding:1,fontSize:12,halign:"center"},head:[["Almacen de Origen","Almacen de Destino"]],body:[[`(${e.origin.alias}) ${e.origin.name}`,`(${e.destiny.alias}) ${e.destiny.name}`]]}),X(a,{startX:10,startY:80,theme:"striped",styles:{cellPadding:.6,fontSize:8,halign:"center"},head:[["ARTICULO","DESCRIPCION","CANTIDAD"]],body:f,columnStyles:{0:{fontStyle:"bold",halign:"left"},1:{fontStyle:"bold",halign:"left"},4:{halign:"center"}}}),a.setFontSize(11),a.text("TOTAL UNIDDADES:",150,200,"left"),a.text(P.toString(),190,200,"left"),a.text("Firma Almacen Origen",12,224),a.text("Firma Almacen Destino",82,224),a.text("Firma Chofer",152,224),a.rect(10,220,60,40),a.rect(80,220,60,40),a.rect(150,220,60,40)})}a.save(`Traspaso${e.code_fs}`)}};return Z(),(s,e)=>m.value?(S(),V(Pe,{key:0,padding:""},{default:l(()=>[t(ke,{reveal:"",bordered:"",class:"bg-white text-black"},{default:l(()=>[t(he,{class:"justify-between"},{default:l(()=>[t(y,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=o=>ge($).push("/transfers")),round:""}),i("div",null,p(m.value.store.name),1),i("div",Qe,[i("div",Te,p(m.value.origin.name),1),e[7]||(e[7]=d()),t(Y,{name:"arrow_forward",class:"col"}),i("div",De,p(m.value.destiny.name),1)]),i("div",null,p(m.value.created_by),1),i("div",null,[e[8]||(e[8]=d("Traspaso ")),t(Y,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=d()),i("span",Ve,p(m.value.code_fs),1)])]),_:1}),t(N),i("div",Ne,p(m.value.notes),1),t(N),i("div",Oe,[i("div",Re,[t(y,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:ne})]),i("div",$e,[t(y,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:re})]),i("div",Ue,[t(y,{color:"primary",icon:"picture_as_pdf",label:"PDF",flat:"",onClick:ue})]),i("input",{type:"file",ref_key:"inputFile",ref:B,id:"inputFile",onInput:ie,hidden:"",accept:".xlsx,.xls"},null,544),i("input",{type:"file",ref_key:"inputFilePreventa",ref:M,id:"inputFilePreventa",onInput:de,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(O,{bordered:""},{default:l(()=>[t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[10]||(e[10]=[d(" Producto ")])),_:1}),t(v,null,{default:l(()=>e[11]||(e[11]=[d(" Descripcion ")])),_:1}),t(v,{class:"text-center"},{default:l(()=>e[12]||(e[12]=[d(" Cantidad ")])),_:1})]),_:1})]),_:1}),(S(!0),xe(_e,null,ye(g.value,(o,a)=>(S(),V(O,{bordered:"",key:a},{default:l(()=>[j((S(),V(I,{clickable:"",onClick:T=>oe(o)},{default:l(()=>[t(v,null,{default:l(()=>[d(p(o.product),1)]),_:2},1024),t(v,null,{default:l(()=>[d(p(o.description),1)]),_:2},1024),t(v,{class:"text-center"},{default:l(()=>[d(p(o.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[be]]),t(N)]),_:2},1024))),128)),t(U,{modelValue:n.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.state=o),persistent:"",position:"bottom"},{default:l(()=>[t(R,{style:{width:"300","max-width":"40vw"}},{default:l(()=>[t(Q,null,{default:l(()=>[i("div",Be,p(n.value.val.product),1),i("div",Me,p(n.value.val.description),1)]),_:1}),t(Q,null,{default:l(()=>[i("div",ze,[i("div",Ge,[e[13]||(e[13]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",Le,[t(y,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=o=>n.value.val.amount>1?n.value.val.amount--:"")}),i("div",He,[j(i("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=o=>n.value.val.amount=o),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[we,n.value.val.amount]])]),t(y,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=o=>n.value.val.amount++)})])])])]),_:1}),J.value?(S(),V(q,{key:1,align:"center"},{default:l(()=>[t(y,{flat:"",icon:"close",color:"red-10",onClick:z}),t(y,{flat:"",label:"Eliminar",color:"negative",onClick:ae}),t(y,{flat:"",label:"Editar",color:"blue-10",onClick:le})]),_:1})):(S(),V(q,{key:0,align:"center"},{default:l(()=>[t(y,{flat:"",label:"Cancelar",color:"negative",onClick:z}),t(y,{flat:"",label:"Agregar",color:"positive",onClick:te})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:b.value.state,"onUpdate:modelValue":e[5]||(e[5]=o=>b.value.state=o)},{default:l(()=>[t(R,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[14]||(e[14]=[d(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(O,{bordered:""},{default:l(()=>[t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[15]||(e[15]=[d("Productos Encontrados")])),_:1}),t(v,null,{default:l(()=>[d(p(b.value.wndGetRows),1)]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[16]||(e[16]=[d("Productos Sin Datos")])),_:1}),t(v,null,{default:l(()=>[d(p(b.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:w.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>w.value.state=o)},{default:l(()=>[t(R,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[17]||(e[17]=[d(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(O,{bordered:""},{default:l(()=>[t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[18]||(e[18]=[d("Pedidos Encontrados")])),_:1}),t(v,null,{default:l(()=>[d(p(w.value.encontrados),1)]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[19]||(e[19]=[d("Pedidos Sin Encontrar")])),_:1}),t(v,null,{default:l(()=>[d(p(w.value.faltantes),1)]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(v,null,{default:l(()=>e[20]||(e[20]=[d("Productos Encontrados")])),_:1}),t(v,null,{default:l(()=>[d(p(w.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ce,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:l(()=>[t(R,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:l(()=>[t(Q,{class:"row"},{default:l(()=>[t(Se,{class:"col",checkState:!1,onInput:K,onAgregar:ee}),g.value.length>0?(S(),V(y,{key:0,color:"primary",flat:"",icon:"east",onClick:se,round:""})):H("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0)}};export{_t as default};
