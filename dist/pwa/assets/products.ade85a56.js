import{Q as ke}from"./QRadio.6c6f8b32.js";import{Q as de}from"./QCheckbox.b8d8da30.js";import{Q as he}from"./QToggle.1e3c8985.js";import{i as ue,aL as we,c as C,j as R,t as ce,D as Ve,E as X,F as Ce,k as Qe,r as F,o as y,g as $,a3 as K,a2 as Y,e as t,f as d,Q as V,u as Pe,d as E,w as a,h as L,ak as I,S as Se,a0 as w,al as Fe,a4 as ne}from"./index.7472d83d.js";import{i as $e,j as qe}from"./use-key-composition.b69e4e32.js";import{b as N,a as Z,d as ee,e as H,Q as te}from"./QList.29a048b6.js";import{Q as O}from"./QCardSection.a4068b08.js";import{Q as ae,a as z,q as Oe}from"./QSelect.9c578d5e.js";import{Q as J}from"./QCard.18c8f449.js";import{Q as De}from"./QInput.59f6bdda.js";import{Q as le}from"./QCardActions.ba667a3f.js";import{Q as Le}from"./QBtnGroup.4ed35f96.js";import{Q as Ne}from"./QTable.6668f00f.js";import{Q as Ae}from"./QPage.bc8dee7f.js";import{C as ie}from"./ClosePopup.36a74c4f.js";import"./QDrawer.674253bc.js";import"./axios.63470db7.js";import{u as Ee}from"./use-quasar.532a0fa7.js";import{P as Ie,d as Be}from"./ProductsAutocomplete.ad75d7ac.js";import{_ as Ue}from"./OptionsLabels.7f303ded.js";import{l as re}from"./locationsApi.de49e45c.js";import{E as Te}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import"./jspdf.plugin.autotable.eb306cb6.js";import"./dayjs.min.cbcf888d.js";import"./QLinearProgress.4072f959.js";import"./QResizeObserver.e5b50475.js";import"./QScrollObserver.e57aa4c3.js";/* empty css                                                                         */import"./QImg.c1a849ff.js";import"./labels.76113388.js";import"./_commonjsHelpers.88e99c8f.js";const pe={radio:ke,checkbox:de,toggle:he},ze=Object.keys(pe);function oe(o,x){if(typeof o=="function")return o;const i=o!==void 0?o:x;return c=>c[i]}var Re=ue({name:"QOptionGroup",props:{...$e,modelValue:{required:!0},options:{type:Array,validator:o=>o.every(we),default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],name:String,type:{type:String,default:"radio",validator:o=>ze.includes(o)},color:String,keepColor:Boolean,dense:Boolean,size:String,leftLabel:Boolean,inline:Boolean,disable:Boolean},emits:["update:modelValue"],setup(o,{emit:x,slots:i}){const{proxy:{$q:c}}=ce(),Q=Array.isArray(o.modelValue);o.type==="radio"?Q===!0&&console.error("q-option-group: model should not be array"):Q===!1&&console.error("q-option-group: model should be array in your case");const g=qe(o,c),P=C(()=>pe[o.type]),k=C(()=>oe(o.optionValue,"value")),v=C(()=>oe(o.optionLabel,"label")),_=C(()=>oe(o.optionDisable,"disable")),b=C(()=>o.options.map(n=>({val:k.value(n),name:n.name===void 0?o.name:n.name,disable:o.disable||_.value(n),leftLabel:n.leftLabel===void 0?o.leftLabel:n.leftLabel,color:n.color===void 0?o.color:n.color,checkedIcon:n.checkedIcon,uncheckedIcon:n.uncheckedIcon,dark:n.dark===void 0?g.value:n.dark,size:n.size===void 0?o.size:n.size,dense:o.dense,keepColor:n.keepColor===void 0?o.keepColor:n.keepColor}))),r=C(()=>"q-option-group q-gutter-x-sm"+(o.inline===!0?" q-option-group--inline":"")),h=C(()=>{const n={role:"group"};return o.type==="radio"&&(n.role="radiogroup",o.disable===!0&&(n["aria-disabled"]="true")),n});function u(n){x("update:modelValue",n)}return()=>R("div",{class:r.value,...h.value},o.options.map((n,S)=>{const j=i["label-"+S]!==void 0?()=>i["label-"+S](n):i.label!==void 0?()=>i.label(n):void 0;return R("div",[R(P.value,{label:j===void 0?v.value(n):null,modelValue:o.modelValue,"onUpdate:modelValue":u,...b.value[S]},j)])}))}});const je={position:{type:String,default:"bottom-right",validator:o=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(o)},offset:{type:Array,validator:o=>o.length===2},expand:Boolean};function Ge(){const{props:o,proxy:{$q:x}}=ce(),i=Ve(Ce,X);if(i===X)return console.error("QPageSticky needs to be child of QLayout"),X;const c=C(()=>{const r=o.position;return{top:r.indexOf("top")!==-1,right:r.indexOf("right")!==-1,bottom:r.indexOf("bottom")!==-1,left:r.indexOf("left")!==-1,vertical:r==="top"||r==="bottom",horizontal:r==="left"||r==="right"}}),Q=C(()=>i.header.offset),g=C(()=>i.right.offset),P=C(()=>i.footer.offset),k=C(()=>i.left.offset),v=C(()=>{let r=0,h=0;const u=c.value,n=x.lang.rtl===!0?-1:1;u.top===!0&&Q.value!==0?h=`${Q.value}px`:u.bottom===!0&&P.value!==0&&(h=`${-P.value}px`),u.left===!0&&k.value!==0?r=`${n*k.value}px`:u.right===!0&&g.value!==0&&(r=`${-n*g.value}px`);const S={transform:`translate(${r}, ${h})`};return o.offset&&(S.margin=`${o.offset[1]}px ${o.offset[0]}px`),u.vertical===!0?(k.value!==0&&(S[x.lang.rtl===!0?"right":"left"]=`${k.value}px`),g.value!==0&&(S[x.lang.rtl===!0?"left":"right"]=`${g.value}px`)):u.horizontal===!0&&(Q.value!==0&&(S.top=`${Q.value}px`),P.value!==0&&(S.bottom=`${P.value}px`)),S}),_=C(()=>`q-page-sticky row flex-center fixed-${o.position} q-page-sticky--${o.expand===!0?"expand":"shrink"}`);function b(r){const h=Qe(r.default);return R("div",{class:_.value,style:v.value},o.expand===!0?h:[R("div",h)])}return{$layout:i,getStickyContent:b}}var Me=ue({name:"QPageSticky",props:je,setup(o,{slots:x}){const{getStickyContent:i}=Ge();return()=>i(x)}});const He={class:"text-right"},Je={__name:"selectsLocations",props:{sections:{default:[],type:Array}},emits:["obtProducts"],setup(o,{emit:x}){const i=o,c=x,Q=v=>i.sections.filter(_=>_.root===v),g=F([{options:i.sections.filter(v=>v.root===0),selected:null}]),P=(v,_)=>{g.value.splice(_+1);const b=Q(v);b.length&&g.value.push({options:b,selected:null})},k=()=>{const v=g.value.filter(b=>b.selected!==null),_=v[v.length-1];c("obtProducts",_)};return(v,_)=>(y(),$("div",null,[(y(!0),$(K,null,Y(g.value,(b,r)=>(y(),$("div",{key:r},[t(ae,{modelValue:b.selected,"onUpdate:modelValue":[h=>b.selected=h,h=>P(h,r)],options:b.options,label:`Nivel ${r+1}`,"option-value":"id","option-label":"name","emit-value":"","map-options":"",dense:"",filled:""},null,8,["modelValue","onUpdate:modelValue","options","label"]),t(N,{spaced:"",inset:"",vertical:"",dark:""})]))),128)),d("div",He,[t(V,{flat:"",icon:"send",disable:!g.value[0].selected,onClick:k},null,8,["disable"])])]))}},Ke={class:"text-center"},Ye={class:"row text-center"},We={key:0,class:"col"},Xe={class:"row"},Ze={class:"row"},et={key:0,class:"col"},tt={key:1,class:"col"},lt={key:0,class:"row"},ot={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},at={class:"text-h5 text-bold text-center"},st={class:"text-subtitle2 text-bold text-center"},nt={class:"text-subtitle2 text-bold text-center"},it={class:"text-subtitle2 text-bold text-center"},rt={class:"text-subtitle2 text-bold text-center"},dt={class:"row"},ut={class:"text-center"},ct={class:"text-center"},pt={class:"text-bold q-pb-sm text-center"},vt={class:"row q-pt-xs"},ft={class:"text-negative"},Jt={__name:"products",setup(o){const x=Pe(),i=Ee(),c=F([]),Q=F([]),g=F(null),P=F(!1),k=F({val:{id:1,label:"Productos"},opts:[{id:1,label:"Productos"},{id:2,label:"Ubicacion"}]}),v=F({filter:"",pagination:{rowsPerPage:9}}),_=F({state:!1}),b=F({state:!1}),r=F({val:[0,1,2,4],opts:[{label:"Menudeo",value:1},{label:"Mayoreo",value:2},{label:"Docena",value:3},{label:"Caja",value:4}]}),h=F(null),u=F({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[]}),n=s=>{let l=[],e=[],p=new Object;return s.products.map(f=>S(f.prices)?l.push(f):e.push(f)),console.log(s),p.notFound=l,p.add=e,p},S=s=>{let l=!0;return s.map((e,p)=>{l=e.pivot.price==0}),l},j=s=>{console.log(s);let l=c.value.findIndex(e=>e.id==s.id);if(console.log(l),l>=0)c.value[l]._copies++;else{let e=G(s.prices,s.pieces);s._copies=1,s.type=e.type,s.usedPrices=e.prices,s._copies=1,c.value.push(s),console.log(s)}},ve=s=>{console.log(s);let l=c.value.findIndex(e=>e.id==s.id);if(console.log(l),l>=0)c.value[l]._copies++;else{let e=G(s.prices,s.pieces);s._copies=1,s.type=e.type,s.usedPrices=e.prices,s._copies=1,c.value.push(s),console.log(s)}},fe=s=>{let l=c.value.findIndex(e=>e.id==s.id);c.value.splice(l,1)},me=()=>{c.value=[],_.value.state=!1},ge=()=>{h.value.click()},be=async()=>{let s=document.getElementById("inputFile").files[0],l=new Te.Workbook,e=[],p=[],f=0;l.xlsx.load(s).then(m=>{if(l.worksheets[0].getColumn("A").eachCell({includeEmpty:!0},function(D,A){D.value&&e.push(D.value)}),p=e.filter((D,A,T)=>T.indexOf(D)==A),e.length){let D={codes:e,_workpoint:x.session.store.id_viz};console.log(D),i.loading.show({message:"Procesando archivo, espera.."}),Be.getMassive(D).then(A=>{let T=A.data,W=0,M=n(T);if(T.fails.notFound.map(q=>u.value.wndNotExist.push(q)),u.value.wndGetRows=M.add.length,u.value.state=!u.value.state,u.value.wndGetAdded=M.add,u.value.wndNoDataFound=M.notFound,u.value.wndNoDataFound.length>0){let q=u.value.wndNoDataFound.length;u.value.message=q<=1?"El producto no contiene precios.":"Los productos no contienen precios."}M.add.map(q=>{let se=G(q.prices,q.pieces);q._copies=1,q.type=se.type,q.usedPrices=se.prices,c.value.push(q),W++}),W&&!T.fails.notFound.length&&p.length==e.length?i.notify({message:`Etiquetas generadas: ${W}`,color:"positive",icon:"done",timeout:1e3}):(f=e.length-p.length,u.value.messageRepeat=f<=1?`${f} producto se repitio. Favor de validar su documento antes de subirlo.`:`${f} productos se repitieron. Favor de validar su documento antes de subirlo.`),console.log(u.value),i.loading.hide()}).catch(A=>{console.log(A),i.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else i.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},G=(s,l)=>{let e=[...s];e.sort((m,B)=>m.pivot._type-B.pivot._type),console.log(e);const p=e.find(m=>m.pivot._type==4),f=e.find(m=>m.pivot._type==1);if(p.pivot.price==f.pivot.price){let m={id:0,alias:"OFERTA",name:"Oferta",pivot:{price:e[0].pivot.price},used:!0};return console.log("oferta"),{type:"off",prices:[m]}}else return console.log("estandar"),{type:"std",prices:e}},ye=s=>{switch(s){case"off":return"orange-9";case"std":return"green-9"}},_e=async()=>{if(k.value.val.id==2){i.loading.show({message:"Obteniendo Secciones"});const s=await re.index(x.session.store.id_viz);s.fail?console.log(s):(console.log(s),Q.value=s),i.loading.hide()}},xe=async s=>{i.loading.show({message:"Obteniendo Productos"});let l={section:s.selected,workpoint:x.session.store.id_viz,update:P.value};const e=await re.obtProductSections(l);if(e.fail)console.log(e);else{console.log(e);let p={products:e};p.products.length>0?(n(p).add.map(m=>{let B=c.value.findIndex(U=>U.id==m.id);if(B>=0)c.value[B]._copies++;else{let U=G(m.prices,m.pieces);m._copies=1,m.type=U.type,m.usedPrices=U.prices,c.value.push(m)}}),i.loading.hide()):(i.loading.hide(),i.notify({message:"No Hay Articulos Ubicados x(",type:"negative",position:"center",icon:"mood_bad"}))}};return(s,l)=>(y(),E(Ae,{padding:""},{default:a(()=>[t(J,{class:"my-card"},{default:a(()=>[t(O,null,{default:a(()=>[d("div",Ke,[l[10]||(l[10]=d("div",{class:"text-bold"},"Selecciona los Precios",-1)),t(Re,{options:r.value.opts,type:"toggle",modelValue:r.value.val,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value.val=e),inline:""},null,8,["options","modelValue"])]),d("div",Ye,[t(V,{class:"col",outline:"",color:"primary",icon:"upload_file",title:"Subir Etiquetas",onClick:ge}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),c.value.length>0?(y(),$("div",We,[d("div",Xe,[t(V,{class:"col",outline:"",color:"primary",icon:"delete",title:"Eliminar Etiquetas",onClick:l[1]||(l[1]=e=>_.value.state=!_.value.state)}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(V,{class:"col",outline:"",color:"primary",icon:"download",title:"Descargar Etquetas",onClick:l[2]||(l[2]=e=>b.value.state=!b.value.state)})])])):L("",!0)]),d("input",{type:"file",ref_key:"inputFile",ref:h,id:"inputFile",onInput:be,hidden:"",accept:".xlsx,.xls"},null,544)]),_:1}),t(O,null,{default:a(()=>[d("div",Ze,[t(ae,{style:{width:"80px"},modelValue:k.value.val,"onUpdate:modelValue":[l[3]||(l[3]=e=>k.value.val=e),_e],options:k.value.opts,filled:"",dense:"","hide-dropdown-icon":""},null,8,["modelValue","options"]),t(N,{spaced:"",inset:"",vertical:"",dark:""}),k.value.val.id==1?(y(),$("div",et,[t(Ie,{onInput:j,onAgregar:ve,with_prices:""})])):L("",!0),k.value.val.id==2?(y(),$("div",tt,[Q.value.length>0?(y(),$("div",lt,[t(Z,{dense:""},{default:a(()=>[t(ee,null,{default:a(()=>[t(H,null,{default:a(()=>[t(z,{caption:""},{default:a(()=>l[11]||(l[11]=[I("ACT HOY")])),_:1}),t(z,{class:"flex flex-center"},{default:a(()=>[t(de,{dense:"",modelValue:P.value,"onUpdate:modelValue":l[4]||(l[4]=e=>P.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ae,{class:"col",modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=e=>g.value=e),options:Q.value,label:"ALMACEN",filled:"",optionLabel:"name",dense:""},null,8,["modelValue","options"]),t(N,{spaced:"",inset:"",vertical:"",dark:""}),g.value?(y(),E(Je,{key:0,sections:g.value.sections,onObtProducts:xe},null,8,["sections"])):L("",!0)])):L("",!0)])):L("",!0)])]),_:1})]),_:1}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(Ne,{rows:c.value,"row-key":"name",grid:"",filter:v.value.filter,pagination:v.value.pagination,"no-data-label":"''"},{"top-right":a(()=>[t(De,{borderless:"",dense:"",debounce:"300",modelValue:v.value.filter,"onUpdate:modelValue":l[6]||(l[6]=e=>v.value.filter=e),placeholder:"Buscar"},{append:a(()=>[t(Se,{name:"search"})]),_:1},8,["modelValue"])]),item:a(e=>[d("div",ot,[t(J,{class:"my-card"},{default:a(()=>[t(O,null,{default:a(()=>{var p;return[t(Oe,{size:"sm",class:"fixed-right absolute-right text-bold text-white text-uppercase",color:ye(e.row.type)},{default:a(()=>[I(w(e.row.type),1)]),_:2},1032,["color"]),d("div",at,w(e.row.code),1),d("div",st,w(e.row.name),1),d("div",nt,w(e.row.label),1),d("div",it,"Longitud: "+w(e.row.large),1),d("div",rt,"Ubicacion: "+w((p=e.row.locations)==null?void 0:p.map(f=>f.path).join("/")),1),t(N,{spaced:"",inset:"",vertical:"",dark:""}),d("div",dt,[(y(!0),$(K,null,Y(e.row.usedPrices.filter(f=>r.value.val.includes(f.id)),(f,m)=>(y(),$("div",{class:"col items-start",key:m},[d("div",ut,w(f.alias),1),d("div",ct,w(f.pivot.price),1)]))),128))])]}),_:2},1024),t(le,{align:"center"},{default:a(()=>[t(V,{flat:"",icon:"delete",color:"negative",onClick:p=>fe(e.row)},null,8,["onClick"]),t(V,{flat:"",icon:"add",onClick:p=>e.row._copies++},null,8,["onClick"]),d("div",null,[l[12]||(l[12]=d("div",{class:"text-caption text--2"},"copias",-1)),d("div",pt,w(e.row._copies),1)]),t(V,{flat:"",icon:"remove",onClick:p=>e.row._copies<=1?"":e.row._copies--},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),bottom:a(e=>[t(Me,{position:"bottom",class:"full-width",offset:[0,18]},{default:a(()=>[d("div",vt,[t(Le,{rounded:"",flat:"",color:"primary"},{default:a(()=>[e.pagesNumber>2?(y(),E(V,{key:0,icon:"first_page",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage,class:"q-px-sm"},null,8,["disable","onClick"])):L("",!0),t(V,{icon:"chevron_left",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage,class:"q-px-sm"},null,8,["disable","onClick"]),t(V,{flat:"",disable:"","no-caps":""},{default:a(()=>[I(w(e.pagination.page)+" / "+w(e.pagesNumber),1)]),_:2},1024),t(V,{icon:"chevron_right",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage,class:"q-px-sm"},null,8,["disable","onClick"]),e.pagesNumber>2?(y(),E(V,{key:1,icon:"last_page",round:"",dense:"",flat:"",onClick:e.lastPage,class:"q-px-sm"},null,8,["onClick"])):L("",!0)]),_:2},1024)])]),_:2},1024)]),"no-data":a(()=>l[13]||(l[13]=[])),_:1},8,["rows","filter","pagination"]),t(te,{modelValue:_.value.state,"onUpdate:modelValue":l[7]||(l[7]=e=>_.value.state=e),persistent:""},{default:a(()=>[t(J,null,{default:a(()=>[t(O,{class:"row items-center"},{default:a(()=>[t(Fe,{icon:"warning",color:"white","text-color":"negative"}),l[14]||(l[14]=d("div",{class:"q-ml-sm"},"Se eliminaran todos los articulos de la lista ",-1))]),_:1}),t(O,null,{default:a(()=>l[15]||(l[15]=[d("div",{class:"q-ml-sm"},"Deseas Continuar?",-1)])),_:1}),t(le,{align:"right"},{default:a(()=>[ne(t(V,{flat:"",label:"No",color:"positive"},null,512),[[ie]]),t(V,{flat:"",label:"Si",color:"negative",onClick:me})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:b.value.state,"onUpdate:modelValue":l[8]||(l[8]=e=>b.value.state=e),persistent:""},{default:a(()=>[t(Ue,{products:c.value,prices:r.value},null,8,["products","prices"])]),_:1},8,["modelValue"]),t(te,{modelValue:u.value.state,"onUpdate:modelValue":l[9]||(l[9]=e=>u.value.state=e)},{default:a(()=>[t(J,{class:"my-card",style:{width:"70%"}},{default:a(()=>[t(O,{class:"items-center"},{default:a(()=>[l[16]||(l[16]=d("div",{class:"text-center text-bold"},"Repetidos",-1)),d("div",ft,w(u.value.messageRepeat),1)]),_:1}),t(O,null,{default:a(()=>[l[17]||(l[17]=d("div",{class:"text-center"},"Productos Sin Precio",-1)),t(Z,null,{default:a(()=>[(y(!0),$(K,null,Y(u.value.wndNoDataFound,(e,p)=>(y(),E(ee,{key:p},{default:a(()=>[t(H,null,{default:a(()=>[t(z,{overline:""},{default:a(()=>[I(w(e.code),1)]),_:2},1024)]),_:2},1024),t(H,null,{default:a(()=>[t(z,{caption:""},{default:a(()=>[I(w(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(O,null,{default:a(()=>[l[18]||(l[18]=d("div",{class:"text-center"},"Productos Sin Existencia",-1)),t(Z,null,{default:a(()=>[(y(!0),$(K,null,Y(u.value.wndNotExist,(e,p)=>(y(),E(ee,{key:p},{default:a(()=>[t(H,null,{default:a(()=>[t(z,{overline:""},{default:a(()=>[I(w(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(le,{align:"right"},{default:a(()=>[ne(t(V,{flat:"",label:"OK",color:"primary"},null,512),[[ie]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Jt as default};
