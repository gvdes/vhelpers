import{a as ue,aH as ce,u as ve,r as h,c as pe,o as P,d as I,w as l,h as H,e as t,Q as m,a1 as fe,f as d,a0 as u,ak as i,I as j,g as me,a2 as ge,a3 as we,a4 as L,b9 as xe,am as ye}from"./index.a51df52e.js";import{Q as _e}from"./QToolbar.27d2e181.js";import{b as N,d as C,e as r,a as D,Q as $}from"./QList.b1a7c0e2.js";import{Q as be}from"./QHeader.01f5189c.js";import{Q}from"./QCardSection.20d0df87.js";import{Q as W}from"./QCardActions.e204914e.js";import{Q as R}from"./QCard.5cd6a477.js";import{Q as ke}from"./QFooter.855a53d4.js";import{Q as he}from"./QPage.91f8d0b1.js";import{u as Pe}from"./use-quasar.80084b08.js";import"./jspdf.plugin.autotable.6285a63a.js";import{o as E}from"./outputsApi.26d93bb7.js";import{E as J}from"./exceljs.min.9e24d01d.js";import"./JsBarcode.cb858474.js";import"./browser.c61f550a.js";import{P as Ce,d as Qe}from"./ProductsAutocomplete.703e7c90.js";import"./QResizeObserver.bf26d4a2.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.fe49d1bc.js";import"./QInput.b1099941.js";import"./QSelect.8694b0c5.js";/* empty css                                                                         */const Ee={class:"row items-center"},Fe={class:"col"},Ve={class:"text-h6"},Ie={class:"text-center text-bold"},Se={class:"text-center text-bold row"},Be={class:"col"},Ae={class:"col"},Ne={class:"text-center text-h4"},De={class:"text-center text-h6 text-grey-14"},Re={class:"text-center"},Te={class:"q-pa-xs"},$e={class:"row"},Oe={class:"col column q-py-md"},rt={__name:"viewOutputs",setup(qe){const T=ue(),F=ce(),g=ve(),n=Pe(),v=h(null),c=h([]),s=h({val:null,state:!1}),x=h({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),w=h({state:!1,encontrados:[],faltantes:[],products:null}),O=h(null),q=h(null),K=pe(()=>{var o;return((o=c.value)==null?void 0:o.filter(e=>{var a;return e.product==((a=s.value.val)==null?void 0:a.product)}).length)>0}),X=async()=>{n.loading.show({message:"Obteniendo datos"});const o=F.params.oid,e=await E.getOutput(o);e.fail?console.log(e):(console.log(e),n.loading.hide(),g.session.rol=="aud"||g.session.rol=="audc"||g.session.rol=="root"||g.session.rol=="des"||(g.session.rol=="aux"||g.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||g.session.rol=="alm"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(v.value=e,c.value=e.bodie,console.log(v.value)):(T.push("/outputs"),n.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},Y=o=>{console.log(o)},Z=o=>{let e=c.value.findIndex(a=>a.product==o.code);console.log(e),e>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(s.value.val={product:o.code,description:o.description,amount:1},s.value.state=!0,console.log(o))},ee=async()=>{n.loading.show({message:"Insertando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await E.addProduct(s.value.val);o.fail?console.log(o):(console.log(o),c.value.push(s.value.val),s.value={val:null,state:!1},n.loading.hide())},te=async()=>{n.loading.show({message:"Editando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await E.editProduct(s.value.val);if(o.fail)console.log(o);else{console.log(o);let e=c.value.findIndex(a=>a.product==s.value.val.product);e>=0&&(c.value[e].amount=s.value.val.amount,n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},le=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const o=await E.removeProduct(s.value.val);if(o.fail)console.log(o);else{console.log(o);let e=c.value.findIndex(a=>a.product==s.value.val.product);e>=0&&(c.value.splice(e,1),n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},oe=async()=>{n.loading.show({message:"Terminando Salida"});let o={user:g.session.name,output:v.value,products:c.value};console.log(o);const e=await E.endOutput(o);e.fail?console.log(e):(n.notify({message:e,position:"center",type:"positive"}),console.log(e),n.loading.hide(),T.push("/outputs"))},ae=o=>{s.value.state=!0,s.value.val=o},G=()=>{s.value={val:null,state:!1}},se=()=>{O.value.click()},ne=async()=>{let o=document.getElementById("inputFile").files[0],e=new J.Workbook,a=[],y={};e.xlsx.load(o).then(U=>{let S=e.worksheets[0],b=S.getColumn("A");S.getColumn("B"),b.eachCell({includeEmpty:!0},function(f,_){let V=f.value,B=S.getCell(`B${_}`),A=parseFloat(B.value);y[V]?y[V]+=A:y[V]=A});let p=Object.keys(y).map(f=>({codigo:f,cantidad:y[f]}));if(p.forEach(f=>a.push(f.codigo)),a.length){let f={codes:a,_workpoint:g.session.store.id_viz};n.loading.show({message:"Procesando archivo, espera.."}),Qe.getMassive(f).then(_=>{let V=_.data;V.fails.notFound.map(k=>x.value.wndNotExist.push(k)),V.fails.repeat.map(k=>x.value.repeat.push(k));let B=_.data.products;x.value.wndGetRows=B.length,x.value.state=!x.value.state,console.log(B);let A=B.map(k=>{let z=p.find(re=>re.codigo===k.code);return{product:k.code,description:k.description,amount:z?z.cantidad:0,_output:F.params.oid}});M(A),n.loading.hide()}).catch(_=>{console.log(_),n.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ie=()=>{q.value.click()},de=async()=>{let o=document.getElementById("inputFilePreventa").files[0],e=new J.Workbook,a=[];e.xlsx.load(o).then(async y=>{let S=e.worksheets[0].getColumn("A");if(n.loading.show({message:"Procesando archivo, espera.."}),S.eachCell({includeEmpty:!0},function(b,p){b.value&&a.push(b.value)}),a.length){let b={codes:a,_workpoint:g.session.store.id_viz};console.log(b);const p=await E.outputPreventa(b);if(p.fail)alert(p);else{w.value.encontrados=p.Encontrados,w.value.faltantes=p.Faltantes,w.value.products=p.products.length,w.value.state=!w.value.state,p.products.forEach(_=>_._output=F.params.oid);let f=p.products;console.log(f),M(f),n.loading.hide()}}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},M=async o=>{const e=await E.addProductMasive(o);e.fail?console.log(e):(console.log(e),o.map(a=>{c.value.push(a)}),n.loading.hide())};return X(),(o,e)=>v.value?(P(),I(he,{key:0,padding:""},{default:l(()=>[t(be,{reveal:"",bordered:"",class:"bg-white text-black"},{default:l(()=>[t(_e,{class:"justify-between"},{default:l(()=>[t(m,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=a=>fe(T).push("/outputs")),round:""}),d("div",null,u(v.value.store.name),1),d("div",Ee,[d("div",Fe,u(v.value.warehouse.name),1),e[7]||(e[7]=i()),t(j,{name:"arrow_forward",class:"col"})]),d("div",null,u(v.value.created_by),1),d("div",null,[e[8]||(e[8]=i("salida ")),t(j,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=i()),d("span",Ve,u(v.value.code_fs),1)])]),_:1}),t(N),d("div",Ie,u(v.value.notes),1),t(N),d("div",Se,[d("div",Be,[t(m,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:se})]),d("div",Ae,[t(m,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:ie})]),d("input",{type:"file",ref_key:"inputFile",ref:O,id:"inputFile",onInput:ne,hidden:"",accept:".xlsx,.xls"},null,544),d("input",{type:"file",ref_key:"inputFilePreventa",ref:q,id:"inputFilePreventa",onInput:de,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1}),t(N,{spaced:"",inset:"",vertical:"",dark:""}),t(D,{bordered:""},{default:l(()=>[t(C,null,{default:l(()=>[t(r,null,{default:l(()=>e[10]||(e[10]=[i(" Producto ")])),_:1}),t(r,null,{default:l(()=>e[11]||(e[11]=[i(" Descripcion ")])),_:1}),t(r,{class:"text-center"},{default:l(()=>e[12]||(e[12]=[i(" Cantidad ")])),_:1})]),_:1})]),_:1}),(P(!0),me(we,null,ge(c.value,(a,y)=>(P(),I(D,{bordered:"",key:y},{default:l(()=>[L((P(),I(C,{clickable:"",onClick:U=>ae(a)},{default:l(()=>[t(r,null,{default:l(()=>[i(u(a.product),1)]),_:2},1024),t(r,null,{default:l(()=>[i(u(a.description),1)]),_:2},1024),t(r,{class:"text-center"},{default:l(()=>[i(u(a.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[ye]]),t(N)]),_:2},1024))),128)),t($,{modelValue:s.value.state,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.state=a),persistent:"",position:"bottom"},{default:l(()=>[t(R,{style:{width:"300","max-width":"40vw"}},{default:l(()=>[t(Q,null,{default:l(()=>[d("div",Ne,u(s.value.val.product),1),d("div",De,u(s.value.val.description),1)]),_:1}),t(Q,null,{default:l(()=>[d("div",Re,[d("div",Te,[e[13]||(e[13]=d("div",{class:"text-bold text-h6"},"Cantidad:",-1)),d("div",$e,[t(m,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=a=>s.value.val.amount--)}),d("div",Oe,[L(d("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.val.amount=a),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[xe,s.value.val.amount]])]),t(m,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=a=>s.value.val.amount++)})])])])]),_:1}),K.value?(P(),I(W,{key:1,align:"center"},{default:l(()=>[t(m,{flat:"",icon:"close",color:"red-10",onClick:G}),t(m,{flat:"",label:"Eliminar",color:"negative",onClick:le}),t(m,{flat:"",label:"Editar",color:"blue-10",onClick:te})]),_:1})):(P(),I(W,{key:0,align:"center"},{default:l(()=>[t(m,{flat:"",label:"Cancelar",color:"negative",onClick:G}),t(m,{flat:"",label:"Agregar",color:"positive",onClick:ee})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:x.value.state,"onUpdate:modelValue":e[5]||(e[5]=a=>x.value.state=a)},{default:l(()=>[t(R,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[14]||(e[14]=[i(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(D,{bordered:""},{default:l(()=>[t(C,null,{default:l(()=>[t(r,null,{default:l(()=>e[15]||(e[15]=[i("Productos Encontrados")])),_:1}),t(r,null,{default:l(()=>[i(u(x.value.wndGetRows),1)]),_:1})]),_:1}),t(C,null,{default:l(()=>[t(r,null,{default:l(()=>e[16]||(e[16]=[i("Productos Sin Datos")])),_:1}),t(r,null,{default:l(()=>[i(u(x.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:w.value.state,"onUpdate:modelValue":e[6]||(e[6]=a=>w.value.state=a)},{default:l(()=>[t(R,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[17]||(e[17]=[i(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(D,{bordered:""},{default:l(()=>[t(C,null,{default:l(()=>[t(r,null,{default:l(()=>e[18]||(e[18]=[i("Pedidos Encontrados")])),_:1}),t(r,null,{default:l(()=>[i(u(w.value.encontrados),1)]),_:1})]),_:1}),t(C,null,{default:l(()=>[t(r,null,{default:l(()=>e[19]||(e[19]=[i("Pedidos Sin Encontrar")])),_:1}),t(r,null,{default:l(()=>[i(u(w.value.faltantes),1)]),_:1})]),_:1}),t(C,null,{default:l(()=>[t(r,null,{default:l(()=>e[20]||(e[20]=[i("Productos Encontrados")])),_:1}),t(r,null,{default:l(()=>[i(u(w.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ke,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:l(()=>[t(R,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:l(()=>[t(Q,{class:"row"},{default:l(()=>[t(Ce,{class:"col",checkState:!1,onInput:Y,onAgregar:Z}),c.value.length>0?(P(),I(m,{key:0,color:"primary",flat:"",icon:"east",onClick:oe,round:""})):H("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0)}};export{rt as default};
