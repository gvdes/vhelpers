import{u as ue,aE as ce,r as h,c as ve,o as P,a as I,w as l,h as j,e as t,Q as m,a0 as pe,f as i,a5 as d,a4 as r,Y as H,g as fe,a1 as me,a2 as ge,a3 as L,b3 as we,a7 as xe}from"./index.8f70165c.js";import{Q as _e}from"./QToolbar.063a0e92.js";import{Q as A}from"./QSeparator.e9f112dd.js";import{Q as ye}from"./QHeader.b5b1d572.js";import{Q as C,a as u}from"./QItemSection.397e088d.js";import{Q as N}from"./QList.419f4769.js";import{u as be,Q as D,a as Q}from"./use-quasar.40693b97.js";import{Q as W}from"./QCardActions.524a3ea0.js";import{Q as $}from"./QDialog.c4828232.js";import{Q as ke}from"./QFooter.63807d6c.js";import{Q as he}from"./QPage.ee55a12c.js";import{u as Pe}from"./VDB.416f5d5f.js";import"./jspdf.plugin.autotable.2f4759ef.js";import{t as E}from"./transferApi.65ef40e3.js";import{E as J}from"./exceljs.min.9e24d01d.js";import"./browser.a927a609.js";import{P as Ce,d as Qe}from"./ProductsAutocomplete.a7860ebc.js";import"./QResizeObserver.ce0b3a37.js";import"./_commonjsHelpers.88e99c8f.js";import"./axios.6d2993c0.js";import"./axios.9ab26c22.js";import"./QInput.c2e93834.js";import"./use-key-composition.c9c670ab.js";import"./uid.937d8ee7.js";import"./QSelect.db735679.js";import"./position-engine.1c524811.js";import"./rtl.276c3f1b.js";/* empty css                                                                         */const Ee={class:"row items-center"},Fe={class:"col"},Ve={class:"col"},Ie={class:"text-h6"},Te={class:"text-center text-bold"},Be={class:"text-center text-bold row"},Se={class:"col"},Ae={class:"col"},Ne={class:"text-center text-h4"},De={class:"text-center text-h6 text-grey-14"},Re={class:"text-center"},$e={class:"q-pa-xs"},qe={class:"row"},Ge={class:"col column q-py-md"},gt={__name:"viewTransfer",setup(Me){const R=ue(),F=ce(),y=Pe(),n=be(),c=h(null),s=h({val:null,state:!1}),v=h([]),w=h({state:!1,wndGetRows:[],wndNoDataFound:[],wndTotal:[],wndGetAdded:[],_supply_by:0,message:"",messageRepeat:"",wndNotExist:[],repeat:[]}),g=h({state:!1,encontrados:[],faltantes:[],products:null}),q=h(null),G=h(null),Y=ve(()=>{var a;return((a=v.value)==null?void 0:a.filter(e=>{var o;return e.product==((o=s.value.val)==null?void 0:o.product)}).length)>0}),K=async()=>{const a=F.params.oid,e=await E.getTransfer(a);e.fail?console.log(e):(console.log(e),y.session.rol=="aud"||(y.session.rol=="aux"||y.session.rol=="gen")&&e.origin.id!==4&&e.destiny.id!==4||y.session.rol=="alm"&&([5,6].includes(e.destiny.id)||[5,6].includes(e.origin.id))?(c.value=e,v.value=e.bodie,console.log(c.value)):(R.push("/transfers"),n.notify({message:"No tienes acceso a este traspaso",type:"negative",position:"center"})))},X=a=>{console.log(a)},Z=a=>{let e=v.value.findIndex(o=>o.product==a.code);console.log(e),e>=0?n.notify({message:"El Producto ya esta agregado",type:"negative",position:"center"}):(s.value.val={product:a.code,description:a.description,amount:1},s.value.state=!0,console.log(a))},ee=async()=>{n.loading.show({message:"Insertando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const a=await E.addProduct(s.value.val);a.fail?console.log(a):(console.log(a),v.value.push(s.value.val),s.value={val:null,state:!1},n.loading.hide())},te=async()=>{n.loading.show({message:"Editando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const a=await E.editProduct(s.value.val);if(a.fail)console.log(a);else{console.log(a);let e=v.value.findIndex(o=>o.product==s.value.val.product);e>=0&&(v.value[e].amount=s.value.val.amount,n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},le=async()=>{n.loading.show({message:"Eliminando Producto"}),console.log(s.value.val),s.value.val._transfer=F.params.oid;const a=await E.removeProduct(s.value.val);if(a.fail)console.log(a);else{console.log(a);let e=v.value.findIndex(o=>o.product==s.value.val.product);e>=0&&(v.value.splice(e,1),n.notify({type:"positive",position:"center"}),s.value={val:null,state:!1},n.loading.hide())}},ae=a=>{s.value.state=!0,s.value.val=a},M=()=>{s.value={val:null,state:!1}},oe=async()=>{n.loading.show({message:"Terminando Traspaso"});let a={user:y.session.name,traspaso:c.value,products:v.value};const e=await E.endTransfer(a);e.fail?console.log(e):(n.notify({message:e,position:"center",type:"positive"}),console.log(e),n.loading.hide(),R.push("/transfers"))},se=()=>{q.value.click()},ne=async()=>{let a=document.getElementById("inputFile").files[0],e=new J.Workbook,o=[],x={};e.xlsx.load(a).then(z=>{let T=e.worksheets[0],b=T.getColumn("A");T.getColumn("B"),b.eachCell({includeEmpty:!0},function(f,_){let V=f.value,B=T.getCell(`B${_}`),S=parseFloat(B.value);x[V]?x[V]+=S:x[V]=S});let p=Object.keys(x).map(f=>({codigo:f,cantidad:x[f]}));if(p.forEach(f=>o.push(f.codigo)),o.length){let f={codes:o,_workpoint:y.session.store.id_viz};n.loading.show({message:"Procesando archivo, espera.."}),Qe.getMassive(f).then(_=>{let V=_.data;V.fails.notFound.map(k=>w.value.wndNotExist.push(k)),V.fails.repeat.map(k=>w.value.repeat.push(k));let B=_.data.products;w.value.wndGetRows=B.length,w.value.state=!w.value.state,console.log(B);let S=B.map(k=>{let O=p.find(de=>de.codigo===k.code);return{product:k.code,description:k.description,amount:O?O.cantidad:0,_transfer:F.params.oid}});U(S),n.loading.hide()}).catch(_=>{console.log(_),n.notify({message:"Hay un problema con obtener los datos :/.",icon:"fas fa-grin-beam-sweat",color:"negative"})})}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},ie=()=>{G.value.click()},re=async()=>{let a=document.getElementById("inputFilePreventa").files[0],e=new J.Workbook,o=[];e.xlsx.load(a).then(async x=>{let T=e.worksheets[0].getColumn("A");if(n.loading.show({message:"Procesando archivo, espera.."}),T.eachCell({includeEmpty:!0},function(b,p){b.value&&o.push(b.value)}),o.length){let b={codes:o,_workpoint:y.session.store.id_viz};console.log(b);const p=await E.transferPreventa(b);if(p.fail)alert(p);else{g.value.encontrados=p.Encontrados,g.value.faltantes=p.Faltantes,g.value.products=p.products.length,g.value.state=!g.value.state,p.products.forEach(_=>_._transfer=F.params.oid);let f=p.products;console.log(f),U(f),n.loading.hide()}}else n.notify({message:"Vaya!! Al parecer este archivo esta vacio.",icon:"fas fa-grin-beam-sweat",color:"negative"})})},U=async a=>{const e=await E.addProductMasive(a);e.fail?console.log(e):(console.log(e),a.map(o=>{v.value.push(o)}),n.loading.hide())};return K(),(a,e)=>c.value?(P(),I(he,{key:0,padding:""},{default:l(()=>[t(ye,{reveal:"",bordered:"",class:"bg-white text-black"},{default:l(()=>[t(_e,{class:"justify-between"},{default:l(()=>[t(m,{color:"primary",icon:"arrow_back",flat:"",onClick:e[0]||(e[0]=o=>pe(R).push("/transfers")),round:""}),i("div",null,d(c.value.store.name),1),i("div",Ee,[i("div",Fe,d(c.value.origin.name),1),e[7]||(e[7]=r()),t(H,{name:"arrow_forward",class:"col"}),i("div",Ve,d(c.value.destiny.name),1)]),i("div",null,d(c.value.created_by),1),i("div",null,[e[8]||(e[8]=r("Traspaso ")),t(H,{name:"navigate_next",color:"primary"}),e[9]||(e[9]=r()),i("span",Ie,d(c.value.code_fs),1)])]),_:1}),t(A),i("div",Te,d(c.value.notes),1),t(A),i("div",Be,[i("div",Se,[t(m,{color:"primary",icon:"publish",label:"Importar Excel",flat:"",onClick:se})]),i("div",Ae,[t(m,{color:"primary",icon:"apps",label:"Preventas",flat:"",onClick:ie})]),i("input",{type:"file",ref_key:"inputFile",ref:q,id:"inputFile",onInput:ne,hidden:"",accept:".xlsx,.xls"},null,544),i("input",{type:"file",ref_key:"inputFilePreventa",ref:G,id:"inputFilePreventa",onInput:re,hidden:"",accept:".xlsx,.xls"},null,544)])]),_:1}),t(A,{spaced:"",inset:"",vertical:"",dark:""}),t(N,{bordered:""},{default:l(()=>[t(C,null,{default:l(()=>[t(u,null,{default:l(()=>e[10]||(e[10]=[r(" Producto ")])),_:1}),t(u,null,{default:l(()=>e[11]||(e[11]=[r(" Descripcion ")])),_:1}),t(u,{class:"text-center"},{default:l(()=>e[12]||(e[12]=[r(" Cantidad ")])),_:1})]),_:1})]),_:1}),(P(!0),fe(ge,null,me(v.value,(o,x)=>(P(),I(N,{bordered:"",key:x},{default:l(()=>[L((P(),I(C,{clickable:"",onClick:z=>ae(o)},{default:l(()=>[t(u,null,{default:l(()=>[r(d(o.product),1)]),_:2},1024),t(u,null,{default:l(()=>[r(d(o.description),1)]),_:2},1024),t(u,{class:"text-center"},{default:l(()=>[r(d(o.amount),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[xe]]),t(A)]),_:2},1024))),128)),t($,{modelValue:s.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.state=o),persistent:"",position:"bottom"},{default:l(()=>[t(D,{style:{width:"300","max-width":"40vw"}},{default:l(()=>[t(Q,null,{default:l(()=>[i("div",Ne,d(s.value.val.product),1),i("div",De,d(s.value.val.description),1)]),_:1}),t(Q,null,{default:l(()=>[i("div",Re,[i("div",$e,[e[13]||(e[13]=i("div",{class:"text-bold text-h6"},"Cantidad:",-1)),i("div",qe,[t(m,{flat:"",color:"negative",icon:"remove",class:"text-h5 col",onClick:e[1]||(e[1]=o=>s.value.val.amount>1?s.value.val.amount--:"")}),i("div",Ge,[L(i("input",{type:"number",min:"1","onUpdate:modelValue":e[2]||(e[2]=o=>s.value.val.amount=o),class:"text-center exo",style:{width:"100px","font-size":"3em",margin:"auto auto",border:"none"}},null,512),[[we,s.value.val.amount]])]),t(m,{flat:"",color:"positive",icon:"add",class:"text-h5 col",onClick:e[3]||(e[3]=o=>s.value.val.amount++)})])])])]),_:1}),Y.value?(P(),I(W,{key:1,align:"center"},{default:l(()=>[t(m,{flat:"",icon:"close",color:"red-10",onClick:M}),t(m,{flat:"",label:"Eliminar",color:"negative",onClick:le}),t(m,{flat:"",label:"Editar",color:"blue-10",onClick:te})]),_:1})):(P(),I(W,{key:0,align:"center"},{default:l(()=>[t(m,{flat:"",label:"Cancelar",color:"negative",onClick:M}),t(m,{flat:"",label:"Agregar",color:"positive",onClick:ee})]),_:1}))]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:w.value.state,"onUpdate:modelValue":e[5]||(e[5]=o=>w.value.state=o)},{default:l(()=>[t(D,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[14]||(e[14]=[r(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(N,{bordered:""},{default:l(()=>[t(C,null,{default:l(()=>[t(u,null,{default:l(()=>e[15]||(e[15]=[r("Productos Encontrados")])),_:1}),t(u,null,{default:l(()=>[r(d(w.value.wndGetRows),1)]),_:1})]),_:1}),t(C,null,{default:l(()=>[t(u,null,{default:l(()=>e[16]||(e[16]=[r("Productos Sin Datos")])),_:1}),t(u,null,{default:l(()=>[r(d(w.value.wndNotExist),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:g.value.state,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value.state=o)},{default:l(()=>[t(D,null,{default:l(()=>[t(Q,{class:"row text-bold text-overline text-center"},{default:l(()=>e[17]||(e[17]=[r(" Resultados de la importacion :O ")])),_:1}),t(Q,null,{default:l(()=>[t(N,{bordered:""},{default:l(()=>[t(C,null,{default:l(()=>[t(u,null,{default:l(()=>e[18]||(e[18]=[r("Pedidos Encontrados")])),_:1}),t(u,null,{default:l(()=>[r(d(g.value.encontrados),1)]),_:1})]),_:1}),t(C,null,{default:l(()=>[t(u,null,{default:l(()=>e[19]||(e[19]=[r("Pedidos Sin Encontrar")])),_:1}),t(u,null,{default:l(()=>[r(d(g.value.faltantes),1)]),_:1})]),_:1}),t(C,null,{default:l(()=>[t(u,null,{default:l(()=>e[20]||(e[20]=[r("Productos Encontrados")])),_:1}),t(u,null,{default:l(()=>[r(d(g.value.products),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ke,{reveal:"",elevated:"",bordered:"",class:"bg-white"},{default:l(()=>[t(D,{class:"q-mb-md",flat:"",bordered:"",dense:""},{default:l(()=>[t(Q,{class:"row"},{default:l(()=>[t(Ce,{class:"col",checkState:!1,onInput:X,onAgregar:Z}),v.value.length>0?(P(),I(m,{key:0,color:"primary",flat:"",icon:"east",onClick:oe,round:""})):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)}};export{gt as default};
