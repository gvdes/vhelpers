import{u as W,r as m,c as k,o as p,d as E,w as o,e as a,f as u,S as F,Q as V,h as w,g as C,ak as c,a0 as _,al as T,a1 as Z}from"./index.5cd8bf7f.js";import{Q as ee}from"./QToolbar.d85315dd.js";import{Q as v}from"./QCardSection.8133d3e1.js";import{Q as U}from"./QCard.cc9a043d.js";import{b as D,Q as A,a as le,d as ae,e as R}from"./QList.d00c8370.js";import{Q as d}from"./QInput.05b060b5.js";import{Q as $}from"./QUploader.a0268d8c.js";import{Q as z,a as q}from"./QSelect.9a88dcc4.js";import{Q as te}from"./QForm.58a9e4f8.js";import{Q as oe}from"./QTable.d9f133cd.js";import{Q as se}from"./QSpace.039695af.js";import{Q as ne}from"./QImg.40abdea9.js";import{Q as ue}from"./QCardActions.7f616b43.js";import{Q as de}from"./QPage.795082c6.js";import{c as L}from"./clientApi.d1fd8768.js";import{u as ie}from"./use-quasar.3c11604f.js";import{c as re}from"./axios.f821ef00.js";import"./use-key-composition.28d192d9.js";import"./QLinearProgress.6e950e52.js";import"./QCheckbox.4d9ed756.js";const me={class:"row"},ve={class:"flex flex-center"},pe={class:"row q-my-sm"},ce={class:"row q-my-sm"},fe={key:0},ge={class:"text-h4"},be={class:"row justify-between"},Ve={key:0},ye=["src"],xe={key:1},Qe={key:1,class:"q-mt-md"},he={__name:"formCli",setup(ke){const N=W(),r=ie(),f=m(null),g=m(null),y=m({state:!1}),x=m([]),S=m(null),n=m({state:!1,val:null}),b=m({state:!1,table:{cols:[{name:"Fs_id",label:"Codigo",field:"id",align:"center"},{name:"Nombre",label:"Nombre",field:"name",align:"left"},{name:"Email",label:"Correo",field:"email",align:"left"},{name:"Telefono",label:"Telefono",field:"phone",align:"left"},{name:"Tarifa",label:"Precio",field:"_price_list",align:"center"}],noresults:"><"}}),e=m({branch:N.session.store.id,name:null,ticket:null,address:{street:null,numint:null,numext:null,cp:null,colinia:null,mun:null,state:null},phone:null,email:null,priceList:{val:null,opts:[{id:2,label:"Mayoreo"},{id:3,label:"Docena"},{id:4,label:"Caja"},{id:5,label:"Especial"},{id:6,label:"Centro"}]},agent:{db:[],val:null,opts:[]},notes:null,state:!1,picture:null}),P=k(()=>e.value.priceList.val&&e.value.name&&e.value.name.length>4&&(e.value.phone&&e.value.phone.length==12||e.value.email)&&e.value.agent&&e.value.ticket&&e.value.address.street&&e.value.address.state&&e.value.address.mun&&e.value.picture),h=k(()=>e.value.agent.db.filter(t=>t._store==N.session.store.id)),j=k(()=>x.value.find(t=>t.email==e.value.email)),I=k(()=>x.value.find(t=>{var l;return t.phone==((l=e.value.phone)==null?void 0:l.split("-").join(""))})),O=t=>{console.log(t),t.length>0&&(e.value.picture=t[0])},M=t=>{console.log(t),r.notify({message:`${t[0].failedPropValidation}`,type:"negative",position:"center"})},Y=async()=>{r.loading.show({message:"Obteniendo Datos"});const t=await L.index();t.fail?console.log(t):(console.log(t),x.value=t.clients,e.value.agent.db=t.agents,r.loading.hide())},H=async()=>{r.loading.show({message:"Creando Solicitud"}),console.log(e.value),e.value.state=!0;const t=new FormData;t.append("branch",e.value.branch),t.append("name",e.value.name.toUpperCase()),t.append("ticket",e.value.ticket),t.append("address",JSON.stringify(e.value.address)),t.append("phone",e.value.phone?e.value.phone.split("-").join(""):null),t.append("email",e.value.email?e.value.email:null),t.append("priceList",e.value.priceList.val.id),t.append("agent",e.value.agent.val),t.append("notes",e.value.notes),t.append("picture",e.value.picture);const l=await L.create(t);l.fail?console.log(l):(B(),e.value.state=!1,r.loading.hide(),r.notify({message:"Formulario Enviado....",icon:"check_circle",color:"positive"}),console.log(l),B())},B=()=>{e.value.ticket=null,e.value.priceList.val=null,e.value.name=null,e.value.agent.val=null,e.value.address={street:null,numint:null,numext:null,cp:null,colinia:null,mun:null,state:null},e.value.phone=null,e.value.email=null,e.value.notes=null,e.value.picture=null,S.value.reset()},J=()=>{f.value.pickFiles()},X=t=>{g.value=URL.createObjectURL(t[0]),n.value.val.pictureExist=t[0]},G=()=>{f.value&&f.value.reset(),g.value=null,n.value.state=!1},K=async()=>{r.loading.show({message:"Actualizando Imagen"});const t=new FormData;t.append("id",n.value.val.id),t.append("picture",n.value.val.pictureExist);const l=await L.updateImageClient(t);l.fail?console.log(l):(console.log(l),f.value.reset(),g.value=null,n.value.val.pictureExist=null,n.value.val.picture=l.image,r.notify({message:l.mssg,type:"positive",position:"bottom"}),r.loading.hide())};return Y(),(t,l)=>(p(),E(de,null,{default:o(()=>[a(U,null,{default:o(()=>[a(v,null,{default:o(()=>[a(ee,{class:"justify-between"},{default:o(()=>[u("div",null,[l[20]||(l[20]=u("span",{class:"text-grey"},"Helpers",-1)),a(F,{name:"navigate_next",color:"primary"}),l[21]||(l[21]=u("span",{class:"text-h6"},"Formulario Clientes",-1))]),u("div",me,[a(V,{flat:"",round:"",icon:"search",color:"teal",onClick:l[0]||(l[0]=i=>y.value.state=!y.value.state),title:"Buscar"})])]),_:1})]),_:1})]),_:1}),a(D,{spaced:"",inset:"",vertical:"",dark:""}),u("div",ve,[a(U,{flat:"",style:{width:"700px","max-width":"80vw"}},{default:o(()=>[a(v,null,{default:o(()=>[a(te,{onSubmit:H,class:"q-gutter-md text-grey-10"},{default:o(()=>{var i,Q;return[u("div",null,[a(v,{class:""},{default:o(()=>l[22]||(l[22]=[u("div",{class:"text-h4 text-center text-bold",style:{"text-decoration":"underline"}},"Datos cliente",-1)])),_:1}),a(d,{rounded:"",outlined:"",modelValue:e.value.name,"onUpdate:modelValue":l[1]||(l[1]=s=>e.value.name=s),label:"Nombre del Cliente",class:"q-my-sm"},null,8,["modelValue"]),u("div",pe,[a(d,{rounded:"",outlined:"",modelValue:e.value.address.cp,"onUpdate:modelValue":l[2]||(l[2]=s=>e.value.address.cp=s),label:"Codigo Postal",mask:"#####",class:"col"},null,8,["modelValue"]),a(d,{rounded:"",outlined:"",modelValue:e.value.address.state,"onUpdate:modelValue":l[3]||(l[3]=s=>e.value.address.state=s),label:"Estado",class:"col"},null,8,["modelValue"])]),a(d,{rounded:"",outlined:"",modelValue:e.value.address.colinia,"onUpdate:modelValue":l[4]||(l[4]=s=>e.value.address.colinia=s),label:"Colonia",class:"q-my-sm"},null,8,["modelValue"]),a(d,{rounded:"",outlined:"",modelValue:e.value.address.mun,"onUpdate:modelValue":l[5]||(l[5]=s=>e.value.address.mun=s),label:"Municipio",class:"q-my-sm"},null,8,["modelValue"]),a(d,{rounded:"",outlined:"",modelValue:e.value.address.street,"onUpdate:modelValue":l[6]||(l[6]=s=>e.value.address.street=s),label:"Calle",class:"q-my-sm"},null,8,["modelValue"]),u("div",ce,[a(d,{rounded:"",outlined:"",modelValue:e.value.address.numint,"onUpdate:modelValue":l[7]||(l[7]=s=>e.value.address.numint=s),label:"Num INT",class:"col"},null,8,["modelValue"]),a(d,{rounded:"",outlined:"",modelValue:e.value.address.numext,"onUpdate:modelValue":l[8]||(l[8]=s=>e.value.address.numext=s),label:"Num EXT",class:"col"},null,8,["modelValue"])]),a(d,{rounded:"",outlined:"",modelValue:e.value.phone,"onUpdate:modelValue":l[9]||(l[9]=s=>e.value.phone=s),label:"Telefono",mask:"##-####-####",class:"q-my-sm",error:I.value!=null,"error-message":`Ya existe el numero con otro cliente ${(i=I.value)==null?void 0:i.name}`},null,8,["modelValue","error","error-message"]),a(d,{rounded:"",outlined:"",modelValue:e.value.email,"onUpdate:modelValue":l[10]||(l[10]=s=>e.value.email=s),label:"Correo Electronico",class:"q-my-sm",error:j.value!=null,"error-message":`Ya existe el correo con otro cliente ${(Q=j.value)==null?void 0:Q.name}`},null,8,["modelValue","error","error-message"]),a(D,{spaced:"",inset:"",vertical:"",dark:""}),a($,{dense:"","hide-upload-btn":"",label:"Fotografia",color:"primary",accept:".jpg",onAdded:O,onRemoved:l[11]||(l[11]=()=>e.value.picture=null),ref_key:"refe",ref:S,class:"full-width","max-file-size":"2097152",onRejected:M},null,512),a(v,{class:""},{default:o(()=>l[23]||(l[23]=[u("div",{class:"text-h4 text-center",style:{"text-decoration":"underline"}},"Datos Sucursal",-1)])),_:1}),a(d,{rounded:"",outlined:"",modelValue:e.value.ticket,"onUpdate:modelValue":l[12]||(l[12]=s=>e.value.ticket=s),label:"Ticket",mask:"#-######",class:"q-my-sm"},null,8,["modelValue"]),e.value.branch?(p(),E(z,{key:0,rounded:"",outlined:"","option-label":"complete_name",modelValue:e.value.agent.val,"onUpdate:modelValue":l[13]||(l[13]=s=>e.value.agent.val=s),options:h.value,label:"Quien atendio",class:"q-my-sm"},null,8,["modelValue","options"])):w("",!0),a(z,{rounded:"",outlined:"",modelValue:e.value.priceList.val,"onUpdate:modelValue":l[14]||(l[14]=s=>e.value.priceList.val=s),options:e.value.priceList.opts,label:"Precio Otorgado",class:"q-my-sm"},null,8,["modelValue","options"]),a(d,{rounded:"",outlined:"",modelValue:e.value.notes,"onUpdate:modelValue":l[15]||(l[15]=s=>e.value.notes=s),label:"Notas",class:"q-my-sm"},null,8,["modelValue"])]),P.value?(p(),C("div",fe,[a(V,{label:"Enviar",type:"submit",color:"primary"})])):w("",!0)]}),_:1})]),_:1})]),_:1})]),a(A,{modelValue:y.value.state,"onUpdate:modelValue":l[18]||(l[18]=i=>y.value.state=i)},{default:o(()=>[a(U,{class:"my-card",style:{width:"700px","max-width":"80vw"}},{default:o(()=>[a(v,null,{default:o(()=>[u("div",ge,[a(F,{name:"search",class:"q-mr-xs"}),l[24]||(l[24]=c(" Buscador de Clientes "))]),a(v,null,{default:o(()=>[u("div",be,[a(d,{class:"col",modelValue:b.value.val,"onUpdate:modelValue":l[16]||(l[16]=i=>b.value.val=i),type:"text",label:"Buscar"},null,8,["modelValue"])]),a(D,{spaced:"",inset:"",vertical:"",dark:""}),u("div",null,[a(oe,{rows:x.value,columns:b.value.table.cols,"row-key":"name","no-data-label":b.value.table.noresults,filter:b.value.val,onRowClick:l[17]||(l[17]=(i,Q)=>{n.value.state=!n.value.state,n.value.val=Q})},null,8,["rows","columns","no-data-label","filter"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:n.value.state,"onUpdate:modelValue":l[19]||(l[19]=i=>n.value.state=i),persistent:""},{default:o(()=>[a(U,{style:{width:"900px","max-width":"100vw"}},{default:o(()=>[a(v,{class:"text-center text-bold text-h5"},{default:o(()=>[c(_(n.value.val.name)+" ",1),a(se),n.value.val.picture?(p(),C("div",Ve,[a(T,{size:"150px"},{default:o(()=>[u("img",{src:`${Z(re)}/client/${n.value.val.picture}`},null,8,ye)]),_:1})])):(p(),C("div",xe,[n.value.val.pictureExist?w("",!0):(p(),E(V,{key:0,color:"teal",flat:"",icon:"person_add",onClick:J,size:"52px"})),a($,{ref_key:"uploader",ref:f,accept:".jpg",onAdded:X,"hide-upload-btn":"",style:{display:"none"},"field-name":"file"},null,512),g.value?(p(),C("div",Qe,[a(T,{size:"150px"},{default:o(()=>[a(ne,{src:g.value},null,8,["src"])]),_:1})])):w("",!0)]))]),_:1}),a(v,null,{default:o(()=>[a(le,{bordered:""},{default:o(()=>[a(ae,null,{default:o(()=>[a(R,{class:"text-center"},{default:o(()=>[a(q,null,{default:o(()=>l[25]||(l[25]=[c("Celular")])),_:1}),a(q,null,{default:o(()=>[c(_(n.value.val.phone),1)]),_:1})]),_:1}),a(R,null,{default:o(()=>[a(q,{class:"text-center"},{default:o(()=>l[26]||(l[26]=[c("Correo")])),_:1}),a(q,null,{default:o(()=>[c(_(n.value.val.email),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(ue,{align:"right"},{default:o(()=>[a(V,{flat:"",label:"Cancel",color:"primary",onClick:G}),a(V,{flat:"",label:"Enviar",color:"primary",disable:!n.value.val.pictureExist,onClick:K},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{he as default};
