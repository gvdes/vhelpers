import{Q as U}from"./QTable.d42c807f.js";import{Q as Y}from"./QCardSection.f84172c8.js";import{Q as V}from"./QSelect.99543841.js";import{Q as M}from"./QSeparator.8a831898.js";import{Q as R}from"./QInput.f6fa87e6.js";import{u as T,a as B,r as n,c as E,o as h,g as L,e as o,w as m,a3 as j,ak as H,a0 as N,Q as g,a1 as P,d as w,h as x}from"./index.d87ba090.js";import{Q as $}from"./QSpace.39330c90.js";import{Q as J}from"./QCardActions.fa9275b3.js";import{Q as q}from"./QCard.e3958f52.js";import{Q as F}from"./QList.9f6b0a46.js";import{u as z,c as y}from"./cashApi.3ac19b20.js";import"./QDrawer.acff2a85.js";import"./ClosePopup.b4d916ee.js";import"./axios.a1a5c455.js";import{u as G}from"./use-quasar.eba3be69.js";import{d as p}from"./dayjs.min.cbcf888d.js";import"./jspdf.plugin.autotable.ea40903c.js";import"./use-dark.af54e05c.js";import"./QLinearProgress.8823704f.js";import"./QCheckbox.7410cfbb.js";import"./use-key-composition.3243082c.js";import"./QResizeObserver.76402ea5.js";import"./QScrollObserver.571ece0c.js";import"./_commonjsHelpers.88e99c8f.js";const be={__name:"Index",setup(K){const i=T(),v=G(),k=B(),r=z(),_=n([]),a=n({val:null,state:!1}),u=n({cashier:{user:null,print:null,cash_start:5e3},_status:2,id:null,name:null}),C=n([]),f=n([]),D=n({columns:[{name:"id",label:"ID",field:l=>l.id},{name:"name",label:"NOMBRE",field:l=>l.name},{name:"status",label:"ESTADO",field:l=>l.status.name},{name:"store",label:"SUCURSAL",field:l=>l.store.name},{name:"cashies",label:"ULTIMO CAJERO",field:l=>{var e;return(e=l.cashier)==null?void 0:e.user.staff.complete_name}},{name:"open_at",label:"ULTIMA APERTURA",field:l=>{var e;return l.cashier?p((e=l.cashier)==null?void 0:e.open_date).format("YYYY-MM-DD HH:mm:ss"):""}}],pagination:{rowsPerPage:0}}),c=E(()=>{var t,d,Q;const l=(d=(t=a.value.val)==null?void 0:t.cashier)==null?void 0:d.open_date;if(!l)return!1;const e=p().format("YYYY-MM-DD"),s=p(l).format("YYYY-MM-DD");return console.log("Hoy:",e,"OpenDate:",s),((Q=a.value.val)==null?void 0:Q._status)==1||e===s}),A=async()=>{v.loading.show({message:"Obteniendo Cajas"});let l={uid:i.session.credentials.id,sid:i.session.store.id};console.log(i.session);const e=await y.index(l);e.fail?console.log(e):(console.log(e),f.value=e.cashes,_.value=e.cashiers,C.value=e.printers,r.setTitle("CAJAS"),r.setDate(null),r.setshowtoolbar(!1),r.setCash(null),v.loading.hide())},S=(l,e)=>{var d;console.log(e),a.value.state=!0;const s=p().format("YYYY-MM-DD"),t=(d=e.cashier)!=null&&d.open_date?p(e.cashier.open_date).format("YYYY-MM-DD"):null;console.log("Hoy:",s,"OpenDate:",t),e._status==1||e._status==2&&s===t?a.value.val=e:(u.value.id=e.id,u.value.name=e.name,u.value.store=e.store,u.value._terminal=e._terminal,a.value.val=u.value),console.log(a.value.val)},I=async()=>{v.loading.show({message:"Abriendo Caja"});let l={cashier:a.value.val,uid:i.session.credentials.id};console.log(l);const e=await y.openCash(l);if(console.log(e),e.fail)console.log(e);else{console.log(e);let s=f.value.findIndex(t=>t.id==e.id);console.log(s),s>=0&&(f.value.splice(s,1,e),b(),v.loading.hide())}},b=()=>{a.value.state=!1,a.value.val=null},O=()=>{k.push(`/cashRegisters/${a.value.val.id}/cash`),r.setCash(a.value.val.id)};return A(),(l,e)=>(h(),L(j,null,[o(U,{rows:f.value,grid:"",columns:D.value.columns,onRowClick:S,pagination:D.value.pagination},null,8,["rows","columns","pagination"]),o(F,{modelValue:a.value.state,"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.state=s),persistent:""},{default:m(()=>[o(q,{class:"",style:{width:"300px"}},{default:m(()=>[o(Y,{class:"text-center text-bold text-h6"},{default:m(()=>[H(N(a.value.val.name),1)]),_:1}),o(Y,null,{default:m(()=>[o(V,{modelValue:a.value.val.cashier.user,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.val.cashier.user=s),options:_.value,label:"Cajero","option-label":s=>s.staff.complete_name,option:"",filled:"",disable:c.value},null,8,["modelValue","options","option-label","disable"]),o(M,{spaced:"",inset:"",vertical:"",dark:""}),o(V,{modelValue:a.value.val.cashier.print,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.val.cashier.print=s),options:C.value,label:"Impresora","option-label":"name",filled:"",disable:c.value},null,8,["modelValue","options","disable"]),o(M,{spaced:"",inset:"",vertical:"",dark:""}),o(R,{modelValue:a.value.val.cashier.cash_start,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.val.cashier.cash_start=s),type:"number",label:"Monto Inicial",filled:"",disable:c.value},null,8,["modelValue","disable"])]),_:1}),o(J,{align:"left"},{default:m(()=>{var s;return[o(g,{color:"negative",icon:"close",flat:"",rounded:"",onClick:b}),o($),a.value.val._status==2&&["gen","aud","aux","root"].includes(P(i).session.rol)&&!c.value?(h(),w(g,{key:0,color:"positive",label:"Abrir",onClick:I,flat:"",disable:c.value||!a.value.val.cashier.user||!a.value.val.cashier.print},null,8,["disable"])):x("",!0),((s=a.value.val)==null?void 0:s._status)==1?(h(),w(g,{key:1,color:"positive",label:"Ir",onClick:O,flat:""})):x("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{be as default};
